(function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:false,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:false,enumerable:true,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function getDefault(){return module["default"]}:function getModuleExports(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=136)})([function(module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[]};process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},function(module,exports,__webpack_require__){"use strict";(function(process){var validateFormat=function validateFormat(format){};if(process.env.NODE_ENV!=="production"){validateFormat=function validateFormat(format){if(format===undefined){throw new Error("invariant requires an error message argument")}}}function invariant(condition,format,a,b,c,d,e,f){validateFormat(format);if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error(format.replace(/%s/g,function(){return args[argIndex++]}));error.name="Invariant Violation"}error.framesToPop=1;throw error}}module.exports=invariant}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var emptyFunction=__webpack_require__(10);var warning=emptyFunction;if(process.env.NODE_ENV!=="production"){var printWarning=function printWarning(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var argIndex=0;var message="Warning: "+format.replace(/%s/g,function(){return args[argIndex++]});if(typeof console!=="undefined"){console.error(message)}try{throw new Error(message)}catch(x){}};warning=function warning(condition,format){if(format===undefined){throw new Error("`warning(condition, format, ...args)` requires a warning "+"message argument")}if(format.indexOf("Failed Composite propType: ")===0){return}if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}printWarning.apply(undefined,[format].concat(args))}}}module.exports=warning}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function reactProdInvariant(code){var argCount=arguments.length-1;var message="Minified React error #"+code+"; visit "+"http://facebook.github.io/react/docs/error-decoder.html?invariant="+code;for(var argIdx=0;argIdx<argCount;argIdx++){message+="&args[]="+encodeURIComponent(arguments[argIdx+1])}message+=" for the full message or use the non-minified dev environment"+" for full errors and additional helpful warnings.";var error=new Error(message);error.name="Invariant Violation";error.framesToPop=1;throw error}module.exports=reactProdInvariant},function(module,exports,__webpack_require__){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols;var hasOwnProperty=Object.prototype.hasOwnProperty;var propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(val===null||val===undefined){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}function shouldUseNative(){try{if(!Object.assign){return false}var test1=new String("abc");test1[5]="de";if(Object.getOwnPropertyNames(test1)[0]==="5"){return false}var test2={};for(var i=0;i<10;i++){test2["_"+String.fromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if(order2.join("")!=="0123456789"){return false}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if(Object.keys(Object.assign({},test3)).join("")!=="abcdefghijklmnopqrst"){return false}return true}catch(err){return false}}module.exports=shouldUseNative()?Object.assign:function(target,source){var from;var to=toObject(target);var symbols;for(var s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var DOMProperty=__webpack_require__(21);var ReactDOMComponentFlags=__webpack_require__(111);var invariant=__webpack_require__(1);var ATTR_NAME=DOMProperty.ID_ATTRIBUTE_NAME;var Flags=ReactDOMComponentFlags;var internalInstanceKey="__reactInternalInstance$"+Math.random().toString(36).slice(2);function shouldPrecacheNode(node,nodeID){return node.nodeType===1&&node.getAttribute(ATTR_NAME)===String(nodeID)||node.nodeType===8&&node.nodeValue===" react-text: "+nodeID+" "||node.nodeType===8&&node.nodeValue===" react-empty: "+nodeID+" "}function getRenderedHostOrTextFromComponent(component){var rendered;while(rendered=component._renderedComponent){component=rendered}return component}function precacheNode(inst,node){var hostInst=getRenderedHostOrTextFromComponent(inst);hostInst._hostNode=node;node[internalInstanceKey]=hostInst}function uncacheNode(inst){var node=inst._hostNode;if(node){delete node[internalInstanceKey];inst._hostNode=null}}function precacheChildNodes(inst,node){if(inst._flags&Flags.hasCachedChildNodes){return}var children=inst._renderedChildren;var childNode=node.firstChild;outer:for(var name in children){if(!children.hasOwnProperty(name)){continue}var childInst=children[name];var childID=getRenderedHostOrTextFromComponent(childInst)._domID;if(childID===0){continue}for(;childNode!==null;childNode=childNode.nextSibling){if(shouldPrecacheNode(childNode,childID)){precacheNode(childInst,childNode);continue outer}}true?process.env.NODE_ENV!=="production"?invariant(false,"Unable to find element with ID %s.",childID):_prodInvariant("32",childID):void 0}inst._flags|=Flags.hasCachedChildNodes}function getClosestInstanceFromNode(node){if(node[internalInstanceKey]){return node[internalInstanceKey]}var parents=[];while(!node[internalInstanceKey]){parents.push(node);if(node.parentNode){node=node.parentNode}else{return null}}var closest;var inst;for(;node&&(inst=node[internalInstanceKey]);node=parents.pop()){closest=inst;if(parents.length){precacheChildNodes(inst,node)}}return closest}function getInstanceFromNode(node){var inst=getClosestInstanceFromNode(node);if(inst!=null&&inst._hostNode===node){return inst}else{return null}}function getNodeFromInstance(inst){!(inst._hostNode!==undefined)?process.env.NODE_ENV!=="production"?invariant(false,"getNodeFromInstance: Invalid argument."):_prodInvariant("33"):void 0;if(inst._hostNode){return inst._hostNode}var parents=[];while(!inst._hostNode){parents.push(inst);!inst._hostParent?process.env.NODE_ENV!=="production"?invariant(false,"React DOM tree root should always have a node reference."):_prodInvariant("34"):void 0;inst=inst._hostParent}for(;parents.length;inst=parents.pop()){precacheChildNodes(inst,inst._hostNode)}return inst._hostNode}var ReactDOMComponentTree={getClosestInstanceFromNode:getClosestInstanceFromNode,getInstanceFromNode:getInstanceFromNode,getNodeFromInstance:getNodeFromInstance,precacheChildNodes:precacheChildNodes,precacheNode:precacheNode,uncacheNode:uncacheNode};module.exports=ReactDOMComponentTree}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var symbol_table_1=__webpack_require__(34);var Builder;(function(Builder){Builder.core=symbol_table_1.default.core;Builder.struct=symbol_table_1.default.structure;function atomName(s){return Builder.struct.type.atomName([s])}Builder.atomName=atomName;function es(s){return Builder.struct.type.elementSymbol([s])}Builder.es=es;function list(){var xs=[];for(var _i=0;_i<arguments.length;_i++){xs[_i]=arguments[_i]}return Builder.core.type.list(xs)}Builder.list=list;function set(){var xs=[];for(var _i=0;_i<arguments.length;_i++){xs[_i]=arguments[_i]}return Builder.core.type.set(xs)}Builder.set=set;function fn(x){return Builder.core.ctrl.fn([x])}Builder.fn=fn;function evaluate(x){return Builder.core.ctrl.eval([x])}Builder.evaluate=evaluate;var _acp=symbol_table_1.default.structure.atomProperty.core,_ammp=symbol_table_1.default.structure.atomProperty.macromolecular,_atp=symbol_table_1.default.structure.atomProperty.topology;function acp(p){return _acp[p]()}Builder.acp=acp;function atp(p){return _atp[p]()}Builder.atp=atp;function ammp(p){return _ammp[p]()}Builder.ammp=ammp;var _aps=symbol_table_1.default.structure.atomSet.propertySet;function acpSet(p){return _aps([acp(p)])}Builder.acpSet=acpSet;function atpSet(p){return _aps([atp(p)])}Builder.atpSet=atpSet;function ammpSet(p){return _aps([ammp(p)])}Builder.ammpSet=ammpSet})(Builder||(Builder={}));exports.default=Builder},function(module,exports,__webpack_require__){"use strict";var canUseDOM=!!(typeof window!=="undefined"&&window.document&&window.document.createElement);var ExecutionEnvironment={canUseDOM:canUseDOM,canUseWorkers:typeof Worker!=="undefined",canUseEventListeners:canUseDOM&&!!(window.addEventListener||window.attachEvent),canUseViewport:canUseDOM&&!!window.screen,isInWorker:!canUseDOM};module.exports=ExecutionEnvironment},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function UniqueArrayBuilder(){return{_keys:Object.create(null),array:[]}}exports.UniqueArrayBuilder=UniqueArrayBuilder;(function(UniqueArrayBuilder){function add(_a,key,value){var _keys=_a._keys,array=_a.array;if(_keys[key]===1)return false;_keys[key]=1;array.push(value);return true}UniqueArrayBuilder.add=add})(UniqueArrayBuilder=exports.UniqueArrayBuilder||(exports.UniqueArrayBuilder={}));function _ascSort(a,b){return a-b}function sortAsc(array){Array.prototype.sort.call(array,_ascSort);return array}exports.sortAsc=sortAsc;function createMapObject(){var map=Object.create(null);map["__"]=void 0;delete map["__"];return map}var FastMap;(function(FastMap){function forEach(data,f,ctx){for(var _i=0,_a=Object.keys(data);_i<_a.length;_i++){var key=_a[_i];var v=data[key];if(v===void 0)continue;f(v,key,ctx)}}var fastMap={set:function(key,v){if(this.data[key]===void 0&&v!==void 0){this.size++}this.data[key]=v},get:function(key){return this.data[key]},delete:function(key){if(this.data[key]===void 0)return false;delete this.data[key];this.size--;return true},has:function(key){return this.data[key]!==void 0},clear:function(){this.data=createMapObject();this.size=0},forEach:function(f,ctx){forEach(this.data,f,ctx!==void 0?ctx:void 0)}};function create(){var ret=Object.create(fastMap);ret.data=createMapObject();ret.size=0;return ret}FastMap.create=create;function ofArray(data){var ret=create();for(var _i=0,data_1=data;_i<data_1.length;_i++){var xs=data_1[_i];ret.set(xs[0],xs[1])}return ret}FastMap.ofArray=ofArray;function ofObject(data){var ret=create();for(var _i=0,_a=Object.keys(data);_i<_a.length;_i++){var key=_a[_i];var v=data[key];ret.set(key,v)}return ret}FastMap.ofObject=ofObject})(FastMap=exports.FastMap||(exports.FastMap={}));var FastSet;(function(FastSet){function forEach(data,f,ctx){for(var _i=0,_a=Object.keys(data);_i<_a.length;_i++){var p=_a[_i];if(data[p]!==null)continue;if(f(p,ctx)===false)break}}var fastSet={add:function(key){if(this.data[key]===null)return false;this.data[key]=null;this.size++;return true},delete:function(key){if(this.data[key]!==null)return false;delete this.data[key];this.size--;return true},has:function(key){return this.data[key]===null},clear:function(){this.data=createMapObject();this.size=0},forEach:function(f,ctx){forEach(this.data,f,ctx!==void 0?ctx:void 0)}};function create(){var ret=Object.create(fastSet);ret.data=createMapObject();ret.size=0;return ret}FastSet.create=create;function ofArray(xs){var ret=create();for(var i=0,l=xs.length;i<l;i++){ret.add(xs[i])}return ret}FastSet.ofArray=ofArray;function isSubset(a,b){var _ctx={b:b,count:0};a.forEach(function(e,ctx){if(!ctx.b.has(e))return false;ctx.count++},_ctx);return _ctx.count===a.size}FastSet.isSubset=isSubset})(FastSet=exports.FastSet||(exports.FastSet={}))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(29);var ReactCurrentOwner=__webpack_require__(15);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);function isNative(fn){var funcToString=Function.prototype.toString;var hasOwnProperty=Object.prototype.hasOwnProperty;var reIsNative=RegExp("^"+funcToString.call(hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");try{var source=funcToString.call(fn);return reIsNative.test(source)}catch(err){return false}}var canUseCollections=typeof Array.from==="function"&&typeof Map==="function"&&isNative(Map)&&Map.prototype!=null&&typeof Map.prototype.keys==="function"&&isNative(Map.prototype.keys)&&typeof Set==="function"&&isNative(Set)&&Set.prototype!=null&&typeof Set.prototype.keys==="function"&&isNative(Set.prototype.keys);var setItem;var getItem;var removeItem;var getItemIDs;var addRoot;var removeRoot;var getRootIDs;if(canUseCollections){var itemMap=new Map;var rootIDSet=new Set;setItem=function(id,item){itemMap.set(id,item)};getItem=function(id){return itemMap.get(id)};removeItem=function(id){itemMap["delete"](id)};getItemIDs=function(){return Array.from(itemMap.keys())};addRoot=function(id){rootIDSet.add(id)};removeRoot=function(id){rootIDSet["delete"](id)};getRootIDs=function(){return Array.from(rootIDSet.keys())}}else{var itemByKey={};var rootByKey={};var getKeyFromID=function(id){return"."+id};var getIDFromKey=function(key){return parseInt(key.substr(1),10)};setItem=function(id,item){var key=getKeyFromID(id);itemByKey[key]=item};getItem=function(id){var key=getKeyFromID(id);return itemByKey[key]};removeItem=function(id){var key=getKeyFromID(id);delete itemByKey[key]};getItemIDs=function(){return Object.keys(itemByKey).map(getIDFromKey)};addRoot=function(id){var key=getKeyFromID(id);rootByKey[key]=true};removeRoot=function(id){var key=getKeyFromID(id);delete rootByKey[key]};getRootIDs=function(){return Object.keys(rootByKey).map(getIDFromKey)}}var unmountedIDs=[];function purgeDeep(id){var item=getItem(id);if(item){var childIDs=item.childIDs;removeItem(id);childIDs.forEach(purgeDeep)}}function describeComponentFrame(name,source,ownerName){return"\n    in "+(name||"Unknown")+(source?" (at "+source.fileName.replace(/^.*[\\\/]/,"")+":"+source.lineNumber+")":ownerName?" (created by "+ownerName+")":"")}function getDisplayName(element){if(element==null){return"#empty"}else if(typeof element==="string"||typeof element==="number"){return"#text"}else if(typeof element.type==="string"){return element.type}else{return element.type.displayName||element.type.name||"Unknown"}}function describeID(id){var name=ReactComponentTreeHook.getDisplayName(id);var element=ReactComponentTreeHook.getElement(id);var ownerID=ReactComponentTreeHook.getOwnerID(id);var ownerName;if(ownerID){ownerName=ReactComponentTreeHook.getDisplayName(ownerID)}process.env.NODE_ENV!=="production"?warning(element,"ReactComponentTreeHook: Missing React element for debugID %s when "+"building stack",id):void 0;return describeComponentFrame(name,element&&element._source,ownerName)}var ReactComponentTreeHook={onSetChildren:function(id,nextChildIDs){var item=getItem(id);!item?process.env.NODE_ENV!=="production"?invariant(false,"Item must have been set"):_prodInvariant("144"):void 0;item.childIDs=nextChildIDs;for(var i=0;i<nextChildIDs.length;i++){var nextChildID=nextChildIDs[i];var nextChild=getItem(nextChildID);!nextChild?process.env.NODE_ENV!=="production"?invariant(false,"Expected hook events to fire for the child before its parent includes it in onSetChildren()."):_prodInvariant("140"):void 0;!(nextChild.childIDs!=null||typeof nextChild.element!=="object"||nextChild.element==null)?process.env.NODE_ENV!=="production"?invariant(false,"Expected onSetChildren() to fire for a container child before its parent includes it in onSetChildren()."):_prodInvariant("141"):void 0;!nextChild.isMounted?process.env.NODE_ENV!=="production"?invariant(false,"Expected onMountComponent() to fire for the child before its parent includes it in onSetChildren()."):_prodInvariant("71"):void 0;if(nextChild.parentID==null){nextChild.parentID=id}!(nextChild.parentID===id)?process.env.NODE_ENV!=="production"?invariant(false,"Expected onBeforeMountComponent() parent and onSetChildren() to be consistent (%s has parents %s and %s).",nextChildID,nextChild.parentID,id):_prodInvariant("142",nextChildID,nextChild.parentID,id):void 0}},onBeforeMountComponent:function(id,element,parentID){var item={element:element,parentID:parentID,text:null,childIDs:[],isMounted:false,updateCount:0};setItem(id,item)},onBeforeUpdateComponent:function(id,element){var item=getItem(id);if(!item||!item.isMounted){return}item.element=element},onMountComponent:function(id){var item=getItem(id);!item?process.env.NODE_ENV!=="production"?invariant(false,"Item must have been set"):_prodInvariant("144"):void 0;item.isMounted=true;var isRoot=item.parentID===0;if(isRoot){addRoot(id)}},onUpdateComponent:function(id){var item=getItem(id);if(!item||!item.isMounted){return}item.updateCount++},onUnmountComponent:function(id){var item=getItem(id);if(item){item.isMounted=false;var isRoot=item.parentID===0;if(isRoot){removeRoot(id)}}unmountedIDs.push(id)},purgeUnmountedComponents:function(){if(ReactComponentTreeHook._preventPurging){return}for(var i=0;i<unmountedIDs.length;i++){var id=unmountedIDs[i];purgeDeep(id)}unmountedIDs.length=0},isMounted:function(id){var item=getItem(id);return item?item.isMounted:false},getCurrentStackAddendum:function(topElement){var info="";if(topElement){var name=getDisplayName(topElement);var owner=topElement._owner;info+=describeComponentFrame(name,topElement._source,owner&&owner.getName())}var currentOwner=ReactCurrentOwner.current;var id=currentOwner&&currentOwner._debugID;info+=ReactComponentTreeHook.getStackAddendumByID(id);return info},getStackAddendumByID:function(id){var info="";while(id){info+=describeID(id);id=ReactComponentTreeHook.getParentID(id)}return info},getChildIDs:function(id){var item=getItem(id);return item?item.childIDs:[]},getDisplayName:function(id){var element=ReactComponentTreeHook.getElement(id);if(!element){return null}return getDisplayName(element)},getElement:function(id){var item=getItem(id);return item?item.element:null},getOwnerID:function(id){var element=ReactComponentTreeHook.getElement(id);if(!element||!element._owner){return null}return element._owner._debugID},getParentID:function(id){var item=getItem(id);return item?item.parentID:null},getSource:function(id){var item=getItem(id);var element=item?item.element:null;var source=element!=null?element._source:null;return source},getText:function(id){var element=ReactComponentTreeHook.getElement(id);if(typeof element==="string"){return element}else if(typeof element==="number"){return""+element}else{return null}},getUpdateCount:function(id){var item=getItem(id);return item?item.updateCount:0},getRootIDs:getRootIDs,getRegisteredIDs:getItemIDs,pushNonStandardWarningStack:function(isCreatingElement,currentSource){if(typeof console.reactStack!=="function"){return}var stack=[];var currentOwner=ReactCurrentOwner.current;var id=currentOwner&&currentOwner._debugID;try{if(isCreatingElement){stack.push({name:id?ReactComponentTreeHook.getDisplayName(id):null,fileName:currentSource?currentSource.fileName:null,lineNumber:currentSource?currentSource.lineNumber:null})}while(id){var element=ReactComponentTreeHook.getElement(id);var parentID=ReactComponentTreeHook.getParentID(id);var ownerID=ReactComponentTreeHook.getOwnerID(id);var ownerName=ownerID?ReactComponentTreeHook.getDisplayName(ownerID):null;var source=element&&element._source;stack.push({name:ownerName,fileName:source?source.fileName:null,lineNumber:source?source.lineNumber:null});id=parentID}}catch(err){}console.reactStack(stack)},popNonStandardWarningStack:function(){if(typeof console.reactStackEnd!=="function"){return}console.reactStackEnd()}};module.exports=ReactComponentTreeHook}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function makeEmptyFunction(arg){return function(){return arg}}var emptyFunction=function emptyFunction(){};emptyFunction.thatReturns=makeEmptyFunction;emptyFunction.thatReturnsFalse=makeEmptyFunction(false);emptyFunction.thatReturnsTrue=makeEmptyFunction(true);emptyFunction.thatReturnsNull=makeEmptyFunction(null);emptyFunction.thatReturnsThis=function(){return this};emptyFunction.thatReturnsArgument=function(arg){return arg};module.exports=emptyFunction},function(module,exports,__webpack_require__){(function(global,factory){true?module.exports=factory():typeof define==="function"&&define.amd?define(factory):global.CodeMirror=factory()})(this,function(){"use strict";var userAgent=navigator.userAgent;var platform=navigator.platform;var gecko=/gecko\/\d/i.test(userAgent);var ie_upto10=/MSIE \d/.test(userAgent);var ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent);var edge=/Edge\/(\d+)/.exec(userAgent);var ie=ie_upto10||ie_11up||edge;var ie_version=ie&&(ie_upto10?document.documentMode||6:+(edge||ie_11up)[1]);var webkit=!edge&&/WebKit\//.test(userAgent);var qtwebkit=webkit&&/Qt\/\d+\.\d+/.test(userAgent);var chrome=!edge&&/Chrome\//.test(userAgent);var presto=/Opera\//.test(userAgent);var safari=/Apple Computer/.test(navigator.vendor);var mac_geMountainLion=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent);var phantom=/PhantomJS/.test(userAgent);var ios=!edge&&/AppleWebKit/.test(userAgent)&&/Mobile\/\w+/.test(userAgent);var android=/Android/.test(userAgent);var mobile=ios||android||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent);var mac=ios||/Mac/.test(platform);var chromeOS=/\bCrOS\b/.test(userAgent);var windows=/win/i.test(platform);var presto_version=presto&&userAgent.match(/Version\/(\d*\.\d*)/);if(presto_version){presto_version=Number(presto_version[1])}if(presto_version&&presto_version>=15){presto=false;webkit=true}var flipCtrlCmd=mac&&(qtwebkit||presto&&(presto_version==null||presto_version<12.11));var captureRightClick=gecko||ie&&ie_version>=9;function classTest(cls){return new RegExp("(^|\\s)"+cls+"(?:$|\\s)\\s*")}var rmClass=function(node,cls){var current=node.className;var match=classTest(cls).exec(current);if(match){var after=current.slice(match.index+match[0].length);node.className=current.slice(0,match.index)+(after?match[1]+after:"")}};function removeChildren(e){for(var count=e.childNodes.length;count>0;--count){e.removeChild(e.firstChild)}return e}function removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e)}function elt(tag,content,className,style){var e=document.createElement(tag);if(className){e.className=className}if(style){e.style.cssText=style}if(typeof content=="string"){e.appendChild(document.createTextNode(content))}else if(content){for(var i=0;i<content.length;++i){e.appendChild(content[i])}}return e}function eltP(tag,content,className,style){var e=elt(tag,content,className,style);e.setAttribute("role","presentation");return e}var range;if(document.createRange){range=function(node,start,end,endNode){var r=document.createRange();r.setEnd(endNode||node,end);r.setStart(node,start);return r}}else{range=function(node,start,end){var r=document.body.createTextRange();try{r.moveToElementText(node.parentNode)}catch(e){return r}r.collapse(true);r.moveEnd("character",end);r.moveStart("character",start);return r}}function contains(parent,child){if(child.nodeType==3){child=child.parentNode}if(parent.contains){return parent.contains(child)}do{if(child.nodeType==11){child=child.host}if(child==parent){return true}}while(child=child.parentNode)}function activeElt(){var activeElement;try{activeElement=document.activeElement}catch(e){activeElement=document.body||null}while(activeElement&&activeElement.shadowRoot&&activeElement.shadowRoot.activeElement){activeElement=activeElement.shadowRoot.activeElement}return activeElement}function addClass(node,cls){var current=node.className;if(!classTest(cls).test(current)){node.className+=(current?" ":"")+cls}}function joinClasses(a,b){var as=a.split(" ");for(var i=0;i<as.length;i++){if(as[i]&&!classTest(as[i]).test(b)){b+=" "+as[i]}}return b}var selectInput=function(node){node.select()};if(ios){selectInput=function(node){node.selectionStart=0;node.selectionEnd=node.value.length}}else if(ie){selectInput=function(node){try{node.select()}catch(_e){}}}function bind(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}}function copyObj(obj,target,overwrite){if(!target){target={}}for(var prop in obj){if(obj.hasOwnProperty(prop)&&(overwrite!==false||!target.hasOwnProperty(prop))){target[prop]=obj[prop]}}return target}function countColumn(string,end,tabSize,startIndex,startValue){if(end==null){end=string.search(/[^\s\u00a0]/);if(end==-1){end=string.length}}for(var i=startIndex||0,n=startValue||0;;){var nextTab=string.indexOf("\t",i);if(nextTab<0||nextTab>=end){return n+(end-i)}n+=nextTab-i;n+=tabSize-n%tabSize;i=nextTab+1}}var Delayed=function(){this.id=null};Delayed.prototype.set=function(ms,f){clearTimeout(this.id);this.id=setTimeout(f,ms)};function indexOf(array,elt){for(var i=0;i<array.length;++i){if(array[i]==elt){return i}}return-1}var scrollerGap=30;var Pass={toString:function(){return"CodeMirror.Pass"}};var sel_dontScroll={scroll:false};var sel_mouse={origin:"*mouse"};var sel_move={origin:"+move"};function findColumn(string,goal,tabSize){for(var pos=0,col=0;;){var nextTab=string.indexOf("\t",pos);if(nextTab==-1){nextTab=string.length}var skipped=nextTab-pos;if(nextTab==string.length||col+skipped>=goal){return pos+Math.min(skipped,goal-col)}col+=nextTab-pos;col+=tabSize-col%tabSize;pos=nextTab+1;if(col>=goal){return pos}}}var spaceStrs=[""];function spaceStr(n){while(spaceStrs.length<=n){spaceStrs.push(lst(spaceStrs)+" ")}return spaceStrs[n]}function lst(arr){return arr[arr.length-1]}function map(array,f){var out=[];for(var i=0;i<array.length;i++){out[i]=f(array[i],i)}return out}function insertSorted(array,value,score){var pos=0,priority=score(value);while(pos<array.length&&score(array[pos])<=priority){pos++}array.splice(pos,0,value)}function nothing(){}function createObj(base,props){var inst;if(Object.create){inst=Object.create(base)}else{nothing.prototype=base;inst=new nothing}if(props){copyObj(props,inst)}return inst}var nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;function isWordCharBasic(ch){return/\w/.test(ch)||ch>""&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}function isWordChar(ch,helper){if(!helper){return isWordCharBasic(ch)}if(helper.source.indexOf("\\w")>-1&&isWordCharBasic(ch)){return true}return helper.test(ch)}function isEmpty(obj){for(var n in obj){if(obj.hasOwnProperty(n)&&obj[n]){return false}}return true}var extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;function isExtendingChar(ch){return ch.charCodeAt(0)>=768&&extendingChars.test(ch)}function skipExtendingChars(str,pos,dir){while((dir<0?pos>0:pos<str.length)&&isExtendingChar(str.charAt(pos))){pos+=dir}return pos}function findFirst(pred,from,to){for(;;){if(Math.abs(from-to)<=1){return pred(from)?from:to}var mid=Math.floor((from+to)/2);if(pred(mid)){to=mid}else{from=mid}}}function Display(place,doc,input){var d=this;this.input=input;d.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler");d.scrollbarFiller.setAttribute("cm-not-content","true");d.gutterFiller=elt("div",null,"CodeMirror-gutter-filler");d.gutterFiller.setAttribute("cm-not-content","true");d.lineDiv=eltP("div",null,"CodeMirror-code");d.selectionDiv=elt("div",null,null,"position: relative; z-index: 1");d.cursorDiv=elt("div",null,"CodeMirror-cursors");d.measure=elt("div",null,"CodeMirror-measure");d.lineMeasure=elt("div",null,"CodeMirror-measure");d.lineSpace=eltP("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none");var lines=eltP("div",[d.lineSpace],"CodeMirror-lines");d.mover=elt("div",[lines],null,"position: relative");d.sizer=elt("div",[d.mover],"CodeMirror-sizer");d.sizerWidth=null;d.heightForcer=elt("div",null,null,"position: absolute; height: "+scrollerGap+"px; width: 1px;");d.gutters=elt("div",null,"CodeMirror-gutters");d.lineGutter=null;d.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll");d.scroller.setAttribute("tabIndex","-1");d.wrapper=elt("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror");if(ie&&ie_version<8){d.gutters.style.zIndex=-1;d.scroller.style.paddingRight=0}if(!webkit&&!(gecko&&mobile)){d.scroller.draggable=true}if(place){if(place.appendChild){place.appendChild(d.wrapper)}else{place(d.wrapper)}}d.viewFrom=d.viewTo=doc.first;d.reportedViewFrom=d.reportedViewTo=doc.first;d.view=[];d.renderedView=null;d.externalMeasured=null;d.viewOffset=0;d.lastWrapHeight=d.lastWrapWidth=0;d.updateLineNumbers=null;d.nativeBarWidth=d.barHeight=d.barWidth=0;d.scrollbarsClipped=false;d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null;d.alignWidgets=false;d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null;d.maxLine=null;d.maxLineLength=0;d.maxLineChanged=false;d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null;d.shift=false;d.selForContextMenu=null;d.activeTouch=null;input.init(d)}function getLine(doc,n){n-=doc.first;if(n<0||n>=doc.size){throw new Error("There is no line "+(n+doc.first)+" in the document.")}var chunk=doc;while(!chunk.lines){for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}n-=sz}}return chunk.lines[n]}function getBetween(doc,start,end){var out=[],n=start.line;doc.iter(start.line,end.line+1,function(line){var text=line.text;if(n==end.line){text=text.slice(0,end.ch)}if(n==start.line){text=text.slice(start.ch)}out.push(text);++n});return out}function getLines(doc,from,to){var out=[];doc.iter(from,to,function(line){out.push(line.text)});return out}function updateLineHeight(line,height){var diff=height-line.height;if(diff){for(var n=line;n;n=n.parent){n.height+=diff}}}function lineNo(line){if(line.parent==null){return null}var cur=line.parent,no=indexOf(cur.lines,line);for(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent){for(var i=0;;++i){if(chunk.children[i]==cur){break}no+=chunk.children[i].chunkSize()}}return no+cur.first}function lineAtHeight(chunk,h){var n=chunk.first;outer:do{for(var i$1=0;i$1<chunk.children.length;++i$1){var child=chunk.children[i$1],ch=child.height;if(h<ch){chunk=child;continue outer}h-=ch;n+=child.chunkSize()}return n}while(!chunk.lines);var i=0;for(;i<chunk.lines.length;++i){var line=chunk.lines[i],lh=line.height;if(h<lh){break}h-=lh}return n+i}function isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size}function lineNumberFor(options,i){return String(options.lineNumberFormatter(i+options.firstLineNumber))}function Pos(line,ch,sticky){if(sticky===void 0)sticky=null;if(!(this instanceof Pos)){return new Pos(line,ch,sticky)}this.line=line;this.ch=ch;this.sticky=sticky}function cmp(a,b){return a.line-b.line||a.ch-b.ch}function equalCursorPos(a,b){return a.sticky==b.sticky&&cmp(a,b)==0}function copyPos(x){return Pos(x.line,x.ch)}function maxPos(a,b){return cmp(a,b)<0?b:a}function minPos(a,b){return cmp(a,b)<0?a:b}function clipLine(doc,n){return Math.max(doc.first,Math.min(n,doc.first+doc.size-1))}function clipPos(doc,pos){if(pos.line<doc.first){return Pos(doc.first,0)}var last=doc.first+doc.size-1;if(pos.line>last){return Pos(last,getLine(doc,last).text.length)}return clipToLen(pos,getLine(doc,pos.line).text.length)}function clipToLen(pos,linelen){var ch=pos.ch;if(ch==null||ch>linelen){return Pos(pos.line,linelen)}else if(ch<0){return Pos(pos.line,0)}else{return pos}}function clipPosArray(doc,array){var out=[];for(var i=0;i<array.length;i++){out[i]=clipPos(doc,array[i])}return out}var sawReadOnlySpans=false;var sawCollapsedSpans=false;function seeReadOnlySpans(){sawReadOnlySpans=true}function seeCollapsedSpans(){sawCollapsedSpans=true}function MarkedSpan(marker,from,to){this.marker=marker;this.from=from;this.to=to}function getMarkedSpanFor(spans,marker){if(spans){for(var i=0;i<spans.length;++i){var span=spans[i];if(span.marker==marker){return span}}}}function removeMarkedSpan(spans,span){var r;for(var i=0;i<spans.length;++i){if(spans[i]!=span){(r||(r=[])).push(spans[i])}}return r}function addMarkedSpan(line,span){line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span];span.marker.attachLine(line)}function markedSpansBefore(old,startCh,isInsert){var nw;if(old){for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker;var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh);if(startsBefore||span.from==startCh&&marker.type=="bookmark"&&(!isInsert||!span.marker.insertLeft)){var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=startCh:span.to>startCh);(nw||(nw=[])).push(new MarkedSpan(marker,span.from,endsAfter?null:span.to))}}}return nw}function markedSpansAfter(old,endCh,isInsert){var nw;if(old){for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker;var endsAfter=span.to==null||(marker.inclusiveRight?span.to>=endCh:span.to>endCh);if(endsAfter||span.from==endCh&&marker.type=="bookmark"&&(!isInsert||span.marker.insertLeft)){var startsBefore=span.from==null||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh);(nw||(nw=[])).push(new MarkedSpan(marker,startsBefore?null:span.from-endCh,span.to==null?null:span.to-endCh))}}}return nw}function stretchSpansOverChange(doc,change){if(change.full){return null}var oldFirst=isLine(doc,change.from.line)&&getLine(doc,change.from.line).markedSpans;var oldLast=isLine(doc,change.to.line)&&getLine(doc,change.to.line).markedSpans;if(!oldFirst&&!oldLast){return null}var startCh=change.from.ch,endCh=change.to.ch,isInsert=cmp(change.from,change.to)==0;var first=markedSpansBefore(oldFirst,startCh,isInsert);var last=markedSpansAfter(oldLast,endCh,isInsert);var sameLine=change.text.length==1,offset=lst(change.text).length+(sameLine?startCh:0);if(first){for(var i=0;i<first.length;++i){var span=first[i];if(span.to==null){var found=getMarkedSpanFor(last,span.marker);if(!found){span.to=startCh}else if(sameLine){span.to=found.to==null?null:found.to+offset}}}}if(last){for(var i$1=0;i$1<last.length;++i$1){var span$1=last[i$1];if(span$1.to!=null){span$1.to+=offset}if(span$1.from==null){var found$1=getMarkedSpanFor(first,span$1.marker);if(!found$1){span$1.from=offset;if(sameLine){(first||(first=[])).push(span$1)}}}else{span$1.from+=offset;if(sameLine){(first||(first=[])).push(span$1)}}}}if(first){first=clearEmptySpans(first)}if(last&&last!=first){last=clearEmptySpans(last)}var newMarkers=[first];if(!sameLine){var gap=change.text.length-2,gapMarkers;if(gap>0&&first){for(var i$2=0;i$2<first.length;++i$2){if(first[i$2].to==null){(gapMarkers||(gapMarkers=[])).push(new MarkedSpan(first[i$2].marker,null,null))}}}for(var i$3=0;i$3<gap;++i$3){newMarkers.push(gapMarkers)}newMarkers.push(last)}return newMarkers}function clearEmptySpans(spans){for(var i=0;i<spans.length;++i){var span=spans[i];if(span.from!=null&&span.from==span.to&&span.marker.clearWhenEmpty!==false){spans.splice(i--,1)}}if(!spans.length){return null}return spans}function removeReadOnlyRanges(doc,from,to){var markers=null;doc.iter(from.line,to.line+1,function(line){if(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var mark=line.markedSpans[i].marker;if(mark.readOnly&&(!markers||indexOf(markers,mark)==-1)){(markers||(markers=[])).push(mark)}}}});if(!markers){return null}var parts=[{from:from,to:to}];for(var i=0;i<markers.length;++i){var mk=markers[i],m=mk.find(0);for(var j=0;j<parts.length;++j){var p=parts[j];if(cmp(p.to,m.from)<0||cmp(p.from,m.to)>0){continue}var newParts=[j,1],dfrom=cmp(p.from,m.from),dto=cmp(p.to,m.to);if(dfrom<0||!mk.inclusiveLeft&&!dfrom){newParts.push({from:p.from,to:m.from})}if(dto>0||!mk.inclusiveRight&&!dto){newParts.push({from:m.to,to:p.to})}parts.splice.apply(parts,newParts);j+=newParts.length-3}}return parts}function detachMarkedSpans(line){var spans=line.markedSpans;if(!spans){return}for(var i=0;i<spans.length;++i){spans[i].marker.detachLine(line)}line.markedSpans=null}function attachMarkedSpans(line,spans){if(!spans){return}for(var i=0;i<spans.length;++i){spans[i].marker.attachLine(line)}line.markedSpans=spans}function extraLeft(marker){return marker.inclusiveLeft?-1:0}function extraRight(marker){return marker.inclusiveRight?1:0}function compareCollapsedMarkers(a,b){var lenDiff=a.lines.length-b.lines.length;if(lenDiff!=0){return lenDiff}var aPos=a.find(),bPos=b.find();var fromCmp=cmp(aPos.from,bPos.from)||extraLeft(a)-extraLeft(b);if(fromCmp){return-fromCmp}var toCmp=cmp(aPos.to,bPos.to)||extraRight(a)-extraRight(b);if(toCmp){return toCmp}return b.id-a.id}function collapsedSpanAtSide(line,start){var sps=sawCollapsedSpans&&line.markedSpans,found;if(sps){for(var sp=void 0,i=0;i<sps.length;++i){sp=sps[i];if(sp.marker.collapsed&&(start?sp.from:sp.to)==null&&(!found||compareCollapsedMarkers(found,sp.marker)<0)){found=sp.marker}}}return found}function collapsedSpanAtStart(line){return collapsedSpanAtSide(line,true)}function collapsedSpanAtEnd(line){return collapsedSpanAtSide(line,false)}function conflictingCollapsedRange(doc,lineNo$$1,from,to,marker){var line=getLine(doc,lineNo$$1);var sps=sawCollapsedSpans&&line.markedSpans;if(sps){for(var i=0;i<sps.length;++i){var sp=sps[i];if(!sp.marker.collapsed){continue}var found=sp.marker.find(0);var fromCmp=cmp(found.from,from)||extraLeft(sp.marker)-extraLeft(marker);var toCmp=cmp(found.to,to)||extraRight(sp.marker)-extraRight(marker);if(fromCmp>=0&&toCmp<=0||fromCmp<=0&&toCmp>=0){continue}if(fromCmp<=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.to,from)>=0:cmp(found.to,from)>0)||fromCmp>=0&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?cmp(found.from,to)<=0:cmp(found.from,to)<0)){return true}}}}function visualLine(line){var merged;while(merged=collapsedSpanAtStart(line)){line=merged.find(-1,true).line}return line}function visualLineEnd(line){var merged;while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line}return line}function visualLineContinued(line){var merged,lines;while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line;(lines||(lines=[])).push(line)}return lines}function visualLineNo(doc,lineN){var line=getLine(doc,lineN),vis=visualLine(line);if(line==vis){return lineN}return lineNo(vis)}function visualLineEndNo(doc,lineN){if(lineN>doc.lastLine()){return lineN}var line=getLine(doc,lineN),merged;if(!lineIsHidden(doc,line)){return lineN}while(merged=collapsedSpanAtEnd(line)){line=merged.find(1,true).line}return lineNo(line)+1}function lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans;if(sps){for(var sp=void 0,i=0;i<sps.length;++i){sp=sps[i];if(!sp.marker.collapsed){continue}if(sp.from==null){return true}if(sp.marker.widgetNode){continue}if(sp.from==0&&sp.marker.inclusiveLeft&&lineIsHiddenInner(doc,line,sp)){return true}}}}function lineIsHiddenInner(doc,line,span){if(span.to==null){var end=span.marker.find(1,true);return lineIsHiddenInner(doc,end.line,getMarkedSpanFor(end.line.markedSpans,span.marker))}if(span.marker.inclusiveRight&&span.to==line.text.length){return true}for(var sp=void 0,i=0;i<line.markedSpans.length;++i){sp=line.markedSpans[i];if(sp.marker.collapsed&&!sp.marker.widgetNode&&sp.from==span.to&&(sp.to==null||sp.to!=span.from)&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp)){return true}}}function heightAtLine(lineObj){lineObj=visualLine(lineObj);var h=0,chunk=lineObj.parent;for(var i=0;i<chunk.lines.length;++i){var line=chunk.lines[i];if(line==lineObj){break}else{h+=line.height}}for(var p=chunk.parent;p;chunk=p,p=chunk.parent){for(var i$1=0;i$1<p.children.length;++i$1){var cur=p.children[i$1];if(cur==chunk){break}else{h+=cur.height}}}return h}function lineLength(line){if(line.height==0){return 0}var len=line.text.length,merged,cur=line;while(merged=collapsedSpanAtStart(cur)){var found=merged.find(0,true);cur=found.from.line;len+=found.from.ch-found.to.ch}cur=line;while(merged=collapsedSpanAtEnd(cur)){var found$1=merged.find(0,true);len-=cur.text.length-found$1.from.ch;cur=found$1.to.line;len+=cur.text.length-found$1.to.ch}return len}function findMaxLine(cm){var d=cm.display,doc=cm.doc;d.maxLine=getLine(doc,doc.first);d.maxLineLength=lineLength(d.maxLine);d.maxLineChanged=true;doc.iter(function(line){var len=lineLength(line);if(len>d.maxLineLength){d.maxLineLength=len;d.maxLine=line}})}function iterateBidiSections(order,from,to,f){if(!order){return f(from,to,"ltr")}var found=false;for(var i=0;i<order.length;++i){var part=order[i];if(part.from<to&&part.to>from||from==to&&part.to==from){f(Math.max(part.from,from),Math.min(part.to,to),part.level==1?"rtl":"ltr");found=true}}if(!found){f(from,to,"ltr")}}var bidiOther=null;function getBidiPartAt(order,ch,sticky){var found;bidiOther=null;for(var i=0;i<order.length;++i){var cur=order[i];if(cur.from<ch&&cur.to>ch){return i}if(cur.to==ch){if(cur.from!=cur.to&&sticky=="before"){found=i}else{bidiOther=i}}if(cur.from==ch){if(cur.from!=cur.to&&sticky!="before"){found=i}else{bidiOther=i}}}return found!=null?found:bidiOther}var bidiOrdering=function(){var lowTypes="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN";var arabicTypes="nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111";function charType(code){if(code<=247){return lowTypes.charAt(code)}else if(1424<=code&&code<=1524){return"R"}else if(1536<=code&&code<=1785){return arabicTypes.charAt(code-1536)}else if(1774<=code&&code<=2220){return"r"}else if(8192<=code&&code<=8203){return"w"}else if(code==8204){return"b"}else{return"L"}}var bidiRE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;var isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/;function BidiSpan(level,from,to){this.level=level;this.from=from;this.to=to}return function(str,direction){var outerType=direction=="ltr"?"L":"R";if(str.length==0||direction=="ltr"&&!bidiRE.test(str)){return false}var len=str.length,types=[];for(var i=0;i<len;++i){types.push(charType(str.charCodeAt(i)))}for(var i$1=0,prev=outerType;i$1<len;++i$1){var type=types[i$1];if(type=="m"){types[i$1]=prev}else{prev=type}}for(var i$2=0,cur=outerType;i$2<len;++i$2){var type$1=types[i$2];if(type$1=="1"&&cur=="r"){types[i$2]="n"}else if(isStrong.test(type$1)){cur=type$1;if(type$1=="r"){types[i$2]="R"}}}for(var i$3=1,prev$1=types[0];i$3<len-1;++i$3){var type$2=types[i$3];if(type$2=="+"&&prev$1=="1"&&types[i$3+1]=="1"){types[i$3]="1"}else if(type$2==","&&prev$1==types[i$3+1]&&(prev$1=="1"||prev$1=="n")){types[i$3]=prev$1}prev$1=type$2}for(var i$4=0;i$4<len;++i$4){var type$3=types[i$4];if(type$3==","){types[i$4]="N"}else if(type$3=="%"){var end=void 0;for(end=i$4+1;end<len&&types[end]=="%";++end){}var replace=i$4&&types[i$4-1]=="!"||end<len&&types[end]=="1"?"1":"N";for(var j=i$4;j<end;++j){types[j]=replace}i$4=end-1}}for(var i$5=0,cur$1=outerType;i$5<len;++i$5){var type$4=types[i$5];if(cur$1=="L"&&type$4=="1"){types[i$5]="L"}else if(isStrong.test(type$4)){cur$1=type$4}}for(var i$6=0;i$6<len;++i$6){if(isNeutral.test(types[i$6])){var end$1=void 0;for(end$1=i$6+1;end$1<len&&isNeutral.test(types[end$1]);++end$1){}var before=(i$6?types[i$6-1]:outerType)=="L";var after=(end$1<len?types[end$1]:outerType)=="L";var replace$1=before==after?before?"L":"R":outerType;for(var j$1=i$6;j$1<end$1;++j$1){types[j$1]=replace$1}i$6=end$1-1}}var order=[],m;for(var i$7=0;i$7<len;){if(countsAsLeft.test(types[i$7])){var start=i$7;for(++i$7;i$7<len&&countsAsLeft.test(types[i$7]);++i$7){}order.push(new BidiSpan(0,start,i$7))}else{var pos=i$7,at=order.length;for(++i$7;i$7<len&&types[i$7]!="L";++i$7){}for(var j$2=pos;j$2<i$7;){if(countsAsNum.test(types[j$2])){if(pos<j$2){order.splice(at,0,new BidiSpan(1,pos,j$2))}var nstart=j$2;for(++j$2;j$2<i$7&&countsAsNum.test(types[j$2]);++j$2){}order.splice(at,0,new BidiSpan(2,nstart,j$2));pos=j$2}else{++j$2}}if(pos<i$7){order.splice(at,0,new BidiSpan(1,pos,i$7))}}}if(order[0].level==1&&(m=str.match(/^\s+/))){order[0].from=m[0].length;order.unshift(new BidiSpan(0,0,m[0].length))}if(lst(order).level==1&&(m=str.match(/\s+$/))){lst(order).to-=m[0].length;order.push(new BidiSpan(0,len-m[0].length,len))}return direction=="rtl"?order.reverse():order}}();function getOrder(line,direction){var order=line.order;if(order==null){order=line.order=bidiOrdering(line.text,direction)}return order}function moveCharLogically(line,ch,dir){var target=skipExtendingChars(line.text,ch+dir,dir);return target<0||target>line.text.length?null:target}function moveLogically(line,start,dir){var ch=moveCharLogically(line,start.ch,dir);return ch==null?null:new Pos(start.line,ch,dir<0?"after":"before")}function endOfLine(visually,cm,lineObj,lineNo,dir){if(visually){var order=getOrder(lineObj,cm.doc.direction);if(order){var part=dir<0?lst(order):order[0];var moveInStorageOrder=dir<0==(part.level==1);var sticky=moveInStorageOrder?"after":"before";var ch;if(part.level>0){var prep=prepareMeasureForLine(cm,lineObj);ch=dir<0?lineObj.text.length-1:0;var targetTop=measureCharPrepared(cm,prep,ch).top;ch=findFirst(function(ch){return measureCharPrepared(cm,prep,ch).top==targetTop},dir<0==(part.level==1)?part.from:part.to-1,ch);if(sticky=="before"){ch=moveCharLogically(lineObj,ch,1)}}else{ch=dir<0?part.to:part.from}return new Pos(lineNo,ch,sticky)}}return new Pos(lineNo,dir<0?lineObj.text.length:0,dir<0?"before":"after")}function moveVisually(cm,line,start,dir){var bidi=getOrder(line,cm.doc.direction);if(!bidi){return moveLogically(line,start,dir)}if(start.ch>=line.text.length){start.ch=line.text.length;start.sticky="before"}else if(start.ch<=0){start.ch=0;start.sticky="after"}var partPos=getBidiPartAt(bidi,start.ch,start.sticky),part=bidi[partPos];if(cm.doc.direction=="ltr"&&part.level%2==0&&(dir>0?part.to>start.ch:part.from<start.ch)){return moveLogically(line,start,dir)}var mv=function(pos,dir){return moveCharLogically(line,pos instanceof Pos?pos.ch:pos,dir)};var prep;var getWrappedLineExtent=function(ch){if(!cm.options.lineWrapping){return{begin:0,end:line.text.length}}prep=prep||prepareMeasureForLine(cm,line);return wrappedLineExtentChar(cm,line,prep,ch)};var wrappedLineExtent=getWrappedLineExtent(start.sticky=="before"?mv(start,-1):start.ch);if(cm.doc.direction=="rtl"||part.level==1){var moveInStorageOrder=part.level==1==dir<0;var ch=mv(start,moveInStorageOrder?1:-1);if(ch!=null&&(!moveInStorageOrder?ch>=part.from&&ch>=wrappedLineExtent.begin:ch<=part.to&&ch<=wrappedLineExtent.end)){var sticky=moveInStorageOrder?"before":"after";return new Pos(start.line,ch,sticky)}}var searchInVisualLine=function(partPos,dir,wrappedLineExtent){var getRes=function(ch,moveInStorageOrder){return moveInStorageOrder?new Pos(start.line,mv(ch,1),"before"):new Pos(start.line,ch,"after")};for(;partPos>=0&&partPos<bidi.length;partPos+=dir){var part=bidi[partPos];var moveInStorageOrder=dir>0==(part.level!=1);var ch=moveInStorageOrder?wrappedLineExtent.begin:mv(wrappedLineExtent.end,-1);if(part.from<=ch&&ch<part.to){return getRes(ch,moveInStorageOrder)}ch=moveInStorageOrder?part.from:mv(part.to,-1);if(wrappedLineExtent.begin<=ch&&ch<wrappedLineExtent.end){return getRes(ch,moveInStorageOrder)}}};var res=searchInVisualLine(partPos+dir,dir,wrappedLineExtent);if(res){return res}var nextCh=dir>0?wrappedLineExtent.end:mv(wrappedLineExtent.begin,-1);if(nextCh!=null&&!(dir>0&&nextCh==line.text.length)){res=searchInVisualLine(dir>0?0:bidi.length-1,dir,getWrappedLineExtent(nextCh));if(res){return res}}return null}var noHandlers=[];var on=function(emitter,type,f){if(emitter.addEventListener){emitter.addEventListener(type,f,false)}else if(emitter.attachEvent){emitter.attachEvent("on"+type,f)}else{var map$$1=emitter._handlers||(emitter._handlers={});map$$1[type]=(map$$1[type]||noHandlers).concat(f)}};function getHandlers(emitter,type){return emitter._handlers&&emitter._handlers[type]||noHandlers}function off(emitter,type,f){if(emitter.removeEventListener){emitter.removeEventListener(type,f,false)}else if(emitter.detachEvent){emitter.detachEvent("on"+type,f)}else{var map$$1=emitter._handlers,arr=map$$1&&map$$1[type];if(arr){var index=indexOf(arr,f);if(index>-1){map$$1[type]=arr.slice(0,index).concat(arr.slice(index+1))}}}}function signal(emitter,type){var handlers=getHandlers(emitter,type);if(!handlers.length){return}var args=Array.prototype.slice.call(arguments,2);for(var i=0;i<handlers.length;++i){handlers[i].apply(null,args)}}function signalDOMEvent(cm,e,override){if(typeof e=="string"){e={type:e,preventDefault:function(){this.defaultPrevented=true}}}signal(cm,override||e.type,cm,e);return e_defaultPrevented(e)||e.codemirrorIgnore}function signalCursorActivity(cm){var arr=cm._handlers&&cm._handlers.cursorActivity;if(!arr){return}var set=cm.curOp.cursorActivityHandlers||(cm.curOp.cursorActivityHandlers=[]);for(var i=0;i<arr.length;++i){if(indexOf(set,arr[i])==-1){set.push(arr[i])}}}function hasHandler(emitter,type){return getHandlers(emitter,type).length>0}function eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f)};ctor.prototype.off=function(type,f){off(this,type,f)}}function e_preventDefault(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}function e_stopPropagation(e){if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}function e_defaultPrevented(e){return e.defaultPrevented!=null?e.defaultPrevented:e.returnValue==false}function e_stop(e){e_preventDefault(e);e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){var b=e.which;if(b==null){if(e.button&1){b=1}else if(e.button&2){b=3}else if(e.button&4){b=2}}if(mac&&e.ctrlKey&&b==1){b=3}return b}var dragAndDrop=function(){if(ie&&ie_version<9){return false}var div=elt("div");return"draggable"in div||"dragDrop"in div}();var zwspSupported;function zeroWidthElement(measure){if(zwspSupported==null){var test=elt("span","​");removeChildrenAndAdd(measure,elt("span",[test,document.createTextNode("x")]));if(measure.firstChild.offsetHeight!=0){zwspSupported=test.offsetWidth<=1&&test.offsetHeight>2&&!(ie&&ie_version<8)}}var node=zwspSupported?elt("span","​"):elt("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px");node.setAttribute("cm-text","");return node}var badBidiRects;function hasBadBidiRects(measure){if(badBidiRects!=null){return badBidiRects}var txt=removeChildrenAndAdd(measure,document.createTextNode("AخA"));var r0=range(txt,0,1).getBoundingClientRect();var r1=range(txt,1,2).getBoundingClientRect();removeChildren(measure);if(!r0||r0.left==r0.right){return false}return badBidiRects=r1.right-r0.right<3}var splitLinesAuto="\n\nb".split(/\n/).length!=3?function(string){var pos=0,result=[],l=string.length;while(pos<=l){var nl=string.indexOf("\n",pos);if(nl==-1){nl=string.length}var line=string.slice(pos,string.charAt(nl-1)=="\r"?nl-1:nl);var rt=line.indexOf("\r");if(rt!=-1){result.push(line.slice(0,rt));pos+=rt+1}else{result.push(line);pos=nl+1}}return result}:function(string){return string.split(/\r\n?|\n/)};var hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}catch(e){return false}}:function(te){var range$$1;try{range$$1=te.ownerDocument.selection.createRange()}catch(e){}if(!range$$1||range$$1.parentElement()!=te){return false}return range$$1.compareEndPoints("StartToEnd",range$$1)!=0};var hasCopyEvent=function(){var e=elt("div");if("oncopy"in e){return true}e.setAttribute("oncopy","return;");return typeof e.oncopy=="function"}();var badZoomedRects=null;function hasBadZoomedRects(measure){if(badZoomedRects!=null){return badZoomedRects}var node=removeChildrenAndAdd(measure,elt("span","x"));var normal=node.getBoundingClientRect();var fromRange=range(node,0,1).getBoundingClientRect();return badZoomedRects=Math.abs(normal.left-fromRange.left)>1}var modes={};var mimeModes={};function defineMode(name,mode){if(arguments.length>2){mode.dependencies=Array.prototype.slice.call(arguments,2)}modes[name]=mode}function defineMIME(mime,spec){mimeModes[mime]=spec}function resolveMode(spec){if(typeof spec=="string"&&mimeModes.hasOwnProperty(spec)){spec=mimeModes[spec]}else if(spec&&typeof spec.name=="string"&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name];if(typeof found=="string"){found={name:found}}spec=createObj(found,spec);spec.name=found.name}else if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec)){return resolveMode("application/xml")}else if(typeof spec=="string"&&/^[\w\-]+\/[\w\-]+\+json$/.test(spec)){return resolveMode("application/json")}if(typeof spec=="string"){return{name:spec}}else{return spec||{name:"null"}}}function getMode(options,spec){spec=resolveMode(spec);var mfactory=modes[spec.name];if(!mfactory){return getMode(options,"text/plain")}var modeObj=mfactory(options,spec);if(modeExtensions.hasOwnProperty(spec.name)){var exts=modeExtensions[spec.name];for(var prop in exts){if(!exts.hasOwnProperty(prop)){continue}if(modeObj.hasOwnProperty(prop)){modeObj["_"+prop]=modeObj[prop]}modeObj[prop]=exts[prop]}}modeObj.name=spec.name;if(spec.helperType){modeObj.helperType=spec.helperType}if(spec.modeProps){for(var prop$1 in spec.modeProps){modeObj[prop$1]=spec.modeProps[prop$1]}}return modeObj}var modeExtensions={};function extendMode(mode,properties){var exts=modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:modeExtensions[mode]={};copyObj(properties,exts)}function copyState(mode,state){if(state===true){return state}if(mode.copyState){return mode.copyState(state)}var nstate={};for(var n in state){var val=state[n];if(val instanceof Array){val=val.concat([])}nstate[n]=val}return nstate}function innerMode(mode,state){var info;while(mode.innerMode){info=mode.innerMode(state);if(!info||info.mode==mode){break}state=info.state;mode=info.mode}return info||{mode:mode,state:state}}function startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):true}var StringStream=function(string,tabSize,lineOracle){this.pos=this.start=0;this.string=string;this.tabSize=tabSize||8;this.lastColumnPos=this.lastColumnValue=0;this.lineStart=0;this.lineOracle=lineOracle};StringStream.prototype.eol=function(){return this.pos>=this.string.length};StringStream.prototype.sol=function(){return this.pos==this.lineStart};StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||undefined};StringStream.prototype.next=function(){if(this.pos<this.string.length){return this.string.charAt(this.pos++)}};StringStream.prototype.eat=function(match){var ch=this.string.charAt(this.pos);var ok;if(typeof match=="string"){ok=ch==match}else{ok=ch&&(match.test?match.test(ch):match(ch))}if(ok){++this.pos;return ch}};StringStream.prototype.eatWhile=function(match){var start=this.pos;while(this.eat(match)){}return this.pos>start};StringStream.prototype.eatSpace=function(){var this$1=this;var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos))){++this$1.pos}return this.pos>start};StringStream.prototype.skipToEnd=function(){this.pos=this.string.length};StringStream.prototype.skipTo=function(ch){var found=this.string.indexOf(ch,this.pos);if(found>-1){this.pos=found;return true}};StringStream.prototype.backUp=function(n){this.pos-=n};StringStream.prototype.column=function(){if(this.lastColumnPos<this.start){this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue);this.lastColumnPos=this.start}return this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)};StringStream.prototype.match=function(pattern,consume,caseInsensitive){if(typeof pattern=="string"){var cased=function(str){return caseInsensitive?str.toLowerCase():str};var substr=this.string.substr(this.pos,pattern.length);if(cased(substr)==cased(pattern)){if(consume!==false){this.pos+=pattern.length}return true}}else{var match=this.string.slice(this.pos).match(pattern);if(match&&match.index>0){return null}if(match&&consume!==false){this.pos+=match[0].length}return match}};StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)};StringStream.prototype.hideFirstChars=function(n,inner){this.lineStart+=n;try{return inner()}finally{this.lineStart-=n}};StringStream.prototype.lookAhead=function(n){var oracle=this.lineOracle;return oracle&&oracle.lookAhead(n)};var SavedContext=function(state,lookAhead){this.state=state;this.lookAhead=lookAhead};var Context=function(doc,state,line,lookAhead){this.state=state;this.doc=doc;this.line=line;this.maxLookAhead=lookAhead||0};Context.prototype.lookAhead=function(n){var line=this.doc.getLine(this.line+n);if(line!=null&&n>this.maxLookAhead){this.maxLookAhead=n}return line};Context.prototype.nextLine=function(){this.line++;if(this.maxLookAhead>0){this.maxLookAhead--}};Context.fromSaved=function(doc,saved,line){if(saved instanceof SavedContext){return new Context(doc,copyState(doc.mode,saved.state),line,saved.lookAhead)}else{return new Context(doc,copyState(doc.mode,saved),line)}};Context.prototype.save=function(copy){var state=copy!==false?copyState(this.doc.mode,this.state):this.state;return this.maxLookAhead>0?new SavedContext(state,this.maxLookAhead):state};function highlightLine(cm,line,context,forceToEnd){var st=[cm.state.modeGen],lineClasses={};runMode(cm,line.text,cm.doc.mode,context,function(end,style){return st.push(end,style)},lineClasses,forceToEnd);var state=context.state;var loop=function(o){var overlay=cm.state.overlays[o],i=1,at=0;context.state=true;runMode(cm,line.text,overlay.mode,context,function(end,style){var start=i;while(at<end){var i_end=st[i];if(i_end>end){st.splice(i,1,end,st[i+1],i_end)}i+=2;at=Math.min(end,i_end)}if(!style){return}if(overlay.opaque){st.splice(start,i-start,end,"overlay "+style);i=start+2}else{for(;start<i;start+=2){var cur=st[start+1];st[start+1]=(cur?cur+" ":"")+"overlay "+style}}},lineClasses)};for(var o=0;o<cm.state.overlays.length;++o)loop(o);context.state=state;return{styles:st,classes:lineClasses.bgClass||lineClasses.textClass?lineClasses:null}}function getLineStyles(cm,line,updateFrontier){if(!line.styles||line.styles[0]!=cm.state.modeGen){var context=getContextBefore(cm,lineNo(line));var resetState=line.text.length>cm.options.maxHighlightLength&&copyState(cm.doc.mode,context.state);var result=highlightLine(cm,line,context);if(resetState){context.state=resetState}line.stateAfter=context.save(!resetState);line.styles=result.styles;if(result.classes){line.styleClasses=result.classes}else if(line.styleClasses){line.styleClasses=null}if(updateFrontier===cm.doc.highlightFrontier){cm.doc.modeFrontier=Math.max(cm.doc.modeFrontier,++cm.doc.highlightFrontier)}}return line.styles}function getContextBefore(cm,n,precise){var doc=cm.doc,display=cm.display;if(!doc.mode.startState){return new Context(doc,true,n)}var start=findStartLine(cm,n,precise);var saved=start>doc.first&&getLine(doc,start-1).stateAfter;var context=saved?Context.fromSaved(doc,saved,start):new Context(doc,startState(doc.mode),start);doc.iter(start,n,function(line){processLine(cm,line.text,context);var pos=context.line;line.stateAfter=pos==n-1||pos%5==0||pos>=display.viewFrom&&pos<display.viewTo?context.save():null;context.nextLine()});if(precise){doc.modeFrontier=context.line}return context}function processLine(cm,text,context,startAt){var mode=cm.doc.mode;var stream=new StringStream(text,cm.options.tabSize,context);stream.start=stream.pos=startAt||0;if(text==""){callBlankLine(mode,context.state)}while(!stream.eol()){readToken(mode,stream,context.state);stream.start=stream.pos}}function callBlankLine(mode,state){if(mode.blankLine){return mode.blankLine(state)}if(!mode.innerMode){return}var inner=innerMode(mode,state);if(inner.mode.blankLine){return inner.mode.blankLine(inner.state)}}function readToken(mode,stream,state,inner){for(var i=0;i<10;i++){if(inner){inner[0]=innerMode(mode,state).mode}var style=mode.token(stream,state);if(stream.pos>stream.start){return style}}throw new Error("Mode "+mode.name+" failed to advance stream.")}var Token=function(stream,type,state){this.start=stream.start;this.end=stream.pos;this.string=stream.current();this.type=type||null;this.state=state};function takeToken(cm,pos,precise,asArray){var doc=cm.doc,mode=doc.mode,style;pos=clipPos(doc,pos);var line=getLine(doc,pos.line),context=getContextBefore(cm,pos.line,precise);var stream=new StringStream(line.text,cm.options.tabSize,context),tokens;if(asArray){tokens=[]}while((asArray||stream.pos<pos.ch)&&!stream.eol()){stream.start=stream.pos;style=readToken(mode,stream,context.state);if(asArray){tokens.push(new Token(stream,style,copyState(doc.mode,context.state)))}}return asArray?tokens:new Token(stream,style,context.state)}function extractLineClasses(type,output){if(type){for(;;){var lineClass=type.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!lineClass){break}type=type.slice(0,lineClass.index)+type.slice(lineClass.index+lineClass[0].length);var prop=lineClass[1]?"bgClass":"textClass";if(output[prop]==null){output[prop]=lineClass[2]}else if(!new RegExp("(?:^|s)"+lineClass[2]+"(?:$|s)").test(output[prop])){output[prop]+=" "+lineClass[2]}}}return type}function runMode(cm,text,mode,context,f,lineClasses,forceToEnd){var flattenSpans=mode.flattenSpans;if(flattenSpans==null){flattenSpans=cm.options.flattenSpans}var curStart=0,curStyle=null;var stream=new StringStream(text,cm.options.tabSize,context),style;var inner=cm.options.addModeClass&&[null];if(text==""){extractLineClasses(callBlankLine(mode,context.state),lineClasses)}while(!stream.eol()){if(stream.pos>cm.options.maxHighlightLength){flattenSpans=false;if(forceToEnd){processLine(cm,text,context,stream.pos)}stream.pos=text.length;style=null}else{style=extractLineClasses(readToken(mode,stream,context.state,inner),lineClasses)}if(inner){var mName=inner[0].name;if(mName){style="m-"+(style?mName+" "+style:mName)}}if(!flattenSpans||curStyle!=style){while(curStart<stream.start){curStart=Math.min(stream.start,curStart+5e3);f(curStart,curStyle)}curStyle=style}stream.start=stream.pos}while(curStart<stream.pos){var pos=Math.min(stream.pos,curStart+5e3);f(pos,curStyle);curStart=pos}}function findStartLine(cm,n,precise){var minindent,minline,doc=cm.doc;var lim=precise?-1:n-(cm.doc.mode.innerMode?1e3:100);for(var search=n;search>lim;--search){if(search<=doc.first){return doc.first}var line=getLine(doc,search-1),after=line.stateAfter;if(after&&(!precise||search+(after instanceof SavedContext?after.lookAhead:0)<=doc.modeFrontier)){return search}var indented=countColumn(line.text,null,cm.options.tabSize);if(minline==null||minindent>indented){minline=search-1;minindent=indented}}return minline}function retreatFrontier(doc,n){doc.modeFrontier=Math.min(doc.modeFrontier,n);if(doc.highlightFrontier<n-10){return}var start=doc.first;for(var line=n-1;line>start;line--){var saved=getLine(doc,line).stateAfter;if(saved&&(!(saved instanceof SavedContext)||line+saved.lookAhead<n)){start=line+1;break}}doc.highlightFrontier=Math.min(doc.highlightFrontier,start)}var Line=function(text,markedSpans,estimateHeight){this.text=text;attachMarkedSpans(this,markedSpans);this.height=estimateHeight?estimateHeight(this):1};Line.prototype.lineNo=function(){return lineNo(this)};eventMixin(Line);function updateLine(line,text,markedSpans,estimateHeight){line.text=text;if(line.stateAfter){line.stateAfter=null}if(line.styles){line.styles=null}if(line.order!=null){line.order=null}detachMarkedSpans(line);attachMarkedSpans(line,markedSpans);var estHeight=estimateHeight?estimateHeight(line):1;if(estHeight!=line.height){updateLineHeight(line,estHeight)}}function cleanUpLine(line){line.parent=null;detachMarkedSpans(line)}var styleToClassCache={};var styleToClassCacheWithMode={};function interpretTokenStyle(style,options){if(!style||/^\s*$/.test(style)){return null}var cache=options.addModeClass?styleToClassCacheWithMode:styleToClassCache;return cache[style]||(cache[style]=style.replace(/\S+/g,"cm-$&"))}function buildLineContent(cm,lineView){var content=eltP("span",null,null,webkit?"padding-right: .1px":null);var builder={pre:eltP("pre",[content],"CodeMirror-line"),content:content,col:0,pos:0,cm:cm,trailingSpace:false,splitSpaces:(ie||webkit)&&cm.getOption("lineWrapping")};lineView.measure={};for(var i=0;i<=(lineView.rest?lineView.rest.length:0);i++){var line=i?lineView.rest[i-1]:lineView.line,order=void 0;builder.pos=0;builder.addToken=buildToken;if(hasBadBidiRects(cm.display.measure)&&(order=getOrder(line,cm.doc.direction))){builder.addToken=buildTokenBadBidi(builder.addToken,order)}builder.map=[];var allowFrontierUpdate=lineView!=cm.display.externalMeasured&&lineNo(line);insertLineContent(line,builder,getLineStyles(cm,line,allowFrontierUpdate));if(line.styleClasses){if(line.styleClasses.bgClass){builder.bgClass=joinClasses(line.styleClasses.bgClass,builder.bgClass||"")}if(line.styleClasses.textClass){builder.textClass=joinClasses(line.styleClasses.textClass,builder.textClass||"")}}if(builder.map.length==0){builder.map.push(0,0,builder.content.appendChild(zeroWidthElement(cm.display.measure)))}if(i==0){lineView.measure.map=builder.map;lineView.measure.cache={}}else{(lineView.measure.maps||(lineView.measure.maps=[])).push(builder.map);(lineView.measure.caches||(lineView.measure.caches=[])).push({})}}if(webkit){var last=builder.content.lastChild;if(/\bcm-tab\b/.test(last.className)||last.querySelector&&last.querySelector(".cm-tab")){builder.content.className="cm-tab-wrap-hack"}}signal(cm,"renderLine",cm,lineView.line,builder.pre);if(builder.pre.className){builder.textClass=joinClasses(builder.pre.className,builder.textClass||"")}return builder}function defaultSpecialCharPlaceholder(ch){var token=elt("span","•","cm-invalidchar");token.title="\\u"+ch.charCodeAt(0).toString(16);token.setAttribute("aria-label",token.title);return token}function buildToken(builder,text,style,startStyle,endStyle,title,css){if(!text){return}var displayText=builder.splitSpaces?splitSpaces(text,builder.trailingSpace):text;var special=builder.cm.state.specialChars,mustWrap=false;var content;if(!special.test(text)){builder.col+=text.length;content=document.createTextNode(displayText);builder.map.push(builder.pos,builder.pos+text.length,content);if(ie&&ie_version<9){mustWrap=true}builder.pos+=text.length}else{content=document.createDocumentFragment();var pos=0;while(true){special.lastIndex=pos;var m=special.exec(text);var skipped=m?m.index-pos:text.length-pos;if(skipped){var txt=document.createTextNode(displayText.slice(pos,pos+skipped));if(ie&&ie_version<9){content.appendChild(elt("span",[txt]))}else{content.appendChild(txt)}builder.map.push(builder.pos,builder.pos+skipped,txt);builder.col+=skipped;builder.pos+=skipped}if(!m){break}pos+=skipped+1;var txt$1=void 0;if(m[0]=="\t"){var tabSize=builder.cm.options.tabSize,tabWidth=tabSize-builder.col%tabSize;txt$1=content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab"));txt$1.setAttribute("role","presentation");txt$1.setAttribute("cm-text","\t");builder.col+=tabWidth}else if(m[0]=="\r"||m[0]=="\n"){txt$1=content.appendChild(elt("span",m[0]=="\r"?"␍":"␤","cm-invalidchar"));txt$1.setAttribute("cm-text",m[0]);builder.col+=1}else{txt$1=builder.cm.options.specialCharPlaceholder(m[0]);txt$1.setAttribute("cm-text",m[0]);if(ie&&ie_version<9){content.appendChild(elt("span",[txt$1]))}else{content.appendChild(txt$1)}builder.col+=1}builder.map.push(builder.pos,builder.pos+1,txt$1);builder.pos++}}builder.trailingSpace=displayText.charCodeAt(text.length-1)==32;if(style||startStyle||endStyle||mustWrap||css){var fullStyle=style||"";if(startStyle){fullStyle+=startStyle}if(endStyle){fullStyle+=endStyle}var token=elt("span",[content],fullStyle,css);if(title){token.title=title}return builder.content.appendChild(token)}builder.content.appendChild(content)}function splitSpaces(text,trailingBefore){if(text.length>1&&!/  /.test(text)){return text}var spaceBefore=trailingBefore,result="";for(var i=0;i<text.length;i++){var ch=text.charAt(i);if(ch==" "&&spaceBefore&&(i==text.length-1||text.charCodeAt(i+1)==32)){ch=" "}result+=ch;spaceBefore=ch==" "}return result}function buildTokenBadBidi(inner,order){return function(builder,text,style,startStyle,endStyle,title,css){style=style?style+" cm-force-border":"cm-force-border";var start=builder.pos,end=start+text.length;for(;;){var part=void 0;for(var i=0;i<order.length;i++){part=order[i];if(part.to>start&&part.from<=start){break}}if(part.to>=end){return inner(builder,text,style,startStyle,endStyle,title,css)}inner(builder,text.slice(0,part.to-start),style,startStyle,null,title,css);startStyle=null;text=text.slice(part.to-start);start=part.to}}}function buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.widgetNode;if(widget){builder.map.push(builder.pos,builder.pos+size,widget)}if(!ignoreWidget&&builder.cm.display.input.needsContentAttribute){if(!widget){widget=builder.content.appendChild(document.createElement("span"))}widget.setAttribute("cm-marker",marker.id)}if(widget){builder.cm.display.input.setUneditable(widget);builder.content.appendChild(widget)}builder.pos+=size;builder.trailingSpace=false}function insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0;if(!spans){for(var i$1=1;i$1<styles.length;i$1+=2){builder.addToken(builder,allText.slice(at,at=styles[i$1]),interpretTokenStyle(styles[i$1+1],builder.cm.options))}return}var len=allText.length,pos=0,i=1,text="",style,css;var nextChange=0,spanStyle,spanEndStyle,spanStartStyle,title,collapsed;for(;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=title=css="";collapsed=null;nextChange=Infinity;var foundBookmarks=[],endStyles=void 0;for(var j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker;if(m.type=="bookmark"&&sp.from==pos&&m.widgetNode){foundBookmarks.push(m)}else if(sp.from<=pos&&(sp.to==null||sp.to>pos||m.collapsed&&sp.to==pos&&sp.from==pos)){if(sp.to!=null&&sp.to!=pos&&nextChange>sp.to){nextChange=sp.to;spanEndStyle=""}if(m.className){spanStyle+=" "+m.className}if(m.css){css=(css?css+";":"")+m.css}if(m.startStyle&&sp.from==pos){spanStartStyle+=" "+m.startStyle}if(m.endStyle&&sp.to==nextChange){(endStyles||(endStyles=[])).push(m.endStyle,sp.to)}if(m.title&&!title){title=m.title}if(m.collapsed&&(!collapsed||compareCollapsedMarkers(collapsed.marker,m)<0)){collapsed=sp}}else if(sp.from>pos&&nextChange>sp.from){nextChange=sp.from}}if(endStyles){for(var j$1=0;j$1<endStyles.length;j$1+=2){if(endStyles[j$1+1]==nextChange){spanEndStyle+=" "+endStyles[j$1]}}}if(!collapsed||collapsed.from==pos){for(var j$2=0;j$2<foundBookmarks.length;++j$2){buildCollapsedSpan(builder,0,foundBookmarks[j$2])}}if(collapsed&&(collapsed.from||0)==pos){buildCollapsedSpan(builder,(collapsed.to==null?len+1:collapsed.to)-pos,collapsed.marker,collapsed.from==null);if(collapsed.to==null){return}if(collapsed.to==pos){collapsed=false}}}if(pos>=len){break}var upto=Math.min(len,nextChange);while(true){if(text){var end=pos+text.length;if(!collapsed){var tokenText=end>upto?text.slice(0,upto-pos):text;builder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",title,css)}if(end>=upto){text=text.slice(upto-pos);pos=upto;break}pos=end;spanStartStyle=""}text=allText.slice(at,at=styles[i++]);style=interpretTokenStyle(styles[i++],builder.cm.options)}}}function LineView(doc,line,lineN){this.line=line;this.rest=visualLineContinued(line);this.size=this.rest?lineNo(lst(this.rest))-lineN+1:1;this.node=this.text=null;this.hidden=lineIsHidden(doc,line)}function buildViewArray(cm,from,to){var array=[],nextPos;for(var pos=from;pos<to;pos=nextPos){var view=new LineView(cm.doc,getLine(cm.doc,pos),pos);nextPos=pos+view.size;array.push(view)}return array}var operationGroup=null;function pushOperation(op){if(operationGroup){operationGroup.ops.push(op)}else{op.ownsGroup=operationGroup={ops:[op],delayedCallbacks:[]}}}function fireCallbacksForOps(group){var callbacks=group.delayedCallbacks,i=0;do{for(;i<callbacks.length;i++){callbacks[i].call(null)}for(var j=0;j<group.ops.length;j++){var op=group.ops[j];if(op.cursorActivityHandlers){while(op.cursorActivityCalled<op.cursorActivityHandlers.length){op.cursorActivityHandlers[op.cursorActivityCalled++].call(null,op.cm)}}}}while(i<callbacks.length)}function finishOperation(op,endCb){var group=op.ownsGroup;if(!group){return}try{fireCallbacksForOps(group)}finally{operationGroup=null;endCb(group)}}var orphanDelayedCallbacks=null;function signalLater(emitter,type){var arr=getHandlers(emitter,type);if(!arr.length){return}var args=Array.prototype.slice.call(arguments,2),list;if(operationGroup){list=operationGroup.delayedCallbacks}else if(orphanDelayedCallbacks){list=orphanDelayedCallbacks}else{list=orphanDelayedCallbacks=[];setTimeout(fireOrphanDelayed,0)}var loop=function(i){list.push(function(){return arr[i].apply(null,args)})};for(var i=0;i<arr.length;++i)loop(i)}function fireOrphanDelayed(){var delayed=orphanDelayedCallbacks;orphanDelayedCallbacks=null;for(var i=0;i<delayed.length;++i){delayed[i]()}}function updateLineForChanges(cm,lineView,lineN,dims){for(var j=0;j<lineView.changes.length;j++){var type=lineView.changes[j];if(type=="text"){updateLineText(cm,lineView)}else if(type=="gutter"){updateLineGutter(cm,lineView,lineN,dims)}else if(type=="class"){updateLineClasses(cm,lineView)}else if(type=="widget"){updateLineWidgets(cm,lineView,dims)}}lineView.changes=null}function ensureLineWrapped(lineView){if(lineView.node==lineView.text){lineView.node=elt("div",null,null,"position: relative");if(lineView.text.parentNode){lineView.text.parentNode.replaceChild(lineView.node,lineView.text)}lineView.node.appendChild(lineView.text);if(ie&&ie_version<8){lineView.node.style.zIndex=2}}return lineView.node}function updateLineBackground(cm,lineView){var cls=lineView.bgClass?lineView.bgClass+" "+(lineView.line.bgClass||""):lineView.line.bgClass;if(cls){cls+=" CodeMirror-linebackground"}if(lineView.background){if(cls){lineView.background.className=cls}else{lineView.background.parentNode.removeChild(lineView.background);lineView.background=null}}else if(cls){var wrap=ensureLineWrapped(lineView);lineView.background=wrap.insertBefore(elt("div",null,cls),wrap.firstChild);cm.display.input.setUneditable(lineView.background)}}function getLineContent(cm,lineView){var ext=cm.display.externalMeasured;if(ext&&ext.line==lineView.line){cm.display.externalMeasured=null;lineView.measure=ext.measure;return ext.built}return buildLineContent(cm,lineView)}function updateLineText(cm,lineView){var cls=lineView.text.className;var built=getLineContent(cm,lineView);if(lineView.text==lineView.node){lineView.node=built.pre}lineView.text.parentNode.replaceChild(built.pre,lineView.text);lineView.text=built.pre;if(built.bgClass!=lineView.bgClass||built.textClass!=lineView.textClass){lineView.bgClass=built.bgClass;lineView.textClass=built.textClass;updateLineClasses(cm,lineView)}else if(cls){lineView.text.className=cls}}function updateLineClasses(cm,lineView){updateLineBackground(cm,lineView);if(lineView.line.wrapClass){ensureLineWrapped(lineView).className=lineView.line.wrapClass}else if(lineView.node!=lineView.text){lineView.node.className=""}var textClass=lineView.textClass?lineView.textClass+" "+(lineView.line.textClass||""):lineView.line.textClass;lineView.text.className=textClass||""}function updateLineGutter(cm,lineView,lineN,dims){if(lineView.gutter){lineView.node.removeChild(lineView.gutter);lineView.gutter=null}if(lineView.gutterBackground){lineView.node.removeChild(lineView.gutterBackground);lineView.gutterBackground=null}if(lineView.line.gutterClass){var wrap=ensureLineWrapped(lineView);lineView.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+lineView.line.gutterClass,"left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px; width: "+dims.gutterTotalWidth+"px");cm.display.input.setUneditable(lineView.gutterBackground);wrap.insertBefore(lineView.gutterBackground,lineView.text)}var markers=lineView.line.gutterMarkers;if(cm.options.lineNumbers||markers){var wrap$1=ensureLineWrapped(lineView);var gutterWrap=lineView.gutter=elt("div",null,"CodeMirror-gutter-wrapper","left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px");cm.display.input.setUneditable(gutterWrap);wrap$1.insertBefore(gutterWrap,lineView.text);if(lineView.line.gutterClass){gutterWrap.className+=" "+lineView.line.gutterClass}if(cm.options.lineNumbers&&(!markers||!markers["CodeMirror-linenumbers"])){lineView.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineN),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+dims.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+cm.display.lineNumInnerWidth+"px"))}if(markers){for(var k=0;k<cm.options.gutters.length;++k){var id=cm.options.gutters[k],found=markers.hasOwnProperty(id)&&markers[id];if(found){gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt","left: "+dims.gutterLeft[id]+"px; width: "+dims.gutterWidth[id]+"px"))}}}}}function updateLineWidgets(cm,lineView,dims){if(lineView.alignable){lineView.alignable=null}for(var node=lineView.node.firstChild,next=void 0;node;node=next){next=node.nextSibling;if(node.className=="CodeMirror-linewidget"){lineView.node.removeChild(node)}}insertLineWidgets(cm,lineView,dims)}function buildLineElement(cm,lineView,lineN,dims){var built=getLineContent(cm,lineView);lineView.text=lineView.node=built.pre;if(built.bgClass){lineView.bgClass=built.bgClass}if(built.textClass){lineView.textClass=built.textClass}updateLineClasses(cm,lineView);updateLineGutter(cm,lineView,lineN,dims);insertLineWidgets(cm,lineView,dims);return lineView.node}function insertLineWidgets(cm,lineView,dims){insertLineWidgetsFor(cm,lineView.line,lineView,dims,true);if(lineView.rest){for(var i=0;i<lineView.rest.length;i++){insertLineWidgetsFor(cm,lineView.rest[i],lineView,dims,false)}}}function insertLineWidgetsFor(cm,line,lineView,dims,allowAbove){if(!line.widgets){return}var wrap=ensureLineWrapped(lineView);for(var i=0,ws=line.widgets;i<ws.length;++i){var widget=ws[i],node=elt("div",[widget.node],"CodeMirror-linewidget");if(!widget.handleMouseEvents){node.setAttribute("cm-ignore-events","true")}positionLineWidget(widget,node,lineView,dims);cm.display.input.setUneditable(node);if(allowAbove&&widget.above){wrap.insertBefore(node,lineView.gutter||lineView.text)}else{wrap.appendChild(node)}signalLater(widget,"redraw")}}function positionLineWidget(widget,node,lineView,dims){if(widget.noHScroll){(lineView.alignable||(lineView.alignable=[])).push(node);var width=dims.wrapperWidth;node.style.left=dims.fixedPos+"px";if(!widget.coverGutter){width-=dims.gutterTotalWidth;node.style.paddingLeft=dims.gutterTotalWidth+"px"}node.style.width=width+"px"}if(widget.coverGutter){node.style.zIndex=5;node.style.position="relative";if(!widget.noHScroll){node.style.marginLeft=-dims.gutterTotalWidth+"px"}}}function widgetHeight(widget){if(widget.height!=null){return widget.height}var cm=widget.doc.cm;if(!cm){return 0}if(!contains(document.body,widget.node)){var parentStyle="position: relative;";if(widget.coverGutter){parentStyle+="margin-left: -"+cm.display.gutters.offsetWidth+"px;"}if(widget.noHScroll){parentStyle+="width: "+cm.display.wrapper.clientWidth+"px;"}removeChildrenAndAdd(cm.display.measure,elt("div",[widget.node],null,parentStyle))}return widget.height=widget.node.parentNode.offsetHeight}function eventInWidget(display,e){for(var n=e_target(e);n!=display.wrapper;n=n.parentNode){if(!n||n.nodeType==1&&n.getAttribute("cm-ignore-events")=="true"||n.parentNode==display.sizer&&n!=display.mover){return true}}}function paddingTop(display){return display.lineSpace.offsetTop}function paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight}function paddingH(display){if(display.cachedPaddingH){return display.cachedPaddingH}var e=removeChildrenAndAdd(display.measure,elt("pre","x"));var style=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle;var data={left:parseInt(style.paddingLeft),right:parseInt(style.paddingRight)};if(!isNaN(data.left)&&!isNaN(data.right)){display.cachedPaddingH=data}return data}function scrollGap(cm){return scrollerGap-cm.display.nativeBarWidth}function displayWidth(cm){return cm.display.scroller.clientWidth-scrollGap(cm)-cm.display.barWidth}function displayHeight(cm){return cm.display.scroller.clientHeight-scrollGap(cm)-cm.display.barHeight}function ensureLineHeights(cm,lineView,rect){var wrapping=cm.options.lineWrapping;var curWidth=wrapping&&displayWidth(cm);if(!lineView.measure.heights||wrapping&&lineView.measure.width!=curWidth){var heights=lineView.measure.heights=[];if(wrapping){lineView.measure.width=curWidth;var rects=lineView.text.firstChild.getClientRects();for(var i=0;i<rects.length-1;i++){var cur=rects[i],next=rects[i+1];if(Math.abs(cur.bottom-next.bottom)>2){heights.push((cur.bottom+next.top)/2-rect.top)}}}heights.push(rect.bottom-rect.top)}}function mapFromLineView(lineView,line,lineN){if(lineView.line==line){return{map:lineView.measure.map,cache:lineView.measure.cache}}for(var i=0;i<lineView.rest.length;i++){if(lineView.rest[i]==line){return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i]}}}for(var i$1=0;i$1<lineView.rest.length;i$1++){if(lineNo(lineView.rest[i$1])>lineN){return{map:lineView.measure.maps[i$1],cache:lineView.measure.caches[i$1],before:true}}}}function updateExternalMeasurement(cm,line){line=visualLine(line);var lineN=lineNo(line);var view=cm.display.externalMeasured=new LineView(cm.doc,line,lineN);view.lineN=lineN;var built=view.built=buildLineContent(cm,view);view.text=built.pre;removeChildrenAndAdd(cm.display.lineMeasure,built.pre);return view}function measureChar(cm,line,ch,bias){return measureCharPrepared(cm,prepareMeasureForLine(cm,line),ch,bias)}function findViewForLine(cm,lineN){if(lineN>=cm.display.viewFrom&&lineN<cm.display.viewTo){return cm.display.view[findViewIndex(cm,lineN)]}var ext=cm.display.externalMeasured;if(ext&&lineN>=ext.lineN&&lineN<ext.lineN+ext.size){return ext}}function prepareMeasureForLine(cm,line){var lineN=lineNo(line);var view=findViewForLine(cm,lineN);if(view&&!view.text){view=null}else if(view&&view.changes){updateLineForChanges(cm,view,lineN,getDimensions(cm));cm.curOp.forceUpdate=true}if(!view){view=updateExternalMeasurement(cm,line)}var info=mapFromLineView(view,line,lineN);return{line:line,view:view,rect:null,map:info.map,cache:info.cache,before:info.before,hasHeights:false}}function measureCharPrepared(cm,prepared,ch,bias,varHeight){if(prepared.before){ch=-1}var key=ch+(bias||""),found;if(prepared.cache.hasOwnProperty(key)){found=prepared.cache[key]}else{if(!prepared.rect){prepared.rect=prepared.view.text.getBoundingClientRect()}if(!prepared.hasHeights){ensureLineHeights(cm,prepared.view,prepared.rect);prepared.hasHeights=true}found=measureCharInner(cm,prepared,ch,bias);if(!found.bogus){prepared.cache[key]=found}}return{left:found.left,right:found.right,top:varHeight?found.rtop:found.top,bottom:varHeight?found.rbottom:found.bottom}}var nullRect={left:0,right:0,top:0,bottom:0};function nodeAndOffsetInLineMap(map$$1,ch,bias){var node,start,end,collapse,mStart,mEnd;for(var i=0;i<map$$1.length;i+=3){mStart=map$$1[i];mEnd=map$$1[i+1];if(ch<mStart){start=0;end=1;collapse="left"}else if(ch<mEnd){start=ch-mStart;end=start+1}else if(i==map$$1.length-3||ch==mEnd&&map$$1[i+3]>ch){end=mEnd-mStart;start=end-1;if(ch>=mEnd){collapse="right"}}if(start!=null){node=map$$1[i+2];if(mStart==mEnd&&bias==(node.insertLeft?"left":"right")){collapse=bias}if(bias=="left"&&start==0){while(i&&map$$1[i-2]==map$$1[i-3]&&map$$1[i-1].insertLeft){node=map$$1[(i-=3)+2];collapse="left"}}if(bias=="right"&&start==mEnd-mStart){while(i<map$$1.length-3&&map$$1[i+3]==map$$1[i+4]&&!map$$1[i+5].insertLeft){node=map$$1[(i+=3)+2];collapse="right"}}break}}return{node:node,start:start,end:end,collapse:collapse,coverStart:mStart,coverEnd:mEnd}}function getUsefulRect(rects,bias){var rect=nullRect;if(bias=="left"){for(var i=0;i<rects.length;i++){if((rect=rects[i]).left!=rect.right){break}}}else{for(var i$1=rects.length-1;i$1>=0;i$1--){if((rect=rects[i$1]).left!=rect.right){break}}}return rect}function measureCharInner(cm,prepared,ch,bias){var place=nodeAndOffsetInLineMap(prepared.map,ch,bias);var node=place.node,start=place.start,end=place.end,collapse=place.collapse;var rect;if(node.nodeType==3){for(var i$1=0;i$1<4;i$1++){while(start&&isExtendingChar(prepared.line.text.charAt(place.coverStart+start))){--start}while(place.coverStart+end<place.coverEnd&&isExtendingChar(prepared.line.text.charAt(place.coverStart+end))){++end}if(ie&&ie_version<9&&start==0&&end==place.coverEnd-place.coverStart){rect=node.parentNode.getBoundingClientRect()}else{rect=getUsefulRect(range(node,start,end).getClientRects(),bias)}if(rect.left||rect.right||start==0){break}end=start;start=start-1;collapse="right"}if(ie&&ie_version<11){rect=maybeUpdateRectForZooming(cm.display.measure,rect)}}else{if(start>0){collapse=bias="right"}var rects;if(cm.options.lineWrapping&&(rects=node.getClientRects()).length>1){rect=rects[bias=="right"?rects.length-1:0]}else{rect=node.getBoundingClientRect()}}if(ie&&ie_version<9&&!start&&(!rect||!rect.left&&!rect.right)){var rSpan=node.parentNode.getClientRects()[0];if(rSpan){rect={left:rSpan.left,right:rSpan.left+charWidth(cm.display),top:rSpan.top,bottom:rSpan.bottom}}else{rect=nullRect}}var rtop=rect.top-prepared.rect.top,rbot=rect.bottom-prepared.rect.top;var mid=(rtop+rbot)/2;var heights=prepared.view.measure.heights;var i=0;for(;i<heights.length-1;i++){if(mid<heights[i]){break}}var top=i?heights[i-1]:0,bot=heights[i];var result={left:(collapse=="right"?rect.right:rect.left)-prepared.rect.left,right:(collapse=="left"?rect.left:rect.right)-prepared.rect.left,top:top,bottom:bot};if(!rect.left&&!rect.right){result.bogus=true}if(!cm.options.singleCursorHeightPerLine){result.rtop=rtop;result.rbottom=rbot}return result}function maybeUpdateRectForZooming(measure,rect){if(!window.screen||screen.logicalXDPI==null||screen.logicalXDPI==screen.deviceXDPI||!hasBadZoomedRects(measure)){return rect}var scaleX=screen.logicalXDPI/screen.deviceXDPI;var scaleY=screen.logicalYDPI/screen.deviceYDPI;return{left:rect.left*scaleX,right:rect.right*scaleX,top:rect.top*scaleY,bottom:rect.bottom*scaleY}}function clearLineMeasurementCacheFor(lineView){if(lineView.measure){lineView.measure.cache={};lineView.measure.heights=null;if(lineView.rest){for(var i=0;i<lineView.rest.length;i++){lineView.measure.caches[i]={}}}}}function clearLineMeasurementCache(cm){cm.display.externalMeasure=null;removeChildren(cm.display.lineMeasure);for(var i=0;i<cm.display.view.length;i++){clearLineMeasurementCacheFor(cm.display.view[i])}}function clearCaches(cm){clearLineMeasurementCache(cm);cm.display.cachedCharWidth=cm.display.cachedTextHeight=cm.display.cachedPaddingH=null;if(!cm.options.lineWrapping){cm.display.maxLineChanged=true}cm.display.lineNumChars=null}function pageScrollX(){if(chrome&&android){return-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft))}return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){if(chrome&&android){return-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop))}return window.pageYOffset||(document.documentElement||document.body).scrollTop}function intoCoordSystem(cm,lineObj,rect,context,includeWidgets){if(!includeWidgets&&lineObj.widgets){for(var i=0;i<lineObj.widgets.length;++i){if(lineObj.widgets[i].above){var size=widgetHeight(lineObj.widgets[i]);rect.top+=size;rect.bottom+=size}}}if(context=="line"){return rect}if(!context){context="local"}var yOff=heightAtLine(lineObj);if(context=="local"){yOff+=paddingTop(cm.display)}else{yOff-=cm.display.viewOffset}if(context=="page"||context=="window"){var lOff=cm.display.lineSpace.getBoundingClientRect();yOff+=lOff.top+(context=="window"?0:pageScrollY());var xOff=lOff.left+(context=="window"?0:pageScrollX());rect.left+=xOff;rect.right+=xOff}rect.top+=yOff;rect.bottom+=yOff;return rect}function fromCoordSystem(cm,coords,context){if(context=="div"){return coords}var left=coords.left,top=coords.top;if(context=="page"){left-=pageScrollX();top-=pageScrollY()}else if(context=="local"||!context){var localBox=cm.display.sizer.getBoundingClientRect();left+=localBox.left;top+=localBox.top}var lineSpaceBox=cm.display.lineSpace.getBoundingClientRect();return{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top}}function charCoords(cm,pos,context,lineObj,bias){if(!lineObj){lineObj=getLine(cm.doc,pos.line)}return intoCoordSystem(cm,lineObj,measureChar(cm,lineObj,pos.ch,bias),context)}function cursorCoords(cm,pos,context,lineObj,preparedMeasure,varHeight){lineObj=lineObj||getLine(cm.doc,pos.line);if(!preparedMeasure){preparedMeasure=prepareMeasureForLine(cm,lineObj)}function get(ch,right){var m=measureCharPrepared(cm,preparedMeasure,ch,right?"right":"left",varHeight);if(right){m.left=m.right}else{m.right=m.left}return intoCoordSystem(cm,lineObj,m,context)}var order=getOrder(lineObj,cm.doc.direction),ch=pos.ch,sticky=pos.sticky;if(ch>=lineObj.text.length){ch=lineObj.text.length;sticky="before"}else if(ch<=0){ch=0;sticky="after"}if(!order){return get(sticky=="before"?ch-1:ch,sticky=="before")}function getBidi(ch,partPos,invert){var part=order[partPos],right=part.level%2!=0;return get(invert?ch-1:ch,right!=invert)}var partPos=getBidiPartAt(order,ch,sticky);var other=bidiOther;var val=getBidi(ch,partPos,sticky=="before");if(other!=null){val.other=getBidi(ch,other,sticky!="before")}return val}function estimateCoords(cm,pos){var left=0;pos=clipPos(cm.doc,pos);if(!cm.options.lineWrapping){left=charWidth(cm.display)*pos.ch}var lineObj=getLine(cm.doc,pos.line);var top=heightAtLine(lineObj)+paddingTop(cm.display);return{left:left,right:left,top:top,bottom:top+lineObj.height}}function PosWithInfo(line,ch,sticky,outside,xRel){var pos=Pos(line,ch,sticky);pos.xRel=xRel;if(outside){pos.outside=true}return pos}function coordsChar(cm,x,y){var doc=cm.doc;y+=cm.display.viewOffset;if(y<0){return PosWithInfo(doc.first,0,null,true,-1)}var lineN=lineAtHeight(doc,y),last=doc.first+doc.size-1;if(lineN>last){return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,null,true,1)}if(x<0){x=0}var lineObj=getLine(doc,lineN);for(;;){var found=coordsCharInner(cm,lineObj,lineN,x,y);var merged=collapsedSpanAtEnd(lineObj);var mergedPos=merged&&merged.find(0,true);if(merged&&(found.ch>mergedPos.from.ch||found.ch==mergedPos.from.ch&&found.xRel>0)){lineN=lineNo(lineObj=mergedPos.to.line)}else{return found}}}function wrappedLineExtent(cm,lineObj,preparedMeasure,y){var measure=function(ch){return intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,ch),"line")};var end=lineObj.text.length;var begin=findFirst(function(ch){return measure(ch-1).bottom<=y},end,0);end=findFirst(function(ch){return measure(ch).top>y},begin,end);return{begin:begin,end:end}}function wrappedLineExtentChar(cm,lineObj,preparedMeasure,target){var targetTop=intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,target),"line").top;return wrappedLineExtent(cm,lineObj,preparedMeasure,targetTop)}function coordsCharInner(cm,lineObj,lineNo$$1,x,y){y-=heightAtLine(lineObj);var begin=0,end=lineObj.text.length;var preparedMeasure=prepareMeasureForLine(cm,lineObj);var pos;var order=getOrder(lineObj,cm.doc.direction);if(order){if(cm.options.lineWrapping){var assign;assign=wrappedLineExtent(cm,lineObj,preparedMeasure,y),begin=assign.begin,end=assign.end,assign}pos=new Pos(lineNo$$1,Math.floor(begin+(end-begin)/2));var beginLeft=cursorCoords(cm,pos,"line",lineObj,preparedMeasure).left;var dir=beginLeft<x?1:-1;var prevDiff,diff=beginLeft-x,prevPos;var steps=Math.ceil((end-begin)/4);outer:do{prevDiff=diff;prevPos=pos;var i=0;for(;i<steps;++i){var prevPos$1=pos;pos=moveVisually(cm,lineObj,pos,dir);if(pos==null||pos.ch<begin||end<=(pos.sticky=="before"?pos.ch-1:pos.ch)){pos=prevPos$1;break outer}}diff=cursorCoords(cm,pos,"line",lineObj,preparedMeasure).left-x;if(steps>1){var diff_change_per_step=Math.abs(diff-prevDiff)/steps;steps=Math.min(steps,Math.ceil(Math.abs(diff)/diff_change_per_step));dir=diff<0?1:-1}}while(diff!=0&&(steps>1||dir<0!=diff<0&&Math.abs(diff)<=Math.abs(prevDiff)));if(Math.abs(diff)>Math.abs(prevDiff)){if(diff<0==prevDiff<0){throw new Error("Broke out of infinite loop in coordsCharInner")}pos=prevPos}}else{var ch=findFirst(function(ch){var box=intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,ch),"line");if(box.top>y){end=Math.min(ch,end);return true}else if(box.bottom<=y){return false}else if(box.left>x){return true}else if(box.right<x){return false}else{return x-box.left<box.right-x}},begin,end);ch=skipExtendingChars(lineObj.text,ch,1);pos=new Pos(lineNo$$1,ch,ch==end?"before":"after")}var coords=cursorCoords(cm,pos,"line",lineObj,preparedMeasure);if(y<coords.top||coords.bottom<y){pos.outside=true}pos.xRel=x<coords.left?-1:x>coords.right?1:0;return pos}var measureText;function textHeight(display){if(display.cachedTextHeight!=null){return display.cachedTextHeight}if(measureText==null){measureText=elt("pre");for(var i=0;i<49;++i){measureText.appendChild(document.createTextNode("x"));measureText.appendChild(elt("br"))}measureText.appendChild(document.createTextNode("x"))}removeChildrenAndAdd(display.measure,measureText);var height=measureText.offsetHeight/50;if(height>3){display.cachedTextHeight=height}removeChildren(display.measure);return height||1}function charWidth(display){if(display.cachedCharWidth!=null){return display.cachedCharWidth}var anchor=elt("span","xxxxxxxxxx");var pre=elt("pre",[anchor]);removeChildrenAndAdd(display.measure,pre);var rect=anchor.getBoundingClientRect(),width=(rect.right-rect.left)/10;if(width>2){display.cachedCharWidth=width}return width||10}function getDimensions(cm){var d=cm.display,left={},width={};var gutterLeft=d.gutters.clientLeft;for(var n=d.gutters.firstChild,i=0;n;n=n.nextSibling,++i){left[cm.options.gutters[i]]=n.offsetLeft+n.clientLeft+gutterLeft;width[cm.options.gutters[i]]=n.clientWidth}return{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth}}function compensateForHScroll(display){return display.scroller.getBoundingClientRect().left-display.sizer.getBoundingClientRect().left}function estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping;var perLine=wrapping&&Math.max(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3);return function(line){if(lineIsHidden(cm.doc,line)){return 0}var widgetsHeight=0;if(line.widgets){for(var i=0;i<line.widgets.length;i++){if(line.widgets[i].height){widgetsHeight+=line.widgets[i].height}}}if(wrapping){return widgetsHeight+(Math.ceil(line.text.length/perLine)||1)*th}else{return widgetsHeight+th}}}function estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm);doc.iter(function(line){var estHeight=est(line);if(estHeight!=line.height){updateLineHeight(line,estHeight)}})}function posFromMouse(cm,e,liberal,forRect){var display=cm.display;if(!liberal&&e_target(e).getAttribute("cm-not-content")=="true"){return null}var x,y,space=display.lineSpace.getBoundingClientRect();try{x=e.clientX-space.left;y=e.clientY-space.top}catch(e){return null}var coords=coordsChar(cm,x,y),line;if(forRect&&coords.xRel==1&&(line=getLine(cm.doc,coords.line).text).length==coords.ch){var colDiff=countColumn(line,line.length,cm.options.tabSize)-line.length;coords=Pos(coords.line,Math.max(0,Math.round((x-paddingH(cm.display).left)/charWidth(cm.display))-colDiff))}return coords}function findViewIndex(cm,n){if(n>=cm.display.viewTo){return null}n-=cm.display.viewFrom;if(n<0){return null}var view=cm.display.view;for(var i=0;i<view.length;i++){n-=view[i].size;if(n<0){return i}}}function updateSelection(cm){cm.display.input.showSelection(cm.display.input.prepareSelection())}function prepareSelection(cm,primary){var doc=cm.doc,result={};var curFragment=result.cursors=document.createDocumentFragment();var selFragment=result.selection=document.createDocumentFragment();for(var i=0;i<doc.sel.ranges.length;i++){if(primary===false&&i==doc.sel.primIndex){continue}var range$$1=doc.sel.ranges[i];if(range$$1.from().line>=cm.display.viewTo||range$$1.to().line<cm.display.viewFrom){continue}var collapsed=range$$1.empty();if(collapsed||cm.options.showCursorWhenSelecting){drawSelectionCursor(cm,range$$1.head,curFragment)}if(!collapsed){drawSelectionRange(cm,range$$1,selFragment)}}return result}function drawSelectionCursor(cm,head,output){var pos=cursorCoords(cm,head,"div",null,null,!cm.options.singleCursorHeightPerLine);var cursor=output.appendChild(elt("div"," ","CodeMirror-cursor"));cursor.style.left=pos.left+"px";cursor.style.top=pos.top+"px";cursor.style.height=Math.max(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px";if(pos.other){var otherCursor=output.appendChild(elt("div"," ","CodeMirror-cursor CodeMirror-secondarycursor"));otherCursor.style.display="";otherCursor.style.left=pos.other.left+"px";otherCursor.style.top=pos.other.top+"px";otherCursor.style.height=(pos.other.bottom-pos.other.top)*.85+"px"}}function drawSelectionRange(cm,range$$1,output){var display=cm.display,doc=cm.doc;var fragment=document.createDocumentFragment();var padding=paddingH(cm.display),leftSide=padding.left;var rightSide=Math.max(display.sizerWidth,displayWidth(cm)-display.sizer.offsetLeft)-padding.right;function add(left,top,width,bottom){if(top<0){top=0}top=Math.round(top);bottom=Math.round(bottom);fragment.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+left+"px;\n                             top: "+top+"px; width: "+(width==null?rightSide-left:width)+"px;\n                             height: "+(bottom-top)+"px"))}function drawForLine(line,fromArg,toArg){var lineObj=getLine(doc,line);var lineLen=lineObj.text.length;var start,end;function coords(ch,bias){return charCoords(cm,Pos(line,ch),"div",lineObj,bias)}iterateBidiSections(getOrder(lineObj,doc.direction),fromArg||0,toArg==null?lineLen:toArg,function(from,to,dir){var leftPos=coords(from,"left"),rightPos,left,right;if(from==to){rightPos=leftPos;left=right=leftPos.left}else{rightPos=coords(to-1,"right");if(dir=="rtl"){var tmp=leftPos;leftPos=rightPos;rightPos=tmp}left=leftPos.left;right=rightPos.right}if(fromArg==null&&from==0){left=leftSide}if(rightPos.top-leftPos.top>3){add(left,leftPos.top,null,leftPos.bottom);left=leftSide;if(leftPos.bottom<rightPos.top){add(left,leftPos.bottom,null,rightPos.top)}}if(toArg==null&&to==lineLen){right=rightSide}if(!start||leftPos.top<start.top||leftPos.top==start.top&&leftPos.left<start.left){start=leftPos}if(!end||rightPos.bottom>end.bottom||rightPos.bottom==end.bottom&&rightPos.right>end.right){end=rightPos}if(left<leftSide+1){left=leftSide}add(left,rightPos.top,right-left,rightPos.bottom)});return{start:start,end:end}}var sFrom=range$$1.from(),sTo=range$$1.to();if(sFrom.line==sTo.line){drawForLine(sFrom.line,sFrom.ch,sTo.ch)}else{var fromLine=getLine(doc,sFrom.line),toLine=getLine(doc,sTo.line);var singleVLine=visualLine(fromLine)==visualLine(toLine);var leftEnd=drawForLine(sFrom.line,sFrom.ch,singleVLine?fromLine.text.length+1:null).end;var rightStart=drawForLine(sTo.line,singleVLine?0:null,sTo.ch).start;if(singleVLine){if(leftEnd.top<rightStart.top-2){add(leftEnd.right,leftEnd.top,null,leftEnd.bottom);add(leftSide,rightStart.top,rightStart.left,rightStart.bottom)}else{add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom)}}if(leftEnd.bottom<rightStart.top){add(leftSide,leftEnd.bottom,null,rightStart.top)}}output.appendChild(fragment)}function restartBlink(cm){if(!cm.state.focused){return}var display=cm.display;clearInterval(display.blinker);var on=true;display.cursorDiv.style.visibility="";if(cm.options.cursorBlinkRate>0){display.blinker=setInterval(function(){return display.cursorDiv.style.visibility=(on=!on)?"":"hidden"},cm.options.cursorBlinkRate)}else if(cm.options.cursorBlinkRate<0){display.cursorDiv.style.visibility="hidden"}}function ensureFocus(cm){if(!cm.state.focused){cm.display.input.focus();onFocus(cm)}}function delayBlurEvent(cm){cm.state.delayingBlurEvent=true;setTimeout(function(){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false;onBlur(cm)}},100)}function onFocus(cm,e){if(cm.state.delayingBlurEvent){cm.state.delayingBlurEvent=false}if(cm.options.readOnly=="nocursor"){return}if(!cm.state.focused){signal(cm,"focus",cm,e);cm.state.focused=true;addClass(cm.display.wrapper,"CodeMirror-focused");if(!cm.curOp&&cm.display.selForContextMenu!=cm.doc.sel){cm.display.input.reset();if(webkit){setTimeout(function(){return cm.display.input.reset(true)},20)}}cm.display.input.receivedFocus()}restartBlink(cm)}function onBlur(cm,e){if(cm.state.delayingBlurEvent){return}if(cm.state.focused){signal(cm,"blur",cm,e);cm.state.focused=false;rmClass(cm.display.wrapper,"CodeMirror-focused")}clearInterval(cm.display.blinker);setTimeout(function(){if(!cm.state.focused){cm.display.shift=false}},150)}function updateHeightsInViewport(cm){var display=cm.display;var prevBottom=display.lineDiv.offsetTop;for(var i=0;i<display.view.length;i++){var cur=display.view[i],height=void 0;if(cur.hidden){continue}if(ie&&ie_version<8){var bot=cur.node.offsetTop+cur.node.offsetHeight;height=bot-prevBottom;prevBottom=bot}else{var box=cur.node.getBoundingClientRect();height=box.bottom-box.top}var diff=cur.line.height-height;if(height<2){height=textHeight(display)}if(diff>.005||diff<-.005){updateLineHeight(cur.line,height);updateWidgetHeight(cur.line);if(cur.rest){for(var j=0;j<cur.rest.length;j++){updateWidgetHeight(cur.rest[j])}}}}}function updateWidgetHeight(line){if(line.widgets){for(var i=0;i<line.widgets.length;++i){line.widgets[i].height=line.widgets[i].node.parentNode.offsetHeight}}}function visibleLines(display,doc,viewport){var top=viewport&&viewport.top!=null?Math.max(0,viewport.top):display.scroller.scrollTop;top=Math.floor(top-paddingTop(display));var bottom=viewport&&viewport.bottom!=null?viewport.bottom:top+display.wrapper.clientHeight;var from=lineAtHeight(doc,top),to=lineAtHeight(doc,bottom);if(viewport&&viewport.ensure){var ensureFrom=viewport.ensure.from.line,ensureTo=viewport.ensure.to.line;if(ensureFrom<from){from=ensureFrom;to=lineAtHeight(doc,heightAtLine(getLine(doc,ensureFrom))+display.wrapper.clientHeight)}else if(Math.min(ensureTo,doc.lastLine())>=to){from=lineAtHeight(doc,heightAtLine(getLine(doc,ensureTo))-display.wrapper.clientHeight);to=ensureTo}}return{from:from,to:Math.max(to,from+1)}}function alignHorizontally(cm){var display=cm.display,view=display.view;if(!display.alignWidgets&&(!display.gutters.firstChild||!cm.options.fixedGutter)){return}var comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft;var gutterW=display.gutters.offsetWidth,left=comp+"px";for(var i=0;i<view.length;i++){if(!view[i].hidden){if(cm.options.fixedGutter){if(view[i].gutter){view[i].gutter.style.left=left}if(view[i].gutterBackground){view[i].gutterBackground.style.left=left}}var align=view[i].alignable;if(align){for(var j=0;j<align.length;j++){align[j].style.left=left}}}}if(cm.options.fixedGutter){display.gutters.style.left=comp+gutterW+"px"}}function maybeUpdateLineNumberWidth(cm){if(!cm.options.lineNumbers){return false}var doc=cm.doc,last=lineNumberFor(cm.options,doc.first+doc.size-1),display=cm.display;if(last.length!=display.lineNumChars){var test=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt"));var innerW=test.firstChild.offsetWidth,padding=test.offsetWidth-innerW;display.lineGutter.style.width="";display.lineNumInnerWidth=Math.max(innerW,display.lineGutter.offsetWidth-padding)+1;display.lineNumWidth=display.lineNumInnerWidth+padding;display.lineNumChars=display.lineNumInnerWidth?last.length:-1;display.lineGutter.style.width=display.lineNumWidth+"px";updateGutterSpace(cm);return true}return false}function maybeScrollWindow(cm,rect){if(signalDOMEvent(cm,"scrollCursorIntoView")){return}var display=cm.display,box=display.sizer.getBoundingClientRect(),doScroll=null;if(rect.top+box.top<0){doScroll=true}else if(rect.bottom+box.top>(window.innerHeight||document.documentElement.clientHeight)){doScroll=false}if(doScroll!=null&&!phantom){var scrollNode=elt("div","​",null,"position: absolute;\n                         top: "+(rect.top-display.viewOffset-paddingTop(cm.display))+"px;\n                         height: "+(rect.bottom-rect.top+scrollGap(cm)+display.barHeight)+"px;\n                         left: "+rect.left+"px; width: "+Math.max(2,rect.right-rect.left)+"px;");cm.display.lineSpace.appendChild(scrollNode);scrollNode.scrollIntoView(doScroll);cm.display.lineSpace.removeChild(scrollNode)}}function scrollPosIntoView(cm,pos,end,margin){if(margin==null){margin=0}var rect;if(!cm.options.lineWrapping&&pos==end){pos=pos.ch?Pos(pos.line,pos.sticky=="before"?pos.ch-1:pos.ch,"after"):pos;end=pos.sticky=="before"?Pos(pos.line,pos.ch+1,"before"):pos}for(var limit=0;limit<5;limit++){var changed=false;var coords=cursorCoords(cm,pos);var endCoords=!end||end==pos?coords:cursorCoords(cm,end);rect={left:Math.min(coords.left,endCoords.left),top:Math.min(coords.top,endCoords.top)-margin,right:Math.max(coords.left,endCoords.left),bottom:Math.max(coords.bottom,endCoords.bottom)+margin};var scrollPos=calculateScrollPos(cm,rect);var startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft;if(scrollPos.scrollTop!=null){updateScrollTop(cm,scrollPos.scrollTop);if(Math.abs(cm.doc.scrollTop-startTop)>1){changed=true}}if(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft);if(Math.abs(cm.doc.scrollLeft-startLeft)>1){changed=true}}if(!changed){break}}return rect}function scrollIntoView(cm,rect){var scrollPos=calculateScrollPos(cm,rect);if(scrollPos.scrollTop!=null){updateScrollTop(cm,scrollPos.scrollTop)}if(scrollPos.scrollLeft!=null){setScrollLeft(cm,scrollPos.scrollLeft)}}function calculateScrollPos(cm,rect){var display=cm.display,snapMargin=textHeight(cm.display);if(rect.top<0){rect.top=0}var screentop=cm.curOp&&cm.curOp.scrollTop!=null?cm.curOp.scrollTop:display.scroller.scrollTop;var screen=displayHeight(cm),result={};if(rect.bottom-rect.top>screen){rect.bottom=rect.top+screen}var docBottom=cm.doc.height+paddingVert(display);var atTop=rect.top<snapMargin,atBottom=rect.bottom>docBottom-snapMargin;if(rect.top<screentop){result.scrollTop=atTop?0:rect.top}else if(rect.bottom>screentop+screen){var newTop=Math.min(rect.top,(atBottom?docBottom:rect.bottom)-screen);if(newTop!=screentop){result.scrollTop=newTop}}var screenleft=cm.curOp&&cm.curOp.scrollLeft!=null?cm.curOp.scrollLeft:display.scroller.scrollLeft;var screenw=displayWidth(cm)-(cm.options.fixedGutter?display.gutters.offsetWidth:0);var tooWide=rect.right-rect.left>screenw;if(tooWide){rect.right=rect.left+screenw}if(rect.left<10){result.scrollLeft=0}else if(rect.left<screenleft){result.scrollLeft=Math.max(0,rect.left-(tooWide?0:10))}else if(rect.right>screenw+screenleft-3){result.scrollLeft=rect.right+(tooWide?0:10)-screenw}return result}function addToScrollTop(cm,top){if(top==null){return}resolveScrollToPos(cm);cm.curOp.scrollTop=(cm.curOp.scrollTop==null?cm.doc.scrollTop:cm.curOp.scrollTop)+top}function ensureCursorVisible(cm){resolveScrollToPos(cm);var cur=cm.getCursor();cm.curOp.scrollToPos={from:cur,to:cur,margin:cm.options.cursorScrollMargin}}function scrollToCoords(cm,x,y){if(x!=null||y!=null){resolveScrollToPos(cm)}if(x!=null){cm.curOp.scrollLeft=x}if(y!=null){cm.curOp.scrollTop=y}}function scrollToRange(cm,range$$1){resolveScrollToPos(cm);cm.curOp.scrollToPos=range$$1}function resolveScrollToPos(cm){var range$$1=cm.curOp.scrollToPos;if(range$$1){cm.curOp.scrollToPos=null;var from=estimateCoords(cm,range$$1.from),to=estimateCoords(cm,range$$1.to);scrollToCoordsRange(cm,from,to,range$$1.margin)}}function scrollToCoordsRange(cm,from,to,margin){var sPos=calculateScrollPos(cm,{left:Math.min(from.left,to.left),top:Math.min(from.top,to.top)-margin,right:Math.max(from.right,to.right),bottom:Math.max(from.bottom,to.bottom)+margin});scrollToCoords(cm,sPos.scrollLeft,sPos.scrollTop)}function updateScrollTop(cm,val){if(Math.abs(cm.doc.scrollTop-val)<2){return}if(!gecko){updateDisplaySimple(cm,{top:val})}setScrollTop(cm,val,true);if(gecko){updateDisplaySimple(cm)}startWorker(cm,100)}function setScrollTop(cm,val,forceScroll){val=Math.min(cm.display.scroller.scrollHeight-cm.display.scroller.clientHeight,val);if(cm.display.scroller.scrollTop==val&&!forceScroll){return}cm.doc.scrollTop=val;cm.display.scrollbars.setScrollTop(val);if(cm.display.scroller.scrollTop!=val){cm.display.scroller.scrollTop=val}}function setScrollLeft(cm,val,isScroller,forceScroll){val=Math.min(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth);if((isScroller?val==cm.doc.scrollLeft:Math.abs(cm.doc.scrollLeft-val)<2)&&!forceScroll){return}cm.doc.scrollLeft=val;alignHorizontally(cm);if(cm.display.scroller.scrollLeft!=val){cm.display.scroller.scrollLeft=val}cm.display.scrollbars.setScrollLeft(val)}function measureForScrollbars(cm){var d=cm.display,gutterW=d.gutters.offsetWidth;var docH=Math.round(cm.doc.height+paddingVert(cm.display));return{clientHeight:d.scroller.clientHeight,viewHeight:d.wrapper.clientHeight,scrollWidth:d.scroller.scrollWidth,clientWidth:d.scroller.clientWidth,viewWidth:d.wrapper.clientWidth,barLeft:cm.options.fixedGutter?gutterW:0,docHeight:docH,scrollHeight:docH+scrollGap(cm)+d.barHeight,nativeBarWidth:d.nativeBarWidth,gutterWidth:gutterW}}var NativeScrollbars=function(place,scroll,cm){this.cm=cm;var vert=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar");var horiz=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");place(vert);place(horiz);on(vert,"scroll",function(){if(vert.clientHeight){scroll(vert.scrollTop,"vertical")}});on(horiz,"scroll",function(){if(horiz.clientWidth){scroll(horiz.scrollLeft,"horizontal")}});this.checkedZeroWidth=false;if(ie&&ie_version<8){this.horiz.style.minHeight=this.vert.style.minWidth="18px"}};NativeScrollbars.prototype.update=function(measure){var needsH=measure.scrollWidth>measure.clientWidth+1;var needsV=measure.scrollHeight>measure.clientHeight+1;var sWidth=measure.nativeBarWidth;if(needsV){this.vert.style.display="block";this.vert.style.bottom=needsH?sWidth+"px":"0";var totalHeight=measure.viewHeight-(needsH?sWidth:0);this.vert.firstChild.style.height=Math.max(0,measure.scrollHeight-measure.clientHeight+totalHeight)+"px"}else{this.vert.style.display="";this.vert.firstChild.style.height="0"}if(needsH){this.horiz.style.display="block";this.horiz.style.right=needsV?sWidth+"px":"0";this.horiz.style.left=measure.barLeft+"px";var totalWidth=measure.viewWidth-measure.barLeft-(needsV?sWidth:0);this.horiz.firstChild.style.width=Math.max(0,measure.scrollWidth-measure.clientWidth+totalWidth)+"px"}else{this.horiz.style.display="";this.horiz.firstChild.style.width="0"}if(!this.checkedZeroWidth&&measure.clientHeight>0){if(sWidth==0){this.zeroWidthHack()}this.checkedZeroWidth=true}return{right:needsV?sWidth:0,bottom:needsH?sWidth:0}};NativeScrollbars.prototype.setScrollLeft=function(pos){if(this.horiz.scrollLeft!=pos){this.horiz.scrollLeft=pos}if(this.disableHoriz){this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")}};NativeScrollbars.prototype.setScrollTop=function(pos){if(this.vert.scrollTop!=pos){this.vert.scrollTop=pos}if(this.disableVert){this.enableZeroWidthBar(this.vert,this.disableVert,"vert")}};NativeScrollbars.prototype.zeroWidthHack=function(){var w=mac&&!mac_geMountainLion?"12px":"18px";this.horiz.style.height=this.vert.style.width=w;this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new Delayed;this.disableVert=new Delayed};NativeScrollbars.prototype.enableZeroWidthBar=function(bar,delay,type){bar.style.pointerEvents="auto";function maybeDisable(){var box=bar.getBoundingClientRect();var elt$$1=type=="vert"?document.elementFromPoint(box.right-1,(box.top+box.bottom)/2):document.elementFromPoint((box.right+box.left)/2,box.bottom-1);if(elt$$1!=bar){bar.style.pointerEvents="none"}else{delay.set(1e3,maybeDisable)}}delay.set(1e3,maybeDisable)};NativeScrollbars.prototype.clear=function(){var parent=this.horiz.parentNode;parent.removeChild(this.horiz);parent.removeChild(this.vert)};var NullScrollbars=function(){};NullScrollbars.prototype.update=function(){return{bottom:0,right:0}};NullScrollbars.prototype.setScrollLeft=function(){};NullScrollbars.prototype.setScrollTop=function(){};NullScrollbars.prototype.clear=function(){};function updateScrollbars(cm,measure){if(!measure){measure=measureForScrollbars(cm)}var startWidth=cm.display.barWidth,startHeight=cm.display.barHeight;updateScrollbarsInner(cm,measure);for(var i=0;i<4&&startWidth!=cm.display.barWidth||startHeight!=cm.display.barHeight;i++){if(startWidth!=cm.display.barWidth&&cm.options.lineWrapping){updateHeightsInViewport(cm)}updateScrollbarsInner(cm,measureForScrollbars(cm));startWidth=cm.display.barWidth;startHeight=cm.display.barHeight}}function updateScrollbarsInner(cm,measure){var d=cm.display;var sizes=d.scrollbars.update(measure);d.sizer.style.paddingRight=(d.barWidth=sizes.right)+"px";d.sizer.style.paddingBottom=(d.barHeight=sizes.bottom)+"px";d.heightForcer.style.borderBottom=sizes.bottom+"px solid transparent";if(sizes.right&&sizes.bottom){d.scrollbarFiller.style.display="block";d.scrollbarFiller.style.height=sizes.bottom+"px";d.scrollbarFiller.style.width=sizes.right+"px"}else{d.scrollbarFiller.style.display=""}if(sizes.bottom&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter){d.gutterFiller.style.display="block";d.gutterFiller.style.height=sizes.bottom+"px";d.gutterFiller.style.width=measure.gutterWidth+"px"}else{d.gutterFiller.style.display=""}}var scrollbarModel={native:NativeScrollbars,null:NullScrollbars};function initScrollbars(cm){if(cm.display.scrollbars){cm.display.scrollbars.clear();if(cm.display.scrollbars.addClass){rmClass(cm.display.wrapper,cm.display.scrollbars.addClass)}}cm.display.scrollbars=new scrollbarModel[cm.options.scrollbarStyle](function(node){cm.display.wrapper.insertBefore(node,cm.display.scrollbarFiller);on(node,"mousedown",function(){if(cm.state.focused){setTimeout(function(){return cm.display.input.focus()},0)}});node.setAttribute("cm-not-content","true")},function(pos,axis){if(axis=="horizontal"){setScrollLeft(cm,pos)}else{updateScrollTop(cm,pos)}},cm);if(cm.display.scrollbars.addClass){addClass(cm.display.wrapper,cm.display.scrollbars.addClass)}}var nextOpId=0;function startOperation(cm){cm.curOp={cm:cm,viewChanged:false,startHeight:cm.doc.height,forceUpdate:false,updateInput:null,typing:false,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:false,updateMaxLine:false,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:false,id:++nextOpId};pushOperation(cm.curOp)}function endOperation(cm){var op=cm.curOp;finishOperation(op,function(group){for(var i=0;i<group.ops.length;i++){group.ops[i].cm.curOp=null}endOperations(group)})}function endOperations(group){var ops=group.ops;for(var i=0;i<ops.length;i++){endOperation_R1(ops[i])}for(var i$1=0;i$1<ops.length;i$1++){endOperation_W1(ops[i$1])}for(var i$2=0;i$2<ops.length;i$2++){endOperation_R2(ops[i$2])}for(var i$3=0;i$3<ops.length;i$3++){endOperation_W2(ops[i$3])}for(var i$4=0;i$4<ops.length;i$4++){endOperation_finish(ops[i$4])}}function endOperation_R1(op){var cm=op.cm,display=cm.display;maybeClipScrollbars(cm);if(op.updateMaxLine){findMaxLine(cm)}op.mustUpdate=op.viewChanged||op.forceUpdate||op.scrollTop!=null||op.scrollToPos&&(op.scrollToPos.from.line<display.viewFrom||op.scrollToPos.to.line>=display.viewTo)||display.maxLineChanged&&cm.options.lineWrapping;op.update=op.mustUpdate&&new DisplayUpdate(cm,op.mustUpdate&&{top:op.scrollTop,ensure:op.scrollToPos},op.forceUpdate)}function endOperation_W1(op){op.updatedDisplay=op.mustUpdate&&updateDisplayIfNeeded(op.cm,op.update)}function endOperation_R2(op){var cm=op.cm,display=cm.display;if(op.updatedDisplay){updateHeightsInViewport(cm)}op.barMeasure=measureForScrollbars(cm);if(display.maxLineChanged&&!cm.options.lineWrapping){op.adjustWidthTo=measureChar(cm,display.maxLine,display.maxLine.text.length).left+3;cm.display.sizerWidth=op.adjustWidthTo;op.barMeasure.scrollWidth=Math.max(display.scroller.clientWidth,display.sizer.offsetLeft+op.adjustWidthTo+scrollGap(cm)+cm.display.barWidth);op.maxScrollLeft=Math.max(0,display.sizer.offsetLeft+op.adjustWidthTo-displayWidth(cm))}if(op.updatedDisplay||op.selectionChanged){op.preparedSelection=display.input.prepareSelection(op.focus)}}function endOperation_W2(op){var cm=op.cm;if(op.adjustWidthTo!=null){cm.display.sizer.style.minWidth=op.adjustWidthTo+"px";if(op.maxScrollLeft<cm.doc.scrollLeft){setScrollLeft(cm,Math.min(cm.display.scroller.scrollLeft,op.maxScrollLeft),true)}cm.display.maxLineChanged=false}var takeFocus=op.focus&&op.focus==activeElt()&&(!document.hasFocus||document.hasFocus());if(op.preparedSelection){cm.display.input.showSelection(op.preparedSelection,takeFocus)}if(op.updatedDisplay||op.startHeight!=cm.doc.height){updateScrollbars(cm,op.barMeasure)}if(op.updatedDisplay){setDocumentHeight(cm,op.barMeasure)}if(op.selectionChanged){restartBlink(cm)}if(cm.state.focused&&op.updateInput){cm.display.input.reset(op.typing)}if(takeFocus){ensureFocus(op.cm)}}function endOperation_finish(op){var cm=op.cm,display=cm.display,doc=cm.doc;if(op.updatedDisplay){postUpdateDisplay(cm,op.update)}if(display.wheelStartX!=null&&(op.scrollTop!=null||op.scrollLeft!=null||op.scrollToPos)){display.wheelStartX=display.wheelStartY=null}if(op.scrollTop!=null){setScrollTop(cm,op.scrollTop,op.forceScroll)}if(op.scrollLeft!=null){setScrollLeft(cm,op.scrollLeft,true,true)}if(op.scrollToPos){var rect=scrollPosIntoView(cm,clipPos(doc,op.scrollToPos.from),clipPos(doc,op.scrollToPos.to),op.scrollToPos.margin);maybeScrollWindow(cm,rect)}var hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers;if(hidden){for(var i=0;i<hidden.length;++i){if(!hidden[i].lines.length){signal(hidden[i],"hide")}}}if(unhidden){for(var i$1=0;i$1<unhidden.length;++i$1){if(unhidden[i$1].lines.length){signal(unhidden[i$1],"unhide")}}}if(display.wrapper.offsetHeight){doc.scrollTop=cm.display.scroller.scrollTop}if(op.changeObjs){signal(cm,"changes",cm,op.changeObjs)}if(op.update){op.update.finish()}}function runInOp(cm,f){if(cm.curOp){return f()}startOperation(cm);try{return f()}finally{endOperation(cm)}}function operation(cm,f){return function(){if(cm.curOp){return f.apply(cm,arguments)}startOperation(cm);try{return f.apply(cm,arguments)}finally{endOperation(cm)}}}function methodOp(f){return function(){if(this.curOp){return f.apply(this,arguments)}startOperation(this);try{return f.apply(this,arguments)}finally{endOperation(this)}}}function docMethodOp(f){return function(){var cm=this.cm;if(!cm||cm.curOp){return f.apply(this,arguments)}startOperation(cm);try{return f.apply(this,arguments)}finally{endOperation(cm)}}}function regChange(cm,from,to,lendiff){if(from==null){from=cm.doc.first}if(to==null){to=cm.doc.first+cm.doc.size}if(!lendiff){lendiff=0}var display=cm.display;if(lendiff&&to<display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>from)){display.updateLineNumbers=from}cm.curOp.viewChanged=true;if(from>=display.viewTo){if(sawCollapsedSpans&&visualLineNo(cm.doc,from)<display.viewTo){resetView(cm)}}else if(to<=display.viewFrom){if(sawCollapsedSpans&&visualLineEndNo(cm.doc,to+lendiff)>display.viewFrom){resetView(cm)}else{display.viewFrom+=lendiff;display.viewTo+=lendiff}}else if(from<=display.viewFrom&&to>=display.viewTo){resetView(cm)}else if(from<=display.viewFrom){var cut=viewCuttingPoint(cm,to,to+lendiff,1);if(cut){display.view=display.view.slice(cut.index);display.viewFrom=cut.lineN;display.viewTo+=lendiff}else{resetView(cm)}}else if(to>=display.viewTo){var cut$1=viewCuttingPoint(cm,from,from,-1);if(cut$1){display.view=display.view.slice(0,cut$1.index);display.viewTo=cut$1.lineN}else{resetView(cm)}}else{var cutTop=viewCuttingPoint(cm,from,from,-1);var cutBot=viewCuttingPoint(cm,to,to+lendiff,1);if(cutTop&&cutBot){display.view=display.view.slice(0,cutTop.index).concat(buildViewArray(cm,cutTop.lineN,cutBot.lineN)).concat(display.view.slice(cutBot.index));display.viewTo+=lendiff}else{resetView(cm)}}var ext=display.externalMeasured;if(ext){if(to<ext.lineN){ext.lineN+=lendiff}else if(from<ext.lineN+ext.size){display.externalMeasured=null}}}function regLineChange(cm,line,type){cm.curOp.viewChanged=true;var display=cm.display,ext=cm.display.externalMeasured;if(ext&&line>=ext.lineN&&line<ext.lineN+ext.size){display.externalMeasured=null}if(line<display.viewFrom||line>=display.viewTo){return}var lineView=display.view[findViewIndex(cm,line)];if(lineView.node==null){return}var arr=lineView.changes||(lineView.changes=[]);if(indexOf(arr,type)==-1){arr.push(type)}}function resetView(cm){cm.display.viewFrom=cm.display.viewTo=cm.doc.first;cm.display.view=[];cm.display.viewOffset=0}function viewCuttingPoint(cm,oldN,newN,dir){var index=findViewIndex(cm,oldN),diff,view=cm.display.view;if(!sawCollapsedSpans||newN==cm.doc.first+cm.doc.size){return{index:index,lineN:newN}}var n=cm.display.viewFrom;for(var i=0;i<index;i++){n+=view[i].size}if(n!=oldN){if(dir>0){if(index==view.length-1){return null}diff=n+view[index].size-oldN;index++}else{diff=n-oldN}oldN+=diff;newN+=diff}while(visualLineNo(cm.doc,newN)!=newN){if(index==(dir<0?0:view.length-1)){return null}newN+=dir*view[index-(dir<0?1:0)].size;index+=dir}return{index:index,lineN:newN}}function adjustView(cm,from,to){var display=cm.display,view=display.view;if(view.length==0||from>=display.viewTo||to<=display.viewFrom){display.view=buildViewArray(cm,from,to);display.viewFrom=from}else{if(display.viewFrom>from){display.view=buildViewArray(cm,from,display.viewFrom).concat(display.view)}else if(display.viewFrom<from){display.view=display.view.slice(findViewIndex(cm,from))}display.viewFrom=from;if(display.viewTo<to){display.view=display.view.concat(buildViewArray(cm,display.viewTo,to))}else if(display.viewTo>to){display.view=display.view.slice(0,findViewIndex(cm,to))}}display.viewTo=to}function countDirtyView(cm){var view=cm.display.view,dirty=0;for(var i=0;i<view.length;i++){var lineView=view[i];if(!lineView.hidden&&(!lineView.node||lineView.changes)){++dirty}}return dirty}function startWorker(cm,time){if(cm.doc.highlightFrontier<cm.display.viewTo){cm.state.highlight.set(time,bind(highlightWorker,cm))}}function highlightWorker(cm){var doc=cm.doc;if(doc.highlightFrontier>=cm.display.viewTo){return}var end=+new Date+cm.options.workTime;var context=getContextBefore(cm,doc.highlightFrontier);var changedLines=[];doc.iter(context.line,Math.min(doc.first+doc.size,cm.display.viewTo+500),function(line){if(context.line>=cm.display.viewFrom){var oldStyles=line.styles;var resetState=line.text.length>cm.options.maxHighlightLength?copyState(doc.mode,context.state):null;var highlighted=highlightLine(cm,line,context,true);if(resetState){context.state=resetState}line.styles=highlighted.styles;var oldCls=line.styleClasses,newCls=highlighted.classes;if(newCls){line.styleClasses=newCls}else if(oldCls){line.styleClasses=null}var ischange=!oldStyles||oldStyles.length!=line.styles.length||oldCls!=newCls&&(!oldCls||!newCls||oldCls.bgClass!=newCls.bgClass||oldCls.textClass!=newCls.textClass);for(var i=0;!ischange&&i<oldStyles.length;++i){ischange=oldStyles[i]!=line.styles[i]}if(ischange){changedLines.push(context.line)}line.stateAfter=context.save();context.nextLine()}else{if(line.text.length<=cm.options.maxHighlightLength){processLine(cm,line.text,context)}line.stateAfter=context.line%5==0?context.save():null;context.nextLine()}if(+new Date>end){startWorker(cm,cm.options.workDelay);return true}});doc.highlightFrontier=context.line;doc.modeFrontier=Math.max(doc.modeFrontier,context.line);if(changedLines.length){runInOp(cm,function(){for(var i=0;i<changedLines.length;i++){regLineChange(cm,changedLines[i],"text")}})}}var DisplayUpdate=function(cm,viewport,force){var display=cm.display;this.viewport=viewport;this.visible=visibleLines(display,cm.doc,viewport);this.editorIsHidden=!display.wrapper.offsetWidth;this.wrapperHeight=display.wrapper.clientHeight;this.wrapperWidth=display.wrapper.clientWidth;this.oldDisplayWidth=displayWidth(cm);this.force=force;this.dims=getDimensions(cm);this.events=[]};DisplayUpdate.prototype.signal=function(emitter,type){if(hasHandler(emitter,type)){this.events.push(arguments)}};DisplayUpdate.prototype.finish=function(){var this$1=this;for(var i=0;i<this.events.length;i++){signal.apply(null,this$1.events[i])}};function maybeClipScrollbars(cm){var display=cm.display;if(!display.scrollbarsClipped&&display.scroller.offsetWidth){display.nativeBarWidth=display.scroller.offsetWidth-display.scroller.clientWidth;display.heightForcer.style.height=scrollGap(cm)+"px";display.sizer.style.marginBottom=-display.nativeBarWidth+"px";display.sizer.style.borderRightWidth=scrollGap(cm)+"px";display.scrollbarsClipped=true}}function selectionSnapshot(cm){if(cm.hasFocus()){return null}var active=activeElt();if(!active||!contains(cm.display.lineDiv,active)){return null}var result={activeElt:active};if(window.getSelection){var sel=window.getSelection();if(sel.anchorNode&&sel.extend&&contains(cm.display.lineDiv,sel.anchorNode)){result.anchorNode=sel.anchorNode;result.anchorOffset=sel.anchorOffset;result.focusNode=sel.focusNode;result.focusOffset=sel.focusOffset}}return result}function restoreSelection(snapshot){if(!snapshot||!snapshot.activeElt||snapshot.activeElt==activeElt()){return}snapshot.activeElt.focus();if(snapshot.anchorNode&&contains(document.body,snapshot.anchorNode)&&contains(document.body,snapshot.focusNode)){var sel=window.getSelection(),range$$1=document.createRange();range$$1.setEnd(snapshot.anchorNode,snapshot.anchorOffset);range$$1.collapse(false);sel.removeAllRanges();sel.addRange(range$$1);sel.extend(snapshot.focusNode,snapshot.focusOffset)}}function updateDisplayIfNeeded(cm,update){var display=cm.display,doc=cm.doc;if(update.editorIsHidden){resetView(cm);return false}if(!update.force&&update.visible.from>=display.viewFrom&&update.visible.to<=display.viewTo&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo)&&display.renderedView==display.view&&countDirtyView(cm)==0){return false}if(maybeUpdateLineNumberWidth(cm)){resetView(cm);update.dims=getDimensions(cm)}var end=doc.first+doc.size;var from=Math.max(update.visible.from-cm.options.viewportMargin,doc.first);var to=Math.min(end,update.visible.to+cm.options.viewportMargin);if(display.viewFrom<from&&from-display.viewFrom<20){from=Math.max(doc.first,display.viewFrom)}if(display.viewTo>to&&display.viewTo-to<20){to=Math.min(end,display.viewTo)}if(sawCollapsedSpans){from=visualLineNo(cm.doc,from);to=visualLineEndNo(cm.doc,to)}var different=from!=display.viewFrom||to!=display.viewTo||display.lastWrapHeight!=update.wrapperHeight||display.lastWrapWidth!=update.wrapperWidth;adjustView(cm,from,to);display.viewOffset=heightAtLine(getLine(cm.doc,display.viewFrom));cm.display.mover.style.top=display.viewOffset+"px";var toUpdate=countDirtyView(cm);if(!different&&toUpdate==0&&!update.force&&display.renderedView==display.view&&(display.updateLineNumbers==null||display.updateLineNumbers>=display.viewTo)){return false}var selSnapshot=selectionSnapshot(cm);if(toUpdate>4){display.lineDiv.style.display="none"}patchDisplay(cm,display.updateLineNumbers,update.dims);if(toUpdate>4){display.lineDiv.style.display=""}display.renderedView=display.view;restoreSelection(selSnapshot);removeChildren(display.cursorDiv);removeChildren(display.selectionDiv);display.gutters.style.height=display.sizer.style.minHeight=0;if(different){display.lastWrapHeight=update.wrapperHeight;display.lastWrapWidth=update.wrapperWidth;startWorker(cm,400)}display.updateLineNumbers=null;return true}function postUpdateDisplay(cm,update){var viewport=update.viewport;for(var first=true;;first=false){if(!first||!cm.options.lineWrapping||update.oldDisplayWidth==displayWidth(cm)){if(viewport&&viewport.top!=null){viewport={top:Math.min(cm.doc.height+paddingVert(cm.display)-displayHeight(cm),viewport.top)}}update.visible=visibleLines(cm.display,cm.doc,viewport);if(update.visible.from>=cm.display.viewFrom&&update.visible.to<=cm.display.viewTo){break}}if(!updateDisplayIfNeeded(cm,update)){break}updateHeightsInViewport(cm);var barMeasure=measureForScrollbars(cm);updateSelection(cm);updateScrollbars(cm,barMeasure);setDocumentHeight(cm,barMeasure);update.force=false}update.signal(cm,"update",cm);if(cm.display.viewFrom!=cm.display.reportedViewFrom||cm.display.viewTo!=cm.display.reportedViewTo){update.signal(cm,"viewportChange",cm,cm.display.viewFrom,cm.display.viewTo);cm.display.reportedViewFrom=cm.display.viewFrom;cm.display.reportedViewTo=cm.display.viewTo}}function updateDisplaySimple(cm,viewport){var update=new DisplayUpdate(cm,viewport);if(updateDisplayIfNeeded(cm,update)){updateHeightsInViewport(cm);postUpdateDisplay(cm,update);var barMeasure=measureForScrollbars(cm);updateSelection(cm);updateScrollbars(cm,barMeasure);setDocumentHeight(cm,barMeasure);update.finish()}}function patchDisplay(cm,updateNumbersFrom,dims){var display=cm.display,lineNumbers=cm.options.lineNumbers;var container=display.lineDiv,cur=container.firstChild;function rm(node){var next=node.nextSibling;if(webkit&&mac&&cm.display.currentWheelTarget==node){node.style.display="none"}else{node.parentNode.removeChild(node)}return next}var view=display.view,lineN=display.viewFrom;for(var i=0;i<view.length;i++){var lineView=view[i];if(lineView.hidden){}else if(!lineView.node||lineView.node.parentNode!=container){var node=buildLineElement(cm,lineView,lineN,dims);container.insertBefore(node,cur)}else{while(cur!=lineView.node){cur=rm(cur)}var updateNumber=lineNumbers&&updateNumbersFrom!=null&&updateNumbersFrom<=lineN&&lineView.lineNumber;if(lineView.changes){if(indexOf(lineView.changes,"gutter")>-1){updateNumber=false}updateLineForChanges(cm,lineView,lineN,dims)}if(updateNumber){removeChildren(lineView.lineNumber);lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options,lineN)))}cur=lineView.node.nextSibling}lineN+=lineView.size}while(cur){cur=rm(cur)}}function updateGutterSpace(cm){var width=cm.display.gutters.offsetWidth;cm.display.sizer.style.marginLeft=width+"px"}function setDocumentHeight(cm,measure){cm.display.sizer.style.minHeight=measure.docHeight+"px";cm.display.heightForcer.style.top=measure.docHeight+"px";cm.display.gutters.style.height=measure.docHeight+cm.display.barHeight+scrollGap(cm)+"px"}function updateGutters(cm){var gutters=cm.display.gutters,specs=cm.options.gutters;removeChildren(gutters);var i=0;for(;i<specs.length;++i){var gutterClass=specs[i];var gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+gutterClass));if(gutterClass=="CodeMirror-linenumbers"){cm.display.lineGutter=gElt;gElt.style.width=(cm.display.lineNumWidth||1)+"px"}}gutters.style.display=i?"":"none";updateGutterSpace(cm)}function setGuttersForLineNumbers(options){var found=indexOf(options.gutters,"CodeMirror-linenumbers");if(found==-1&&options.lineNumbers){options.gutters=options.gutters.concat(["CodeMirror-linenumbers"])}else if(found>-1&&!options.lineNumbers){options.gutters=options.gutters.slice(0);options.gutters.splice(found,1)}}var wheelSamples=0;var wheelPixelsPerUnit=null;if(ie){wheelPixelsPerUnit=-.53}else if(gecko){wheelPixelsPerUnit=15}else if(chrome){wheelPixelsPerUnit=-.7}else if(safari){wheelPixelsPerUnit=-1/3}function wheelEventDelta(e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY;if(dx==null&&e.detail&&e.axis==e.HORIZONTAL_AXIS){dx=e.detail}if(dy==null&&e.detail&&e.axis==e.VERTICAL_AXIS){dy=e.detail}else if(dy==null){dy=e.wheelDelta}return{x:dx,y:dy}}function wheelEventPixels(e){var delta=wheelEventDelta(e);delta.x*=wheelPixelsPerUnit;delta.y*=wheelPixelsPerUnit;return delta}function onScrollWheel(cm,e){var delta=wheelEventDelta(e),dx=delta.x,dy=delta.y;var display=cm.display,scroll=display.scroller;var canScrollX=scroll.scrollWidth>scroll.clientWidth;var canScrollY=scroll.scrollHeight>scroll.clientHeight;if(!(dx&&canScrollX||dy&&canScrollY)){return}if(dy&&mac&&webkit){outer:for(var cur=e.target,view=display.view;cur!=scroll;cur=cur.parentNode){for(var i=0;i<view.length;i++){if(view[i].node==cur){cm.display.currentWheelTarget=cur;break outer}}}}if(dx&&!gecko&&!presto&&wheelPixelsPerUnit!=null){if(dy&&canScrollY){updateScrollTop(cm,Math.max(0,scroll.scrollTop+dy*wheelPixelsPerUnit))}setScrollLeft(cm,Math.max(0,scroll.scrollLeft+dx*wheelPixelsPerUnit));if(!dy||dy&&canScrollY){e_preventDefault(e)}display.wheelStartX=null;return}if(dy&&wheelPixelsPerUnit!=null){var pixels=dy*wheelPixelsPerUnit;var top=cm.doc.scrollTop,bot=top+display.wrapper.clientHeight;if(pixels<0){top=Math.max(0,top+pixels-50)}else{bot=Math.min(cm.doc.height,bot+pixels+50)}updateDisplaySimple(cm,{top:top,bottom:bot})}if(wheelSamples<20){if(display.wheelStartX==null){display.wheelStartX=scroll.scrollLeft;display.wheelStartY=scroll.scrollTop;display.wheelDX=dx;display.wheelDY=dy;setTimeout(function(){if(display.wheelStartX==null){return}var movedX=scroll.scrollLeft-display.wheelStartX;var movedY=scroll.scrollTop-display.wheelStartY;var sample=movedY&&display.wheelDY&&movedY/display.wheelDY||movedX&&display.wheelDX&&movedX/display.wheelDX;display.wheelStartX=display.wheelStartY=null;if(!sample){return}wheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1);++wheelSamples},200)}else{display.wheelDX+=dx;display.wheelDY+=dy}}}var Selection=function(ranges,primIndex){this.ranges=ranges;this.primIndex=primIndex};Selection.prototype.primary=function(){return this.ranges[this.primIndex]};Selection.prototype.equals=function(other){var this$1=this;if(other==this){return true}if(other.primIndex!=this.primIndex||other.ranges.length!=this.ranges.length){return false}for(var i=0;i<this.ranges.length;i++){var here=this$1.ranges[i],there=other.ranges[i];if(!equalCursorPos(here.anchor,there.anchor)||!equalCursorPos(here.head,there.head)){return false}}return true};Selection.prototype.deepCopy=function(){var this$1=this;var out=[];for(var i=0;i<this.ranges.length;i++){out[i]=new Range(copyPos(this$1.ranges[i].anchor),copyPos(this$1.ranges[i].head))}return new Selection(out,this.primIndex)};Selection.prototype.somethingSelected=function(){var this$1=this;for(var i=0;i<this.ranges.length;i++){if(!this$1.ranges[i].empty()){return true}}return false};Selection.prototype.contains=function(pos,end){var this$1=this;if(!end){end=pos}for(var i=0;i<this.ranges.length;i++){var range=this$1.ranges[i];if(cmp(end,range.from())>=0&&cmp(pos,range.to())<=0){return i}}return-1};var Range=function(anchor,head){this.anchor=anchor;this.head=head};Range.prototype.from=function(){return minPos(this.anchor,this.head)};Range.prototype.to=function(){return maxPos(this.anchor,this.head)};Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};function normalizeSelection(ranges,primIndex){var prim=ranges[primIndex];ranges.sort(function(a,b){return cmp(a.from(),b.from())});primIndex=indexOf(ranges,prim);for(var i=1;i<ranges.length;i++){var cur=ranges[i],prev=ranges[i-1];if(cmp(prev.to(),cur.from())>=0){var from=minPos(prev.from(),cur.from()),to=maxPos(prev.to(),cur.to());var inv=prev.empty()?cur.from()==cur.head:prev.from()==prev.head;if(i<=primIndex){--primIndex}ranges.splice(--i,2,new Range(inv?to:from,inv?from:to))}}return new Selection(ranges,primIndex)}function simpleSelection(anchor,head){return new Selection([new Range(anchor,head||anchor)],0)}function changeEnd(change){if(!change.text){return change.to}return Pos(change.from.line+change.text.length-1,lst(change.text).length+(change.text.length==1?change.from.ch:0))}function adjustForChange(pos,change){if(cmp(pos,change.from)<0){return pos}if(cmp(pos,change.to)<=0){return changeEnd(change)}var line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch;if(pos.line==change.to.line){ch+=changeEnd(change).ch-change.to.ch}return Pos(line,ch)}function computeSelAfterChange(doc,change){var out=[];for(var i=0;i<doc.sel.ranges.length;i++){var range=doc.sel.ranges[i];out.push(new Range(adjustForChange(range.anchor,change),adjustForChange(range.head,change)))}return normalizeSelection(out,doc.sel.primIndex)}function offsetPos(pos,old,nw){if(pos.line==old.line){return Pos(nw.line,pos.ch-old.ch+nw.ch)}else{return Pos(nw.line+(pos.line-old.line),pos.ch)}}function computeReplacedSel(doc,changes,hint){var out=[];var oldPrev=Pos(doc.first,0),newPrev=oldPrev;for(var i=0;i<changes.length;i++){var change=changes[i];var from=offsetPos(change.from,oldPrev,newPrev);var to=offsetPos(changeEnd(change),oldPrev,newPrev);oldPrev=change.to;newPrev=to;if(hint=="around"){var range=doc.sel.ranges[i],inv=cmp(range.head,range.anchor)<0;out[i]=new Range(inv?to:from,inv?from:to)}else{out[i]=new Range(from,from)}}return new Selection(out,doc.sel.primIndex)}function loadMode(cm){cm.doc.mode=getMode(cm.options,cm.doc.modeOption);resetModeState(cm)}function resetModeState(cm){cm.doc.iter(function(line){if(line.stateAfter){line.stateAfter=null}if(line.styles){line.styles=null}});cm.doc.modeFrontier=cm.doc.highlightFrontier=cm.doc.first;startWorker(cm,100);cm.state.modeGen++;if(cm.curOp){regChange(cm)}}function isWholeLineUpdate(doc,change){return change.from.ch==0&&change.to.ch==0&&lst(change.text)==""&&(!doc.cm||doc.cm.options.wholeLineUpdateBefore)}function updateDoc(doc,change,markedSpans,estimateHeight$$1){function spansFor(n){return markedSpans?markedSpans[n]:null}function update(line,text,spans){updateLine(line,text,spans,estimateHeight$$1);signalLater(line,"change",line,change)}function linesFor(start,end){var result=[];for(var i=start;i<end;++i){result.push(new Line(text[i],spansFor(i),estimateHeight$$1))}return result}var from=change.from,to=change.to,text=change.text;var firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line);var lastText=lst(text),lastSpans=spansFor(text.length-1),nlines=to.line-from.line;if(change.full){doc.insert(0,linesFor(0,text.length));doc.remove(text.length,doc.size-text.length)}else if(isWholeLineUpdate(doc,change)){var added=linesFor(0,text.length-1);update(lastLine,lastLine.text,lastSpans);if(nlines){doc.remove(from.line,nlines)}if(added.length){doc.insert(from.line,added)}}else if(firstLine==lastLine){if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),lastSpans)}else{var added$1=linesFor(1,text.length-1);added$1.push(new Line(lastText+firstLine.text.slice(to.ch),lastSpans,estimateHeight$$1));update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0));doc.insert(from.line+1,added$1)}}else if(text.length==1){update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0));doc.remove(from.line+1,nlines)}else{update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0));update(lastLine,lastText+lastLine.text.slice(to.ch),lastSpans);var added$2=linesFor(1,text.length-1);if(nlines>1){doc.remove(from.line+1,nlines-1)}doc.insert(from.line+1,added$2)}signalLater(doc,"change",doc,change)}function linkedDocs(doc,f,sharedHistOnly){function propagate(doc,skip,sharedHist){if(doc.linked){for(var i=0;i<doc.linked.length;++i){var rel=doc.linked[i];if(rel.doc==skip){continue}var shared=sharedHist&&rel.sharedHist;if(sharedHistOnly&&!shared){continue}f(rel.doc,shared);propagate(rel.doc,doc,shared)}}}propagate(doc,null,true)}function attachDoc(cm,doc){if(doc.cm){throw new Error("This document is already in use.")}cm.doc=doc;doc.cm=cm;estimateLineHeights(cm);loadMode(cm);setDirectionClass(cm);if(!cm.options.lineWrapping){findMaxLine(cm)}cm.options.mode=doc.modeOption;regChange(cm)}function setDirectionClass(cm){(cm.doc.direction=="rtl"?addClass:rmClass)(cm.display.lineDiv,"CodeMirror-rtl")}function directionChanged(cm){runInOp(cm,function(){setDirectionClass(cm);regChange(cm)})}function History(startGen){this.done=[];this.undone=[];this.undoDepth=Infinity;this.lastModTime=this.lastSelTime=0;this.lastOp=this.lastSelOp=null;this.lastOrigin=this.lastSelOrigin=null;this.generation=this.maxGeneration=startGen||1}function historyChangeFromChange(doc,change){var histChange={from:copyPos(change.from),to:changeEnd(change),text:getBetween(doc,change.from,change.to)};attachLocalSpans(doc,histChange,change.from.line,change.to.line+1);linkedDocs(doc,function(doc){return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1)},true);return histChange}function clearSelectionEvents(array){while(array.length){var last=lst(array);if(last.ranges){array.pop()}else{break}}}function lastChangeEvent(hist,force){if(force){clearSelectionEvents(hist.done);return lst(hist.done)}else if(hist.done.length&&!lst(hist.done).ranges){return lst(hist.done)}else if(hist.done.length>1&&!hist.done[hist.done.length-2].ranges){hist.done.pop();return lst(hist.done)}}function addChangeToHistory(doc,change,selAfter,opId){var hist=doc.history;hist.undone.length=0;var time=+new Date,cur;var last;if((hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&(change.origin.charAt(0)=="+"&&doc.cm&&hist.lastModTime>time-doc.cm.options.historyEventDelay||change.origin.charAt(0)=="*"))&&(cur=lastChangeEvent(hist,hist.lastOp==opId))){last=lst(cur.changes);if(cmp(change.from,change.to)==0&&cmp(change.from,last.to)==0){last.to=changeEnd(change)}else{cur.changes.push(historyChangeFromChange(doc,change))}}else{var before=lst(hist.done);if(!before||!before.ranges){pushSelectionToHistory(doc.sel,hist.done)}cur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation};hist.done.push(cur);while(hist.done.length>hist.undoDepth){hist.done.shift();if(!hist.done[0].ranges){hist.done.shift()}}}hist.done.push(selAfter);hist.generation=++hist.maxGeneration;hist.lastModTime=hist.lastSelTime=time;hist.lastOp=hist.lastSelOp=opId;hist.lastOrigin=hist.lastSelOrigin=change.origin;if(!last){signal(doc,"historyAdded")}}function selectionEventCanBeMerged(doc,origin,prev,sel){var ch=origin.charAt(0);return ch=="*"||ch=="+"&&prev.ranges.length==sel.ranges.length&&prev.somethingSelected()==sel.somethingSelected()&&new Date-doc.history.lastSelTime<=(doc.cm?doc.cm.options.historyEventDelay:500)}function addSelectionToHistory(doc,sel,opId,options){var hist=doc.history,origin=options&&options.origin;if(opId==hist.lastSelOp||origin&&hist.lastSelOrigin==origin&&(hist.lastModTime==hist.lastSelTime&&hist.lastOrigin==origin||selectionEventCanBeMerged(doc,origin,lst(hist.done),sel))){hist.done[hist.done.length-1]=sel}else{pushSelectionToHistory(sel,hist.done)}hist.lastSelTime=+new Date;hist.lastSelOrigin=origin;hist.lastSelOp=opId;if(options&&options.clearRedo!==false){clearSelectionEvents(hist.undone)}}function pushSelectionToHistory(sel,dest){var top=lst(dest);if(!(top&&top.ranges&&top.equals(sel))){dest.push(sel)}}function attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0;doc.iter(Math.max(doc.first,from),Math.min(doc.first+doc.size,to),function(line){if(line.markedSpans){(existing||(existing=change["spans_"+doc.id]={}))[n]=line.markedSpans}++n})}function removeClearedSpans(spans){if(!spans){return null}var out;for(var i=0;i<spans.length;++i){if(spans[i].marker.explicitlyCleared){if(!out){out=spans.slice(0,i)}}else if(out){out.push(spans[i])}}return!out?spans:out.length?out:null}function getOldSpans(doc,change){var found=change["spans_"+doc.id];if(!found){return null}var nw=[];for(var i=0;i<change.text.length;++i){nw.push(removeClearedSpans(found[i]))}return nw}function mergeOldSpans(doc,change){var old=getOldSpans(doc,change);var stretched=stretchSpansOverChange(doc,change);if(!old){return stretched}if(!stretched){return old}for(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i];if(oldCur&&stretchCur){spans:for(var j=0;j<stretchCur.length;++j){var span=stretchCur[j];for(var k=0;k<oldCur.length;++k){if(oldCur[k].marker==span.marker){continue spans}}oldCur.push(span)}}else if(stretchCur){old[i]=stretchCur}}return old}function copyHistoryArray(events,newGroup,instantiateSel){var copy=[];for(var i=0;i<events.length;++i){var event=events[i];if(event.ranges){copy.push(instantiateSel?Selection.prototype.deepCopy.call(event):event);continue}var changes=event.changes,newChanges=[];copy.push({changes:newChanges});for(var j=0;j<changes.length;++j){var change=changes[j],m=void 0;newChanges.push({from:change.from,to:change.to,text:change.text});if(newGroup){for(var prop in change){if(m=prop.match(/^spans_(\d+)$/)){if(indexOf(newGroup,Number(m[1]))>-1){lst(newChanges)[prop]=change[prop];delete change[prop]}}}}}}return copy}function extendRange(range,head,other,extend){if(extend){var anchor=range.anchor;if(other){var posBefore=cmp(head,anchor)<0;if(posBefore!=cmp(other,anchor)<0){anchor=head;head=other}else if(posBefore!=cmp(head,other)<0){head=other}}return new Range(anchor,head)}else{return new Range(other||head,head)}}function extendSelection(doc,head,other,options,extend){if(extend==null){extend=doc.cm&&(doc.cm.display.shift||doc.extend)}setSelection(doc,new Selection([extendRange(doc.sel.primary(),head,other,extend)],0),options)}function extendSelections(doc,heads,options){var out=[];var extend=doc.cm&&(doc.cm.display.shift||doc.extend);for(var i=0;i<doc.sel.ranges.length;i++){out[i]=extendRange(doc.sel.ranges[i],heads[i],null,extend)}var newSel=normalizeSelection(out,doc.sel.primIndex);setSelection(doc,newSel,options)}function replaceOneSelection(doc,i,range,options){var ranges=doc.sel.ranges.slice(0);ranges[i]=range;setSelection(doc,normalizeSelection(ranges,doc.sel.primIndex),options)}function setSimpleSelection(doc,anchor,head,options){setSelection(doc,simpleSelection(anchor,head),options)}function filterSelectionChange(doc,sel,options){var obj={ranges:sel.ranges,update:function(ranges){var this$1=this;this.ranges=[];for(var i=0;i<ranges.length;i++){this$1.ranges[i]=new Range(clipPos(doc,ranges[i].anchor),clipPos(doc,ranges[i].head))}},origin:options&&options.origin};signal(doc,"beforeSelectionChange",doc,obj);if(doc.cm){signal(doc.cm,"beforeSelectionChange",doc.cm,obj)}if(obj.ranges!=sel.ranges){return normalizeSelection(obj.ranges,obj.ranges.length-1)}else{return sel}}function setSelectionReplaceHistory(doc,sel,options){var done=doc.history.done,last=lst(done);if(last&&last.ranges){done[done.length-1]=sel;setSelectionNoUndo(doc,sel,options)}else{setSelection(doc,sel,options)}}function setSelection(doc,sel,options){setSelectionNoUndo(doc,sel,options);addSelectionToHistory(doc,doc.sel,doc.cm?doc.cm.curOp.id:NaN,options)}function setSelectionNoUndo(doc,sel,options){if(hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange")){sel=filterSelectionChange(doc,sel,options)}var bias=options&&options.bias||(cmp(sel.primary().head,doc.sel.primary().head)<0?-1:1);setSelectionInner(doc,skipAtomicInSelection(doc,sel,bias,true));if(!(options&&options.scroll===false)&&doc.cm){ensureCursorVisible(doc.cm)}}function setSelectionInner(doc,sel){if(sel.equals(doc.sel)){return}doc.sel=sel;if(doc.cm){doc.cm.curOp.updateInput=doc.cm.curOp.selectionChanged=true;signalCursorActivity(doc.cm)}signalLater(doc,"cursorActivity",doc)}function reCheckSelection(doc){setSelectionInner(doc,skipAtomicInSelection(doc,doc.sel,null,false))}function skipAtomicInSelection(doc,sel,bias,mayClear){var out;for(var i=0;i<sel.ranges.length;i++){var range=sel.ranges[i];var old=sel.ranges.length==doc.sel.ranges.length&&doc.sel.ranges[i];var newAnchor=skipAtomic(doc,range.anchor,old&&old.anchor,bias,mayClear);var newHead=skipAtomic(doc,range.head,old&&old.head,bias,mayClear);if(out||newAnchor!=range.anchor||newHead!=range.head){if(!out){out=sel.ranges.slice(0,i)}out[i]=new Range(newAnchor,newHead)}}return out?normalizeSelection(out,sel.primIndex):sel}function skipAtomicInner(doc,pos,oldPos,dir,mayClear){var line=getLine(doc,pos.line);if(line.markedSpans){for(var i=0;i<line.markedSpans.length;++i){var sp=line.markedSpans[i],m=sp.marker;if((sp.from==null||(m.inclusiveLeft?sp.from<=pos.ch:sp.from<pos.ch))&&(sp.to==null||(m.inclusiveRight?sp.to>=pos.ch:sp.to>pos.ch))){if(mayClear){signal(m,"beforeCursorEnter");if(m.explicitlyCleared){if(!line.markedSpans){break}else{--i;continue}}}if(!m.atomic){continue}if(oldPos){var near=m.find(dir<0?1:-1),diff=void 0;if(dir<0?m.inclusiveRight:m.inclusiveLeft){near=movePos(doc,near,-dir,near&&near.line==pos.line?line:null)}if(near&&near.line==pos.line&&(diff=cmp(near,oldPos))&&(dir<0?diff<0:diff>0)){return skipAtomicInner(doc,near,pos,dir,mayClear)}}var far=m.find(dir<0?-1:1);if(dir<0?m.inclusiveLeft:m.inclusiveRight){far=movePos(doc,far,dir,far.line==pos.line?line:null)}return far?skipAtomicInner(doc,far,pos,dir,mayClear):null}}}return pos}function skipAtomic(doc,pos,oldPos,bias,mayClear){var dir=bias||1;var found=skipAtomicInner(doc,pos,oldPos,dir,mayClear)||!mayClear&&skipAtomicInner(doc,pos,oldPos,dir,true)||skipAtomicInner(doc,pos,oldPos,-dir,mayClear)||!mayClear&&skipAtomicInner(doc,pos,oldPos,-dir,true);if(!found){doc.cantEdit=true;return Pos(doc.first,0)}return found}function movePos(doc,pos,dir,line){if(dir<0&&pos.ch==0){if(pos.line>doc.first){return clipPos(doc,Pos(pos.line-1))}else{return null}}else if(dir>0&&pos.ch==(line||getLine(doc,pos.line)).text.length){if(pos.line<doc.first+doc.size-1){return Pos(pos.line+1,0)}else{return null}}else{return new Pos(pos.line,pos.ch+dir)}}function selectAll(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()),sel_dontScroll)}function filterChange(doc,change,update){var obj={canceled:false,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function(){return obj.canceled=true}};if(update){obj.update=function(from,to,text,origin){if(from){obj.from=clipPos(doc,from)}if(to){obj.to=clipPos(doc,to)}if(text){obj.text=text}if(origin!==undefined){obj.origin=origin}}}signal(doc,"beforeChange",doc,obj);if(doc.cm){signal(doc.cm,"beforeChange",doc.cm,obj)}if(obj.canceled){return null}return{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin}}function makeChange(doc,change,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp){return operation(doc.cm,makeChange)(doc,change,ignoreReadOnly)}if(doc.cm.state.suppressEdits){return}}if(hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange")){change=filterChange(doc,change,true);if(!change){return}}var split=sawReadOnlySpans&&!ignoreReadOnly&&removeReadOnlyRanges(doc,change.from,change.to);if(split){for(var i=split.length-1;i>=0;--i){makeChangeInner(doc,{from:split[i].from,to:split[i].to,text:i?[""]:change.text,origin:change.origin})}}else{makeChangeInner(doc,change)}}function makeChangeInner(doc,change){if(change.text.length==1&&change.text[0]==""&&cmp(change.from,change.to)==0){return}var selAfter=computeSelAfterChange(doc,change);addChangeToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN);makeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change));var rebased=[];linkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change);rebased.push(doc.history)}makeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change))})}function makeChangeFromHistory(doc,type,allowSelectionOnly){if(doc.cm&&doc.cm.state.suppressEdits&&!allowSelectionOnly){return}var hist=doc.history,event,selAfter=doc.sel;var source=type=="undo"?hist.done:hist.undone,dest=type=="undo"?hist.undone:hist.done;var i=0;for(;i<source.length;i++){event=source[i];if(allowSelectionOnly?event.ranges&&!event.equals(doc.sel):!event.ranges){break}}if(i==source.length){return}hist.lastOrigin=hist.lastSelOrigin=null;for(;;){event=source.pop();if(event.ranges){pushSelectionToHistory(event,dest);if(allowSelectionOnly&&!event.equals(doc.sel)){setSelection(doc,event,{clearRedo:false});return}selAfter=event}else{break}}var antiChanges=[];pushSelectionToHistory(selAfter,dest);dest.push({changes:antiChanges,generation:hist.generation});hist.generation=event.generation||++hist.maxGeneration;var filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange");var loop=function(i){var change=event.changes[i];change.origin=type;if(filter&&!filterChange(doc,change,false)){source.length=0;return{}}antiChanges.push(historyChangeFromChange(doc,change));var after=i?computeSelAfterChange(doc,change):lst(source);makeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change));if(!i&&doc.cm){doc.cm.scrollIntoView({from:change.from,to:changeEnd(change)})}var rebased=[];linkedDocs(doc,function(doc,sharedHist){if(!sharedHist&&indexOf(rebased,doc.history)==-1){rebaseHist(doc.history,change);rebased.push(doc.history)}makeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change))})};for(var i$1=event.changes.length-1;i$1>=0;--i$1){var returned=loop(i$1);if(returned)return returned.v}}function shiftDoc(doc,distance){if(distance==0){return}doc.first+=distance;doc.sel=new Selection(map(doc.sel.ranges,function(range){return new Range(Pos(range.anchor.line+distance,range.anchor.ch),Pos(range.head.line+distance,range.head.ch))}),doc.sel.primIndex);if(doc.cm){regChange(doc.cm,doc.first,doc.first-distance,distance);for(var d=doc.cm.display,l=d.viewFrom;l<d.viewTo;l++){regLineChange(doc.cm,l,"gutter")}}}function makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp){return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans)}if(change.to.line<doc.first){shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line));return}if(change.from.line>doc.lastLine()){return}if(change.from.line<doc.first){var shift=change.text.length-1-(doc.first-change.from.line);shiftDoc(doc,shift);change={from:Pos(doc.first,0),to:Pos(change.to.line+shift,change.to.ch),text:[lst(change.text)],origin:change.origin}}var last=doc.lastLine();if(change.to.line>last){change={from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin}}change.removed=getBetween(doc,change.from,change.to);if(!selAfter){selAfter=computeSelAfterChange(doc,change)}if(doc.cm){makeChangeSingleDocInEditor(doc.cm,change,spans)}else{updateDoc(doc,change,spans)}setSelectionNoUndo(doc,selAfter,sel_dontScroll)}function makeChangeSingleDocInEditor(cm,change,spans){var doc=cm.doc,display=cm.display,from=change.from,to=change.to;var recomputeMaxLength=false,checkWidthStart=from.line;if(!cm.options.lineWrapping){checkWidthStart=lineNo(visualLine(getLine(doc,from.line)));doc.iter(checkWidthStart,to.line+1,function(line){if(line==display.maxLine){recomputeMaxLength=true;return true}})}if(doc.sel.contains(change.from,change.to)>-1){signalCursorActivity(cm)}updateDoc(doc,change,spans,estimateHeight(cm));if(!cm.options.lineWrapping){doc.iter(checkWidthStart,from.line+change.text.length,function(line){var len=lineLength(line);if(len>display.maxLineLength){display.maxLine=line;display.maxLineLength=len;display.maxLineChanged=true;recomputeMaxLength=false}});if(recomputeMaxLength){cm.curOp.updateMaxLine=true}}retreatFrontier(doc,from.line);startWorker(cm,400);var lendiff=change.text.length-(to.line-from.line)-1;if(change.full){regChange(cm)}else if(from.line==to.line&&change.text.length==1&&!isWholeLineUpdate(cm.doc,change)){regLineChange(cm,from.line,"text")}else{regChange(cm,from.line,to.line+1,lendiff)}var changesHandler=hasHandler(cm,"changes"),changeHandler=hasHandler(cm,"change");if(changeHandler||changesHandler){var obj={from:from,to:to,text:change.text,removed:change.removed,origin:change.origin};if(changeHandler){signalLater(cm,"change",cm,obj)}if(changesHandler){(cm.curOp.changeObjs||(cm.curOp.changeObjs=[])).push(obj)}}cm.display.selForContextMenu=null}function replaceRange(doc,code,from,to,origin){if(!to){to=from}if(cmp(to,from)<0){var tmp=to;to=from;from=tmp}if(typeof code=="string"){code=doc.splitLines(code)}makeChange(doc,{from:from,to:to,text:code,origin:origin})}function rebaseHistSelSingle(pos,from,to,diff){if(to<pos.line){pos.line+=diff}else if(from<pos.line){pos.line=from;pos.ch=0}}function rebaseHistArray(array,from,to,diff){for(var i=0;i<array.length;++i){var sub=array[i],ok=true;if(sub.ranges){if(!sub.copied){sub=array[i]=sub.deepCopy();sub.copied=true}for(var j=0;j<sub.ranges.length;j++){rebaseHistSelSingle(sub.ranges[j].anchor,from,to,diff);rebaseHistSelSingle(sub.ranges[j].head,from,to,diff)}continue}for(var j$1=0;j$1<sub.changes.length;++j$1){var cur=sub.changes[j$1];if(to<cur.from.line){cur.from=Pos(cur.from.line+diff,cur.from.ch);cur.to=Pos(cur.to.line+diff,cur.to.ch)}else if(from<=cur.to.line){ok=false;break}}if(!ok){array.splice(0,i+1);i=0}}}function rebaseHist(hist,change){var from=change.from.line,to=change.to.line,diff=change.text.length-(to-from)-1;rebaseHistArray(hist.done,from,to,diff);rebaseHistArray(hist.undone,from,to,diff)}function changeLine(doc,handle,changeType,op){var no=handle,line=handle;if(typeof handle=="number"){line=getLine(doc,clipLine(doc,handle))}else{no=lineNo(handle)}if(no==null){return null}if(op(line,no)&&doc.cm){regLineChange(doc.cm,no,changeType)}return line}function LeafChunk(lines){var this$1=this;this.lines=lines;this.parent=null;var height=0;for(var i=0;i<lines.length;++i){lines[i].parent=this$1;height+=lines[i].height}this.height=height}LeafChunk.prototype={chunkSize:function chunkSize(){return this.lines.length},removeInner:function removeInner(at,n){var this$1=this;for(var i=at,e=at+n;i<e;++i){var line=this$1.lines[i];this$1.height-=line.height;cleanUpLine(line);signalLater(line,"delete")}this.lines.splice(at,n)},collapse:function collapse(lines){lines.push.apply(lines,this.lines)},insertInner:function insertInner(at,lines,height){var this$1=this;this.height+=height;this.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at));for(var i=0;i<lines.length;++i){lines[i].parent=this$1}},iterN:function iterN(at,n,op){var this$1=this;for(var e=at+n;at<e;++at){if(op(this$1.lines[at])){return true}}}};function BranchChunk(children){var this$1=this;this.children=children;var size=0,height=0;for(var i=0;i<children.length;++i){var ch=children[i];size+=ch.chunkSize();height+=ch.height;ch.parent=this$1}this.size=size;this.height=height;this.parent=null}BranchChunk.prototype={chunkSize:function chunkSize(){return this.size},removeInner:function removeInner(at,n){var this$1=this;this.size-=n;for(var i=0;i<this.children.length;++i){var child=this$1.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;child.removeInner(at,rm);this$1.height-=oldHeight-child.height;if(sz==rm){this$1.children.splice(i--,1);child.parent=null}if((n-=rm)==0){break}at=0}else{at-=sz}}if(this.size-n<25&&(this.children.length>1||!(this.children[0]instanceof LeafChunk))){var lines=[];this.collapse(lines);this.children=[new LeafChunk(lines)];this.children[0].parent=this}},collapse:function collapse(lines){var this$1=this;for(var i=0;i<this.children.length;++i){this$1.children[i].collapse(lines)}},insertInner:function insertInner(at,lines,height){var this$1=this;this.size+=lines.length;this.height+=height;for(var i=0;i<this.children.length;++i){var child=this$1.children[i],sz=child.chunkSize();if(at<=sz){child.insertInner(at,lines,height);if(child.lines&&child.lines.length>50){var remaining=child.lines.length%25+25;for(var pos=remaining;pos<child.lines.length;){var leaf=new LeafChunk(child.lines.slice(pos,pos+=25));child.height-=leaf.height;this$1.children.splice(++i,0,leaf);leaf.parent=this$1}child.lines=child.lines.slice(0,remaining);this$1.maybeSpill()}break}at-=sz}},maybeSpill:function maybeSpill(){if(this.children.length<=10){return}var me=this;do{var spilled=me.children.splice(me.children.length-5,5);var sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);copy.parent=me;me.children=[copy,sibling];me=copy}else{me.size-=sibling.size;me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling)}sibling.parent=me.parent}while(me.children.length>10);me.parent.maybeSpill()},iterN:function iterN(at,n,op){var this$1=this;for(var i=0;i<this.children.length;++i){var child=this$1.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op)){return true}if((n-=used)==0){break}at=0}else{at-=sz}}}};var LineWidget=function(doc,node,options){var this$1=this;if(options){for(var opt in options){if(options.hasOwnProperty(opt)){this$1[opt]=options[opt]}}}this.doc=doc;this.node=node};LineWidget.prototype.clear=function(){var this$1=this;var cm=this.doc.cm,ws=this.line.widgets,line=this.line,no=lineNo(line);if(no==null||!ws){return}for(var i=0;i<ws.length;++i){if(ws[i]==this$1){ws.splice(i--,1)}}if(!ws.length){line.widgets=null}var height=widgetHeight(this);updateLineHeight(line,Math.max(0,line.height-height));if(cm){runInOp(cm,function(){adjustScrollWhenAboveVisible(cm,line,-height);regLineChange(cm,no,"widget")});signalLater(cm,"lineWidgetCleared",cm,this,no)}};LineWidget.prototype.changed=function(){var this$1=this;var oldH=this.height,cm=this.doc.cm,line=this.line;this.height=null;var diff=widgetHeight(this)-oldH;if(!diff){return}updateLineHeight(line,line.height+diff);if(cm){runInOp(cm,function(){cm.curOp.forceUpdate=true;adjustScrollWhenAboveVisible(cm,line,diff);signalLater(cm,"lineWidgetChanged",cm,this$1,lineNo(line))})}};eventMixin(LineWidget);function adjustScrollWhenAboveVisible(cm,line,diff){if(heightAtLine(line)<(cm.curOp&&cm.curOp.scrollTop||cm.doc.scrollTop)){addToScrollTop(cm,diff)}}function addLineWidget(doc,handle,node,options){var widget=new LineWidget(doc,node,options);var cm=doc.cm;if(cm&&widget.noHScroll){cm.display.alignWidgets=true}changeLine(doc,handle,"widget",function(line){var widgets=line.widgets||(line.widgets=[]);if(widget.insertAt==null){widgets.push(widget)}else{widgets.splice(Math.min(widgets.length-1,Math.max(0,widget.insertAt)),0,widget)}widget.line=line;if(cm&&!lineIsHidden(doc,line)){var aboveVisible=heightAtLine(line)<doc.scrollTop;updateLineHeight(line,line.height+widgetHeight(widget));if(aboveVisible){addToScrollTop(cm,widget.height)}cm.curOp.forceUpdate=true}return true});signalLater(cm,"lineWidgetAdded",cm,widget,typeof handle=="number"?handle:lineNo(handle));return widget}var nextMarkerId=0;var TextMarker=function(doc,type){this.lines=[];this.type=type;this.doc=doc;this.id=++nextMarkerId};TextMarker.prototype.clear=function(){var this$1=this;if(this.explicitlyCleared){return}var cm=this.doc.cm,withOp=cm&&!cm.curOp;if(withOp){startOperation(cm)}if(hasHandler(this,"clear")){var found=this.find();if(found){signalLater(this,"clear",found.from,found.to)}}var min=null,max=null;for(var i=0;i<this.lines.length;++i){var line=this$1.lines[i];var span=getMarkedSpanFor(line.markedSpans,this$1);if(cm&&!this$1.collapsed){regLineChange(cm,lineNo(line),"text")}else if(cm){if(span.to!=null){max=lineNo(line)}if(span.from!=null){min=lineNo(line)}}line.markedSpans=removeMarkedSpan(line.markedSpans,span);if(span.from==null&&this$1.collapsed&&!lineIsHidden(this$1.doc,line)&&cm){updateLineHeight(line,textHeight(cm.display))}}if(cm&&this.collapsed&&!cm.options.lineWrapping){for(var i$1=0;i$1<this.lines.length;++i$1){var visual=visualLine(this$1.lines[i$1]),len=lineLength(visual);if(len>cm.display.maxLineLength){cm.display.maxLine=visual;cm.display.maxLineLength=len;cm.display.maxLineChanged=true}}}if(min!=null&&cm&&this.collapsed){regChange(cm,min,max+1)}this.lines.length=0;this.explicitlyCleared=true;if(this.atomic&&this.doc.cantEdit){this.doc.cantEdit=false;if(cm){reCheckSelection(cm.doc)}}if(cm){signalLater(cm,"markerCleared",cm,this,min,max)}if(withOp){endOperation(cm)}if(this.parent){this.parent.clear()}};TextMarker.prototype.find=function(side,lineObj){var this$1=this;if(side==null&&this.type=="bookmark"){side=1}var from,to;for(var i=0;i<this.lines.length;++i){var line=this$1.lines[i];var span=getMarkedSpanFor(line.markedSpans,this$1);if(span.from!=null){from=Pos(lineObj?line:lineNo(line),span.from);if(side==-1){return from}}if(span.to!=null){to=Pos(lineObj?line:lineNo(line),span.to);if(side==1){return to}}}return from&&{from:from,to:to}};TextMarker.prototype.changed=function(){var this$1=this;var pos=this.find(-1,true),widget=this,cm=this.doc.cm;if(!pos||!cm){return}runInOp(cm,function(){var line=pos.line,lineN=lineNo(pos.line);var view=findViewForLine(cm,lineN);if(view){clearLineMeasurementCacheFor(view);cm.curOp.selectionChanged=cm.curOp.forceUpdate=true}cm.curOp.updateMaxLine=true;if(!lineIsHidden(widget.doc,line)&&widget.height!=null){var oldHeight=widget.height;widget.height=null;var dHeight=widgetHeight(widget)-oldHeight;if(dHeight){updateLineHeight(line,line.height+dHeight)}}signalLater(cm,"markerChanged",cm,this$1)})};TextMarker.prototype.attachLine=function(line){if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;if(!op.maybeHiddenMarkers||indexOf(op.maybeHiddenMarkers,this)==-1){(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this)}}this.lines.push(line)};TextMarker.prototype.detachLine=function(line){this.lines.splice(indexOf(this.lines,line),1);if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;(op.maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this)}};eventMixin(TextMarker);function markText(doc,from,to,options,type){if(options&&options.shared){return markTextShared(doc,from,to,options,type)}if(doc.cm&&!doc.cm.curOp){return operation(doc.cm,markText)(doc,from,to,options,type)}var marker=new TextMarker(doc,type),diff=cmp(from,to);if(options){copyObj(options,marker,false)}if(diff>0||diff==0&&marker.clearWhenEmpty!==false){return marker}if(marker.replacedWith){marker.collapsed=true;marker.widgetNode=eltP("span",[marker.replacedWith],"CodeMirror-widget");if(!options.handleMouseEvents){marker.widgetNode.setAttribute("cm-ignore-events","true")}if(options.insertLeft){marker.widgetNode.insertLeft=true}}if(marker.collapsed){if(conflictingCollapsedRange(doc,from.line,from,to,marker)||from.line!=to.line&&conflictingCollapsedRange(doc,to.line,from,to,marker)){throw new Error("Inserting collapsed marker partially overlapping an existing one")}seeCollapsedSpans()}if(marker.addToHistory){addChangeToHistory(doc,{from:from,to:to,origin:"markText"},doc.sel,NaN)}var curLine=from.line,cm=doc.cm,updateMaxLine;doc.iter(curLine,to.line+1,function(line){if(cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(line)==cm.display.maxLine){updateMaxLine=true}if(marker.collapsed&&curLine!=from.line){updateLineHeight(line,0)}addMarkedSpan(line,new MarkedSpan(marker,curLine==from.line?from.ch:null,curLine==to.line?to.ch:null));++curLine});if(marker.collapsed){doc.iter(from.line,to.line+1,function(line){if(lineIsHidden(doc,line)){updateLineHeight(line,0)}})}if(marker.clearOnEnter){on(marker,"beforeCursorEnter",function(){return marker.clear()})}if(marker.readOnly){seeReadOnlySpans();if(doc.history.done.length||doc.history.undone.length){doc.clearHistory()}}if(marker.collapsed){marker.id=++nextMarkerId;marker.atomic=true}if(cm){if(updateMaxLine){cm.curOp.updateMaxLine=true}if(marker.collapsed){regChange(cm,from.line,to.line+1)}else if(marker.className||marker.title||marker.startStyle||marker.endStyle||marker.css){for(var i=from.line;i<=to.line;i++){regLineChange(cm,i,"text")}}if(marker.atomic){reCheckSelection(cm.doc)}signalLater(cm,"markerAdded",cm,marker)}return marker}var SharedTextMarker=function(markers,primary){var this$1=this;this.markers=markers;this.primary=primary;for(var i=0;i<markers.length;++i){markers[i].parent=this$1}};SharedTextMarker.prototype.clear=function(){var this$1=this;if(this.explicitlyCleared){return}this.explicitlyCleared=true;for(var i=0;i<this.markers.length;++i){this$1.markers[i].clear()}signalLater(this,"clear")};SharedTextMarker.prototype.find=function(side,lineObj){return this.primary.find(side,lineObj)};eventMixin(SharedTextMarker);function markTextShared(doc,from,to,options,type){options=copyObj(options);options.shared=false;var markers=[markText(doc,from,to,options,type)],primary=markers[0];var widget=options.widgetNode;linkedDocs(doc,function(doc){if(widget){options.widgetNode=widget.cloneNode(true)}markers.push(markText(doc,clipPos(doc,from),clipPos(doc,to),options,type));for(var i=0;i<doc.linked.length;++i){if(doc.linked[i].isParent){return}}primary=lst(markers)});return new SharedTextMarker(markers,primary)}function findSharedMarkers(doc){return doc.findMarks(Pos(doc.first,0),doc.clipPos(Pos(doc.lastLine())),function(m){return m.parent})}function copySharedMarkers(doc,markers){for(var i=0;i<markers.length;i++){var marker=markers[i],pos=marker.find();var mFrom=doc.clipPos(pos.from),mTo=doc.clipPos(pos.to);if(cmp(mFrom,mTo)){var subMark=markText(doc,mFrom,mTo,marker.primary,marker.primary.type);marker.markers.push(subMark);subMark.parent=marker}}}function detachSharedMarkers(markers){var loop=function(i){var marker=markers[i],linked=[marker.primary.doc];linkedDocs(marker.primary.doc,function(d){return linked.push(d)});for(var j=0;j<marker.markers.length;j++){var subMarker=marker.markers[j];if(indexOf(linked,subMarker.doc)==-1){subMarker.parent=null;marker.markers.splice(j--,1)}}};for(var i=0;i<markers.length;i++)loop(i)}var nextDocId=0;var Doc=function(text,mode,firstLine,lineSep,direction){if(!(this instanceof Doc)){return new Doc(text,mode,firstLine,lineSep,direction)}if(firstLine==null){firstLine=0}BranchChunk.call(this,[new LeafChunk([new Line("",null)])]);this.first=firstLine;this.scrollTop=this.scrollLeft=0;this.cantEdit=false;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=firstLine;var start=Pos(firstLine,0);this.sel=simpleSelection(start);this.history=new History(null);this.id=++nextDocId;this.modeOption=mode;this.lineSep=lineSep;this.direction=direction=="rtl"?"rtl":"ltr";this.extend=false;if(typeof text=="string"){text=this.splitLines(text)}updateDoc(this,{from:start,to:start,text:text});setSelection(this,simpleSelection(start),sel_dontScroll)};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function(from,to,op){if(op){this.iterN(from-this.first,to-from,op)}else{this.iterN(this.first,this.first+this.size,from)}},insert:function(at,lines){var height=0;for(var i=0;i<lines.length;++i){height+=lines[i].height}this.insertInner(at-this.first,lines,height)},remove:function(at,n){this.removeInner(at-this.first,n)},getValue:function(lineSep){var lines=getLines(this,this.first,this.first+this.size);if(lineSep===false){return lines}return lines.join(lineSep||this.lineSeparator())},setValue:docMethodOp(function(code){var top=Pos(this.first,0),last=this.first+this.size-1;makeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:this.splitLines(code),origin:"setValue",full:true},true);if(this.cm){scrollToCoords(this.cm,0,0)}setSelection(this,simpleSelection(top),sel_dontScroll)}),replaceRange:function(code,from,to,origin){from=clipPos(this,from);to=to?clipPos(this,to):from;replaceRange(this,code,from,to,origin)},getRange:function(from,to,lineSep){var lines=getBetween(this,clipPos(this,from),clipPos(this,to));if(lineSep===false){return lines}return lines.join(lineSep||this.lineSeparator())},getLine:function(line){var l=this.getLineHandle(line);return l&&l.text},getLineHandle:function(line){if(isLine(this,line)){return getLine(this,line)}},getLineNumber:function(line){return lineNo(line)},getLineHandleVisualStart:function(line){if(typeof line=="number"){line=getLine(this,line)}return visualLine(line)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(pos){return clipPos(this,pos)},getCursor:function(start){var range$$1=this.sel.primary(),pos;if(start==null||start=="head"){pos=range$$1.head}else if(start=="anchor"){pos=range$$1.anchor}else if(start=="end"||start=="to"||start===false){pos=range$$1.to()}else{pos=range$$1.from()}return pos},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:docMethodOp(function(line,ch,options){setSimpleSelection(this,clipPos(this,typeof line=="number"?Pos(line,ch||0):line),null,options)}),setSelection:docMethodOp(function(anchor,head,options){setSimpleSelection(this,clipPos(this,anchor),clipPos(this,head||anchor),options)}),extendSelection:docMethodOp(function(head,other,options){extendSelection(this,clipPos(this,head),other&&clipPos(this,other),options)}),extendSelections:docMethodOp(function(heads,options){extendSelections(this,clipPosArray(this,heads),options)}),extendSelectionsBy:docMethodOp(function(f,options){var heads=map(this.sel.ranges,f);extendSelections(this,clipPosArray(this,heads),options)}),setSelections:docMethodOp(function(ranges,primary,options){var this$1=this;if(!ranges.length){return}var out=[];for(var i=0;i<ranges.length;i++){out[i]=new Range(clipPos(this$1,ranges[i].anchor),clipPos(this$1,ranges[i].head))}if(primary==null){primary=Math.min(ranges.length-1,this.sel.primIndex)}setSelection(this,normalizeSelection(out,primary),options)}),addSelection:docMethodOp(function(anchor,head,options){var ranges=this.sel.ranges.slice(0);ranges.push(new Range(clipPos(this,anchor),clipPos(this,head||anchor)));setSelection(this,normalizeSelection(ranges,ranges.length-1),options)}),getSelection:function(lineSep){var this$1=this;var ranges=this.sel.ranges,lines;for(var i=0;i<ranges.length;i++){var sel=getBetween(this$1,ranges[i].from(),ranges[i].to());lines=lines?lines.concat(sel):sel}if(lineSep===false){return lines}else{return lines.join(lineSep||this.lineSeparator())}},getSelections:function(lineSep){var this$1=this;var parts=[],ranges=this.sel.ranges;for(var i=0;i<ranges.length;i++){var sel=getBetween(this$1,ranges[i].from(),ranges[i].to());if(lineSep!==false){sel=sel.join(lineSep||this$1.lineSeparator())}parts[i]=sel}return parts},replaceSelection:function(code,collapse,origin){var dup=[];for(var i=0;i<this.sel.ranges.length;i++){dup[i]=code}this.replaceSelections(dup,collapse,origin||"+input")},replaceSelections:docMethodOp(function(code,collapse,origin){var this$1=this;var changes=[],sel=this.sel;for(var i=0;i<sel.ranges.length;i++){var range$$1=sel.ranges[i];changes[i]={from:range$$1.from(),to:range$$1.to(),text:this$1.splitLines(code[i]),origin:origin}}var newSel=collapse&&collapse!="end"&&computeReplacedSel(this,changes,collapse);for(var i$1=changes.length-1;i$1>=0;i$1--){makeChange(this$1,changes[i$1])}if(newSel){setSelectionReplaceHistory(this,newSel)}else if(this.cm){ensureCursorVisible(this.cm)}}),undo:docMethodOp(function(){makeChangeFromHistory(this,"undo")}),redo:docMethodOp(function(){makeChangeFromHistory(this,"redo")}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,"undo",true)}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,"redo",true)}),setExtending:function(val){this.extend=val},getExtending:function(){return this.extend},historySize:function(){var hist=this.history,done=0,undone=0;for(var i=0;i<hist.done.length;i++){if(!hist.done[i].ranges){++done}}for(var i$1=0;i$1<hist.undone.length;i$1++){if(!hist.undone[i$1].ranges){++undone}}return{undo:done,redo:undone}},clearHistory:function(){this.history=new History(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(true)},changeGeneration:function(forceSplit){if(forceSplit){this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null}return this.history.generation},isClean:function(gen){return this.history.generation==(gen||this.cleanGeneration)},getHistory:function(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function(histData){var hist=this.history=new History(this.history.maxGeneration);hist.done=copyHistoryArray(histData.done.slice(0),null,true);hist.undone=copyHistoryArray(histData.undone.slice(0),null,true)},setGutterMarker:docMethodOp(function(line,gutterID,value){return changeLine(this,line,"gutter",function(line){var markers=line.gutterMarkers||(line.gutterMarkers={});markers[gutterID]=value;if(!value&&isEmpty(markers)){line.gutterMarkers=null}return true})}),clearGutter:docMethodOp(function(gutterID){var this$1=this;this.iter(function(line){if(line.gutterMarkers&&line.gutterMarkers[gutterID]){changeLine(this$1,line,"gutter",function(){line.gutterMarkers[gutterID]=null;if(isEmpty(line.gutterMarkers)){line.gutterMarkers=null}return true})}})}),lineInfo:function(line){var n;if(typeof line=="number"){if(!isLine(this,line)){return null}n=line;line=getLine(this,line);if(!line){return null}}else{n=lineNo(line);if(n==null){return null}}return{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets}},addLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass";if(!line[prop]){line[prop]=cls}else if(classTest(cls).test(line[prop])){return false}else{line[prop]+=" "+cls}return true})}),removeLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,where=="gutter"?"gutter":"class",function(line){var prop=where=="text"?"textClass":where=="background"?"bgClass":where=="gutter"?"gutterClass":"wrapClass";var cur=line[prop];if(!cur){return false}else if(cls==null){line[prop]=null}else{var found=cur.match(classTest(cls));if(!found){return false}var end=found.index+found[0].length;line[prop]=cur.slice(0,found.index)+(!found.index||end==cur.length?"":" ")+cur.slice(end)||null}return true})}),addLineWidget:docMethodOp(function(handle,node,options){return addLineWidget(this,handle,node,options)}),removeLineWidget:function(widget){widget.clear()},markText:function(from,to,options){return markText(this,clipPos(this,from),clipPos(this,to),options,options&&options.type||"range")},setBookmark:function(pos,options){var realOpts={replacedWith:options&&(options.nodeType==null?options.widget:options),insertLeft:options&&options.insertLeft,clearWhenEmpty:false,shared:options&&options.shared,handleMouseEvents:options&&options.handleMouseEvents};pos=clipPos(this,pos);return markText(this,pos,pos,realOpts,"bookmark")},findMarksAt:function(pos){pos=clipPos(this,pos);var markers=[],spans=getLine(this,pos.line).markedSpans;if(spans){for(var i=0;i<spans.length;++i){var span=spans[i];if((span.from==null||span.from<=pos.ch)&&(span.to==null||span.to>=pos.ch)){markers.push(span.marker.parent||span.marker)}}}return markers},findMarks:function(from,to,filter){from=clipPos(this,from);to=clipPos(this,to);var found=[],lineNo$$1=from.line;this.iter(from.line,to.line+1,function(line){var spans=line.markedSpans;if(spans){for(var i=0;i<spans.length;i++){var span=spans[i];if(!(span.to!=null&&lineNo$$1==from.line&&from.ch>=span.to||span.from==null&&lineNo$$1!=from.line||span.from!=null&&lineNo$$1==to.line&&span.from>=to.ch)&&(!filter||filter(span.marker))){found.push(span.marker.parent||span.marker)}}}++lineNo$$1});return found},getAllMarks:function(){var markers=[];this.iter(function(line){var sps=line.markedSpans;if(sps){for(var i=0;i<sps.length;++i){if(sps[i].from!=null){markers.push(sps[i].marker)}}}});return markers},posFromIndex:function(off){var ch,lineNo$$1=this.first,sepSize=this.lineSeparator().length;this.iter(function(line){var sz=line.text.length+sepSize;if(sz>off){ch=off;return true}off-=sz;++lineNo$$1});return clipPos(this,Pos(lineNo$$1,ch))},indexFromPos:function(coords){coords=clipPos(this,coords);var index=coords.ch;if(coords.line<this.first||coords.ch<0){return 0}var sepSize=this.lineSeparator().length;this.iter(this.first,coords.line,function(line){index+=line.text.length+sepSize});return index},copy:function(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);doc.scrollTop=this.scrollTop;doc.scrollLeft=this.scrollLeft;doc.sel=this.sel;doc.extend=false;if(copyHistory){doc.history.undoDepth=this.history.undoDepth;doc.setHistory(this.getHistory())}return doc},linkedDoc:function(options){if(!options){options={}}var from=this.first,to=this.first+this.size;if(options.from!=null&&options.from>from){from=options.from}if(options.to!=null&&options.to<to){to=options.to}var copy=new Doc(getLines(this,from,to),options.mode||this.modeOption,from,this.lineSep,this.direction);if(options.sharedHist){copy.history=this.history}(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist});copy.linked=[{doc:this,isParent:true,sharedHist:options.sharedHist}];copySharedMarkers(copy,findSharedMarkers(this));return copy},unlinkDoc:function(other){var this$1=this;if(other instanceof CodeMirror$1){other=other.doc}if(this.linked){for(var i=0;i<this.linked.length;++i){var link=this$1.linked[i];if(link.doc!=other){continue}this$1.linked.splice(i,1);other.unlinkDoc(this$1);detachSharedMarkers(findSharedMarkers(this$1));break}}if(other.history==this.history){var splitIds=[other.id];linkedDocs(other,function(doc){return splitIds.push(doc.id)},true);other.history=new History(null);other.history.done=copyHistoryArray(this.history.done,splitIds);other.history.undone=copyHistoryArray(this.history.undone,splitIds)}},iterLinkedDocs:function(f){linkedDocs(this,f)},getMode:function(){return this.mode},getEditor:function(){return this.cm},splitLines:function(str){if(this.lineSep){return str.split(this.lineSep)}return splitLinesAuto(str)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:docMethodOp(function(dir){if(dir!="rtl"){dir="ltr"}if(dir==this.direction){return}this.direction=dir;this.iter(function(line){return line.order=null});if(this.cm){directionChanged(this.cm)}})});Doc.prototype.eachLine=Doc.prototype.iter;var lastDrop=0;function onDrop(e){var cm=this;clearDragCursor(cm);if(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)){return}e_preventDefault(e);if(ie){lastDrop=+new Date}var pos=posFromMouse(cm,e,true),files=e.dataTransfer.files;if(!pos||cm.isReadOnly()){return}if(files&&files.length&&window.FileReader&&window.File){var n=files.length,text=Array(n),read=0;var loadFile=function(file,i){if(cm.options.allowDropFileTypes&&indexOf(cm.options.allowDropFileTypes,file.type)==-1){return}var reader=new FileReader;reader.onload=operation(cm,function(){var content=reader.result;if(/[\x00-\x08\x0e-\x1f]{2}/.test(content)){content=""}text[i]=content;if(++read==n){pos=clipPos(cm.doc,pos);var change={from:pos,to:pos,text:cm.doc.splitLines(text.join(cm.doc.lineSeparator())),origin:"paste"};makeChange(cm.doc,change);setSelectionReplaceHistory(cm.doc,simpleSelection(pos,changeEnd(change)))}});reader.readAsText(file)};for(var i=0;i<n;++i){loadFile(files[i],i)}}else{if(cm.state.draggingText&&cm.doc.sel.contains(pos)>-1){cm.state.draggingText(e);setTimeout(function(){return cm.display.input.focus()},20);return}try{var text$1=e.dataTransfer.getData("Text");if(text$1){var selected;if(cm.state.draggingText&&!cm.state.draggingText.copy){selected=cm.listSelections()}setSelectionNoUndo(cm.doc,simpleSelection(pos,pos));if(selected){for(var i$1=0;i$1<selected.length;++i$1){replaceRange(cm.doc,"",selected[i$1].anchor,selected[i$1].head,"drag")}}cm.replaceSelection(text$1,"around","paste");cm.display.input.focus()}}catch(e){}}}function onDragStart(cm,e){if(ie&&(!cm.state.draggingText||+new Date-lastDrop<100)){e_stop(e);return}if(signalDOMEvent(cm,e)||eventInWidget(cm.display,e)){return}e.dataTransfer.setData("Text",cm.getSelection());e.dataTransfer.effectAllowed="copyMove";if(e.dataTransfer.setDragImage&&!safari){var img=elt("img",null,null,"position: fixed; left: 0; top: 0;");img.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";if(presto){img.width=img.height=1;cm.display.wrapper.appendChild(img);img._top=img.offsetTop}e.dataTransfer.setDragImage(img,0,0);if(presto){img.parentNode.removeChild(img)}}}function onDragOver(cm,e){var pos=posFromMouse(cm,e);if(!pos){return}var frag=document.createDocumentFragment();drawSelectionCursor(cm,pos,frag);if(!cm.display.dragCursor){cm.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors");cm.display.lineSpace.insertBefore(cm.display.dragCursor,cm.display.cursorDiv)}removeChildrenAndAdd(cm.display.dragCursor,frag)}function clearDragCursor(cm){if(cm.display.dragCursor){cm.display.lineSpace.removeChild(cm.display.dragCursor);cm.display.dragCursor=null}}function forEachCodeMirror(f){if(!document.getElementsByClassName){return}var byClass=document.getElementsByClassName("CodeMirror");for(var i=0;i<byClass.length;i++){var cm=byClass[i].CodeMirror;if(cm){f(cm)}}}var globalsRegistered=false;function ensureGlobalHandlers(){if(globalsRegistered){return}registerGlobalHandlers();globalsRegistered=true}function registerGlobalHandlers(){var resizeTimer;on(window,"resize",function(){if(resizeTimer==null){resizeTimer=setTimeout(function(){resizeTimer=null;forEachCodeMirror(onResize)},100)}});on(window,"blur",function(){return forEachCodeMirror(onBlur)})}function onResize(cm){var d=cm.display;if(d.lastWrapHeight==d.wrapper.clientHeight&&d.lastWrapWidth==d.wrapper.clientWidth){return}d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null;d.scrollbarsClipped=false;cm.setSize()}var keyNames={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};for(var i=0;i<10;i++){keyNames[i+48]=keyNames[i+96]=String(i)}for(var i$1=65;i$1<=90;i$1++){keyNames[i$1]=String.fromCharCode(i$1)}for(var i$2=1;i$2<=12;i$2++){keyNames[i$2+111]=keyNames[i$2+63235]="F"+i$2}var keyMap={};keyMap.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"};keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"};keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"};keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]};keyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault;function normalizeKeyName(name){var parts=name.split(/-(?!$)/);name=parts[parts.length-1];var alt,ctrl,shift,cmd;for(var i=0;i<parts.length-1;i++){var mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod)){cmd=true}else if(/^a(lt)?$/i.test(mod)){alt=true}else if(/^(c|ctrl|control)$/i.test(mod)){ctrl=true}else if(/^s(hift)?$/i.test(mod)){shift=true}else{throw new Error("Unrecognized modifier name: "+mod)}}if(alt){name="Alt-"+name}if(ctrl){name="Ctrl-"+name}if(cmd){name="Cmd-"+name}if(shift){name="Shift-"+name}return name}function normalizeKeyMap(keymap){var copy={};for(var keyname in keymap){if(keymap.hasOwnProperty(keyname)){var value=keymap[keyname];if(/^(name|fallthrough|(de|at)tach)$/.test(keyname)){continue}if(value=="..."){delete keymap[keyname];continue}var keys=map(keyname.split(" "),normalizeKeyName);for(var i=0;i<keys.length;i++){var val=void 0,name=void 0;if(i==keys.length-1){name=keys.join(" ");val=value}else{name=keys.slice(0,i+1).join(" ");val="..."}var prev=copy[name];if(!prev){copy[name]=val}else if(prev!=val){throw new Error("Inconsistent bindings for "+name)}}delete keymap[keyname]}}for(var prop in copy){keymap[prop]=copy[prop]}return keymap}function lookupKey(key,map$$1,handle,context){map$$1=getKeyMap(map$$1);var found=map$$1.call?map$$1.call(key,context):map$$1[key];if(found===false){return"nothing"}if(found==="..."){return"multi"}if(found!=null&&handle(found)){return"handled"}if(map$$1.fallthrough){if(Object.prototype.toString.call(map$$1.fallthrough)!="[object Array]"){return lookupKey(key,map$$1.fallthrough,handle,context)}for(var i=0;i<map$$1.fallthrough.length;i++){var result=lookupKey(key,map$$1.fallthrough[i],handle,context);if(result){return result}}}}function isModifierKey(value){var name=typeof value=="string"?value:keyNames[value.keyCode];return name=="Ctrl"||name=="Alt"||name=="Shift"||name=="Mod"}function addModifierNames(name,event,noShift){var base=name;if(event.altKey&&base!="Alt"){name="Alt-"+name}if((flipCtrlCmd?event.metaKey:event.ctrlKey)&&base!="Ctrl"){name="Ctrl-"+name}if((flipCtrlCmd?event.ctrlKey:event.metaKey)&&base!="Cmd"){name="Cmd-"+name}if(!noShift&&event.shiftKey&&base!="Shift"){name="Shift-"+name}return name}function keyName(event,noShift){if(presto&&event.keyCode==34&&event["char"]){return false}var name=keyNames[event.keyCode];if(name==null||event.altGraphKey){return false}return addModifierNames(name,event,noShift)}function getKeyMap(val){return typeof val=="string"?keyMap[val]:val}function deleteNearSelection(cm,compute){var ranges=cm.doc.sel.ranges,kill=[];for(var i=0;i<ranges.length;i++){var toKill=compute(ranges[i]);while(kill.length&&cmp(toKill.from,lst(kill).to)<=0){var replaced=kill.pop();if(cmp(replaced.from,toKill.from)<0){toKill.from=replaced.from;break}}kill.push(toKill)}runInOp(cm,function(){for(var i=kill.length-1;i>=0;i--){replaceRange(cm.doc,"",kill[i].from,kill[i].to,"+delete")}ensureCursorVisible(cm)})}var commands={selectAll:selectAll,singleSelection:function(cm){return cm.setSelection(cm.getCursor("anchor"),cm.getCursor("head"),sel_dontScroll)},killLine:function(cm){return deleteNearSelection(cm,function(range){if(range.empty()){var len=getLine(cm.doc,range.head.line).text.length;if(range.head.ch==len&&range.head.line<cm.lastLine()){return{from:range.head,to:Pos(range.head.line+1,0)}}else{return{from:range.head,to:Pos(range.head.line,len)}}}else{return{from:range.from(),to:range.to()}}})},deleteLine:function(cm){return deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:clipPos(cm.doc,Pos(range.to().line+1,0))}})},delLineLeft:function(cm){return deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:range.from()}})},delWrappedLineLeft:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;var leftPos=cm.coordsChar({left:0,top:top},"div");return{from:leftPos,to:range.from()}})},delWrappedLineRight:function(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5;var rightPos=cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div");return{from:range.from(),to:rightPos}})},undo:function(cm){return cm.undo()},redo:function(cm){return cm.redo()},undoSelection:function(cm){return cm.undoSelection()},redoSelection:function(cm){return cm.redoSelection()},goDocStart:function(cm){return cm.extendSelection(Pos(cm.firstLine(),0))},goDocEnd:function(cm){return cm.extendSelection(Pos(cm.lastLine()))},goLineStart:function(cm){return cm.extendSelectionsBy(function(range){return lineStart(cm,range.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(cm){return cm.extendSelectionsBy(function(range){return lineStartSmart(cm,range.head)},{origin:"+move",bias:1})},goLineEnd:function(cm){return cm.extendSelectionsBy(function(range){return lineEnd(cm,range.head.line)},{origin:"+move",bias:-1})},goLineRight:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;return cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div")},sel_move)},goLineLeft:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;return cm.coordsChar({left:0,top:top},"div")},sel_move)},goLineLeftSmart:function(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;var pos=cm.coordsChar({left:0,top:top},"div");if(pos.ch<cm.getLine(pos.line).search(/\S/)){return lineStartSmart(cm,range.head)}return pos},sel_move)},goLineUp:function(cm){return cm.moveV(-1,"line")},goLineDown:function(cm){return cm.moveV(1,"line")},goPageUp:function(cm){return cm.moveV(-1,"page")},goPageDown:function(cm){return cm.moveV(1,"page")},goCharLeft:function(cm){return cm.moveH(-1,"char")},goCharRight:function(cm){return cm.moveH(1,"char")},goColumnLeft:function(cm){return cm.moveH(-1,"column")},goColumnRight:function(cm){return cm.moveH(1,"column")},goWordLeft:function(cm){return cm.moveH(-1,"word")},goGroupRight:function(cm){return cm.moveH(1,"group")},goGroupLeft:function(cm){return cm.moveH(-1,"group")},goWordRight:function(cm){return cm.moveH(1,"word")},delCharBefore:function(cm){return cm.deleteH(-1,"char")},delCharAfter:function(cm){return cm.deleteH(1,"char")},delWordBefore:function(cm){return cm.deleteH(-1,"word")},delWordAfter:function(cm){return cm.deleteH(1,"word")},delGroupBefore:function(cm){return cm.deleteH(-1,"group")},delGroupAfter:function(cm){return cm.deleteH(1,"group")},indentAuto:function(cm){return cm.indentSelection("smart")},indentMore:function(cm){return cm.indentSelection("add")},indentLess:function(cm){return cm.indentSelection("subtract")},insertTab:function(cm){return cm.replaceSelection("\t")},insertSoftTab:function(cm){var spaces=[],ranges=cm.listSelections(),tabSize=cm.options.tabSize;for(var i=0;i<ranges.length;i++){var pos=ranges[i].from();var col=countColumn(cm.getLine(pos.line),pos.ch,tabSize);spaces.push(spaceStr(tabSize-col%tabSize))}cm.replaceSelections(spaces)},defaultTab:function(cm){if(cm.somethingSelected()){cm.indentSelection("add")}else{cm.execCommand("insertTab")}},transposeChars:function(cm){return runInOp(cm,function(){var ranges=cm.listSelections(),newSel=[];for(var i=0;i<ranges.length;i++){if(!ranges[i].empty()){continue}var cur=ranges[i].head,line=getLine(cm.doc,cur.line).text;if(line){if(cur.ch==line.length){cur=new Pos(cur.line,cur.ch-1)}if(cur.ch>0){cur=new Pos(cur.line,cur.ch+1);cm.replaceRange(line.charAt(cur.ch-1)+line.charAt(cur.ch-2),Pos(cur.line,cur.ch-2),cur,"+transpose")}else if(cur.line>cm.doc.first){var prev=getLine(cm.doc,cur.line-1).text;if(prev){cur=new Pos(cur.line,1);cm.replaceRange(line.charAt(0)+cm.doc.lineSeparator()+prev.charAt(prev.length-1),Pos(cur.line-1,prev.length-1),cur,"+transpose")}}}newSel.push(new Range(cur,cur))}cm.setSelections(newSel)})},newlineAndIndent:function(cm){return runInOp(cm,function(){var sels=cm.listSelections();for(var i=sels.length-1;i>=0;i--){cm.replaceRange(cm.doc.lineSeparator(),sels[i].anchor,sels[i].head,"+input")}sels=cm.listSelections();for(var i$1=0;i$1<sels.length;i$1++){cm.indentLine(sels[i$1].from().line,null,true)}ensureCursorVisible(cm)})},openLine:function(cm){return cm.replaceSelection("\n","start")},toggleOverwrite:function(cm){return cm.toggleOverwrite()}};function lineStart(cm,lineN){var line=getLine(cm.doc,lineN);var visual=visualLine(line);if(visual!=line){lineN=lineNo(visual)}return endOfLine(true,cm,visual,lineN,1)}function lineEnd(cm,lineN){var line=getLine(cm.doc,lineN);var visual=visualLineEnd(line);if(visual!=line){lineN=lineNo(visual)}return endOfLine(true,cm,line,lineN,-1)}function lineStartSmart(cm,pos){var start=lineStart(cm,pos.line);var line=getLine(cm.doc,start.line);var order=getOrder(line,cm.doc.direction);if(!order||order[0].level==0){var firstNonWS=Math.max(0,line.text.search(/\S/));var inWS=pos.line==start.line&&pos.ch<=firstNonWS&&pos.ch;return Pos(start.line,inWS?0:firstNonWS,start.sticky)}return start}function doHandleBinding(cm,bound,dropShift){if(typeof bound=="string"){bound=commands[bound];if(!bound){return false}}cm.display.input.ensurePolled();var prevShift=cm.display.shift,done=false;try{if(cm.isReadOnly()){cm.state.suppressEdits=true}if(dropShift){cm.display.shift=false}done=bound(cm)!=Pass}finally{cm.display.shift=prevShift;cm.state.suppressEdits=false}return done}function lookupKeyForEditor(cm,name,handle){for(var i=0;i<cm.state.keyMaps.length;i++){var result=lookupKey(name,cm.state.keyMaps[i],handle,cm);if(result){return result}}return cm.options.extraKeys&&lookupKey(name,cm.options.extraKeys,handle,cm)||lookupKey(name,cm.options.keyMap,handle,cm)}var stopSeq=new Delayed;function dispatchKey(cm,name,e,handle){var seq=cm.state.keySeq;if(seq){if(isModifierKey(name)){return"handled"}stopSeq.set(50,function(){if(cm.state.keySeq==seq){cm.state.keySeq=null;cm.display.input.reset()}});name=seq+" "+name}var result=lookupKeyForEditor(cm,name,handle);if(result=="multi"){cm.state.keySeq=name}if(result=="handled"){signalLater(cm,"keyHandled",cm,name,e)}if(result=="handled"||result=="multi"){e_preventDefault(e);restartBlink(cm)}if(seq&&!result&&/\'$/.test(name)){e_preventDefault(e);return true}return!!result}function handleKeyBinding(cm,e){var name=keyName(e,true);if(!name){return false}if(e.shiftKey&&!cm.state.keySeq){return dispatchKey(cm,"Shift-"+name,e,function(b){return doHandleBinding(cm,b,true)})||dispatchKey(cm,name,e,function(b){if(typeof b=="string"?/^go[A-Z]/.test(b):b.motion){return doHandleBinding(cm,b)}})}else{return dispatchKey(cm,name,e,function(b){return doHandleBinding(cm,b)})}}function handleCharBinding(cm,e,ch){return dispatchKey(cm,"'"+ch+"'",e,function(b){return doHandleBinding(cm,b,true)})}var lastStoppedKey=null;function onKeyDown(e){var cm=this;cm.curOp.focus=activeElt();if(signalDOMEvent(cm,e)){return}if(ie&&ie_version<11&&e.keyCode==27){e.returnValue=false}var code=e.keyCode;cm.display.shift=code==16||e.shiftKey;var handled=handleKeyBinding(cm,e);if(presto){lastStoppedKey=handled?code:null;if(!handled&&code==88&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey)){cm.replaceSelection("",null,"cut")}}if(code==18&&!/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className)){showCrossHair(cm)}}function showCrossHair(cm){var lineDiv=cm.display.lineDiv;addClass(lineDiv,"CodeMirror-crosshair");function up(e){if(e.keyCode==18||!e.altKey){rmClass(lineDiv,"CodeMirror-crosshair");off(document,"keyup",up);off(document,"mouseover",up)}}on(document,"keyup",up);on(document,"mouseover",up)}function onKeyUp(e){if(e.keyCode==16){this.doc.sel.shift=false}signalDOMEvent(this,e)}function onKeyPress(e){var cm=this;if(eventInWidget(cm.display,e)||signalDOMEvent(cm,e)||e.ctrlKey&&!e.altKey||mac&&e.metaKey){return}var keyCode=e.keyCode,charCode=e.charCode;if(presto&&keyCode==lastStoppedKey){lastStoppedKey=null;e_preventDefault(e);return}if(presto&&(!e.which||e.which<10)&&handleKeyBinding(cm,e)){return}var ch=String.fromCharCode(charCode==null?keyCode:charCode);if(ch=="\b"){return}if(handleCharBinding(cm,e,ch)){return}cm.display.input.onKeyPress(e)}var DOUBLECLICK_DELAY=400;var PastClick=function(time,pos,button){this.time=time;this.pos=pos;this.button=button};PastClick.prototype.compare=function(time,pos,button){return this.time+DOUBLECLICK_DELAY>time&&cmp(pos,this.pos)==0&&button==this.button};var lastClick;var lastDoubleClick;function clickRepeat(pos,button){var now=+new Date;if(lastDoubleClick&&lastDoubleClick.compare(now,pos,button)){lastClick=lastDoubleClick=null;return"triple"}else if(lastClick&&lastClick.compare(now,pos,button)){lastDoubleClick=new PastClick(now,pos,button);lastClick=null;return"double"}else{lastClick=new PastClick(now,pos,button);lastDoubleClick=null;return"single"}}function onMouseDown(e){var cm=this,display=cm.display;if(signalDOMEvent(cm,e)||display.activeTouch&&display.input.supportsTouch()){return}display.input.ensurePolled();display.shift=e.shiftKey;if(eventInWidget(display,e)){if(!webkit){display.scroller.draggable=false;setTimeout(function(){return display.scroller.draggable=true},100)}return}if(clickInGutter(cm,e)){return}var pos=posFromMouse(cm,e),button=e_button(e),repeat=pos?clickRepeat(pos,button):"single";window.focus();if(button==1&&cm.state.selectingText){cm.state.selectingText(e)}if(pos&&handleMappedButton(cm,button,pos,repeat,e)){return}if(button==1){if(pos){leftButtonDown(cm,pos,repeat,e)}else if(e_target(e)==display.scroller){e_preventDefault(e)}}else if(button==2){if(pos){extendSelection(cm.doc,pos)}setTimeout(function(){return display.input.focus()},20)}else if(button==3){if(captureRightClick){onContextMenu(cm,e)}else{delayBlurEvent(cm)}}}function handleMappedButton(cm,button,pos,repeat,event){var name="Click";if(repeat=="double"){name="Double"+name}else if(repeat=="triple"){name="Triple"+name}name=(button==1?"Left":button==2?"Middle":"Right")+name;return dispatchKey(cm,addModifierNames(name,event),event,function(bound){if(typeof bound=="string"){bound=commands[bound]}if(!bound){return false}var done=false;try{if(cm.isReadOnly()){cm.state.suppressEdits=true}done=bound(cm,pos)!=Pass}finally{cm.state.suppressEdits=false}return done})}function configureMouse(cm,repeat,event){var option=cm.getOption("configureMouse");var value=option?option(cm,repeat,event):{};if(value.unit==null){var rect=chromeOS?event.shiftKey&&event.metaKey:event.altKey;value.unit=rect?"rectangle":repeat=="single"?"char":repeat=="double"?"word":"line"}if(value.extend==null||cm.doc.extend){value.extend=cm.doc.extend||event.shiftKey}if(value.addNew==null){value.addNew=mac?event.metaKey:event.ctrlKey}if(value.moveOnDrag==null){value.moveOnDrag=!(mac?event.altKey:event.ctrlKey)}return value}function leftButtonDown(cm,pos,repeat,event){if(ie){setTimeout(bind(ensureFocus,cm),0)}else{cm.curOp.focus=activeElt()}var behavior=configureMouse(cm,repeat,event);var sel=cm.doc.sel,contained;if(cm.options.dragDrop&&dragAndDrop&&!cm.isReadOnly()&&repeat=="single"&&(contained=sel.contains(pos))>-1&&(cmp((contained=sel.ranges[contained]).from(),pos)<0||pos.xRel>0)&&(cmp(contained.to(),pos)>0||pos.xRel<0)){leftButtonStartDrag(cm,event,pos,behavior)}else{leftButtonSelect(cm,event,pos,behavior)}}function leftButtonStartDrag(cm,event,pos,behavior){var display=cm.display,moved=false;var dragEnd=operation(cm,function(e){if(webkit){display.scroller.draggable=false}cm.state.draggingText=false;off(document,"mouseup",dragEnd);off(document,"mousemove",mouseMove);off(display.scroller,"dragstart",dragStart);off(display.scroller,"drop",dragEnd);if(!moved){e_preventDefault(e);if(!behavior.addNew){extendSelection(cm.doc,pos,null,null,behavior.extend)}if(webkit||ie&&ie_version==9){setTimeout(function(){document.body.focus();display.input.focus()},20)}else{display.input.focus()}}});var mouseMove=function(e2){moved=moved||Math.abs(event.clientX-e2.clientX)+Math.abs(event.clientY-e2.clientY)>=10};var dragStart=function(){return moved=true};if(webkit){display.scroller.draggable=true}cm.state.draggingText=dragEnd;dragEnd.copy=!behavior.moveOnDrag;if(display.scroller.dragDrop){display.scroller.dragDrop()}on(document,"mouseup",dragEnd);on(document,"mousemove",mouseMove);on(display.scroller,"dragstart",dragStart);on(display.scroller,"drop",dragEnd);delayBlurEvent(cm);setTimeout(function(){return display.input.focus()},20)}function rangeForUnit(cm,pos,unit){if(unit=="char"){return new Range(pos,pos)}if(unit=="word"){return cm.findWordAt(pos)}if(unit=="line"){return new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)))}var result=unit(cm,pos);return new Range(result.from,result.to)}function leftButtonSelect(cm,event,start,behavior){var display=cm.display,doc=cm.doc;e_preventDefault(event);var ourRange,ourIndex,startSel=doc.sel,ranges=startSel.ranges;if(behavior.addNew&&!behavior.extend){ourIndex=doc.sel.contains(start);if(ourIndex>-1){ourRange=ranges[ourIndex]}else{ourRange=new Range(start,start)}}else{ourRange=doc.sel.primary();ourIndex=doc.sel.primIndex}if(behavior.unit=="rectangle"){if(!behavior.addNew){ourRange=new Range(start,start)}start=posFromMouse(cm,event,true,true);ourIndex=-1}else{var range$$1=rangeForUnit(cm,start,behavior.unit);if(behavior.extend){ourRange=extendRange(ourRange,range$$1.anchor,range$$1.head,behavior.extend)}else{ourRange=range$$1}}if(!behavior.addNew){ourIndex=0;setSelection(doc,new Selection([ourRange],0),sel_mouse);startSel=doc.sel}else if(ourIndex==-1){ourIndex=ranges.length;setSelection(doc,normalizeSelection(ranges.concat([ourRange]),ourIndex),{scroll:false,origin:"*mouse"})}else if(ranges.length>1&&ranges[ourIndex].empty()&&behavior.unit=="char"&&!behavior.extend){setSelection(doc,normalizeSelection(ranges.slice(0,ourIndex).concat(ranges.slice(ourIndex+1)),0),{scroll:false,origin:"*mouse"});startSel=doc.sel}else{replaceOneSelection(doc,ourIndex,ourRange,sel_mouse)}var lastPos=start;function extendTo(pos){if(cmp(lastPos,pos)==0){return}lastPos=pos;if(behavior.unit=="rectangle"){var ranges=[],tabSize=cm.options.tabSize;var startCol=countColumn(getLine(doc,start.line).text,start.ch,tabSize);var posCol=countColumn(getLine(doc,pos.line).text,pos.ch,tabSize);var left=Math.min(startCol,posCol),right=Math.max(startCol,posCol);for(var line=Math.min(start.line,pos.line),end=Math.min(cm.lastLine(),Math.max(start.line,pos.line));line<=end;line++){var text=getLine(doc,line).text,leftPos=findColumn(text,left,tabSize);if(left==right){ranges.push(new Range(Pos(line,leftPos),Pos(line,leftPos)))}else if(text.length>leftPos){ranges.push(new Range(Pos(line,leftPos),Pos(line,findColumn(text,right,tabSize))))}}if(!ranges.length){ranges.push(new Range(start,start))}setSelection(doc,normalizeSelection(startSel.ranges.slice(0,ourIndex).concat(ranges),ourIndex),{origin:"*mouse",scroll:false});cm.scrollIntoView(pos)}else{var oldRange=ourRange;var range$$1=rangeForUnit(cm,pos,behavior.unit);var anchor=oldRange.anchor,head;if(cmp(range$$1.anchor,anchor)>0){head=range$$1.head;anchor=minPos(oldRange.from(),range$$1.anchor)}else{head=range$$1.anchor;anchor=maxPos(oldRange.to(),range$$1.head)}var ranges$1=startSel.ranges.slice(0);ranges$1[ourIndex]=new Range(clipPos(doc,anchor),head);setSelection(doc,normalizeSelection(ranges$1,ourIndex),sel_mouse)}}var editorSize=display.wrapper.getBoundingClientRect();var counter=0;function extend(e){var curCount=++counter;var cur=posFromMouse(cm,e,true,behavior.unit=="rectangle");if(!cur){return}if(cmp(cur,lastPos)!=0){cm.curOp.focus=activeElt();extendTo(cur);var visible=visibleLines(display,doc);if(cur.line>=visible.to||cur.line<visible.from){setTimeout(operation(cm,function(){if(counter==curCount){extend(e)}}),150)}}else{var outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0;if(outside){setTimeout(operation(cm,function(){if(counter!=curCount){return}display.scroller.scrollTop+=outside;extend(e)}),50)}}}function done(e){cm.state.selectingText=false;counter=Infinity;e_preventDefault(e);display.input.focus();off(document,"mousemove",move);off(document,"mouseup",up);doc.history.lastSelOrigin=null}var move=operation(cm,function(e){if(!e_button(e)){done(e)}else{extend(e)}});var up=operation(cm,done);cm.state.selectingText=up;on(document,"mousemove",move);on(document,"mouseup",up)}function gutterEvent(cm,e,type,prevent){var mX,mY;try{mX=e.clientX;mY=e.clientY}catch(e){return false}if(mX>=Math.floor(cm.display.gutters.getBoundingClientRect().right)){return false}if(prevent){e_preventDefault(e)}var display=cm.display;var lineBox=display.lineDiv.getBoundingClientRect();if(mY>lineBox.bottom||!hasHandler(cm,type)){return e_defaultPrevented(e)}mY-=lineBox.top-display.viewOffset;for(var i=0;i<cm.options.gutters.length;++i){var g=display.gutters.childNodes[i];if(g&&g.getBoundingClientRect().right>=mX){var line=lineAtHeight(cm.doc,mY);var gutter=cm.options.gutters[i];signal(cm,type,cm,line,gutter,e);return e_defaultPrevented(e)}}}function clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",true)}function onContextMenu(cm,e){if(eventInWidget(cm.display,e)||contextMenuInGutter(cm,e)){return}if(signalDOMEvent(cm,e,"contextmenu")){return}cm.display.input.onContextMenu(e)}function contextMenuInGutter(cm,e){if(!hasHandler(cm,"gutterContextMenu")){return false}return gutterEvent(cm,e,"gutterContextMenu",false)}function themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+cm.options.theme.replace(/(^|\s)\s*/g," cm-s-");clearCaches(cm)}var Init={toString:function(){return"CodeMirror.Init"}};var defaults={};var optionHandlers={};function defineOptions(CodeMirror){var optionHandlers=CodeMirror.optionHandlers;function option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt;if(handle){optionHandlers[name]=notOnInit?function(cm,val,old){if(old!=Init){handle(cm,val,old)}}:handle}}CodeMirror.defineOption=option;CodeMirror.Init=Init;option("value","",function(cm,val){return cm.setValue(val)},true);option("mode",null,function(cm,val){cm.doc.modeOption=val;loadMode(cm)},true);option("indentUnit",2,loadMode,true);option("indentWithTabs",false);option("smartIndent",true);option("tabSize",4,function(cm){resetModeState(cm);clearCaches(cm);regChange(cm)},true);option("lineSeparator",null,function(cm,val){cm.doc.lineSep=val;if(!val){return}var newBreaks=[],lineNo=cm.doc.first;cm.doc.iter(function(line){for(var pos=0;;){var found=line.text.indexOf(val,pos);if(found==-1){break}pos=found+val.length;newBreaks.push(Pos(lineNo,found))}lineNo++});for(var i=newBreaks.length-1;i>=0;i--){replaceRange(cm.doc,val,newBreaks[i],Pos(newBreaks[i].line,newBreaks[i].ch+val.length))}});option("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(cm,val,old){cm.state.specialChars=new RegExp(val.source+(val.test("\t")?"":"|\t"),"g");if(old!=Init){cm.refresh()}});option("specialCharPlaceholder",defaultSpecialCharPlaceholder,function(cm){return cm.refresh()},true);option("electricChars",true);option("inputStyle",mobile?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},true);option("spellcheck",false,function(cm,val){return cm.getInputField().spellcheck=val},true);option("rtlMoveVisually",!windows);option("wholeLineUpdateBefore",true);option("theme","default",function(cm){themeChanged(cm);guttersChanged(cm)},true);option("keyMap","default",function(cm,val,old){var next=getKeyMap(val);var prev=old!=Init&&getKeyMap(old);if(prev&&prev.detach){prev.detach(cm,next)}if(next.attach){next.attach(cm,prev||null)}});option("extraKeys",null);option("configureMouse",null);option("lineWrapping",false,wrappingChanged,true);option("gutters",[],function(cm){setGuttersForLineNumbers(cm.options);guttersChanged(cm)},true);option("fixedGutter",true,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0";cm.refresh()},true);option("coverGutterNextToScrollbar",false,function(cm){return updateScrollbars(cm)},true);option("scrollbarStyle","native",function(cm){initScrollbars(cm);updateScrollbars(cm);cm.display.scrollbars.setScrollTop(cm.doc.scrollTop);cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft)},true);option("lineNumbers",false,function(cm){setGuttersForLineNumbers(cm.options);guttersChanged(cm)},true);option("firstLineNumber",1,guttersChanged,true);option("lineNumberFormatter",function(integer){return integer},guttersChanged,true);option("showCursorWhenSelecting",false,updateSelection,true);option("resetSelectionOnContextMenu",true);option("lineWiseCopyCut",true);option("pasteLinesPerSelection",true);option("readOnly",false,function(cm,val){if(val=="nocursor"){onBlur(cm);cm.display.input.blur()}cm.display.input.readOnlyChanged(val)});option("disableInput",false,function(cm,val){if(!val){cm.display.input.reset()}},true);option("dragDrop",true,dragDropChanged);option("allowDropFileTypes",null);option("cursorBlinkRate",530);option("cursorScrollMargin",0);option("cursorHeight",1,updateSelection,true);option("singleCursorHeightPerLine",true,updateSelection,true);option("workTime",100);option("workDelay",100);option("flattenSpans",true,resetModeState,true);option("addModeClass",false,resetModeState,true);option("pollInterval",100);option("undoDepth",200,function(cm,val){return cm.doc.history.undoDepth=val});option("historyEventDelay",1250);option("viewportMargin",10,function(cm){return cm.refresh()},true);option("maxHighlightLength",1e4,resetModeState,true);option("moveInputWithCursor",true,function(cm,val){if(!val){cm.display.input.resetPosition()}});option("tabindex",null,function(cm,val){return cm.display.input.getField().tabIndex=val||""});option("autofocus",null);option("direction","ltr",function(cm,val){return cm.doc.setDirection(val)},true)}function guttersChanged(cm){updateGutters(cm);regChange(cm);alignHorizontally(cm)}function dragDropChanged(cm,value,old){var wasOn=old&&old!=Init;if(!value!=!wasOn){var funcs=cm.display.dragFunctions;var toggle=value?on:off;toggle(cm.display.scroller,"dragstart",funcs.start);toggle(cm.display.scroller,"dragenter",funcs.enter);toggle(cm.display.scroller,"dragover",funcs.over);toggle(cm.display.scroller,"dragleave",funcs.leave);toggle(cm.display.scroller,"drop",funcs.drop)}}function wrappingChanged(cm){if(cm.options.lineWrapping){addClass(cm.display.wrapper,"CodeMirror-wrap");cm.display.sizer.style.minWidth="";cm.display.sizerWidth=null}else{rmClass(cm.display.wrapper,"CodeMirror-wrap");findMaxLine(cm)}estimateLineHeights(cm);regChange(cm);clearCaches(cm);setTimeout(function(){return updateScrollbars(cm)},100)}function CodeMirror$1(place,options){var this$1=this;if(!(this instanceof CodeMirror$1)){return new CodeMirror$1(place,options)}this.options=options=options?copyObj(options):{};copyObj(defaults,options,false);setGuttersForLineNumbers(options);var doc=options.value;if(typeof doc=="string"){doc=new Doc(doc,options.mode,null,options.lineSeparator,options.direction)}this.doc=doc;var input=new CodeMirror$1.inputStyles[options.inputStyle](this);var display=this.display=new Display(place,doc,input);display.wrapper.CodeMirror=this;updateGutters(this);themeChanged(this);if(options.lineWrapping){this.display.wrapper.className+=" CodeMirror-wrap"}initScrollbars(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:false,delayingBlurEvent:false,focused:false,suppressEdits:false,pasteIncoming:false,cutIncoming:false,selectingText:false,draggingText:false,highlight:new Delayed,keySeq:null,specialChars:null};if(options.autofocus&&!mobile){display.input.focus()}if(ie&&ie_version<11){setTimeout(function(){return this$1.display.input.reset(true)},20)}registerEventHandlers(this);ensureGlobalHandlers();startOperation(this);this.curOp.forceUpdate=true;attachDoc(this,doc);if(options.autofocus&&!mobile||this.hasFocus()){setTimeout(bind(onFocus,this),20)}else{onBlur(this)}for(var opt in optionHandlers){if(optionHandlers.hasOwnProperty(opt)){optionHandlers[opt](this$1,options[opt],Init)}}maybeUpdateLineNumberWidth(this);if(options.finishInit){options.finishInit(this)}for(var i=0;i<initHooks.length;++i){initHooks[i](this$1)}endOperation(this);if(webkit&&options.lineWrapping&&getComputedStyle(display.lineDiv).textRendering=="optimizelegibility"){display.lineDiv.style.textRendering="auto"}}CodeMirror$1.defaults=defaults;CodeMirror$1.optionHandlers=optionHandlers;function registerEventHandlers(cm){var d=cm.display;on(d.scroller,"mousedown",operation(cm,onMouseDown));if(ie&&ie_version<11){on(d.scroller,"dblclick",operation(cm,function(e){if(signalDOMEvent(cm,e)){return}var pos=posFromMouse(cm,e);if(!pos||clickInGutter(cm,e)||eventInWidget(cm.display,e)){return}e_preventDefault(e);var word=cm.findWordAt(pos);extendSelection(cm.doc,word.anchor,word.head)}))}else{on(d.scroller,"dblclick",function(e){return signalDOMEvent(cm,e)||e_preventDefault(e)})}if(!captureRightClick){on(d.scroller,"contextmenu",function(e){return onContextMenu(cm,e)})}var touchFinished,prevTouch={end:0};function finishTouch(){if(d.activeTouch){touchFinished=setTimeout(function(){return d.activeTouch=null},1e3);prevTouch=d.activeTouch;prevTouch.end=+new Date}}function isMouseLikeTouchEvent(e){if(e.touches.length!=1){return false}var touch=e.touches[0];return touch.radiusX<=1&&touch.radiusY<=1}function farAway(touch,other){if(other.left==null){return true}var dx=other.left-touch.left,dy=other.top-touch.top;return dx*dx+dy*dy>20*20}on(d.scroller,"touchstart",function(e){if(!signalDOMEvent(cm,e)&&!isMouseLikeTouchEvent(e)){d.input.ensurePolled();clearTimeout(touchFinished);var now=+new Date;d.activeTouch={start:now,moved:false,prev:now-prevTouch.end<=300?prevTouch:null};if(e.touches.length==1){d.activeTouch.left=e.touches[0].pageX;d.activeTouch.top=e.touches[0].pageY}}});on(d.scroller,"touchmove",function(){if(d.activeTouch){d.activeTouch.moved=true}});on(d.scroller,"touchend",function(e){var touch=d.activeTouch;if(touch&&!eventInWidget(d,e)&&touch.left!=null&&!touch.moved&&new Date-touch.start<300){var pos=cm.coordsChar(d.activeTouch,"page"),range;if(!touch.prev||farAway(touch,touch.prev)){range=new Range(pos,pos)}else if(!touch.prev.prev||farAway(touch,touch.prev.prev)){range=cm.findWordAt(pos)}else{range=new Range(Pos(pos.line,0),clipPos(cm.doc,Pos(pos.line+1,0)))}cm.setSelection(range.anchor,range.head);cm.focus();e_preventDefault(e)}finishTouch()});on(d.scroller,"touchcancel",finishTouch);on(d.scroller,"scroll",function(){if(d.scroller.clientHeight){updateScrollTop(cm,d.scroller.scrollTop);setScrollLeft(cm,d.scroller.scrollLeft,true);signal(cm,"scroll",cm)}});on(d.scroller,"mousewheel",function(e){return onScrollWheel(cm,e)});on(d.scroller,"DOMMouseScroll",function(e){return onScrollWheel(cm,e)});on(d.wrapper,"scroll",function(){return d.wrapper.scrollTop=d.wrapper.scrollLeft=0});d.dragFunctions={enter:function(e){if(!signalDOMEvent(cm,e)){e_stop(e)}},over:function(e){if(!signalDOMEvent(cm,e)){onDragOver(cm,e);e_stop(e)}},start:function(e){return onDragStart(cm,e)},drop:operation(cm,onDrop),leave:function(e){if(!signalDOMEvent(cm,e)){clearDragCursor(cm)}}};var inp=d.input.getField();on(inp,"keyup",function(e){return onKeyUp.call(cm,e)});on(inp,"keydown",operation(cm,onKeyDown));on(inp,"keypress",operation(cm,onKeyPress));on(inp,"focus",function(e){return onFocus(cm,e)});on(inp,"blur",function(e){return onBlur(cm,e)})}var initHooks=[];CodeMirror$1.defineInitHook=function(f){return initHooks.push(f)};function indentLine(cm,n,how,aggressive){var doc=cm.doc,state;if(how==null){how="add"}if(how=="smart"){if(!doc.mode.indent){how="prev"}else{state=getContextBefore(cm,n).state}}var tabSize=cm.options.tabSize;var line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize);if(line.stateAfter){line.stateAfter=null}var curSpaceString=line.text.match(/^\s*/)[0],indentation;if(!aggressive&&!/\S/.test(line.text)){indentation=0;how="not"}else if(how=="smart"){indentation=doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text);if(indentation==Pass||indentation>150){if(!aggressive){return}how="prev"}}if(how=="prev"){if(n>doc.first){indentation=countColumn(getLine(doc,n-1).text,null,tabSize)}else{indentation=0}}else if(how=="add"){indentation=curSpace+cm.options.indentUnit}else if(how=="subtract"){indentation=curSpace-cm.options.indentUnit}else if(typeof how=="number"){indentation=curSpace+how}indentation=Math.max(0,indentation);var indentString="",pos=0;if(cm.options.indentWithTabs){for(var i=Math.floor(indentation/tabSize);i;--i){pos+=tabSize;indentString+="\t"}}if(pos<indentation){indentString+=spaceStr(indentation-pos)}if(indentString!=curSpaceString){replaceRange(doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input");line.stateAfter=null;return true}else{for(var i$1=0;i$1<doc.sel.ranges.length;i$1++){var range=doc.sel.ranges[i$1];if(range.head.line==n&&range.head.ch<curSpaceString.length){var pos$1=Pos(n,curSpaceString.length);replaceOneSelection(doc,i$1,new Range(pos$1,pos$1));break}}}}var lastCopied=null;function setLastCopied(newLastCopied){lastCopied=newLastCopied}function applyTextInput(cm,inserted,deleted,sel,origin){var doc=cm.doc;cm.display.shift=false;if(!sel){sel=doc.sel}var paste=cm.state.pasteIncoming||origin=="paste";var textLines=splitLinesAuto(inserted),multiPaste=null;if(paste&&sel.ranges.length>1){if(lastCopied&&lastCopied.text.join("\n")==inserted){if(sel.ranges.length%lastCopied.text.length==0){multiPaste=[];for(var i=0;i<lastCopied.text.length;i++){multiPaste.push(doc.splitLines(lastCopied.text[i]))}}}else if(textLines.length==sel.ranges.length&&cm.options.pasteLinesPerSelection){multiPaste=map(textLines,function(l){return[l]})}}var updateInput;for(var i$1=sel.ranges.length-1;i$1>=0;i$1--){var range$$1=sel.ranges[i$1];var from=range$$1.from(),to=range$$1.to();if(range$$1.empty()){if(deleted&&deleted>0){from=Pos(from.line,from.ch-deleted)}else if(cm.state.overwrite&&!paste){to=Pos(to.line,Math.min(getLine(doc,to.line).text.length,to.ch+lst(textLines).length))}else if(lastCopied&&lastCopied.lineWise&&lastCopied.text.join("\n")==inserted){from=to=Pos(from.line,0)}}updateInput=cm.curOp.updateInput;var changeEvent={from:from,to:to,text:multiPaste?multiPaste[i$1%multiPaste.length]:textLines,origin:origin||(paste?"paste":cm.state.cutIncoming?"cut":"+input")};makeChange(cm.doc,changeEvent);signalLater(cm,"inputRead",cm,changeEvent)}if(inserted&&!paste){triggerElectric(cm,inserted)}ensureCursorVisible(cm);cm.curOp.updateInput=updateInput;cm.curOp.typing=true;cm.state.pasteIncoming=cm.state.cutIncoming=false}function handlePaste(e,cm){var pasted=e.clipboardData&&e.clipboardData.getData("Text");if(pasted){e.preventDefault();if(!cm.isReadOnly()&&!cm.options.disableInput){runInOp(cm,function(){return applyTextInput(cm,pasted,0,null,"paste")})}return true}}function triggerElectric(cm,inserted){if(!cm.options.electricChars||!cm.options.smartIndent){return}var sel=cm.doc.sel;for(var i=sel.ranges.length-1;i>=0;i--){var range$$1=sel.ranges[i];if(range$$1.head.ch>100||i&&sel.ranges[i-1].head.line==range$$1.head.line){continue}var mode=cm.getModeAt(range$$1.head);var indented=false;if(mode.electricChars){for(var j=0;j<mode.electricChars.length;j++){if(inserted.indexOf(mode.electricChars.charAt(j))>-1){indented=indentLine(cm,range$$1.head.line,"smart");break}}}else if(mode.electricInput){if(mode.electricInput.test(getLine(cm.doc,range$$1.head.line).text.slice(0,range$$1.head.ch))){indented=indentLine(cm,range$$1.head.line,"smart")}}if(indented){signalLater(cm,"electricInput",cm,range$$1.head.line)}}}function copyableRanges(cm){var text=[],ranges=[];for(var i=0;i<cm.doc.sel.ranges.length;i++){var line=cm.doc.sel.ranges[i].head.line;var lineRange={anchor:Pos(line,0),head:Pos(line+1,0)};ranges.push(lineRange);text.push(cm.getRange(lineRange.anchor,lineRange.head))}return{text:text,ranges:ranges}}function disableBrowserMagic(field,spellcheck){field.setAttribute("autocorrect","off");field.setAttribute("autocapitalize","off");field.setAttribute("spellcheck",!!spellcheck)}function hiddenTextarea(){var te=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none");var div=elt("div",[te],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");if(webkit){te.style.width="1000px"}else{te.setAttribute("wrap","off")}if(ios){te.style.border="1px solid black"}disableBrowserMagic(te);return div}var addEditorMethods=function(CodeMirror){var optionHandlers=CodeMirror.optionHandlers;var helpers=CodeMirror.helpers={};CodeMirror.prototype={constructor:CodeMirror,focus:function(){window.focus();this.display.input.focus()},setOption:function(option,value){var options=this.options,old=options[option];if(options[option]==value&&option!="mode"){return}options[option]=value;if(optionHandlers.hasOwnProperty(option)){operation(this,optionHandlers[option])(this,value,old)}signal(this,"optionChange",this,option)},getOption:function(option){return this.options[option]},getDoc:function(){return this.doc},addKeyMap:function(map$$1,bottom){this.state.keyMaps[bottom?"push":"unshift"](getKeyMap(map$$1))},removeKeyMap:function(map$$1){var maps=this.state.keyMaps;for(var i=0;i<maps.length;++i){if(maps[i]==map$$1||maps[i].name==map$$1){maps.splice(i,1);return true}}},addOverlay:methodOp(function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec);if(mode.startState){throw new Error("Overlays may not be stateful.")}insertSorted(this.state.overlays,{mode:mode,modeSpec:spec,opaque:options&&options.opaque,priority:options&&options.priority||0},function(overlay){return overlay.priority});this.state.modeGen++;regChange(this)}),removeOverlay:methodOp(function(spec){var this$1=this;var overlays=this.state.overlays;for(var i=0;i<overlays.length;++i){var cur=overlays[i].modeSpec;if(cur==spec||typeof spec=="string"&&cur.name==spec){overlays.splice(i,1);this$1.state.modeGen++;regChange(this$1);return}}}),indentLine:methodOp(function(n,dir,aggressive){if(typeof dir!="string"&&typeof dir!="number"){if(dir==null){dir=this.options.smartIndent?"smart":"prev"}else{dir=dir?"add":"subtract"}}if(isLine(this.doc,n)){indentLine(this,n,dir,aggressive)}}),indentSelection:methodOp(function(how){var this$1=this;var ranges=this.doc.sel.ranges,end=-1;for(var i=0;i<ranges.length;i++){var range$$1=ranges[i];if(!range$$1.empty()){var from=range$$1.from(),to=range$$1.to();var start=Math.max(end,from.line);end=Math.min(this$1.lastLine(),to.line-(to.ch?0:1))+1;for(var j=start;j<end;++j){indentLine(this$1,j,how)}var newRanges=this$1.doc.sel.ranges;if(from.ch==0&&ranges.length==newRanges.length&&newRanges[i].from().ch>0){replaceOneSelection(this$1.doc,i,new Range(from,newRanges[i].to()),sel_dontScroll)}}else if(range$$1.head.line>end){indentLine(this$1,range$$1.head.line,how,true);end=range$$1.head.line;if(i==this$1.doc.sel.primIndex){ensureCursorVisible(this$1)}}}}),getTokenAt:function(pos,precise){return takeToken(this,pos,precise)},getLineTokens:function(line,precise){return takeToken(this,Pos(line),precise,true)},getTokenTypeAt:function(pos){pos=clipPos(this.doc,pos);var styles=getLineStyles(this,getLine(this.doc,pos.line));var before=0,after=(styles.length-1)/2,ch=pos.ch;var type;if(ch==0){type=styles[2]}else{for(;;){var mid=before+after>>1;if((mid?styles[mid*2-1]:0)>=ch){after=mid}else if(styles[mid*2+1]<ch){before=mid+1}else{type=styles[mid*2+2];break}}}var cut=type?type.indexOf("overlay "):-1;return cut<0?type:cut==0?null:type.slice(0,cut-1)},getModeAt:function(pos){var mode=this.doc.mode;if(!mode.innerMode){return mode}return CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode},getHelper:function(pos,type){return this.getHelpers(pos,type)[0]},getHelpers:function(pos,type){var this$1=this;var found=[];if(!helpers.hasOwnProperty(type)){return found}var help=helpers[type],mode=this.getModeAt(pos);if(typeof mode[type]=="string"){if(help[mode[type]]){found.push(help[mode[type]])}}else if(mode[type]){for(var i=0;i<mode[type].length;i++){var val=help[mode[type][i]];if(val){found.push(val)}}}else if(mode.helperType&&help[mode.helperType]){found.push(help[mode.helperType])}else if(help[mode.name]){found.push(help[mode.name])}for(var i$1=0;i$1<help._global.length;i$1++){var cur=help._global[i$1];if(cur.pred(mode,this$1)&&indexOf(found,cur.val)==-1){found.push(cur.val)}}return found},getStateAfter:function(line,precise){var doc=this.doc;line=clipLine(doc,line==null?doc.first+doc.size-1:line);return getContextBefore(this,line+1,precise).state},cursorCoords:function(start,mode){var pos,range$$1=this.doc.sel.primary();if(start==null){pos=range$$1.head}else if(typeof start=="object"){pos=clipPos(this.doc,start)}else{pos=start?range$$1.from():range$$1.to()}return cursorCoords(this,pos,mode||"page")},charCoords:function(pos,mode){return charCoords(this,clipPos(this.doc,pos),mode||"page")},coordsChar:function(coords,mode){coords=fromCoordSystem(this,coords,mode||"page");return coordsChar(this,coords.left,coords.top)},lineAtHeight:function(height,mode){height=fromCoordSystem(this,{top:height,left:0},mode||"page").top;return lineAtHeight(this.doc,height+this.display.viewOffset)},heightAtLine:function(line,mode,includeWidgets){var end=false,lineObj;if(typeof line=="number"){var last=this.doc.first+this.doc.size-1;if(line<this.doc.first){line=this.doc.first}else if(line>last){line=last;end=true}lineObj=getLine(this.doc,line)}else{lineObj=line}return intoCoordSystem(this,lineObj,{top:0,left:0},mode||"page",includeWidgets||end).top+(end?this.doc.height-heightAtLine(lineObj):0)},defaultTextHeight:function(){return textHeight(this.display)},defaultCharWidth:function(){return charWidth(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(pos,node,scroll,vert,horiz){var display=this.display;pos=cursorCoords(this,clipPos(this.doc,pos));var top=pos.bottom,left=pos.left;node.style.position="absolute";node.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(node);display.sizer.appendChild(node);if(vert=="over"){top=pos.top}else if(vert=="above"||vert=="near"){var vspace=Math.max(display.wrapper.clientHeight,this.doc.height),hspace=Math.max(display.sizer.clientWidth,display.lineSpace.clientWidth);if((vert=="above"||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight){top=pos.top-node.offsetHeight}else if(pos.bottom+node.offsetHeight<=vspace){top=pos.bottom}if(left+node.offsetWidth>hspace){left=hspace-node.offsetWidth}}node.style.top=top+"px";node.style.left=node.style.right="";if(horiz=="right"){left=display.sizer.clientWidth-node.offsetWidth;node.style.right="0px"}else{if(horiz=="left"){left=0}else if(horiz=="middle"){left=(display.sizer.clientWidth-node.offsetWidth)/2}node.style.left=left+"px"}if(scroll){scrollIntoView(this,{left:left,top:top,right:left+node.offsetWidth,bottom:top+node.offsetHeight})}},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function(cmd){if(commands.hasOwnProperty(cmd)){return commands[cmd].call(null,this)}},triggerElectric:methodOp(function(text){triggerElectric(this,text)}),findPosH:function(from,amount,unit,visually){var this$1=this;var dir=1;if(amount<0){dir=-1;amount=-amount}var cur=clipPos(this.doc,from);for(var i=0;i<amount;++i){cur=findPosH(this$1.doc,cur,dir,unit,visually);if(cur.hitSide){break}}return cur},moveH:methodOp(function(dir,unit){var this$1=this;this.extendSelectionsBy(function(range$$1){if(this$1.display.shift||this$1.doc.extend||range$$1.empty()){return findPosH(this$1.doc,range$$1.head,dir,unit,this$1.options.rtlMoveVisually)}else{return dir<0?range$$1.from():range$$1.to()}},sel_move)}),deleteH:methodOp(function(dir,unit){var sel=this.doc.sel,doc=this.doc;if(sel.somethingSelected()){doc.replaceSelection("",null,"+delete")}else{deleteNearSelection(this,function(range$$1){var other=findPosH(doc,range$$1.head,dir,unit,false);return dir<0?{from:other,to:range$$1.head}:{from:range$$1.head,to:other}})}}),findPosV:function(from,amount,unit,goalColumn){var this$1=this;var dir=1,x=goalColumn;if(amount<0){dir=-1;amount=-amount}var cur=clipPos(this.doc,from);for(var i=0;i<amount;++i){var coords=cursorCoords(this$1,cur,"div");if(x==null){x=coords.left}else{coords.left=x}cur=findPosV(this$1,coords,dir,unit);if(cur.hitSide){break}}return cur},moveV:methodOp(function(dir,unit){var this$1=this;var doc=this.doc,goals=[];var collapse=!this.display.shift&&!doc.extend&&doc.sel.somethingSelected();doc.extendSelectionsBy(function(range$$1){if(collapse){return dir<0?range$$1.from():range$$1.to()}var headPos=cursorCoords(this$1,range$$1.head,"div");if(range$$1.goalColumn!=null){headPos.left=range$$1.goalColumn}goals.push(headPos.left);var pos=findPosV(this$1,headPos,dir,unit);if(unit=="page"&&range$$1==doc.sel.primary()){addToScrollTop(this$1,charCoords(this$1,pos,"div").top-headPos.top)}return pos},sel_move);if(goals.length){for(var i=0;i<doc.sel.ranges.length;i++){doc.sel.ranges[i].goalColumn=goals[i]}}}),findWordAt:function(pos){var doc=this.doc,line=getLine(doc,pos.line).text;var start=pos.ch,end=pos.ch;if(line){var helper=this.getHelper(pos,"wordChars");if((pos.sticky=="before"||end==line.length)&&start){--start}else{++end}var startChar=line.charAt(start);var check=isWordChar(startChar,helper)?function(ch){return isWordChar(ch,helper)}:/\s/.test(startChar)?function(ch){return/\s/.test(ch)}:function(ch){return!/\s/.test(ch)&&!isWordChar(ch)};while(start>0&&check(line.charAt(start-1))){--start}while(end<line.length&&check(line.charAt(end))){++end}}return new Range(Pos(pos.line,start),Pos(pos.line,end))},toggleOverwrite:function(value){if(value!=null&&value==this.state.overwrite){return}if(this.state.overwrite=!this.state.overwrite){addClass(this.display.cursorDiv,"CodeMirror-overwrite")}else{rmClass(this.display.cursorDiv,"CodeMirror-overwrite")}signal(this,"overwriteToggle",this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==activeElt()},isReadOnly:function(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:methodOp(function(x,y){scrollToCoords(this,x,y)}),getScrollInfo:function(){var scroller=this.display.scroller;return{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-scrollGap(this)-this.display.barHeight,width:scroller.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp(function(range$$1,margin){if(range$$1==null){range$$1={from:this.doc.sel.primary().head,to:null};if(margin==null){margin=this.options.cursorScrollMargin}}else if(typeof range$$1=="number"){range$$1={from:Pos(range$$1,0),to:null}}else if(range$$1.from==null){range$$1={from:range$$1,to:null}}if(!range$$1.to){range$$1.to=range$$1.from}range$$1.margin=margin||0;if(range$$1.from.line!=null){scrollToRange(this,range$$1)}else{scrollToCoordsRange(this,range$$1.from,range$$1.to,range$$1.margin)}}),setSize:methodOp(function(width,height){var this$1=this;var interpret=function(val){return typeof val=="number"||/^\d+$/.test(String(val))?val+"px":val};if(width!=null){this.display.wrapper.style.width=interpret(width)}if(height!=null){this.display.wrapper.style.height=interpret(height)}if(this.options.lineWrapping){clearLineMeasurementCache(this)}var lineNo$$1=this.display.viewFrom;this.doc.iter(lineNo$$1,this.display.viewTo,function(line){if(line.widgets){for(var i=0;i<line.widgets.length;i++){if(line.widgets[i].noHScroll){regLineChange(this$1,lineNo$$1,"widget");break}}}++lineNo$$1});this.curOp.forceUpdate=true;signal(this,"refresh",this)}),operation:function(f){return runInOp(this,f)},startOperation:function(){return startOperation(this)},endOperation:function(){return endOperation(this)},refresh:methodOp(function(){var oldHeight=this.display.cachedTextHeight;regChange(this);this.curOp.forceUpdate=true;clearCaches(this);scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop);updateGutterSpace(this);if(oldHeight==null||Math.abs(oldHeight-textHeight(this.display))>.5){estimateLineHeights(this)}signal(this,"refresh",this)}),swapDoc:methodOp(function(doc){var old=this.doc;old.cm=null;attachDoc(this,doc);clearCaches(this);this.display.input.reset();scrollToCoords(this,doc.scrollLeft,doc.scrollTop);this.curOp.forceScroll=true;signalLater(this,"swapDoc",this,old);return old}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};eventMixin(CodeMirror);CodeMirror.registerHelper=function(type,name,value){if(!helpers.hasOwnProperty(type)){helpers[type]=CodeMirror[type]={_global:[]}}helpers[type][name]=value};CodeMirror.registerGlobalHelper=function(type,name,predicate,value){CodeMirror.registerHelper(type,name,value);helpers[type]._global.push({pred:predicate,val:value})}};function findPosH(doc,pos,dir,unit,visually){var oldPos=pos;var origDir=dir;var lineObj=getLine(doc,pos.line);function findNextLine(){var l=pos.line+dir;if(l<doc.first||l>=doc.first+doc.size){return false}pos=new Pos(l,pos.ch,pos.sticky);return lineObj=getLine(doc,l)}function moveOnce(boundToLine){var next;if(visually){next=moveVisually(doc.cm,lineObj,pos,dir)}else{next=moveLogically(lineObj,pos,dir)}if(next==null){if(!boundToLine&&findNextLine()){pos=endOfLine(visually,doc.cm,lineObj,pos.line,dir)}else{return false}}else{pos=next}return true}if(unit=="char"){moveOnce()}else if(unit=="column"){moveOnce(true)}else if(unit=="word"||unit=="group"){var sawType=null,group=unit=="group";var helper=doc.cm&&doc.cm.getHelper(pos,"wordChars");for(var first=true;;first=false){if(dir<0&&!moveOnce(!first)){break}var cur=lineObj.text.charAt(pos.ch)||"\n";var type=isWordChar(cur,helper)?"w":group&&cur=="\n"?"n":!group||/\s/.test(cur)?null:"p";if(group&&!first&&!type){type="s"}if(sawType&&sawType!=type){if(dir<0){dir=1;moveOnce();pos.sticky="after"}break}if(type){sawType=type}if(dir>0&&!moveOnce(!first)){break}}}var result=skipAtomic(doc,pos,oldPos,origDir,true);if(equalCursorPos(oldPos,result)){result.hitSide=true}return result}function findPosV(cm,pos,dir,unit){var doc=cm.doc,x=pos.left,y;if(unit=="page"){var pageSize=Math.min(cm.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);var moveAmount=Math.max(pageSize-.5*textHeight(cm.display),3);y=(dir>0?pos.bottom:pos.top)+dir*moveAmount}else if(unit=="line"){y=dir>0?pos.bottom+3:pos.top-3}var target;for(;;){target=coordsChar(cm,x,y);if(!target.outside){break}if(dir<0?y<=0:y>=doc.height){target.hitSide=true;break}y+=dir*5}return target}var ContentEditableInput=function(cm){this.cm=cm;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new Delayed;this.composing=null;this.gracePeriod=false;this.readDOMTimeout=null};ContentEditableInput.prototype.init=function(display){var this$1=this;var input=this,cm=input.cm;var div=input.div=display.lineDiv;disableBrowserMagic(div,cm.options.spellcheck);on(div,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return}if(ie_version<=11){setTimeout(operation(cm,function(){return this$1.updateFromDOM()}),20)}});on(div,"compositionstart",function(e){this$1.composing={data:e.data,done:false}});on(div,"compositionupdate",function(e){if(!this$1.composing){this$1.composing={data:e.data,done:false}}});on(div,"compositionend",function(e){if(this$1.composing){if(e.data!=this$1.composing.data){this$1.readFromDOMSoon()}this$1.composing.done=true}});on(div,"touchstart",function(){return input.forceCompositionEnd()});on(div,"input",function(){if(!this$1.composing){this$1.readFromDOMSoon()}});function onCopyCut(e){if(signalDOMEvent(cm,e)){return}if(cm.somethingSelected()){setLastCopied({lineWise:false,text:cm.getSelections()});if(e.type=="cut"){cm.replaceSelection("",null,"cut")}}else if(!cm.options.lineWiseCopyCut){return}else{var ranges=copyableRanges(cm);setLastCopied({lineWise:true,text:ranges.text});if(e.type=="cut"){cm.operation(function(){cm.setSelections(ranges.ranges,0,sel_dontScroll);cm.replaceSelection("",null,"cut")})}}if(e.clipboardData){e.clipboardData.clearData();var content=lastCopied.text.join("\n");e.clipboardData.setData("Text",content);if(e.clipboardData.getData("Text")==content){e.preventDefault();return}}var kludge=hiddenTextarea(),te=kludge.firstChild;cm.display.lineSpace.insertBefore(kludge,cm.display.lineSpace.firstChild);te.value=lastCopied.text.join("\n");var hadFocus=document.activeElement;selectInput(te);setTimeout(function(){cm.display.lineSpace.removeChild(kludge);hadFocus.focus();if(hadFocus==div){input.showPrimarySelection()}},50)}on(div,"copy",onCopyCut);on(div,"cut",onCopyCut)};ContentEditableInput.prototype.prepareSelection=function(){var result=prepareSelection(this.cm,false);result.focus=this.cm.state.focused;return result};ContentEditableInput.prototype.showSelection=function(info,takeFocus){if(!info||!this.cm.display.view.length){return}if(info.focus||takeFocus){this.showPrimarySelection()}this.showMultipleSelections(info)};ContentEditableInput.prototype.showPrimarySelection=function(){var sel=window.getSelection(),cm=this.cm,prim=cm.doc.sel.primary();var from=prim.from(),to=prim.to();if(cm.display.viewTo==cm.display.viewFrom||from.line>=cm.display.viewTo||to.line<cm.display.viewFrom){sel.removeAllRanges();return}var curAnchor=domToPos(cm,sel.anchorNode,sel.anchorOffset);var curFocus=domToPos(cm,sel.focusNode,sel.focusOffset);if(curAnchor&&!curAnchor.bad&&curFocus&&!curFocus.bad&&cmp(minPos(curAnchor,curFocus),from)==0&&cmp(maxPos(curAnchor,curFocus),to)==0){return}var view=cm.display.view;var start=from.line>=cm.display.viewFrom&&posToDOM(cm,from)||{node:view[0].measure.map[2],offset:0};var end=to.line<cm.display.viewTo&&posToDOM(cm,to);if(!end){var measure=view[view.length-1].measure;var map$$1=measure.maps?measure.maps[measure.maps.length-1]:measure.map;end={node:map$$1[map$$1.length-1],offset:map$$1[map$$1.length-2]-map$$1[map$$1.length-3]}}if(!start||!end){sel.removeAllRanges();return}var old=sel.rangeCount&&sel.getRangeAt(0),rng;try{rng=range(start.node,start.offset,end.offset,end.node)}catch(e){}if(rng){if(!gecko&&cm.state.focused){sel.collapse(start.node,start.offset);if(!rng.collapsed){sel.removeAllRanges();sel.addRange(rng)}}else{sel.removeAllRanges();sel.addRange(rng)}if(old&&sel.anchorNode==null){sel.addRange(old)}else if(gecko){this.startGracePeriod()}}this.rememberSelection()};ContentEditableInput.prototype.startGracePeriod=function(){var this$1=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){this$1.gracePeriod=false;if(this$1.selectionChanged()){this$1.cm.operation(function(){return this$1.cm.curOp.selectionChanged=true})}},20)};ContentEditableInput.prototype.showMultipleSelections=function(info){removeChildrenAndAdd(this.cm.display.cursorDiv,info.cursors);removeChildrenAndAdd(this.cm.display.selectionDiv,info.selection)};ContentEditableInput.prototype.rememberSelection=function(){var sel=window.getSelection();this.lastAnchorNode=sel.anchorNode;this.lastAnchorOffset=sel.anchorOffset;this.lastFocusNode=sel.focusNode;this.lastFocusOffset=sel.focusOffset};ContentEditableInput.prototype.selectionInEditor=function(){var sel=window.getSelection();if(!sel.rangeCount){return false}var node=sel.getRangeAt(0).commonAncestorContainer;return contains(this.div,node)};ContentEditableInput.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"){if(!this.selectionInEditor()){this.showSelection(this.prepareSelection(),true)}this.div.focus()}};ContentEditableInput.prototype.blur=function(){this.div.blur()};ContentEditableInput.prototype.getField=function(){return this.div};ContentEditableInput.prototype.supportsTouch=function(){return true};ContentEditableInput.prototype.receivedFocus=function(){var input=this;if(this.selectionInEditor()){this.pollSelection()}else{runInOp(this.cm,function(){return input.cm.curOp.selectionChanged=true})}function poll(){if(input.cm.state.focused){input.pollSelection();input.polling.set(input.cm.options.pollInterval,poll)}}this.polling.set(this.cm.options.pollInterval,poll)};ContentEditableInput.prototype.selectionChanged=function(){var sel=window.getSelection();return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastFocusNode||sel.focusOffset!=this.lastFocusOffset};ContentEditableInput.prototype.pollSelection=function(){if(this.readDOMTimeout!=null||this.gracePeriod||!this.selectionChanged()){return}var sel=window.getSelection(),cm=this.cm;if(android&&chrome&&this.cm.options.gutters.length&&isInGutter(sel.anchorNode)){this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs});this.blur();this.focus();return}if(this.composing){return}this.rememberSelection();var anchor=domToPos(cm,sel.anchorNode,sel.anchorOffset);var head=domToPos(cm,sel.focusNode,sel.focusOffset);if(anchor&&head){runInOp(cm,function(){setSelection(cm.doc,simpleSelection(anchor,head),sel_dontScroll);if(anchor.bad||head.bad){cm.curOp.selectionChanged=true}})}};ContentEditableInput.prototype.pollContent=function(){if(this.readDOMTimeout!=null){clearTimeout(this.readDOMTimeout);this.readDOMTimeout=null}var cm=this.cm,display=cm.display,sel=cm.doc.sel.primary();var from=sel.from(),to=sel.to();if(from.ch==0&&from.line>cm.firstLine()){from=Pos(from.line-1,getLine(cm.doc,from.line-1).length)}if(to.ch==getLine(cm.doc,to.line).text.length&&to.line<cm.lastLine()){to=Pos(to.line+1,0)}if(from.line<display.viewFrom||to.line>display.viewTo-1){return false}var fromIndex,fromLine,fromNode;if(from.line==display.viewFrom||(fromIndex=findViewIndex(cm,from.line))==0){fromLine=lineNo(display.view[0].line);fromNode=display.view[0].node}else{fromLine=lineNo(display.view[fromIndex].line);fromNode=display.view[fromIndex-1].node.nextSibling}var toIndex=findViewIndex(cm,to.line);var toLine,toNode;if(toIndex==display.view.length-1){toLine=display.viewTo-1;toNode=display.lineDiv.lastChild}else{toLine=lineNo(display.view[toIndex+1].line)-1;toNode=display.view[toIndex+1].node.previousSibling}if(!fromNode){return false}var newText=cm.doc.splitLines(domTextBetween(cm,fromNode,toNode,fromLine,toLine));var oldText=getBetween(cm.doc,Pos(fromLine,0),Pos(toLine,getLine(cm.doc,toLine).text.length));while(newText.length>1&&oldText.length>1){if(lst(newText)==lst(oldText)){newText.pop();oldText.pop();toLine--}else if(newText[0]==oldText[0]){newText.shift();oldText.shift();fromLine++}else{break}}var cutFront=0,cutEnd=0;var newTop=newText[0],oldTop=oldText[0],maxCutFront=Math.min(newTop.length,oldTop.length);while(cutFront<maxCutFront&&newTop.charCodeAt(cutFront)==oldTop.charCodeAt(cutFront)){++cutFront}var newBot=lst(newText),oldBot=lst(oldText);var maxCutEnd=Math.min(newBot.length-(newText.length==1?cutFront:0),oldBot.length-(oldText.length==1?cutFront:0));while(cutEnd<maxCutEnd&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1)){++cutEnd}if(newText.length==1&&oldText.length==1&&fromLine==from.line){while(cutFront&&cutFront>from.ch&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1)){cutFront--;cutEnd++}}newText[newText.length-1]=newBot.slice(0,newBot.length-cutEnd).replace(/^\u200b+/,"");newText[0]=newText[0].slice(cutFront).replace(/\u200b+$/,"");var chFrom=Pos(fromLine,cutFront);var chTo=Pos(toLine,oldText.length?lst(oldText).length-cutEnd:0);if(newText.length>1||newText[0]||cmp(chFrom,chTo)){replaceRange(cm.doc,newText,chFrom,chTo,"+input");return true}};ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd()};ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd()};ContentEditableInput.prototype.forceCompositionEnd=function(){if(!this.composing){return}clearTimeout(this.readDOMTimeout);this.composing=null;this.updateFromDOM();this.div.blur();this.div.focus()};ContentEditableInput.prototype.readFromDOMSoon=function(){var this$1=this;if(this.readDOMTimeout!=null){return}this.readDOMTimeout=setTimeout(function(){this$1.readDOMTimeout=null;if(this$1.composing){if(this$1.composing.done){this$1.composing=null}else{return}}this$1.updateFromDOM()},80)};ContentEditableInput.prototype.updateFromDOM=function(){var this$1=this;if(this.cm.isReadOnly()||!this.pollContent()){runInOp(this.cm,function(){return regChange(this$1.cm)})}};ContentEditableInput.prototype.setUneditable=function(node){node.contentEditable="false"};ContentEditableInput.prototype.onKeyPress=function(e){if(e.charCode==0){return}e.preventDefault();if(!this.cm.isReadOnly()){operation(this.cm,applyTextInput)(this.cm,String.fromCharCode(e.charCode==null?e.keyCode:e.charCode),0)}};ContentEditableInput.prototype.readOnlyChanged=function(val){this.div.contentEditable=String(val!="nocursor")};ContentEditableInput.prototype.onContextMenu=function(){};ContentEditableInput.prototype.resetPosition=function(){};ContentEditableInput.prototype.needsContentAttribute=true;function posToDOM(cm,pos){var view=findViewForLine(cm,pos.line);if(!view||view.hidden){return null}var line=getLine(cm.doc,pos.line);var info=mapFromLineView(view,line,pos.line);var order=getOrder(line,cm.doc.direction),side="left";if(order){var partPos=getBidiPartAt(order,pos.ch);side=partPos%2?"right":"left"}var result=nodeAndOffsetInLineMap(info.map,pos.ch,side);result.offset=result.collapse=="right"?result.end:result.start;return result}function isInGutter(node){for(var scan=node;scan;scan=scan.parentNode){if(/CodeMirror-gutter-wrapper/.test(scan.className)){return true}}return false}function badPos(pos,bad){if(bad){pos.bad=true}return pos}function domTextBetween(cm,from,to,fromLine,toLine){var text="",closing=false,lineSep=cm.doc.lineSeparator();function recognizeMarker(id){return function(marker){return marker.id==id}}function close(){if(closing){text+=lineSep;closing=false}}function addText(str){if(str){close();text+=str}}function walk(node){if(node.nodeType==1){var cmText=node.getAttribute("cm-text");if(cmText!=null){addText(cmText||node.textContent.replace(/\u200b/g,""));return}var markerID=node.getAttribute("cm-marker"),range$$1;if(markerID){var found=cm.findMarks(Pos(fromLine,0),Pos(toLine+1,0),recognizeMarker(+markerID));if(found.length&&(range$$1=found[0].find(0))){addText(getBetween(cm.doc,range$$1.from,range$$1.to).join(lineSep))}return}if(node.getAttribute("contenteditable")=="false"){return}var isBlock=/^(pre|div|p)$/i.test(node.nodeName);if(isBlock){close()}for(var i=0;i<node.childNodes.length;i++){walk(node.childNodes[i])}if(isBlock){closing=true}}else if(node.nodeType==3){addText(node.nodeValue)}}for(;;){walk(from);if(from==to){break}from=from.nextSibling}return text}function domToPos(cm,node,offset){var lineNode;if(node==cm.display.lineDiv){lineNode=cm.display.lineDiv.childNodes[offset];if(!lineNode){return badPos(cm.clipPos(Pos(cm.display.viewTo-1)),true)}node=null;offset=0}else{for(lineNode=node;;lineNode=lineNode.parentNode){if(!lineNode||lineNode==cm.display.lineDiv){return null}if(lineNode.parentNode&&lineNode.parentNode==cm.display.lineDiv){break}}}for(var i=0;i<cm.display.view.length;i++){var lineView=cm.display.view[i];if(lineView.node==lineNode){return locateNodeInLineView(lineView,node,offset)}}}function locateNodeInLineView(lineView,node,offset){var wrapper=lineView.text.firstChild,bad=false;if(!node||!contains(wrapper,node)){return badPos(Pos(lineNo(lineView.line),0),true)}if(node==wrapper){bad=true;node=wrapper.childNodes[offset];offset=0;if(!node){var line=lineView.rest?lst(lineView.rest):lineView.line;return badPos(Pos(lineNo(line),line.text.length),bad)}}var textNode=node.nodeType==3?node:null,topNode=node;if(!textNode&&node.childNodes.length==1&&node.firstChild.nodeType==3){textNode=node.firstChild;if(offset){offset=textNode.nodeValue.length}}while(topNode.parentNode!=wrapper){topNode=topNode.parentNode}var measure=lineView.measure,maps=measure.maps;function find(textNode,topNode,offset){for(var i=-1;i<(maps?maps.length:0);i++){var map$$1=i<0?measure.map:maps[i];for(var j=0;j<map$$1.length;j+=3){var curNode=map$$1[j+2];if(curNode==textNode||curNode==topNode){var line=lineNo(i<0?lineView.line:lineView.rest[i]);var ch=map$$1[j]+offset;if(offset<0||curNode!=textNode){ch=map$$1[j+(offset?1:0)]}return Pos(line,ch)}}}}var found=find(textNode,topNode,offset);if(found){return badPos(found,bad)}for(var after=topNode.nextSibling,dist=textNode?textNode.nodeValue.length-offset:0;after;after=after.nextSibling){found=find(after,after.firstChild,0);if(found){return badPos(Pos(found.line,found.ch-dist),bad)}else{dist+=after.textContent.length}}for(var before=topNode.previousSibling,dist$1=offset;before;before=before.previousSibling){found=find(before,before.firstChild,-1);if(found){return badPos(Pos(found.line,found.ch+dist$1),bad)}else{dist$1+=before.textContent.length}}}var TextareaInput=function(cm){this.cm=cm;this.prevInput="";this.pollingFast=false;this.polling=new Delayed;this.hasSelection=false;this.composing=null};TextareaInput.prototype.init=function(display){var this$1=this;var input=this,cm=this.cm;var div=this.wrapper=hiddenTextarea();var te=this.textarea=div.firstChild;display.wrapper.insertBefore(div,display.wrapper.firstChild);if(ios){te.style.width="0px"}on(te,"input",function(){if(ie&&ie_version>=9&&this$1.hasSelection){this$1.hasSelection=null}input.poll()});on(te,"paste",function(e){if(signalDOMEvent(cm,e)||handlePaste(e,cm)){return}cm.state.pasteIncoming=true;input.fastPoll()});function prepareCopyCut(e){if(signalDOMEvent(cm,e)){return}if(cm.somethingSelected()){setLastCopied({lineWise:false,text:cm.getSelections()})}else if(!cm.options.lineWiseCopyCut){return}else{var ranges=copyableRanges(cm);setLastCopied({lineWise:true,text:ranges.text});if(e.type=="cut"){cm.setSelections(ranges.ranges,null,sel_dontScroll)}else{input.prevInput="";te.value=ranges.text.join("\n");selectInput(te)}}if(e.type=="cut"){cm.state.cutIncoming=true}}on(te,"cut",prepareCopyCut);on(te,"copy",prepareCopyCut);on(display.scroller,"paste",function(e){if(eventInWidget(display,e)||signalDOMEvent(cm,e)){return}cm.state.pasteIncoming=true;input.focus()});on(display.lineSpace,"selectstart",function(e){if(!eventInWidget(display,e)){e_preventDefault(e)}});on(te,"compositionstart",function(){var start=cm.getCursor("from");if(input.composing){input.composing.range.clear()}input.composing={start:start,range:cm.markText(start,cm.getCursor("to"),{className:"CodeMirror-composing"})}});on(te,"compositionend",function(){if(input.composing){input.poll();input.composing.range.clear();input.composing=null}})};TextareaInput.prototype.prepareSelection=function(){var cm=this.cm,display=cm.display,doc=cm.doc;var result=prepareSelection(cm);if(cm.options.moveInputWithCursor){var headPos=cursorCoords(cm,doc.sel.primary().head,"div");var wrapOff=display.wrapper.getBoundingClientRect(),lineOff=display.lineDiv.getBoundingClientRect();result.teTop=Math.max(0,Math.min(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top));result.teLeft=Math.max(0,Math.min(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left))}return result};TextareaInput.prototype.showSelection=function(drawn){var cm=this.cm,display=cm.display;removeChildrenAndAdd(display.cursorDiv,drawn.cursors);removeChildrenAndAdd(display.selectionDiv,drawn.selection);if(drawn.teTop!=null){this.wrapper.style.top=drawn.teTop+"px";this.wrapper.style.left=drawn.teLeft+"px"}};TextareaInput.prototype.reset=function(typing){if(this.contextMenuPending||this.composing){return}var cm=this.cm;if(cm.somethingSelected()){this.prevInput="";var content=cm.getSelection();this.textarea.value=content;if(cm.state.focused){selectInput(this.textarea)}if(ie&&ie_version>=9){this.hasSelection=content}}else if(!typing){this.prevInput=this.textarea.value="";if(ie&&ie_version>=9){this.hasSelection=null}}};TextareaInput.prototype.getField=function(){return this.textarea};TextareaInput.prototype.supportsTouch=function(){return false};TextareaInput.prototype.focus=function(){if(this.cm.options.readOnly!="nocursor"&&(!mobile||activeElt()!=this.textarea)){try{this.textarea.focus()}catch(e){}}};TextareaInput.prototype.blur=function(){this.textarea.blur()};TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};TextareaInput.prototype.receivedFocus=function(){this.slowPoll()};TextareaInput.prototype.slowPoll=function(){var this$1=this;if(this.pollingFast){return}this.polling.set(this.cm.options.pollInterval,function(){this$1.poll();if(this$1.cm.state.focused){this$1.slowPoll()}})};TextareaInput.prototype.fastPoll=function(){var missed=false,input=this;input.pollingFast=true;function p(){var changed=input.poll();if(!changed&&!missed){missed=true;input.polling.set(60,p)}else{input.pollingFast=false;input.slowPoll()}}input.polling.set(20,p)};TextareaInput.prototype.poll=function(){var this$1=this;var cm=this.cm,input=this.textarea,prevInput=this.prevInput;if(this.contextMenuPending||!cm.state.focused||hasSelection(input)&&!prevInput&&!this.composing||cm.isReadOnly()||cm.options.disableInput||cm.state.keySeq){return false}var text=input.value;if(text==prevInput&&!cm.somethingSelected()){return false}if(ie&&ie_version>=9&&this.hasSelection===text||mac&&/[\uf700-\uf7ff]/.test(text)){cm.display.input.reset();return false}if(cm.doc.sel==cm.display.selForContextMenu){var first=text.charCodeAt(0);if(first==8203&&!prevInput){prevInput="​"}if(first==8666){this.reset();return this.cm.execCommand("undo")}}var same=0,l=Math.min(prevInput.length,text.length);while(same<l&&prevInput.charCodeAt(same)==text.charCodeAt(same)){++same}runInOp(cm,function(){applyTextInput(cm,text.slice(same),prevInput.length-same,null,this$1.composing?"*compose":null);if(text.length>1e3||text.indexOf("\n")>-1){input.value=this$1.prevInput=""}else{this$1.prevInput=text}if(this$1.composing){this$1.composing.range.clear();this$1.composing.range=cm.markText(this$1.composing.start,cm.getCursor("to"),{className:"CodeMirror-composing"})}});return true};TextareaInput.prototype.ensurePolled=function(){if(this.pollingFast&&this.poll()){this.pollingFast=false}};TextareaInput.prototype.onKeyPress=function(){if(ie&&ie_version>=9){this.hasSelection=null}this.fastPoll()};TextareaInput.prototype.onContextMenu=function(e){var input=this,cm=input.cm,display=cm.display,te=input.textarea;var pos=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop;if(!pos||presto){return}var reset=cm.options.resetSelectionOnContextMenu;if(reset&&cm.doc.sel.contains(pos)==-1){operation(cm,setSelection)(cm.doc,simpleSelection(pos),sel_dontScroll)}var oldCSS=te.style.cssText,oldWrapperCSS=input.wrapper.style.cssText;input.wrapper.style.cssText="position: absolute";var wrapperBox=input.wrapper.getBoundingClientRect();te.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-wrapperBox.top-5)+"px; left: "+(e.clientX-wrapperBox.left-5)+"px;\n      z-index: 1000; background: "+(ie?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var oldScrollY;if(webkit){oldScrollY=window.scrollY}display.input.focus();if(webkit){window.scrollTo(null,oldScrollY)}display.input.reset();if(!cm.somethingSelected()){te.value=input.prevInput=" "}input.contextMenuPending=true;display.selForContextMenu=cm.doc.sel;clearTimeout(display.detectingSelectAll);function prepareSelectAllHack(){if(te.selectionStart!=null){var selected=cm.somethingSelected();var extval="​"+(selected?te.value:"");te.value="⇚";te.value=extval;input.prevInput=selected?"":"​";te.selectionStart=1;te.selectionEnd=extval.length;display.selForContextMenu=cm.doc.sel}}function rehide(){input.contextMenuPending=false;input.wrapper.style.cssText=oldWrapperCSS;te.style.cssText=oldCSS;if(ie&&ie_version<9){display.scrollbars.setScrollTop(display.scroller.scrollTop=scrollPos)}if(te.selectionStart!=null){if(!ie||ie&&ie_version<9){prepareSelectAllHack()}var i=0,poll=function(){if(display.selForContextMenu==cm.doc.sel&&te.selectionStart==0&&te.selectionEnd>0&&input.prevInput=="​"){operation(cm,selectAll)(cm)}else if(i++<10){display.detectingSelectAll=setTimeout(poll,500)}else{display.selForContextMenu=null;display.input.reset()}};display.detectingSelectAll=setTimeout(poll,200)}}if(ie&&ie_version>=9){prepareSelectAllHack()}if(captureRightClick){e_stop(e);var mouseup=function(){off(window,"mouseup",mouseup);setTimeout(rehide,20)};on(window,"mouseup",mouseup)}else{setTimeout(rehide,50)}};TextareaInput.prototype.readOnlyChanged=function(val){if(!val){this.reset()}this.textarea.disabled=val=="nocursor"};TextareaInput.prototype.setUneditable=function(){};TextareaInput.prototype.needsContentAttribute=false;function fromTextArea(textarea,options){options=options?copyObj(options):{};options.value=textarea.value;if(!options.tabindex&&textarea.tabIndex){options.tabindex=textarea.tabIndex}if(!options.placeholder&&textarea.placeholder){options.placeholder=textarea.placeholder}if(options.autofocus==null){var hasFocus=activeElt();options.autofocus=hasFocus==textarea||textarea.getAttribute("autofocus")!=null&&hasFocus==document.body}function save(){textarea.value=cm.getValue()}var realSubmit;if(textarea.form){on(textarea.form,"submit",save);if(!options.leaveSubmitMethodAlone){var form=textarea.form;realSubmit=form.submit;try{var wrappedSubmit=form.submit=function(){save();form.submit=realSubmit;form.submit();form.submit=wrappedSubmit}}catch(e){}}}options.finishInit=function(cm){cm.save=save;cm.getTextArea=function(){return textarea};cm.toTextArea=function(){cm.toTextArea=isNaN;save();textarea.parentNode.removeChild(cm.getWrapperElement());textarea.style.display="";if(textarea.form){off(textarea.form,"submit",save);if(typeof textarea.form.submit=="function"){textarea.form.submit=realSubmit}}}};textarea.style.display="none";var cm=CodeMirror$1(function(node){return textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return cm}function addLegacyProps(CodeMirror){CodeMirror.off=off;CodeMirror.on=on;CodeMirror.wheelEventPixels=wheelEventPixels;CodeMirror.Doc=Doc;CodeMirror.splitLines=splitLinesAuto;CodeMirror.countColumn=countColumn;CodeMirror.findColumn=findColumn;CodeMirror.isWordChar=isWordCharBasic;CodeMirror.Pass=Pass;CodeMirror.signal=signal;CodeMirror.Line=Line;CodeMirror.changeEnd=changeEnd;CodeMirror.scrollbarModel=scrollbarModel;CodeMirror.Pos=Pos;CodeMirror.cmpPos=cmp;CodeMirror.modes=modes;CodeMirror.mimeModes=mimeModes;CodeMirror.resolveMode=resolveMode;CodeMirror.getMode=getMode;CodeMirror.modeExtensions=modeExtensions;CodeMirror.extendMode=extendMode;CodeMirror.copyState=copyState;CodeMirror.startState=startState;CodeMirror.innerMode=innerMode;CodeMirror.commands=commands;CodeMirror.keyMap=keyMap;CodeMirror.keyName=keyName;CodeMirror.isModifierKey=isModifierKey;CodeMirror.lookupKey=lookupKey;CodeMirror.normalizeKeyMap=normalizeKeyMap;CodeMirror.StringStream=StringStream;CodeMirror.SharedTextMarker=SharedTextMarker;CodeMirror.TextMarker=TextMarker;CodeMirror.LineWidget=LineWidget;CodeMirror.e_preventDefault=e_preventDefault;CodeMirror.e_stopPropagation=e_stopPropagation;CodeMirror.e_stop=e_stop;CodeMirror.addClass=addClass;CodeMirror.contains=contains;CodeMirror.rmClass=rmClass;CodeMirror.keyNames=keyNames}defineOptions(CodeMirror$1);addEditorMethods(CodeMirror$1);var dontDelegate="iter insert remove copy getEditor constructor".split(" ");for(var prop in Doc.prototype){if(Doc.prototype.hasOwnProperty(prop)&&indexOf(dontDelegate,prop)<0){CodeMirror$1.prototype[prop]=function(method){return function(){return method.apply(this.doc,arguments)}}(Doc.prototype[prop])}}eventMixin(Doc);CodeMirror$1.inputStyles={textarea:TextareaInput,contenteditable:ContentEditableInput};CodeMirror$1.defineMode=function(name){if(!CodeMirror$1.defaults.mode&&name!="null"){CodeMirror$1.defaults.mode=name}defineMode.apply(this,arguments)};CodeMirror$1.defineMIME=defineMIME;CodeMirror$1.defineMode("null",function(){return{token:function(stream){return stream.skipToEnd()}}});CodeMirror$1.defineMIME("text/plain","null");CodeMirror$1.defineExtension=function(name,func){CodeMirror$1.prototype[name]=func};CodeMirror$1.defineDocExtension=function(name,func){Doc.prototype[name]=func};CodeMirror$1.fromTextArea=fromTextArea;addLegacyProps(CodeMirror$1);CodeMirror$1.version="5.29.0";return CodeMirror$1})},function(module,exports,__webpack_require__){"use strict";(function(process){var debugTool=null;if(process.env.NODE_ENV!=="production"){var ReactDebugTool=__webpack_require__(248);debugTool=ReactDebugTool}module.exports={debugTool:debugTool}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var spatial_lookup_1=__webpack_require__(92);var compute_1=__webpack_require__(151);var connected_components_1=__webpack_require__(153);var collection_1=__webpack_require__(93);var upper_case_1=__webpack_require__(59);var constants_1=__webpack_require__(156);function ElementSymbol(symbol){return upper_case_1.default(symbol)}exports.ElementSymbol=ElementSymbol;function VdwRadius(element){var i=constants_1.AtomicNumbers[element];return i===void 0?constants_1.DefaultVdwRadius:constants_1.ElementVdwRadii[i]}exports.VdwRadius=VdwRadius;function AtomWeight(element){var i=constants_1.AtomicNumbers[element];return i===void 0?constants_1.DefaultAtomWeight:constants_1.ElementAtomWeights[i]}exports.AtomWeight=AtomWeight;function AtomNumber(element){var i=constants_1.AtomicNumbers[element];return i===void 0?constants_1.DefaultAtomNumber:i}exports.AtomNumber=AtomNumber;function BondCount(model,atomIndex,checkFlags){var _a=Model.bonds(model),offset=_a.offset,flags=_a.flags;var start=offset[atomIndex];var end=offset[atomIndex+1];if(!checkFlags)return end-start;var count=0;for(var bI=start;bI<end;bI++){if((flags[bI]&checkFlags)!==0)++count}return count}exports.BondCount=BondCount;var ResidueIdentifier;(function(ResidueIdentifier){function auth(chain,seq_num,ins_code){if(ins_code){return chain+" "+seq_num+" "+ins_code}return chain+" "+seq_num}ResidueIdentifier.auth=auth;function label(entity,chain,seq_num,ins_code){if(ins_code){return entity+" "+chain+" "+(seq_num||".")+" "+ins_code}return entity+" "+chain+" "+(seq_num||".")}ResidueIdentifier.label=label;function authOfResidueIndex(model,residueIndex){var row=model.atoms.dataIndex[model.residues.atomOffset[residueIndex]];var atom_site=model.data.atom_site;return auth(atom_site.auth_asym_id.getString(row),atom_site.auth_seq_id.getInteger(row),atom_site.pdbx_PDB_ins_code.getString(row))}ResidueIdentifier.authOfResidueIndex=authOfResidueIndex;function labelOfResidueIndex(model,residueIndex){var row=model.atoms.dataIndex[model.residues.atomOffset[residueIndex]];var atom_site=model.data.atom_site;return label(atom_site.label_entity_id.getString(row),atom_site.label_asym_id.getString(row),atom_site.label_seq_id.getInteger(row),atom_site.pdbx_PDB_ins_code.getString(row))}ResidueIdentifier.labelOfResidueIndex=labelOfResidueIndex})(ResidueIdentifier=exports.ResidueIdentifier||(exports.ResidueIdentifier={}));var Model;(function(Model){function spatialLookup(model){if(model["@spatialLookup"])return model["@spatialLookup"];var lookup=spatial_lookup_1.default(model.positions);model["@spatialLookup"]=lookup;return lookup}Model.spatialLookup=spatialLookup;function bonds(model){if(model["@bonds"])return model["@bonds"];var bonds=compute_1.default(model);model["@bonds"]=bonds;return bonds}Model.bonds=bonds;function rings(model){if(model["@rings"])return model["@rings"];var rings=collection_1.default(model);model["@rings"]=rings;return rings}Model.rings=rings;function connectedComponentKey(model){if(model["@connectedComponentKey"])return model["@connectedComponentKey"];var key=connected_components_1.default(model);model["@connectedComponentKey"]=key;return key}Model.connectedComponentKey=connectedComponentKey;function findResidueIndexByLabel(model,asymId,seqNumber,insCode){var _a=model.chains,residueOffset=_a.residueOffset,cCount=_a.count;var atomOffset=model.residues.atomOffset;var dataIndex=model.atoms.dataIndex;var _b=model.data.atom_site,label_asym_id=_b.label_asym_id,label_seq_id=_b.label_seq_id,pdbx_PDB_ins_code=_b.pdbx_PDB_ins_code;for(var cI=0;cI<cCount;cI++){var idx=dataIndex[atomOffset[residueOffset[cI]]];if(!label_asym_id.stringEquals(idx,asymId))continue;for(var rI=residueOffset[cI],_r=residueOffset[cI+1];rI<_r;rI++){idx=dataIndex[atomOffset[rI]];if(label_seq_id.getInteger(idx)===seqNumber&&(!insCode||pdbx_PDB_ins_code.stringEquals(idx,insCode))){return rI}}}return-1}Model.findResidueIndexByLabel=findResidueIndexByLabel;function findAtomIndexByLabelName(model,residueIndex,atomName,altLoc){var atomOffset=model.residues.atomOffset;var dataIndex=model.atoms.dataIndex;var _a=model.data.atom_site,label_atom_id=_a.label_atom_id,label_alt_id=_a.label_alt_id;for(var i=atomOffset[residueIndex],_i=atomOffset[residueIndex+1];i<=_i;i++){var idx=dataIndex[i];if(label_atom_id.stringEquals(idx,atomName)&&(!altLoc||label_alt_id.stringEquals(idx,altLoc)))return i}return-1}Model.findAtomIndexByLabelName=findAtomIndexByLabelName})(Model=exports.Model||(exports.Model={}));var Bonds;(function(Bonds){function isCovalent(flags){return(flags&1)!==0}Bonds.isCovalent=isCovalent})(Bonds=exports.Bonds||(exports.Bonds={}))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var collections_1=__webpack_require__(8);var mask_1=__webpack_require__(27);function AtomSet(indices){if(typeof indices==="number")return indices;if(indices.length===1)return indices[0];return ArrayAtomSet(indices)}function ArrayAtomSet(indices){return{atomIndices:indices,hashCode:0,hashCodeComputed:false,boundingSphere:void 0}}(function(AtomSet){var IteratorImpl=function(){function IteratorImpl(){this.done=true;this.value=0;this.atomSet=void 0;this.index=-1;this.length=0}IteratorImpl.prototype[Symbol.iterator]=function(){return this};IteratorImpl.prototype.next=function(){var index=++this.index;if(typeof this.atomSet==="number"){this.done=this.index>0}else{if(index>=this.length){this.done=true}else{this.value=this.atomSet.atomIndices[index]}}return this};IteratorImpl.prototype.reset=function(atomSet){if(typeof atomSet==="number"){this.value=atomSet;this.length=1}else{var ind=atomSet.atomIndices;this.value=ind[0];this.length=ind.length}this.done=false;this.atomSet=atomSet;this.index=-1;return this};return IteratorImpl}();function Iterator(){return new IteratorImpl}AtomSet.Iterator=Iterator;(function(Iterator){function start(it,atomSet){return it.reset(atomSet).next().value}Iterator.start=start})(Iterator=AtomSet.Iterator||(AtomSet.Iterator={}));function count(a){return typeof a==="number"?1:a.atomIndices.length}AtomSet.count=count;function toIndices(a){return typeof a==="number"?[a]:a.atomIndices}AtomSet.toIndices=toIndices;function getMask(a){return typeof a==="number"?mask_1.default.singleton(a):mask_1.default.ofUniqueIndices(a.atomIndices)}AtomSet.getMask=getMask;var itA=Iterator(),itB=Iterator();function areEqual(a,b){var cnt=count(a);if(cnt!==count(b))return false;Iterator.start(itA,a);Iterator.start(itB,b);for(var i=0;i<cnt;i++){if(itA.value!==itB.value)return false;itA.next();itB.next()}return true}AtomSet.areEqual=areEqual;function ofUnsortedIndices(indices){return AtomSet(collections_1.sortAsc(indices))}AtomSet.ofUnsortedIndices=ofUnsortedIndices;function atomDistanceSq(x,y,z,i,j){var dx=x[i]-x[j],dy=y[i]-y[j],dz=z[i]-z[j];return dx*dx+dy*dy+dz*dz}AtomSet.atomDistanceSq=atomDistanceSq;function computeHashCode(atomSet){var code=23;for(var _i=0,_a=atomSet.atomIndices;_i<_a.length;_i++){var i=_a[_i];code=31*code+i|0}atomSet.hashCode=code;atomSet.hashCodeComputed=true;return code}function hashCode(atomSet){if(typeof atomSet==="number")return atomSet;if(atomSet.hashCodeComputed)return atomSet.hashCode;return computeHashCode(atomSet)}AtomSet.hashCode=hashCode;function hierarchy(model,atomSet){var residueIndices=collections_1.UniqueArrayBuilder();var chainIndices=collections_1.UniqueArrayBuilder();var entityIndices=collections_1.UniqueArrayBuilder();var rIndices=model.atoms.residueIndex;var cIndices=model.residues.chainIndex;var eIndices=model.chains.entityIndex;var it=Iterator();for(var i=Iterator.start(it,atomSet);!it.done;i=it.next().value){collections_1.UniqueArrayBuilder.add(residueIndices,rIndices[i],rIndices[i])}for(var _i=0,_a=residueIndices.array;_i<_a.length;_i++){var i=_a[_i];collections_1.UniqueArrayBuilder.add(chainIndices,cIndices[i],cIndices[i])}for(var _b=0,_c=chainIndices.array;_b<_c.length;_b++){var i=_c[_b];collections_1.UniqueArrayBuilder.add(entityIndices,eIndices[i],eIndices[i])}return{residueIndices:residueIndices.array,chainIndices:chainIndices.array,entityIndices:entityIndices.array}}AtomSet.hierarchy=hierarchy;function computeBoundingSphere(model,atomSet){var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;if(atomSet.atomIndices.length===1){var i=atomSet.atomIndices[0];atomSet.boundingSphere={center:[x[i],y[i],z[i]],radius:0};return atomSet.boundingSphere}var center=[0,0,0];for(var _i=0,_b=atomSet.atomIndices;_i<_b.length;_i++){var i=_b[_i];center[0]+=x[i];center[1]+=y[i];center[2]+=z[i]}center[0]*=1/atomSet.atomIndices.length;center[1]*=1/atomSet.atomIndices.length;center[2]*=1/atomSet.atomIndices.length;var radius=0;for(var _c=0,_d=atomSet.atomIndices;_c<_d.length;_c++){var i=_d[_c];var dx=center[0]-x[i],dy=center[1]-y[i],dz=center[2]-z[i];radius=Math.max(dx*dx+dy*dy+dz*dz,radius)}atomSet.boundingSphere={center:center,radius:radius};return atomSet.boundingSphere}function boundingSphere(model,atomSet){if(typeof atomSet==="number"){var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;return{center:[x[atomSet],y[atomSet],z[atomSet]],radius:0}}if(atomSet.boundingSphere)return atomSet.boundingSphere;return computeBoundingSphere(model,atomSet)}AtomSet.boundingSphere=boundingSphere;function distance(model,a,b){if(a===b)return 0;var distSq=Number.POSITIVE_INFINITY;var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;for(var i=Iterator.start(itA,a);!itA.done;i=itA.next().value){for(var j=Iterator.start(itB,b);!itB.done;j=itB.next().value){var d=atomDistanceSq(x,y,z,i,j);if(d<distSq)distSq=d}}return Math.sqrt(distSq)}AtomSet.distance=distance;function areWithin(model,a,b,maxDistance){if(a===b)return true;var dSq=maxDistance*maxDistance;var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;for(var i=Iterator.start(itA,a);!itA.done;i=itA.next().value){for(var j=Iterator.start(itB,b);!itB.done;j=itB.next().value){if(atomDistanceSq(x,y,z,i,j)<=dSq)return true}}return false}AtomSet.areWithin=areWithin;function union(a,b){var la=count(a),lb=count(b);var i=0,j=0,resultSize=0;Iterator.start(itA,a);Iterator.start(itB,b);while(i<la&&j<lb){var x=itA.value,y=itB.value;resultSize++;if(x<y){itA.next();i++}else if(x>y){itB.next();j++}else{i++;j++;itA.next();itB.next()}}resultSize+=Math.max(la-i,lb-j);var indices=new Int32Array(resultSize);var offset=0;i=0;j=0;Iterator.start(itA,a);Iterator.start(itB,b);while(i<la&&j<lb){var x=itA.value,y=itB.value;resultSize++;if(x<y){indices[offset++]=x;i++;itA.next()}else if(x>y){indices[offset++]=y;j++;itB.next()}else{indices[offset++]=x;i++;j++;itA.next();itB.next()}}for(;i<la;i++){indices[offset++]=itA.value;itA.next()}for(;j<lb;j++){indices[offset++]=itB.value;itB.next()}return AtomSet(indices)}AtomSet.union=union})(AtomSet||(AtomSet={}));exports.default=AtomSet},function(module,exports,__webpack_require__){"use strict";var ReactCurrentOwner={current:null};module.exports=ReactCurrentOwner},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var CallbackQueue=__webpack_require__(115);var PooledClass=__webpack_require__(23);var ReactFeatureFlags=__webpack_require__(116);var ReactReconciler=__webpack_require__(31);var Transaction=__webpack_require__(50);var invariant=__webpack_require__(1);var dirtyComponents=[];var updateBatchNumber=0;var asapCallbackQueue=CallbackQueue.getPooled();var asapEnqueued=false;var batchingStrategy=null;function ensureInjected(){!(ReactUpdates.ReactReconcileTransaction&&batchingStrategy)?process.env.NODE_ENV!=="production"?invariant(false,"ReactUpdates: must inject a reconcile transaction class and batching strategy"):_prodInvariant("123"):void 0}var NESTED_UPDATES={initialize:function(){this.dirtyComponentsLength=dirtyComponents.length},close:function(){if(this.dirtyComponentsLength!==dirtyComponents.length){dirtyComponents.splice(0,this.dirtyComponentsLength);flushBatchedUpdates()}else{dirtyComponents.length=0}}};var UPDATE_QUEUEING={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}};var TRANSACTION_WRAPPERS=[NESTED_UPDATES,UPDATE_QUEUEING];function ReactUpdatesFlushTransaction(){this.reinitializeTransaction();this.dirtyComponentsLength=null;this.callbackQueue=CallbackQueue.getPooled();this.reconcileTransaction=ReactUpdates.ReactReconcileTransaction.getPooled(true)}_assign(ReactUpdatesFlushTransaction.prototype,Transaction,{getTransactionWrappers:function(){return TRANSACTION_WRAPPERS},destructor:function(){this.dirtyComponentsLength=null;CallbackQueue.release(this.callbackQueue);this.callbackQueue=null;ReactUpdates.ReactReconcileTransaction.release(this.reconcileTransaction);this.reconcileTransaction=null},perform:function(method,scope,a){return Transaction.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,method,scope,a)}});PooledClass.addPoolingTo(ReactUpdatesFlushTransaction);function batchedUpdates(callback,a,b,c,d,e){ensureInjected();return batchingStrategy.batchedUpdates(callback,a,b,c,d,e)}function mountOrderComparator(c1,c2){return c1._mountOrder-c2._mountOrder}function runBatchedUpdates(transaction){var len=transaction.dirtyComponentsLength;!(len===dirtyComponents.length)?process.env.NODE_ENV!=="production"?invariant(false,"Expected flush transaction's stored dirty-components length (%s) to match dirty-components array length (%s).",len,dirtyComponents.length):_prodInvariant("124",len,dirtyComponents.length):void 0;dirtyComponents.sort(mountOrderComparator);updateBatchNumber++;for(var i=0;i<len;i++){var component=dirtyComponents[i];var callbacks=component._pendingCallbacks;component._pendingCallbacks=null;var markerName;if(ReactFeatureFlags.logTopLevelRenders){var namedComponent=component;if(component._currentElement.type.isReactTopLevelWrapper){namedComponent=component._renderedComponent}markerName="React update: "+namedComponent.getName();console.time(markerName)}ReactReconciler.performUpdateIfNecessary(component,transaction.reconcileTransaction,updateBatchNumber);if(markerName){console.timeEnd(markerName)}if(callbacks){for(var j=0;j<callbacks.length;j++){transaction.callbackQueue.enqueue(callbacks[j],component.getPublicInstance())}}}}var flushBatchedUpdates=function(){while(dirtyComponents.length||asapEnqueued){if(dirtyComponents.length){var transaction=ReactUpdatesFlushTransaction.getPooled();transaction.perform(runBatchedUpdates,null,transaction);ReactUpdatesFlushTransaction.release(transaction)}if(asapEnqueued){asapEnqueued=false;var queue=asapCallbackQueue;asapCallbackQueue=CallbackQueue.getPooled();queue.notifyAll();CallbackQueue.release(queue)}}};function enqueueUpdate(component){ensureInjected();if(!batchingStrategy.isBatchingUpdates){batchingStrategy.batchedUpdates(enqueueUpdate,component);return}dirtyComponents.push(component);if(component._updateBatchNumber==null){component._updateBatchNumber=updateBatchNumber+1}}function asap(callback,context){!batchingStrategy.isBatchingUpdates?process.env.NODE_ENV!=="production"?invariant(false,"ReactUpdates.asap: Can't enqueue an asap callback in a context whereupdates are not being batched."):_prodInvariant("125"):void 0;asapCallbackQueue.enqueue(callback,context);asapEnqueued=true}var ReactUpdatesInjection={injectReconcileTransaction:function(ReconcileTransaction){!ReconcileTransaction?process.env.NODE_ENV!=="production"?invariant(false,"ReactUpdates: must provide a reconcile transaction class"):_prodInvariant("126"):void 0;ReactUpdates.ReactReconcileTransaction=ReconcileTransaction},injectBatchingStrategy:function(_batchingStrategy){!_batchingStrategy?process.env.NODE_ENV!=="production"?invariant(false,"ReactUpdates: must provide a batching strategy"):_prodInvariant("127"):void 0;!(typeof _batchingStrategy.batchedUpdates==="function")?process.env.NODE_ENV!=="production"?invariant(false,"ReactUpdates: must provide a batchedUpdates() function"):_prodInvariant("128"):void 0;!(typeof _batchingStrategy.isBatchingUpdates==="boolean")?process.env.NODE_ENV!=="production"?invariant(false,"ReactUpdates: must provide an isBatchingUpdates boolean attribute"):_prodInvariant("129"):void 0;batchingStrategy=_batchingStrategy}};var ReactUpdates={ReactReconcileTransaction:null,batchedUpdates:batchedUpdates,enqueueUpdate:enqueueUpdate,flushBatchedUpdates:flushBatchedUpdates,injection:ReactUpdatesInjection,asap:asap};module.exports=ReactUpdates}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var builder_1=__webpack_require__(6);function escapeRegExp(s){return String(s).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}exports.escapeRegExp=escapeRegExp;function prefix(opParser,nextParser,mapFn){var parser=P.lazy(function(){return P.seq(opParser,parser).map(function(x){return mapFn.apply(void 0,x)}).or(nextParser)});return parser}exports.prefix=prefix;function postfix(opParser,nextParser,mapFn){return P.seqMap(nextParser,opParser.many(),function(x,suffixes){return suffixes.reduce(function(acc,x){return mapFn(x,acc)},x)})}exports.postfix=postfix;function binaryRight(opParser,nextParser,mapFn){var parser=P.lazy(function(){return nextParser.chain(function(next){return P.seq(opParser,P.of(next),parser).map(function(x){console.log(x);return x}).or(P.of(next))})});return parser}exports.binaryRight=binaryRight;function binaryLeft(opParser,nextParser,mapFn){return P.seqMap(nextParser,P.seq(opParser,nextParser).many(),function(first,rest){return rest.reduce(function(acc,ch){var op=ch[0],another=ch[1];return mapFn(op,acc,another)},first)})}exports.binaryLeft=binaryLeft;function combineOperators(opList,rule){var x=opList.reduce(function(acc,level){var map=level.isUnsupported?makeError("operator '"+level.name+"' not supported"):level.map;return level.type(level.rule,acc,map)},rule);return x}exports.combineOperators=combineOperators;function infixOp(re,group){if(group===void 0){group=0}return P.whitespace.then(P.regex(re,group).skip(P.whitespace))}exports.infixOp=infixOp;function prefixOp(re,group){if(group===void 0){group=0}return P.regex(re,group).skip(P.whitespace)}exports.prefixOp=prefixOp;function postfixOp(re,group){if(group===void 0){group=0}return P.whitespace.then(P.regex(re,group))}exports.postfixOp=postfixOp;function ofOp(name,short){var op=short?name+"|"+escapeRegExp(short):name;var re=RegExp("("+op+")\\s+([-+]?[0-9]*\\.?[0-9]+)\\s+OF","i");return infixOp(re,2).map(parseFloat)}exports.ofOp=ofOp;function makeError(msg){return function(){throw new Error(msg)}}exports.makeError=makeError;function andExpr(selections){if(selections.length===1){return selections[0]}else if(selections.length>1){return builder_1.default.core.logic.and(selections)}else{return undefined}}exports.andExpr=andExpr;function orExpr(selections){if(selections.length===1){return selections[0]}else if(selections.length>1){return builder_1.default.core.logic.or(selections)}else{return undefined}}exports.orExpr=orExpr;function testExpr(property,args){if(args&&args.op!==undefined&&args.val!==undefined){var opArgs=[property,args.val];switch(args.op){case"=":return builder_1.default.core.rel.eq(opArgs);case"!=":return builder_1.default.core.rel.neq(opArgs);case">":return builder_1.default.core.rel.gr(opArgs);case"<":return builder_1.default.core.rel.lt(opArgs);case">=":return builder_1.default.core.rel.gre(opArgs);case"<=":return builder_1.default.core.rel.lte(opArgs);default:throw new Error("operator '"+args.op+"' not supported")}}else if(args&&args.flags!==undefined){return builder_1.default.core.flags.hasAny([property,args.flags])}else if(args&&args.min!==undefined&&args.max!==undefined){return builder_1.default.core.rel.inRange([property,args.min,args.max])}else if(!Array.isArray(args)){return builder_1.default.core.rel.eq([property,args])}else if(args.length>1){return builder_1.default.core.set.has([builder_1.default.core.type.set(args),property])}else{return builder_1.default.core.rel.eq([property,args[0]])}}exports.testExpr=testExpr;function invertExpr(selection){return builder_1.default.struct.generator.queryInSelection({0:selection,query:builder_1.default.struct.generator.atomGroups(),"in-complement":true})}exports.invertExpr=invertExpr;function strLenSortFn(a,b){return a.length<b.length?1:-1}exports.strLenSortFn=strLenSortFn;function getNamesRegex(name,abbr){var names=(abbr?[name].concat(abbr):[name]).sort(strLenSortFn).map(escapeRegExp).join("|");return RegExp(""+names,"i")}function getPropertyRules(properties){var propertiesDict={};Object.keys(properties).sort(strLenSortFn).forEach(function(name){var ps=properties[name];var errorFn=makeError("property '"+name+"' not supported");var rule=P.regex(ps.regex).map(function(x){if(ps.isUnsupported)errorFn();return testExpr(ps.property,ps.map(x))});if(!ps.isNumeric){propertiesDict[name]=rule}});return propertiesDict}exports.getPropertyRules=getPropertyRules;function getNamedPropertyRules(properties){var namedPropertiesList=[];Object.keys(properties).sort(strLenSortFn).forEach(function(name){var ps=properties[name];var errorFn=makeError("property '"+name+"' not supported");var rule=P.regex(ps.regex).map(function(x){if(ps.isUnsupported)errorFn();return testExpr(ps.property,ps.map(x))});var nameRule=P.regex(getNamesRegex(name,ps.abbr)).trim(P.optWhitespace);var groupMap=function(x){return builder_1.default.struct.generator.atomGroups((_a={},_a[ps.level]=x,_a));var _a};if(ps.isNumeric){namedPropertiesList.push(nameRule.then(P.seq(P.regex(/>=|<=|=|!=|>|</).trim(P.optWhitespace),P.regex(ps.regex).map(ps.map))).map(function(x){if(ps.isUnsupported)errorFn();return testExpr(ps.property,{op:x[0],val:x[1]})}).map(groupMap))}else{namedPropertiesList.push(nameRule.then(rule).map(groupMap))}});return namedPropertiesList}exports.getNamedPropertyRules=getNamedPropertyRules;function getKeywordRules(keywords){var keywordsList=[];Object.keys(keywords).sort(strLenSortFn).forEach(function(name){var ks=keywords[name];var mapFn=ks.map?ks.map:makeError("keyword '"+name+"' not supported");var rule=P.regex(getNamesRegex(name,ks.abbr)).map(mapFn);keywordsList.push(rule)});return keywordsList}exports.getKeywordRules=getKeywordRules;function getFunctionRules(functions,argRule){var functionsList=[];var begRule=P.regex(/\(\s*/);var endRule=P.regex(/\s*\)/);Object.keys(functions).sort(strLenSortFn).forEach(function(name){var fs=functions[name];var mapFn=fs.map?fs.map:makeError("function '"+name+"' not supported");var rule=P.regex(new RegExp(name,"i")).skip(begRule).then(argRule).skip(endRule).map(mapFn);functionsList.push(rule)});return functionsList}exports.getFunctionRules=getFunctionRules;function getPropertyNameRules(properties,lookahead){var list=[];Object.keys(properties).sort(strLenSortFn).forEach(function(name){var ps=properties[name];var errorFn=makeError("property '"+name+"' not supported");var rule=P.regex(getNamesRegex(name,ps.abbr)).lookahead(lookahead).map(function(){if(ps.isUnsupported)errorFn();return ps.property});list.push(rule)});return list}exports.getPropertyNameRules=getPropertyNameRules;function getReservedWords(properties,keywords,operators,functions){var w=[];for(var name_1 in properties){w.push(name_1);if(properties[name_1].abbr)w.push.apply(w,properties[name_1].abbr)}for(var name_2 in keywords){w.push(name_2);if(keywords[name_2].abbr)w.push.apply(w,keywords[name_2].abbr)}operators.forEach(function(o){w.push(o.name);if(o.abbr)w.push.apply(w,o.abbr)});return w}exports.getReservedWords=getReservedWords;function atomNameSet(ids){return builder_1.default.core.type.set(ids.map(builder_1.default.atomName))}exports.atomNameSet=atomNameSet;function asAtoms(e){return builder_1.default.struct.generator.queryInSelection({0:e,query:builder_1.default.struct.generator.atomGroups()})}exports.asAtoms=asAtoms;function wrapValue(property,value,sstrucDict){switch(property.head){case"structure.atom-property.macromolecular.label_atom_id":return builder_1.default.atomName(value);case"structure.atom-property.core.element-symbol":return builder_1.default.es(value);case"structure.atom-property.macromolecular.secondary-structure-flags":if(sstrucDict){value=[sstrucDict[value.toUpperCase()]||"none"]}return builder_1.default.struct.type.secondaryStructureFlags([value]);default:return value}}exports.wrapValue=wrapValue;var propPrefix="structure.atom-property.macromolecular.";var entityProps=["entityKey","label_entity_id","entityType"];var chainProps=["chainKey","label_asym_id","label_entity_id","auth_asym_id","entityType"];var residueProps=["residueKey","label_comp_id","label_seq_id","auth_comp_id","auth_seq_id","pdbx_formal_charge","secondaryStructureKey","secondaryStructureFlags","isModified","modifiedParentName"];function testLevel(property){if(property.head.startsWith(propPrefix)){var name_3=property.head.substr(propPrefix.length);if(entityProps.indexOf(name_3)!==-1)return"entity-test";if(chainProps.indexOf(name_3)!==-1)return"chain-test";if(residueProps.indexOf(name_3)!==-1)return"residue-test"}return"atom-test"}exports.testLevel=testLevel;var flagProps=["structure.atom-property.macromolecular.secondary-structure-flags"];function valuesTest(property,values){if(flagProps.indexOf(property.head)!==-1){var name_4=values[0].head;var flags_1=[];values.forEach(function(v){return flags_1.push.apply(flags_1,v.args[0])});return builder_1.default.core.flags.hasAny([property,{head:name_4,args:flags_1}])}else{if(values.length===1){return builder_1.default.core.rel.eq([property,values[0]])}else if(values.length>1){return builder_1.default.core.set.has([builder_1.default.core.type.set(values),property])}}}exports.valuesTest=valuesTest;function resnameExpr(resnameList){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.core.type.set(resnameList),builder_1.default.ammp("label_comp_id")])})}exports.resnameExpr=resnameExpr},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var PooledClass=__webpack_require__(23);var emptyFunction=__webpack_require__(10);var warning=__webpack_require__(2);var didWarnForAddedNewProperty=false;var isProxySupported=typeof Proxy==="function";var shouldBeReleasedProperties=["dispatchConfig","_targetInst","nativeEvent","isDefaultPrevented","isPropagationStopped","_dispatchListeners","_dispatchInstances"];var EventInterface={type:null,target:null,currentTarget:emptyFunction.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(event){return event.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};function SyntheticEvent(dispatchConfig,targetInst,nativeEvent,nativeEventTarget){if(process.env.NODE_ENV!=="production"){delete this.nativeEvent;delete this.preventDefault;delete this.stopPropagation}this.dispatchConfig=dispatchConfig;this._targetInst=targetInst;this.nativeEvent=nativeEvent;var Interface=this.constructor.Interface;for(var propName in Interface){if(!Interface.hasOwnProperty(propName)){continue}if(process.env.NODE_ENV!=="production"){delete this[propName]}var normalize=Interface[propName];if(normalize){this[propName]=normalize(nativeEvent)}else{if(propName==="target"){this.target=nativeEventTarget}else{this[propName]=nativeEvent[propName]}}}var defaultPrevented=nativeEvent.defaultPrevented!=null?nativeEvent.defaultPrevented:nativeEvent.returnValue===false;if(defaultPrevented){this.isDefaultPrevented=emptyFunction.thatReturnsTrue}else{this.isDefaultPrevented=emptyFunction.thatReturnsFalse}this.isPropagationStopped=emptyFunction.thatReturnsFalse;return this}_assign(SyntheticEvent.prototype,{preventDefault:function(){this.defaultPrevented=true;var event=this.nativeEvent;if(!event){return}if(event.preventDefault){event.preventDefault()}else if(typeof event.returnValue!=="unknown"){event.returnValue=false}this.isDefaultPrevented=emptyFunction.thatReturnsTrue},stopPropagation:function(){var event=this.nativeEvent;if(!event){return}if(event.stopPropagation){event.stopPropagation()}else if(typeof event.cancelBubble!=="unknown"){event.cancelBubble=true}this.isPropagationStopped=emptyFunction.thatReturnsTrue},persist:function(){this.isPersistent=emptyFunction.thatReturnsTrue},isPersistent:emptyFunction.thatReturnsFalse,destructor:function(){var Interface=this.constructor.Interface;for(var propName in Interface){if(process.env.NODE_ENV!=="production"){Object.defineProperty(this,propName,getPooledWarningPropertyDefinition(propName,Interface[propName]))}else{this[propName]=null}}for(var i=0;i<shouldBeReleasedProperties.length;i++){this[shouldBeReleasedProperties[i]]=null}if(process.env.NODE_ENV!=="production"){Object.defineProperty(this,"nativeEvent",getPooledWarningPropertyDefinition("nativeEvent",null));Object.defineProperty(this,"preventDefault",getPooledWarningPropertyDefinition("preventDefault",emptyFunction));Object.defineProperty(this,"stopPropagation",getPooledWarningPropertyDefinition("stopPropagation",emptyFunction))}}});SyntheticEvent.Interface=EventInterface;if(process.env.NODE_ENV!=="production"){if(isProxySupported){SyntheticEvent=new Proxy(SyntheticEvent,{construct:function(target,args){return this.apply(target,Object.create(target.prototype),args)},apply:function(constructor,that,args){return new Proxy(constructor.apply(that,args),{set:function(target,prop,value){if(prop!=="isPersistent"&&!target.constructor.Interface.hasOwnProperty(prop)&&shouldBeReleasedProperties.indexOf(prop)===-1){process.env.NODE_ENV!=="production"?warning(didWarnForAddedNewProperty||target.isPersistent(),"This synthetic event is reused for performance reasons. If you're "+"seeing this, you're adding a new property in the synthetic event object. "+"The property is never released. See "+"https://fb.me/react-event-pooling for more information."):void 0;didWarnForAddedNewProperty=true}target[prop]=value;return true}})}})}}SyntheticEvent.augmentClass=function(Class,Interface){var Super=this;var E=function(){};E.prototype=Super.prototype;var prototype=new E;_assign(prototype,Class.prototype);Class.prototype=prototype;Class.prototype.constructor=Class;Class.Interface=_assign({},Super.Interface,Interface);Class.augmentClass=Super.augmentClass;PooledClass.addPoolingTo(Class,PooledClass.fourArgumentPooler)};PooledClass.addPoolingTo(SyntheticEvent,PooledClass.fourArgumentPooler);module.exports=SyntheticEvent;function getPooledWarningPropertyDefinition(propName,getVal){var isFunction=typeof getVal==="function";return{configurable:true,set:set,get:get};function set(val){var action=isFunction?"setting the method":"setting the property";warn(action,"This is effectively a no-op");return val}function get(){var action=isFunction?"accessing the method":"accessing the property";var result=isFunction?"This is a no-op function":"This is set to null";warn(action,result);return getVal}function warn(action,result){var warningCondition=false;process.env.NODE_ENV!=="production"?warning(warningCondition,"This synthetic event is reused for performance reasons. If you're seeing this, "+"you're %s `%s` on a released/nullified synthetic event. %s. "+"If you must keep the original synthetic event around, use event.persist(). "+"See https://fb.me/react-event-pooling for more information.",action,propName,result):void 0}}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var collections_1=__webpack_require__(8);var mask_1=__webpack_require__(27);var spatial_lookup_1=__webpack_require__(92);var atom_set_1=__webpack_require__(14);var AtomSetIt=atom_set_1.default.Iterator;function AtomSelection(atomSets){return AtomSelectionImpl(atomSets)}function AtomSelectionImpl(atomSets){return{atomSets:atomSets}}(function(AtomSelection){AtomSelection.empty=AtomSelection([]);function atomSets(selection){return selection.atomSets}AtomSelection.atomSets=atomSets;function getAtomIndices(seq){var sets=atomSets(seq);var length=sets.length;if(!length)return[];if(length===1)return atom_set_1.default.toIndices(sets[0]);var mask=getMask(seq);var atoms=new Int32Array(mask.size);mask.forEach(function(i,ctx){return ctx.atoms[ctx.offset++]=i},{atoms:atoms,offset:0});return collections_1.sortAsc(atoms)}AtomSelection.getAtomIndices=getAtomIndices;function getMask(seq){var sets=atomSets(seq);if(!sets.length)return mask_1.default.never;if(sets.length===1)return atom_set_1.default.getMask(sets[0]);var it=AtomSetIt();var estSize=0,max=0;for(var _i=0,sets_1=sets;_i<sets_1.length;_i++){var atomSet=sets_1[_i];estSize+=atom_set_1.default.count(atomSet);for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(a>max)max=a}}if(estSize/max>1/12){var mask=new Uint8Array(max+1);var size=0;for(var _a=0,sets_2=sets;_a<sets_2.length;_a++){var atomSet=sets_2[_a];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(mask[a])continue;mask[a]=1;size++}}return mask_1.default.ofMask(mask,size)}else{var mask=collections_1.FastSet.create();for(var _b=0,sets_3=sets;_b<sets_3.length;_b++){var atomSet=sets_3[_b];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){mask.add(a)}}return mask_1.default.ofSet(mask)}}AtomSelection.getMask=getMask;var LinearSelectionBuilder=function(){function LinearSelectionBuilder(){this.atomSets=[]}LinearSelectionBuilder.prototype.add=function(atomSet){this.atomSets.push(atomSet)};LinearSelectionBuilder.prototype.getSelection=function(){return AtomSelection(this.atomSets)};return LinearSelectionBuilder}();var HashSelectionBuilder=function(){function HashSelectionBuilder(){this.atomSets=[];this.selectionSet=new Set}HashSelectionBuilder.prototype.add=function(atomSet){if(this.selectionSet.add(atomSet)){this.atomSets.push(atomSet)}};HashSelectionBuilder.prototype.getSelection=function(){return AtomSelection(this.atomSets)};return HashSelectionBuilder}();function uniqueBuilder(){return new HashSelectionBuilder}AtomSelection.uniqueBuilder=uniqueBuilder;function linearBuilder(){return new LinearSelectionBuilder}AtomSelection.linearBuilder=linearBuilder;var Set=function(){function Set(){this.byHash=collections_1.FastMap.create()}Set.prototype.add=function(atomSet){var hash=atom_set_1.default.hashCode(atomSet);if(this.byHash.has(hash)){var sets=this.byHash.get(hash);for(var _i=0,sets_4=sets;_i<sets_4.length;_i++){var set=sets_4[_i];if(atom_set_1.default.areEqual(atomSet,set))return false}sets[sets.length]=atomSet;return true}else{this.byHash.set(hash,[atomSet]);return true}};Set.prototype.has=function(atomSet){var hash=atom_set_1.default.hashCode(atomSet);if(this.byHash.has(hash)){var sets=this.byHash.get(hash);for(var _i=0,sets_5=sets;_i<sets_5.length;_i++){var set=sets_5[_i];if(atom_set_1.default.areEqual(atomSet,set))return true}}return false};Set.ofSelection=function(atomSelection){var set=new Set;for(var _i=0,_a=atomSets(atomSelection);_i<_a.length;_i++){var atomSet=_a[_i];set.add(atomSet)}return set};return Set}();AtomSelection.Set=Set;var Lookup3d=function(){function Lookup3d(model,selection){this.model=model;this.selection=selection;this.maxRadius=0;var sets=atomSets(selection);var positions={x:new Float32Array(sets.length),y:new Float32Array(sets.length),z:new Float32Array(sets.length)};var radius=0,i=0;for(var _i=0,sets_6=sets;_i<sets_6.length;_i++){var set=sets_6[_i];var bs=atom_set_1.default.boundingSphere(model,set);positions.x[i]=bs.center[0];positions.y[i]=bs.center[1];positions.z[i]=bs.center[2];i++;if(bs.radius>radius)radius=bs.radius}this.maxRadius=radius;this.mask=mask_1.default.always(sets.length);this.lookup=spatial_lookup_1.default(positions).find(mask_1.default.always(sets.length))}Lookup3d.prototype.queryAtomSet=function(a,radius){var _a=atom_set_1.default.boundingSphere(this.model,a),center=_a.center,bsRadius=_a.radius;var _b=this.lookup(center[0],center[1],center[2],this.maxRadius+bsRadius+radius),count=_b.count,indices=_b.indices;var atomSets=AtomSelection.atomSets(this.selection);var setIndices=[];for(var i=0;i<count;i++){var b=atomSets[indices[i]];var d=atom_set_1.default.distance(this.model,a,b);if(d<radius){setIndices.push(indices[i])}}return setIndices};return Lookup3d}();AtomSelection.Lookup3d=Lookup3d;function lookup3d(model,selection){return new Lookup3d(model,selection)}AtomSelection.lookup3d=lookup3d})(AtomSelection||(AtomSelection={}));exports.default=AtomSelection},function(module,exports,__webpack_require__){!function(n,t){true?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Parsimmon=t():n.Parsimmon=t()}(this,function(){return function(n){function t(e){if(r[e])return r[e].exports;var u=r[e]={i:e,l:!1,exports:{}};return n[e].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var r={};return t.m=n,t.c=r,t.i=function(n){return n},t.d=function(n,r,e){t.o(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:e})},t.n=function(n){var r=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(r,"a",r),r},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=0)}([function(n,t,r){"use strict";function e(n){if(!(this instanceof e))return new e(n);this._=n}function u(n){return n instanceof e}function i(n){return"[object Array]"==={}.toString.call(n)}function o(n,t){return{status:!0,index:n,value:t,furthest:-1,expected:[]}}function a(n,t){return{status:!1,index:-1,value:null,furthest:n,expected:[t]}}function f(n,t){if(!t)return n;if(n.furthest>t.furthest)return n;var r=n.furthest===t.furthest?s(n.expected,t.expected):t.expected;return{status:n.status,index:n.index,value:n.value,furthest:t.furthest,expected:r}}function c(n,t){var r=n.slice(0,t).split("\n");return{offset:t,line:r.length,column:r[r.length-1].length+1}}function s(n,t){var r=n.length,e=t.length;if(0===r)return t;if(0===e)return n;for(var u={},i=0;i<r;i++)u[n[i]]=!0;for(var o=0;o<e;o++)u[t[o]]=!0;var a=[];for(var f in u)u.hasOwnProperty(f)&&a.push(f);return a.sort(),a}function l(n){if(!u(n))throw new Error("not a parser: "+n)}function h(n){if(!i(n))throw new Error("not an array: "+n)}function p(n){if("number"!=typeof n)throw new Error("not a number: "+n)}function d(n){if(!(n instanceof RegExp))throw new Error("not a regexp: "+n);for(var t=w(n),r=0;r<t.length;r++){var e=t.charAt(r);if("i"!==e&&"m"!==e&&"u"!==e)throw new Error('unsupported regexp flag "'+e+'": '+n)}}function v(n){if("function"!=typeof n)throw new Error("not a function: "+n)}function g(n){if("string"!=typeof n)throw new Error("not a string: "+n)}function m(n){return 1===n.length?n[0]:"one of "+n.join(", ")}function y(n,t){var r=t.index,e=r.offset;if(e===n.length)return", got the end of the input";var u=e>0?"'...":"'",i=n.length-e>12?"...'":"'";return" at line "+r.line+" column "+r.column+", got "+u+n.slice(e,e+12)+i}function x(n,t){return"expected "+m(t.expected)+y(n,t)}function w(n){var t=""+n;return t.slice(t.lastIndexOf("/")+1)}function E(n){return RegExp("^(?:"+n.source+")",w(n))}function _(){for(var n=[].slice.call(arguments),t=n.length,r=0;r<t;r+=1)l(n[r]);return e(function(r,e){for(var u,i=new Array(t),a=0;a<t;a+=1){if(u=f(n[a]._(r,e),u),!u.status)return u;i[a]=u.value,e=u.index}return f(o(e,i),u)})}function b(){for(var n={},t=0,r=[].slice.call(arguments),a=r.length,c=0;c<a;c+=1){var s=r[c];if(!u(s)){if(i(s)){if(2===s.length&&"string"==typeof s[0]&&u(s[1])){var l=s[0];if(n[l])throw new Error("seqObj: duplicate key "+l);n[l]=!0,t++;continue}}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===t)throw new Error("seqObj expects at least one named parser, found zero");return e(function(n,t){for(var e,u={},c=0;c<a;c+=1){var s,l;if(i(r[c])?(s=r[c][0],l=r[c][1]):(s=null,l=r[c]),e=f(l._(n,t),e),!e.status)return e;s&&(u[s]=e.value),t=e.index}return f(o(t,u),e)})}function O(){var n=[].slice.call(arguments);if(0===n.length)throw new Error("seqMap needs at least one argument");var t=n.pop();return v(t),_.apply(null,n).map(function(n){return t.apply(null,n)})}function k(n){var t={};for(var r in n)({}).hasOwnProperty.call(n,r)&&function(r){var e=function(){return n[r](t)};t[r]=G(e)}(r);return t}function j(){var n=[].slice.call(arguments),t=n.length;if(0===t)return F("zero alternates");for(var r=0;r<t;r+=1)l(n[r]);return e(function(t,r){for(var e,u=0;u<n.length;u+=1)if(e=f(n[u]._(t,r),e),e.status)return e;return e})}function P(n,t){return q(n,t).or(z([]))}function q(n,t){l(n),l(t);var r=t.then(n).many();return n.chain(function(n){return r.map(function(t){return[n].concat(t)})})}function A(n){g(n);var t="'"+n+"'";return e(function(r,e){var u=e+n.length,i=r.slice(e,u);return i===n?o(u,i):a(e,t)})}function B(n,t){d(n),arguments.length>=2?p(t):t=0;var r=E(n),u=""+n;return e(function(n,e){var i=r.exec(n.slice(e));if(i){if(0<=t&&t<=i.length){var f=i[0],c=i[t];return o(e+f.length,c)}return a(e,"valid match group (0 to "+i.length+") in "+u)}return a(e,u)})}function z(n){return e(function(t,r){return o(r,n)})}function F(n){return e(function(t,r){return a(r,n)})}function M(n){if(u(n))return e(function(t,r){var e=n._(t,r);return e.index=r,e.value="",e});if("string"==typeof n)return M(A(n));if(n instanceof RegExp)return M(B(n));throw new Error("not a string, regexp, or parser: "+n)}function R(n){return l(n),e(function(t,r){var e=n._(t,r),u=t.slice(r,e.index);return e.status?a(r,'not "'+u+'"'):o(r,null)})}function L(n){return v(n),e(function(t,r){var e=t.charAt(r);return r<t.length&&n(e)?o(r+1,e):a(r,"a character matching "+n)})}function S(n){return L(function(t){return n.indexOf(t)>=0})}function W(n){return L(function(t){return n.indexOf(t)<0})}function I(n){return e(n(o,a))}function C(n,t){return L(function(r){return n<=r&&r<=t}).desc(n+"-"+t)}function D(n){return v(n),e(function(t,r){for(var e=r;e<t.length&&n(t.charAt(e));)e++;return o(e,t.slice(r,e))})}function G(n,t){arguments.length<2&&(t=n,n=void 0);var r=e(function(n,e){return r._=t()._,r._(n,e)});return n?r.desc(n):r}function H(){return F("fantasy-land/empty")}var J=e.prototype;J.parse=function(n){if("string"!=typeof n)throw new Error(".parse must be called with a string as its argument");var t=this.skip(T)._(n,0);return t.status?{status:!0,value:t.value}:{status:!1,index:c(n,t.furthest),expected:t.expected}},J.tryParse=function(n){var t=this.parse(n);if(t.status)return t.value;var r=x(n,t),e=new Error(r);throw e.type="ParsimmonError",e.result=t,e},J.or=function(n){return j(this,n)},J.trim=function(n){return this.wrap(n,n)},J.wrap=function(n,t){return O(n,this,t,function(n,t){return t})},J.thru=function(n){return n(this)},J.then=function(n){return l(n),_(this,n).map(function(n){return n[1]})},J.many=function(){var n=this;return e(function(t,r){for(var e=[],u=void 0;;){if(u=f(n._(t,r),u),!u.status)return f(o(r,e),u);r=u.index,e.push(u.value)}})},J.tie=function(){return this.map(function(n){h(n);for(var t="",r=0;r<n.length;r++)g(n[r]),t+=n[r];return t})},J.times=function(n,t){var r=this;return arguments.length<2&&(t=n),p(n),p(t),e(function(e,u){for(var i=[],a=void 0,c=void 0,s=0;s<n;s+=1){if(a=r._(e,u),c=f(a,c),!a.status)return c;u=a.index,i.push(a.value)}for(;s<t&&(a=r._(e,u),c=f(a,c),a.status);s+=1)u=a.index,i.push(a.value);return f(o(u,i),c)})},J.result=function(n){return this.map(function(){return n})},J.atMost=function(n){return this.times(0,n)},J.atLeast=function(n){return O(this.times(n),this.many(),function(n,t){return n.concat(t)})},J.map=function(n){v(n);var t=this;return e(function(r,e){var u=t._(r,e);return u.status?f(o(u.index,n(u.value)),u):u})},J.skip=function(n){return _(this,n).map(function(n){return n[0]})},J.mark=function(){return O(K,this,K,function(n,t,r){return{start:n,value:t,end:r}})},J.node=function(n){return O(K,this,K,function(t,r,e){return{name:n,value:r,start:t,end:e}})},J.sepBy=function(n){return P(this,n)},J.sepBy1=function(n){return q(this,n)},J.lookahead=function(n){return this.skip(M(n))},J.notFollowedBy=function(n){return this.skip(R(n))},J.desc=function(n){var t=this;return e(function(r,e){var u=t._(r,e);return u.status||(u.expected=[n]),u})},J.fallback=function(n){return this.or(z(n))},J.ap=function(n){return O(n,this,function(n,t){return n(t)})},J.chain=function(n){var t=this;return e(function(r,e){var u=t._(r,e);return u.status?f(n(u.value)._(r,u.index),u):u})},J.concat=J.or,J.empty=H,J.of=z,J["fantasy-land/ap"]=J.ap,J["fantasy-land/chain"]=J.chain,J["fantasy-land/concat"]=J.concat,J["fantasy-land/empty"]=J.empty,J["fantasy-land/of"]=J.of,J["fantasy-land/map"]=J.map;var K=e(function(n,t){return o(t,c(n,t))}),N=e(function(n,t){return t>=n.length?a(t,"any character"):o(t+1,n.charAt(t))}),Q=e(function(n,t){return o(n.length,n.slice(t))}),T=e(function(n,t){return t<n.length?a(t,"EOF"):o(t,null)}),U=B(/[0-9]/).desc("a digit"),V=B(/[0-9]*/).desc("optional digits"),X=B(/[a-z]/i).desc("a letter"),Y=B(/[a-z]*/i).desc("optional letters"),Z=B(/\s*/).desc("optional whitespace"),$=B(/\s+/).desc("whitespace");e.all=Q,e.alt=j,e.any=N,e.createLanguage=k,e.custom=I,e.digit=U,e.digits=V,e.empty=H,e.eof=T,e.fail=F,e.formatError=x,e.index=K,e.isParser=u,e.lazy=G,e.letter=X,e.letters=Y,e.lookahead=M,e.makeFailure=a,e.makeSuccess=o,e.noneOf=W,e.notFollowedBy=R,e.of=z,e.oneOf=S,e.optWhitespace=Z,e.Parser=e,e.range=C,e.regex=B,e.regexp=B,e.sepBy=P,e.sepBy1=q,e.seq=_,e.seqMap=O,e.seqObj=b,e.string=A,e.succeed=z,e.takeWhile=D,e.test=L,e.whitespace=$,e["fantasy-land/empty"]=H,e["fantasy-land/of"]=z,n.exports=e}])})},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);function checkMask(value,bitmask){return(value&bitmask)===bitmask}var DOMPropertyInjection={MUST_USE_PROPERTY:1,HAS_BOOLEAN_VALUE:4,HAS_NUMERIC_VALUE:8,HAS_POSITIVE_NUMERIC_VALUE:16|8,HAS_OVERLOADED_BOOLEAN_VALUE:32,injectDOMPropertyConfig:function(domPropertyConfig){var Injection=DOMPropertyInjection;var Properties=domPropertyConfig.Properties||{};var DOMAttributeNamespaces=domPropertyConfig.DOMAttributeNamespaces||{};var DOMAttributeNames=domPropertyConfig.DOMAttributeNames||{};var DOMPropertyNames=domPropertyConfig.DOMPropertyNames||{};var DOMMutationMethods=domPropertyConfig.DOMMutationMethods||{};if(domPropertyConfig.isCustomAttribute){DOMProperty._isCustomAttributeFunctions.push(domPropertyConfig.isCustomAttribute)}for(var propName in Properties){!!DOMProperty.properties.hasOwnProperty(propName)?process.env.NODE_ENV!=="production"?invariant(false,"injectDOMPropertyConfig(...): You're trying to inject DOM property '%s' which has already been injected. You may be accidentally injecting the same DOM property config twice, or you may be injecting two configs that have conflicting property names.",propName):_prodInvariant("48",propName):void 0;var lowerCased=propName.toLowerCase();var propConfig=Properties[propName];var propertyInfo={attributeName:lowerCased,attributeNamespace:null,propertyName:propName,mutationMethod:null,mustUseProperty:checkMask(propConfig,Injection.MUST_USE_PROPERTY),hasBooleanValue:checkMask(propConfig,Injection.HAS_BOOLEAN_VALUE),hasNumericValue:checkMask(propConfig,Injection.HAS_NUMERIC_VALUE),hasPositiveNumericValue:checkMask(propConfig,Injection.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:checkMask(propConfig,Injection.HAS_OVERLOADED_BOOLEAN_VALUE)};!(propertyInfo.hasBooleanValue+propertyInfo.hasNumericValue+propertyInfo.hasOverloadedBooleanValue<=1)?process.env.NODE_ENV!=="production"?invariant(false,"DOMProperty: Value can be one of boolean, overloaded boolean, or numeric value, but not a combination: %s",propName):_prodInvariant("50",propName):void 0;if(process.env.NODE_ENV!=="production"){DOMProperty.getPossibleStandardName[lowerCased]=propName}if(DOMAttributeNames.hasOwnProperty(propName)){var attributeName=DOMAttributeNames[propName];propertyInfo.attributeName=attributeName;if(process.env.NODE_ENV!=="production"){DOMProperty.getPossibleStandardName[attributeName]=propName}}if(DOMAttributeNamespaces.hasOwnProperty(propName)){propertyInfo.attributeNamespace=DOMAttributeNamespaces[propName]}if(DOMPropertyNames.hasOwnProperty(propName)){propertyInfo.propertyName=DOMPropertyNames[propName]}if(DOMMutationMethods.hasOwnProperty(propName)){propertyInfo.mutationMethod=DOMMutationMethods[propName]}DOMProperty.properties[propName]=propertyInfo}}};var ATTRIBUTE_NAME_START_CHAR=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD";var DOMProperty={ID_ATTRIBUTE_NAME:"data-reactid",ROOT_ATTRIBUTE_NAME:"data-reactroot",ATTRIBUTE_NAME_START_CHAR:ATTRIBUTE_NAME_START_CHAR,ATTRIBUTE_NAME_CHAR:ATTRIBUTE_NAME_START_CHAR+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",properties:{},getPossibleStandardName:process.env.NODE_ENV!=="production"?{autofocus:"autoFocus"}:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(attributeName){for(var i=0;i<DOMProperty._isCustomAttributeFunctions.length;i++){var isCustomAttributeFn=DOMProperty._isCustomAttributeFunctions[i];if(isCustomAttributeFn(attributeName)){return true}}return false},injection:DOMPropertyInjection};module.exports=DOMProperty}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var ReactCurrentOwner=__webpack_require__(15);var warning=__webpack_require__(2);var canDefineProperty=__webpack_require__(47);var hasOwnProperty=Object.prototype.hasOwnProperty;var REACT_ELEMENT_TYPE=__webpack_require__(99);var RESERVED_PROPS={key:true,ref:true,__self:true,__source:true};var specialPropKeyWarningShown,specialPropRefWarningShown;function hasValidRef(config){if(process.env.NODE_ENV!=="production"){if(hasOwnProperty.call(config,"ref")){var getter=Object.getOwnPropertyDescriptor(config,"ref").get;if(getter&&getter.isReactWarning){return false}}}return config.ref!==undefined}function hasValidKey(config){if(process.env.NODE_ENV!=="production"){if(hasOwnProperty.call(config,"key")){var getter=Object.getOwnPropertyDescriptor(config,"key").get;if(getter&&getter.isReactWarning){return false}}}return config.key!==undefined}function defineKeyPropWarningGetter(props,displayName){var warnAboutAccessingKey=function(){if(!specialPropKeyWarningShown){specialPropKeyWarningShown=true;process.env.NODE_ENV!=="production"?warning(false,"%s: `key` is not a prop. Trying to access it will result "+"in `undefined` being returned. If you need to access the same "+"value within the child component, you should pass it as a different "+"prop. (https://fb.me/react-special-props)",displayName):void 0}};warnAboutAccessingKey.isReactWarning=true;Object.defineProperty(props,"key",{get:warnAboutAccessingKey,configurable:true})}function defineRefPropWarningGetter(props,displayName){var warnAboutAccessingRef=function(){if(!specialPropRefWarningShown){specialPropRefWarningShown=true;process.env.NODE_ENV!=="production"?warning(false,"%s: `ref` is not a prop. Trying to access it will result "+"in `undefined` being returned. If you need to access the same "+"value within the child component, you should pass it as a different "+"prop. (https://fb.me/react-special-props)",displayName):void 0}};warnAboutAccessingRef.isReactWarning=true;Object.defineProperty(props,"ref",{get:warnAboutAccessingRef,configurable:true})}var ReactElement=function(type,key,ref,self,source,owner,props){var element={$$typeof:REACT_ELEMENT_TYPE,type:type,key:key,ref:ref,props:props,_owner:owner};if(process.env.NODE_ENV!=="production"){element._store={};if(canDefineProperty){Object.defineProperty(element._store,"validated",{configurable:false,enumerable:false,writable:true,value:false});Object.defineProperty(element,"_self",{configurable:false,enumerable:false,writable:false,value:self});Object.defineProperty(element,"_source",{configurable:false,enumerable:false,writable:false,value:source})}else{element._store.validated=false;element._self=self;element._source=source}if(Object.freeze){Object.freeze(element.props);Object.freeze(element)}}return element};ReactElement.createElement=function(type,config,children){var propName;var props={};var key=null;var ref=null;var self=null;var source=null;if(config!=null){if(hasValidRef(config)){ref=config.ref}if(hasValidKey(config)){key=""+config.key}self=config.__self===undefined?null:config.__self;source=config.__source===undefined?null:config.__source;for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){props[propName]=config[propName]}}}var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2]}if(process.env.NODE_ENV!=="production"){if(Object.freeze){Object.freeze(childArray)}}props.children=childArray}if(type&&type.defaultProps){var defaultProps=type.defaultProps;for(propName in defaultProps){if(props[propName]===undefined){props[propName]=defaultProps[propName]}}}if(process.env.NODE_ENV!=="production"){if(key||ref){if(typeof props.$$typeof==="undefined"||props.$$typeof!==REACT_ELEMENT_TYPE){var displayName=typeof type==="function"?type.displayName||type.name||"Unknown":type;if(key){defineKeyPropWarningGetter(props,displayName)}if(ref){defineRefPropWarningGetter(props,displayName)}}}}return ReactElement(type,key,ref,self,source,ReactCurrentOwner.current,props)};ReactElement.createFactory=function(type){var factory=ReactElement.createElement.bind(null,type);factory.type=type;return factory};ReactElement.cloneAndReplaceKey=function(oldElement,newKey){var newElement=ReactElement(oldElement.type,newKey,oldElement.ref,oldElement._self,oldElement._source,oldElement._owner,oldElement.props);return newElement};ReactElement.cloneElement=function(element,config,children){var propName;var props=_assign({},element.props);var key=element.key;var ref=element.ref;var self=element._self;var source=element._source;var owner=element._owner;if(config!=null){if(hasValidRef(config)){ref=config.ref;owner=ReactCurrentOwner.current}if(hasValidKey(config)){key=""+config.key}var defaultProps;if(element.type&&element.type.defaultProps){defaultProps=element.type.defaultProps}for(propName in config){if(hasOwnProperty.call(config,propName)&&!RESERVED_PROPS.hasOwnProperty(propName)){if(config[propName]===undefined&&defaultProps!==undefined){props[propName]=defaultProps[propName]}else{props[propName]=config[propName]}}}}var childrenLength=arguments.length-2;if(childrenLength===1){props.children=children}else if(childrenLength>1){var childArray=Array(childrenLength);for(var i=0;i<childrenLength;i++){childArray[i]=arguments[i+2]}props.children=childArray}return ReactElement(element.type,key,ref,self,source,owner,props)};ReactElement.isValidElement=function(object){return typeof object==="object"&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE};module.exports=ReactElement}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);var oneArgumentPooler=function(copyFieldsFrom){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,copyFieldsFrom);return instance}else{return new Klass(copyFieldsFrom)}};var twoArgumentPooler=function(a1,a2){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2);return instance}else{return new Klass(a1,a2)}};var threeArgumentPooler=function(a1,a2,a3){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3);return instance}else{return new Klass(a1,a2,a3)}};var fourArgumentPooler=function(a1,a2,a3,a4){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3,a4);return instance}else{return new Klass(a1,a2,a3,a4)}};var standardReleaser=function(instance){var Klass=this;!(instance instanceof Klass)?process.env.NODE_ENV!=="production"?invariant(false,"Trying to release an instance into a pool of a different type."):_prodInvariant("25"):void 0;instance.destructor();if(Klass.instancePool.length<Klass.poolSize){Klass.instancePool.push(instance)}};var DEFAULT_POOL_SIZE=10;var DEFAULT_POOLER=oneArgumentPooler;var addPoolingTo=function(CopyConstructor,pooler){var NewKlass=CopyConstructor;NewKlass.instancePool=[];NewKlass.getPooled=pooler||DEFAULT_POOLER;if(!NewKlass.poolSize){NewKlass.poolSize=DEFAULT_POOL_SIZE}NewKlass.release=standardReleaser;return NewKlass};var PooledClass={addPoolingTo:addPoolingTo,oneArgumentPooler:oneArgumentPooler,twoArgumentPooler:twoArgumentPooler,threeArgumentPooler:threeArgumentPooler,fourArgumentPooler:fourArgumentPooler};module.exports=PooledClass}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var expression_1=__webpack_require__(33);function Argument(type,params){var _a=params||{},_b=_a.description,description=_b===void 0?void 0:_b,_c=_a.isOptional,isOptional=_c===void 0?false:_c,_d=_a.isRest,isRest=_d===void 0?false:_d,_e=_a.defaultValue,defaultValue=_e===void 0?void 0:_e;return{type:type,isOptional:isOptional,isRest:isRest,defaultValue:defaultValue,description:description}}exports.Argument=Argument;var Arguments;(function(Arguments){Arguments.None=Dictionary({});function Dictionary(map){return{kind:"dictionary",map:map,"@type":0}}Arguments.Dictionary=Dictionary;function List(type,params){var _a=(params||{}).nonEmpty,nonEmpty=_a===void 0?false:_a;return{kind:"list",type:type,nonEmpty:nonEmpty,"@type":0}}Arguments.List=List})(Arguments=exports.Arguments||(exports.Arguments={}));function Symbol(name,args,type,description){var symbol=function(args){return expression_1.default.Apply(symbol.id,args)};symbol.info={namespace:"",name:name,description:description};symbol.id="";symbol.args=args;symbol.type=type;return symbol}function isSymbol(x){var s=x;return typeof s==="function"&&!!s.info&&!!s.args&&typeof s.info.namespace==="string"&&!!s.type}exports.isSymbol=isSymbol;exports.default=Symbol},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var element_address_1=__webpack_require__(26);var bond_address_1=__webpack_require__(149);var atom_set_1=__webpack_require__(14);var runtime_1=__webpack_require__(150);function Environment(context){return{symbolTable:runtime_1.default,context:context,slots:{element:element_address_1.default(),atomSet:atom_set_1.default([]),bond:bond_address_1.default(),atomSetReducer:void 0},slotLocks:{element:false,atomSet:false,bond:false,atomSetReducer:false}}}(function(Environment){function lockSlot(_a,slot){var slotLocks=_a.slotLocks;if(slotLocks[slot])throw new Error("Slot '"+slot+"' is already locked.");slotLocks[slot]=true}Environment.lockSlot=lockSlot;function unlockSlot(_a,slot){var slotLocks=_a.slotLocks;if(!slotLocks[slot])throw new Error("Slot '"+slot+"' is not locked.");slotLocks[slot]=false}Environment.unlockSlot=unlockSlot})(Environment||(Environment={}));exports.default=Environment},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function ElementAddress(){return{dataIndex:0,atom:0,residue:0,chain:0,entity:0}}(function(ElementAddress){function setAtom(model,address,atomIndex){var _a=model.atoms,dataIndex=_a.dataIndex,residueIndex=_a.residueIndex,chainIndex=model.residues.chainIndex,entityIndex=model.chains.entityIndex;address.atom=atomIndex;address.dataIndex=dataIndex[atomIndex];address.residue=residueIndex[atomIndex];address.chain=chainIndex[address.residue];address.entity=entityIndex[address.chain]}ElementAddress.setAtom=setAtom;function setAtomLayer(model,address,atomIndex){var dataIndex=model.atoms.dataIndex;address.atom=atomIndex;address.dataIndex=dataIndex[atomIndex]}ElementAddress.setAtomLayer=setAtomLayer;function setResidueLayer(model,address,residueIndex){var atomOffset=model.residues.atomOffset,dataIndex=model.atoms.dataIndex;address.atom=atomOffset[residueIndex];address.dataIndex=dataIndex[address.atom];address.residue=residueIndex}ElementAddress.setResidueLayer=setResidueLayer;function setChainLayer(model,address,chainIndex){var atomOffset=model.residues.atomOffset,residueOffset=model.chains.residueOffset,dataIndex=model.atoms.dataIndex;address.chain=chainIndex;address.residue=residueOffset[chainIndex];address.atom=atomOffset[address.residue];address.dataIndex=dataIndex[address.atom]}ElementAddress.setChainLayer=setChainLayer;function setEntityLayer(model,address,entityIndex){var atomOffset=model.residues.atomOffset,residueOffset=model.chains.residueOffset,chainOffset=model.entities.chainOffset,dataIndex=model.atoms.dataIndex;address.entity=entityIndex;address.chain=chainOffset[entityIndex];address.residue=residueOffset[address.chain];address.atom=atomOffset[address.residue];address.dataIndex=dataIndex[address.atom]}ElementAddress.setEntityLayer=setEntityLayer})(ElementAddress||(ElementAddress={}));exports.default=ElementAddress},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var collections_1=__webpack_require__(8);var Mask;(function(Mask){var EmptyMask=function(){function EmptyMask(){this.size=0}EmptyMask.prototype.has=function(i){return false};EmptyMask.prototype.forEach=function(f,ctx){return ctx};return EmptyMask}();var SingletonMask=function(){function SingletonMask(idx){this.idx=idx;this.size=1}SingletonMask.prototype.has=function(i){return i===this.idx};SingletonMask.prototype.forEach=function(f,ctx){f(this.idx,ctx);return ctx};return SingletonMask}();var BitMask=function(){function BitMask(mask,size){this.mask=mask;this.size=size;this.length=mask.length}BitMask.prototype.has=function(i){return i<this.length&&!!this.mask[i]};BitMask.prototype._forEach=function(f,ctx){for(var i=0;i<this.length;i++){if(this.mask[i])f(i,ctx)}};BitMask.prototype.forEach=function(f,ctx){this._forEach(f,ctx);return ctx};return BitMask}();var AllMask=function(){function AllMask(size){this.size=size}AllMask.prototype.has=function(i){return true};AllMask.prototype._forEach=function(f,ctx){for(var i=0;i<this.size;i++){f(i,ctx)}};AllMask.prototype.forEach=function(f,ctx){this._forEach(f,ctx);return ctx};return AllMask}();var SetMask=function(){function SetMask(set){this.set=set;this._flat=void 0;this.size=set.size}SetMask.prototype.has=function(i){return this.set.has(i)};SetMask.prototype._forEach=function(f,ctx){for(var _i=0,_a=this.flatten();_i<_a.length;_i++){var idx=_a[_i];f(idx,ctx)}};SetMask.prototype.flatten=function(){if(this._flat)return this._flat;var indices=new Int32Array(this.size);this.set.forEach(function(i,ctx){return ctx.indices[ctx.offset++]=i},{indices:indices,offset:0});collections_1.sortAsc(indices);this._flat=indices;return this._flat};SetMask.prototype.forEach=function(f,ctx){this._forEach(f,ctx);return ctx};return SetMask}();function always(size){return new AllMask(size)}Mask.always=always;Mask.never=new EmptyMask;function ofSet(set){return new SetMask(set)}Mask.ofSet=ofSet;function singleton(i){return new SingletonMask(i)}Mask.singleton=singleton;function ofUniqueIndices(indices){var len=indices.length;if(len===0)return new EmptyMask;if(len===1)return new SingletonMask(indices[0]);var max=0;for(var _i=0,_a=indices;_i<_a.length;_i++){var i=_a[_i];if(i>max)max=i}if(len===max)return new AllMask(len);var f=len/max;if(f<1/12){var set=collections_1.FastSet.create();for(var _b=0,_c=indices;_b<_c.length;_b++){var i=_c[_b];set.add(i)}return new SetMask(set)}var mask=new Int8Array(max+1);for(var _d=0,_e=indices;_d<_e.length;_d++){var i=_e[_d];mask[i]=1}return new BitMask(mask,indices.length)}Mask.ofUniqueIndices=ofUniqueIndices;function ofMask(mask,size){return new BitMask(mask,size)}Mask.ofMask=ofMask;function hasAny(mask,xs){for(var _i=0,xs_1=xs;_i<xs_1.length;_i++){var x=xs_1[_i];if(mask.has(x))return true}return false}Mask.hasAny=hasAny;function complement(mask,against){var context={mask:mask,count:0,max:0};against.forEach(function(i,ctx){if(!ctx.mask.has(i)){ctx.count++;if(i>ctx.max)ctx.max=i}},context);var count=context.count,max=context.max;if(count/max<1/12){var setContext_1={mask:mask,set:collections_1.FastSet.create()};against.forEach(function(i,ctx){if(!ctx.mask.has(i)){ctx.set.add(i)}},setContext_1);return ofSet(setContext_1.set)}else{var maskContext_1={mask:mask,target:new Uint8Array(context.max+1)};against.forEach(function(i,ctx){if(!ctx.mask.has(i)){ctx.target[i]=1}},maskContext_1);return ofMask(maskContext_1.target,context.count)}}Mask.complement=complement})(Mask||(Mask={}));exports.default=Mask},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var ReactBaseClasses=__webpack_require__(97);var ReactChildren=__webpack_require__(188);var ReactDOMFactories=__webpack_require__(192);var ReactElement=__webpack_require__(22);var ReactPropTypes=__webpack_require__(196);var ReactVersion=__webpack_require__(198);var createReactClass=__webpack_require__(199);var onlyChild=__webpack_require__(201);var createElement=ReactElement.createElement;var createFactory=ReactElement.createFactory;var cloneElement=ReactElement.cloneElement;if(process.env.NODE_ENV!=="production"){var lowPriorityWarning=__webpack_require__(71);var canDefineProperty=__webpack_require__(47);var ReactElementValidator=__webpack_require__(101);var didWarnPropTypesDeprecated=false;createElement=ReactElementValidator.createElement;createFactory=ReactElementValidator.createFactory;cloneElement=ReactElementValidator.cloneElement}var __spread=_assign;var createMixin=function(mixin){return mixin};if(process.env.NODE_ENV!=="production"){var warnedForSpread=false;var warnedForCreateMixin=false;__spread=function(){lowPriorityWarning(warnedForSpread,"React.__spread is deprecated and should not be used. Use "+"Object.assign directly or another helper function with similar "+"semantics. You may be seeing this warning due to your compiler. "+"See https://fb.me/react-spread-deprecation for more details.");warnedForSpread=true;return _assign.apply(null,arguments)};createMixin=function(mixin){lowPriorityWarning(warnedForCreateMixin,"React.createMixin is deprecated and should not be used. "+"In React v16.0, it will be removed. "+"You can use this mixin directly instead. "+"See https://fb.me/createmixin-was-never-implemented for more info.");warnedForCreateMixin=true;return mixin}}var React={Children:{map:ReactChildren.map,forEach:ReactChildren.forEach,count:ReactChildren.count,toArray:ReactChildren.toArray,only:onlyChild},Component:ReactBaseClasses.Component,PureComponent:ReactBaseClasses.PureComponent,createElement:createElement,cloneElement:cloneElement,isValidElement:ReactElement.isValidElement,PropTypes:ReactPropTypes,createClass:createReactClass,createFactory:createFactory,createMixin:createMixin,DOM:ReactDOMFactories,version:ReactVersion,__spread:__spread};if(process.env.NODE_ENV!=="production"){var warnedForCreateClass=false;if(canDefineProperty){Object.defineProperty(React,"PropTypes",{get:function(){lowPriorityWarning(didWarnPropTypesDeprecated,"Accessing PropTypes via the main React package is deprecated,"+" and will be removed in  React v16.0."+" Use the latest available v15.* prop-types package from npm instead."+" For info on usage, compatibility, migration and more, see "+"https://fb.me/prop-types-docs");didWarnPropTypesDeprecated=true;return ReactPropTypes}});Object.defineProperty(React,"createClass",{get:function(){lowPriorityWarning(warnedForCreateClass,"Accessing createClass via the main React package is deprecated,"+" and will be removed in React v16.0."+" Use a plain JavaScript class instead. If you're not yet "+"ready to migrate, create-react-class v15.* is available "+"on npm as a temporary, drop-in replacement. "+"For more info see https://fb.me/react-create-class");warnedForCreateClass=true;return createReactClass}})}React.DOM={};var warnedForFactories=false;Object.keys(ReactDOMFactories).forEach(function(factory){React.DOM[factory]=function(){if(!warnedForFactories){lowPriorityWarning(false,"Accessing factories like React.DOM.%s has been deprecated "+"and will be removed in v16.0+. Use the "+"react-dom-factories package instead. "+" Version 1.0 provides a drop-in replacement."+" For more info, see https://fb.me/react-dom-factories",factory);warnedForFactories=true}return ReactDOMFactories[factory].apply(ReactDOMFactories,arguments)}})}module.exports=React}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function reactProdInvariant(code){var argCount=arguments.length-1;var message="Minified React error #"+code+"; visit "+"http://facebook.github.io/react/docs/error-decoder.html?invariant="+code;for(var argIdx=0;argIdx<argCount;argIdx++){message+="&args[]="+encodeURIComponent(arguments[argIdx+1])}message+=" for the full message or use the non-minified dev environment"+" for full errors and additional helpful warnings.";var error=new Error(message);error.name="Invariant Violation";error.framesToPop=1;throw error}module.exports=reactProdInvariant},function(module,exports,__webpack_require__){"use strict";var encode=__webpack_require__(206);var decode=__webpack_require__(207);var C_BACKSLASH=92;var decodeHTML=__webpack_require__(104).decodeHTML;var ENTITY="&(?:#x[a-f0-9]{1,8}|#[0-9]{1,8}|[a-z][a-z0-9]{1,31});";var TAGNAME="[A-Za-z][A-Za-z0-9-]*";var ATTRIBUTENAME="[a-zA-Z_:][a-zA-Z0-9:._-]*";var UNQUOTEDVALUE="[^\"'=<>`\\x00-\\x20]+";var SINGLEQUOTEDVALUE="'[^']*'";var DOUBLEQUOTEDVALUE='"[^"]*"';var ATTRIBUTEVALUE="(?:"+UNQUOTEDVALUE+"|"+SINGLEQUOTEDVALUE+"|"+DOUBLEQUOTEDVALUE+")";var ATTRIBUTEVALUESPEC="(?:"+"\\s*="+"\\s*"+ATTRIBUTEVALUE+")";var ATTRIBUTE="(?:"+"\\s+"+ATTRIBUTENAME+ATTRIBUTEVALUESPEC+"?)";var OPENTAG="<"+TAGNAME+ATTRIBUTE+"*"+"\\s*/?>";var CLOSETAG="</"+TAGNAME+"\\s*[>]";var HTMLCOMMENT="\x3c!----\x3e|\x3c!--(?:-?[^>-])(?:-?[^-])*--\x3e";var PROCESSINGINSTRUCTION="[<][?].*?[?][>]";var DECLARATION="<![A-Z]+"+"\\s+[^>]*>";var CDATA="<!\\[CDATA\\[[\\s\\S]*?\\]\\]>";var HTMLTAG="(?:"+OPENTAG+"|"+CLOSETAG+"|"+HTMLCOMMENT+"|"+PROCESSINGINSTRUCTION+"|"+DECLARATION+"|"+CDATA+")";var reHtmlTag=new RegExp("^"+HTMLTAG,"i");var reBackslashOrAmp=/[\\&]/;var ESCAPABLE="[!\"#$%&'()*+,./:;<=>?@[\\\\\\]^_`{|}~-]";var reEntityOrEscapedChar=new RegExp("\\\\"+ESCAPABLE+"|"+ENTITY,"gi");var XMLSPECIAL='[&<>"]';var reXmlSpecial=new RegExp(XMLSPECIAL,"g");var reXmlSpecialOrEntity=new RegExp(ENTITY+"|"+XMLSPECIAL,"gi");var unescapeChar=function(s){if(s.charCodeAt(0)===C_BACKSLASH){return s.charAt(1)}else{return decodeHTML(s)}};var unescapeString=function(s){if(reBackslashOrAmp.test(s)){return s.replace(reEntityOrEscapedChar,unescapeChar)}else{return s}};var normalizeURI=function(uri){try{return encode(decode(uri))}catch(err){return uri}};var replaceUnsafeChar=function(s){switch(s){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";default:return s}};var escapeXml=function(s,preserve_entities){if(reXmlSpecial.test(s)){if(preserve_entities){return s.replace(reXmlSpecialOrEntity,replaceUnsafeChar)}else{return s.replace(reXmlSpecial,replaceUnsafeChar)}}else{return s}};module.exports={unescapeString:unescapeString,normalizeURI:normalizeURI,escapeXml:escapeXml,reHtmlTag:reHtmlTag,OPENTAG:OPENTAG,CLOSETAG:CLOSETAG,ENTITY:ENTITY,ESCAPABLE:ESCAPABLE}},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactRef=__webpack_require__(246);var ReactInstrumentation=__webpack_require__(12);var warning=__webpack_require__(2);function attachRefs(){ReactRef.attachRefs(this,this._currentElement)}var ReactReconciler={mountComponent:function(internalInstance,transaction,hostParent,hostContainerInfo,context,parentDebugID){if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeMountComponent(internalInstance._debugID,internalInstance._currentElement,parentDebugID)}}var markup=internalInstance.mountComponent(transaction,hostParent,hostContainerInfo,context,parentDebugID);if(internalInstance._currentElement&&internalInstance._currentElement.ref!=null){transaction.getReactMountReady().enqueue(attachRefs,internalInstance)}if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onMountComponent(internalInstance._debugID)}}return markup},getHostNode:function(internalInstance){return internalInstance.getHostNode()},unmountComponent:function(internalInstance,safely){if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeUnmountComponent(internalInstance._debugID)}}ReactRef.detachRefs(internalInstance,internalInstance._currentElement);internalInstance.unmountComponent(safely);if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onUnmountComponent(internalInstance._debugID)}}},receiveComponent:function(internalInstance,nextElement,transaction,context){var prevElement=internalInstance._currentElement;if(nextElement===prevElement&&context===internalInstance._context){return}if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeUpdateComponent(internalInstance._debugID,nextElement)}}var refsChanged=ReactRef.shouldUpdateRefs(prevElement,nextElement);if(refsChanged){ReactRef.detachRefs(internalInstance,prevElement)}internalInstance.receiveComponent(nextElement,transaction,context);if(refsChanged&&internalInstance._currentElement&&internalInstance._currentElement.ref!=null){transaction.getReactMountReady().enqueue(attachRefs,internalInstance)}if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onUpdateComponent(internalInstance._debugID)}}},performUpdateIfNecessary:function(internalInstance,transaction,updateBatchNumber){if(internalInstance._updateBatchNumber!==updateBatchNumber){process.env.NODE_ENV!=="production"?warning(internalInstance._updateBatchNumber==null||internalInstance._updateBatchNumber===updateBatchNumber+1,"performUpdateIfNecessary: Unexpected batch number (current %s, "+"pending %s)",updateBatchNumber,internalInstance._updateBatchNumber):void 0;return}if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onBeforeUpdateComponent(internalInstance._debugID,internalInstance._currentElement)}}internalInstance.performUpdateIfNecessary(transaction);if(process.env.NODE_ENV!=="production"){if(internalInstance._debugID!==0){ReactInstrumentation.debugTool.onUpdateComponent(internalInstance._debugID)}}}};module.exports=ReactReconciler}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var DOMNamespaces=__webpack_require__(80);var setInnerHTML=__webpack_require__(52);var createMicrosoftUnsafeLocalFunction=__webpack_require__(81);var setTextContent=__webpack_require__(120);var ELEMENT_NODE_TYPE=1;var DOCUMENT_FRAGMENT_NODE_TYPE=11;var enableLazy=typeof document!=="undefined"&&typeof document.documentMode==="number"||typeof navigator!=="undefined"&&typeof navigator.userAgent==="string"&&/\bEdge\/\d/.test(navigator.userAgent);function insertTreeChildren(tree){if(!enableLazy){return}var node=tree.node;var children=tree.children;if(children.length){for(var i=0;i<children.length;i++){insertTreeBefore(node,children[i],null)}}else if(tree.html!=null){setInnerHTML(node,tree.html)}else if(tree.text!=null){setTextContent(node,tree.text)}}var insertTreeBefore=createMicrosoftUnsafeLocalFunction(function(parentNode,tree,referenceNode){if(tree.node.nodeType===DOCUMENT_FRAGMENT_NODE_TYPE||tree.node.nodeType===ELEMENT_NODE_TYPE&&tree.node.nodeName.toLowerCase()==="object"&&(tree.node.namespaceURI==null||tree.node.namespaceURI===DOMNamespaces.html)){insertTreeChildren(tree);parentNode.insertBefore(tree.node,referenceNode)}else{parentNode.insertBefore(tree.node,referenceNode);insertTreeChildren(tree)}});function replaceChildWithTree(oldNode,newTree){oldNode.parentNode.replaceChild(newTree.node,oldNode);insertTreeChildren(newTree)}function queueChild(parentTree,childTree){if(enableLazy){parentTree.children.push(childTree)}else{parentTree.node.appendChild(childTree.node)}}function queueHTML(tree,html){if(enableLazy){tree.html=html}else{setInnerHTML(tree.node,html)}}function queueText(tree,text){if(enableLazy){tree.text=text}else{setTextContent(tree.node,text)}}function toString(){return this.node.nodeName}function DOMLazyTree(node){return{node:node,children:[],html:null,text:null,toString:toString}}DOMLazyTree.insertTreeBefore=insertTreeBefore;DOMLazyTree.replaceChildWithTree=replaceChildWithTree;DOMLazyTree.queueChild=queueChild;DOMLazyTree.queueHTML=queueHTML;DOMLazyTree.queueText=queueText;module.exports=DOMLazyTree},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Expression;(function(Expression){function Apply(head,args){return args?{head:head,args:args}:{head:head}}Expression.Apply=Apply;function isArgumentsArray(e){return e instanceof Array}Expression.isArgumentsArray=isArgumentsArray;function isArgumentsMap(e){return!(e instanceof Array)}Expression.isArgumentsMap=isArgumentsMap;function isLiteral(e){return!isApply(e)}Expression.isLiteral=isLiteral;function isApply(e){return!!e&&!!e.head&&typeof e==="object"}Expression.isApply=isApply})(Expression||(Expression={}));exports.default=Expression},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var core_1=__webpack_require__(90);var structure_1=__webpack_require__(57);var helpers_1=__webpack_require__(56);var table={core:core_1.default,structure:structure_1.default};helpers_1.normalizeTable(table);exports.SymbolList=helpers_1.symbolList(table);exports.SymbolMap=function(){var map=Object.create(null);for(var _i=0,SymbolList_1=exports.SymbolList;_i<SymbolList_1.length;_i++){var s=SymbolList_1[_i];map[s.id]=s}return map}();exports.default=table},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var parser_1=__webpack_require__(166);var parser_2=__webpack_require__(167);var parser_3=__webpack_require__(170);var parser_4=__webpack_require__(172);var parser_5=__webpack_require__(173);exports.default={jmol:parser_1.default,json:parser_2.default,molQLscript:parser_3.default,pymol:parser_4.default,vmd:parser_5.default}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var symbol_1=__webpack_require__(24);var builder_1=__webpack_require__(6);var M=__webpack_require__(171);var symbol_table_1=__webpack_require__(34);var type_1=__webpack_require__(44);var Struct=__webpack_require__(57);var collections_1=__webpack_require__(8);function Alias(symbol){var aliases=[];for(var _i=1;_i<arguments.length;_i++){aliases[_i-1]=arguments[_i]}return{kind:"alias",aliases:aliases,symbol:symbol}}function Macro(symbol,translate){var aliases=[];for(var _i=2;_i<arguments.length;_i++){aliases[_i-2]=arguments[_i]}symbol.info.namespace="molql-macro";symbol.id="molql-macro."+symbol.info.name;return{kind:"macro",symbol:symbol,translate:translate,aliases:[symbol.info.name].concat(aliases)}}function isMolQLScriptSymbol(x){return x.kind==="alias"||x.kind==="macro"}exports.isMolQLScriptSymbol=isMolQLScriptSymbol;exports.SymbolTable=[["Core symbols",Alias(symbol_table_1.default.core.type.bool,"bool"),Alias(symbol_table_1.default.core.type.num,"num"),Alias(symbol_table_1.default.core.type.str,"str"),Alias(symbol_table_1.default.core.type.regex,"regex"),Alias(symbol_table_1.default.core.type.list,"list"),Alias(symbol_table_1.default.core.type.set,"set"),Alias(symbol_table_1.default.core.type.compositeKey,"composite-key"),Alias(symbol_table_1.default.core.logic.not,"not"),Alias(symbol_table_1.default.core.logic.and,"and"),Alias(symbol_table_1.default.core.logic.or,"or"),Alias(symbol_table_1.default.core.ctrl.if,"if"),Alias(symbol_table_1.default.core.ctrl.fn,"fn"),Alias(symbol_table_1.default.core.ctrl.eval,"eval"),Alias(symbol_table_1.default.core.math.add,"add","+"),Alias(symbol_table_1.default.core.math.sub,"sub","-"),Alias(symbol_table_1.default.core.math.mult,"mult","*"),Alias(symbol_table_1.default.core.math.div,"div","/"),Alias(symbol_table_1.default.core.math.pow,"pow","**"),Alias(symbol_table_1.default.core.math.mod,"mod"),Alias(symbol_table_1.default.core.math.min,"min"),Alias(symbol_table_1.default.core.math.max,"max"),Alias(symbol_table_1.default.core.math.floor,"floor"),Alias(symbol_table_1.default.core.math.ceil,"ceil"),Alias(symbol_table_1.default.core.math.roundInt,"round"),Alias(symbol_table_1.default.core.math.abs,"abs"),Alias(symbol_table_1.default.core.math.sqrt,"sqrt"),Alias(symbol_table_1.default.core.math.sin,"sin"),Alias(symbol_table_1.default.core.math.cos,"cos"),Alias(symbol_table_1.default.core.math.tan,"tan"),Alias(symbol_table_1.default.core.math.asin,"asin"),Alias(symbol_table_1.default.core.math.acos,"acos"),Alias(symbol_table_1.default.core.math.atan,"atan"),Alias(symbol_table_1.default.core.math.sinh,"sinh"),Alias(symbol_table_1.default.core.math.cosh,"cosh"),Alias(symbol_table_1.default.core.math.tanh,"tanh"),Alias(symbol_table_1.default.core.math.exp,"exp"),Alias(symbol_table_1.default.core.math.log,"log"),Alias(symbol_table_1.default.core.math.log10,"log10"),Alias(symbol_table_1.default.core.math.atan2,"atan2"),Alias(symbol_table_1.default.core.rel.eq,"eq","="),Alias(symbol_table_1.default.core.rel.neq,"neq","!="),Alias(symbol_table_1.default.core.rel.lt,"lt","<"),Alias(symbol_table_1.default.core.rel.lte,"lte","<="),Alias(symbol_table_1.default.core.rel.gr,"gr",">"),Alias(symbol_table_1.default.core.rel.gre,"gre",">="),Alias(symbol_table_1.default.core.rel.inRange,"in-range"),Alias(symbol_table_1.default.core.str.concat,"concat"),Alias(symbol_table_1.default.core.str.match,"regex.match"),Alias(symbol_table_1.default.core.list.getAt,"list.get"),Alias(symbol_table_1.default.core.set.has,"set.has"),Alias(symbol_table_1.default.core.set.isSubset,"set.subset")],["Structure",["Types",Alias(symbol_table_1.default.structure.type.entityType,"ent-type"),Alias(symbol_table_1.default.structure.type.authResidueId,"auth-resid"),Alias(symbol_table_1.default.structure.type.labelResidueId,"label-resid"),Alias(symbol_table_1.default.structure.type.ringFingerprint,"ringfp"),Alias(symbol_table_1.default.structure.type.bondFlags,"bond-flags")],["Slots",Alias(symbol_table_1.default.structure.slot.atomSetReduce,"atom.set.reduce.value")],["Generators",Alias(symbol_table_1.default.structure.generator.atomGroups,"sel.atom.atom-groups"),Alias(symbol_table_1.default.structure.generator.queryInSelection,"sel.atom.query-in-selection"),Alias(symbol_table_1.default.structure.generator.rings,"sel.atom.rings"),Alias(symbol_table_1.default.structure.generator.empty,"sel.atom.empty"),Macro(symbol_1.default("sel.atom.atoms",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test applied to each atom."})}),Struct.Types.AtomSelection,"A selection of singleton atom sets."),function(args){return builder_1.default.struct.generator.atomGroups({"atom-test":M.tryGetArg(args,0,true)})}),Macro(symbol_1.default("sel.atom.res",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test applied to the 1st atom of each residue."})}),Struct.Types.AtomSelection,"A selection of atom sets grouped by residue."),function(args){return builder_1.default.struct.generator.atomGroups({"residue-test":M.tryGetArg(args,0,true),"group-by":builder_1.default.ammp("residueKey")})}),Macro(symbol_1.default("sel.atom.chains",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test applied to the 1st atom of each chain."})}),Struct.Types.AtomSelection,"A selection of atom sets grouped by chain."),function(args){return builder_1.default.struct.generator.atomGroups({"chain-test":M.tryGetArg(args,0,true),"group-by":builder_1.default.ammp("chainKey")})})],["Modifiers",Alias(symbol_table_1.default.structure.modifier.queryEach,"sel.atom.query-each"),Alias(symbol_table_1.default.structure.modifier.intersectBy,"sel.atom.intersect-by"),Alias(symbol_table_1.default.structure.modifier.exceptBy,"sel.atom.except-by"),Alias(symbol_table_1.default.structure.modifier.unionBy,"sel.atom.union-by"),Alias(symbol_table_1.default.structure.modifier.union,"sel.atom.union"),Alias(symbol_table_1.default.structure.modifier.cluster,"sel.atom.cluster"),Alias(symbol_table_1.default.structure.modifier.includeSurroundings,"sel.atom.include-surroundings"),Alias(symbol_table_1.default.structure.modifier.includeConnected,"sel.atom.include-connected"),Alias(symbol_table_1.default.structure.modifier.expandProperty,"sel.atom.expand-property"),Macro(symbol_1.default("sel.atom.around",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test applied to the 1st atom of each chain."})}),Struct.Types.AtomSelection,'A selection of singleton atom sets with centers within "radius" of the center of any atom in the given selection.'),function(args){return builder_1.default.struct.modifier.exceptBy({0:builder_1.default.struct.filter.within({0:builder_1.default.struct.generator.atomGroups(),target:M.tryGetArg(args,0),"max-radius":M.tryGetArg(args,"radius")}),by:M.tryGetArg(args,0)})})],["Filters",Alias(symbol_table_1.default.structure.filter.pick,"sel.atom.pick"),Alias(symbol_table_1.default.structure.filter.withSameAtomProperties,"sel.atom.with-same-atom-properties"),Alias(symbol_table_1.default.structure.filter.intersectedBy,"sel.atom.intersected-by"),Alias(symbol_table_1.default.structure.filter.within,"sel.atom.within"),Alias(symbol_table_1.default.structure.filter.isConnectedTo,"sel.atom.is-connected-to")],["Combinators",Alias(symbol_table_1.default.structure.combinator.intersect,"sel.atom.intersect"),Alias(symbol_table_1.default.structure.combinator.merge,"sel.atom.merge"),Alias(symbol_table_1.default.structure.combinator.distanceCluster,"sel.atom.dist-cluster")],["Atom Set Properties",Alias(symbol_table_1.default.structure.atomSet.atomCount,"atom.set.atom-count"),Alias(symbol_table_1.default.structure.atomSet.countQuery,"atom.set.count-query"),Alias(symbol_table_1.default.structure.atomSet.reduce,"atom.set.reduce"),Alias(symbol_table_1.default.structure.atomSet.propertySet,"atom.set.property"),Macro(symbol_1.default("atom.set.max",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Num,{description:"Numeric atom property."})}),type_1.default.Num,"Maximum of the given property in the current atom set."),function(args){return M.aggregate(M.tryGetArg(args,0),builder_1.default.core.math.max)}),Macro(symbol_1.default("atom.set.sum",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Num,{description:"Numeric atom property."})}),type_1.default.Num,"Sum of the given property in the current atom set."),function(args){return M.aggregate(M.tryGetArg(args,0),builder_1.default.core.math.add,0)}),Macro(symbol_1.default("atom.set.avg",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Num,{description:"Numeric atom property."})}),type_1.default.Num,"Average of the given property in the current atom set."),function(args){return builder_1.default.core.math.div([M.aggregate(M.tryGetArg(args,0),builder_1.default.core.math.add,0),builder_1.default.struct.atomSet.atomCount()])}),Macro(symbol_1.default("atom.set.min",symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Num,{description:"Numeric atom property."})}),type_1.default.Num,"Minimum of the given property in the current atom set."),function(args){return M.aggregate(M.tryGetArg(args,0),builder_1.default.core.math.min)})],["Atom Properties",Alias(symbol_table_1.default.structure.atomProperty.core.elementSymbol,"atom.el"),Alias(symbol_table_1.default.structure.atomProperty.core.vdw,"atom.vdw"),Alias(symbol_table_1.default.structure.atomProperty.core.mass,"atom.mass"),Alias(symbol_table_1.default.structure.atomProperty.core.atomicNumber,"atom.atomic-number"),Alias(symbol_table_1.default.structure.atomProperty.core.x,"atom.x"),Alias(symbol_table_1.default.structure.atomProperty.core.y,"atom.y"),Alias(symbol_table_1.default.structure.atomProperty.core.z,"atom.z"),Alias(symbol_table_1.default.structure.atomProperty.core.atomKey,"atom.key"),Alias(symbol_table_1.default.structure.atomProperty.core.bondCount,"atom.bond-count"),Alias(symbol_table_1.default.structure.atomProperty.topology.connectedComponentKey,"atom.key.molecule"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.authResidueId,"atom.auth-resid"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.labelResidueId,"atom.label-resid"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.residueKey,"atom.key.res"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.chainKey,"atom.key.chain"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.entityKey,"atom.key.entity"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.isHet,"atom.is-het"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.id,"atom.id"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.label_atom_id,"atom.label_atom_id"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.label_alt_id,"atom.label_alt_id","atom.altloc"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.label_comp_id,"atom.label_comp_id"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.label_asym_id,"atom.label_asym_id"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.label_entity_id,"atom.label_entity_id"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.label_seq_id,"atom.label_seq_id"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.auth_atom_id,"atom.auth_atom_id","atom.name"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.auth_comp_id,"atom.auth_comp_id","atom.resname"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.auth_asym_id,"atom.auth_asym_id","atom.chain"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.auth_seq_id,"atom.auth_seq_id","atom.resno"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.pdbx_PDB_ins_code,"atom.pdbx_PDB_ins_code","atom.inscode"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.pdbx_formal_charge,"atom.pdbx_formal_charge"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.occupancy,"atom.occupancy"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.B_iso_or_equiv,"atom.B_iso_or_equiv","atom.bfactor"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.entityType,"atom.entity-type"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.secondaryStructureKey,"atom.key.sec-struct"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.isModified,"atom.is-modified"),Alias(symbol_table_1.default.structure.atomProperty.macromolecular.modifiedParentName,"atom.modified-parent"),Macro(symbol_1.default("atom.sec-struct.is",symbol_1.Arguments.List(Struct.Types.SecondaryStructureFlag),type_1.default.Bool,"Test if the current atom is part of an secondary structure. Optionally specify allowed sec. struct. types: "+type_1.default.oneOfValues(Struct.Types.SecondaryStructureFlag).join(", ")),function(args){return builder_1.default.core.flags.hasAny([builder_1.default.struct.atomProperty.macromolecular.secondaryStructureFlags(),builder_1.default.struct.type.secondaryStructureFlags(args)])})],["Bond Properties",Alias(symbol_table_1.default.structure.bondProperty.order,"bond.order"),Macro(symbol_1.default("bond.is",symbol_1.Arguments.List(Struct.Types.BondFlag),type_1.default.Bool,"Test if the current bond has at least one (or all if partial = false) of the specified flags: "+type_1.default.oneOfValues(Struct.Types.BondFlag).join(", ")),function(args){return builder_1.default.core.flags.hasAny([builder_1.default.struct.bondProperty.flags(),builder_1.default.struct.type.bondFlags(M.getPositionalArgs(args))])})]]];var list=[];function makeList(xs){for(var _i=0,xs_1=xs;_i<xs_1.length;_i++){var x=xs_1[_i];if(isMolQLScriptSymbol(x))list.push(x);else if(x instanceof Array)makeList(x)}}makeList(exports.SymbolTable);var normalized=function(){var symbolList=[];var symbolMap=Object.create(null);var namedArgs=collections_1.UniqueArrayBuilder();var constants=collections_1.UniqueArrayBuilder();for(var _i=0,list_1=list;_i<list_1.length;_i++){var s=list_1[_i];for(var _a=0,_b=s.aliases;_a<_b.length;_a++){var a=_b[_a];symbolList.push([a,s]);if(symbolMap[a])throw new Error("Alias '"+a+"' already in use.");symbolMap[a]=s}var args=s.symbol.args;if(args.kind!=="dictionary"){if(args.type.kind==="oneof"){type_1.default.oneOfValues(args.type).forEach(function(v){return collections_1.UniqueArrayBuilder.add(constants,v,v)})}continue}for(var _c=0,_d=Object.keys(args.map);_c<_d.length;_c++){var a=_d[_c];if(isNaN(a))collections_1.UniqueArrayBuilder.add(namedArgs,a,a);var arg=args.map[a];if(arg.type.kind==="oneof"){type_1.default.oneOfValues(arg.type).forEach(function(v){return collections_1.UniqueArrayBuilder.add(constants,v,v)})}}}return{symbolList:symbolList,symbolMap:symbolMap,namedArgs:namedArgs.array,constants:constants.array}}();exports.MolQLScriptSymbols=list;exports.Constants=normalized.constants;exports.NamedArgs=normalized.namedArgs;exports.SymbolMap=normalized.symbolMap;exports.SymbolList=normalized.symbolList;var sortedSymbols=exports.SymbolList.map(function(s){return s[0]}).sort(function(a,b){if(a.length===b.length)return a<b;return a.length-b.length});exports.default=sortedSymbols.concat(exports.NamedArgs.map(function(a){return":"+a}),exports.Constants)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var builder_1=__webpack_require__(6);var reFloat=/[-+]?[0-9]*\.?[0-9]+/;var rePosInt=/[+]?[0-9]+/;var reInt=/[-+]?[0-9]+/;function str(x){return x}exports.sstrucDict={T:"turn",E:"sheet",B:"strand",H:"alpha",G:"3-10",I:"pi",C:"none"};function sstrucMap(x){return builder_1.default.struct.type.secondaryStructureFlags([exports.sstrucDict[x.toUpperCase()]||"none"])}exports.sstrucMap=sstrucMap;var properties={name:{"@desc":"str    atom name","@examples":["name CA"],regex:/[a-zA-Z0-9]+/,map:builder_1.default.atomName,level:"atom-test",property:builder_1.default.ammp("label_atom_id")},type:{"@desc":"str    atom type","@examples":["type C3"],isUnsupported:true,regex:/[a-zA-Z0-9]+/,map:str,level:"atom-test"},index:{"@desc":"num    the atom number, starting at 0","@examples":["index 10"],isNumeric:true,regex:rePosInt,map:function(x){return parseInt(x)-1},level:"atom-test",property:builder_1.default.ammp("id")},serial:{"@desc":"num    the atom number, starting at 1","@examples":["serial 11"],isNumeric:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test",property:builder_1.default.ammp("id")},atomicnumber:{"@desc":"num    atomic number (0 if undefined)","@examples":["atomicnumber 13"],isNumeric:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test",property:builder_1.default.acp("atomicNumber")},element:{"@desc":'str  atomic element symbol string ("X" if undefined)',"@examples":["element N"],regex:/[a-zA-Z0-9]{1,3}/,map:function(x){return builder_1.default.es(x)},level:"atom-test",property:builder_1.default.acp("elementSymbol")},altloc:{"@desc":"str  alternate location/conformation identifier","@examples":["altloc C"],regex:/[a-zA-Z0-9]+/,map:str,level:"atom-test",property:builder_1.default.ammp("label_alt_id")},chain:{"@desc":"str  the one-character chain identifier","@examples":["chain A"],regex:/[a-zA-Z0-9]+/,map:str,level:"residue-test",property:builder_1.default.ammp("auth_asym_id")},residue:{"@desc":"num  a set of connected atoms with the same residue number","@examples":["residue < 11","residue 11"],isNumeric:true,regex:reInt,map:function(x){return parseInt(x)},level:"residue-test",property:builder_1.default.ammp("auth_seq_id")},fragment:{"@desc":"num  a set of connected residues","@examples":["fragment 42"],isUnsupported:true,isNumeric:true,regex:reInt,map:function(x){return parseInt(x)},level:"residue-test"},pfrag:{"@desc":"num  a set of connected protein residues","@examples":["pfrag 42"],isUnsupported:true,isNumeric:true,regex:reInt,map:function(x){return parseInt(x)},level:"residue-test"},nfrag:{"@desc":"num  a set of connected nucleic residues","@examples":["nfrag 42"],isUnsupported:true,isNumeric:true,regex:reInt,map:function(x){return parseInt(x)},level:"residue-test"},sequence:{"@desc":"str  a sequence given by one letter names","@examples":["sequence PGATTACA"],isUnsupported:true,regex:/[a-zA-Z0-9]+/,map:str,level:"residue-test"},numbonds:{"@desc":"num  number of bonds","@examples":["numbonds = 2","numbonds >= 3"],isNumeric:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test",property:builder_1.default.acp("bondCount")},resname:{"@desc":"str  residue name","@examples":["resname ALA"],regex:/[a-zA-Z0-9]+/,map:str,level:"residue-test",property:builder_1.default.ammp("auth_comp_id")},resid:{"@desc":"num  residue id","@examples":["resid 42"],isNumeric:true,regex:reInt,map:function(x){return parseInt(x)},level:"residue-test",property:builder_1.default.ammp("auth_seq_id")},segname:{"@desc":"str  segment name","@examples":["segname B"],regex:/[a-zA-Z0-9]+/,map:str,level:"residue-test",property:builder_1.default.ammp("label_asym_id")},x:{"@desc":"float  x coordinate","@examples":["x 42"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("x")},y:{"@desc":"float  y coordinate","@examples":["y > 1.7"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("y")},z:{"@desc":"float  z coordinate","@examples":["z < 11","z > -21"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("z")},radius:{"@desc":"float  atomic radius","@examples":["radius > 1.3"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("vdw")},mass:{"@desc":"float  atomic mass","@examples":["mass > 2"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("mass")},charge:{"@desc":"float  atomic charge","@examples":["charge > 0","charge 1"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("pdbx_formal_charge")},beta:{"@desc":"float  temperature factor","@examples":["beta < 20","beta > 35"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("B_iso_or_equiv")},occupancy:{"@desc":"float  occupancy","@examples":["occupancy 1","occupancy < 1"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("occupancy")},user:{"@desc":"float  time-varying user-specified value","@examples":["user < 0.1"],isUnsupported:true,isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test"},rasmol:{"@desc":"str  translates Rasmol selection string to VMD","@examples":["rasmol 'all'"],isUnsupported:true,regex:/[^']*/,map:str,level:"atom-test"},structure:{"@desc":"str  single letter name for the secondary structure","@examples":["structure H","structure H E"],regex:/T|E|B|H|G|I|C/i,map:sstrucMap,level:"atom-test",property:builder_1.default.ammp("secondaryStructureFlags")},phi:{"@desc":"float  phi backbone conformational angles","@examples":["phi < 160"],isUnsupported:true,isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"residue-test"},psi:{"@desc":"float  psi backbone conformational angles","@examples":["psi < 160"],isUnsupported:true,isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"residue-test"},ufx:{"@desc":"num  force to apply in the x coordinate","@examples":["ufx 1"],isUnsupported:true,isNumeric:true,regex:reFloat,map:function(x){return parseInt(x)},level:"atom-test"},ufy:{"@desc":"num  force to apply in the y coordinate","@examples":["ufy 1"],isUnsupported:true,isNumeric:true,regex:reFloat,map:function(x){return parseInt(x)},level:"atom-test"},ufz:{"@desc":"num  force to apply in the z coordinate","@examples":["ufz 1"],isUnsupported:true,isNumeric:true,regex:reFloat,map:function(x){return parseInt(x)},level:"atom-test"}};exports.default=properties},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(28)},function(module,exports,__webpack_require__){"use strict";(function(process){var EventPluginHub=__webpack_require__(40);var EventPluginUtils=__webpack_require__(74);var accumulateInto=__webpack_require__(112);var forEachAccumulated=__webpack_require__(113);var warning=__webpack_require__(2);var getListener=EventPluginHub.getListener;function listenerAtPhase(inst,event,propagationPhase){var registrationName=event.dispatchConfig.phasedRegistrationNames[propagationPhase];return getListener(inst,registrationName)}function accumulateDirectionalDispatches(inst,phase,event){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(inst,"Dispatching inst must not be null"):void 0}var listener=listenerAtPhase(inst,event,phase);if(listener){event._dispatchListeners=accumulateInto(event._dispatchListeners,listener);event._dispatchInstances=accumulateInto(event._dispatchInstances,inst)}}function accumulateTwoPhaseDispatchesSingle(event){if(event&&event.dispatchConfig.phasedRegistrationNames){EventPluginUtils.traverseTwoPhase(event._targetInst,accumulateDirectionalDispatches,event)}}function accumulateTwoPhaseDispatchesSingleSkipTarget(event){if(event&&event.dispatchConfig.phasedRegistrationNames){var targetInst=event._targetInst;var parentInst=targetInst?EventPluginUtils.getParentInstance(targetInst):null;EventPluginUtils.traverseTwoPhase(parentInst,accumulateDirectionalDispatches,event)}}function accumulateDispatches(inst,ignoredDirection,event){if(event&&event.dispatchConfig.registrationName){var registrationName=event.dispatchConfig.registrationName;var listener=getListener(inst,registrationName);if(listener){event._dispatchListeners=accumulateInto(event._dispatchListeners,listener);event._dispatchInstances=accumulateInto(event._dispatchInstances,inst)}}}function accumulateDirectDispatchesSingle(event){if(event&&event.dispatchConfig.registrationName){accumulateDispatches(event._targetInst,null,event)}}function accumulateTwoPhaseDispatches(events){forEachAccumulated(events,accumulateTwoPhaseDispatchesSingle)}function accumulateTwoPhaseDispatchesSkipTarget(events){forEachAccumulated(events,accumulateTwoPhaseDispatchesSingleSkipTarget)}function accumulateEnterLeaveDispatches(leave,enter,from,to){EventPluginUtils.traverseEnterLeave(from,to,accumulateDispatches,leave,enter)}function accumulateDirectDispatches(events){forEachAccumulated(events,accumulateDirectDispatchesSingle)}var EventPropagators={accumulateTwoPhaseDispatches:accumulateTwoPhaseDispatches,accumulateTwoPhaseDispatchesSkipTarget:accumulateTwoPhaseDispatchesSkipTarget,accumulateDirectDispatches:accumulateDirectDispatches,accumulateEnterLeaveDispatches:accumulateEnterLeaveDispatches};module.exports=EventPropagators}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var EventPluginRegistry=__webpack_require__(49);var EventPluginUtils=__webpack_require__(74);var ReactErrorUtils=__webpack_require__(75);var accumulateInto=__webpack_require__(112);var forEachAccumulated=__webpack_require__(113);var invariant=__webpack_require__(1);var listenerBank={};var eventQueue=null;var executeDispatchesAndRelease=function(event,simulated){if(event){EventPluginUtils.executeDispatchesInOrder(event,simulated);if(!event.isPersistent()){event.constructor.release(event)}}};var executeDispatchesAndReleaseSimulated=function(e){return executeDispatchesAndRelease(e,true)};var executeDispatchesAndReleaseTopLevel=function(e){return executeDispatchesAndRelease(e,false)};var getDictionaryKey=function(inst){return"."+inst._rootNodeID};function isInteractive(tag){return tag==="button"||tag==="input"||tag==="select"||tag==="textarea"}function shouldPreventMouseEvent(name,type,props){switch(name){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":return!!(props.disabled&&isInteractive(type));default:return false}}var EventPluginHub={injection:{injectEventPluginOrder:EventPluginRegistry.injectEventPluginOrder,injectEventPluginsByName:EventPluginRegistry.injectEventPluginsByName},putListener:function(inst,registrationName,listener){!(typeof listener==="function")?process.env.NODE_ENV!=="production"?invariant(false,"Expected %s listener to be a function, instead got type %s",registrationName,typeof listener):_prodInvariant("94",registrationName,typeof listener):void 0;var key=getDictionaryKey(inst);var bankForRegistrationName=listenerBank[registrationName]||(listenerBank[registrationName]={});bankForRegistrationName[key]=listener;var PluginModule=EventPluginRegistry.registrationNameModules[registrationName];if(PluginModule&&PluginModule.didPutListener){PluginModule.didPutListener(inst,registrationName,listener)}},getListener:function(inst,registrationName){var bankForRegistrationName=listenerBank[registrationName];if(shouldPreventMouseEvent(registrationName,inst._currentElement.type,inst._currentElement.props)){return null}var key=getDictionaryKey(inst);return bankForRegistrationName&&bankForRegistrationName[key]},deleteListener:function(inst,registrationName){var PluginModule=EventPluginRegistry.registrationNameModules[registrationName];if(PluginModule&&PluginModule.willDeleteListener){PluginModule.willDeleteListener(inst,registrationName)}var bankForRegistrationName=listenerBank[registrationName];if(bankForRegistrationName){var key=getDictionaryKey(inst);delete bankForRegistrationName[key]}},deleteAllListeners:function(inst){var key=getDictionaryKey(inst);for(var registrationName in listenerBank){if(!listenerBank.hasOwnProperty(registrationName)){continue}if(!listenerBank[registrationName][key]){continue}var PluginModule=EventPluginRegistry.registrationNameModules[registrationName];if(PluginModule&&PluginModule.willDeleteListener){PluginModule.willDeleteListener(inst,registrationName)}delete listenerBank[registrationName][key]}},extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var events;var plugins=EventPluginRegistry.plugins;for(var i=0;i<plugins.length;i++){var possiblePlugin=plugins[i];if(possiblePlugin){var extractedEvents=possiblePlugin.extractEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget);if(extractedEvents){events=accumulateInto(events,extractedEvents)}}}return events},enqueueEvents:function(events){if(events){eventQueue=accumulateInto(eventQueue,events)}},processEventQueue:function(simulated){var processingEventQueue=eventQueue;eventQueue=null;if(simulated){forEachAccumulated(processingEventQueue,executeDispatchesAndReleaseSimulated)}else{forEachAccumulated(processingEventQueue,executeDispatchesAndReleaseTopLevel)}!!eventQueue?process.env.NODE_ENV!=="production"?invariant(false,"processEventQueue(): Additional events were enqueued while processing an event queue. Support for this has not yet been implemented."):_prodInvariant("95"):void 0;ReactErrorUtils.rethrowCaughtError()},__purge:function(){listenerBank={}},__getListenerBank:function(){return listenerBank}};module.exports=EventPluginHub}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var SyntheticEvent=__webpack_require__(18);var getEventTarget=__webpack_require__(76);var UIEventInterface={view:function(event){if(event.view){return event.view}var target=getEventTarget(event);if(target.window===target){return target}var doc=target.ownerDocument;if(doc){return doc.defaultView||doc.parentWindow}else{return window}},detail:function(event){return event.detail||0}};function SyntheticUIEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticUIEvent,UIEventInterface);module.exports=SyntheticUIEvent},function(module,exports,__webpack_require__){"use strict";var ReactInstanceMap={remove:function(key){key._reactInternalInstance=undefined},get:function(key){return key._reactInternalInstance},has:function(key){return key._reactInternalInstance!==undefined},set:function(key,value){key._reactInternalInstance=value}};module.exports=ReactInstanceMap},function(module,exports,__webpack_require__){exports.__esModule=true;exports.default=__webpack_require__(142)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Type;(function(Type){function Variable(name,type,isConstraint){return{kind:"variable",name:name,type:type,isConstraint:isConstraint}}Type.Variable=Variable;function Value(namespace,name,parent){return{kind:"value",namespace:namespace,name:name,parent:parent}}Type.Value=Value;function Container(namespace,name,child,alias){return{kind:"container",namespace:namespace,name:name,child:child,alias:alias}}Type.Container=Container;function Union(types){return{kind:"union",types:types}}Type.Union=Union;function OneOf(namespace,name,type,values){var vals=Object.create(null);for(var _i=0,values_1=values;_i<values_1.length;_i++){var v=values_1[_i];vals[v]=true}return{kind:"oneof",namespace:namespace,name:name,type:type,values:vals}}Type.OneOf=OneOf;Type.Any={kind:"any"};Type.AnyValue={kind:"any-value"};Type.Num=Value("","Number");Type.Str=Value("","String");Type.Bool=OneOf("","Bool",Type.Str,["true","false"]);function oneOfValues(_a){var values=_a.values;return Object.keys(values).sort()}Type.oneOfValues=oneOfValues})(Type||(Type={}));exports.default=Type},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var mask_1=__webpack_require__(27);var atom_set_1=__webpack_require__(14);var atom_selection_1=__webpack_require__(19);function Context(model,mask){return{model:model,mask:mask,positions:model.positions,atom_site:model.data.atom_site}}(function(Context){function ofAtomSet(_a,atomSet){var model=_a.model;return Context(model,atom_set_1.default.getMask(atomSet))}Context.ofAtomSet=ofAtomSet;function ofAtomSelection(model,atomSelection){return Context(model,atom_selection_1.default.getMask(atomSelection))}Context.ofAtomSelection=ofAtomSelection;function ofModel(model){return Context(model,mask_1.default.always(model.atoms.count))}Context.ofModel=ofModel})(Context||(Context={}));exports.default=Context},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var builder_1=__webpack_require__(6);var reFloat=/[-+]?[0-9]*\.?[0-9]+/;var rePosInt=/[0-9]+/;function str(x){return x}var structureDict={none:"none",turn:"turn",sheet:"beta",helix:"helix",dna:"dna",rna:"rna",carbohydrate:"carbohydrate",helix310:"3-10",helixalpha:"alpha",helixpi:"pi",0:"none",1:"turn",2:"beta",3:"helix",4:"dna",5:"rna",6:"carbohydrate",7:"3-10",8:"alpha",9:"pi"};function structureMap(x){if(x.head&&x.head==="core.type.regex")x=x.args[0].replace(/^\^|\$$/g,"");x=structureDict[x.toLowerCase()]||"none";if(["dna","rna","carbohydrate"].indexOf(x)!==-1){return builder_1.default.struct.type.entityType(x)}else{return builder_1.default.struct.type.secondaryStructureFlags([x])}}exports.structureMap=structureMap;var properties={adpmax:{"@desc":"the maximum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test"},adpmin:{"@desc":"the minimum anisotropic displacement parameter for the selected atom","@examples":[""],isUnsupported:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test"},altloc:{"@desc":"PDB alternate location identifier","@examples":["altloc = A"],regex:/[a-zA-Z0-9]/,map:str,level:"atom-test",property:builder_1.default.ammp("label_alt_id")},altname:{"@desc":"an alternative name given to atoms by some file readers (for example, P2N)","@examples":[""],isUnsupported:true,regex:/[a-zA-Z0-9]/,map:str,level:"atom-test"},atomID:{"@desc":"special atom IDs for PDB atoms assigned by Jmol","@examples":[""],isUnsupported:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test"},atomIndex:{"@desc":"atom 0-based index; a unique number for each atom regardless of the number of models loaded","@examples":[""],isUnsupported:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test"},atomName:{"@desc":"atom name","@examples":["atomName = CA"],regex:/[a-zA-Z0-9]+/,map:function(v){return builder_1.default.atomName(v)},level:"atom-test",property:builder_1.default.ammp("label_atom_id")},atomno:{"@desc":'sequential number; you can use "@" instead of "atomno=" -- for example, select @33 or Var x = @33 or @35',"@examples":[""],isUnsupported:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test"},atomType:{"@desc":"atom type (mol2, AMBER files) or atom name (other file types)","@examples":["atomType = OH"],regex:/[a-zA-Z0-9]+/,map:function(v){return builder_1.default.atomName(v)},level:"atom-test",property:builder_1.default.ammp("label_atom_id")},atomX:{"@desc":"Cartesian X coordinate (or just X)","@examples":["x = 4.2"],abbr:["X"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("x")},atomY:{"@desc":"Cartesian Y coordinate (or just Y)","@examples":["y < 42"],abbr:["Y"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("y")},atomZ:{"@desc":"Cartesian Z coordinate (or just Z)","@examples":["Z > 10"],abbr:["Z"],isNumeric:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("z")},bondcount:{"@desc":"covalent bond count","@examples":["bondcount = 0"],isNumeric:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test",property:builder_1.default.acp("bondCount")},bondingRadius:{"@desc":"radius used for auto bonding; synonymous with ionic and ionicRadius","@examples":[""],abbr:["ionic","ionicRadius"],isUnsupported:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test"},cell:{"@desc":'crystallographic unit cell, expressed either in lattice integer notation (111-999) or as a coordinate in ijk space, where {1 1 1} is the same as 555. ANDing two cells, for example select cell=555 and cell=556, selects the atoms on the common face. (Note: in the specifc case of CELL, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},configuration:{"@desc":'Only in the context {configuration=n}, this option selects the set of atoms with either no ALTLOC specified or those atoms having this index into the array of altlocs within its model. So, for example, if the model has altloc "A" and "B", select configuration=1 is equivalent to select altloc="" or altloc="A", and print {configuration=2} is equivalent to print {altloc="" or altloc="B"}. Configuration 0 is "all atoms in a model having configurations", and an invalid configuration number gives no atoms. (Note: in the specifc case of CONFIGURATION, only "=" is allowed as a comparator.)',"@examples":[""],isUnsupported:true,regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test"},chain:{"@desc":'protein chain. For newer CIF files allowing multicharacter chain specifications, use quotations marks: select chain="AA". For these multicharacter desigations, case is not checked unless the CIF file has lower-case chain designations.',"@examples":["chain = A",'chain = "AA"'],regex:/[a-zA-Z0-9]+/,map:str,level:"chain-test",property:builder_1.default.ammp("auth_asym_id")},chainNo:{"@desc":'chain number; sequentially counted from 1 for each model; chainNo == 0 means"no chain" or PDB chain identifier indicated as a blank (Jmol 14.0).',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},color:{"@desc":"the atom color","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},covalentRadius:{"@desc":"covalent bonding radius, synonymous with covalent. Not used by Jmol, but could be used, for example, in {*}.spacefill={*}.covalentRadius.all.","@examples":[""],abbr:["covalent"],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},cs:{"@desc":"chemical shift calculated using computational results that include magnetic shielding tensors.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},element:{"@desc":'element symbol. The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted element symbol, "H", "He", "Li", etc. or atomic number. In all other contexts, the value is the element symbol. When the atom is a specific isotope, the string will contain the isotope number -- "13C", for example.',"@examples":["element=Fe"],regex:/[a-zA-Z]+/,map:function(x){return builder_1.default.es(x)},level:"atom-test",property:builder_1.default.acp("elementSymbol")},elemno:{"@desc":"atomic element number","@examples":["elemno=8"],regex:/[0-9\s{}-]+/,map:function(x){return parseInt(x)},level:"atom-test",property:builder_1.default.acp("atomicNumber")},eta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},theta:{"@desc":"Based on Carlos M. Duarte, Leven M. Wadley, and Anna Marie Pyle, RNA structure comparison, motif search and discovery using a reduced representation of RNA conformational space, Nucleic Acids Research, 2003, Vol. 31, No. 16 4755-4761. The parameter eta is the C4'[i-1]-P[i]-C4'[i]-P[i+1] dihedral angle; theta is the P[i]-C4'[i]-P[i+1]-C4'[i+1] dihedral angle. Both are measured on a 0-360 degree scale because they are commonly near 180 degrees. Using the commands plot PROPERTIES eta theta resno; select visible;wireframe only one can create these authors' \"RNA worm\" graph.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},file:{"@desc":"file number containing this atom","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},formalCharge:{"@desc":"formal charge","@examples":["formalCharge=1"],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("pdbx_formal_charge")},format:{"@desc":"format (label) of the atom.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fXyz:{"@desc":"fractional XYZ coordinates","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fX:{"@desc":"fractional X coordinate","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fY:{"@desc":"fractional Y coordinate","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fZ:{"@desc":"fractional Z coordinate","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fuxyz:{"@desc":"fractional XYZ coordinates in the unitcell coordinate system","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fux:{"@desc":"fractional X coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fuy:{"@desc":"fractional Y coordinate in the unitcell coordinate system","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},fuz:{"@desc":"fractional Z coordinate in the unit cell coordinate system","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},group:{"@desc":"3-letter residue code","@examples":["group = ALA"],regex:/[a-zA-Z0-9]{1,3}/,map:str,level:"residue-test",property:builder_1.default.ammp("label_comp_id")},group1:{"@desc":"single-letter residue code (amino acids only)","@examples":["group1 = G"],regex:/[a-zA-Z]/,map:str,level:"residue-test",property:builder_1.default.ammp("label_comp_id")},groupID:{"@desc":"group ID number: A unique ID for each amino acid or nucleic acid residue in a PDB file. 0  noGroup 1-5  ALA, ARG, ASN, ASP, CYS 6-10  GLN, GLU, GLY, HIS, ILE 11-15  LEU, LYS, MET, PHE, PRO 16-20  SER, THR, TRP, TYR, VAL 21-23  ASX, GLX, UNK 24-29  A, +A, G, +G, I, +I 30-35  C, +C, T, +T, U, +U Additional unique numbers are assigned arbitrarily by Jmol and cannot be used reproducibly.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},groupindex:{"@desc":"overall group index","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},hydrophobicity:{"@desc":"Aminoacid residue scale of hydrophobicity based on Rose, G. D., Geselowitz, A. R., Lesser, G. J., Lee, R. H., and Zehfus, M. H. (1985). Hydrophobicity of amino acid residues in globular proteins, Science, 229(4716):834-838.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},identify:{"@desc":"for a PDB/mmCIF file, a label such as [ILE]7^1:A.CD1%A/3 #47, which includes the group ([ILE]), residue number with optional insertion code (7^1), chain (:A), atom name (CD1), alternate location if present (%A), PDB model number (/3, for NMR models when one file is loaded; /file.model such as /2.3 if more than one file is loaded), and atom number (#47). For non-PDB data, the information is shorter -- for example, H15/2.1 #6, indicating atom name (H15), full file.model number (/2.1), and atom number (#6). If only a single model is loaded, %[identify] does not include the model number.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},insertion:{"@desc":"protein residue insertion code","@examples":["insertion=A"],regex:/[a-zA-Z0-9]/,map:str,level:"atom-test",property:builder_1.default.ammp("pdbx_PDB_ins_code")},label:{"@desc":"current atom label (same as format)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},mass:{"@desc":"atomic mass -- especially useful with appended .max or .sum","@examples":["mass > 13"],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("mass")},model:{"@desc":"model number","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},modelindex:{"@desc":"a unique number for each model, starting with 0 and spanning all models in all files","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},modO:{"@desc":"currently calculated occupancy from modulation (0 to 100; NaN if atom has no occupancy modulation)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},modXYZ:{"@desc":"currently calculated displacement modulation (for incommensurately modulated structures). Also modX, modY, modZ for individual components. For atoms without modultion, {xx}.modXYZ is -1 and {xx}.modX is NaN, and in a label %[modXYZ] and %[modX] are blank.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},molecule:{"@desc":"molecule number","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},monomer:{"@desc":"monomer number (group number) in a polymer (usually a chain), starting with 1, or 0 if not part of a biopolymer -- that is, not a connected carbohydrate, amino acid, or nucleic acid (Jmol 14.3.15)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},ms:{"@desc":"magnetic shielding calculated from file-loaded tensors.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},occupancy:{"@desc":'CIF file site occupancy. In SELECT command comparisons ("select occupancy < 90"), an integer n implies measurement on a 0-100 scale; also, in the context %[occupancy] or %q for a label, the reported number is a percentage. In all other cases, such as when %Q is used in a label or when a decimal number is used in a comparison, the scale is 0.0 - 1.0.',"@examples":["occupancy < 1"],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("occupancy")},partialCharge:{"@desc":"partial charge","@examples":[""],isUnsupported:true,regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test"},phi:{"@desc":"protein group PHI angle for atom's residue","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},polymer:{"@desc":"sequential polymer number in a model, starting with 1.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},polymerLength:{"@desc":"polymer length","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},property_xx:{"@desc":"a property created using the DATA command","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},psi:{"@desc":"protein group PSI angle for the atom's residue","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},radius:{"@desc":'currently displayed radius -- In SELECT command comparisons ("select radius=n"), integer n implies Rasmol units 1/250 Angstroms; in all other cases or when a decimal number is used, the units are Angstroms.',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},resno:{"@desc":"PDB residue number, not including insertion code (see also seqcode, below)","@examples":["resno = 100"],regex:/-?[0-9]+/,map:function(x){return parseInt(x)},level:"residue-test",property:builder_1.default.ammp("auth_seq_id")},selected:{"@desc":"1.0 if atom is selected; 0.0 if not","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},sequence:{"@desc":'PDB one-character sequence code, as a string of characters, with "?" indicated where single-character codes are not available',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},seqcode:{"@desc":'PDB residue number, including insertion code (for example, 234^2; "seqcode" option added in Jmol 14.3.16)',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},seqid:{"@desc":"(mmCIF only) the value from _atom_site.label_seq_id; a pointer to _entity_poly_seq.num in the ENTITY_POLY_SEQ category specifying the sequence of monomers in a polymer. Allowance is made for the possibility of microheterogeneity in a sample by allowing a given sequence number to be correlated with more than one monomer id. (Jmol 14.2.3)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},shape:{"@desc":'hybridization geometry such as "tetrahedral"',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},site:{"@desc":"crystallographic site number","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},spacefill:{"@desc":"currently displayed radius","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},straightness:{"@desc":'quaternion-derived straightness (second derivative of the quaternion describing the orientation of the residue. This quantity will have different values depending upon the setting of quaternionFrame as "A" (alpha-carbon/phosphorus atom only), "C" (alpha-carbon/pyrimidine or purine base based), "P" (carbonyl-carbon peptide plane/phosphorus tetrahedron based), or "N" (amide-nitrogen based). The default is alpha-carbon based, which corresponds closely to the following combination of Ramachandran angles involving three consecutive residues i-1, i, and i+1: -psii-1 - phii + psii + phii+1.',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},strucno:{"@desc":"a unique number for each helix, sheet, or turn in a model, starting with 1.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},structure:{"@desc":'The value of this parameter depends upon the context. Used with select structure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", or "carbohydrate" or a respective number 0-6. In the context {*}.structure, the return value is a number; in the context label %[structure], the return is one of the six keywords.',"@examples":['structure="helix"'],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|[0-6]/i,map:str,level:"residue-test",property:"structure"},substructure:{"@desc":'like structure, the value of this parameter depends upon the context. Used with select substructure=x, x can be either the quoted keyword "none", "turn", "sheet", "helix", "dna", "rna", "carbohydrate", "helix310", "helixalpha", or "helixpi", or the respective number 0-9. In the context {*}.substructure, the return value is a number; in the context label %[substructure], the return is one of the nine keywords.',"@examples":['substructure = "alphahelix"'],regex:/none|turn|sheet|helix|dna|rna|carbohydrate|helix310|helixalpha|helixpi|[0-9]/i,map:str,level:"residue-test",property:"structure"},surfacedistance:{"@desc":"A value related to the distance of an atom to a nominal molecular surface. 0 indicates at the surface. Positive numbers are minimum distances in Angstroms from the given atom to the surface.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},symop:{"@desc":'the first symmetry operation code that generated this atom by Jmol; an integer starting with 1. See also symmetry, below. This operator is only present if the file contains space group information and the file was loaded using the {i, j, k} option so as to generate symmetry-based atoms. To select only the original atoms prior to application of symmetry, you can either use "SYMOP=n", where n is the symmetry operator corresponding to "x,y,z", or you can specify instead simply "NOT symmetry" the way you might specify "NOT hydrogen". Note that atoms in special positions will have multiple operator matches. These atoms can be selected using the keyword SPECIALPOSITION. The special form select SYMOP=nijk selects a specific translation of atoms from the given crystallographic symmetry operation. Comparators <, <=, >, >=, and != can be used and only apply to the ijk part of the designation. The ijk are relative, not absolute. Thus, symop=2555 selects for atoms that have been transformed by symop=2 but not subjected to any further translation. select symop=1555 is identical to select not symmetry. All other ijk are relative to these selections for 555. If the model was loaded using load "filename.cif" {444 666 1}, where the 1 indicates that all symmetry-generated atoms are to be packed within cell 555 and then translated to fill the other 26 specified cells, then select symop=3555 is nearly the same as select symop=3 and cell=555. (The difference being that cell=555 selects for all atoms that are on any edge of the cell, while symop=3555 does not.) However, the situation is different if instead the model was loaded using load "filename.cif" {444 666 0}, where the 0 indicates that symmetry-generated atoms are to be placed exactly where their symmetry operator would put them (x,-y,z being different then from x, 1-y, z). In that case, select symop=3555 is for all atoms that have been generated using symmetry operation 3 but have not had any additional translations applied to the x,y,z expression found in the CIF file. If, for example, symmetry operation 3 is -x,-y,-z, then load "filename.cif" {444 666 0} will place an atom originally at {1/2, 1/2, 1/2} at positions {-1/2, -1/2, -1/2} (symop=3555) and {-3/2, -3/2, -3/2} (symop=3444) and 24 other sites.',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},symmetry:{"@desc":'as "symmetry" or in a label as lower-case "o" gives list of crystallographic symmetry operators generating this atom with lattice designations,such as 3555; upper-case "%O" in a label gives a list without the lattice designations. See also symop, above.',"@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},temperature:{"@desc":"yes  yes  temperature factor (B-factor)","@examples":["temperature >= 20"],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("B_iso_or_equiv")},unitXyz:{"@desc":"unit cell XYZ coordinates","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},uX:{"@desc":"unit cell X coordinate normalized to [0,1)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},uY:{"@desc":"unit cell Y coordinate normalized to [0,1)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},uZ:{"@desc":"unit cell Z coordinate normalized to [0,1)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},valence:{"@desc":"the valence of an atom (sum of bonds, where double bond counts as 2 and triple bond counts as 3","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},vanderwaals:{"@desc":"van der Waals radius","@examples":["vanderwaals >2"],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.acp("vdw")},vectorScale:{"@desc":"vibration vector scale","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},volume:{"@desc":"approximate van der Waals volume for this atom. Note, {*}.volume gives an average; use {*}.volume.sum to get total volume.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},vXyz:{"@desc":"vibration vector, or individual components as %vx %vy %vz. For atoms without vibration vectors, {xx}.vXyz is -1; in a label, %[vxyz] is blank.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},vX:{"@desc":"vibration vector X coordinate; for atoms without vibration vector, {xx}.vX is NaN (same for vY and vZ)","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},vY:{"@desc":"vibration vector Y coordinate","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},vZ:{"@desc":"vibration vector Z coordinate","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"},xyz:{"@desc":"Cartesian XYZ coordinates; select xyz > 1.0 selects atoms more than one Angstrom from the origin.","@examples":[""],isUnsupported:true,regex:/[0-9\s{}-]+/,map:str,level:"atom-test"}};exports.default=properties},function(module,exports,__webpack_require__){"use strict";(function(process){var canDefineProperty=false;if(process.env.NODE_ENV!=="production"){try{Object.defineProperty({},"x",{get:function(){}});canDefineProperty=true}catch(x){}}module.exports=canDefineProperty}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var emptyObject={};if(process.env.NODE_ENV!=="production"){Object.freeze(emptyObject)}module.exports=emptyObject}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);var eventPluginOrder=null;var namesToPlugins={};function recomputePluginOrdering(){if(!eventPluginOrder){return}for(var pluginName in namesToPlugins){var pluginModule=namesToPlugins[pluginName];var pluginIndex=eventPluginOrder.indexOf(pluginName);!(pluginIndex>-1)?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginRegistry: Cannot inject event plugins that do not exist in the plugin ordering, `%s`.",pluginName):_prodInvariant("96",pluginName):void 0;if(EventPluginRegistry.plugins[pluginIndex]){continue}!pluginModule.extractEvents?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginRegistry: Event plugins must implement an `extractEvents` method, but `%s` does not.",pluginName):_prodInvariant("97",pluginName):void 0;EventPluginRegistry.plugins[pluginIndex]=pluginModule;var publishedEvents=pluginModule.eventTypes;for(var eventName in publishedEvents){!publishEventForPlugin(publishedEvents[eventName],pluginModule,eventName)?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginRegistry: Failed to publish event `%s` for plugin `%s`.",eventName,pluginName):_prodInvariant("98",eventName,pluginName):void 0}}}function publishEventForPlugin(dispatchConfig,pluginModule,eventName){!!EventPluginRegistry.eventNameDispatchConfigs.hasOwnProperty(eventName)?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginHub: More than one plugin attempted to publish the same event name, `%s`.",eventName):_prodInvariant("99",eventName):void 0;EventPluginRegistry.eventNameDispatchConfigs[eventName]=dispatchConfig;var phasedRegistrationNames=dispatchConfig.phasedRegistrationNames;if(phasedRegistrationNames){for(var phaseName in phasedRegistrationNames){if(phasedRegistrationNames.hasOwnProperty(phaseName)){var phasedRegistrationName=phasedRegistrationNames[phaseName];publishRegistrationName(phasedRegistrationName,pluginModule,eventName)}}return true}else if(dispatchConfig.registrationName){publishRegistrationName(dispatchConfig.registrationName,pluginModule,eventName);return true}return false}function publishRegistrationName(registrationName,pluginModule,eventName){!!EventPluginRegistry.registrationNameModules[registrationName]?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginHub: More than one plugin attempted to publish the same registration name, `%s`.",registrationName):_prodInvariant("100",registrationName):void 0;EventPluginRegistry.registrationNameModules[registrationName]=pluginModule;EventPluginRegistry.registrationNameDependencies[registrationName]=pluginModule.eventTypes[eventName].dependencies;if(process.env.NODE_ENV!=="production"){var lowerCasedName=registrationName.toLowerCase();EventPluginRegistry.possibleRegistrationNames[lowerCasedName]=registrationName;if(registrationName==="onDoubleClick"){EventPluginRegistry.possibleRegistrationNames.ondblclick=registrationName}}}var EventPluginRegistry={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},possibleRegistrationNames:process.env.NODE_ENV!=="production"?{}:null,injectEventPluginOrder:function(injectedEventPluginOrder){!!eventPluginOrder?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginRegistry: Cannot inject event plugin ordering more than once. You are likely trying to load more than one copy of React."):_prodInvariant("101"):void 0;eventPluginOrder=Array.prototype.slice.call(injectedEventPluginOrder);recomputePluginOrdering()},injectEventPluginsByName:function(injectedNamesToPlugins){var isOrderingDirty=false;for(var pluginName in injectedNamesToPlugins){if(!injectedNamesToPlugins.hasOwnProperty(pluginName)){continue}var pluginModule=injectedNamesToPlugins[pluginName];if(!namesToPlugins.hasOwnProperty(pluginName)||namesToPlugins[pluginName]!==pluginModule){!!namesToPlugins[pluginName]?process.env.NODE_ENV!=="production"?invariant(false,"EventPluginRegistry: Cannot inject two different event plugins using the same name, `%s`.",pluginName):_prodInvariant("102",pluginName):void 0;namesToPlugins[pluginName]=pluginModule;isOrderingDirty=true}}if(isOrderingDirty){recomputePluginOrdering()}},getPluginModuleForEvent:function(event){var dispatchConfig=event.dispatchConfig;if(dispatchConfig.registrationName){return EventPluginRegistry.registrationNameModules[dispatchConfig.registrationName]||null}if(dispatchConfig.phasedRegistrationNames!==undefined){var phasedRegistrationNames=dispatchConfig.phasedRegistrationNames;for(var phase in phasedRegistrationNames){if(!phasedRegistrationNames.hasOwnProperty(phase)){continue}var pluginModule=EventPluginRegistry.registrationNameModules[phasedRegistrationNames[phase]];if(pluginModule){return pluginModule}}}return null},_resetEventPlugins:function(){eventPluginOrder=null;for(var pluginName in namesToPlugins){if(namesToPlugins.hasOwnProperty(pluginName)){delete namesToPlugins[pluginName]}}EventPluginRegistry.plugins.length=0;var eventNameDispatchConfigs=EventPluginRegistry.eventNameDispatchConfigs;for(var eventName in eventNameDispatchConfigs){if(eventNameDispatchConfigs.hasOwnProperty(eventName)){delete eventNameDispatchConfigs[eventName]}}var registrationNameModules=EventPluginRegistry.registrationNameModules;for(var registrationName in registrationNameModules){if(registrationNameModules.hasOwnProperty(registrationName)){delete registrationNameModules[registrationName]}}if(process.env.NODE_ENV!=="production"){var possibleRegistrationNames=EventPluginRegistry.possibleRegistrationNames;for(var lowerCasedName in possibleRegistrationNames){if(possibleRegistrationNames.hasOwnProperty(lowerCasedName)){delete possibleRegistrationNames[lowerCasedName]}}}}};module.exports=EventPluginRegistry}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);var OBSERVED_ERROR={};var TransactionImpl={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers();if(this.wrapperInitData){this.wrapperInitData.length=0}else{this.wrapperInitData=[]}this._isInTransaction=false},_isInTransaction:false,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(method,scope,a,b,c,d,e,f){!!this.isInTransaction()?process.env.NODE_ENV!=="production"?invariant(false,"Transaction.perform(...): Cannot initialize a transaction when there is already an outstanding transaction."):_prodInvariant("27"):void 0;var errorThrown;var ret;try{this._isInTransaction=true;errorThrown=true;this.initializeAll(0);ret=method.call(scope,a,b,c,d,e,f);errorThrown=false}finally{try{if(errorThrown){try{this.closeAll(0)}catch(err){}}else{this.closeAll(0)}}finally{this._isInTransaction=false}}return ret},initializeAll:function(startIndex){var transactionWrappers=this.transactionWrappers;for(var i=startIndex;i<transactionWrappers.length;i++){var wrapper=transactionWrappers[i];try{this.wrapperInitData[i]=OBSERVED_ERROR;this.wrapperInitData[i]=wrapper.initialize?wrapper.initialize.call(this):null}finally{if(this.wrapperInitData[i]===OBSERVED_ERROR){try{this.initializeAll(i+1)}catch(err){}}}}},closeAll:function(startIndex){!this.isInTransaction()?process.env.NODE_ENV!=="production"?invariant(false,"Transaction.closeAll(): Cannot close transaction when none are open."):_prodInvariant("28"):void 0;var transactionWrappers=this.transactionWrappers;for(var i=startIndex;i<transactionWrappers.length;i++){var wrapper=transactionWrappers[i];var initData=this.wrapperInitData[i];var errorThrown;try{errorThrown=true;if(initData!==OBSERVED_ERROR&&wrapper.close){wrapper.close.call(this,initData)}errorThrown=false}finally{if(errorThrown){try{this.closeAll(i+1)}catch(e){}}}}this.wrapperInitData.length=0}};module.exports=TransactionImpl}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var SyntheticUIEvent=__webpack_require__(41);var ViewportMetrics=__webpack_require__(119);var getEventModifierState=__webpack_require__(78);var MouseEventInterface={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:getEventModifierState,button:function(event){var button=event.button;if("which"in event){return button}return button===2?2:button===4?1:0},buttons:null,relatedTarget:function(event){return event.relatedTarget||(event.fromElement===event.srcElement?event.toElement:event.fromElement)},pageX:function(event){return"pageX"in event?event.pageX:event.clientX+ViewportMetrics.currentScrollLeft},pageY:function(event){return"pageY"in event?event.pageY:event.clientY+ViewportMetrics.currentScrollTop}};function SyntheticMouseEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticMouseEvent,MouseEventInterface);module.exports=SyntheticMouseEvent},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);var DOMNamespaces=__webpack_require__(80);var WHITESPACE_TEST=/^[ \r\n\t\f]/;var NONVISIBLE_TEST=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/;var createMicrosoftUnsafeLocalFunction=__webpack_require__(81);var reusableSVGContainer;var setInnerHTML=createMicrosoftUnsafeLocalFunction(function(node,html){if(node.namespaceURI===DOMNamespaces.svg&&!("innerHTML"in node)){reusableSVGContainer=reusableSVGContainer||document.createElement("div");reusableSVGContainer.innerHTML="<svg>"+html+"</svg>";var svgNode=reusableSVGContainer.firstChild;while(svgNode.firstChild){node.appendChild(svgNode.firstChild)}}else{node.innerHTML=html}});if(ExecutionEnvironment.canUseDOM){var testElement=document.createElement("div");testElement.innerHTML=" ";if(testElement.innerHTML===""){setInnerHTML=function(node,html){if(node.parentNode){node.parentNode.replaceChild(node,node)}if(WHITESPACE_TEST.test(html)||html[0]==="<"&&NONVISIBLE_TEST.test(html)){node.innerHTML=String.fromCharCode(65279)+html;var textNode=node.firstChild;if(textNode.data.length===1){node.removeChild(textNode)}else{textNode.deleteData(0,1)}}else{node.innerHTML=html}}}testElement=null}module.exports=setInnerHTML},function(module,exports,__webpack_require__){"use strict";var matchHtmlRegExp=/["'&<>]/;function escapeHtml(string){var str=""+string;var match=matchHtmlRegExp.exec(str);if(!match){return str}var escape;var html="";var index=0;var lastIndex=0;for(index=match.index;index<str.length;index++){switch(str.charCodeAt(index)){case 34:escape="&quot;";break;case 38:escape="&amp;";break;case 39:escape="&#x27;";break;case 60:escape="&lt;";break;case 62:escape="&gt;";break;default:continue}if(lastIndex!==index){html+=str.substring(lastIndex,index)}lastIndex=index+1;html+=escape}return lastIndex!==index?html+str.substring(lastIndex,index):html}function escapeTextContentForBrowser(text){if(typeof text==="boolean"||typeof text==="number"){return""+text}return escapeHtml(text)}module.exports=escapeTextContentForBrowser},function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(4);var EventPluginRegistry=__webpack_require__(49);var ReactEventEmitterMixin=__webpack_require__(272);var ViewportMetrics=__webpack_require__(119);var getVendorPrefixedEventName=__webpack_require__(273);var isEventSupported=__webpack_require__(77);var hasEventPageXY;var alreadyListeningTo={};var isMonitoringScrollValue=false;var reactTopListenersCounter=0;var topEventMapping={topAbort:"abort",topAnimationEnd:getVendorPrefixedEventName("animationend")||"animationend",topAnimationIteration:getVendorPrefixedEventName("animationiteration")||"animationiteration",topAnimationStart:getVendorPrefixedEventName("animationstart")||"animationstart",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topTransitionEnd:getVendorPrefixedEventName("transitionend")||"transitionend",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"};var topListenersIDKey="_reactListenersID"+String(Math.random()).slice(2);function getListeningForDocument(mountAt){if(!Object.prototype.hasOwnProperty.call(mountAt,topListenersIDKey)){mountAt[topListenersIDKey]=reactTopListenersCounter++;alreadyListeningTo[mountAt[topListenersIDKey]]={}}return alreadyListeningTo[mountAt[topListenersIDKey]]}var ReactBrowserEventEmitter=_assign({},ReactEventEmitterMixin,{ReactEventListener:null,injection:{injectReactEventListener:function(ReactEventListener){ReactEventListener.setHandleTopLevel(ReactBrowserEventEmitter.handleTopLevel);ReactBrowserEventEmitter.ReactEventListener=ReactEventListener}},setEnabled:function(enabled){if(ReactBrowserEventEmitter.ReactEventListener){ReactBrowserEventEmitter.ReactEventListener.setEnabled(enabled)}},isEnabled:function(){return!!(ReactBrowserEventEmitter.ReactEventListener&&ReactBrowserEventEmitter.ReactEventListener.isEnabled())},listenTo:function(registrationName,contentDocumentHandle){var mountAt=contentDocumentHandle;var isListening=getListeningForDocument(mountAt);var dependencies=EventPluginRegistry.registrationNameDependencies[registrationName];for(var i=0;i<dependencies.length;i++){var dependency=dependencies[i];if(!(isListening.hasOwnProperty(dependency)&&isListening[dependency])){if(dependency==="topWheel"){if(isEventSupported("wheel")){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topWheel","wheel",mountAt)}else if(isEventSupported("mousewheel")){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topWheel","mousewheel",mountAt)}else{ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topWheel","DOMMouseScroll",mountAt)}}else if(dependency==="topScroll"){if(isEventSupported("scroll",true)){ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent("topScroll","scroll",mountAt)}else{ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topScroll","scroll",ReactBrowserEventEmitter.ReactEventListener.WINDOW_HANDLE)}}else if(dependency==="topFocus"||dependency==="topBlur"){if(isEventSupported("focus",true)){ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent("topFocus","focus",mountAt);ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent("topBlur","blur",mountAt)}else if(isEventSupported("focusin")){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topFocus","focusin",mountAt);ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent("topBlur","focusout",mountAt)}isListening.topBlur=true;isListening.topFocus=true}else if(topEventMapping.hasOwnProperty(dependency)){ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(dependency,topEventMapping[dependency],mountAt)}isListening[dependency]=true}}},trapBubbledEvent:function(topLevelType,handlerBaseName,handle){return ReactBrowserEventEmitter.ReactEventListener.trapBubbledEvent(topLevelType,handlerBaseName,handle)},trapCapturedEvent:function(topLevelType,handlerBaseName,handle){return ReactBrowserEventEmitter.ReactEventListener.trapCapturedEvent(topLevelType,handlerBaseName,handle)},supportsEventPageXY:function(){if(!document.createEvent){return false}var ev=document.createEvent("MouseEvent");return ev!=null&&"pageX"in ev},ensureScrollValueMonitoring:function(){if(hasEventPageXY===undefined){hasEventPageXY=ReactBrowserEventEmitter.supportsEventPageXY()}if(!hasEventPageXY&&!isMonitoringScrollValue){var refresh=ViewportMetrics.refreshScrollValues;ReactBrowserEventEmitter.ReactEventListener.monitorScrollValue(refresh);isMonitoringScrollValue=true}}});module.exports=ReactBrowserEventEmitter},function(module,exports,__webpack_require__){exports.__esModule=true;exports.default=__webpack_require__(138)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var symbol_1=__webpack_require__(24);function symbol(args,type,description){return symbol_1.default("",args,type,description)}exports.symbol=symbol;function normalizeTable(table){_normalizeTable("","",table)}exports.normalizeTable=normalizeTable;function symbolList(table){var list=[];_symbolList(table,list);return list}exports.symbolList=symbolList;function formatKey(key){var regex=/([a-z])([A-Z])([a-z]|$)/g;return key.replace(regex,function(s,a,b,c){return a+"-"+b.toLocaleLowerCase()+c}).replace(regex,function(s,a,b,c){return a+"-"+b.toLocaleLowerCase()+c})}function _normalizeTable(namespace,key,obj){if(symbol_1.isSymbol(obj)){obj.info.namespace=namespace;obj.info.name=obj.info.name||formatKey(key);obj.id=obj.info.namespace+"."+obj.info.name;return}var currentNs=""+(obj["@namespace"]||formatKey(key));var newNs=namespace?namespace+"."+currentNs:currentNs;for(var _i=0,_a=Object.keys(obj);_i<_a.length;_i++){var childKey=_a[_i];if(typeof obj[childKey]!=="object"&&!symbol_1.isSymbol(obj[childKey]))continue;_normalizeTable(newNs,childKey,obj[childKey])}}function _symbolList(obj,list){if(symbol_1.isSymbol(obj)){list.push(obj);return}for(var _i=0,_a=Object.keys(obj);_i<_a.length;_i++){var childKey=_a[_i];if(typeof obj[childKey]!=="object"&&!symbol_1.isSymbol(obj[childKey]))continue;_symbolList(obj[childKey],list)}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var type_1=__webpack_require__(44);var Core=__webpack_require__(90);var symbol_1=__webpack_require__(24);var helpers_1=__webpack_require__(56);var Types;(function(Types){Types.ElementSymbol=type_1.default.Value("Structure","ElementSymbol");Types.AtomName=type_1.default.Value("Structure","AtomName");Types.BondFlag=type_1.default.OneOf("Structure","BondFlag",type_1.default.Str,["covalent","metallic","ion","hydrogen","sulfide","computed","aromatic"]);Types.BondFlags=Core.Types.Flags(Types.BondFlag,"BondFlags");Types.SecondaryStructureFlag=type_1.default.OneOf("Structure","SecondaryStructureFlag",type_1.default.Str,["alpha","beta","3-10","pi","sheet","strand","helix","turn","none"]);Types.SecondaryStructureFlags=Core.Types.Flags(Types.SecondaryStructureFlag,"SecondaryStructureFlag");Types.RingFingerprint=type_1.default.Value("Structure","RingFingerprint");Types.EntityType=type_1.default.OneOf("Structure","EntityType",type_1.default.Str,["polymer","non-polymer","water","unknown"]);Types.ResidueId=type_1.default.Value("Structure","ResidueId");Types.AtomSet=type_1.default.Value("Structure","AtomSet");Types.AtomSelection=type_1.default.Value("Structure","AtomSelection");Types.AtomReference=type_1.default.Value("Structure","AtomReference");Types.AtomSelectionQuery=Core.Types.Fn(Types.AtomSelection,"AtomSelectionQuery")})(Types=exports.Types||(exports.Types={}));var type={"@header":"Types",elementSymbol:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Str)}),Types.ElementSymbol,"Create element symbol representation from a string value."),atomName:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.AnyValue)}),Types.AtomName,"Convert a value to an atom name."),entityType:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.EntityType)}),Types.EntityType,"Create normalized representation of entity type: "+type_1.default.oneOfValues(Types.EntityType).join(", ")+"."),bondFlags:helpers_1.symbol(symbol_1.Arguments.List(Types.BondFlag),Types.BondFlags,"Create bond flags representation from a list of strings. Allowed flags: "+type_1.default.oneOfValues(Types.BondFlag).join(", ")+"."),ringFingerprint:helpers_1.symbol(symbol_1.Arguments.List(Types.ElementSymbol,{nonEmpty:true}),Types.RingFingerprint,"Create ring fingerprint from the supplied atom element list."),secondaryStructureFlags:helpers_1.symbol(symbol_1.Arguments.List(Types.SecondaryStructureFlag),Types.SecondaryStructureFlags,"Create secondary structure flags representation from a list of strings. Allowed flags: "+type_1.default.oneOfValues(Types.SecondaryStructureFlag).join(", ")+"."),authResidueId:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Str,{description:"auth_asym_id"}),1:symbol_1.Argument(type_1.default.Num,{description:"auth_seq_id"}),2:symbol_1.Argument(type_1.default.Str,{description:"pdbx_PDB_ins_code",isOptional:true})}),Types.ResidueId,'Residue identifier based on "auth_" annotation.'),labelResidueId:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Str,{description:"label_entity_id"}),1:symbol_1.Argument(type_1.default.Str,{description:"label_asym_id"}),2:symbol_1.Argument(type_1.default.Num,{description:"label_seq_id"}),3:symbol_1.Argument(type_1.default.Str,{description:"pdbx_PDB_ins_code",isOptional:true})}),Types.ResidueId,'Residue identifier based on mmCIF\'s "label_" annotation.')};var slot={"@header":"Iteration Slots",atom:helpers_1.symbol(symbol_1.Arguments.None,Types.AtomReference,"A reference to the current atom."),atomSetReduce:helpers_1.symbol(symbol_1.Arguments.None,type_1.default.Variable("a",type_1.default.AnyValue,true),"Current value of the atom set reducer.")};var generator={"@header":"Generators",atomGroups:helpers_1.symbol(symbol_1.Arguments.Dictionary({"entity-test":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test for the 1st atom of every entity"}),"chain-test":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test for the 1st atom of every chain"}),"residue-test":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"Test for the 1st atom every residue"}),"atom-test":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true}),"group-by":symbol_1.Argument(type_1.default.Any,{isOptional:true,defaultValue:"atom-key",description:"Group atoms to sets based on this property. Default: each atom has its own set"})}),Types.AtomSelectionQuery,"Return all atoms for which the tests are satisfied, grouped into sets."),rings:helpers_1.symbol(symbol_1.Arguments.List(Types.RingFingerprint),Types.AtomSelectionQuery,"Return rings with the specified fingerprint(s). If no fingerprints are given, return all rings."),queryInSelection:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),query:symbol_1.Argument(Types.AtomSelectionQuery),"in-complement":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:false})}),Types.AtomSelectionQuery,"Executes query only on atoms that are in the source selection."),empty:helpers_1.symbol(symbol_1.Arguments.None,Types.AtomSelectionQuery,"Nada.")};var modifier={"@header":"Selection Modifications",queryEach:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),query:symbol_1.Argument(Types.AtomSelectionQuery)}),Types.AtomSelectionQuery,"Query every atom set in the input selection separately."),intersectBy:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),by:symbol_1.Argument(Types.AtomSelectionQuery)}),Types.AtomSelectionQuery,"Intersect each atom set from the first sequence from atoms in the second one."),exceptBy:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),by:symbol_1.Argument(Types.AtomSelectionQuery)}),Types.AtomSelectionQuery,"Remove all atoms from 'selection' that occur in 'by'."),unionBy:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),by:symbol_1.Argument(Types.AtomSelectionQuery)}),Types.AtomSelectionQuery,"For each atom set A in the orginal sequence, combine all atoms sets in the target selection that intersect with A."),union:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery)}),Types.AtomSelectionQuery,"Collects all atom sets in the sequence into a single atom set."),cluster:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),"min-distance":symbol_1.Argument(type_1.default.Num,{isOptional:true,defaultValue:0}),"max-distance":symbol_1.Argument(type_1.default.Num),"min-size":symbol_1.Argument(type_1.default.Num,{description:"Minimal number of sets to merge, must be at least 2",isOptional:true,defaultValue:2}),"max-size":symbol_1.Argument(type_1.default.Num,{description:"Maximal number of sets to merge, if not set, no limit",isOptional:true})}),Types.AtomSelectionQuery,"Combines atom sets that have mutual distance in the interval [min-radius, max-radius]. Minimum/maximum size determines how many atom sets can be combined."),includeSurroundings:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),radius:symbol_1.Argument(type_1.default.Num),"atom-radius":symbol_1.Argument(type_1.default.Num,{isOptional:true,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),"as-whole-residues":symbol_1.Argument(type_1.default.Bool,{isOptional:true})}),Types.AtomSelectionQuery,"For each atom set in the selection, include all surrouding atoms/residues that are within the specified radius."),includeConnected:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),"bond-test":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:"true for covalent bonds"}),"layer-count":symbol_1.Argument(type_1.default.Num,{isOptional:true,defaultValue:1,description:"Number of bonded layers to include."}),"as-whole-residues":symbol_1.Argument(type_1.default.Bool,{isOptional:true})}),Types.AtomSelectionQuery,"Pick all atom sets that are connected to the target."),expandProperty:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),property:symbol_1.Argument(type_1.default.AnyValue)}),Types.AtomSelectionQuery,"To each atom set in the selection, add all atoms that have the same property value that was already present in the set.")};var filter={"@header":"Selection Filters",pick:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),test:symbol_1.Argument(type_1.default.Bool)}),Types.AtomSelectionQuery,"Pick all atom sets that satisfy the test."),withSameAtomProperties:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),source:symbol_1.Argument(Types.AtomSelectionQuery),property:symbol_1.Argument(type_1.default.Any)}),Types.AtomSelectionQuery,"Pick all atom sets for which the set of given atom properties is a subset of the source properties."),intersectedBy:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),by:symbol_1.Argument(Types.AtomSelectionQuery)}),Types.AtomSelectionQuery,"Pick all atom sets that have non-zero intersection with the target."),within:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),target:symbol_1.Argument(Types.AtomSelectionQuery),"min-radius":symbol_1.Argument(type_1.default.Num,{isOptional:true,defaultValue:0}),"max-radius":symbol_1.Argument(type_1.default.Num),"atom-radius":symbol_1.Argument(type_1.default.Num,{isOptional:true,defaultValue:0,description:"Value added to each atom before the distance check, for example VDW radius. Using this argument is computationally demanding."}),invert:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:false,description:"If true, pick only atom sets that are further than the specified radius."})}),Types.AtomSelectionQuery,"Pick all atom sets from selection that have any atom within the radius of any atom from target."),isConnectedTo:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery),target:symbol_1.Argument(Types.AtomSelectionQuery),"bond-test":symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:"true for covalent bonds"}),disjunct:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:true,description:"If true, there must exist a bond to an atom that lies outside the given atom set to pass test."}),invert:symbol_1.Argument(type_1.default.Bool,{isOptional:true,defaultValue:false,description:"If true, return atom sets that are not connected."})}),Types.AtomSelectionQuery,"Pick all atom sets that are connected to the target.")};var combinator={"@header":"Selection Combinators",intersect:helpers_1.symbol(symbol_1.Arguments.List(Types.AtomSelectionQuery),Types.AtomSelectionQuery,"Return all unique atom sets that appear in all of the source selections."),merge:helpers_1.symbol(symbol_1.Arguments.List(Types.AtomSelectionQuery),Types.AtomSelectionQuery,"Merges multiple selections into a single one. Only unique atom sets are kept."),distanceCluster:helpers_1.symbol(symbol_1.Arguments.Dictionary({matrix:symbol_1.Argument(Core.Types.List(Core.Types.List(type_1.default.Num)),{description:"Distance matrix, represented as list of rows (num[][])). Lower triangle is min distance, upper triangle is max distance."}),selections:symbol_1.Argument(Core.Types.List(Types.AtomSelectionQuery),{description:"A list of held selections."})}),Types.AtomSelectionQuery,"Pick combinations of atom sets from the source sequences that are mutually within distances specified by a matrix.")};var atomSet={"@header":"Atom Sets",atomCount:helpers_1.symbol(symbol_1.Arguments.None,type_1.default.Num),countQuery:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomSelectionQuery)}),type_1.default.Num,"Counts the number of occurences of a specific query inside the current atom set."),reduce:helpers_1.symbol(symbol_1.Arguments.Dictionary({initial:symbol_1.Argument(type_1.default.Variable("a",type_1.default.AnyValue,true),{description:"Initial value assigned to slot.atom-set-reduce. Current atom is set to the 1st atom of the current set for this."}),value:symbol_1.Argument(type_1.default.Variable("a",type_1.default.AnyValue,true),{description:"Expression executed for each atom in the set"})}),type_1.default.Variable("a",type_1.default.AnyValue,true),"Execute the value expression for each atom in the current atom set and return the result. Works the same way as Array.reduce in JavaScript (``result = value(value(...value(initial)))``)"),propertySet:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Core.Types.ConstrainedVar)}),Core.Types.Set(Core.Types.ConstrainedVar),"Returns a set with all values of the given property in the current atom set.")};var atomProperty={"@header":"Atom Properties",core:{"@header":"Core Properties",elementSymbol:atomProp(Types.ElementSymbol),vdw:atomProp(type_1.default.Num,"Van der Waals radius"),mass:atomProp(type_1.default.Num,"Atomic weight"),atomicNumber:atomProp(type_1.default.Num,"Atomic number"),x:atomProp(type_1.default.Num,"Cartesian X coordinate"),y:atomProp(type_1.default.Num,"Cartesian Y coordinate"),z:atomProp(type_1.default.Num,"Cartesian Z coordinate"),atomKey:atomProp(type_1.default.AnyValue,"Unique value for each atom. Main use case is grouping of atoms."),bondCount:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomReference,{isOptional:true,defaultValue:"slot.current-atom"}),flags:symbol_1.Argument(Types.BondFlags,{isOptional:true,defaultValue:"covalent"})}),type_1.default.Num,"Number of bonds (by default only covalent bonds are counted).")},topology:{connectedComponentKey:atomProp(type_1.default.AnyValue,"Unique value for each connected component.")},macromolecular:{"@header":"Macromolecular Properties (derived from the mmCIF format)",authResidueId:atomProp(Types.ResidueId,"type.auth-residue-id symbol executed on current atom's residue"),labelResidueId:atomProp(Types.ResidueId,"type.label-residue-id symbol executed on current atom's residue"),residueKey:atomProp(type_1.default.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id,auth_seq_id,pdbx_PDB_ins_code)``, main use case is grouping of atoms"),chainKey:atomProp(type_1.default.AnyValue,"Unique value for each tuple ``(label_entity_id,auth_asym_id)``, main use case is grouping of atoms"),entityKey:atomProp(type_1.default.AnyValue,"Unique value for each tuple ``label_entity_id``, main use case is grouping of atoms"),isHet:atomProp(type_1.default.Bool,"Equivalent to atom_site.group_PDB !== ATOM"),id:atomProp(type_1.default.Num,"_atom_site.id"),label_atom_id:atomProp(Types.AtomName),label_alt_id:atomProp(type_1.default.Str),label_comp_id:atomProp(type_1.default.Str),label_asym_id:atomProp(type_1.default.Str),label_entity_id:atomProp(type_1.default.Str),label_seq_id:atomProp(type_1.default.Num),auth_atom_id:atomProp(Types.AtomName),auth_comp_id:atomProp(type_1.default.Str),auth_asym_id:atomProp(type_1.default.Str),auth_seq_id:atomProp(type_1.default.Num),pdbx_PDB_ins_code:atomProp(type_1.default.Str),pdbx_formal_charge:atomProp(type_1.default.Num),occupancy:atomProp(type_1.default.Num),B_iso_or_equiv:atomProp(type_1.default.Num),entityType:atomProp(Types.EntityType,"Type of the entity as defined in mmCIF (polymer, non-polymer, water, unknown)"),secondaryStructureKey:atomProp(type_1.default.AnyValue,"Unique value for each secondary structure element."),secondaryStructureFlags:atomProp(Types.SecondaryStructureFlags),isModified:atomProp(type_1.default.Bool,"True if the atom bolongs to modification of a standard residue."),modifiedParentName:atomProp(type_1.default.Str,"'3-letter' code of the modifed parent residue.")}};var bondProperty={"@header":"Bond Properties",flags:bondProp(Types.BondFlags),order:bondProp(type_1.default.Num)};function atomProp(type,description){return helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AtomReference,{isOptional:true,defaultValue:"slot.current-atom"})}),type,description)}function bondProp(type,description){return helpers_1.symbol(symbol_1.Arguments.None,type,description)}exports.default={"@header":"Structure Queries",type:type,slot:slot,generator:generator,modifier:modifier,filter:filter,combinator:combinator,atomSet:atomSet,atomProperty:atomProperty,bondProperty:bondProperty}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function SymbolRuntime(symbol,attributes){if(attributes===void 0){attributes={}}var _a=attributes.isStatic,isStatic=_a===void 0?false:_a;return function(runtime){return{symbol:symbol,runtime:runtime,attributes:{isStatic:isStatic}}}}function forEachPositionalArg(args,ctx,f){for(var _i=0,_a=Object.keys(args);_i<_a.length;_i++){var k=_a[_i];if(isNaN(k))continue;f(args[k],ctx)}return ctx}exports.forEachPositionalArg=forEachPositionalArg;exports.default=SymbolRuntime},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function toUpperCase(value){if(!value)return"";return typeof value==="string"?value.toUpperCase():(""+value).toUpperCase()}exports.default=toUpperCase},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=__webpack_require__(25);var data_1=__webpack_require__(13);var element_address_1=__webpack_require__(26);var atom_set_1=__webpack_require__(14);var atom_selection_1=__webpack_require__(19);var collection_1=__webpack_require__(93);var AtomSetIt=atom_set_1.default.Iterator;function defaultBondTest(env){return data_1.Bonds.isCovalent(env.slots.bond.flags)}exports.defaultBondTest=defaultBondTest;function testBond(env,slot,a,b,order,flags,test){slot.atomA=a;slot.atomB=b;slot.order=order;slot.flags=flags;return test(env)}exports.testBond=testBond;function ringFingerprint(env,elements){var els=[];for(var _i=0,elements_1=elements;_i<elements_1.length;_i++){var e=elements_1[_i];els.push(e(env))}return collection_1.getRingFingerprint(els)}exports.ringFingerprint=ringFingerprint;function entityType(type){var t=(type||"").toLowerCase();switch(t){case"polymer":case"non-polymer":case"water":return"water";default:return"unknown"}}exports.entityType=entityType;function maxAtomValueInSelection(env,selection,prop){var model=env.context.model;environment_1.default.lockSlot(env,"element");var element=env.slots.element;var ret=0;var it=AtomSetIt();for(var _i=0,_a=atom_selection_1.default.atomSets(selection);_i<_a.length;_i++){var atomSet=_a[_i];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){element_address_1.default.setAtom(model,element,a);var v=prop(env);if(v>ret)ret=v}}environment_1.default.unlockSlot(env,"element");return ret}exports.maxAtomValueInSelection=maxAtomValueInSelection},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var h=__webpack_require__(17);var builder_1=__webpack_require__(6);var operators=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not ARG"],name:"not",type:h.prefix,rule:P.alt(P.regex(/NOT/i).skip(P.whitespace),P.string("!").skip(P.optWhitespace)),map:function(op,selection){return h.invertExpr(selection)}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["ASP and .CA"],name:"and",type:h.binaryLeft,rule:h.infixOp(/AND|&/i),map:function(op,selection,by){return builder_1.default.struct.modifier.intersectBy({0:selection,by:by})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["ASP or GLU"],name:"or",type:h.binaryLeft,rule:h.infixOp(/OR|\|/i),map:function(op,s1,s2){return builder_1.default.struct.combinator.merge([s1,s2])}}];exports.default=operators},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=__webpack_require__(17);var builder_1=__webpack_require__(6);function nucleicExpr(){return builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["G","C","A","T","U","I","DG","DC","DA","DT","DU","DI","+G","+C","+A","+T","+U","+I"]),builder_1.default.ammp("label_comp_id")])}),builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.and([builder_1.default.core.rel.eq([builder_1.default.struct.atomSet.atomCount(),1]),builder_1.default.core.rel.eq([builder_1.default.ammp("label_atom_id"),builder_1.default.atomName("P")])])}),builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.or([builder_1.default.core.set.isSubset([h.atomNameSet(["C1'","C2'","O3'","C3'","C4'","C5'","O5'"]),builder_1.default.ammpSet("label_atom_id")]),builder_1.default.core.set.isSubset([h.atomNameSet(["C1*","C2*","O3*","C3*","C4*","C5*","O5*"]),builder_1.default.ammpSet("label_atom_id")])])})])}var ResDict={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],amino:["ALA","ARG","ASN","ASP","CYS","GLN","GLU","GLY","HIS","ILE","LEU","LYS","MET","PHE","PRO","SER","THR","TRP","TYR","VAL","ASX","GLX","UNK"],aromatic:["HIS","PHE","TRP","TYR"],basic:["ARG","HIS","LYS"],buried:["ALA","CYS","ILE","LEU","MET","PHE","TRP","VAL"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","GLY","ILE","LEU","MET","PHE","PRO","TRP","TYR","VAL"],large:["ARG","GLU","GLN","HIS","ILE","LEU","LYS","MET","PHE","TRP","TYR"],medium:["ASN","ASP","CYS","PRO","THR","VAL"],small:["ALA","GLY","SER"]};var keywords={all:{"@desc":"all atoms; same as *",abbr:["*"],map:function(){return builder_1.default.struct.generator.atomGroups()}},bonded:{"@desc":"covalently bonded",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.gr([builder_1.default.struct.atomProperty.core.bondCount({flags:builder_1.default.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})}},clickable:{"@desc":"actually visible -- having some visible aspect such as wireframe, spacefill, or a label showing, or the alpha-carbon or phosphorus atom in a biomolecule that is rendered with only cartoon, rocket, or other biomolecule-specific shape."},connected:{"@desc":"bonded in any way, including hydrogen bonds",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.gr([builder_1.default.struct.atomProperty.core.bondCount({flags:builder_1.default.struct.type.bondFlags()}),0])})}},displayed:{"@desc":"displayed using the display or hide command; not necessarily visible"},hidden:{"@desc":"hidden using the display or hide command"},none:{"@desc":"no atoms",map:function(){return builder_1.default.struct.generator.empty()}},selected:{"@desc":"atoms that have been selected; defaults to all when a file is first loaded"},thisModel:{"@desc":'atoms in the current frame set, as defined by frame, model, or animation commands. If more than one model is in this set, "thisModel" refers to all of them, regardless of atom displayed/hidden status.'},visible:{"@desc":"visible in any way, including PDB residue atoms for which a cartoon or other such rendering makes their group visible, even if they themselves are not visible."},subset:{"@desc":"the currently defined subset. Note that if a subset is currently defined, then select/display all is the same as select/display subset, restrict none is the same as restrict not subset. In addition, select not subset selects nothing."},specialPosition:{"@desc":"atoms in crystal structures that are at special positions - that is, for which there is more than one operator that leads to them."},unitcell:{"@desc":"atoms within the current unitcell, which may be offset. This includes atoms on the faces and at the vertices of the unitcell."},polyhedra:{"@desc":"all central atoms for which polyhedra have been created. See also polyhera(n), below. (Jmol 14.4)"},nonmetal:{"@desc":"_H,_He,_B,_C,_N,_O,_F,_Ne,_Si,_P,_S,_Cl,_Ar,_As,_Se,_Br,_Kr,_Te,_I,_Xe,_At,_Rn",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(builder_1.default.es)),builder_1.default.acp("elementSymbol")])})}},metal:{"@desc":"!nonmetal",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.logic.not([builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["H","He","B","C","N","O","F","Ne","Si","P","S","Cl","Ar","As","Se","Br","Kr","Te","I","Xe","At","Rn"].map(builder_1.default.es)),builder_1.default.acp("elementSymbol")])])})}},alkaliMetal:{"@desc":"_Li,_Na,_K,_Rb,_Cs,_Fr",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["Li","Na","K","Rb","Cs","Fr"].map(builder_1.default.es)),builder_1.default.acp("elementSymbol")])})}},alkalineEarth:{"@desc":"_Be,_Mg,_Ca,_Sr,_Ba,_Ra",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["Be","Mg","Ca","Sr","Ba","Ra"].map(builder_1.default.es)),builder_1.default.acp("elementSymbol")])})}},nobleGas:{"@desc":"_He,_Ne,_Ar,_Kr,_Xe,_Rn",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["He","Ne","Ar","Kr","Xe","Rn"].map(builder_1.default.es)),builder_1.default.acp("elementSymbol")])})}},metalloid:{"@desc":"_B,_Si,_Ge,_As,_Sb,_Te",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["B","Si","Ge","As","Sb","Te"].map(builder_1.default.es)),builder_1.default.acp("elementSymbol")])})}},transitionMetal:{"@desc":"(includes La and Ac) elemno>=21 and elemno<=30, elemno=57, elemno=89, elemno>=39 and elemno<=48, elemno>=72 and elemno<=80, elemno>=104 and elemno<=112",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.logic.or([builder_1.default.core.rel.inRange([builder_1.default.acp("atomicNumber"),21,30]),builder_1.default.core.rel.inRange([builder_1.default.acp("atomicNumber"),39,48]),builder_1.default.core.rel.inRange([builder_1.default.acp("atomicNumber"),72,80]),builder_1.default.core.rel.inRange([builder_1.default.acp("atomicNumber"),104,112]),builder_1.default.core.set.has([builder_1.default.set(57,89),builder_1.default.acp("atomicNumber")])])})}},lanthanide:{"@desc":"(does not include La) elemno>57 and elemno<=71",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.inRange([builder_1.default.acp("atomicNumber"),57,71])})}},actinide:{"@desc":"(does not include Ac) elemno>89 and elemno<=103",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.inRange([builder_1.default.acp("atomicNumber"),89,103])})}},isaromatic:{"@desc":"atoms connected with the AROMATIC, AROMATICSINGLE, or AROMATICDOUBLE bond types",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.gr([builder_1.default.struct.atomProperty.core.bondCount({flags:builder_1.default.struct.type.bondFlags(["aromatic"])}),0])})}},carbohydrate:{"@desc":""},ions:{"@desc":'(specifically the PDB designations "PO4" and "SO4")'},ligand:{"@desc":'(originally "hetero and not solvent"; changed to "!(protein,nucleic,water,UREA)" for Jmol 12.2)'},nucleic:{"@desc":'any group that (a) has one of the following group names: G, C, A, T, U, I, DG, DC, DA, DT, DU, DI, +G, +C, +A, +T, +U, +I; or (b) can be identified as a group that is only one atom, with name "P"; or (c) has all of the following atoms (prime, \', can replace * here): C1*, C2*, C3*, O3*, C4*, C5*, and O5*.',map:function(){return nucleicExpr()}},purine:{"@desc":"any nucleic group that (a) has one of the following group names: A, G, I, DA, DG, DI, +A, +G, or +I; or (b) also has atoms N7, C8, and N9.",map:function(){return builder_1.default.struct.modifier.intersectBy({0:nucleicExpr(),by:builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["A","G","I","DA","DG","DI","+A","+G","+I"]),builder_1.default.ammp("label_comp_id")])}),builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.set.isSubset([h.atomNameSet(["N7","C8","N9"]),builder_1.default.ammpSet("label_atom_id")])})])})}},pyrimidine:{"@desc":"any nucleic group that (a) has one of the following group names: C, T, U, DC, DT, DU, +C, +T, +U; or (b) also has atom O2.",map:function(){return builder_1.default.struct.modifier.intersectBy({0:nucleicExpr(),by:builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["C","T","U","DC","DT","DU","+C","+T","+U"]),builder_1.default.ammp("label_comp_id")])}),builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.or([builder_1.default.core.set.has([builder_1.default.ammpSet("label_atom_id"),builder_1.default.atomName("O2*")]),builder_1.default.core.set.has([builder_1.default.ammpSet("label_atom_id"),builder_1.default.atomName("O2'")])])})])})}},dna:{"@desc":"any nucleic group that (a) has one of the following group names: DG, DC, DA, DT, DU, DI, T, +G, +C, +A, +T; or (b) has neither atom O2* or O2'.",map:function(){return builder_1.default.struct.modifier.intersectBy({0:nucleicExpr(),by:builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["DG","DC","DA","DT","DU","DI","T","+G","+C","+A","+T"]),builder_1.default.ammp("label_comp_id")])}),builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.not([builder_1.default.core.logic.or([builder_1.default.core.set.has([builder_1.default.ammpSet("label_atom_id"),builder_1.default.atomName("O2*")]),builder_1.default.core.set.has([builder_1.default.ammpSet("label_atom_id"),builder_1.default.atomName("O2'")])])])})])})}},rna:{"@desc":"any nucleic group that (a) has one of the following group names: G, C, A, U, I, +U, +I; or (b) has atom O2* or O2'.",map:function(){return builder_1.default.struct.modifier.intersectBy({0:nucleicExpr(),by:builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.set.apply(builder_1.default,["G","C","A","U","I","+U","+I"]),builder_1.default.ammp("label_comp_id")])}),builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.or([builder_1.default.core.set.has([builder_1.default.ammpSet("label_atom_id"),builder_1.default.atomName("O2*")]),builder_1.default.core.set.has([builder_1.default.ammpSet("label_atom_id"),builder_1.default.atomName("O2'")])])})])})}},protein:{"@desc":'defined as a group that (a) has one of the following group names: ALA, ARG, ASN, ASP, CYS, GLN, GLU, GLY, HIS, ILE, LEU, LYS, MET, PHE, PRO, SER, THR, TRP, TYR, VAL, ASX, GLX, or UNK; or (b) contains PDB atom designations [C, O, CA, and N] bonded correctly; or (c) does not contain "O" but contains [C, CA, and N] bonded correctly; or (d) has only one atom, which has name CA and does not have the group name CA (indicating a calcium atom).'},acidic:{"@desc":"ASP GLU",map:function(){return h.resnameExpr(ResDict.acidic)}},acyclic:{"@desc":"amino and not cyclic",map:function(){return builder_1.default.struct.modifier.intersectBy({0:h.resnameExpr(ResDict.amino),by:h.invertExpr(h.resnameExpr(ResDict.cyclic))})}},aliphatic:{"@desc":"ALA GLY ILE LEU VAL",map:function(){return h.resnameExpr(ResDict.aliphatic)}},amino:{"@desc":"all twenty standard amino acids, plus ASX, GLX, UNK",map:function(){return h.resnameExpr(ResDict.amino)}},aromatic:{"@desc":'HIS PHE TRP TYR (see also "isaromatic" for aromatic bonds)',map:function(){return h.resnameExpr(ResDict.aromatic)}},basic:{"@desc":"ARG HIS LYS",map:function(){return h.resnameExpr(ResDict.basic)}},buried:{"@desc":"ALA CYS ILE LEU MET PHE TRP VAL",map:function(){return h.resnameExpr(ResDict.buried)}},charged:{"@desc":"same as acidic or basic -- ASP GLU, ARG HIS LYS",map:function(){return h.resnameExpr(ResDict.acidic.concat(ResDict.basic))}},cyclic:{"@desc":"HIS PHE PRO TRP TYR",map:function(){return h.resnameExpr(ResDict.cyclic)}},helix:{"@desc":"secondary structure-related.",map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.type.secondaryStructureFlags(["helix"]),builder_1.default.ammp("secondaryStructureFlags")])})}},helixalpha:{"@desc":"secondary structure-related.",map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.type.secondaryStructureFlags(["alpha"]),builder_1.default.ammp("secondaryStructureFlags")])})}},helix310:{"@desc":"secondary structure-related.",map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.type.secondaryStructureFlags(["3-10"]),builder_1.default.ammp("secondaryStructureFlags")])})}},helixpi:{"@desc":"secondary structure-related.",map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.type.secondaryStructureFlags(["pi"]),builder_1.default.ammp("secondaryStructureFlags")])})}},hetero:{"@desc":"PDB atoms designated as HETATM",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.ammp("isHet")})}},hydrophobic:{"@desc":"ALA GLY ILE LEU MET PHE PRO TRP TYR VAL",map:function(){return h.resnameExpr(ResDict.hydrophobic)}},large:{"@desc":"ARG GLU GLN HIS ILE LEU LYS MET PHE TRP TYR",map:function(){return h.resnameExpr(ResDict.large)}},medium:{"@desc":"ASN ASP CYS PRO THR VAL",map:function(){return h.resnameExpr(ResDict.medium)}},negative:{"@desc":"same as acidic -- ASP GLU",map:function(){return h.resnameExpr(ResDict.acidic)}},neutral:{"@desc":"amino and not (acidic or basic)",map:function(){return builder_1.default.struct.modifier.intersectBy({0:h.resnameExpr(ResDict.amino),by:h.invertExpr(h.resnameExpr(ResDict.acidic.concat(ResDict.basic)))})}},polar:{"@desc":"amino and not hydrophobic",map:function(){return builder_1.default.struct.modifier.intersectBy({0:h.resnameExpr(ResDict.amino),by:h.invertExpr(h.resnameExpr(ResDict.hydrophobic))})}},positive:{"@desc":"same as basic -- ARG HIS LYS",map:function(){return h.resnameExpr(ResDict.basic)}},sheet:{"@desc":"secondary structure-related",map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.type.secondaryStructureFlags(["sheet"]),builder_1.default.ammp("secondaryStructureFlags")])})}},small:{"@desc":"ALA GLY SER",map:function(){return h.resnameExpr(ResDict.small)}},surface:{"@desc":"amino and not buried",map:function(){return builder_1.default.struct.modifier.intersectBy({0:h.resnameExpr(ResDict.amino),by:h.invertExpr(h.resnameExpr(ResDict.buried))})}},turn:{"@desc":"secondary structure-related",map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.type.secondaryStructureFlags(["turn"]),builder_1.default.ammp("secondaryStructureFlags")])})}},alpha:{"@desc":"(*.CA)",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.atomName("CA"),builder_1.default.ammp("label_atom_id")])})}},base:{"@desc":"(nucleic bases)"},backbone:{"@desc":"(*.C, *.CA, *.N, and all nucleic other than the bases themselves)",abbr:["mainchain"]},sidechain:{"@desc":"((protein or nucleic) and not backbone)"},spine:{"@desc":"(*.CA, *.N, *.C for proteins; *.P, *.O3', *.O5', *.C3', *.C4', *.C5 for nucleic acids)"},leadatom:{"@desc":"(*.CA, *.P, and terminal *.O5')"},solvent:{"@desc":'PDB "HOH", water, also the connected set of H-O-H in any model'}};exports.default=keywords},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var version_1=__webpack_require__(168);var semver=__webpack_require__(169);var Container;(function(Container){function serialize(expression,options){var _a=options||{},_b=_a.source,source=_b===void 0?void 0:_b,_c=_a.pretty,pretty=_c===void 0?false:_c;return JSON.stringify({source:source,version:version_1.default,expression:expression},void 0,pretty?2:void 0)}Container.serialize=serialize;function deserialize(data){var container=JSON.parse(data);if(!semver.satisfies(container.version,">=0.1.0 <0.2.0"))throw new Error("Can only deserialize version 0.1.x (got "+container.version+")");return container}Container.deserialize=deserialize})(Container||(Container={}));exports.default=Container},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var builder_1=__webpack_require__(6);var reFloat=/[-+]?[0-9]*\.?[0-9]+/;var rePosInt=/[0-9]+/;function atomNameListMap(x){return x.split("+").map(builder_1.default.atomName)}function listMap(x){return x.split("+").map(function(x){return x.replace(/^["']|["']$/g,"")})}function rangeMap(x){var _a=x.split("-").map(function(x){return parseInt(x)}),min=_a[0],max=_a[1];return{min:min,max:max}}function listOrRangeMap(x){return x.includes("-")?rangeMap(x):listMap(x).map(function(x){return parseInt(x)})}function elementListMap(x){return x.split("+").map(builder_1.default.struct.type.elementSymbol)}var sstrucDict={H:"helix",S:"beta",L:"none"};function sstrucListMap(x){return{flags:builder_1.default.struct.type.secondaryStructureFlags(x.toUpperCase().split("+").map(function(ss){return sstrucDict[ss]||"none"}))}}var properties={symbol:{"@desc":"chemical-symbol-list: list of 1- or 2-letter chemical symbols from the periodic table","@examples":["symbol O+N"],abbr:["e."],regex:/[a-zA-Z'"+]+/,map:elementListMap,level:"atom-test",property:builder_1.default.acp("elementSymbol")},name:{"@desc":"atom-name-list: list of up to 4-letter codes for atoms in proteins or nucleic acids","@examples":["name CA+CB+CG+CD"],abbr:["n."],regex:/[a-zA-Z0-9'"+]+/,map:atomNameListMap,level:"atom-test",property:builder_1.default.ammp("label_atom_id")},resn:{"@desc":"residue-name-list: list of 3-letter codes for amino acids or list of up to 2-letter codes for nucleic acids","@examples":["resn ASP+GLU+ASN+GLN","resn A+G"],abbr:["resname","r."],regex:/[a-zA-Z0-9'"+]+/,map:listMap,level:"residue-test",property:builder_1.default.ammp("label_comp_id")},resi:{"@desc":"residue-identifier-list list of up to 4-digit residue numbers or residue-identifier-range","@examples":["resi 1+10+100+1000","resi 1-10"],abbr:["resident","residue","resid","i."],regex:/[0-9+-]+/,map:listOrRangeMap,level:"residue-test",property:builder_1.default.ammp("auth_seq_id")},alt:{"@desc":"alternate-conformation-identifier-list list of single letters","@examples":["alt A+B",'alt ""','alt ""+A'],abbr:[],regex:/[a-zA-Z0-9'"+]+/,map:listMap,level:"atom-test",property:builder_1.default.ammp("label_alt_id")},chain:{"@desc":"chain-identifier-list list of single letters or sometimes numbers","@examples":["chain A"],abbr:["c."],regex:/[a-zA-Z0-9'"+]+/,map:listMap,level:"chain-test",property:builder_1.default.ammp("auth_asym_id")},segi:{"@desc":"segment-identifier-list list of up to 4 letter identifiers","@examples":["segi lig"],abbr:["segid","s."],regex:/[a-zA-Z0-9'"+]+/,map:listMap,level:"chain-test",property:builder_1.default.ammp("label_asym_id")},flag:{"@desc":"flag-number a single integer from 0 to 31","@examples":["flag 0"],isUnsupported:true,abbr:["f."],regex:/[0-9]+/,map:function(x){return parseInt(x)},level:"atom-test"},numeric_type:{"@desc":"type-number a single integer","@examples":["nt. 5"],isUnsupported:true,abbr:["nt."],regex:/[0-9]+/,map:function(x){return parseInt(x)},level:"atom-test"},text_type:{"@desc":"type-string a list of up to 4 letter codes","@examples":["text_type HA+HC"],isUnsupported:true,abbr:["tt."],regex:/[a-zA-Z0-9'"+]+/,map:listMap,level:"atom-test"},id:{"@desc":"external-index-number a single integer","@examples":["id 23"],abbr:[],regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test",property:builder_1.default.ammp("id")},index:{"@desc":"internal-index-number a single integer","@examples":["index 11"],isUnsupported:true,abbr:["idx."],regex:rePosInt,map:function(x){return parseInt(x)},level:"atom-test"},ss:{"@desc":"secondary-structure-type list of single letters. Helical regions should be assigned H and sheet regions S. Loop regions can either be assigned L or be blank.","@examples":["ss H+S+L",'ss S+""'],abbr:[],regex:/[a-zA-Z'"+]+/,map:sstrucListMap,level:"residue-test",property:builder_1.default.ammp("secondaryStructureFlags")},b:{"@desc":"comparison-operator b-factor-value a real number","@examples":["b > 10"],isNumeric:true,abbr:[],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("B_iso_or_equiv")},q:{"@desc":"comparison-operator occupancy-value a real number","@examples":["q <0.50"],isNumeric:true,abbr:[],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("occupancy")},formal_charge:{"@desc":"comparison-operator formal charge-value an integer","@examples":["fc. = -1"],isNumeric:true,abbr:["fc."],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test",property:builder_1.default.ammp("pdbx_formal_charge")},partial_charge:{"@desc":"comparison-operator partial charge-value a real number","@examples":["pc. > 1"],isUnsupported:true,isNumeric:true,abbr:["pc."],regex:reFloat,map:function(x){return parseFloat(x)},level:"atom-test"}};exports.default=properties},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var h=__webpack_require__(17);var builder_1=__webpack_require__(6);var operators=[{"@desc":"Selects atoms that are not included in s1.","@examples":["NOT resn ALA","not (resi 42 or chain A)","!resi 42 or chain A"],name:"not",type:h.prefix,rule:P.alt(P.regex(/NOT/i).skip(P.whitespace),P.string("!").skip(P.optWhitespace)),map:function(op,selection){return h.invertExpr(selection)}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["chain A AND name CA"],name:"and",type:h.binaryLeft,rule:h.infixOp(/AND|&/i),map:function(op,selection,by){return builder_1.default.struct.modifier.intersectBy({0:selection,by:by})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["chain A OR chain B"],name:"or",type:h.binaryLeft,rule:h.infixOp(/OR|\|/i),map:function(op,s1,s2){return builder_1.default.struct.combinator.merge([s1,s2])}},{"@desc":"Selects atoms in s1 whose identifiers name, resi, resn, chain and segi all match atoms in s2.","@examples":["chain A IN chain B"],name:"in",type:h.binaryLeft,rule:h.infixOp(/IN/i),map:function(op,selection,source){return builder_1.default.struct.filter.withSameAtomProperties({0:selection,source:source,property:builder_1.default.core.type.compositeKey([builder_1.default.ammp("label_atom_id"),builder_1.default.ammp("label_seq_id"),builder_1.default.ammp("label_comp_id"),builder_1.default.ammp("auth_asym_id"),builder_1.default.ammp("label_asym_id")])})}},{"@desc":"Selects atoms in s1 whose identifiers name and resi match atoms in s2.","@examples":["chain A LIKE chain B"],name:"like",type:h.binaryLeft,rule:h.infixOp(/LIKE|l\./i),map:function(op,selection,source){return builder_1.default.struct.filter.withSameAtomProperties({0:selection,source:source,property:builder_1.default.core.type.compositeKey([builder_1.default.ammp("label_atom_id"),builder_1.default.ammp("label_seq_id")])})}},{"@desc":"Selects all atoms whose van der Waals radii are separated from the van der Waals radii of s1 by a minimum of X Angstroms.","@examples":["solvent GAP 2"],name:"gap",type:h.postfix,rule:h.postfixOp(/GAP\s+([-+]?[0-9]*\.?[0-9]+)/i,1).map(function(x){return parseFloat(x)}),map:function(distance,target){return builder_1.default.struct.filter.within({0:builder_1.default.struct.generator.atomGroups(),target:target,"atom-radius":builder_1.default.acp("vdw"),"max-radius":distance,invert:true})}},{"@desc":"Selects atoms with centers within X Angstroms of the center of any atom in s1.","@examples":["resname LIG AROUND 1"],name:"around",abbr:["a."],type:h.postfix,rule:h.postfixOp(/(AROUND|a\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(function(x){return parseFloat(x)}),map:function(radius,target){return builder_1.default.struct.modifier.exceptBy({0:builder_1.default.struct.filter.within({0:builder_1.default.struct.generator.atomGroups(),target:target,"max-radius":radius}),by:target})}},{"@desc":"Expands s1 by all atoms within X Angstroms of the center of any atom in s1.","@examples":["chain A EXPAND 3"],name:"expand",abbr:["x."],type:h.postfix,rule:h.postfixOp(/(EXPAND|x\.)\s+([-+]?[0-9]*\.?[0-9]+)/i,2).map(function(x){return parseFloat(x)}),map:function(radius,selection){return builder_1.default.struct.modifier.includeSurroundings({0:selection,radius:radius})}},{"@desc":"Selects atoms in s1 that are within X Angstroms of any atom in s2.","@examples":["chain A WITHIN 3 OF chain B"],name:"within",abbr:["w."],type:h.binaryLeft,rule:h.ofOp("WITHIN","w."),map:function(radius,selection,target){return builder_1.default.struct.filter.within({0:selection,target:target,"max-radius":radius})}},{"@desc":"Same as within, but excludes s2 from the selection (and thus is identical to s1 and s2 around X).","@examples":["chain A NEAR_TO 3 OF chain B"],name:"near_to",abbr:["nto."],type:h.binaryLeft,rule:h.ofOp("NEAR_TO","nto."),map:function(radius,selection,target){return builder_1.default.struct.modifier.exceptBy({0:builder_1.default.struct.filter.within({0:selection,target:target,"max-radius":radius}),by:target})}},{"@desc":"Selects atoms in s1 that are at least X Anstroms away from s2.","@examples":["solvent BEYOND 2 OF chain A"],name:"beyond",abbr:["be."],type:h.binaryLeft,rule:h.ofOp("BEYOND","be."),map:function(radius,selection,target){return builder_1.default.struct.modifier.exceptBy({0:builder_1.default.struct.filter.within({0:selection,target:target,"max-radius":radius,invert:true}),by:target})}},{"@desc":"Expands selection to complete residues.","@examples":["BYRESIDUE name N"],name:"byresidue",abbr:["byresi","byres","br."],type:h.prefix,rule:h.prefixOp(/BYRESIDUE|byresi|byres|br\./i),map:function(op,selection){return h.asAtoms(builder_1.default.struct.modifier.expandProperty({0:builder_1.default.struct.modifier.union({0:selection}),property:builder_1.default.ammp("residueKey")}))}},{"@desc":"Completely selects all alpha carbons in all residues covered by a selection.","@examples":["BYCALPHA chain A"],name:"bycalpha",abbr:["bca."],type:h.prefix,rule:h.prefixOp(/BYCALPHA|bca\./i),map:function(op,selection){return builder_1.default.struct.generator.queryInSelection({0:builder_1.default.struct.modifier.expandProperty({0:builder_1.default.struct.modifier.union({0:selection}),property:builder_1.default.ammp("residueKey")}),query:builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.atomName("CA"),builder_1.default.ammp("label_atom_id")])})})}},{"@desc":"Expands selection to complete molecules.","@examples":["BYMOLECULE resi 20-30"],name:"bymolecule",abbr:["bymol","bm."],type:h.prefix,rule:h.prefixOp(/BYMOLECULE|bymol|bm\./i),map:function(op,selection){return h.asAtoms(builder_1.default.struct.modifier.expandProperty({0:builder_1.default.struct.modifier.union({0:selection}),property:builder_1.default.atp("connectedComponentKey")}))}},{"@desc":"Expands selection to complete fragments.","@examples":["BYFRAGMENT resi 10"],name:"byfragment",abbr:["byfrag","bf."],isUnsupported:true,type:h.prefix,rule:h.prefixOp(/BYFRAGMENT|byfrag|bf\./i),map:function(op,selection){return[op,selection]}},{"@desc":"Expands selection to complete segments.","@examples":["BYSEGMENT resn CYS"],name:"bysegment",abbr:["bysegi","byseg","bs."],type:h.prefix,rule:h.prefixOp(/BYSEGMENT|bysegi|byseg|bs\./i),map:function(op,selection){return h.asAtoms(builder_1.default.struct.modifier.expandProperty({0:builder_1.default.struct.modifier.union({0:selection}),property:builder_1.default.ammp("chainKey")}))}},{"@desc":"Expands selection to complete objects.","@examples":["BYOBJECT chain A"],name:"byobject",abbr:["byobj","bo."],isUnsupported:true,type:h.prefix,rule:h.prefixOp(/BYOBJECT|byobj|bo\./i),map:function(op,selection){return[op,selection]}},{"@desc":"Expands selection to unit cell.","@examples":["BYCELL chain A"],name:"bycell",isUnsupported:true,type:h.prefix,rule:h.prefixOp(/BYCELL/i),map:function(op,selection){return[op,selection]}},{"@desc":"All rings of size ≤ 7 which have at least one atom in s1.","@examples":["BYRING resn HEM"],name:"byring",type:h.prefix,rule:h.prefixOp(/BYRING/i),map:function(op,selection){return h.asAtoms(builder_1.default.struct.filter.intersectedBy({0:builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.rings(),test:builder_1.default.core.logic.and([builder_1.default.core.rel.lte([builder_1.default.struct.atomSet.atomCount(),7]),builder_1.default.core.rel.gr([builder_1.default.struct.atomSet.countQuery([selection]),1])])}),by:selection}))}},{"@desc":"Selects atoms directly bonded to s1, excludes s1.","@examples":["NEIGHBOUR resn CYS"],name:"neighbour",type:h.prefix,abbr:["nbr."],rule:h.prefixOp(/NEIGHBOUR|nbr\./i),map:function(op,selection){return builder_1.default.struct.modifier.exceptBy({0:h.asAtoms(builder_1.default.struct.modifier.includeConnected({0:builder_1.default.struct.modifier.union({0:selection}),"bond-test":true})),by:selection})}},{"@desc":"Selects atoms directly bonded to s1, may include s1.","@examples":["BOUND_TO resname CA"],name:"bound_to",abbr:["bto."],type:h.prefix,rule:h.prefixOp(/BOUND_TO|bto\./i),map:function(op,selection){return h.asAtoms(builder_1.default.struct.modifier.includeConnected({0:builder_1.default.struct.modifier.union({0:selection})}))}},{"@desc":"Extends s1 by X bonds connected to atoms in s1.","@examples":["resname LIG EXTEND 3"],name:"extend",abbr:["xt."],type:h.postfix,rule:h.postfixOp(/(EXTEND|xt\.)\s+([0-9]+)/i,2).map(function(x){return parseInt(x)}),map:function(count,selection){return h.asAtoms(builder_1.default.struct.modifier.includeConnected({0:builder_1.default.struct.modifier.union({0:selection}),"bond-test":true,"layer-count":count}))}}];exports.default=operators},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=__webpack_require__(17);var builder_1=__webpack_require__(6);var ResDict={nucleic:["A","C","T","G","U","DA","DC","DT","DG","DU"],protein:["ALA","ARG","ASN","ASP","CYS","CYX","GLN","GLU","GLY","HIS","HID","HIE","HIP","ILE","LEU","LYS","MET","MSE","PHE","PRO","SER","THR","TRP","TYR","VAL"],solvent:["HOH","WAT","H20","TIP","SOL"]};var keywords={all:{"@desc":"All atoms currently loaded into PyMOL",abbr:["*"],map:function(){return builder_1.default.struct.generator.atomGroups()}},none:{"@desc":"No atoms (empty selection)",map:function(){return builder_1.default.struct.generator.empty()}},hydrogens:{"@desc":"All hydrogen atoms currently loaded into PyMOL",abbr:["hydro","h."],map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.acp("elementSymbol"),builder_1.default.es("H")])})}},hetatm:{"@desc":"All atoms loaded from Protein Data Bank HETATM records",abbr:["het"],map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.ammp("isHet"),true])})}},visible:{"@desc":"All atoms in enabled objects with at least one visible representation",abbr:["v."]},polymer:{"@desc":"All atoms on the polymer (not het). Finds atoms with residue identifiers matching a known polymer, such a peptide and DNA.",abbr:["pol."],map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.core.type.set(ResDict.nucleic.concat(ResDict.protein)),builder_1.default.ammp("label_comp_id")])})}},backbone:{"@desc":"Polymer backbone atoms (new in PyMOL 1.6.1)",abbr:["bb."]},sidechain:{"@desc":"Polymer non-backbone atoms (new in PyMOL 1.6.1)",abbr:["sc."]},present:{"@desc":"All atoms with defined coordinates in the current state (used in creating movies)",abbr:["pr."]},center:{"@desc":"Pseudo-atom at the center of the scene"},origin:{"@desc":"Pseudo-atom at the origin of rotation"},enabled:{"@desc":"All enabled objects or selections from the object list."},masked:{"@desc":"All masked atoms.",abbr:["msk."]},protected:{"@desc":"All protected atoms.",abbr:["pr."]},bonded:{"@desc":"All bonded atoms",map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.gr([builder_1.default.struct.atomProperty.core.bondCount({flags:builder_1.default.struct.type.bondFlags(["covalent","metallic","sulfide"])}),0])})}},donors:{"@desc":"All hydrogen bond donor atoms.",abbr:["don."]},acceptors:{"@desc":"All hydrogen bond acceptor atoms.",abbr:["acc."]},fixed:{"@desc":"All fixed atoms.",abbr:["fxd."]},restrained:{"@desc":"All restrained atoms.",abbr:["rst."]},organic:{"@desc":"All atoms in non-polymer organic compounds (e.g. ligands, buffers). Finds carbon-containing molecules that do not match known polymers.",abbr:["org."],map:function(){return h.asAtoms(builder_1.default.struct.modifier.expandProperty({0:builder_1.default.struct.modifier.union([builder_1.default.struct.generator.queryInSelection({0:builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.logic.not([builder_1.default.core.set.has([builder_1.default.core.type.set(ResDict.nucleic.concat(ResDict.protein)),builder_1.default.ammp("label_comp_id")])])}),query:builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.es("C"),builder_1.default.acp("elementSymbol")])})})]),property:builder_1.default.ammp("residueKey")}))}},inorganic:{"@desc":"All non-polymer inorganic atoms/ions. Finds atoms in molecules that do not contain carbon and do not match any known solvent residues.",abbr:["ino."],map:function(){return h.asAtoms(builder_1.default.struct.modifier.expandProperty({0:builder_1.default.struct.modifier.union([builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.logic.not([builder_1.default.core.set.has([builder_1.default.core.type.set(ResDict.nucleic.concat(ResDict.protein).concat(ResDict.solvent)),builder_1.default.ammp("label_comp_id")])]),"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.not([builder_1.default.core.set.has([builder_1.default.struct.atomSet.propertySet([builder_1.default.acp("elementSymbol")]),builder_1.default.es("C")])])})]),property:builder_1.default.ammp("residueKey")}))}},solvent:{"@desc":"All water molecules. The hardcoded solvent residue identifiers are currently: HOH, WAT, H20, TIP, SOL.",abbr:["sol."],map:function(){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.set.has([builder_1.default.core.type.set(ResDict.solvent),builder_1.default.ammp("label_comp_id")])})}},guide:{"@desc":"All protein CA and nucleic acid C4*/C4",map:function(){return builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.atomName("CA"),builder_1.default.ammp("label_atom_id")]),"residue-test":builder_1.default.core.set.has([builder_1.default.core.type.set(ResDict.protein),builder_1.default.ammp("label_comp_id")])}),builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([h.atomNameSet(["C4*","C4"]),builder_1.default.ammp("label_atom_id")]),"residue-test":builder_1.default.core.set.has([builder_1.default.core.type.set(ResDict.nucleic),builder_1.default.ammp("label_comp_id")])})])}},metals:{"@desc":"All metal atoms (new in PyMOL 1.6.1)"}};exports.default=keywords},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var properties_1=__webpack_require__(37);var h=__webpack_require__(17);var builder_1=__webpack_require__(6);var propNames=Object.keys(properties_1.default).sort(h.strLenSortFn).filter(function(name){return!properties_1.default[name].isUnsupported}).join("|");var operators=[{"@desc":"Selects atoms that are not included in s1.","@examples":["not protein"],name:"not",type:h.prefix,rule:P.regex(/NOT/i).skip(P.whitespace),map:function(op,selection){return h.invertExpr(selection)}},{"@desc":"Selects atoms within a specified distance of a selection","@examples":["within 5 of name FE"],name:"within",type:h.prefix,rule:h.prefixOp(/WITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(function(x){return parseFloat(x)}),map:function(radius,selection){return builder_1.default.struct.modifier.includeSurroundings({0:selection,radius:radius})}},{"@desc":"Exclusive within, equivalent to (within 3 of X) and not X","@examples":["exwithin 10 of resname HEM"],name:"exwithin",type:h.prefix,rule:h.prefixOp(/EXWITHIN\s+([-+]?[0-9]*\.?[0-9]+)\s+OF/i,1).map(function(x){return parseFloat(x)}),map:function(radius,target){return builder_1.default.struct.modifier.exceptBy({0:builder_1.default.struct.filter.within({0:builder_1.default.struct.generator.atomGroups(),target:target,"max-radius":radius}),by:target})}},{"@desc":"Selects atoms which have the same keyword as the atoms in a given selection","@examples":["same resid as name FE"],name:"same",type:h.prefix,rule:h.prefixOp(new RegExp("SAME\\s+("+propNames+")\\s+AS","i"),1).map(function(x){return properties_1.default[x].property}),map:function(property,source){return builder_1.default.struct.filter.withSameAtomProperties({0:builder_1.default.struct.generator.atomGroups(),source:source,property:property})}},{"@desc":"Selects atoms included in both s1 and s2.","@examples":["backbone and protein"],name:"and",type:h.binaryLeft,rule:P.alt(h.infixOp(/AND/i),P.whitespace),map:function(op,selection,by){return builder_1.default.struct.modifier.intersectBy({0:selection,by:by})}},{"@desc":"Selects atoms included in either s1 or s2.","@examples":["water or protein"],name:"or",type:h.binaryLeft,rule:h.infixOp(/OR/i),map:function(op,s1,s2){return builder_1.default.struct.combinator.merge([s1,s2])}}];exports.default=operators},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var h=__webpack_require__(17);var builder_1=__webpack_require__(6);function proteinExpr(){return builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.set.isSubset([h.atomNameSet(["C","N","CA","O"]),builder_1.default.ammpSet("label_atom_id")])})}function nucleicExpr(){return builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.logic.and([builder_1.default.core.set.isSubset([h.atomNameSet(["P"]),builder_1.default.ammpSet("label_atom_id")]),builder_1.default.core.logic.or([builder_1.default.core.set.isSubset([h.atomNameSet(["O3'","C3'","C4'","C5'","O5'"]),builder_1.default.ammpSet("label_atom_id")]),builder_1.default.core.set.isSubset([h.atomNameSet(["O3*","C3*","C4*","C5*","O5*"]),builder_1.default.ammpSet("label_atom_id")])])])})}function backboneExpr(){return builder_1.default.struct.combinator.merge([builder_1.default.struct.generator.queryInSelection({0:proteinExpr(),query:builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([h.atomNameSet(Backbone.protein),builder_1.default.ammp("label_atom_id")])})}),builder_1.default.struct.generator.queryInSelection({0:nucleicExpr(),query:builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.set.has([h.atomNameSet(Backbone.nucleic),builder_1.default.ammp("label_atom_id")])})})])}function secStrucExpr(flags){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.flags.hasAll([builder_1.default.ammp("secondaryStructureFlags"),builder_1.default.struct.type.secondaryStructureFlags(flags)])})}var Backbone={nucleic:["P","O3'","O5'","C5'","C4'","C3'","OP1","OP2","O3*","O5*","C5*","C4*","C3*"],protein:["C","N","CA","O"]};var ResDict={acidic:["ASP","GLU"],aliphatic:["ALA","GLY","ILE","LEU","VAL"],aromatic:["HIS","PHE","TRP","TYR"],at:["ADA","A","THY","T"],basic:["ARG","HIS","LYS"],buried:["ALA","LEU","VAL","ILE","PHE","CYS","MET","TRP"],cg:["CYT","C","GUA","G"],cyclic:["HIS","PHE","PRO","TRP","TYR"],hydrophobic:["ALA","LEU","VAL","ILE","PRO","PHE","MET","TRP"],medium:["VAL","THR","ASP","ASN","PRO","CYS","ASX","PCA","HYP"],neutral:["VAL","PHE","GLN","TYR","HIS","CYS","MET","TRP","ASX","GLX","PCA","HYP"],purine:["ADE","A","GUA","G"],pyrimidine:["CYT","C","THY","T","URI","U"],small:["ALA","GLY","SER"],water:["H2O","HH0","OHH","HOH","OH2","SOL","WAT","TIP","TIP2","TIP3","TIP4"]};var keywords={all:{"@desc":"everything",map:function(){return builder_1.default.struct.generator.atomGroups()}},none:{"@desc":"nothing",map:function(){return builder_1.default.struct.generator.empty()}},protein:{"@desc":"a residue with atoms named C, N, CA, and O",map:function(){return proteinExpr()}},nucleic:{"@desc":"a residue with atoms named P, O1P, O2P and either O3', C3', C4', C5', O5' or O3*, C3*, C4*, C5*, O5*. This definition assumes that the base is phosphorylated, an assumption which will be corrected in the future.",map:function(){return nucleicExpr()}},backbone:{"@desc":"the C, N, CA, and O atoms of a protein and the equivalent atoms in a nucleic acid.",map:function(){return backboneExpr()}},sidechain:{"@desc":"non-backbone atoms and bonds",map:function(){return h.invertExpr(backboneExpr())}},water:{"@desc":"all atoms with the resname H2O, HH0, OHH, HOH, OH2, SOL, WAT, TIP, TIP2, TIP3 or TIP4",abbr:["waters"],map:function(){return h.resnameExpr(ResDict.water)}},at:{"@desc":"residues named ADA A THY T",map:function(){return h.resnameExpr(ResDict.at)}},acidic:{"@desc":"residues named ASP GLU",map:function(){return h.resnameExpr(ResDict.acidic)}},acyclic:{"@desc":'"protein and not cyclic"',map:function(){return builder_1.default.struct.modifier.intersectBy({0:proteinExpr(),by:h.invertExpr(h.resnameExpr(ResDict.cyclic))})}},aliphatic:{"@desc":"residues named ALA GLY ILE LEU VAL",map:function(){return h.resnameExpr(ResDict.aliphatic)}},alpha:{"@desc":"atom's residue is an alpha helix",map:function(){return secStrucExpr(["alpha"])}},amino:{"@desc":"a residue with atoms named C, N, CA, and O",map:function(){return proteinExpr()}},aromatic:{"@desc":"residues named HIS PHE TRP TYR",map:function(){return h.resnameExpr(ResDict.aromatic)}},basic:{"@desc":"residues named ARG HIS LYS",map:function(){return h.resnameExpr(ResDict.basic)}},bonded:{"@desc":"atoms for which numbonds > 0",map:function(){return h.asAtoms(builder_1.default.struct.filter.pick({0:builder_1.default.struct.modifier.includeConnected({0:builder_1.default.struct.generator.atomGroups(),"bond-test":builder_1.default.core.flags.hasAny([builder_1.default.struct.bondProperty.flags(),builder_1.default.struct.type.bondFlags(["covalent","metallic","sulfide"])])}),test:builder_1.default.core.rel.gr([builder_1.default.struct.atomSet.atomCount(),1])}))}},buried:{"@desc":"residues named ALA LEU VAL ILE PHE CYS MET TRP",map:function(){return h.resnameExpr(ResDict.buried)}},cg:{"@desc":"residues named CYT C GUA G",map:function(){return h.resnameExpr(ResDict.cg)}},charged:{"@desc":'"basic or acidic"',map:function(){return h.resnameExpr(ResDict.basic.concat(ResDict.acidic))}},cyclic:{"@desc":"residues named HIS PHE PRO TRP TYR",map:function(){return h.resnameExpr(ResDict.cyclic)}},hetero:{"@desc":'"not (protein or nucleic)"',map:function(){return h.invertExpr(builder_1.default.struct.combinator.merge([proteinExpr(),nucleicExpr()]))}},hydrogen:{"@desc":'name "[0-9]?H.*"',map:function(){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.str.match([builder_1.default.core.type.regex(["^[0-9]?[H].*$","i"]),builder_1.default.core.type.str([builder_1.default.ammp("label_atom_id")])])})}},large:{"@desc":'"protein and not (small or medium)"',map:function(){return builder_1.default.struct.modifier.intersectBy({0:proteinExpr(),by:h.invertExpr(h.resnameExpr(ResDict.small.concat(ResDict.medium)))})}},medium:{"@desc":"residues named VAL THR ASP ASN PRO CYS ASX PCA HYP",map:function(){return h.resnameExpr(ResDict.medium)}},neutral:{"@desc":"residues named VAL PHE GLN TYR HIS CYS MET TRP ASX GLX PCA HYP",map:function(){return h.resnameExpr(ResDict.neutral)}},hydrophobic:{"@desc":"hydrophobic resname ALA LEU VAL ILE PRO PHE MET TRP",map:function(){return h.resnameExpr(ResDict.hydrophobic)}},polar:{"@desc":'"protein and not hydrophobic"',map:function(){return builder_1.default.struct.modifier.intersectBy({0:proteinExpr(),by:h.invertExpr(h.resnameExpr(ResDict.hydrophobic))})}},purine:{"@desc":"residues named ADE A GUA G",map:function(){return h.resnameExpr(ResDict.purine)}},pyrimidine:{"@desc":"residues named CYT C THY T URI U",map:function(){return h.resnameExpr(ResDict.pyrimidine)}},small:{"@desc":"residues named ALA GLY SER",map:function(){return h.resnameExpr(ResDict.small)}},surface:{"@desc":'"protein and not buried"',map:function(){return builder_1.default.struct.modifier.intersectBy({0:proteinExpr(),by:h.invertExpr(h.resnameExpr(ResDict.buried))})}},alpha_helix:{"@desc":"atom's residue is in an alpha helix",map:function(){return secStrucExpr(["alpha"])}},pi_helix:{"@desc":"atom's residue is in a pi helix",map:function(){return secStrucExpr(["pi"])}},helix_3_10:{"@desc":"atom's residue is in a 3-10 helix",map:function(){return secStrucExpr(["3-10"])}},helix:{"@desc":"atom's residue is in an alpha or pi or 3-10 helix",map:function(){return secStrucExpr(["helix"])}},extended_beta:{"@desc":"atom's residue is a beta sheet",map:function(){return secStrucExpr(["sheet"])}},bridge_beta:{"@desc":"atom's residue is a beta sheet",map:function(){return secStrucExpr(["strand"])}},sheet:{"@desc":"atom's residue is a beta sheet",map:function(){return secStrucExpr(["beta"])}},turn:{"@desc":"atom's residue is in a turn conformation",map:function(){return secStrucExpr(["turn"])}},coil:{"@desc":"atom's residue is in a coil conformation",map:function(){return builder_1.default.struct.modifier.intersectBy({0:proteinExpr(),by:secStrucExpr(["none"])})}}};exports.default=keywords},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var builder_1=__webpack_require__(6);var functions={sqr:{"@desc":"square of x","@examples":["sqr(2)"],map:function(x){return builder_1.default.core.math.pow([x,2])}},sqrt:{"@desc":"square root of x","@examples":["sqrt(2)"],map:function(x){return builder_1.default.core.math.sqrt([x])}},abs:{"@desc":"absolute value of x","@examples":["abs(2)"],map:function(x){return builder_1.default.core.math.abs([x])}},floor:{"@desc":"largest integer not greater than x","@examples":["floor(2)"],map:function(x){return builder_1.default.core.math.floor([x])}},ceil:{"@desc":"smallest integer not less than x","@examples":["ceil(2)"],map:function(x){return builder_1.default.core.math.ceil([x])}},sin:{"@desc":"sine of x","@examples":["sin(2)"],map:function(x){return builder_1.default.core.math.sin([x])}},cos:{"@desc":"cosine of x","@examples":["cos(2)"],map:function(x){return builder_1.default.core.math.cos([x])}},tan:{"@desc":"tangent of x","@examples":["tan(2)"],map:function(x){return builder_1.default.core.math.tan([x])}},atan:{"@desc":"arctangent of x","@examples":["atan(2)"],map:function(x){return builder_1.default.core.math.atan([x])}},asin:{"@desc":"arcsin of x","@examples":["asin(2)"],map:function(x){return builder_1.default.core.math.asin([x])}},acos:{"@desc":"arccos of x","@examples":["acos(2)"],map:function(x){return builder_1.default.core.math.acos([x])}},sinh:{"@desc":"hyperbolic sine of x","@examples":["sinh(2)"],map:function(x){return builder_1.default.core.math.sinh([x])}},cosh:{"@desc":"hyperbolic cosine of x","@examples":["cosh(2)"],map:function(x){return builder_1.default.core.math.cosh([x])}},tanh:{"@desc":"hyperbolic tangent of x","@examples":["tanh(2)"],map:function(x){return builder_1.default.core.math.tanh([x])}},exp:{"@desc":"e to the power x","@examples":["exp(2)"],map:function(x){return builder_1.default.core.math.exp([x])}},log:{"@desc":"natural log of x","@examples":["log(2)"],map:function(x){return builder_1.default.core.math.log([x])}},log10:{"@desc":"log base 10 of x","@examples":["log10(2)"],map:function(x){return builder_1.default.core.math.log10([x])}}};exports.default=functions},function(module,exports,__webpack_require__){"use strict";(function(process){Object.defineProperty(exports,"__esModule",{value:true});var symbol_table_1=__webpack_require__(34);var symbol_1=__webpack_require__(24);var formatter_1=__webpack_require__(91);function formatArgs(args){if(args.kind==="list"){return""+formatter_1.default(args.type)+(args.nonEmpty?"+":"*")}var map=args.map;var keys=Object.keys(map);if(!keys.length)return"()";var formatted=[];var isArgArray=true,argIndex=0;for(var _i=0,keys_1=keys;_i<keys_1.length;_i++){var key=keys_1[_i];if(isNaN(key)||+key!==argIndex){isArgArray=false;break}argIndex++}var isInline=isArgArray&&keys.every(function(k){return!map[k].description});formatted.push(isArgArray?"(":"{");formatted.push(isInline?"":"\n");argIndex=0;for(var _a=0,keys_2=keys;_a<keys_2.length;_a++){var key=keys_2[_a];var arg=map[key];if(!isInline)formatted.push("  ");if(!isNaN(key)){formatted.push(""+(arg.isOptional?"?":"")+formatter_1.default(arg.type)+(arg.isRest?"*":""))}else{formatted.push(""+key+(arg.isOptional?"?:":":")+" "+formatter_1.default(arg.type)+(arg.isRest?"*":""))}if(arg.defaultValue!==void 0)formatted.push(" = "+arg.defaultValue);if(argIndex<keys.length-1)formatted.push(", ");if(arg.description!==void 0)formatted.push((argIndex===keys.length-1?" ":"")+"(* "+arg.description+" *)");if(!isInline)formatted.push("\n");argIndex++}formatted.push(isArgArray?")":"}");return formatted.join("")}function formatSymbol(symbol,alias){return(typeof alias==="string"?alias:alias.join(", "))+" :: "+formatArgs(symbol.args)+" => "+formatter_1.default(symbol.type)}exports.formatSymbol=formatSymbol;function _getDocs(includeToC){var ToC=["\nLanguage Reference\n==================\n\n"];var implemented=[];function formatSymbolSection(symbol,lines){var info=symbol.info;var header=formatSymbol(symbol,symbol.id);lines.push("### **"+symbol.info.name+"**");lines.push("```\n"+header+"\n```\n");if(info.description){lines.push("*"+info.description+"*\n")}}function format(depth,obj){if(symbol_1.isSymbol(obj)){formatSymbolSection(obj,implemented);return}if(obj["@header"]){implemented.push((depth>=2?"##":"#")+" "+obj["@header"]+"\n");implemented.push("-------------------\n");var tocLink=obj["@header"].toLowerCase().replace(/\s/g,"-");ToC.push(new Array(depth+1).join("  ")+" * ["+obj["@header"]+"](#"+tocLink+")")}for(var _i=0,_a=Object.keys(obj);_i<_a.length;_i++){var childKey=_a[_i];if(typeof obj[childKey]!=="object"&&!symbol_1.isSymbol(obj[childKey]))continue;format(depth+1,obj[childKey])}}format(0,symbol_table_1.default);var docs="\nMolQL\n=====\n------------------------------\n\n"+(includeToC?ToC.join("\n")+"\n":"")+implemented.join("\n");return docs}var md=void 0;function getDocs(includeToC){if(includeToC===void 0){includeToC=true}if(md)return md;md=_getDocs(includeToC);return md}exports.default=getDocs;if(typeof process!==void 0&&process.argv[2]==="-print"){console.log(getDocs())}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var lowPriorityWarning=function(){};if(process.env.NODE_ENV!=="production"){var printWarning=function(format){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}var argIndex=0;var message="Warning: "+format.replace(/%s/g,function(){return args[argIndex++]});if(typeof console!=="undefined"){console.warn(message)}try{throw new Error(message)}catch(x){}};lowPriorityWarning=function(condition,format){if(format===undefined){throw new Error("`warning(condition, format, ...args)` requires a warning "+"message argument")}if(!condition){for(var _len2=arguments.length,args=Array(_len2>2?_len2-2:0),_key2=2;_key2<_len2;_key2++){args[_key2-2]=arguments[_key2]}printWarning.apply(undefined,[format].concat(args))}}}module.exports=lowPriorityWarning}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},function(module,exports,__webpack_require__){"use strict";function isContainer(node){switch(node._type){case"Document":case"BlockQuote":case"List":case"Item":case"Paragraph":case"Heading":case"Emph":case"Strong":case"Link":case"Image":case"CustomInline":case"CustomBlock":return true;default:return false}}var resumeAt=function(node,entering){this.current=node;this.entering=entering===true};var next=function(){var cur=this.current;var entering=this.entering;if(cur===null){return null}var container=isContainer(cur);if(entering&&container){if(cur._firstChild){this.current=cur._firstChild;this.entering=true}else{this.entering=false}}else if(cur===this.root){this.current=null}else if(cur._next===null){this.current=cur._parent;this.entering=false}else{this.current=cur._next;this.entering=true}return{entering:entering,node:cur}};var NodeWalker=function(root){return{current:root,root:root,entering:true,next:next,resumeAt:resumeAt}};var Node=function(nodeType,sourcepos){this._type=nodeType;this._parent=null;this._firstChild=null;this._lastChild=null;this._prev=null;this._next=null;this._sourcepos=sourcepos;this._lastLineBlank=false;this._open=true;this._string_content=null;this._literal=null;this._listData={};this._info=null;this._destination=null;this._title=null;this._isFenced=false;this._fenceChar=null;this._fenceLength=0;this._fenceOffset=null;this._level=null;this._onEnter=null;this._onExit=null};var proto=Node.prototype;Object.defineProperty(proto,"isContainer",{get:function(){return isContainer(this)}});Object.defineProperty(proto,"type",{get:function(){return this._type}});Object.defineProperty(proto,"firstChild",{get:function(){return this._firstChild}});Object.defineProperty(proto,"lastChild",{get:function(){return this._lastChild}});Object.defineProperty(proto,"next",{get:function(){return this._next}});Object.defineProperty(proto,"prev",{get:function(){return this._prev}});Object.defineProperty(proto,"parent",{get:function(){return this._parent}});Object.defineProperty(proto,"sourcepos",{get:function(){return this._sourcepos}});Object.defineProperty(proto,"literal",{get:function(){return this._literal},set:function(s){this._literal=s}});Object.defineProperty(proto,"destination",{get:function(){return this._destination},set:function(s){this._destination=s}});Object.defineProperty(proto,"title",{get:function(){return this._title},set:function(s){this._title=s}});Object.defineProperty(proto,"info",{get:function(){return this._info},set:function(s){this._info=s}});Object.defineProperty(proto,"level",{get:function(){return this._level},set:function(s){this._level=s}});Object.defineProperty(proto,"listType",{get:function(){return this._listData.type},set:function(t){this._listData.type=t}});Object.defineProperty(proto,"listTight",{get:function(){return this._listData.tight},set:function(t){this._listData.tight=t}});Object.defineProperty(proto,"listStart",{get:function(){return this._listData.start},set:function(n){this._listData.start=n}});Object.defineProperty(proto,"listDelimiter",{get:function(){return this._listData.delimiter},set:function(delim){this._listData.delimiter=delim}});Object.defineProperty(proto,"onEnter",{get:function(){return this._onEnter},set:function(s){this._onEnter=s}});Object.defineProperty(proto,"onExit",{get:function(){return this._onExit},set:function(s){this._onExit=s}});Node.prototype.appendChild=function(child){child.unlink();child._parent=this;if(this._lastChild){this._lastChild._next=child;child._prev=this._lastChild;this._lastChild=child}else{this._firstChild=child;this._lastChild=child}};Node.prototype.prependChild=function(child){child.unlink();child._parent=this;if(this._firstChild){this._firstChild._prev=child;child._next=this._firstChild;this._firstChild=child}else{this._firstChild=child;this._lastChild=child}};Node.prototype.unlink=function(){if(this._prev){this._prev._next=this._next}else if(this._parent){this._parent._firstChild=this._next}if(this._next){this._next._prev=this._prev}else if(this._parent){this._parent._lastChild=this._prev}this._parent=null;this._next=null;this._prev=null};Node.prototype.insertAfter=function(sibling){sibling.unlink();sibling._next=this._next;if(sibling._next){sibling._next._prev=sibling}sibling._prev=this;this._next=sibling;sibling._parent=this._parent;if(!sibling._next){sibling._parent._lastChild=sibling}};Node.prototype.insertBefore=function(sibling){sibling.unlink();sibling._prev=this._prev;if(sibling._prev){sibling._prev._next=sibling}sibling._next=this;this._prev=sibling;sibling._parent=this._parent;if(!sibling._prev){sibling._parent._firstChild=sibling}};Node.prototype.walker=function(){var walker=new NodeWalker(this);return walker};module.exports=Node},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactErrorUtils=__webpack_require__(75);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var ComponentTree;var TreeTraversal;var injection={injectComponentTree:function(Injected){ComponentTree=Injected;if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(Injected&&Injected.getNodeFromInstance&&Injected.getInstanceFromNode,"EventPluginUtils.injection.injectComponentTree(...): Injected "+"module is missing getNodeFromInstance or getInstanceFromNode."):void 0}},injectTreeTraversal:function(Injected){TreeTraversal=Injected;if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(Injected&&Injected.isAncestor&&Injected.getLowestCommonAncestor,"EventPluginUtils.injection.injectTreeTraversal(...): Injected "+"module is missing isAncestor or getLowestCommonAncestor."):void 0}}};function isEndish(topLevelType){return topLevelType==="topMouseUp"||topLevelType==="topTouchEnd"||topLevelType==="topTouchCancel"}function isMoveish(topLevelType){return topLevelType==="topMouseMove"||topLevelType==="topTouchMove"}function isStartish(topLevelType){return topLevelType==="topMouseDown"||topLevelType==="topTouchStart"}var validateEventDispatches;if(process.env.NODE_ENV!=="production"){validateEventDispatches=function(event){var dispatchListeners=event._dispatchListeners;var dispatchInstances=event._dispatchInstances;var listenersIsArr=Array.isArray(dispatchListeners);var listenersLen=listenersIsArr?dispatchListeners.length:dispatchListeners?1:0;var instancesIsArr=Array.isArray(dispatchInstances);var instancesLen=instancesIsArr?dispatchInstances.length:dispatchInstances?1:0;process.env.NODE_ENV!=="production"?warning(instancesIsArr===listenersIsArr&&instancesLen===listenersLen,"EventPluginUtils: Invalid `event`."):void 0}}function executeDispatch(event,simulated,listener,inst){var type=event.type||"unknown-event";event.currentTarget=EventPluginUtils.getNodeFromInstance(inst);if(simulated){ReactErrorUtils.invokeGuardedCallbackWithCatch(type,listener,event)}else{ReactErrorUtils.invokeGuardedCallback(type,listener,event)}event.currentTarget=null}function executeDispatchesInOrder(event,simulated){var dispatchListeners=event._dispatchListeners;var dispatchInstances=event._dispatchInstances;if(process.env.NODE_ENV!=="production"){validateEventDispatches(event)}if(Array.isArray(dispatchListeners)){for(var i=0;i<dispatchListeners.length;i++){if(event.isPropagationStopped()){break}executeDispatch(event,simulated,dispatchListeners[i],dispatchInstances[i])}}else if(dispatchListeners){executeDispatch(event,simulated,dispatchListeners,dispatchInstances)}event._dispatchListeners=null;event._dispatchInstances=null}function executeDispatchesInOrderStopAtTrueImpl(event){var dispatchListeners=event._dispatchListeners;var dispatchInstances=event._dispatchInstances;if(process.env.NODE_ENV!=="production"){validateEventDispatches(event)}if(Array.isArray(dispatchListeners)){for(var i=0;i<dispatchListeners.length;i++){if(event.isPropagationStopped()){break}if(dispatchListeners[i](event,dispatchInstances[i])){return dispatchInstances[i]}}}else if(dispatchListeners){if(dispatchListeners(event,dispatchInstances)){return dispatchInstances}}return null}function executeDispatchesInOrderStopAtTrue(event){var ret=executeDispatchesInOrderStopAtTrueImpl(event);event._dispatchInstances=null;event._dispatchListeners=null;return ret}function executeDirectDispatch(event){if(process.env.NODE_ENV!=="production"){validateEventDispatches(event)}var dispatchListener=event._dispatchListeners;var dispatchInstance=event._dispatchInstances;!!Array.isArray(dispatchListener)?process.env.NODE_ENV!=="production"?invariant(false,"executeDirectDispatch(...): Invalid `event`."):_prodInvariant("103"):void 0;event.currentTarget=dispatchListener?EventPluginUtils.getNodeFromInstance(dispatchInstance):null;var res=dispatchListener?dispatchListener(event):null;event.currentTarget=null;event._dispatchListeners=null;event._dispatchInstances=null;return res}function hasDispatches(event){return!!event._dispatchListeners}var EventPluginUtils={isEndish:isEndish,isMoveish:isMoveish,isStartish:isStartish,executeDirectDispatch:executeDirectDispatch,executeDispatchesInOrder:executeDispatchesInOrder,executeDispatchesInOrderStopAtTrue:executeDispatchesInOrderStopAtTrue,hasDispatches:hasDispatches,getInstanceFromNode:function(node){return ComponentTree.getInstanceFromNode(node)},getNodeFromInstance:function(node){return ComponentTree.getNodeFromInstance(node)},isAncestor:function(a,b){return TreeTraversal.isAncestor(a,b)},getLowestCommonAncestor:function(a,b){return TreeTraversal.getLowestCommonAncestor(a,b)},getParentInstance:function(inst){return TreeTraversal.getParentInstance(inst)},traverseTwoPhase:function(target,fn,arg){return TreeTraversal.traverseTwoPhase(target,fn,arg)},traverseEnterLeave:function(from,to,fn,argFrom,argTo){return TreeTraversal.traverseEnterLeave(from,to,fn,argFrom,argTo)},injection:injection};module.exports=EventPluginUtils}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var caughtError=null;function invokeGuardedCallback(name,func,a){try{func(a)}catch(x){if(caughtError===null){caughtError=x}}}var ReactErrorUtils={invokeGuardedCallback:invokeGuardedCallback,invokeGuardedCallbackWithCatch:invokeGuardedCallback,rethrowCaughtError:function(){if(caughtError){var error=caughtError;caughtError=null;throw error}}};if(process.env.NODE_ENV!=="production"){if(typeof window!=="undefined"&&typeof window.dispatchEvent==="function"&&typeof document!=="undefined"&&typeof document.createEvent==="function"){var fakeNode=document.createElement("react");ReactErrorUtils.invokeGuardedCallback=function(name,func,a){var boundFunc=func.bind(null,a);var evtType="react-"+name;fakeNode.addEventListener(evtType,boundFunc,false);var evt=document.createEvent("Event");evt.initEvent(evtType,false,false);fakeNode.dispatchEvent(evt);fakeNode.removeEventListener(evtType,boundFunc,false)}}}module.exports=ReactErrorUtils}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function getEventTarget(nativeEvent){var target=nativeEvent.target||nativeEvent.srcElement||window;if(target.correspondingUseElement){target=target.correspondingUseElement}return target.nodeType===3?target.parentNode:target}module.exports=getEventTarget},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);var useHasFeature;if(ExecutionEnvironment.canUseDOM){useHasFeature=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==true}function isEventSupported(eventNameSuffix,capture){if(!ExecutionEnvironment.canUseDOM||capture&&!("addEventListener"in document)){return false}var eventName="on"+eventNameSuffix;var isSupported=eventName in document;if(!isSupported){var element=document.createElement("div");element.setAttribute(eventName,"return;");isSupported=typeof element[eventName]==="function"}if(!isSupported&&useHasFeature&&eventNameSuffix==="wheel"){isSupported=document.implementation.hasFeature("Events.wheel","3.0")}return isSupported}module.exports=isEventSupported},function(module,exports,__webpack_require__){"use strict";var modifierKeyToProp={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function modifierStateGetter(keyArg){var syntheticEvent=this;var nativeEvent=syntheticEvent.nativeEvent;if(nativeEvent.getModifierState){return nativeEvent.getModifierState(keyArg)}var keyProp=modifierKeyToProp[keyArg];return keyProp?!!nativeEvent[keyProp]:false}function getEventModifierState(nativeEvent){return modifierStateGetter}module.exports=getEventModifierState},function(module,exports,__webpack_require__){"use strict";(function(process){var DOMLazyTree=__webpack_require__(32);var Danger=__webpack_require__(257);var ReactDOMComponentTree=__webpack_require__(5);var ReactInstrumentation=__webpack_require__(12);var createMicrosoftUnsafeLocalFunction=__webpack_require__(81);var setInnerHTML=__webpack_require__(52);var setTextContent=__webpack_require__(120);function getNodeAfter(parentNode,node){if(Array.isArray(node)){node=node[1]}return node?node.nextSibling:parentNode.firstChild}var insertChildAt=createMicrosoftUnsafeLocalFunction(function(parentNode,childNode,referenceNode){parentNode.insertBefore(childNode,referenceNode)});function insertLazyTreeChildAt(parentNode,childTree,referenceNode){DOMLazyTree.insertTreeBefore(parentNode,childTree,referenceNode)}function moveChild(parentNode,childNode,referenceNode){if(Array.isArray(childNode)){moveDelimitedText(parentNode,childNode[0],childNode[1],referenceNode)}else{insertChildAt(parentNode,childNode,referenceNode)}}function removeChild(parentNode,childNode){if(Array.isArray(childNode)){var closingComment=childNode[1];childNode=childNode[0];removeDelimitedText(parentNode,childNode,closingComment);parentNode.removeChild(closingComment)}parentNode.removeChild(childNode)}function moveDelimitedText(parentNode,openingComment,closingComment,referenceNode){var node=openingComment;while(true){var nextNode=node.nextSibling;insertChildAt(parentNode,node,referenceNode);if(node===closingComment){break}node=nextNode}}function removeDelimitedText(parentNode,startNode,closingComment){while(true){var node=startNode.nextSibling;if(node===closingComment){break}else{parentNode.removeChild(node)}}}function replaceDelimitedText(openingComment,closingComment,stringText){var parentNode=openingComment.parentNode;var nodeAfterComment=openingComment.nextSibling;if(nodeAfterComment===closingComment){if(stringText){insertChildAt(parentNode,document.createTextNode(stringText),nodeAfterComment)}}else{if(stringText){setTextContent(nodeAfterComment,stringText);removeDelimitedText(parentNode,nodeAfterComment,closingComment)}else{removeDelimitedText(parentNode,openingComment,closingComment)}}if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(openingComment)._debugID,type:"replace text",payload:stringText})}}var dangerouslyReplaceNodeWithMarkup=Danger.dangerouslyReplaceNodeWithMarkup;if(process.env.NODE_ENV!=="production"){dangerouslyReplaceNodeWithMarkup=function(oldChild,markup,prevInstance){Danger.dangerouslyReplaceNodeWithMarkup(oldChild,markup);if(prevInstance._debugID!==0){ReactInstrumentation.debugTool.onHostOperation({instanceID:prevInstance._debugID,type:"replace with",payload:markup.toString()})}else{var nextInstance=ReactDOMComponentTree.getInstanceFromNode(markup.node);if(nextInstance._debugID!==0){ReactInstrumentation.debugTool.onHostOperation({instanceID:nextInstance._debugID,type:"mount",payload:markup.toString()})}}}}var DOMChildrenOperations={dangerouslyReplaceNodeWithMarkup:dangerouslyReplaceNodeWithMarkup,replaceDelimitedText:replaceDelimitedText,processUpdates:function(parentNode,updates){if(process.env.NODE_ENV!=="production"){var parentNodeDebugID=ReactDOMComponentTree.getInstanceFromNode(parentNode)._debugID}for(var k=0;k<updates.length;k++){var update=updates[k];switch(update.type){case"INSERT_MARKUP":insertLazyTreeChildAt(parentNode,update.content,getNodeAfter(parentNode,update.afterNode));if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"insert child",payload:{toIndex:update.toIndex,content:update.content.toString()}})}break;case"MOVE_EXISTING":moveChild(parentNode,update.fromNode,getNodeAfter(parentNode,update.afterNode));if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"move child",payload:{fromIndex:update.fromIndex,toIndex:update.toIndex}})}break;case"SET_MARKUP":setInnerHTML(parentNode,update.content);if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"replace children",payload:update.content.toString()})}break;case"TEXT_CONTENT":setTextContent(parentNode,update.content);if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"replace text",payload:update.content.toString()})}break;case"REMOVE_NODE":removeChild(parentNode,update.fromNode);if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:parentNodeDebugID,type:"remove child",payload:{fromIndex:update.fromIndex}})}break}}}};module.exports=DOMChildrenOperations}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var DOMNamespaces={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};module.exports=DOMNamespaces},function(module,exports,__webpack_require__){"use strict";var createMicrosoftUnsafeLocalFunction=function(func){if(typeof MSApp!=="undefined"&&MSApp.execUnsafeLocalFunction){return function(arg0,arg1,arg2,arg3){MSApp.execUnsafeLocalFunction(function(){return func(arg0,arg1,arg2,arg3)})}}else{return func}};module.exports=createMicrosoftUnsafeLocalFunction},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactPropTypesSecret=__webpack_require__(124);var propTypesFactory=__webpack_require__(102);var React=__webpack_require__(28);var PropTypes=propTypesFactory(React.isValidElement);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var hasReadOnlyValue={button:true,checkbox:true,image:true,hidden:true,radio:true,reset:true,submit:true};function _assertSingleLink(inputProps){!(inputProps.checkedLink==null||inputProps.valueLink==null)?process.env.NODE_ENV!=="production"?invariant(false,"Cannot provide a checkedLink and a valueLink. If you want to use checkedLink, you probably don't want to use valueLink and vice versa."):_prodInvariant("87"):void 0}function _assertValueLink(inputProps){_assertSingleLink(inputProps);!(inputProps.value==null&&inputProps.onChange==null)?process.env.NODE_ENV!=="production"?invariant(false,"Cannot provide a valueLink and a value or onChange event. If you want to use value or onChange, you probably don't want to use valueLink."):_prodInvariant("88"):void 0}function _assertCheckedLink(inputProps){_assertSingleLink(inputProps);!(inputProps.checked==null&&inputProps.onChange==null)?process.env.NODE_ENV!=="production"?invariant(false,"Cannot provide a checkedLink and a checked property or onChange event. If you want to use checked or onChange, you probably don't want to use checkedLink"):_prodInvariant("89"):void 0}var propTypes={value:function(props,propName,componentName){if(!props[propName]||hasReadOnlyValue[props.type]||props.onChange||props.readOnly||props.disabled){return null}return new Error("You provided a `value` prop to a form field without an "+"`onChange` handler. This will render a read-only field. If "+"the field should be mutable use `defaultValue`. Otherwise, "+"set either `onChange` or `readOnly`.")},checked:function(props,propName,componentName){if(!props[propName]||props.onChange||props.readOnly||props.disabled){return null}return new Error("You provided a `checked` prop to a form field without an "+"`onChange` handler. This will render a read-only field. If "+"the field should be mutable use `defaultChecked`. Otherwise, "+"set either `onChange` or `readOnly`.")},onChange:PropTypes.func};var loggedTypeFailures={};function getDeclarationErrorAddendum(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""}var LinkedValueUtils={checkPropTypes:function(tagName,props,owner){for(var propName in propTypes){if(propTypes.hasOwnProperty(propName)){var error=propTypes[propName](props,propName,tagName,"prop",null,ReactPropTypesSecret)}if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var addendum=getDeclarationErrorAddendum(owner);process.env.NODE_ENV!=="production"?warning(false,"Failed form propType: %s%s",error.message,addendum):void 0}}},getValue:function(inputProps){if(inputProps.valueLink){_assertValueLink(inputProps);return inputProps.valueLink.value}return inputProps.value},getChecked:function(inputProps){if(inputProps.checkedLink){_assertCheckedLink(inputProps);return inputProps.checkedLink.value}return inputProps.checked},executeOnChange:function(inputProps,event){if(inputProps.valueLink){_assertValueLink(inputProps);return inputProps.valueLink.requestChange(event.target.value)}else if(inputProps.checkedLink){_assertCheckedLink(inputProps);return inputProps.checkedLink.requestChange(event.target.checked)}else if(inputProps.onChange){return inputProps.onChange.call(undefined,event)}}};module.exports=LinkedValueUtils}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);var injected=false;var ReactComponentEnvironment={replaceNodeWithMarkup:null,processChildrenUpdates:null,injection:{injectEnvironment:function(environment){!!injected?process.env.NODE_ENV!=="production"?invariant(false,"ReactCompositeComponent: injectEnvironment() can only be called once."):_prodInvariant("104"):void 0;ReactComponentEnvironment.replaceNodeWithMarkup=environment.replaceNodeWithMarkup;ReactComponentEnvironment.processChildrenUpdates=environment.processChildrenUpdates;injected=true}}};module.exports=ReactComponentEnvironment}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function is(x,y){if(x===y){return x!==0||y!==0||1/x===1/y}else{return x!==x&&y!==y}}function shallowEqual(objA,objB){if(is(objA,objB)){return true}if(typeof objA!=="object"||objA===null||typeof objB!=="object"||objB===null){return false}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}for(var i=0;i<keysA.length;i++){if(!hasOwnProperty.call(objB,keysA[i])||!is(objA[keysA[i]],objB[keysA[i]])){return false}}return true}module.exports=shallowEqual},function(module,exports,__webpack_require__){"use strict";function shouldUpdateReactComponent(prevElement,nextElement){var prevEmpty=prevElement===null||prevElement===false;var nextEmpty=nextElement===null||nextElement===false;if(prevEmpty||nextEmpty){return prevEmpty===nextEmpty}var prevType=typeof prevElement;var nextType=typeof nextElement;if(prevType==="string"||prevType==="number"){return nextType==="string"||nextType==="number"}else{return nextType==="object"&&prevElement.type===nextElement.type&&prevElement.key===nextElement.key}}module.exports=shouldUpdateReactComponent},function(module,exports,__webpack_require__){"use strict";function escape(key){var escapeRegex=/[=:]/g;var escaperLookup={"=":"=0",":":"=2"};var escapedString=(""+key).replace(escapeRegex,function(match){return escaperLookup[match]});return"$"+escapedString}function unescape(key){var unescapeRegex=/(=0|=2)/g;var unescaperLookup={"=0":"=","=2":":"};var keySubstring=key[0]==="."&&key[1]==="$"?key.substring(2):key.substring(1);return(""+keySubstring).replace(unescapeRegex,function(match){return unescaperLookup[match]})}var KeyEscapeUtils={escape:escape,unescape:unescape};module.exports=KeyEscapeUtils},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactCurrentOwner=__webpack_require__(15);var ReactInstanceMap=__webpack_require__(42);var ReactInstrumentation=__webpack_require__(12);var ReactUpdates=__webpack_require__(16);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);function enqueueUpdate(internalInstance){ReactUpdates.enqueueUpdate(internalInstance)}function formatUnexpectedArgument(arg){var type=typeof arg;if(type!=="object"){return type}var displayName=arg.constructor&&arg.constructor.name||type;var keys=Object.keys(arg);if(keys.length>0&&keys.length<20){return displayName+" (keys: "+keys.join(", ")+")"}return displayName}function getInternalInstanceReadyForUpdate(publicInstance,callerName){var internalInstance=ReactInstanceMap.get(publicInstance);if(!internalInstance){if(process.env.NODE_ENV!=="production"){var ctor=publicInstance.constructor;process.env.NODE_ENV!=="production"?warning(!callerName,"%s(...): Can only update a mounted or mounting component. "+"This usually means you called %s() on an unmounted component. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,ctor&&(ctor.displayName||ctor.name)||"ReactClass"):void 0}return null}if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(ReactCurrentOwner.current==null,"%s(...): Cannot update during an existing state transition (such as "+"within `render` or another component's constructor). Render methods "+"should be a pure function of props and state; constructor "+"side-effects are an anti-pattern, but can be moved to "+"`componentWillMount`.",callerName):void 0}return internalInstance}var ReactUpdateQueue={isMounted:function(publicInstance){if(process.env.NODE_ENV!=="production"){var owner=ReactCurrentOwner.current;if(owner!==null){process.env.NODE_ENV!=="production"?warning(owner._warnedAboutRefsInRender,"%s is accessing isMounted inside its render() function. "+"render() should be a pure function of props and state. It should "+"never access something that requires stale data from the previous "+"render, such as refs. Move this logic to componentDidMount and "+"componentDidUpdate instead.",owner.getName()||"A component"):void 0;owner._warnedAboutRefsInRender=true}}var internalInstance=ReactInstanceMap.get(publicInstance);if(internalInstance){return!!internalInstance._renderedComponent}else{return false}},enqueueCallback:function(publicInstance,callback,callerName){ReactUpdateQueue.validateCallback(callback,callerName);var internalInstance=getInternalInstanceReadyForUpdate(publicInstance);if(!internalInstance){return null}if(internalInstance._pendingCallbacks){internalInstance._pendingCallbacks.push(callback)}else{internalInstance._pendingCallbacks=[callback]}enqueueUpdate(internalInstance)},enqueueCallbackInternal:function(internalInstance,callback){if(internalInstance._pendingCallbacks){internalInstance._pendingCallbacks.push(callback)}else{internalInstance._pendingCallbacks=[callback]}enqueueUpdate(internalInstance)},enqueueForceUpdate:function(publicInstance){var internalInstance=getInternalInstanceReadyForUpdate(publicInstance,"forceUpdate");if(!internalInstance){return}internalInstance._pendingForceUpdate=true;enqueueUpdate(internalInstance)},enqueueReplaceState:function(publicInstance,completeState,callback){var internalInstance=getInternalInstanceReadyForUpdate(publicInstance,"replaceState");if(!internalInstance){return}internalInstance._pendingStateQueue=[completeState];internalInstance._pendingReplaceState=true;if(callback!==undefined&&callback!==null){ReactUpdateQueue.validateCallback(callback,"replaceState");if(internalInstance._pendingCallbacks){internalInstance._pendingCallbacks.push(callback)}else{internalInstance._pendingCallbacks=[callback]}}enqueueUpdate(internalInstance)},enqueueSetState:function(publicInstance,partialState){if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onSetState();process.env.NODE_ENV!=="production"?warning(partialState!=null,"setState(...): You passed an undefined or null state object; "+"instead, use forceUpdate()."):void 0}var internalInstance=getInternalInstanceReadyForUpdate(publicInstance,"setState");if(!internalInstance){return}var queue=internalInstance._pendingStateQueue||(internalInstance._pendingStateQueue=[]);queue.push(partialState);enqueueUpdate(internalInstance)},enqueueElementInternal:function(internalInstance,nextElement,nextContext){internalInstance._pendingElement=nextElement;internalInstance._context=nextContext;enqueueUpdate(internalInstance)},validateCallback:function(callback,callerName){!(!callback||typeof callback==="function")?process.env.NODE_ENV!=="production"?invariant(false,"%s(...): Expected the last optional `callback` argument to be a function. Instead received: %s.",callerName,formatUnexpectedArgument(callback)):_prodInvariant("122",callerName,formatUnexpectedArgument(callback)):void 0}};module.exports=ReactUpdateQueue}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var emptyFunction=__webpack_require__(10);var warning=__webpack_require__(2);var validateDOMNesting=emptyFunction;if(process.env.NODE_ENV!=="production"){var specialTags=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"];var inScopeTags=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"];var buttonScopeTags=inScopeTags.concat(["button"]);var impliedEndTags=["dd","dt","li","option","optgroup","p","rp","rt"];var emptyAncestorInfo={current:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null};var updatedAncestorInfo=function(oldInfo,tag,instance){var ancestorInfo=_assign({},oldInfo||emptyAncestorInfo);var info={tag:tag,instance:instance};if(inScopeTags.indexOf(tag)!==-1){ancestorInfo.aTagInScope=null;ancestorInfo.buttonTagInScope=null;ancestorInfo.nobrTagInScope=null}if(buttonScopeTags.indexOf(tag)!==-1){ancestorInfo.pTagInButtonScope=null}if(specialTags.indexOf(tag)!==-1&&tag!=="address"&&tag!=="div"&&tag!=="p"){ancestorInfo.listItemTagAutoclosing=null;ancestorInfo.dlItemTagAutoclosing=null}ancestorInfo.current=info;if(tag==="form"){ancestorInfo.formTag=info}if(tag==="a"){ancestorInfo.aTagInScope=info}if(tag==="button"){ancestorInfo.buttonTagInScope=info}if(tag==="nobr"){ancestorInfo.nobrTagInScope=info}if(tag==="p"){ancestorInfo.pTagInButtonScope=info}if(tag==="li"){ancestorInfo.listItemTagAutoclosing=info}if(tag==="dd"||tag==="dt"){ancestorInfo.dlItemTagAutoclosing=info}return ancestorInfo};var isTagValidWithParent=function(tag,parentTag){switch(parentTag){case"select":return tag==="option"||tag==="optgroup"||tag==="#text";case"optgroup":return tag==="option"||tag==="#text";case"option":return tag==="#text";case"tr":return tag==="th"||tag==="td"||tag==="style"||tag==="script"||tag==="template";case"tbody":case"thead":case"tfoot":return tag==="tr"||tag==="style"||tag==="script"||tag==="template";case"colgroup":return tag==="col"||tag==="template";case"table":return tag==="caption"||tag==="colgroup"||tag==="tbody"||tag==="tfoot"||tag==="thead"||tag==="style"||tag==="script"||tag==="template";case"head":return tag==="base"||tag==="basefont"||tag==="bgsound"||tag==="link"||tag==="meta"||tag==="title"||tag==="noscript"||tag==="noframes"||tag==="style"||tag==="script"||tag==="template";case"html":return tag==="head"||tag==="body";case"#document":return tag==="html"}switch(tag){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return parentTag!=="h1"&&parentTag!=="h2"&&parentTag!=="h3"&&parentTag!=="h4"&&parentTag!=="h5"&&parentTag!=="h6";case"rp":case"rt":return impliedEndTags.indexOf(parentTag)===-1;case"body":case"caption":case"col":case"colgroup":case"frame":case"head":case"html":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return parentTag==null}return true};var findInvalidAncestorForTag=function(tag,ancestorInfo){switch(tag){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return ancestorInfo.pTagInButtonScope;case"form":return ancestorInfo.formTag||ancestorInfo.pTagInButtonScope;case"li":return ancestorInfo.listItemTagAutoclosing;case"dd":case"dt":return ancestorInfo.dlItemTagAutoclosing;case"button":return ancestorInfo.buttonTagInScope;case"a":return ancestorInfo.aTagInScope;case"nobr":return ancestorInfo.nobrTagInScope}return null};var findOwnerStack=function(instance){if(!instance){return[]}var stack=[];do{stack.push(instance)}while(instance=instance._currentElement._owner);stack.reverse();return stack};var didWarn={};validateDOMNesting=function(childTag,childText,childInstance,ancestorInfo){ancestorInfo=ancestorInfo||emptyAncestorInfo;var parentInfo=ancestorInfo.current;var parentTag=parentInfo&&parentInfo.tag;if(childText!=null){process.env.NODE_ENV!=="production"?warning(childTag==null,"validateDOMNesting: when childText is passed, childTag should be null"):void 0;childTag="#text"}var invalidParent=isTagValidWithParent(childTag,parentTag)?null:parentInfo;var invalidAncestor=invalidParent?null:findInvalidAncestorForTag(childTag,ancestorInfo);var problematic=invalidParent||invalidAncestor;if(problematic){var ancestorTag=problematic.tag;var ancestorInstance=problematic.instance;var childOwner=childInstance&&childInstance._currentElement._owner;var ancestorOwner=ancestorInstance&&ancestorInstance._currentElement._owner;var childOwners=findOwnerStack(childOwner);var ancestorOwners=findOwnerStack(ancestorOwner);var minStackLen=Math.min(childOwners.length,ancestorOwners.length);var i;var deepestCommon=-1;for(i=0;i<minStackLen;i++){if(childOwners[i]===ancestorOwners[i]){deepestCommon=i}else{break}}var UNKNOWN="(unknown)";var childOwnerNames=childOwners.slice(deepestCommon+1).map(function(inst){return inst.getName()||UNKNOWN});var ancestorOwnerNames=ancestorOwners.slice(deepestCommon+1).map(function(inst){return inst.getName()||UNKNOWN});var ownerInfo=[].concat(deepestCommon!==-1?childOwners[deepestCommon].getName()||UNKNOWN:[],ancestorOwnerNames,ancestorTag,invalidAncestor?["..."]:[],childOwnerNames,childTag).join(" > ");var warnKey=!!invalidParent+"|"+childTag+"|"+ancestorTag+"|"+ownerInfo;if(didWarn[warnKey]){return}didWarn[warnKey]=true;var tagDisplayName=childTag;var whitespaceInfo="";if(childTag==="#text"){if(/\S/.test(childText)){tagDisplayName="Text nodes"}else{tagDisplayName="Whitespace text nodes";whitespaceInfo=" Make sure you don't have any extra whitespace between tags on "+"each line of your source code."}}else{tagDisplayName="<"+childTag+">"}if(invalidParent){var info="";if(ancestorTag==="table"&&childTag==="tr"){info+=" Add a <tbody> to your code to match the DOM tree generated by "+"the browser."}process.env.NODE_ENV!=="production"?warning(false,"validateDOMNesting(...): %s cannot appear as a child of <%s>.%s "+"See %s.%s",tagDisplayName,ancestorTag,whitespaceInfo,ownerInfo,info):void 0}else{process.env.NODE_ENV!=="production"?warning(false,"validateDOMNesting(...): %s cannot appear as a descendant of "+"<%s>. See %s.",tagDisplayName,ancestorTag,ownerInfo):void 0}}};validateDOMNesting.updatedAncestorInfo=updatedAncestorInfo;validateDOMNesting.isTagValidInContext=function(tag,ancestorInfo){ancestorInfo=ancestorInfo||emptyAncestorInfo;var parentInfo=ancestorInfo.current;var parentTag=parentInfo&&parentInfo.tag;return isTagValidWithParent(tag,parentTag)&&!findInvalidAncestorForTag(tag,ancestorInfo)}}module.exports=validateDOMNesting}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function getEventCharCode(nativeEvent){var charCode;var keyCode=nativeEvent.keyCode;if("charCode"in nativeEvent){charCode=nativeEvent.charCode;if(charCode===0&&keyCode===13){charCode=13}}else{charCode=keyCode}if(charCode>=32||charCode===13){return charCode}return 0}module.exports=getEventCharCode},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var type_1=__webpack_require__(44);var symbol_1=__webpack_require__(24);var helpers_1=__webpack_require__(56);var Types;(function(Types){Types.AnyVar=type_1.default.Variable("a",type_1.default.Any);Types.AnyValueVar=type_1.default.Variable("a",type_1.default.Any);Types.ConstrainedVar=type_1.default.Variable("a",type_1.default.Any,true);Types.Regex=type_1.default.Value("Core","Regex");Types.Set=function(t){return type_1.default.Container("Core","Set",t||Types.AnyValueVar)};Types.List=function(t){return type_1.default.Container("Core","List",t||Types.AnyVar)};Types.Fn=function(t,alias){return type_1.default.Container("Core","Fn",t||Types.AnyVar,alias)};Types.Flags=function(t,alias){return type_1.default.Container("Core","Flags",t,alias)};Types.BitFlags=Types.Flags(type_1.default.Num,"BitFlags")})(Types=exports.Types||(exports.Types={}));function unaryOp(type,description){return helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type)}),type,description)}function binOp(type,description){return helpers_1.symbol(symbol_1.Arguments.List(type,{nonEmpty:true}),type,description)}function binRel(src,target,description){return helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(src),1:symbol_1.Argument(src)}),target,description)}var type={"@header":"Types",bool:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.AnyValue)}),type_1.default.Bool,"Convert a value to boolean."),num:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.AnyValue)}),type_1.default.Num,"Convert a value to number."),str:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.AnyValue)}),type_1.default.Str,"Convert a value to string."),regex:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Str,{description:"Expression"}),1:symbol_1.Argument(type_1.default.Str,{isOptional:true,description:"Flags, e.g. 'i' for ignore case"})}),Types.Regex,"Creates a regular expression from a string using the ECMAscript syntax."),list:helpers_1.symbol(symbol_1.Arguments.List(Types.AnyVar),Types.List()),set:helpers_1.symbol(symbol_1.Arguments.List(Types.AnyValueVar),Types.Set()),bitflags:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Num)}),Types.BitFlags,"Interpret a number as bitflags."),compositeKey:helpers_1.symbol(symbol_1.Arguments.List(type_1.default.AnyValue),type_1.default.AnyValue)};var logic={"@header":"Logic",not:unaryOp(type_1.default.Bool),and:binOp(type_1.default.Bool),or:binOp(type_1.default.Bool)};var ctrl={"@header":"Control",eval:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.Fn(Types.AnyVar))}),Types.AnyVar,"Evaluate a function."),fn:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.AnyVar)}),Types.Fn(Types.AnyVar),'Wrap an expression to a "lazy" function.'),if:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Bool,{description:"Condition"}),1:symbol_1.Argument(type_1.default.Variable("a",type_1.default.Any),{description:"If true"}),2:symbol_1.Argument(type_1.default.Variable("b",type_1.default.Any),{description:"If false"})}),type_1.default.Union([type_1.default.Variable("a",type_1.default.Any),type_1.default.Variable("b",type_1.default.Any)]))};var rel={"@header":"Relational",eq:binRel(type_1.default.Variable("a",type_1.default.AnyValue,true),type_1.default.Bool),neq:binRel(type_1.default.Variable("a",type_1.default.AnyValue,true),type_1.default.Bool),lt:binRel(type_1.default.Num,type_1.default.Bool),lte:binRel(type_1.default.Num,type_1.default.Bool),gr:binRel(type_1.default.Num,type_1.default.Bool),gre:binRel(type_1.default.Num,type_1.default.Bool),inRange:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(type_1.default.Num,{description:"Value to test"}),1:symbol_1.Argument(type_1.default.Num,{description:"Minimum value"}),2:symbol_1.Argument(type_1.default.Num,{description:"Maximum value"})}),type_1.default.Bool,"Check if the value of the 1st argument is >= 2nd and <= 3rd.")};var math={"@header":"Math",add:binOp(type_1.default.Num),sub:binOp(type_1.default.Num),mult:binOp(type_1.default.Num),div:binRel(type_1.default.Num,type_1.default.Num),pow:binRel(type_1.default.Num,type_1.default.Num),mod:binRel(type_1.default.Num,type_1.default.Num),min:binOp(type_1.default.Num),max:binOp(type_1.default.Num),floor:unaryOp(type_1.default.Num),ceil:unaryOp(type_1.default.Num),roundInt:unaryOp(type_1.default.Num),abs:unaryOp(type_1.default.Num),sqrt:unaryOp(type_1.default.Num),sin:unaryOp(type_1.default.Num),cos:unaryOp(type_1.default.Num),tan:unaryOp(type_1.default.Num),asin:unaryOp(type_1.default.Num),acos:unaryOp(type_1.default.Num),atan:unaryOp(type_1.default.Num),sinh:unaryOp(type_1.default.Num),cosh:unaryOp(type_1.default.Num),tanh:unaryOp(type_1.default.Num),exp:unaryOp(type_1.default.Num),log:unaryOp(type_1.default.Num),log10:unaryOp(type_1.default.Num),atan2:binRel(type_1.default.Num,type_1.default.Num)};var str={"@header":"Strings",concat:binOp(type_1.default.Str),match:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.Regex),1:symbol_1.Argument(type_1.default.Str)}),type_1.default.Bool)};var list={"@header":"Lists",getAt:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.List()),1:symbol_1.Argument(type_1.default.Num)}),Types.AnyVar)};var set={"@header":"Sets",has:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.Set(Types.ConstrainedVar)),1:symbol_1.Argument(Types.ConstrainedVar)}),type_1.default.Bool,"Check if the the 1st argument includes the value of the 2nd."),isSubset:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.Set(Types.ConstrainedVar)),1:symbol_1.Argument(Types.Set(Types.ConstrainedVar))}),type_1.default.Bool,"Check if the the 1st argument is a subset of the 2nd.")};var flags={"@header":"Flags",hasAny:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.Flags(Types.ConstrainedVar)),1:symbol_1.Argument(Types.Flags(Types.ConstrainedVar))}),type_1.default.Bool,"Check if the the 1st argument has at least one of the 2nd one's flags."),hasAll:helpers_1.symbol(symbol_1.Arguments.Dictionary({0:symbol_1.Argument(Types.Flags(Types.ConstrainedVar)),1:symbol_1.Argument(Types.Flags(Types.ConstrainedVar))}),type_1.default.Bool,"Check if the the 1st argument has all 2nd one's flags.")};exports.default={"@header":"Language Primitives",type:type,logic:logic,ctrl:ctrl,rel:rel,math:math,str:str,list:list,set:set,flags:flags}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function format(type){switch(type.kind){case"any":return"Any";case"any-value":return"Value";case"value":return type.name;case"variable":return type.type&&type.type.kind!=="any"?type.name+": "+format(type.type):type.name;case"container":return type.alias?type.alias:type.name+"["+format(type.child)+"]";case"union":return type.types.map(format).join(" | ");case"oneof":return type.name}}exports.default=format},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function SpatialLookup(positions){var tree=build(createInputData(positions));return{find:function(mask){var ctx=QueryContext.create(tree,mask,false);return function(x,y,z,radius){QueryContext.update(ctx,x,y,z,radius);nearest(ctx);return ctx.buffer}},check:function(mask){var ctx=QueryContext.create(tree,mask,true);return function(x,y,z,radius){QueryContext.update(ctx,x,y,z,radius);return nearest(ctx)}}}}var Box3D;(function(Box3D){function createInfinite(){return{min:[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],max:[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]}}Box3D.createInfinite=createInfinite})(Box3D||(Box3D={}));var QueryContext;(function(QueryContext){function add(ctx,distSq,index){var buffer=ctx.buffer;buffer.squaredDistances[buffer.count]=distSq;buffer.indices[buffer.count++]=index}QueryContext.add=add;function resetBuffer(buffer){buffer.count=0}function createBuffer(){return{indices:[],count:0,squaredDistances:[]}}function update(ctx,x,y,z,radius){ctx.pivot[0]=x;ctx.pivot[1]=y;ctx.pivot[2]=z;ctx.radius=radius;ctx.radiusSq=radius*radius;resetBuffer(ctx.buffer)}QueryContext.update=update;function create(structure,mask,isCheck){return{structure:structure,buffer:createBuffer(),pivot:[.1,.1,.1],radius:1.1,radiusSq:1.1*1.1,mask:mask,isCheck:isCheck}}QueryContext.create=create})(QueryContext||(QueryContext={}));function createInputData(positions){var x=positions.x,y=positions.y,z=positions.z;var bounds=Box3D.createInfinite();var count=x.length;var min=bounds.min,max=bounds.max;for(var i=0;i<count;i++){min[0]=Math.min(x[i],min[0]);min[1]=Math.min(y[i],min[1]);min[2]=Math.min(z[i],min[2]);max[0]=Math.max(x[i],max[0]);max[1]=Math.max(y[i],max[1]);max[2]=Math.max(z[i],max[2])}return{positions:positions,bounds:bounds,count:count}}function nearest(ctx){var _a=ctx.structure,_b=_a.min,minX=_b[0],minY=_b[1],minZ=_b[2],_c=_a.size,sX=_c[0],sY=_c[1],sZ=_c[2],bucketOffset=_a.bucketOffset,bucketCounts=_a.bucketCounts,bucketArray=_a.bucketArray,grid=_a.grid,_d=_a.positions,px=_d.x,py=_d.y,pz=_d.z;var r=ctx.radius,rSq=ctx.radiusSq,_e=ctx.pivot,x=_e[0],y=_e[1],z=_e[2],isCheck=ctx.isCheck,mask=ctx.mask;var loX=Math.max(0,x-r-minX>>3);var loY=Math.max(0,y-r-minY>>3);var loZ=Math.max(0,z-r-minZ>>3);var hiX=Math.min(sX,x+r-minX>>3);var hiY=Math.min(sY,y+r-minY>>3);var hiZ=Math.min(sZ,z+r-minZ>>3);for(var ix=loX;ix<=hiX;ix++){for(var iy=loY;iy<=hiY;iy++){for(var iz=loZ;iz<=hiZ;iz++){var bucketIdx=grid[(ix*sY+iy)*sZ+iz];if(bucketIdx>0){var k=bucketIdx-1;var offset=bucketOffset[k];var count=bucketCounts[k];var end=offset+count;for(var i=offset;i<end;i++){var idx=bucketArray[i];if(!mask.has(idx))continue;var dx=px[idx]-x;var dy=py[idx]-y;var dz=pz[idx]-z;var distSq=dx*dx+dy*dy+dz*dz;if(distSq<=rSq){if(isCheck)return true;QueryContext.add(ctx,distSq,idx)}}}}}}return ctx.buffer.count>0}function _build(state){var bounds=state.bounds,_a=state.size,sX=_a[0],sY=_a[1],sZ=_a[2],_b=state.positions,px=_b.x,py=_b.y,pz=_b.z,count=state.count;var n=sX*sY*sZ;var _c=bounds.min,minX=_c[0],minY=_c[1],minZ=_c[2];var bucketCount=0;var grid=new Uint32Array(n);var bucketIndex=new Int32Array(count);for(var i=0;i<count;i++){var x=px[i]-minX>>3;var y=py[i]-minY>>3;var z=pz[i]-minZ>>3;var idx=(x*sY+y)*sZ+z;if((grid[idx]+=1)===1){bucketCount+=1}bucketIndex[i]=idx}var bucketCounts=new Int32Array(bucketCount);for(var i=0,j=0;i<n;i++){var c=grid[i];if(c>0){grid[i]=j+1;bucketCounts[j]=c;j+=1}}var bucketOffset=new Uint32Array(count);for(var i=1;i<count;++i){bucketOffset[i]+=bucketOffset[i-1]+bucketCounts[i-1]}var bucketFill=new Int32Array(bucketCount);var bucketArray=new Int32Array(count);for(var i=0;i<count;i++){var bucketIdx=grid[bucketIndex[i]];if(bucketIdx>0){var k=bucketIdx-1;bucketArray[bucketOffset[k]+bucketFill[k]]=i;bucketFill[k]+=1}}return{size:state.size,bucketArray:bucketArray,bucketCounts:bucketCounts,bucketOffset:bucketOffset,grid:grid,min:state.bounds.min,positions:state.positions}}function build(_a){var positions=_a.positions,bounds=_a.bounds,count=_a.count;var size=[(bounds.max[0]-bounds.min[0]>>3)+1,(bounds.max[1]-bounds.min[1]>>3)+1,(bounds.max[2]-bounds.min[2]>>3)+1];var state={size:size,positions:positions,bounds:bounds,count:count};return _build(state)}exports.default=SpatialLookup},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var data_1=__webpack_require__(13);var collections_1=__webpack_require__(8);var compute_1=__webpack_require__(155);function Rings(model){var rings=compute_1.default(model);var byFingerprint=collections_1.FastMap.create();var dataIndex=model.atoms.dataIndex;var type_symbol=model.data.atom_site.type_symbol;var idx=0;for(var _i=0,rings_1=rings;_i<rings_1.length;_i++){var r=rings_1[_i];var elements=[];for(var _a=0,r_1=r;_a<r_1.length;_a++){var a=r_1[_a];elements[elements.length]=data_1.ElementSymbol(type_symbol.getString(dataIndex[a]))}var fp=getRingFingerprint(elements);if(byFingerprint.has(fp))byFingerprint.get(fp).push(idx);else byFingerprint.set(fp,[idx]);idx++}return{all:rings,byFingerprint:byFingerprint}}function getMinimalRotation(elements){var len=elements.length;var f=new Int32Array(len*2);for(var i=0;i<f.length;i++)f[i]=-1;var u="",v="",k=0;for(var j=1;j<f.length;j++){var i=f[j-k-1];while(i!==-1){u=elements[j%len];v=elements[(k+i+1)%len];if(u===v)break;if(u<v)k=j-i-1;i=f[i]}if(i===-1){u=elements[j%len];v=elements[(k+i+1)%len];if(u!==v){if(u<v)k=j;f[j-k]=-1}else f[j-k]=i+1}else f[j-k]=i+1}return k}function buildFinderprint(elements,offset){var len=elements.length;var ret=[];var i;for(i=0;i<len-1;i++){ret.push(elements[(i+offset)%len]);ret.push("-")}ret.push(elements[(i+offset)%len]);return ret.join("")}function getRingFingerprint(elements){var len=elements.length;var reversed=new Array(len);for(var i=0;i<len;i++)reversed[i]=elements[len-i-1];var rotNormal=getMinimalRotation(elements);var rotReversed=getMinimalRotation(reversed);var isNormalSmaller=false;for(var i=0;i<len;i++){var u=elements[(i+rotNormal)%len],v=reversed[(i+rotReversed)%len];if(u!==v){isNormalSmaller=u<v;break}}if(isNormalSmaller)return buildFinderprint(elements,rotNormal);return buildFinderprint(reversed,rotReversed)}exports.getRingFingerprint=getRingFingerprint;exports.default=Rings},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=__webpack_require__(25);var atom_set_1=__webpack_require__(14);var element_address_1=__webpack_require__(26);var atom_selection_1=__webpack_require__(19);var collections_1=__webpack_require__(8);var mask_1=__webpack_require__(27);var data_1=__webpack_require__(13);var common_1=__webpack_require__(60);var AtomSetIt=atom_set_1.default.Iterator;function pick(env,selection,pred){var sel=selection(env);var ret=atom_selection_1.default.linearBuilder();environment_1.default.lockSlot(env,"atomSet");var slots=env.slots;for(var _i=0,_a=atom_selection_1.default.atomSets(sel);_i<_a.length;_i++){var atomSet=_a[_i];slots.atomSet=atomSet;if(pred(env))ret.add(atomSet)}environment_1.default.unlockSlot(env,"atomSet");return ret.getSelection()}exports.pick=pick;function getAtomSetProperties(env,atomSet,prop,set){var model=env.context.model;environment_1.default.lockSlot(env,"element");var element=env.slots.element;var it=AtomSetIt();for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){element_address_1.default.setAtom(model,element,a);var p=prop(env);if(p!==void 0)set.add(p)}environment_1.default.unlockSlot(env,"element");return set}exports.getAtomSetProperties=getAtomSetProperties;function getAtomSelectionProperties(env,selection,prop){var set=collections_1.FastSet.create();environment_1.default.lockSlot(env,"atomSet");var slots=env.slots;for(var _i=0,_a=atom_selection_1.default.atomSets(selection(env));_i<_a.length;_i++){var atomSet=_a[_i];slots.atomSet=atomSet;getAtomSetProperties(env,atomSet,prop,set)}environment_1.default.unlockSlot(env,"atomSet");return set}function withSameAtomProperties(env,selection,source,prop){var sel=selection(env);var propSet=getAtomSelectionProperties(env,source,prop);var ret=atom_selection_1.default.linearBuilder();environment_1.default.lockSlot(env,"atomSet");var slots=env.slots;for(var _i=0,_a=atom_selection_1.default.atomSets(sel);_i<_a.length;_i++){var atomSet=_a[_i];slots.atomSet=atomSet;var props=getAtomSetProperties(env,atomSet,prop,collections_1.FastSet.create());if(collections_1.FastSet.isSubset(props,propSet))ret.add(atomSet)}environment_1.default.unlockSlot(env,"atomSet");return ret.getSelection()}exports.withSameAtomProperties=withSameAtomProperties;function areIntersectedBy(env,selection,by){var mask=atom_selection_1.default.getMask(by(env));var builder=atom_selection_1.default.linearBuilder();var it=AtomSetIt();for(var _i=0,_a=atom_selection_1.default.atomSets(selection(env));_i<_a.length;_i++){var atomSet=_a[_i];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(mask.has(a)){builder.add(atomSet);break}}}return builder.getSelection()}exports.areIntersectedBy=areIntersectedBy;function withinMaxRadius(_a){var env=_a.env,selection=_a.selection,target=_a.target,maxRadius=_a.maxRadius,invert=_a.invert;var model=env.context.model;var _b=model.positions,x=_b.x,y=_b.y,z=_b.z;var mask=atom_selection_1.default.getMask(target);var checkWithin=data_1.Model.spatialLookup(env.context.model).check(mask);var ret=atom_selection_1.default.linearBuilder();var it=AtomSetIt();for(var _i=0,_c=atom_selection_1.default.atomSets(selection);_i<_c.length;_i++){var atomSet=_c[_i];var withinRadius=false;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(checkWithin(x[a],y[a],z[a],maxRadius)){withinRadius=true;break}}if(withinRadius){if(!invert)ret.add(atomSet)}else if(invert)ret.add(atomSet)}return ret.getSelection()}var _itA=AtomSetIt(),_itB=AtomSetIt();function areWithinWithAtomRadius(ctx,a,b){if(a===b)return 0;var env=ctx.env,model=ctx.model,slot=ctx.slot,minRadius=ctx.minRadius,maxRadius=ctx.maxRadius,atomRadius=ctx.atomRadius;var dist=Number.POSITIVE_INFINITY;var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;var itA=_itA,itB=_itB;for(var i=AtomSetIt.start(itA,a);!itA.done;i=itA.next().value){element_address_1.default.setAtom(model,slot,i);var rA=atomRadius(env);for(var j=AtomSetIt.start(itB,b);!itB.done;j=itB.next().value){element_address_1.default.setAtom(model,slot,j);var rB=atomRadius(env);var d=Math.sqrt(atom_set_1.default.atomDistanceSq(x,y,z,i,j))-rA-rB;if(d<0)d=0;if(d<minRadius)return false;if(d<dist)dist=d}}return dist<=maxRadius}function withinMinMaxRadius(_a){var env=_a.env,selection=_a.selection,target=_a.target,minRadius=_a.minRadius,maxRadius=_a.maxRadius,atomRadius=_a.atomRadius,invert=_a.invert;var model=env.context.model;var ret=atom_selection_1.default.linearBuilder();var maxAtomRadiusSrc=common_1.maxAtomValueInSelection(env,selection,atomRadius);var maxAtomRadiusTarget=common_1.maxAtomValueInSelection(env,target,atomRadius);var targetLookup=atom_selection_1.default.lookup3d(model,target);var radius=maxRadius+maxAtomRadiusSrc+maxAtomRadiusTarget;var targetSets=atom_selection_1.default.atomSets(target);environment_1.default.lockSlot(env,"element");var element=env.slots.element;var distCtx={env:env,model:model,atomRadius:atomRadius,maxRadius:maxRadius,minRadius:minRadius,slot:element};for(var _i=0,_b=atom_selection_1.default.atomSets(selection);_i<_b.length;_i++){var atomSet=_b[_i];var within_1=targetLookup.queryAtomSet(atomSet,radius);var withinRadius=false;for(var _c=0,within_2=within_1;_c<within_2.length;_c++){var setIndex=within_2[_c];if(areWithinWithAtomRadius(distCtx,atomSet,targetSets[setIndex])){withinRadius=true}}if(withinRadius){if(!invert)ret.add(atomSet)}else if(invert)ret.add(atomSet)}environment_1.default.unlockSlot(env,"element");return ret.getSelection()}function _zeroRadius(env){return 0}function within(env,params){var ctx={env:env,selection:params.selection(env),target:params.target(env),maxRadius:params.maxRadius(env),minRadius:params.minRadius?params.minRadius(env):0,atomRadius:params.atomRadius||_zeroRadius,invert:params.invert?params.invert(env):false};if(ctx.minRadius===0&&ctx.atomRadius===_zeroRadius){return withinMaxRadius(ctx)}else{return withinMinMaxRadius(ctx)}}exports.within=within;function isConnectedTo(env,_a){var selection=_a.selection,target=_a.target,disjunct=_a.disjunct,invert=_a.invert,bondTest=_a.bondTest;var model=env.context.model;var sel=selection(env);var _b=data_1.Model.bonds(model),neighbor=_b.neighbor,bondAtomOffset=_b.offset,order=_b.order,flags=_b.flags;var targetMask=atom_selection_1.default.getMask(target(env));var disjuncted=disjunct?!!disjunct(env):false;var inverted=!!invert&&!!invert(env);var test=bondTest||common_1.defaultBondTest;environment_1.default.lockSlot(env,"bond");var bond=env.slots.bond;var ret=atom_selection_1.default.linearBuilder();var it=AtomSetIt();for(var _i=0,_c=atom_selection_1.default.atomSets(sel);_i<_c.length;_i++){var atomSet=_c[_i];var setMask=disjuncted?atom_set_1.default.getMask(atomSet):mask_1.default.never;var isConnected=false;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){var start=bondAtomOffset[a],end=bondAtomOffset[a+1];for(var t=start;t<end;t++){var b=neighbor[t];if(targetMask.has(b)){if(!disjuncted||!setMask.has(b)){if(common_1.testBond(env,bond,a,b,order[t],flags[t],test)){isConnected=true;break}}}}if(isConnected)break}if(isConnected){if(!inverted)ret.add(atomSet)}else if(inverted){if(disjuncted){var isFullSubset=true;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(!targetMask.has(a)){isFullSubset=false;break}}if(!isFullSubset)ret.add(atomSet)}else{ret.add(atomSet)}}}environment_1.default.unlockSlot(env,"bond");return ret.getSelection()}exports.isConnectedTo=isConnectedTo},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var litemol_1=__webpack_require__(55);var writer_1=__webpack_require__(164);var atom_selection_1=__webpack_require__(19);var atom_set_1=__webpack_require__(14);function ResultEntry(model,atomSet){var residueIndices=atom_set_1.default.hierarchy(model,atomSet).residueIndices;var dataIndex=model.atoms.dataIndex;var atomOffset=model.residues.atomOffset;var _a=model.data.atom_site,label_comp_id=_a.label_comp_id,label_atom_id=_a.label_atom_id;var signature="";var indices=atom_set_1.default.toIndices(atomSet);if(indices.length===1){var i=dataIndex[indices[0]];signature=label_atom_id.getString(i)+" ("+label_comp_id.getString(i)+")"}else{var counts_1={};for(var _i=0,residueIndices_1=residueIndices;_i<residueIndices_1.length;_i++){var rI=residueIndices_1[_i];var i=dataIndex[atomOffset[rI]];var n=label_comp_id.getString(i);counts_1[n]=(counts_1[n]|0)+1}signature=Object.keys(counts_1).sort().map(function(k){return counts_1[k]>1?k+"x"+counts_1[k]:k}).join("-")}return{indices:indices,info:indices.length+" "+(indices.length!==1?"atoms":"atom")+" on "+residueIndices.length+" "+(residueIndices.length!==1?"residues":"residue"),signature:signature}}exports.ResultEntry=ResultEntry;function Result(model,selection,merge){var allIndices=atom_selection_1.default.getAtomIndices(selection);if(allIndices.length>0&&merge){var atomSet=atom_set_1.default(atom_selection_1.default.getAtomIndices(selection));return{kind:"selection",allIndices:allIndices,entries:[ResultEntry(model,atomSet)]}}return{kind:"selection",allIndices:allIndices,entries:atom_selection_1.default.atomSets(selection).map(function(s){return ResultEntry(model,s)})}}(function(Result){Result.empty={kind:"empty"};function error(message){return{kind:"error",message:message}}Result.error=error})(Result||(Result={}));(function(ResultEntry){function focus(plugin,set){var model=plugin.selectEntities("model");if(!model.length)return;var query=litemol_1.default.Core.Structure.Query.atomsFromIndices(set.indices).compile();plugin.command(litemol_1.default.Bootstrap.Command.Molecule.FocusQuery,{query:query,model:model[0]})}ResultEntry.focus=focus;function highlight(plugin,set,isOn){var model=plugin.selectEntities("model");if(!model.length)return;var query=litemol_1.default.Core.Structure.Query.atomsFromIndices(set.indices).compile();plugin.command(litemol_1.default.Bootstrap.Command.Molecule.Highlight,{query:query,model:model[0],isOn:isOn})}ResultEntry.highlight=highlight;function showCIF(model,set){var cif=btoa(writer_1.default(model,set.indices));var uri="data:text/plain;base64,"+cif;var a=document.createElement("a");if("download"in a){a.style.visibility="hidden";a.href=uri;a.target="_blank";a.download="atomset.cif";document.body.appendChild(a);a.click();a.remove()}else{window.open(uri,"_blank")}}ResultEntry.showCIF=showCIF})(ResultEntry=exports.ResultEntry||(exports.ResultEntry={}));exports.default=Result},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var json_1=__webpack_require__(165);var molql_script_1=__webpack_require__(175);var pymol_1=__webpack_require__(178);var vmd_1=__webpack_require__(181);var jmol_1=__webpack_require__(184);exports.default=[molql_script_1.default,pymol_1.default,jmol_1.default,vmd_1.default,json_1.default]},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(29),_assign=__webpack_require__(4);var ReactNoopUpdateQueue=__webpack_require__(98);var canDefineProperty=__webpack_require__(47);var emptyObject=__webpack_require__(48);var invariant=__webpack_require__(1);var lowPriorityWarning=__webpack_require__(71);function ReactComponent(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue}ReactComponent.prototype.isReactComponent={};ReactComponent.prototype.setState=function(partialState,callback){!(typeof partialState==="object"||typeof partialState==="function"||partialState==null)?process.env.NODE_ENV!=="production"?invariant(false,"setState(...): takes an object of state variables to update or a function which returns an object of state variables."):_prodInvariant("85"):void 0;this.updater.enqueueSetState(this,partialState);if(callback){this.updater.enqueueCallback(this,callback,"setState")}};ReactComponent.prototype.forceUpdate=function(callback){this.updater.enqueueForceUpdate(this);if(callback){this.updater.enqueueCallback(this,callback,"forceUpdate")}};if(process.env.NODE_ENV!=="production"){var deprecatedAPIs={isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in "+"componentWillUnmount to prevent memory leaks."],replaceState:["replaceState","Refactor your code to use setState instead (see "+"https://github.com/facebook/react/issues/3236)."]};var defineDeprecationWarning=function(methodName,info){if(canDefineProperty){Object.defineProperty(ReactComponent.prototype,methodName,{get:function(){lowPriorityWarning(false,"%s(...) is deprecated in plain JavaScript React classes. %s",info[0],info[1]);return undefined}})}};for(var fnName in deprecatedAPIs){if(deprecatedAPIs.hasOwnProperty(fnName)){defineDeprecationWarning(fnName,deprecatedAPIs[fnName])}}}function ReactPureComponent(props,context,updater){this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue}function ComponentDummy(){}ComponentDummy.prototype=ReactComponent.prototype;ReactPureComponent.prototype=new ComponentDummy;ReactPureComponent.prototype.constructor=ReactPureComponent;_assign(ReactPureComponent.prototype,ReactComponent.prototype);ReactPureComponent.prototype.isPureReactComponent=true;module.exports={Component:ReactComponent,PureComponent:ReactPureComponent}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var warning=__webpack_require__(2);function warnNoop(publicInstance,callerName){if(process.env.NODE_ENV!=="production"){var constructor=publicInstance.constructor;process.env.NODE_ENV!=="production"?warning(false,"%s(...): Can only update a mounted or mounting component. "+"This usually means you called %s() on an unmounted component. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,constructor&&(constructor.displayName||constructor.name)||"ReactClass"):void 0}}var ReactNoopUpdateQueue={isMounted:function(publicInstance){return false},enqueueCallback:function(publicInstance,callback){},enqueueForceUpdate:function(publicInstance){warnNoop(publicInstance,"forceUpdate")},enqueueReplaceState:function(publicInstance,completeState){warnNoop(publicInstance,"replaceState")},enqueueSetState:function(publicInstance,partialState){warnNoop(publicInstance,"setState")}};module.exports=ReactNoopUpdateQueue}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var REACT_ELEMENT_TYPE=typeof Symbol==="function"&&Symbol["for"]&&Symbol["for"]("react.element")||60103;module.exports=REACT_ELEMENT_TYPE},function(module,exports,__webpack_require__){"use strict";var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}module.exports=getIteratorFn},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactCurrentOwner=__webpack_require__(15);var ReactComponentTreeHook=__webpack_require__(9);var ReactElement=__webpack_require__(22);var checkReactTypeSpec=__webpack_require__(193);var canDefineProperty=__webpack_require__(47);var getIteratorFn=__webpack_require__(100);var warning=__webpack_require__(2);var lowPriorityWarning=__webpack_require__(71);function getDeclarationErrorAddendum(){if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){return" Check the render method of `"+name+"`."}}return""}function getSourceInfoErrorAddendum(elementProps){if(elementProps!==null&&elementProps!==undefined&&elementProps.__source!==undefined){var source=elementProps.__source;var fileName=source.fileName.replace(/^.*[\\\/]/,"");var lineNumber=source.lineNumber;return" Check your code at "+fileName+":"+lineNumber+"."}return""}var ownerHasKeyUseWarning={};function getCurrentComponentErrorInfo(parentType){var info=getDeclarationErrorAddendum();if(!info){var parentName=typeof parentType==="string"?parentType:parentType.displayName||parentType.name;if(parentName){info=" Check the top-level render call using <"+parentName+">."}}return info}function validateExplicitKey(element,parentType){if(!element._store||element._store.validated||element.key!=null){return}element._store.validated=true;var memoizer=ownerHasKeyUseWarning.uniqueKey||(ownerHasKeyUseWarning.uniqueKey={});var currentComponentErrorInfo=getCurrentComponentErrorInfo(parentType);if(memoizer[currentComponentErrorInfo]){return}memoizer[currentComponentErrorInfo]=true;var childOwner="";if(element&&element._owner&&element._owner!==ReactCurrentOwner.current){childOwner=" It was passed a child from "+element._owner.getName()+"."}process.env.NODE_ENV!=="production"?warning(false,'Each child in an array or iterator should have a unique "key" prop.'+"%s%s See https://fb.me/react-warning-keys for more information.%s",currentComponentErrorInfo,childOwner,ReactComponentTreeHook.getCurrentStackAddendum(element)):void 0}function validateChildKeys(node,parentType){if(typeof node!=="object"){return}if(Array.isArray(node)){for(var i=0;i<node.length;i++){var child=node[i];if(ReactElement.isValidElement(child)){validateExplicitKey(child,parentType)}}}else if(ReactElement.isValidElement(node)){if(node._store){node._store.validated=true}}else if(node){var iteratorFn=getIteratorFn(node);if(iteratorFn){if(iteratorFn!==node.entries){var iterator=iteratorFn.call(node);var step;while(!(step=iterator.next()).done){if(ReactElement.isValidElement(step.value)){validateExplicitKey(step.value,parentType)}}}}}}function validatePropTypes(element){var componentClass=element.type;if(typeof componentClass!=="function"){return}var name=componentClass.displayName||componentClass.name;if(componentClass.propTypes){checkReactTypeSpec(componentClass.propTypes,element.props,"prop",name,element,null)}if(typeof componentClass.getDefaultProps==="function"){process.env.NODE_ENV!=="production"?warning(componentClass.getDefaultProps.isReactClassApproved,"getDefaultProps is only used on classic React.createClass "+"definitions. Use a static property named `defaultProps` instead."):void 0}}var ReactElementValidator={createElement:function(type,props,children){var validType=typeof type==="string"||typeof type==="function";if(!validType){if(typeof type!=="function"&&typeof type!=="string"){var info="";if(type===undefined||typeof type==="object"&&type!==null&&Object.keys(type).length===0){info+=" You likely forgot to export your component from the file "+"it's defined in."}var sourceInfo=getSourceInfoErrorAddendum(props);if(sourceInfo){info+=sourceInfo}else{info+=getDeclarationErrorAddendum()}info+=ReactComponentTreeHook.getCurrentStackAddendum();var currentSource=props!==null&&props!==undefined&&props.__source!==undefined?props.__source:null;ReactComponentTreeHook.pushNonStandardWarningStack(true,currentSource);process.env.NODE_ENV!=="production"?warning(false,"React.createElement: type is invalid -- expected a string (for "+"built-in components) or a class/function (for composite "+"components) but got: %s.%s",type==null?type:typeof type,info):void 0;ReactComponentTreeHook.popNonStandardWarningStack()}}var element=ReactElement.createElement.apply(this,arguments);if(element==null){return element}if(validType){for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],type)}}validatePropTypes(element);return element},createFactory:function(type){var validatedFactory=ReactElementValidator.createElement.bind(null,type);validatedFactory.type=type;if(process.env.NODE_ENV!=="production"){if(canDefineProperty){Object.defineProperty(validatedFactory,"type",{enumerable:false,get:function(){lowPriorityWarning(false,"Factory.type is deprecated. Access the class directly "+"before passing it to createFactory.");Object.defineProperty(this,"type",{value:type});return type}})}}return validatedFactory},cloneElement:function(element,props,children){var newElement=ReactElement.cloneElement.apply(this,arguments);for(var i=2;i<arguments.length;i++){validateChildKeys(arguments[i],newElement.type)}validatePropTypes(newElement);return newElement}};module.exports=ReactElementValidator}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var factory=__webpack_require__(103);module.exports=function(isValidElement){var throwOnDirectAccess=false;return factory(isValidElement,throwOnDirectAccess)}},function(module,exports,__webpack_require__){"use strict";(function(process){var emptyFunction=__webpack_require__(10);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var ReactPropTypesSecret=__webpack_require__(72);var checkPropTypes=__webpack_require__(197);module.exports=function(isValidElement,throwOnDirectAccess){var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}var ANONYMOUS="<<anonymous>>";var ReactPropTypes={array:createPrimitiveTypeChecker("array"),bool:createPrimitiveTypeChecker("boolean"),func:createPrimitiveTypeChecker("function"),number:createPrimitiveTypeChecker("number"),object:createPrimitiveTypeChecker("object"),string:createPrimitiveTypeChecker("string"),symbol:createPrimitiveTypeChecker("symbol"),any:createAnyTypeChecker(),arrayOf:createArrayOfTypeChecker,element:createElementTypeChecker(),instanceOf:createInstanceTypeChecker,node:createNodeChecker(),objectOf:createObjectOfTypeChecker,oneOf:createEnumTypeChecker,oneOfType:createUnionTypeChecker,shape:createShapeTypeChecker};function is(x,y){if(x===y){return x!==0||1/x===1/y}else{return x!==x&&y!==y}}function PropTypeError(message){this.message=message;this.stack=""}PropTypeError.prototype=Error.prototype;function createChainableTypeChecker(validate){if(process.env.NODE_ENV!=="production"){var manualPropTypeCallCache={};var manualPropTypeWarningCount=0}function checkType(isRequired,props,propName,componentName,location,propFullName,secret){componentName=componentName||ANONYMOUS;propFullName=propFullName||propName;if(secret!==ReactPropTypesSecret){if(throwOnDirectAccess){invariant(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use `PropTypes.checkPropTypes()` to call them. "+"Read more at http://fb.me/use-check-prop-types")}else if(process.env.NODE_ENV!=="production"&&typeof console!=="undefined"){var cacheKey=componentName+":"+propName;if(!manualPropTypeCallCache[cacheKey]&&manualPropTypeWarningCount<3){warning(false,"You are manually calling a React.PropTypes validation "+"function for the `%s` prop on `%s`. This is deprecated "+"and will throw in the standalone `prop-types` package. "+"You may be seeing this warning due to a third-party PropTypes "+"library. See https://fb.me/react-warning-dont-call-proptypes "+"for details.",propFullName,componentName);manualPropTypeCallCache[cacheKey]=true;manualPropTypeWarningCount++}}}if(props[propName]==null){if(isRequired){if(props[propName]===null){return new PropTypeError("The "+location+" `"+propFullName+"` is marked as required "+("in `"+componentName+"`, but its value is `null`."))}return new PropTypeError("The "+location+" `"+propFullName+"` is marked as required in "+("`"+componentName+"`, but its value is `undefined`."))}return null}else{return validate(props,propName,componentName,location,propFullName)}}var chainedCheckType=checkType.bind(null,false);chainedCheckType.isRequired=checkType.bind(null,true);return chainedCheckType}function createPrimitiveTypeChecker(expectedType){function validate(props,propName,componentName,location,propFullName,secret){var propValue=props[propName];var propType=getPropType(propValue);if(propType!==expectedType){var preciseType=getPreciseType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+preciseType+"` supplied to `"+componentName+"`, expected ")+("`"+expectedType+"`."))}return null}return createChainableTypeChecker(validate)}function createAnyTypeChecker(){return createChainableTypeChecker(emptyFunction.thatReturnsNull)}function createArrayOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside arrayOf.")}var propValue=props[propName];if(!Array.isArray(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an array."))}for(var i=0;i<propValue.length;i++){var error=typeChecker(propValue,i,componentName,location,propFullName+"["+i+"]",ReactPropTypesSecret);if(error instanceof Error){return error}}return null}return createChainableTypeChecker(validate)}function createElementTypeChecker(){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];if(!isValidElement(propValue)){var propType=getPropType(propValue);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected a single ReactElement."))}return null}return createChainableTypeChecker(validate)}function createInstanceTypeChecker(expectedClass){function validate(props,propName,componentName,location,propFullName){if(!(props[propName]instanceof expectedClass)){var expectedClassName=expectedClass.name||ANONYMOUS;var actualClassName=getClassName(props[propName]);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+actualClassName+"` supplied to `"+componentName+"`, expected ")+("instance of `"+expectedClassName+"`."))}return null}return createChainableTypeChecker(validate)}function createEnumTypeChecker(expectedValues){if(!Array.isArray(expectedValues)){process.env.NODE_ENV!=="production"?warning(false,"Invalid argument supplied to oneOf, expected an instance of array."):void 0;return emptyFunction.thatReturnsNull}function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];for(var i=0;i<expectedValues.length;i++){if(is(propValue,expectedValues[i])){return null}}var valuesString=JSON.stringify(expectedValues);return new PropTypeError("Invalid "+location+" `"+propFullName+"` of value `"+propValue+"` "+("supplied to `"+componentName+"`, expected one of "+valuesString+"."))}return createChainableTypeChecker(validate)}function createObjectOfTypeChecker(typeChecker){function validate(props,propName,componentName,location,propFullName){if(typeof typeChecker!=="function"){return new PropTypeError("Property `"+propFullName+"` of component `"+componentName+"` has invalid PropType notation inside objectOf.")}var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type "+("`"+propType+"` supplied to `"+componentName+"`, expected an object."))}for(var key in propValue){if(propValue.hasOwnProperty(key)){var error=typeChecker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error instanceof Error){return error}}}return null}return createChainableTypeChecker(validate)}function createUnionTypeChecker(arrayOfTypeCheckers){if(!Array.isArray(arrayOfTypeCheckers)){process.env.NODE_ENV!=="production"?warning(false,"Invalid argument supplied to oneOfType, expected an instance of array."):void 0;return emptyFunction.thatReturnsNull}for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(typeof checker!=="function"){warning(false,"Invalid argument supplid to oneOfType. Expected an array of check functions, but "+"received %s at index %s.",getPostfixForTypeWarning(checker),i);return emptyFunction.thatReturnsNull}}function validate(props,propName,componentName,location,propFullName){for(var i=0;i<arrayOfTypeCheckers.length;i++){var checker=arrayOfTypeCheckers[i];if(checker(props,propName,componentName,location,propFullName,ReactPropTypesSecret)==null){return null}}return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to "+("`"+componentName+"`."))}return createChainableTypeChecker(validate)}function createNodeChecker(){function validate(props,propName,componentName,location,propFullName){if(!isNode(props[propName])){return new PropTypeError("Invalid "+location+" `"+propFullName+"` supplied to "+("`"+componentName+"`, expected a ReactNode."))}return null}return createChainableTypeChecker(validate)}function createShapeTypeChecker(shapeTypes){function validate(props,propName,componentName,location,propFullName){var propValue=props[propName];var propType=getPropType(propValue);if(propType!=="object"){return new PropTypeError("Invalid "+location+" `"+propFullName+"` of type `"+propType+"` "+("supplied to `"+componentName+"`, expected `object`."))}for(var key in shapeTypes){var checker=shapeTypes[key];if(!checker){continue}var error=checker(propValue,key,componentName,location,propFullName+"."+key,ReactPropTypesSecret);if(error){return error}}return null}return createChainableTypeChecker(validate)}function isNode(propValue){switch(typeof propValue){case"number":case"string":case"undefined":return true;case"boolean":return!propValue;case"object":if(Array.isArray(propValue)){return propValue.every(isNode)}if(propValue===null||isValidElement(propValue)){return true}var iteratorFn=getIteratorFn(propValue);if(iteratorFn){var iterator=iteratorFn.call(propValue);var step;if(iteratorFn!==propValue.entries){while(!(step=iterator.next()).done){if(!isNode(step.value)){return false}}}else{while(!(step=iterator.next()).done){var entry=step.value;if(entry){if(!isNode(entry[1])){return false}}}}}else{return false}return true;default:return false}}function isSymbol(propType,propValue){if(propType==="symbol"){return true}if(propValue["@@toStringTag"]==="Symbol"){return true}if(typeof Symbol==="function"&&propValue instanceof Symbol){return true}return false}function getPropType(propValue){var propType=typeof propValue;if(Array.isArray(propValue)){return"array"}if(propValue instanceof RegExp){return"object"}if(isSymbol(propType,propValue)){return"symbol"}return propType}function getPreciseType(propValue){if(typeof propValue==="undefined"||propValue===null){return""+propValue}var propType=getPropType(propValue);if(propType==="object"){if(propValue instanceof Date){return"date"}else if(propValue instanceof RegExp){return"regexp"}}return propType}function getPostfixForTypeWarning(value){var type=getPreciseType(value);switch(type){case"array":case"object":return"an "+type;case"boolean":case"date":case"regexp":return"a "+type;default:return type}}function getClassName(propValue){if(!propValue.constructor||!propValue.constructor.name){return ANONYMOUS}return propValue.constructor.name}ReactPropTypes.checkPropTypes=checkPropTypes;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){var encode=__webpack_require__(208),decode=__webpack_require__(209);exports.decode=function(data,level){return(!level||level<=0?decode.XML:decode.HTML)(data)};exports.decodeStrict=function(data,level){return(!level||level<=0?decode.XML:decode.HTMLStrict)(data)};exports.encode=function(data,level){return(!level||level<=0?encode.XML:encode.HTML)(data)};exports.encodeXML=encode.XML;exports.encodeHTML4=exports.encodeHTML5=exports.encodeHTML=encode.HTML;exports.decodeXML=exports.decodeXMLStrict=decode.XML;exports.decodeHTML4=exports.decodeHTML5=exports.decodeHTML=decode.HTML;exports.decodeHTML4Strict=exports.decodeHTML5Strict=exports.decodeHTMLStrict=decode.HTMLStrict;exports.escape=encode.escape},function(module,exports){module.exports={amp:"&",apos:"'",gt:">",lt:"<",quot:'"'}},function(module,exports){module.exports={Aacute:"Á",aacute:"á",Abreve:"Ă",abreve:"ă",ac:"∾",acd:"∿",acE:"∾̳",Acirc:"Â",acirc:"â",acute:"´",Acy:"А",acy:"а",AElig:"Æ",aelig:"æ",af:"⁡",Afr:"𝔄",afr:"𝔞",Agrave:"À",agrave:"à",alefsym:"ℵ",aleph:"ℵ",Alpha:"Α",alpha:"α",Amacr:"Ā",amacr:"ā",amalg:"⨿",amp:"&",AMP:"&",andand:"⩕",And:"⩓",and:"∧",andd:"⩜",andslope:"⩘",andv:"⩚",ang:"∠",ange:"⦤",angle:"∠",angmsdaa:"⦨",angmsdab:"⦩",angmsdac:"⦪",angmsdad:"⦫",angmsdae:"⦬",angmsdaf:"⦭",angmsdag:"⦮",angmsdah:"⦯",angmsd:"∡",angrt:"∟",angrtvb:"⊾",angrtvbd:"⦝",angsph:"∢",angst:"Å",angzarr:"⍼",Aogon:"Ą",aogon:"ą",Aopf:"𝔸",aopf:"𝕒",apacir:"⩯",ap:"≈",apE:"⩰",ape:"≊",apid:"≋",apos:"'",ApplyFunction:"⁡",approx:"≈",approxeq:"≊",Aring:"Å",aring:"å",Ascr:"𝒜",ascr:"𝒶",Assign:"≔",ast:"*",asymp:"≈",asympeq:"≍",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",awconint:"∳",awint:"⨑",backcong:"≌",backepsilon:"϶",backprime:"‵",backsim:"∽",backsimeq:"⋍",Backslash:"∖",Barv:"⫧",barvee:"⊽",barwed:"⌅",Barwed:"⌆",barwedge:"⌅",bbrk:"⎵",bbrktbrk:"⎶",bcong:"≌",Bcy:"Б",bcy:"б",bdquo:"„",becaus:"∵",because:"∵",Because:"∵",bemptyv:"⦰",bepsi:"϶",bernou:"ℬ",Bernoullis:"ℬ",Beta:"Β",beta:"β",beth:"ℶ",between:"≬",Bfr:"𝔅",bfr:"𝔟",bigcap:"⋂",bigcirc:"◯",bigcup:"⋃",bigodot:"⨀",bigoplus:"⨁",bigotimes:"⨂",bigsqcup:"⨆",bigstar:"★",bigtriangledown:"▽",bigtriangleup:"△",biguplus:"⨄",bigvee:"⋁",bigwedge:"⋀",bkarow:"⤍",blacklozenge:"⧫",blacksquare:"▪",blacktriangle:"▴",blacktriangledown:"▾",blacktriangleleft:"◂",blacktriangleright:"▸",blank:"␣",blk12:"▒",blk14:"░",blk34:"▓",block:"█",bne:"=⃥",bnequiv:"≡⃥",bNot:"⫭",bnot:"⌐",Bopf:"𝔹",bopf:"𝕓",bot:"⊥",bottom:"⊥",bowtie:"⋈",boxbox:"⧉",boxdl:"┐",boxdL:"╕",boxDl:"╖",boxDL:"╗",boxdr:"┌",boxdR:"╒",boxDr:"╓",boxDR:"╔",boxh:"─",boxH:"═",boxhd:"┬",boxHd:"╤",boxhD:"╥",boxHD:"╦",boxhu:"┴",boxHu:"╧",boxhU:"╨",boxHU:"╩",boxminus:"⊟",boxplus:"⊞",boxtimes:"⊠",boxul:"┘",boxuL:"╛",boxUl:"╜",boxUL:"╝",boxur:"└",boxuR:"╘",boxUr:"╙",boxUR:"╚",boxv:"│",boxV:"║",boxvh:"┼",boxvH:"╪",boxVh:"╫",boxVH:"╬",boxvl:"┤",boxvL:"╡",boxVl:"╢",boxVL:"╣",boxvr:"├",boxvR:"╞",boxVr:"╟",boxVR:"╠",bprime:"‵",breve:"˘",Breve:"˘",brvbar:"¦",bscr:"𝒷",Bscr:"ℬ",bsemi:"⁏",bsim:"∽",bsime:"⋍",bsolb:"⧅",bsol:"\\",bsolhsub:"⟈",bull:"•",bullet:"•",bump:"≎",bumpE:"⪮",bumpe:"≏",Bumpeq:"≎",bumpeq:"≏",Cacute:"Ć",cacute:"ć",capand:"⩄",capbrcup:"⩉",capcap:"⩋",cap:"∩",Cap:"⋒",capcup:"⩇",capdot:"⩀",CapitalDifferentialD:"ⅅ",caps:"∩︀",caret:"⁁",caron:"ˇ",Cayleys:"ℭ",ccaps:"⩍",Ccaron:"Č",ccaron:"č",Ccedil:"Ç",ccedil:"ç",Ccirc:"Ĉ",ccirc:"ĉ",Cconint:"∰",ccups:"⩌",ccupssm:"⩐",Cdot:"Ċ",cdot:"ċ",cedil:"¸",Cedilla:"¸",cemptyv:"⦲",cent:"¢",centerdot:"·",CenterDot:"·",cfr:"𝔠",Cfr:"ℭ",CHcy:"Ч",chcy:"ч",check:"✓",checkmark:"✓",Chi:"Χ",chi:"χ",circ:"ˆ",circeq:"≗",circlearrowleft:"↺",circlearrowright:"↻",circledast:"⊛",circledcirc:"⊚",circleddash:"⊝",CircleDot:"⊙",circledR:"®",circledS:"Ⓢ",CircleMinus:"⊖",CirclePlus:"⊕",CircleTimes:"⊗",cir:"○",cirE:"⧃",cire:"≗",cirfnint:"⨐",cirmid:"⫯",cirscir:"⧂",ClockwiseContourIntegral:"∲",CloseCurlyDoubleQuote:"”",CloseCurlyQuote:"’",clubs:"♣",clubsuit:"♣",colon:":",Colon:"∷",Colone:"⩴",colone:"≔",coloneq:"≔",comma:",",commat:"@",comp:"∁",compfn:"∘",complement:"∁",complexes:"ℂ",cong:"≅",congdot:"⩭",Congruent:"≡",conint:"∮",Conint:"∯",ContourIntegral:"∮",copf:"𝕔",Copf:"ℂ",coprod:"∐",Coproduct:"∐",copy:"©",COPY:"©",copysr:"℗",CounterClockwiseContourIntegral:"∳",crarr:"↵",cross:"✗",Cross:"⨯",Cscr:"𝒞",cscr:"𝒸",csub:"⫏",csube:"⫑",csup:"⫐",csupe:"⫒",ctdot:"⋯",cudarrl:"⤸",cudarrr:"⤵",cuepr:"⋞",cuesc:"⋟",cularr:"↶",cularrp:"⤽",cupbrcap:"⩈",cupcap:"⩆",CupCap:"≍",cup:"∪",Cup:"⋓",cupcup:"⩊",cupdot:"⊍",cupor:"⩅",cups:"∪︀",curarr:"↷",curarrm:"⤼",curlyeqprec:"⋞",curlyeqsucc:"⋟",curlyvee:"⋎",curlywedge:"⋏",curren:"¤",curvearrowleft:"↶",curvearrowright:"↷",cuvee:"⋎",cuwed:"⋏",cwconint:"∲",cwint:"∱",cylcty:"⌭",dagger:"†",Dagger:"‡",daleth:"ℸ",darr:"↓",Darr:"↡",dArr:"⇓",dash:"‐",Dashv:"⫤",dashv:"⊣",dbkarow:"⤏",dblac:"˝",Dcaron:"Ď",dcaron:"ď",Dcy:"Д",dcy:"д",ddagger:"‡",ddarr:"⇊",DD:"ⅅ",dd:"ⅆ",DDotrahd:"⤑",ddotseq:"⩷",deg:"°",Del:"∇",Delta:"Δ",delta:"δ",demptyv:"⦱",dfisht:"⥿",Dfr:"𝔇",dfr:"𝔡",dHar:"⥥",dharl:"⇃",dharr:"⇂",DiacriticalAcute:"´",DiacriticalDot:"˙",DiacriticalDoubleAcute:"˝",DiacriticalGrave:"`",DiacriticalTilde:"˜",diam:"⋄",diamond:"⋄",Diamond:"⋄",diamondsuit:"♦",diams:"♦",die:"¨",DifferentialD:"ⅆ",digamma:"ϝ",disin:"⋲",div:"÷",divide:"÷",divideontimes:"⋇",divonx:"⋇",DJcy:"Ђ",djcy:"ђ",dlcorn:"⌞",dlcrop:"⌍",dollar:"$",Dopf:"𝔻",dopf:"𝕕",Dot:"¨",dot:"˙",DotDot:"⃜",doteq:"≐",doteqdot:"≑",DotEqual:"≐",dotminus:"∸",dotplus:"∔",dotsquare:"⊡",doublebarwedge:"⌆",DoubleContourIntegral:"∯",DoubleDot:"¨",DoubleDownArrow:"⇓",DoubleLeftArrow:"⇐",DoubleLeftRightArrow:"⇔",DoubleLeftTee:"⫤",DoubleLongLeftArrow:"⟸",DoubleLongLeftRightArrow:"⟺",DoubleLongRightArrow:"⟹",DoubleRightArrow:"⇒",DoubleRightTee:"⊨",DoubleUpArrow:"⇑",DoubleUpDownArrow:"⇕",DoubleVerticalBar:"∥",DownArrowBar:"⤓",downarrow:"↓",DownArrow:"↓",Downarrow:"⇓",DownArrowUpArrow:"⇵",DownBreve:"̑",downdownarrows:"⇊",downharpoonleft:"⇃",downharpoonright:"⇂",DownLeftRightVector:"⥐",DownLeftTeeVector:"⥞",DownLeftVectorBar:"⥖",DownLeftVector:"↽",DownRightTeeVector:"⥟",DownRightVectorBar:"⥗",DownRightVector:"⇁",DownTeeArrow:"↧",DownTee:"⊤",drbkarow:"⤐",drcorn:"⌟",drcrop:"⌌",Dscr:"𝒟",dscr:"𝒹",DScy:"Ѕ",dscy:"ѕ",dsol:"⧶",Dstrok:"Đ",dstrok:"đ",dtdot:"⋱",dtri:"▿",dtrif:"▾",duarr:"⇵",duhar:"⥯",dwangle:"⦦",DZcy:"Џ",dzcy:"џ",dzigrarr:"⟿",Eacute:"É",eacute:"é",easter:"⩮",Ecaron:"Ě",ecaron:"ě",Ecirc:"Ê",ecirc:"ê",ecir:"≖",ecolon:"≕",Ecy:"Э",ecy:"э",eDDot:"⩷",Edot:"Ė",edot:"ė",eDot:"≑",ee:"ⅇ",efDot:"≒",Efr:"𝔈",efr:"𝔢",eg:"⪚",Egrave:"È",egrave:"è",egs:"⪖",egsdot:"⪘",el:"⪙",Element:"∈",elinters:"⏧",ell:"ℓ",els:"⪕",elsdot:"⪗",Emacr:"Ē",emacr:"ē",empty:"∅",emptyset:"∅",EmptySmallSquare:"◻",emptyv:"∅",EmptyVerySmallSquare:"▫",emsp13:" ",emsp14:" ",emsp:" ",ENG:"Ŋ",eng:"ŋ",ensp:" ",Eogon:"Ę",eogon:"ę",Eopf:"𝔼",eopf:"𝕖",epar:"⋕",eparsl:"⧣",eplus:"⩱",epsi:"ε",Epsilon:"Ε",epsilon:"ε",epsiv:"ϵ",eqcirc:"≖",eqcolon:"≕",eqsim:"≂",eqslantgtr:"⪖",eqslantless:"⪕",Equal:"⩵",equals:"=",EqualTilde:"≂",equest:"≟",Equilibrium:"⇌",equiv:"≡",equivDD:"⩸",eqvparsl:"⧥",erarr:"⥱",erDot:"≓",escr:"ℯ",Escr:"ℰ",esdot:"≐",Esim:"⩳",esim:"≂",Eta:"Η",eta:"η",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",euro:"€",excl:"!",exist:"∃",Exists:"∃",expectation:"ℰ",exponentiale:"ⅇ",ExponentialE:"ⅇ",fallingdotseq:"≒",Fcy:"Ф",fcy:"ф",female:"♀",ffilig:"ﬃ",fflig:"ﬀ",ffllig:"ﬄ",Ffr:"𝔉",ffr:"𝔣",filig:"ﬁ",FilledSmallSquare:"◼",FilledVerySmallSquare:"▪",fjlig:"fj",flat:"♭",fllig:"ﬂ",fltns:"▱",fnof:"ƒ",Fopf:"𝔽",fopf:"𝕗",forall:"∀",ForAll:"∀",fork:"⋔",forkv:"⫙",Fouriertrf:"ℱ",fpartint:"⨍",frac12:"½",frac13:"⅓",frac14:"¼",frac15:"⅕",frac16:"⅙",frac18:"⅛",frac23:"⅔",frac25:"⅖",frac34:"¾",frac35:"⅗",frac38:"⅜",frac45:"⅘",frac56:"⅚",frac58:"⅝",frac78:"⅞",frasl:"⁄",frown:"⌢",fscr:"𝒻",Fscr:"ℱ",gacute:"ǵ",Gamma:"Γ",gamma:"γ",Gammad:"Ϝ",gammad:"ϝ",gap:"⪆",Gbreve:"Ğ",gbreve:"ğ",Gcedil:"Ģ",Gcirc:"Ĝ",gcirc:"ĝ",Gcy:"Г",gcy:"г",Gdot:"Ġ",gdot:"ġ",ge:"≥",gE:"≧",gEl:"⪌",gel:"⋛",geq:"≥",geqq:"≧",geqslant:"⩾",gescc:"⪩",ges:"⩾",gesdot:"⪀",gesdoto:"⪂",gesdotol:"⪄",gesl:"⋛︀",gesles:"⪔",Gfr:"𝔊",gfr:"𝔤",gg:"≫",Gg:"⋙",ggg:"⋙",gimel:"ℷ",GJcy:"Ѓ",gjcy:"ѓ",gla:"⪥",gl:"≷",glE:"⪒",glj:"⪤",gnap:"⪊",gnapprox:"⪊",gne:"⪈",gnE:"≩",gneq:"⪈",gneqq:"≩",gnsim:"⋧",Gopf:"𝔾",gopf:"𝕘",grave:"`",GreaterEqual:"≥",GreaterEqualLess:"⋛",GreaterFullEqual:"≧",GreaterGreater:"⪢",GreaterLess:"≷",GreaterSlantEqual:"⩾",GreaterTilde:"≳",Gscr:"𝒢",gscr:"ℊ",gsim:"≳",gsime:"⪎",gsiml:"⪐",gtcc:"⪧",gtcir:"⩺",gt:">",GT:">",Gt:"≫",gtdot:"⋗",gtlPar:"⦕",gtquest:"⩼",gtrapprox:"⪆",gtrarr:"⥸",gtrdot:"⋗",gtreqless:"⋛",gtreqqless:"⪌",gtrless:"≷",gtrsim:"≳",gvertneqq:"≩︀",gvnE:"≩︀",Hacek:"ˇ",hairsp:" ",half:"½",hamilt:"ℋ",HARDcy:"Ъ",hardcy:"ъ",harrcir:"⥈",harr:"↔",hArr:"⇔",harrw:"↭",Hat:"^",hbar:"ℏ",Hcirc:"Ĥ",hcirc:"ĥ",hearts:"♥",heartsuit:"♥",hellip:"…",hercon:"⊹",hfr:"𝔥",Hfr:"ℌ",HilbertSpace:"ℋ",hksearow:"⤥",hkswarow:"⤦",hoarr:"⇿",homtht:"∻",hookleftarrow:"↩",hookrightarrow:"↪",hopf:"𝕙",Hopf:"ℍ",horbar:"―",HorizontalLine:"─",hscr:"𝒽",Hscr:"ℋ",hslash:"ℏ",Hstrok:"Ħ",hstrok:"ħ",HumpDownHump:"≎",HumpEqual:"≏",hybull:"⁃",hyphen:"‐",Iacute:"Í",iacute:"í",ic:"⁣",Icirc:"Î",icirc:"î",Icy:"И",icy:"и",Idot:"İ",IEcy:"Е",iecy:"е",iexcl:"¡",iff:"⇔",ifr:"𝔦",Ifr:"ℑ",Igrave:"Ì",igrave:"ì",ii:"ⅈ",iiiint:"⨌",iiint:"∭",iinfin:"⧜",iiota:"℩",IJlig:"Ĳ",ijlig:"ĳ",Imacr:"Ī",imacr:"ī",image:"ℑ",ImaginaryI:"ⅈ",imagline:"ℐ",imagpart:"ℑ",imath:"ı",Im:"ℑ",imof:"⊷",imped:"Ƶ",Implies:"⇒",incare:"℅",in:"∈",infin:"∞",infintie:"⧝",inodot:"ı",intcal:"⊺",int:"∫",Int:"∬",integers:"ℤ",Integral:"∫",intercal:"⊺",Intersection:"⋂",intlarhk:"⨗",intprod:"⨼",InvisibleComma:"⁣",InvisibleTimes:"⁢",IOcy:"Ё",iocy:"ё",Iogon:"Į",iogon:"į",Iopf:"𝕀",iopf:"𝕚",Iota:"Ι",iota:"ι",iprod:"⨼",iquest:"¿",iscr:"𝒾",Iscr:"ℐ",isin:"∈",isindot:"⋵",isinE:"⋹",isins:"⋴",isinsv:"⋳",isinv:"∈",it:"⁢",Itilde:"Ĩ",itilde:"ĩ",Iukcy:"І",iukcy:"і",Iuml:"Ï",iuml:"ï",Jcirc:"Ĵ",jcirc:"ĵ",Jcy:"Й",jcy:"й",Jfr:"𝔍",jfr:"𝔧",jmath:"ȷ",Jopf:"𝕁",jopf:"𝕛",Jscr:"𝒥",jscr:"𝒿",Jsercy:"Ј",jsercy:"ј",Jukcy:"Є",jukcy:"є",Kappa:"Κ",kappa:"κ",kappav:"ϰ",Kcedil:"Ķ",kcedil:"ķ",Kcy:"К",kcy:"к",Kfr:"𝔎",kfr:"𝔨",kgreen:"ĸ",KHcy:"Х",khcy:"х",KJcy:"Ќ",kjcy:"ќ",Kopf:"𝕂",kopf:"𝕜",Kscr:"𝒦",kscr:"𝓀",lAarr:"⇚",Lacute:"Ĺ",lacute:"ĺ",laemptyv:"⦴",lagran:"ℒ",Lambda:"Λ",lambda:"λ",lang:"⟨",Lang:"⟪",langd:"⦑",langle:"⟨",lap:"⪅",Laplacetrf:"ℒ",laquo:"«",larrb:"⇤",larrbfs:"⤟",larr:"←",Larr:"↞",lArr:"⇐",larrfs:"⤝",larrhk:"↩",larrlp:"↫",larrpl:"⤹",larrsim:"⥳",larrtl:"↢",latail:"⤙",lAtail:"⤛",lat:"⪫",late:"⪭",lates:"⪭︀",lbarr:"⤌",lBarr:"⤎",lbbrk:"❲",lbrace:"{",lbrack:"[",lbrke:"⦋",lbrksld:"⦏",lbrkslu:"⦍",Lcaron:"Ľ",lcaron:"ľ",Lcedil:"Ļ",lcedil:"ļ",lceil:"⌈",lcub:"{",Lcy:"Л",lcy:"л",ldca:"⤶",ldquo:"“",ldquor:"„",ldrdhar:"⥧",ldrushar:"⥋",ldsh:"↲",le:"≤",lE:"≦",LeftAngleBracket:"⟨",LeftArrowBar:"⇤",leftarrow:"←",LeftArrow:"←",Leftarrow:"⇐",LeftArrowRightArrow:"⇆",leftarrowtail:"↢",LeftCeiling:"⌈",LeftDoubleBracket:"⟦",LeftDownTeeVector:"⥡",LeftDownVectorBar:"⥙",LeftDownVector:"⇃",LeftFloor:"⌊",leftharpoondown:"↽",leftharpoonup:"↼",leftleftarrows:"⇇",leftrightarrow:"↔",LeftRightArrow:"↔",Leftrightarrow:"⇔",leftrightarrows:"⇆",leftrightharpoons:"⇋",leftrightsquigarrow:"↭",LeftRightVector:"⥎",LeftTeeArrow:"↤",LeftTee:"⊣",LeftTeeVector:"⥚",leftthreetimes:"⋋",LeftTriangleBar:"⧏",LeftTriangle:"⊲",LeftTriangleEqual:"⊴",LeftUpDownVector:"⥑",LeftUpTeeVector:"⥠",LeftUpVectorBar:"⥘",LeftUpVector:"↿",LeftVectorBar:"⥒",LeftVector:"↼",lEg:"⪋",leg:"⋚",leq:"≤",leqq:"≦",leqslant:"⩽",lescc:"⪨",les:"⩽",lesdot:"⩿",lesdoto:"⪁",lesdotor:"⪃",lesg:"⋚︀",lesges:"⪓",lessapprox:"⪅",lessdot:"⋖",lesseqgtr:"⋚",lesseqqgtr:"⪋",LessEqualGreater:"⋚",LessFullEqual:"≦",LessGreater:"≶",lessgtr:"≶",LessLess:"⪡",lesssim:"≲",LessSlantEqual:"⩽",LessTilde:"≲",lfisht:"⥼",lfloor:"⌊",Lfr:"𝔏",lfr:"𝔩",lg:"≶",lgE:"⪑",lHar:"⥢",lhard:"↽",lharu:"↼",lharul:"⥪",lhblk:"▄",LJcy:"Љ",ljcy:"љ",llarr:"⇇",ll:"≪",Ll:"⋘",llcorner:"⌞",Lleftarrow:"⇚",llhard:"⥫",lltri:"◺",Lmidot:"Ŀ",lmidot:"ŀ",lmoustache:"⎰",lmoust:"⎰",lnap:"⪉",lnapprox:"⪉",lne:"⪇",lnE:"≨",lneq:"⪇",lneqq:"≨",lnsim:"⋦",loang:"⟬",loarr:"⇽",lobrk:"⟦",longleftarrow:"⟵",LongLeftArrow:"⟵",Longleftarrow:"⟸",longleftrightarrow:"⟷",LongLeftRightArrow:"⟷",Longleftrightarrow:"⟺",longmapsto:"⟼",longrightarrow:"⟶",LongRightArrow:"⟶",Longrightarrow:"⟹",looparrowleft:"↫",looparrowright:"↬",lopar:"⦅",Lopf:"𝕃",lopf:"𝕝",loplus:"⨭",lotimes:"⨴",lowast:"∗",lowbar:"_",LowerLeftArrow:"↙",LowerRightArrow:"↘",loz:"◊",lozenge:"◊",lozf:"⧫",lpar:"(",lparlt:"⦓",lrarr:"⇆",lrcorner:"⌟",lrhar:"⇋",lrhard:"⥭",lrm:"‎",lrtri:"⊿",lsaquo:"‹",lscr:"𝓁",Lscr:"ℒ",lsh:"↰",Lsh:"↰",lsim:"≲",lsime:"⪍",lsimg:"⪏",lsqb:"[",lsquo:"‘",lsquor:"‚",Lstrok:"Ł",lstrok:"ł",ltcc:"⪦",ltcir:"⩹",lt:"<",LT:"<",Lt:"≪",ltdot:"⋖",lthree:"⋋",ltimes:"⋉",ltlarr:"⥶",ltquest:"⩻",ltri:"◃",ltrie:"⊴",ltrif:"◂",ltrPar:"⦖",lurdshar:"⥊",luruhar:"⥦",lvertneqq:"≨︀",lvnE:"≨︀",macr:"¯",male:"♂",malt:"✠",maltese:"✠",Map:"⤅",map:"↦",mapsto:"↦",mapstodown:"↧",mapstoleft:"↤",mapstoup:"↥",marker:"▮",mcomma:"⨩",Mcy:"М",mcy:"м",mdash:"—",mDDot:"∺",measuredangle:"∡",MediumSpace:" ",Mellintrf:"ℳ",Mfr:"𝔐",mfr:"𝔪",mho:"℧",micro:"µ",midast:"*",midcir:"⫰",mid:"∣",middot:"·",minusb:"⊟",minus:"−",minusd:"∸",minusdu:"⨪",MinusPlus:"∓",mlcp:"⫛",mldr:"…",mnplus:"∓",models:"⊧",Mopf:"𝕄",mopf:"𝕞",mp:"∓",mscr:"𝓂",Mscr:"ℳ",mstpos:"∾",Mu:"Μ",mu:"μ",multimap:"⊸",mumap:"⊸",nabla:"∇",Nacute:"Ń",nacute:"ń",nang:"∠⃒",nap:"≉",napE:"⩰̸",napid:"≋̸",napos:"ŉ",napprox:"≉",natural:"♮",naturals:"ℕ",natur:"♮",nbsp:" ",nbump:"≎̸",nbumpe:"≏̸",ncap:"⩃",Ncaron:"Ň",ncaron:"ň",Ncedil:"Ņ",ncedil:"ņ",ncong:"≇",ncongdot:"⩭̸",ncup:"⩂",Ncy:"Н",ncy:"н",ndash:"–",nearhk:"⤤",nearr:"↗",neArr:"⇗",nearrow:"↗",ne:"≠",nedot:"≐̸",NegativeMediumSpace:"​",NegativeThickSpace:"​",NegativeThinSpace:"​",NegativeVeryThinSpace:"​",nequiv:"≢",nesear:"⤨",nesim:"≂̸",NestedGreaterGreater:"≫",NestedLessLess:"≪",NewLine:"\n",nexist:"∄",nexists:"∄",Nfr:"𝔑",nfr:"𝔫",ngE:"≧̸",nge:"≱",ngeq:"≱",ngeqq:"≧̸",ngeqslant:"⩾̸",nges:"⩾̸",nGg:"⋙̸",ngsim:"≵",nGt:"≫⃒",ngt:"≯",ngtr:"≯",nGtv:"≫̸",nharr:"↮",nhArr:"⇎",nhpar:"⫲",ni:"∋",nis:"⋼",nisd:"⋺",niv:"∋",NJcy:"Њ",njcy:"њ",nlarr:"↚",nlArr:"⇍",nldr:"‥",nlE:"≦̸",nle:"≰",nleftarrow:"↚",nLeftarrow:"⇍",nleftrightarrow:"↮",nLeftrightarrow:"⇎",nleq:"≰",nleqq:"≦̸",nleqslant:"⩽̸",nles:"⩽̸",nless:"≮",nLl:"⋘̸",nlsim:"≴",nLt:"≪⃒",nlt:"≮",nltri:"⋪",nltrie:"⋬",nLtv:"≪̸",nmid:"∤",NoBreak:"⁠",NonBreakingSpace:" ",nopf:"𝕟",Nopf:"ℕ",Not:"⫬",not:"¬",NotCongruent:"≢",NotCupCap:"≭",NotDoubleVerticalBar:"∦",NotElement:"∉",NotEqual:"≠",NotEqualTilde:"≂̸",NotExists:"∄",NotGreater:"≯",NotGreaterEqual:"≱",NotGreaterFullEqual:"≧̸",NotGreaterGreater:"≫̸",NotGreaterLess:"≹",NotGreaterSlantEqual:"⩾̸",NotGreaterTilde:"≵",NotHumpDownHump:"≎̸",NotHumpEqual:"≏̸",notin:"∉",notindot:"⋵̸",notinE:"⋹̸",notinva:"∉",notinvb:"⋷",notinvc:"⋶",NotLeftTriangleBar:"⧏̸",NotLeftTriangle:"⋪",NotLeftTriangleEqual:"⋬",NotLess:"≮",NotLessEqual:"≰",NotLessGreater:"≸",NotLessLess:"≪̸",NotLessSlantEqual:"⩽̸",NotLessTilde:"≴",NotNestedGreaterGreater:"⪢̸",NotNestedLessLess:"⪡̸",notni:"∌",notniva:"∌",notnivb:"⋾",notnivc:"⋽",NotPrecedes:"⊀",NotPrecedesEqual:"⪯̸",NotPrecedesSlantEqual:"⋠",NotReverseElement:"∌",NotRightTriangleBar:"⧐̸",NotRightTriangle:"⋫",NotRightTriangleEqual:"⋭",NotSquareSubset:"⊏̸",NotSquareSubsetEqual:"⋢",NotSquareSuperset:"⊐̸",NotSquareSupersetEqual:"⋣",NotSubset:"⊂⃒",NotSubsetEqual:"⊈",NotSucceeds:"⊁",NotSucceedsEqual:"⪰̸",NotSucceedsSlantEqual:"⋡",NotSucceedsTilde:"≿̸",NotSuperset:"⊃⃒",NotSupersetEqual:"⊉",NotTilde:"≁",NotTildeEqual:"≄",NotTildeFullEqual:"≇",NotTildeTilde:"≉",NotVerticalBar:"∤",nparallel:"∦",npar:"∦",nparsl:"⫽⃥",npart:"∂̸",npolint:"⨔",npr:"⊀",nprcue:"⋠",nprec:"⊀",npreceq:"⪯̸",npre:"⪯̸",nrarrc:"⤳̸",nrarr:"↛",nrArr:"⇏",nrarrw:"↝̸",nrightarrow:"↛",nRightarrow:"⇏",nrtri:"⋫",nrtrie:"⋭",nsc:"⊁",nsccue:"⋡",nsce:"⪰̸",Nscr:"𝒩",nscr:"𝓃",nshortmid:"∤",nshortparallel:"∦",nsim:"≁",nsime:"≄",nsimeq:"≄",nsmid:"∤",nspar:"∦",nsqsube:"⋢",nsqsupe:"⋣",nsub:"⊄",nsubE:"⫅̸",nsube:"⊈",nsubset:"⊂⃒",nsubseteq:"⊈",nsubseteqq:"⫅̸",nsucc:"⊁",nsucceq:"⪰̸",nsup:"⊅",nsupE:"⫆̸",nsupe:"⊉",nsupset:"⊃⃒",nsupseteq:"⊉",nsupseteqq:"⫆̸",ntgl:"≹",Ntilde:"Ñ",ntilde:"ñ",ntlg:"≸",ntriangleleft:"⋪",ntrianglelefteq:"⋬",ntriangleright:"⋫",ntrianglerighteq:"⋭",Nu:"Ν",nu:"ν",num:"#",numero:"№",numsp:" ",nvap:"≍⃒",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",nvge:"≥⃒",nvgt:">⃒",nvHarr:"⤄",nvinfin:"⧞",nvlArr:"⤂",nvle:"≤⃒",nvlt:"<⃒",nvltrie:"⊴⃒",nvrArr:"⤃",nvrtrie:"⊵⃒",nvsim:"∼⃒",nwarhk:"⤣",nwarr:"↖",nwArr:"⇖",nwarrow:"↖",nwnear:"⤧",Oacute:"Ó",oacute:"ó",oast:"⊛",Ocirc:"Ô",ocirc:"ô",ocir:"⊚",Ocy:"О",ocy:"о",odash:"⊝",Odblac:"Ő",odblac:"ő",odiv:"⨸",odot:"⊙",odsold:"⦼",OElig:"Œ",oelig:"œ",ofcir:"⦿",Ofr:"𝔒",ofr:"𝔬",ogon:"˛",Ograve:"Ò",ograve:"ò",ogt:"⧁",ohbar:"⦵",ohm:"Ω",oint:"∮",olarr:"↺",olcir:"⦾",olcross:"⦻",oline:"‾",olt:"⧀",Omacr:"Ō",omacr:"ō",Omega:"Ω",omega:"ω",Omicron:"Ο",omicron:"ο",omid:"⦶",ominus:"⊖",Oopf:"𝕆",oopf:"𝕠",opar:"⦷",OpenCurlyDoubleQuote:"“",OpenCurlyQuote:"‘",operp:"⦹",oplus:"⊕",orarr:"↻",Or:"⩔",or:"∨",ord:"⩝",order:"ℴ",orderof:"ℴ",ordf:"ª",ordm:"º",origof:"⊶",oror:"⩖",orslope:"⩗",orv:"⩛",oS:"Ⓢ",Oscr:"𝒪",oscr:"ℴ",Oslash:"Ø",oslash:"ø",osol:"⊘",Otilde:"Õ",otilde:"õ",otimesas:"⨶",Otimes:"⨷",otimes:"⊗",Ouml:"Ö",ouml:"ö",ovbar:"⌽",OverBar:"‾",OverBrace:"⏞",OverBracket:"⎴",OverParenthesis:"⏜",para:"¶",parallel:"∥",par:"∥",parsim:"⫳",parsl:"⫽",part:"∂",PartialD:"∂",Pcy:"П",pcy:"п",percnt:"%",period:".",permil:"‰",perp:"⊥",pertenk:"‱",Pfr:"𝔓",pfr:"𝔭",Phi:"Φ",phi:"φ",phiv:"ϕ",phmmat:"ℳ",phone:"☎",Pi:"Π",pi:"π",pitchfork:"⋔",piv:"ϖ",planck:"ℏ",planckh:"ℎ",plankv:"ℏ",plusacir:"⨣",plusb:"⊞",pluscir:"⨢",plus:"+",plusdo:"∔",plusdu:"⨥",pluse:"⩲",PlusMinus:"±",plusmn:"±",plussim:"⨦",plustwo:"⨧",pm:"±",Poincareplane:"ℌ",pointint:"⨕",popf:"𝕡",Popf:"ℙ",pound:"£",prap:"⪷",Pr:"⪻",pr:"≺",prcue:"≼",precapprox:"⪷",prec:"≺",preccurlyeq:"≼",Precedes:"≺",PrecedesEqual:"⪯",PrecedesSlantEqual:"≼",PrecedesTilde:"≾",preceq:"⪯",precnapprox:"⪹",precneqq:"⪵",precnsim:"⋨",pre:"⪯",prE:"⪳",precsim:"≾",prime:"′",Prime:"″",primes:"ℙ",prnap:"⪹",prnE:"⪵",prnsim:"⋨",prod:"∏",Product:"∏",profalar:"⌮",profline:"⌒",profsurf:"⌓",prop:"∝",Proportional:"∝",Proportion:"∷",propto:"∝",prsim:"≾",prurel:"⊰",Pscr:"𝒫",pscr:"𝓅",Psi:"Ψ",psi:"ψ",puncsp:" ",Qfr:"𝔔",qfr:"𝔮",qint:"⨌",qopf:"𝕢",Qopf:"ℚ",qprime:"⁗",Qscr:"𝒬",qscr:"𝓆",quaternions:"ℍ",quatint:"⨖",quest:"?",questeq:"≟",quot:'"',QUOT:'"',rAarr:"⇛",race:"∽̱",Racute:"Ŕ",racute:"ŕ",radic:"√",raemptyv:"⦳",rang:"⟩",Rang:"⟫",rangd:"⦒",range:"⦥",rangle:"⟩",raquo:"»",rarrap:"⥵",rarrb:"⇥",rarrbfs:"⤠",rarrc:"⤳",rarr:"→",Rarr:"↠",rArr:"⇒",rarrfs:"⤞",rarrhk:"↪",rarrlp:"↬",rarrpl:"⥅",rarrsim:"⥴",Rarrtl:"⤖",rarrtl:"↣",rarrw:"↝",ratail:"⤚",rAtail:"⤜",ratio:"∶",rationals:"ℚ",rbarr:"⤍",rBarr:"⤏",RBarr:"⤐",rbbrk:"❳",rbrace:"}",rbrack:"]",rbrke:"⦌",rbrksld:"⦎",rbrkslu:"⦐",Rcaron:"Ř",rcaron:"ř",Rcedil:"Ŗ",rcedil:"ŗ",rceil:"⌉",rcub:"}",Rcy:"Р",rcy:"р",rdca:"⤷",rdldhar:"⥩",rdquo:"”",rdquor:"”",rdsh:"↳",real:"ℜ",realine:"ℛ",realpart:"ℜ",reals:"ℝ",Re:"ℜ",rect:"▭",reg:"®",REG:"®",ReverseElement:"∋",ReverseEquilibrium:"⇋",ReverseUpEquilibrium:"⥯",rfisht:"⥽",rfloor:"⌋",rfr:"𝔯",Rfr:"ℜ",rHar:"⥤",rhard:"⇁",rharu:"⇀",rharul:"⥬",Rho:"Ρ",rho:"ρ",rhov:"ϱ",RightAngleBracket:"⟩",RightArrowBar:"⇥",rightarrow:"→",RightArrow:"→",Rightarrow:"⇒",RightArrowLeftArrow:"⇄",rightarrowtail:"↣",RightCeiling:"⌉",RightDoubleBracket:"⟧",RightDownTeeVector:"⥝",RightDownVectorBar:"⥕",RightDownVector:"⇂",RightFloor:"⌋",rightharpoondown:"⇁",rightharpoonup:"⇀",rightleftarrows:"⇄",rightleftharpoons:"⇌",rightrightarrows:"⇉",rightsquigarrow:"↝",RightTeeArrow:"↦",RightTee:"⊢",RightTeeVector:"⥛",rightthreetimes:"⋌",RightTriangleBar:"⧐",RightTriangle:"⊳",RightTriangleEqual:"⊵",RightUpDownVector:"⥏",RightUpTeeVector:"⥜",RightUpVectorBar:"⥔",RightUpVector:"↾",RightVectorBar:"⥓",RightVector:"⇀",ring:"˚",risingdotseq:"≓",rlarr:"⇄",rlhar:"⇌",rlm:"‏",rmoustache:"⎱",rmoust:"⎱",rnmid:"⫮",roang:"⟭",roarr:"⇾",robrk:"⟧",ropar:"⦆",ropf:"𝕣",Ropf:"ℝ",roplus:"⨮",rotimes:"⨵",RoundImplies:"⥰",rpar:")",rpargt:"⦔",rppolint:"⨒",rrarr:"⇉",Rrightarrow:"⇛",rsaquo:"›",rscr:"𝓇",Rscr:"ℛ",rsh:"↱",Rsh:"↱",rsqb:"]",rsquo:"’",rsquor:"’",rthree:"⋌",rtimes:"⋊",rtri:"▹",rtrie:"⊵",rtrif:"▸",rtriltri:"⧎",RuleDelayed:"⧴",ruluhar:"⥨",rx:"℞",Sacute:"Ś",sacute:"ś",sbquo:"‚",scap:"⪸",Scaron:"Š",scaron:"š",Sc:"⪼",sc:"≻",sccue:"≽",sce:"⪰",scE:"⪴",Scedil:"Ş",scedil:"ş",Scirc:"Ŝ",scirc:"ŝ",scnap:"⪺",scnE:"⪶",scnsim:"⋩",scpolint:"⨓",scsim:"≿",Scy:"С",scy:"с",sdotb:"⊡",sdot:"⋅",sdote:"⩦",searhk:"⤥",searr:"↘",seArr:"⇘",searrow:"↘",sect:"§",semi:";",seswar:"⤩",setminus:"∖",setmn:"∖",sext:"✶",Sfr:"𝔖",sfr:"𝔰",sfrown:"⌢",sharp:"♯",SHCHcy:"Щ",shchcy:"щ",SHcy:"Ш",shcy:"ш",ShortDownArrow:"↓",ShortLeftArrow:"←",shortmid:"∣",shortparallel:"∥",ShortRightArrow:"→",ShortUpArrow:"↑",shy:"­",Sigma:"Σ",sigma:"σ",sigmaf:"ς",sigmav:"ς",sim:"∼",simdot:"⩪",sime:"≃",simeq:"≃",simg:"⪞",simgE:"⪠",siml:"⪝",simlE:"⪟",simne:"≆",simplus:"⨤",simrarr:"⥲",slarr:"←",SmallCircle:"∘",smallsetminus:"∖",smashp:"⨳",smeparsl:"⧤",smid:"∣",smile:"⌣",smt:"⪪",smte:"⪬",smtes:"⪬︀",SOFTcy:"Ь",softcy:"ь",solbar:"⌿",solb:"⧄",sol:"/",Sopf:"𝕊",sopf:"𝕤",spades:"♠",spadesuit:"♠",spar:"∥",sqcap:"⊓",sqcaps:"⊓︀",sqcup:"⊔",sqcups:"⊔︀",Sqrt:"√",sqsub:"⊏",sqsube:"⊑",sqsubset:"⊏",sqsubseteq:"⊑",sqsup:"⊐",sqsupe:"⊒",sqsupset:"⊐",sqsupseteq:"⊒",square:"□",Square:"□",SquareIntersection:"⊓",SquareSubset:"⊏",SquareSubsetEqual:"⊑",SquareSuperset:"⊐",SquareSupersetEqual:"⊒",SquareUnion:"⊔",squarf:"▪",squ:"□",squf:"▪",srarr:"→",Sscr:"𝒮",sscr:"𝓈",ssetmn:"∖",ssmile:"⌣",sstarf:"⋆",Star:"⋆",star:"☆",starf:"★",straightepsilon:"ϵ",straightphi:"ϕ",strns:"¯",sub:"⊂",Sub:"⋐",subdot:"⪽",subE:"⫅",sube:"⊆",subedot:"⫃",submult:"⫁",subnE:"⫋",subne:"⊊",subplus:"⪿",subrarr:"⥹",subset:"⊂",Subset:"⋐",subseteq:"⊆",subseteqq:"⫅",SubsetEqual:"⊆",subsetneq:"⊊",subsetneqq:"⫋",subsim:"⫇",subsub:"⫕",subsup:"⫓",succapprox:"⪸",succ:"≻",succcurlyeq:"≽",Succeeds:"≻",SucceedsEqual:"⪰",SucceedsSlantEqual:"≽",SucceedsTilde:"≿",succeq:"⪰",succnapprox:"⪺",succneqq:"⪶",succnsim:"⋩",succsim:"≿",SuchThat:"∋",sum:"∑",Sum:"∑",sung:"♪",sup1:"¹",sup2:"²",sup3:"³",sup:"⊃",Sup:"⋑",supdot:"⪾",supdsub:"⫘",supE:"⫆",supe:"⊇",supedot:"⫄",Superset:"⊃",SupersetEqual:"⊇",suphsol:"⟉",suphsub:"⫗",suplarr:"⥻",supmult:"⫂",supnE:"⫌",supne:"⊋",supplus:"⫀",supset:"⊃",Supset:"⋑",supseteq:"⊇",supseteqq:"⫆",supsetneq:"⊋",supsetneqq:"⫌",supsim:"⫈",supsub:"⫔",supsup:"⫖",swarhk:"⤦",swarr:"↙",swArr:"⇙",swarrow:"↙",swnwar:"⤪",szlig:"ß",Tab:"\t",target:"⌖",Tau:"Τ",tau:"τ",tbrk:"⎴",Tcaron:"Ť",tcaron:"ť",Tcedil:"Ţ",tcedil:"ţ",Tcy:"Т",tcy:"т",tdot:"⃛",telrec:"⌕",Tfr:"𝔗",tfr:"𝔱",there4:"∴",therefore:"∴",Therefore:"∴",Theta:"Θ",theta:"θ",thetasym:"ϑ",thetav:"ϑ",thickapprox:"≈",thicksim:"∼",ThickSpace:"  ",ThinSpace:" ",thinsp:" ",thkap:"≈",thksim:"∼",THORN:"Þ",thorn:"þ",tilde:"˜",Tilde:"∼",TildeEqual:"≃",TildeFullEqual:"≅",TildeTilde:"≈",timesbar:"⨱",timesb:"⊠",times:"×",timesd:"⨰",tint:"∭",toea:"⤨",topbot:"⌶",topcir:"⫱",top:"⊤",Topf:"𝕋",topf:"𝕥",topfork:"⫚",tosa:"⤩",tprime:"‴",trade:"™",TRADE:"™",triangle:"▵",triangledown:"▿",triangleleft:"◃",trianglelefteq:"⊴",triangleq:"≜",triangleright:"▹",trianglerighteq:"⊵",tridot:"◬",trie:"≜",triminus:"⨺",TripleDot:"⃛",triplus:"⨹",trisb:"⧍",tritime:"⨻",trpezium:"⏢",Tscr:"𝒯",tscr:"𝓉",TScy:"Ц",tscy:"ц",TSHcy:"Ћ",tshcy:"ћ",Tstrok:"Ŧ",tstrok:"ŧ",twixt:"≬",twoheadleftarrow:"↞",twoheadrightarrow:"↠",Uacute:"Ú",uacute:"ú",uarr:"↑",Uarr:"↟",uArr:"⇑",Uarrocir:"⥉",Ubrcy:"Ў",ubrcy:"ў",Ubreve:"Ŭ",ubreve:"ŭ",Ucirc:"Û",ucirc:"û",Ucy:"У",ucy:"у",udarr:"⇅",Udblac:"Ű",udblac:"ű",udhar:"⥮",ufisht:"⥾",Ufr:"𝔘",ufr:"𝔲",Ugrave:"Ù",ugrave:"ù",uHar:"⥣",uharl:"↿",uharr:"↾",uhblk:"▀",ulcorn:"⌜",ulcorner:"⌜",ulcrop:"⌏",ultri:"◸",Umacr:"Ū",umacr:"ū",uml:"¨",UnderBar:"_",UnderBrace:"⏟",UnderBracket:"⎵",UnderParenthesis:"⏝",Union:"⋃",UnionPlus:"⊎",Uogon:"Ų",uogon:"ų",Uopf:"𝕌",uopf:"𝕦",UpArrowBar:"⤒",uparrow:"↑",UpArrow:"↑",Uparrow:"⇑",UpArrowDownArrow:"⇅",updownarrow:"↕",UpDownArrow:"↕",Updownarrow:"⇕",UpEquilibrium:"⥮",upharpoonleft:"↿",upharpoonright:"↾",uplus:"⊎",UpperLeftArrow:"↖",UpperRightArrow:"↗",upsi:"υ",Upsi:"ϒ",upsih:"ϒ",Upsilon:"Υ",upsilon:"υ",UpTeeArrow:"↥",UpTee:"⊥",upuparrows:"⇈",urcorn:"⌝",urcorner:"⌝",urcrop:"⌎",Uring:"Ů",uring:"ů",urtri:"◹",Uscr:"𝒰",uscr:"𝓊",utdot:"⋰",Utilde:"Ũ",utilde:"ũ",utri:"▵",utrif:"▴",uuarr:"⇈",Uuml:"Ü",uuml:"ü",uwangle:"⦧",vangrt:"⦜",varepsilon:"ϵ",varkappa:"ϰ",varnothing:"∅",varphi:"ϕ",varpi:"ϖ",varpropto:"∝",varr:"↕",vArr:"⇕",varrho:"ϱ",varsigma:"ς",varsubsetneq:"⊊︀",varsubsetneqq:"⫋︀",varsupsetneq:"⊋︀",varsupsetneqq:"⫌︀",vartheta:"ϑ",vartriangleleft:"⊲",vartriangleright:"⊳",vBar:"⫨",Vbar:"⫫",vBarv:"⫩",Vcy:"В",vcy:"в",vdash:"⊢",vDash:"⊨",Vdash:"⊩",VDash:"⊫",Vdashl:"⫦",veebar:"⊻",vee:"∨",Vee:"⋁",veeeq:"≚",vellip:"⋮",verbar:"|",Verbar:"‖",vert:"|",Vert:"‖",VerticalBar:"∣",VerticalLine:"|",VerticalSeparator:"❘",VerticalTilde:"≀",VeryThinSpace:" ",Vfr:"𝔙",vfr:"𝔳",vltri:"⊲",vnsub:"⊂⃒",vnsup:"⊃⃒",Vopf:"𝕍",vopf:"𝕧",vprop:"∝",vrtri:"⊳",Vscr:"𝒱",vscr:"𝓋",vsubnE:"⫋︀",vsubne:"⊊︀",vsupnE:"⫌︀",vsupne:"⊋︀",Vvdash:"⊪",vzigzag:"⦚",Wcirc:"Ŵ",wcirc:"ŵ",wedbar:"⩟",wedge:"∧",Wedge:"⋀",wedgeq:"≙",weierp:"℘",Wfr:"𝔚",wfr:"𝔴",Wopf:"𝕎",wopf:"𝕨",wp:"℘",wr:"≀",wreath:"≀",Wscr:"𝒲",wscr:"𝓌",xcap:"⋂",xcirc:"◯",xcup:"⋃",xdtri:"▽",Xfr:"𝔛",xfr:"𝔵",xharr:"⟷",xhArr:"⟺",Xi:"Ξ",xi:"ξ",xlarr:"⟵",xlArr:"⟸",xmap:"⟼",xnis:"⋻",xodot:"⨀",Xopf:"𝕏",xopf:"𝕩",xoplus:"⨁",xotime:"⨂",xrarr:"⟶",xrArr:"⟹",Xscr:"𝒳",xscr:"𝓍",xsqcup:"⨆",xuplus:"⨄",xutri:"△",xvee:"⋁",xwedge:"⋀",Yacute:"Ý",yacute:"ý",YAcy:"Я",yacy:"я",Ycirc:"Ŷ",ycirc:"ŷ",Ycy:"Ы",ycy:"ы",yen:"¥",Yfr:"𝔜",yfr:"𝔶",YIcy:"Ї",yicy:"ї",Yopf:"𝕐",yopf:"𝕪",Yscr:"𝒴",yscr:"𝓎",YUcy:"Ю",yucy:"ю",yuml:"ÿ",Yuml:"Ÿ",Zacute:"Ź",zacute:"ź",Zcaron:"Ž",zcaron:"ž",Zcy:"З",zcy:"з",Zdot:"Ż",zdot:"ż",zeetrf:"ℨ",ZeroWidthSpace:"​",Zeta:"Ζ",zeta:"ζ",zfr:"𝔷",Zfr:"ℨ",ZHcy:"Ж",zhcy:"ж",zigrarr:"⇝",zopf:"𝕫",Zopf:"ℤ",Zscr:"𝒵",zscr:"𝓏",zwj:"‍",zwnj:"‌"}},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){var ie_lt8=/MSIE \d/.test(navigator.userAgent)&&(document.documentMode==null||document.documentMode<8);var Pos=CodeMirror.Pos;var matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"};function findMatchingBracket(cm,where,config){var line=cm.getLineHandle(where.line),pos=where.ch-1;var afterCursor=config&&config.afterCursor;if(afterCursor==null)afterCursor=/(^| )cm-fat-cursor($| )/.test(cm.getWrapperElement().className);var match=!afterCursor&&pos>=0&&matching[line.text.charAt(pos)]||matching[line.text.charAt(++pos)];if(!match)return null;var dir=match.charAt(1)==">"?1:-1;if(config&&config.strict&&dir>0!=(pos==where.ch))return null;var style=cm.getTokenTypeAt(Pos(where.line,pos+1));var found=scanForBracket(cm,Pos(where.line,pos+(dir>0?1:0)),dir,style||null,config);if(found==null)return null;return{from:Pos(where.line,pos),to:found&&found.pos,match:found&&found.ch==match.charAt(0),forward:dir>0}}function scanForBracket(cm,where,dir,style,config){var maxScanLen=config&&config.maxScanLineLength||1e4;var maxScanLines=config&&config.maxScanLines||1e3;var stack=[];var re=config&&config.bracketRegex?config.bracketRegex:/[(){}[\]]/;var lineEnd=dir>0?Math.min(where.line+maxScanLines,cm.lastLine()+1):Math.max(cm.firstLine()-1,where.line-maxScanLines);for(var lineNo=where.line;lineNo!=lineEnd;lineNo+=dir){var line=cm.getLine(lineNo);if(!line)continue;var pos=dir>0?0:line.length-1,end=dir>0?line.length:-1;if(line.length>maxScanLen)continue;if(lineNo==where.line)pos=where.ch-(dir<0?1:0);for(;pos!=end;pos+=dir){var ch=line.charAt(pos);if(re.test(ch)&&(style===undefined||cm.getTokenTypeAt(Pos(lineNo,pos+1))==style)){var match=matching[ch];if(match.charAt(1)==">"==dir>0)stack.push(ch);else if(!stack.length)return{pos:Pos(lineNo,pos),ch:ch};else stack.pop()}}}return lineNo-dir==(dir>0?cm.lastLine():cm.firstLine())?false:null}function matchBrackets(cm,autoclear,config){var maxHighlightLen=cm.state.matchBrackets.maxHighlightLineLength||1e3;var marks=[],ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var match=ranges[i].empty()&&findMatchingBracket(cm,ranges[i].head,config);if(match&&cm.getLine(match.from.line).length<=maxHighlightLen){var style=match.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";marks.push(cm.markText(match.from,Pos(match.from.line,match.from.ch+1),{className:style}));if(match.to&&cm.getLine(match.to.line).length<=maxHighlightLen)marks.push(cm.markText(match.to,Pos(match.to.line,match.to.ch+1),{className:style}))}}if(marks.length){if(ie_lt8&&cm.state.focused)cm.focus();var clear=function(){cm.operation(function(){for(var i=0;i<marks.length;i++)marks[i].clear()})};if(autoclear)setTimeout(clear,800);else return clear}}var currentlyHighlighted=null;function doMatchBrackets(cm){cm.operation(function(){if(currentlyHighlighted){currentlyHighlighted();currentlyHighlighted=null}currentlyHighlighted=matchBrackets(cm,false,cm.state.matchBrackets)})}CodeMirror.defineOption("matchBrackets",false,function(cm,val,old){if(old&&old!=CodeMirror.Init){cm.off("cursorActivity",doMatchBrackets);if(currentlyHighlighted){currentlyHighlighted();currentlyHighlighted=null}}if(val){cm.state.matchBrackets=typeof val=="object"?val:{};cm.on("cursorActivity",doMatchBrackets)}});CodeMirror.defineExtension("matchBrackets",function(){matchBrackets(this,true)});CodeMirror.defineExtension("findMatchingBracket",function(pos,config,oldConfig){if(oldConfig||typeof config=="boolean"){if(!oldConfig){config=config?{strict:true}:null}else{oldConfig.strict=config;config=oldConfig}}return findMatchingBracket(this,pos,config)});CodeMirror.defineExtension("scanForBracket",function(pos,dir,style,config){return scanForBracket(this,pos,dir,style,config)})})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var properties_1=__webpack_require__(64);var operators_1=__webpack_require__(65);var keywords_1=__webpack_require__(66);exports.Properties=[];for(var name_1 in properties_1.default){if(properties_1.default[name_1].isUnsupported)continue;exports.Properties.push(name_1);if(properties_1.default[name_1].abbr)exports.Properties.push.apply(exports.Properties,properties_1.default[name_1].abbr)}exports.Operators=[];operators_1.default.forEach(function(o){if(o.isUnsupported)return;exports.Operators.push(o.name);if(o.abbr)exports.Operators.push.apply(exports.Operators,o.abbr)});exports.Keywords=[];for(var name_2 in keywords_1.default){if(!keywords_1.default[name_2].map)continue;exports.Keywords.push(name_2);if(keywords_1.default[name_2].abbr)exports.Keywords.push.apply(exports.Keywords,keywords_1.default[name_2].abbr)}var _all={Properties:exports.Properties,Operators:exports.Operators.concat(["of"]),Keywords:exports.Keywords};exports.default=_all},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var properties_1=__webpack_require__(46);var operators_1=__webpack_require__(61);var keywords_1=__webpack_require__(62);exports.Properties=[];for(var name_1 in properties_1.default){if(properties_1.default[name_1].isUnsupported)continue;exports.Properties.push(name_1);if(properties_1.default[name_1].abbr)exports.Properties.push.apply(exports.Properties,properties_1.default[name_1].abbr)}exports.Operators=[];operators_1.default.forEach(function(o){if(o.isUnsupported)return;exports.Operators.push(o.name);if(o.abbr)exports.Operators.push.apply(exports.Operators,o.abbr)});exports.Keywords=[];for(var name_2 in keywords_1.default){if(!keywords_1.default[name_2].map)continue;exports.Keywords.push(name_2);if(keywords_1.default[name_2].abbr)exports.Keywords.push.apply(exports.Keywords,keywords_1.default[name_2].abbr)}var _all={Properties:exports.Properties,Operators:exports.Operators,Keywords:exports.Keywords};exports.default=_all},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var properties_1=__webpack_require__(37);var operators_1=__webpack_require__(67);var keywords_1=__webpack_require__(68);var functions_1=__webpack_require__(69);exports.Properties=[];for(var name_1 in properties_1.default){if(properties_1.default[name_1].isUnsupported)continue;exports.Properties.push(name_1);if(properties_1.default[name_1].abbr)exports.Properties.push.apply(exports.Properties,properties_1.default[name_1].abbr)}exports.Operators=[];operators_1.default.forEach(function(o){if(o.isUnsupported)return;exports.Operators.push(o.name);if(o.abbr)exports.Operators.push.apply(exports.Operators,o.abbr)});exports.Keywords=[];for(var name_2 in keywords_1.default){if(!keywords_1.default[name_2].map)continue;exports.Keywords.push(name_2);if(keywords_1.default[name_2].abbr)exports.Keywords.push.apply(exports.Keywords,keywords_1.default[name_2].abbr)}exports.Functions=[];for(var name_3 in functions_1.default){if(!functions_1.default[name_3].map)continue;exports.Functions.push(name_3)}var _all={Properties:exports.Properties,Operators:exports.Operators.concat(exports.Functions),Keywords:exports.Keywords};exports.default=_all},function(module,exports,__webpack_require__){"use strict";var ReactDOMComponentFlags={hasCachedChildNodes:1<<0};module.exports=ReactDOMComponentFlags},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);function accumulateInto(current,next){!(next!=null)?process.env.NODE_ENV!=="production"?invariant(false,"accumulateInto(...): Accumulated items must not be null or undefined."):_prodInvariant("30"):void 0;if(current==null){return next}if(Array.isArray(current)){if(Array.isArray(next)){current.push.apply(current,next);return current}current.push(next);return current}if(Array.isArray(next)){return[current].concat(next)}return[current,next]}module.exports=accumulateInto}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function forEachAccumulated(arr,cb,scope){if(Array.isArray(arr)){arr.forEach(cb,scope)}else if(arr){cb.call(scope,arr)}}module.exports=forEachAccumulated},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);var contentKey=null;function getTextContentAccessor(){if(!contentKey&&ExecutionEnvironment.canUseDOM){contentKey="textContent"in document.documentElement?"textContent":"innerText"}return contentKey}module.exports=getTextContentAccessor},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var PooledClass=__webpack_require__(23);var invariant=__webpack_require__(1);var CallbackQueue=function(){function CallbackQueue(arg){_classCallCheck(this,CallbackQueue);this._callbacks=null;this._contexts=null;this._arg=arg}CallbackQueue.prototype.enqueue=function enqueue(callback,context){this._callbacks=this._callbacks||[];this._callbacks.push(callback);this._contexts=this._contexts||[];this._contexts.push(context)};CallbackQueue.prototype.notifyAll=function notifyAll(){var callbacks=this._callbacks;var contexts=this._contexts;var arg=this._arg;if(callbacks&&contexts){!(callbacks.length===contexts.length)?process.env.NODE_ENV!=="production"?invariant(false,"Mismatched list of contexts in callback queue"):_prodInvariant("24"):void 0;this._callbacks=null;this._contexts=null;for(var i=0;i<callbacks.length;i++){callbacks[i].call(contexts[i],arg)}callbacks.length=0;contexts.length=0}};CallbackQueue.prototype.checkpoint=function checkpoint(){return this._callbacks?this._callbacks.length:0};CallbackQueue.prototype.rollback=function rollback(len){if(this._callbacks&&this._contexts){this._callbacks.length=len;this._contexts.length=len}};CallbackQueue.prototype.reset=function reset(){this._callbacks=null;this._contexts=null};CallbackQueue.prototype.destructor=function destructor(){this.reset()};return CallbackQueue}();module.exports=PooledClass.addPoolingTo(CallbackQueue)}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactFeatureFlags={logTopLevelRenders:false};module.exports=ReactFeatureFlags},function(module,exports,__webpack_require__){"use strict";var ReactDOMComponentTree=__webpack_require__(5);function isCheckable(elem){var type=elem.type;var nodeName=elem.nodeName;return nodeName&&nodeName.toLowerCase()==="input"&&(type==="checkbox"||type==="radio")}function getTracker(inst){return inst._wrapperState.valueTracker}function attachTracker(inst,tracker){inst._wrapperState.valueTracker=tracker}function detachTracker(inst){delete inst._wrapperState.valueTracker}function getValueFromNode(node){var value;if(node){value=isCheckable(node)?""+node.checked:node.value}return value}var inputValueTracking={_getTrackerFromNode:function(node){return getTracker(ReactDOMComponentTree.getInstanceFromNode(node))},track:function(inst){if(getTracker(inst)){return}var node=ReactDOMComponentTree.getNodeFromInstance(inst);var valueField=isCheckable(node)?"checked":"value";var descriptor=Object.getOwnPropertyDescriptor(node.constructor.prototype,valueField);var currentValue=""+node[valueField];if(node.hasOwnProperty(valueField)||typeof descriptor.get!=="function"||typeof descriptor.set!=="function"){return}Object.defineProperty(node,valueField,{enumerable:descriptor.enumerable,configurable:true,get:function(){return descriptor.get.call(this)},set:function(value){currentValue=""+value;descriptor.set.call(this,value)}});attachTracker(inst,{getValue:function(){return currentValue},setValue:function(value){currentValue=""+value},stopTracking:function(){detachTracker(inst);delete node[valueField]}})},updateValueIfChanged:function(inst){if(!inst){return false}var tracker=getTracker(inst);if(!tracker){inputValueTracking.track(inst);return true}var lastValue=tracker.getValue();var nextValue=getValueFromNode(ReactDOMComponentTree.getNodeFromInstance(inst));if(nextValue!==lastValue){tracker.setValue(nextValue);return true}return false},stopTracking:function(inst){var tracker=getTracker(inst);if(tracker){tracker.stopTracking()}}};module.exports=inputValueTracking},function(module,exports,__webpack_require__){"use strict";var supportedInputTypes={color:true,date:true,datetime:true,"datetime-local":true,email:true,month:true,number:true,password:true,range:true,search:true,tel:true,text:true,time:true,url:true,week:true};function isTextInputElement(elem){var nodeName=elem&&elem.nodeName&&elem.nodeName.toLowerCase();if(nodeName==="input"){return!!supportedInputTypes[elem.type]}if(nodeName==="textarea"){return true}return false}module.exports=isTextInputElement},function(module,exports,__webpack_require__){"use strict";var ViewportMetrics={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(scrollPosition){ViewportMetrics.currentScrollLeft=scrollPosition.x;ViewportMetrics.currentScrollTop=scrollPosition.y}};module.exports=ViewportMetrics},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);var escapeTextContentForBrowser=__webpack_require__(53);var setInnerHTML=__webpack_require__(52);var setTextContent=function(node,text){if(text){var firstChild=node.firstChild;if(firstChild&&firstChild===node.lastChild&&firstChild.nodeType===3){firstChild.nodeValue=text;return}}node.textContent=text};if(ExecutionEnvironment.canUseDOM){if(!("textContent"in document.documentElement)){setTextContent=function(node,text){if(node.nodeType===3){node.nodeValue=text;return}setInnerHTML(node,escapeTextContentForBrowser(text))}}}module.exports=setTextContent},function(module,exports,__webpack_require__){"use strict";function focusNode(node){try{node.focus()}catch(e){}}module.exports=focusNode},function(module,exports,__webpack_require__){"use strict";var isUnitlessNumber={animationIterationCount:true,borderImageOutset:true,borderImageSlice:true,borderImageWidth:true,boxFlex:true,boxFlexGroup:true,boxOrdinalGroup:true,columnCount:true,flex:true,flexGrow:true,flexPositive:true,flexShrink:true,flexNegative:true,flexOrder:true,gridRow:true,gridRowEnd:true,gridRowSpan:true,gridRowStart:true,gridColumn:true,gridColumnEnd:true,gridColumnSpan:true,gridColumnStart:true,fontWeight:true,lineClamp:true,lineHeight:true,opacity:true,order:true,orphans:true,tabSize:true,widows:true,zIndex:true,zoom:true,fillOpacity:true,floodOpacity:true,stopOpacity:true,strokeDasharray:true,strokeDashoffset:true,strokeMiterlimit:true,strokeOpacity:true,strokeWidth:true};function prefixKey(prefix,key){return prefix+key.charAt(0).toUpperCase()+key.substring(1)}var prefixes=["Webkit","ms","Moz","O"];Object.keys(isUnitlessNumber).forEach(function(prop){prefixes.forEach(function(prefix){isUnitlessNumber[prefixKey(prefix,prop)]=isUnitlessNumber[prop]})});var shorthandPropertyExpansions={background:{backgroundAttachment:true,backgroundColor:true,backgroundImage:true,backgroundPositionX:true,backgroundPositionY:true,backgroundRepeat:true},backgroundPosition:{backgroundPositionX:true,backgroundPositionY:true},border:{borderWidth:true,borderStyle:true,borderColor:true},borderBottom:{borderBottomWidth:true,borderBottomStyle:true,borderBottomColor:true},borderLeft:{borderLeftWidth:true,borderLeftStyle:true,borderLeftColor:true},borderRight:{borderRightWidth:true,borderRightStyle:true,borderRightColor:true},borderTop:{borderTopWidth:true,borderTopStyle:true,borderTopColor:true},font:{fontStyle:true,fontVariant:true,fontWeight:true,fontSize:true,lineHeight:true,fontFamily:true},outline:{outlineWidth:true,outlineStyle:true,outlineColor:true}};var CSSProperty={isUnitlessNumber:isUnitlessNumber,shorthandPropertyExpansions:shorthandPropertyExpansions};module.exports=CSSProperty},function(module,exports,__webpack_require__){"use strict";(function(process){var DOMProperty=__webpack_require__(21);var ReactDOMComponentTree=__webpack_require__(5);var ReactInstrumentation=__webpack_require__(12);var quoteAttributeValueForBrowser=__webpack_require__(271);var warning=__webpack_require__(2);var VALID_ATTRIBUTE_NAME_REGEX=new RegExp("^["+DOMProperty.ATTRIBUTE_NAME_START_CHAR+"]["+DOMProperty.ATTRIBUTE_NAME_CHAR+"]*$");var illegalAttributeNameCache={};var validatedAttributeNameCache={};function isAttributeNameSafe(attributeName){if(validatedAttributeNameCache.hasOwnProperty(attributeName)){return true}if(illegalAttributeNameCache.hasOwnProperty(attributeName)){return false}if(VALID_ATTRIBUTE_NAME_REGEX.test(attributeName)){validatedAttributeNameCache[attributeName]=true;return true}illegalAttributeNameCache[attributeName]=true;process.env.NODE_ENV!=="production"?warning(false,"Invalid attribute name: `%s`",attributeName):void 0;return false}function shouldIgnoreValue(propertyInfo,value){return value==null||propertyInfo.hasBooleanValue&&!value||propertyInfo.hasNumericValue&&isNaN(value)||propertyInfo.hasPositiveNumericValue&&value<1||propertyInfo.hasOverloadedBooleanValue&&value===false}var DOMPropertyOperations={createMarkupForID:function(id){return DOMProperty.ID_ATTRIBUTE_NAME+"="+quoteAttributeValueForBrowser(id)},setAttributeForID:function(node,id){node.setAttribute(DOMProperty.ID_ATTRIBUTE_NAME,id)},createMarkupForRoot:function(){return DOMProperty.ROOT_ATTRIBUTE_NAME+'=""'},setAttributeForRoot:function(node){node.setAttribute(DOMProperty.ROOT_ATTRIBUTE_NAME,"")},createMarkupForProperty:function(name,value){var propertyInfo=DOMProperty.properties.hasOwnProperty(name)?DOMProperty.properties[name]:null;if(propertyInfo){if(shouldIgnoreValue(propertyInfo,value)){return""}var attributeName=propertyInfo.attributeName;if(propertyInfo.hasBooleanValue||propertyInfo.hasOverloadedBooleanValue&&value===true){return attributeName+'=""'}return attributeName+"="+quoteAttributeValueForBrowser(value)}else if(DOMProperty.isCustomAttribute(name)){if(value==null){return""}return name+"="+quoteAttributeValueForBrowser(value)}return null},createMarkupForCustomAttribute:function(name,value){if(!isAttributeNameSafe(name)||value==null){return""}return name+"="+quoteAttributeValueForBrowser(value)},setValueForProperty:function(node,name,value){var propertyInfo=DOMProperty.properties.hasOwnProperty(name)?DOMProperty.properties[name]:null;if(propertyInfo){var mutationMethod=propertyInfo.mutationMethod;if(mutationMethod){mutationMethod(node,value)}else if(shouldIgnoreValue(propertyInfo,value)){this.deleteValueForProperty(node,name);return}else if(propertyInfo.mustUseProperty){node[propertyInfo.propertyName]=value}else{var attributeName=propertyInfo.attributeName;var namespace=propertyInfo.attributeNamespace;if(namespace){node.setAttributeNS(namespace,attributeName,""+value)}else if(propertyInfo.hasBooleanValue||propertyInfo.hasOverloadedBooleanValue&&value===true){node.setAttribute(attributeName,"")}else{node.setAttribute(attributeName,""+value)}}}else if(DOMProperty.isCustomAttribute(name)){DOMPropertyOperations.setValueForAttribute(node,name,value);return}if(process.env.NODE_ENV!=="production"){var payload={};payload[name]=value;ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"update attribute",payload:payload})}},setValueForAttribute:function(node,name,value){if(!isAttributeNameSafe(name)){return}if(value==null){node.removeAttribute(name)}else{node.setAttribute(name,""+value)}if(process.env.NODE_ENV!=="production"){var payload={};payload[name]=value;ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"update attribute",payload:payload})}},deleteValueForAttribute:function(node,name){node.removeAttribute(name);if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"remove attribute",payload:name})}},deleteValueForProperty:function(node,name){var propertyInfo=DOMProperty.properties.hasOwnProperty(name)?DOMProperty.properties[name]:null;if(propertyInfo){var mutationMethod=propertyInfo.mutationMethod;if(mutationMethod){mutationMethod(node,undefined)}else if(propertyInfo.mustUseProperty){var propName=propertyInfo.propertyName;if(propertyInfo.hasBooleanValue){node[propName]=false}else{node[propName]=""}}else{node.removeAttribute(propertyInfo.attributeName)}}else if(DOMProperty.isCustomAttribute(name)){node.removeAttribute(name)}if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:ReactDOMComponentTree.getInstanceFromNode(node)._debugID,type:"remove attribute",payload:name})}}};module.exports=DOMPropertyOperations}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var LinkedValueUtils=__webpack_require__(82);var ReactDOMComponentTree=__webpack_require__(5);var ReactUpdates=__webpack_require__(16);var warning=__webpack_require__(2);var didWarnValueLink=false;var didWarnValueDefaultValue=false;function updateOptionsIfPendingUpdateAndMounted(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=false;var props=this._currentElement.props;var value=LinkedValueUtils.getValue(props);if(value!=null){updateOptions(this,Boolean(props.multiple),value)}}}function getDeclarationErrorAddendum(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""}var valuePropNames=["value","defaultValue"];function checkSelectPropTypes(inst,props){var owner=inst._currentElement._owner;LinkedValueUtils.checkPropTypes("select",props,owner);if(props.valueLink!==undefined&&!didWarnValueLink){process.env.NODE_ENV!=="production"?warning(false,"`valueLink` prop on `select` is deprecated; set `value` and `onChange` instead."):void 0;didWarnValueLink=true}for(var i=0;i<valuePropNames.length;i++){var propName=valuePropNames[i];if(props[propName]==null){continue}var isArray=Array.isArray(props[propName]);if(props.multiple&&!isArray){process.env.NODE_ENV!=="production"?warning(false,"The `%s` prop supplied to <select> must be an array if "+"`multiple` is true.%s",propName,getDeclarationErrorAddendum(owner)):void 0}else if(!props.multiple&&isArray){process.env.NODE_ENV!=="production"?warning(false,"The `%s` prop supplied to <select> must be a scalar "+"value if `multiple` is false.%s",propName,getDeclarationErrorAddendum(owner)):void 0}}}function updateOptions(inst,multiple,propValue){var selectedValue,i;var options=ReactDOMComponentTree.getNodeFromInstance(inst).options;if(multiple){selectedValue={};for(i=0;i<propValue.length;i++){selectedValue[""+propValue[i]]=true}for(i=0;i<options.length;i++){var selected=selectedValue.hasOwnProperty(options[i].value);if(options[i].selected!==selected){options[i].selected=selected}}}else{selectedValue=""+propValue;for(i=0;i<options.length;i++){if(options[i].value===selectedValue){options[i].selected=true;return}}if(options.length){options[0].selected=true}}}var ReactDOMSelect={getHostProps:function(inst,props){return _assign({},props,{onChange:inst._wrapperState.onChange,value:undefined})},mountWrapper:function(inst,props){if(process.env.NODE_ENV!=="production"){checkSelectPropTypes(inst,props)}var value=LinkedValueUtils.getValue(props);inst._wrapperState={pendingUpdate:false,initialValue:value!=null?value:props.defaultValue,listeners:null,onChange:_handleChange.bind(inst),wasMultiple:Boolean(props.multiple)};if(props.value!==undefined&&props.defaultValue!==undefined&&!didWarnValueDefaultValue){process.env.NODE_ENV!=="production"?warning(false,"Select elements must be either controlled or uncontrolled "+"(specify either the value prop, or the defaultValue prop, but not "+"both). Decide between using a controlled or uncontrolled select "+"element and remove one of these props. More info: "+"https://fb.me/react-controlled-components"):void 0;didWarnValueDefaultValue=true}},getSelectValueContext:function(inst){return inst._wrapperState.initialValue},postUpdateWrapper:function(inst){var props=inst._currentElement.props;inst._wrapperState.initialValue=undefined;var wasMultiple=inst._wrapperState.wasMultiple;inst._wrapperState.wasMultiple=Boolean(props.multiple);var value=LinkedValueUtils.getValue(props);if(value!=null){inst._wrapperState.pendingUpdate=false;updateOptions(inst,Boolean(props.multiple),value)}else if(wasMultiple!==Boolean(props.multiple)){if(props.defaultValue!=null){updateOptions(inst,Boolean(props.multiple),props.defaultValue)}else{updateOptions(inst,Boolean(props.multiple),props.multiple?[]:"")}}}};function _handleChange(event){var props=this._currentElement.props;var returnValue=LinkedValueUtils.executeOnChange(props,event);if(this._rootNodeID){this._wrapperState.pendingUpdate=true}ReactUpdates.asap(updateOptionsIfPendingUpdateAndMounted,this);return returnValue}module.exports=ReactDOMSelect}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var ReactCompositeComponent=__webpack_require__(279);var ReactEmptyComponent=__webpack_require__(128);var ReactHostComponent=__webpack_require__(129);var getNextDebugID=__webpack_require__(282);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var ReactCompositeComponentWrapper=function(element){this.construct(element)};function getDeclarationErrorAddendum(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""}function isInternalComponentType(type){return typeof type==="function"&&typeof type.prototype!=="undefined"&&typeof type.prototype.mountComponent==="function"&&typeof type.prototype.receiveComponent==="function"}function instantiateReactComponent(node,shouldHaveDebugID){var instance;if(node===null||node===false){instance=ReactEmptyComponent.create(instantiateReactComponent)}else if(typeof node==="object"){var element=node;var type=element.type;if(typeof type!=="function"&&typeof type!=="string"){var info="";if(process.env.NODE_ENV!=="production"){if(type===undefined||typeof type==="object"&&type!==null&&Object.keys(type).length===0){info+=" You likely forgot to export your component from the file "+"it's defined in."}}info+=getDeclarationErrorAddendum(element._owner);true?process.env.NODE_ENV!=="production"?invariant(false,"Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",type==null?type:typeof type,info):_prodInvariant("130",type==null?type:typeof type,info):void 0}if(typeof element.type==="string"){instance=ReactHostComponent.createInternalComponent(element)}else if(isInternalComponentType(element.type)){instance=new element.type(element);if(!instance.getHostNode){instance.getHostNode=instance.getNativeNode}}else{instance=new ReactCompositeComponentWrapper(element)}}else if(typeof node==="string"||typeof node==="number"){instance=ReactHostComponent.createInstanceForText(node)}else{true?process.env.NODE_ENV!=="production"?invariant(false,"Encountered invalid React node of type %s",typeof node):_prodInvariant("131",typeof node):void 0}if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(typeof instance.mountComponent==="function"&&typeof instance.receiveComponent==="function"&&typeof instance.getHostNode==="function"&&typeof instance.unmountComponent==="function","Only React Components can be mounted."):void 0}instance._mountIndex=0;instance._mountImage=null;if(process.env.NODE_ENV!=="production"){instance._debugID=shouldHaveDebugID?getNextDebugID():0}if(process.env.NODE_ENV!=="production"){if(Object.preventExtensions){Object.preventExtensions(instance)}}return instance}_assign(ReactCompositeComponentWrapper.prototype,ReactCompositeComponent,{_instantiateReactComponent:instantiateReactComponent});module.exports=instantiateReactComponent}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var React=__webpack_require__(28);var invariant=__webpack_require__(1);var ReactNodeTypes={HOST:0,COMPOSITE:1,EMPTY:2,getType:function(node){if(node===null||node===false){return ReactNodeTypes.EMPTY}else if(React.isValidElement(node)){if(typeof node.type==="function"){return ReactNodeTypes.COMPOSITE}else{return ReactNodeTypes.HOST}}true?process.env.NODE_ENV!=="production"?invariant(false,"Unexpected node: %s",node):_prodInvariant("26",node):void 0}};module.exports=ReactNodeTypes}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var emptyComponentFactory;var ReactEmptyComponentInjection={injectEmptyComponentFactory:function(factory){emptyComponentFactory=factory}};var ReactEmptyComponent={create:function(instantiate){return emptyComponentFactory(instantiate)}};ReactEmptyComponent.injection=ReactEmptyComponentInjection;module.exports=ReactEmptyComponent},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);var genericComponentClass=null;var textComponentClass=null;var ReactHostComponentInjection={injectGenericComponentClass:function(componentClass){genericComponentClass=componentClass},injectTextComponentClass:function(componentClass){textComponentClass=componentClass}};function createInternalComponent(element){!genericComponentClass?process.env.NODE_ENV!=="production"?invariant(false,"There is no registered component for the tag %s",element.type):_prodInvariant("111",element.type):void 0;return new genericComponentClass(element)}function createInstanceForText(text){return new textComponentClass(text)}function isTextComponent(component){return component instanceof textComponentClass}var ReactHostComponent={createInternalComponent:createInternalComponent,createInstanceForText:createInstanceForText,isTextComponent:isTextComponent,injection:ReactHostComponentInjection};module.exports=ReactHostComponent}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactCurrentOwner=__webpack_require__(15);var REACT_ELEMENT_TYPE=__webpack_require__(283);var getIteratorFn=__webpack_require__(284);var invariant=__webpack_require__(1);var KeyEscapeUtils=__webpack_require__(86);var warning=__webpack_require__(2);var SEPARATOR=".";var SUBSEPARATOR=":";var didWarnAboutMaps=false;function getComponentKey(component,index){if(component&&typeof component==="object"&&component.key!=null){return KeyEscapeUtils.escape(component.key)}return index.toString(36)}function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children;if(type==="undefined"||type==="boolean"){children=null}if(children===null||type==="string"||type==="number"||type==="object"&&children.$$typeof===REACT_ELEMENT_TYPE){callback(traverseContext,children,nameSoFar===""?SEPARATOR+getComponentKey(children,0):nameSoFar);return 1}var child;var nextName;var subtreeCount=0;var nextNamePrefix=nameSoFar===""?SEPARATOR:nameSoFar+SUBSEPARATOR;if(Array.isArray(children)){for(var i=0;i<children.length;i++){child=children[i];nextName=nextNamePrefix+getComponentKey(child,i);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{var iteratorFn=getIteratorFn(children);if(iteratorFn){var iterator=iteratorFn.call(children);var step;if(iteratorFn!==children.entries){var ii=0;while(!(step=iterator.next()).done){child=step.value;nextName=nextNamePrefix+getComponentKey(child,ii++);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{if(process.env.NODE_ENV!=="production"){var mapsAsChildrenAddendum="";if(ReactCurrentOwner.current){var mapsAsChildrenOwnerName=ReactCurrentOwner.current.getName();if(mapsAsChildrenOwnerName){mapsAsChildrenAddendum=" Check the render method of `"+mapsAsChildrenOwnerName+"`."}}process.env.NODE_ENV!=="production"?warning(didWarnAboutMaps,"Using Maps as children is not yet fully supported. It is an "+"experimental feature that might be removed. Convert it to a "+"sequence / iterable of keyed ReactElements instead.%s",mapsAsChildrenAddendum):void 0;didWarnAboutMaps=true}while(!(step=iterator.next()).done){var entry=step.value;if(entry){child=entry[1];nextName=nextNamePrefix+KeyEscapeUtils.escape(entry[0])+SUBSEPARATOR+getComponentKey(child,0);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}}}else if(type==="object"){var addendum="";if(process.env.NODE_ENV!=="production"){addendum=" If you meant to render a collection of children, use an array "+"instead or wrap the object using createFragment(object) from the "+"React add-ons.";if(children._isReactElement){addendum=" It looks like you're using an element created by a different "+"version of React. Make sure to use only one copy of React."}if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){addendum+=" Check the render method of `"+name+"`."}}}var childrenString=String(children);true?process.env.NODE_ENV!=="production"?invariant(false,"Objects are not valid as a React child (found: %s).%s",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):_prodInvariant("31",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):void 0}}return subtreeCount}function traverseAllChildren(children,callback,traverseContext){if(children==null){return 0}return traverseAllChildrenImpl(children,"",callback,traverseContext)}module.exports=traverseAllChildren}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var emptyFunction=__webpack_require__(10);var EventListener={listen:function listen(target,eventType,callback){if(target.addEventListener){target.addEventListener(eventType,callback,false);return{remove:function remove(){target.removeEventListener(eventType,callback,false)}}}else if(target.attachEvent){target.attachEvent("on"+eventType,callback);return{remove:function remove(){target.detachEvent("on"+eventType,callback)}}}},capture:function capture(target,eventType,callback){if(target.addEventListener){target.addEventListener(eventType,callback,true);return{remove:function remove(){target.removeEventListener(eventType,callback,true)}}}else{if(process.env.NODE_ENV!=="production"){console.error("Attempted to listen to events during the capture phase on a "+"browser that does not support the capture phase. Your application "+"will not receive some events.")}return{remove:emptyFunction}}},registerDefault:function registerDefault(){}};module.exports=EventListener}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactDOMSelection=__webpack_require__(296);var containsNode=__webpack_require__(298);var focusNode=__webpack_require__(121);var getActiveElement=__webpack_require__(133);function isInDocument(node){return containsNode(document.documentElement,node)}var ReactInputSelection={hasSelectionCapabilities:function(elem){var nodeName=elem&&elem.nodeName&&elem.nodeName.toLowerCase();return nodeName&&(nodeName==="input"&&elem.type==="text"||nodeName==="textarea"||elem.contentEditable==="true")},getSelectionInformation:function(){var focusedElem=getActiveElement();return{focusedElem:focusedElem,selectionRange:ReactInputSelection.hasSelectionCapabilities(focusedElem)?ReactInputSelection.getSelection(focusedElem):null}},restoreSelection:function(priorSelectionInformation){var curFocusedElem=getActiveElement();var priorFocusedElem=priorSelectionInformation.focusedElem;var priorSelectionRange=priorSelectionInformation.selectionRange;if(curFocusedElem!==priorFocusedElem&&isInDocument(priorFocusedElem)){if(ReactInputSelection.hasSelectionCapabilities(priorFocusedElem)){ReactInputSelection.setSelection(priorFocusedElem,priorSelectionRange)}focusNode(priorFocusedElem)}},getSelection:function(input){var selection;if("selectionStart"in input){selection={start:input.selectionStart,end:input.selectionEnd}}else if(document.selection&&input.nodeName&&input.nodeName.toLowerCase()==="input"){var range=document.selection.createRange();if(range.parentElement()===input){selection={start:-range.moveStart("character",-input.value.length),end:-range.moveEnd("character",-input.value.length)}}}else{selection=ReactDOMSelection.getOffsets(input)}return selection||{start:0,end:0}},setSelection:function(input,offsets){var start=offsets.start;var end=offsets.end;if(end===undefined){end=start}if("selectionStart"in input){input.selectionStart=start;input.selectionEnd=Math.min(end,input.value.length)}else if(document.selection&&input.nodeName&&input.nodeName.toLowerCase()==="input"){var range=input.createTextRange();range.collapse(true);range.moveStart("character",start);range.moveEnd("character",end-start);range.select()}else{ReactDOMSelection.setOffsets(input,offsets)}}};module.exports=ReactInputSelection},function(module,exports,__webpack_require__){"use strict";function getActiveElement(doc){doc=doc||(typeof document!=="undefined"?document:undefined);if(typeof doc==="undefined"){return null}try{return doc.activeElement||doc.body}catch(e){return doc.body}}module.exports=getActiveElement},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var DOMLazyTree=__webpack_require__(32);var DOMProperty=__webpack_require__(21);var React=__webpack_require__(28);var ReactBrowserEventEmitter=__webpack_require__(54);var ReactCurrentOwner=__webpack_require__(15);var ReactDOMComponentTree=__webpack_require__(5);var ReactDOMContainerInfo=__webpack_require__(313);var ReactDOMFeatureFlags=__webpack_require__(314);var ReactFeatureFlags=__webpack_require__(116);var ReactInstanceMap=__webpack_require__(42);var ReactInstrumentation=__webpack_require__(12);var ReactMarkupChecksum=__webpack_require__(315);var ReactReconciler=__webpack_require__(31);var ReactUpdateQueue=__webpack_require__(87);var ReactUpdates=__webpack_require__(16);var emptyObject=__webpack_require__(48);var instantiateReactComponent=__webpack_require__(126);var invariant=__webpack_require__(1);var setInnerHTML=__webpack_require__(52);var shouldUpdateReactComponent=__webpack_require__(85);var warning=__webpack_require__(2);var ATTR_NAME=DOMProperty.ID_ATTRIBUTE_NAME;var ROOT_ATTR_NAME=DOMProperty.ROOT_ATTRIBUTE_NAME;var ELEMENT_NODE_TYPE=1;var DOC_NODE_TYPE=9;var DOCUMENT_FRAGMENT_NODE_TYPE=11;var instancesByReactRootID={};function firstDifferenceIndex(string1,string2){var minLen=Math.min(string1.length,string2.length);for(var i=0;i<minLen;i++){if(string1.charAt(i)!==string2.charAt(i)){return i}}return string1.length===string2.length?-1:minLen}function getReactRootElementInContainer(container){if(!container){return null}if(container.nodeType===DOC_NODE_TYPE){return container.documentElement}else{return container.firstChild}}function internalGetID(node){return node.getAttribute&&node.getAttribute(ATTR_NAME)||""}function mountComponentIntoNode(wrapperInstance,container,transaction,shouldReuseMarkup,context){var markerName;if(ReactFeatureFlags.logTopLevelRenders){var wrappedElement=wrapperInstance._currentElement.props.child;var type=wrappedElement.type;markerName="React mount: "+(typeof type==="string"?type:type.displayName||type.name);console.time(markerName)}var markup=ReactReconciler.mountComponent(wrapperInstance,transaction,null,ReactDOMContainerInfo(wrapperInstance,container),context,0);if(markerName){console.timeEnd(markerName)}wrapperInstance._renderedComponent._topLevelWrapper=wrapperInstance;ReactMount._mountImageIntoNode(markup,container,wrapperInstance,shouldReuseMarkup,transaction)}function batchedMountComponentIntoNode(componentInstance,container,shouldReuseMarkup,context){var transaction=ReactUpdates.ReactReconcileTransaction.getPooled(!shouldReuseMarkup&&ReactDOMFeatureFlags.useCreateElement);transaction.perform(mountComponentIntoNode,null,componentInstance,container,transaction,shouldReuseMarkup,context);ReactUpdates.ReactReconcileTransaction.release(transaction)}function unmountComponentFromNode(instance,container,safely){if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onBeginFlush()}ReactReconciler.unmountComponent(instance,safely);if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onEndFlush()}if(container.nodeType===DOC_NODE_TYPE){container=container.documentElement}while(container.lastChild){container.removeChild(container.lastChild)}}function hasNonRootReactChild(container){var rootEl=getReactRootElementInContainer(container);if(rootEl){var inst=ReactDOMComponentTree.getInstanceFromNode(rootEl);return!!(inst&&inst._hostParent)}}function nodeIsRenderedByOtherInstance(container){var rootEl=getReactRootElementInContainer(container);return!!(rootEl&&isReactNode(rootEl)&&!ReactDOMComponentTree.getInstanceFromNode(rootEl))}function isValidContainer(node){return!!(node&&(node.nodeType===ELEMENT_NODE_TYPE||node.nodeType===DOC_NODE_TYPE||node.nodeType===DOCUMENT_FRAGMENT_NODE_TYPE))}function isReactNode(node){return isValidContainer(node)&&(node.hasAttribute(ROOT_ATTR_NAME)||node.hasAttribute(ATTR_NAME))}function getHostRootInstanceInContainer(container){var rootEl=getReactRootElementInContainer(container);var prevHostInstance=rootEl&&ReactDOMComponentTree.getInstanceFromNode(rootEl);return prevHostInstance&&!prevHostInstance._hostParent?prevHostInstance:null}function getTopLevelWrapperInContainer(container){var root=getHostRootInstanceInContainer(container);return root?root._hostContainerInfo._topLevelWrapper:null}var topLevelRootCounter=1;var TopLevelWrapper=function(){this.rootID=topLevelRootCounter++};TopLevelWrapper.prototype.isReactComponent={};if(process.env.NODE_ENV!=="production"){TopLevelWrapper.displayName="TopLevelWrapper"}TopLevelWrapper.prototype.render=function(){return this.props.child};TopLevelWrapper.isReactTopLevelWrapper=true;var ReactMount={TopLevelWrapper:TopLevelWrapper,_instancesByReactRootID:instancesByReactRootID,scrollMonitor:function(container,renderCallback){renderCallback()},_updateRootComponent:function(prevComponent,nextElement,nextContext,container,callback){ReactMount.scrollMonitor(container,function(){ReactUpdateQueue.enqueueElementInternal(prevComponent,nextElement,nextContext);if(callback){ReactUpdateQueue.enqueueCallbackInternal(prevComponent,callback)}});return prevComponent},_renderNewRootComponent:function(nextElement,container,shouldReuseMarkup,context){process.env.NODE_ENV!=="production"?warning(ReactCurrentOwner.current==null,"_renderNewRootComponent(): Render methods should be a pure function "+"of props and state; triggering nested component updates from "+"render is not allowed. If necessary, trigger nested updates in "+"componentDidUpdate. Check the render method of %s.",ReactCurrentOwner.current&&ReactCurrentOwner.current.getName()||"ReactCompositeComponent"):void 0;!isValidContainer(container)?process.env.NODE_ENV!=="production"?invariant(false,"_registerComponent(...): Target container is not a DOM element."):_prodInvariant("37"):void 0;ReactBrowserEventEmitter.ensureScrollValueMonitoring();var componentInstance=instantiateReactComponent(nextElement,false);ReactUpdates.batchedUpdates(batchedMountComponentIntoNode,componentInstance,container,shouldReuseMarkup,context);var wrapperID=componentInstance._instance.rootID;instancesByReactRootID[wrapperID]=componentInstance;return componentInstance},renderSubtreeIntoContainer:function(parentComponent,nextElement,container,callback){!(parentComponent!=null&&ReactInstanceMap.has(parentComponent))?process.env.NODE_ENV!=="production"?invariant(false,"parentComponent must be a valid React Component"):_prodInvariant("38"):void 0;return ReactMount._renderSubtreeIntoContainer(parentComponent,nextElement,container,callback)},_renderSubtreeIntoContainer:function(parentComponent,nextElement,container,callback){ReactUpdateQueue.validateCallback(callback,"ReactDOM.render");!React.isValidElement(nextElement)?process.env.NODE_ENV!=="production"?invariant(false,"ReactDOM.render(): Invalid component element.%s",typeof nextElement==="string"?" Instead of passing a string like 'div', pass "+"React.createElement('div') or <div />.":typeof nextElement==="function"?" Instead of passing a class like Foo, pass "+"React.createElement(Foo) or <Foo />.":nextElement!=null&&nextElement.props!==undefined?" This may be caused by unintentionally loading two independent "+"copies of React.":""):_prodInvariant("39",typeof nextElement==="string"?" Instead of passing a string like 'div', pass "+"React.createElement('div') or <div />.":typeof nextElement==="function"?" Instead of passing a class like Foo, pass "+"React.createElement(Foo) or <Foo />.":nextElement!=null&&nextElement.props!==undefined?" This may be caused by unintentionally loading two independent "+"copies of React.":""):void 0;process.env.NODE_ENV!=="production"?warning(!container||!container.tagName||container.tagName.toUpperCase()!=="BODY","render(): Rendering components directly into document.body is "+"discouraged, since its children are often manipulated by third-party "+"scripts and browser extensions. This may lead to subtle "+"reconciliation issues. Try rendering into a container element created "+"for your app."):void 0;var nextWrappedElement=React.createElement(TopLevelWrapper,{child:nextElement});var nextContext;if(parentComponent){var parentInst=ReactInstanceMap.get(parentComponent);nextContext=parentInst._processChildContext(parentInst._context)}else{nextContext=emptyObject}var prevComponent=getTopLevelWrapperInContainer(container);if(prevComponent){var prevWrappedElement=prevComponent._currentElement;var prevElement=prevWrappedElement.props.child;if(shouldUpdateReactComponent(prevElement,nextElement)){var publicInst=prevComponent._renderedComponent.getPublicInstance();var updatedCallback=callback&&function(){callback.call(publicInst)};ReactMount._updateRootComponent(prevComponent,nextWrappedElement,nextContext,container,updatedCallback);return publicInst}else{ReactMount.unmountComponentAtNode(container)}}var reactRootElement=getReactRootElementInContainer(container);var containerHasReactMarkup=reactRootElement&&!!internalGetID(reactRootElement);var containerHasNonRootReactChild=hasNonRootReactChild(container);if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(!containerHasNonRootReactChild,"render(...): Replacing React-rendered children with a new root "+"component. If you intended to update the children of this node, "+"you should instead have the existing children update their state "+"and render the new components instead of calling ReactDOM.render."):void 0;if(!containerHasReactMarkup||reactRootElement.nextSibling){var rootElementSibling=reactRootElement;while(rootElementSibling){if(internalGetID(rootElementSibling)){process.env.NODE_ENV!=="production"?warning(false,"render(): Target node has markup rendered by React, but there "+"are unrelated nodes as well. This is most commonly caused by "+"white-space inserted around server-rendered markup."):void 0;break}rootElementSibling=rootElementSibling.nextSibling}}}var shouldReuseMarkup=containerHasReactMarkup&&!prevComponent&&!containerHasNonRootReactChild;var component=ReactMount._renderNewRootComponent(nextWrappedElement,container,shouldReuseMarkup,nextContext)._renderedComponent.getPublicInstance();if(callback){callback.call(component)}return component},render:function(nextElement,container,callback){return ReactMount._renderSubtreeIntoContainer(null,nextElement,container,callback)},unmountComponentAtNode:function(container){process.env.NODE_ENV!=="production"?warning(ReactCurrentOwner.current==null,"unmountComponentAtNode(): Render methods should be a pure function "+"of props and state; triggering nested component updates from render "+"is not allowed. If necessary, trigger nested updates in "+"componentDidUpdate. Check the render method of %s.",ReactCurrentOwner.current&&ReactCurrentOwner.current.getName()||"ReactCompositeComponent"):void 0;!isValidContainer(container)?process.env.NODE_ENV!=="production"?invariant(false,"unmountComponentAtNode(...): Target container is not a DOM element."):_prodInvariant("40"):void 0;if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(!nodeIsRenderedByOtherInstance(container),"unmountComponentAtNode(): The node you're attempting to unmount "+"was rendered by another copy of React."):void 0}var prevComponent=getTopLevelWrapperInContainer(container);if(!prevComponent){var containerHasNonRootReactChild=hasNonRootReactChild(container);var isContainerReactRoot=container.nodeType===1&&container.hasAttribute(ROOT_ATTR_NAME);if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(!containerHasNonRootReactChild,"unmountComponentAtNode(): The node you're attempting to unmount "+"was rendered by React and is not a top-level container. %s",isContainerReactRoot?"You may have accidentally passed in a React root node instead "+"of its container.":"Instead, have the parent component update its state and "+"rerender in order to remove this component."):void 0}return false}delete instancesByReactRootID[prevComponent._instance.rootID];ReactUpdates.batchedUpdates(unmountComponentFromNode,prevComponent,container,false);return true},_mountImageIntoNode:function(markup,container,instance,shouldReuseMarkup,transaction){!isValidContainer(container)?process.env.NODE_ENV!=="production"?invariant(false,"mountComponentIntoNode(...): Target container is not valid."):_prodInvariant("41"):void 0;if(shouldReuseMarkup){var rootElement=getReactRootElementInContainer(container);if(ReactMarkupChecksum.canReuseMarkup(markup,rootElement)){ReactDOMComponentTree.precacheNode(instance,rootElement);return}else{var checksum=rootElement.getAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);rootElement.removeAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);var rootMarkup=rootElement.outerHTML;rootElement.setAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME,checksum);var normalizedMarkup=markup;if(process.env.NODE_ENV!=="production"){var normalizer;if(container.nodeType===ELEMENT_NODE_TYPE){normalizer=document.createElement("div");normalizer.innerHTML=markup;normalizedMarkup=normalizer.innerHTML}else{normalizer=document.createElement("iframe");document.body.appendChild(normalizer);normalizer.contentDocument.write(markup);normalizedMarkup=normalizer.contentDocument.documentElement.outerHTML;document.body.removeChild(normalizer)}}var diffIndex=firstDifferenceIndex(normalizedMarkup,rootMarkup);var difference=" (client) "+normalizedMarkup.substring(diffIndex-20,diffIndex+20)+"\n (server) "+rootMarkup.substring(diffIndex-20,diffIndex+20);!(container.nodeType!==DOC_NODE_TYPE)?process.env.NODE_ENV!=="production"?invariant(false,"You're trying to render a component to the document using server rendering but the checksum was invalid. This usually means you rendered a different component type or props on the client from the one on the server, or your render() methods are impure. React cannot handle this case due to cross-browser quirks by rendering at the document root. You should look for environment dependent code in your components and ensure the props are the same client and server side:\n%s",difference):_prodInvariant("42",difference):void 0;if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(false,"React attempted to reuse markup in a container but the "+"checksum was invalid. This generally means that you are "+"using server rendering and the markup generated on the "+"server was not what the client was expecting. React injected "+"new markup to compensate which works but you have lost many "+"of the benefits of server rendering. Instead, figure out "+"why the markup being generated is different on the client "+"or server:\n%s",difference):void 0}}}!(container.nodeType!==DOC_NODE_TYPE)?process.env.NODE_ENV!=="production"?invariant(false,"You're trying to render a component to the document but you didn't use server rendering. We can't do this without using server rendering due to cross-browser quirks. See ReactDOMServer.renderToString() for server rendering."):_prodInvariant("43"):void 0;if(transaction.useCreateElement){while(container.lastChild){container.removeChild(container.lastChild)}DOMLazyTree.insertTreeBefore(container,markup,null)}else{setInnerHTML(container,markup);ReactDOMComponentTree.precacheNode(instance,container.firstChild)}if(process.env.NODE_ENV!=="production"){var hostNode=ReactDOMComponentTree.getInstanceFromNode(container.firstChild);if(hostNode._debugID!==0){ReactInstrumentation.debugTool.onHostOperation({instanceID:hostNode._debugID,type:"mount",payload:markup.toString()})}}}};module.exports=ReactMount}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactNodeTypes=__webpack_require__(127);function getHostComponentFromComposite(inst){var type;while((type=inst._renderedNodeType)===ReactNodeTypes.COMPOSITE){inst=inst._renderedComponent}if(type===ReactNodeTypes.HOST){return inst._renderedComponent}else if(type===ReactNodeTypes.EMPTY){return null}}module.exports=getHostComponentFromComposite},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var state_1=__webpack_require__(137);var ui_1=__webpack_require__(187);var React=__webpack_require__(38);var ReactDOM=__webpack_require__(237);var state=new state_1.default;ReactDOM.render(React.createElement(ui_1.default,{state:state}),document.getElementById("app"))},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};Object.defineProperty(exports,"__esModule",{value:true});var litemol_1=__webpack_require__(55);var parser_1=__webpack_require__(141);var compiler_1=__webpack_require__(145);var context_1=__webpack_require__(45);var result_1=__webpack_require__(95);var languages_1=__webpack_require__(96);var Rx=litemol_1.default.Core.Rx;var Transformer=litemol_1.default.Bootstrap.Entity.Transformer;var State=function(){function State(){var _this=this;this.queryString=new Rx.BehaviorSubject("");this.query=new Rx.BehaviorSubject({kind:"error",message:"Enter query"});this.compileTarget=new Rx.BehaviorSubject("lisp");this.currentLanguage=new Rx.BehaviorSubject({language:languages_1.default[0],example:languages_1.default[0].examples[0]});this.pdbId="1tqn";this.structureData=void 0;this.loadState=new Rx.BehaviorSubject("none");this.currentSymbol=new Rx.BehaviorSubject("");this.editorActive=new Rx.BehaviorSubject(false);this.queryResult=new Rx.BehaviorSubject(result_1.default.empty);this.queryString.distinctUntilChanged().debounce(100).subscribe(function(s){return _this.parseQuery(s)});this.currentLanguage.subscribe(function(l){return _this.queryString.onNext(l.example?l.example.value:"")})}State.prototype.loadStructure=function(){return __awaiter(this,void 0,void 0,function(){var plugin,url,data,t,model,e_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,3,,4]);this.loadState.onNext("downloading");this.plugin.clear();this.plugin.clear();this.queryResult.onNext(result_1.default.empty);plugin=this.plugin;url="https://webchem.ncbr.muni.cz/CoordinateServer/"+this.pdbId+"/full";return[4,litemol_1.default.Bootstrap.Utils.ajaxGetString(url).run(plugin.context)];case 1:data=_a.sent();t=plugin.createTransform();t.add(plugin.context.tree.root,Transformer.Data.FromData,{data:data}).then(Transformer.Data.ParseCif,{}).then(Transformer.Molecule.CreateFromMmCif,{blockIndex:0},{}).then(Transformer.Molecule.CreateModel,{modelIndex:0},{ref:"model"}).then(Transformer.Molecule.CreateMacromoleculeVisual,{het:true,polymer:true,water:true,groupRef:"cartoons"});return[4,plugin.applyTransform(t)];case 2:_a.sent();model=parser_1.default(data).models[0];this.structureData={data:data,model:model};this.loadState.onNext("loaded");return[3,4];case 3:e_1=_a.sent();console.error(e_1);this.loadState.onNext("none");return[3,4];case 4:return[2]}})})};State.prototype.execute=function(){try{var query=this.query.getValue();if(query.kind!=="ok")return;this.plugin.command(litemol_1.default.Bootstrap.Command.Tree.RemoveNode,"selection");this.plugin.command(litemol_1.default.Bootstrap.Command.Tree.RemoveNode,"cartoons");this.queryResult.onNext(result_1.default.empty);var model=this.structureData.model;var ctx=context_1.default.ofModel(model);var selection=query.compiled(ctx);var lang=this.currentLanguage.getValue().language;var result=result_1.default(model,selection,lang.mergeSelection);this.queryResult.onNext(result);var queryP=this.plugin;var tQ=queryP.createTransform();if(!this.plugin.selectEntities("background").length){var backgroundStyle={type:"BallsAndSticks",taskType:"Silent",params:{useVDW:false,atomRadius:.1,bondRadius:.05,detail:"Automatic"},theme:{template:litemol_1.default.Bootstrap.Visualization.Molecule.Default.UniformThemeTemplate,colors:litemol_1.default.Bootstrap.Visualization.Molecule.Default.UniformThemeTemplate.colors.set("Uniform",{r:.2,g:.2,b:.2}),transparency:{alpha:.1}},isNotSelectable:true};tQ.add("model",Transformer.Molecule.CreateVisual,{style:backgroundStyle},{ref:"background"})}tQ.add("model",Transformer.Molecule.CreateSelectionFromQuery,{query:litemol_1.default.Core.Structure.Query.atomsFromIndices(result.allIndices)},{ref:"selection"}).then(Transformer.Molecule.CreateVisual,{style:litemol_1.default.Bootstrap.Visualization.Molecule.Default.ForType.get("BallsAndSticks")},{});queryP.applyTransform(tQ)}catch(e){console.error(e);this.queryResult.onNext(result_1.default.error(e.message))}};State.prototype.parseQuery=function(text){if(!text){this.query.onNext({kind:"error",message:"Enter query"});return}try{var transpiler=this.currentLanguage.getValue().language.transpiler;var expression=transpiler(text);var compiled=compiler_1.default(expression,"query");this.query.onNext({kind:"ok",sourceLanguage:"json",text:text,expression:expression,compiled:compiled})}catch(e){this.query.onNext({kind:"error",message:""+e})}};return State}();exports.default=State},function(module,exports,__webpack_require__){(function(process,global,module){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var __LiteMol_Plugin=function(){"use strict";var __createPromise=function(__promise){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function lib$es6$promise$utils$$isFunction(x){return typeof x==="function"}function lib$es6$promise$utils$$isMaybeThenable(x){return typeof x==="object"&&x!==null}var lib$es6$promise$utils$$_isArray;if(!Array.isArray){lib$es6$promise$utils$$_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{lib$es6$promise$utils$$_isArray=Array.isArray}var lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray;var lib$es6$promise$asap$$len=0;var lib$es6$promise$asap$$vertxNext;var lib$es6$promise$asap$$customSchedulerFn;var lib$es6$promise$asap$$asap=function asap(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback;lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg;lib$es6$promise$asap$$len+=2;if(lib$es6$promise$asap$$len===2){if(lib$es6$promise$asap$$customSchedulerFn){lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush)}else{lib$es6$promise$asap$$scheduleFlush()}}};function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}var lib$es6$promise$asap$$browserWindow=typeof window!=="undefined"?window:undefined;var lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{};var lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;var lib$es6$promise$asap$$isNode=typeof self==="undefined"&&typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var lib$es6$promise$asap$$isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function lib$es6$promise$asap$$useNextTick(){return function(){process.nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0;var observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=lib$es6$promise$asap$$flush;return function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}var lib$es6$promise$asap$$queue=new Array(1e3);function lib$es6$promise$asap$$flush(){for(var i=0;i<lib$es6$promise$asap$$len;i+=2){var callback=lib$es6$promise$asap$$queue[i];var arg=lib$es6$promise$asap$$queue[i+1];callback(arg);lib$es6$promise$asap$$queue[i]=undefined;lib$es6$promise$asap$$queue[i+1]=undefined}lib$es6$promise$asap$$len=0}var lib$es6$promise$asap$$scheduleFlush;if(lib$es6$promise$asap$$isNode){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useNextTick()}else if(lib$es6$promise$asap$$BrowserMutationObserver){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMutationObserver()}else if(lib$es6$promise$asap$$isWorker){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMessageChannel()}else{lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useSetTimeout()}function lib$es6$promise$then$$then(onFulfillment,onRejection){var parent=this;var child=new this.constructor(lib$es6$promise$$internal$$noop);if(child[lib$es6$promise$$internal$$PROMISE_ID]===undefined){lib$es6$promise$$internal$$makePromise(child)}var state=parent._state;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,parent._result)})}else{lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection)}return child}var lib$es6$promise$then$$default=lib$es6$promise$then$$then;function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$resolve(promise,object);return promise}var lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve;var lib$es6$promise$$internal$$PROMISE_ID=Math.random().toString(36).substring(16);function lib$es6$promise$$internal$$noop(){}var lib$es6$promise$$internal$$PENDING=void 0;var lib$es6$promise$$internal$$FULFILLED=1;var lib$es6$promise$$internal$$REJECTED=2;var lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){lib$es6$promise$$internal$$GET_THEN_ERROR.error=error;return lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=false;var error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){lib$es6$promise$$internal$$resolve(promise,value)}else{lib$es6$promise$$internal$$fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;lib$es6$promise$$internal$$reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;lib$es6$promise$$internal$$reject(promise,error)}},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){if(thenable._state===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,thenable._result)}else if(thenable._state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,thenable._result)}else{lib$es6$promise$$internal$$subscribe(thenable,undefined,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable,then){if(maybeThenable.constructor===promise.constructor&&then===lib$es6$promise$then$$default&&constructor.resolve===lib$es6$promise$promise$resolve$$default){lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable)}else{if(then===lib$es6$promise$$internal$$GET_THEN_ERROR){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error)}else if(then===undefined){lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}else if(lib$es6$promise$utils$$isFunction(then)){lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then)}else{lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}}function lib$es6$promise$$internal$$resolve(promise,value){if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFulfillment())}else if(lib$es6$promise$utils$$objectOrFunction(value)){lib$es6$promise$$internal$$handleMaybeThenable(promise,value,lib$es6$promise$$internal$$getThen(value))}else{lib$es6$promise$$internal$$fulfill(promise,value)}}function lib$es6$promise$$internal$$publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._result=value;promise._state=lib$es6$promise$$internal$$FULFILLED;if(promise._subscribers.length!==0){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise)}}function lib$es6$promise$$internal$$reject(promise,reason){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._state=lib$es6$promise$$internal$$REJECTED;promise._result=reason;lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise)}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onerror=null;subscribers[length]=child;subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment;subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection;if(length===0&&parent._state){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child,callback,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}var lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e;return lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var hasCallback=lib$es6$promise$utils$$isFunction(callback),value,error,succeeded,failed;if(hasCallback){value=lib$es6$promise$$internal$$tryCatch(callback,detail);if(value===lib$es6$promise$$internal$$TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==lib$es6$promise$$internal$$PENDING){}else if(hasCallback&&succeeded){lib$es6$promise$$internal$$resolve(promise,value)}else if(failed){lib$es6$promise$$internal$$reject(promise,error)}else if(settled===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,value)}else if(settled===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function resolvePromise(value){lib$es6$promise$$internal$$resolve(promise,value)},function rejectPromise(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}var lib$es6$promise$$internal$$id=0;function lib$es6$promise$$internal$$nextId(){return lib$es6$promise$$internal$$id++}function lib$es6$promise$$internal$$makePromise(promise){promise[lib$es6$promise$$internal$$PROMISE_ID]=lib$es6$promise$$internal$$id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[]}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all;function lib$es6$promise$promise$race$$race(entries){var Constructor=this;if(!lib$es6$promise$utils$$isArray(entries)){return new Constructor(function(resolve,reject){reject(new TypeError("You must pass an array to race."))})}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject)}})}}var lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race;function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this;var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$reject(promise,reason);return promise}var lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject;function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;function lib$es6$promise$promise$$Promise(resolver){this[lib$es6$promise$$internal$$PROMISE_ID]=lib$es6$promise$$internal$$nextId();this._result=this._state=undefined;this._subscribers=[];if(lib$es6$promise$$internal$$noop!==resolver){typeof resolver!=="function"&&lib$es6$promise$promise$$needsResolver();this instanceof lib$es6$promise$promise$$Promise?lib$es6$promise$$internal$$initializePromise(this,resolver):lib$es6$promise$promise$$needsNew()}}lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default;lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default;lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default;lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default;lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler;lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap;lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap;lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:lib$es6$promise$then$$default,catch:function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;function lib$es6$promise$enumerator$$Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(lib$es6$promise$$internal$$noop);if(!this.promise[lib$es6$promise$$internal$$PROMISE_ID]){lib$es6$promise$$internal$$makePromise(this.promise)}if(Array.isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){lib$es6$promise$$internal$$fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){lib$es6$promise$$internal$$fulfill(this.promise,this._result)}}}else{lib$es6$promise$$internal$$reject(this.promise,lib$es6$promise$enumerator$$validationError())}}function lib$es6$promise$enumerator$$validationError(){return new Error("Array Methods must be provided an Array")}lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){var length=this.length;var input=this._input;for(var i=0;this._state===lib$es6$promise$$internal$$PENDING&&i<length;i++){this._eachEntry(input[i],i)}};lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve=c.resolve;if(resolve===lib$es6$promise$promise$resolve$$default){var then=lib$es6$promise$$internal$$getThen(entry);if(then===lib$es6$promise$then$$default&&entry._state!==lib$es6$promise$$internal$$PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof then!=="function"){this._remaining--;this._result[i]=entry}else if(c===lib$es6$promise$promise$$default){var promise=new c(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$handleMaybeThenable(promise,entry,then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve){resolve(entry)}),i)}}else{this._willSettleAt(resolve(entry),i)}};lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===lib$es6$promise$$internal$$PENDING){this._remaining--;if(state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){lib$es6$promise$$internal$$fulfill(promise,this._result)}};lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,undefined,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};function lib$es6$promise$polyfill$$polyfill(){var local;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P&&Object.prototype.toString.call(P.resolve())==="[object Promise]"&&!P.cast){return}local.Promise=lib$es6$promise$promise$$default}var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill;var lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};lib$es6$promise$polyfill$$default();__promise.ES6Promise=lib$es6$promise$umd$$ES6Promise};var __LiteMolPromise;if(typeof window!=="undefined"&&window&&window.Promise){__LiteMolPromise=window.Promise}else if(typeof global!=="undefined"&&global&&global.Promise){__LiteMolPromise=global.Promise}else{var __promise={};__createPromise(__promise);__LiteMolPromise=__promise.ES6Promise.Promise}var __LiteMolRxTemp={};(function(__LMtarget,__LMpromise,undefined){var objectTypes={function:true,object:true};function checkGlobal(value){return value&&value.Object===Object?value:null}var freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:null;var freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:null;var freeGlobal=checkGlobal(freeExports&&freeModule&&typeof global==="object"&&global);var freeSelf=checkGlobal(objectTypes[typeof self]&&self);var freeWindow=checkGlobal(objectTypes[typeof window]&&window);var moduleExports=freeModule&&freeModule.exports===freeExports?freeExports:null;var thisGlobal=checkGlobal(objectTypes[typeof this]&&this);var root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")();var Rx={internals:{},config:{Promise:__LMpromise},helpers:{}};var noop=Rx.helpers.noop=function(){},identity=Rx.helpers.identity=function(x){return x},defaultNow=Rx.helpers.defaultNow=Date.now,defaultComparer=Rx.helpers.defaultComparer=function(x,y){return isEqual(x,y)},defaultSubComparer=Rx.helpers.defaultSubComparer=function(x,y){return x>y?1:x<y?-1:0},defaultKeySerializer=Rx.helpers.defaultKeySerializer=function(x){return x.toString()},defaultError=Rx.helpers.defaultError=function(err){throw err},isPromise=Rx.helpers.isPromise=function(p){return!!p&&typeof p.subscribe!=="function"&&typeof p.then==="function"},isFunction=Rx.helpers.isFunction=function(){var isFn=function(value){return typeof value=="function"||false};if(isFn(/x/)){isFn=function(value){return typeof value=="function"&&toString.call(value)=="[object Function]"}}return isFn}();function cloneArray(arr){var len=arr.length,a=new Array(len);for(var i=0;i<len;i++){a[i]=arr[i]}return a}var errorObj={e:{}};function tryCatcherGen(tryCatchTarget){return function tryCatcher(){try{return tryCatchTarget.apply(this,arguments)}catch(e){errorObj.e=e;return errorObj}}}var tryCatch=Rx.internals.tryCatch=function tryCatch(fn){if(!isFunction(fn)){throw new TypeError("fn must be a function")}return tryCatcherGen(fn)};function thrower(e){throw e}Rx.config.longStackSupport=false;var hasStacks=false,stacks=tryCatch(function(){throw new Error})();hasStacks=!!stacks.e&&!!stacks.e.stack;var rStartingLine=captureLine(),rFileName;var STACK_JUMP_SEPARATOR="From previous event:";function makeStackTraceLong(error,observable){if(hasStacks&&observable.stack&&typeof error==="object"&&error!==null&&error.stack&&error.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){var stacks=[];for(var o=observable;!!o;o=o.source){if(o.stack){stacks.unshift(o.stack)}}stacks.unshift(error.stack);var concatedStacks=stacks.join("\n"+STACK_JUMP_SEPARATOR+"\n");error.stack=filterStackString(concatedStacks)}}function filterStackString(stackString){var lines=stackString.split("\n"),desiredLines=[];for(var i=0,len=lines.length;i<len;i++){var line=lines[i];if(!isInternalFrame(line)&&!isNodeFrame(line)&&line){desiredLines.push(line)}}return desiredLines.join("\n")}function isInternalFrame(stackLine){var fileNameAndLineNumber=getFileNameAndLineNumber(stackLine);if(!fileNameAndLineNumber){return false}var fileName=fileNameAndLineNumber[0],lineNumber=fileNameAndLineNumber[1];return fileName===rFileName&&lineNumber>=rStartingLine&&lineNumber<=rEndingLine}function isNodeFrame(stackLine){return stackLine.indexOf("(module.js:")!==-1||stackLine.indexOf("(node.js:")!==-1}function captureLine(){if(!hasStacks){return}try{throw new Error}catch(e){var lines=e.stack.split("\n");var firstLine=lines[0].indexOf("@")>0?lines[1]:lines[2];var fileNameAndLineNumber=getFileNameAndLineNumber(firstLine);if(!fileNameAndLineNumber){return}rFileName=fileNameAndLineNumber[0];return fileNameAndLineNumber[1]}}function getFileNameAndLineNumber(stackLine){var attempt1=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(stackLine);if(attempt1){return[attempt1[1],Number(attempt1[2])]}var attempt2=/at ([^ ]+):(\d+):(?:\d+)$/.exec(stackLine);if(attempt2){return[attempt2[1],Number(attempt2[2])]}var attempt3=/.*@(.+):(\d+)$/.exec(stackLine);if(attempt3){return[attempt3[1],Number(attempt3[2])]}}var EmptyError=Rx.EmptyError=function(){this.message="Sequence contains no elements.";Error.call(this)};EmptyError.prototype=Object.create(Error.prototype);EmptyError.prototype.name="EmptyError";var ObjectDisposedError=Rx.ObjectDisposedError=function(){this.message="Object has been disposed";Error.call(this)};ObjectDisposedError.prototype=Object.create(Error.prototype);ObjectDisposedError.prototype.name="ObjectDisposedError";var ArgumentOutOfRangeError=Rx.ArgumentOutOfRangeError=function(){this.message="Argument out of range";Error.call(this)};ArgumentOutOfRangeError.prototype=Object.create(Error.prototype);ArgumentOutOfRangeError.prototype.name="ArgumentOutOfRangeError";var NotSupportedError=Rx.NotSupportedError=function(message){this.message=message||"This operation is not supported";Error.call(this)};NotSupportedError.prototype=Object.create(Error.prototype);NotSupportedError.prototype.name="NotSupportedError";var NotImplementedError=Rx.NotImplementedError=function(message){this.message=message||"This operation is not implemented";Error.call(this)};NotImplementedError.prototype=Object.create(Error.prototype);NotImplementedError.prototype.name="NotImplementedError";var notImplemented=Rx.helpers.notImplemented=function(){throw new NotImplementedError};var notSupported=Rx.helpers.notSupported=function(){throw new NotSupportedError};var $iterator$=typeof Symbol==="function"&&Symbol.iterator||"_es6shim_iterator_";if(root.Set&&typeof(new root.Set)["@@iterator"]==="function"){$iterator$="@@iterator"}var doneEnumerator=Rx.doneEnumerator={done:true,value:undefined};var isIterable=Rx.helpers.isIterable=function(o){return o&&o[$iterator$]!==undefined};var isArrayLike=Rx.helpers.isArrayLike=function(o){return o&&o.length!==undefined};Rx.helpers.iterator=$iterator$;var bindCallback=Rx.internals.bindCallback=function(func,thisArg,argCount){if(typeof thisArg==="undefined"){return func}switch(argCount){case 0:return function(){return func.call(thisArg)};case 1:return function(arg){return func.call(thisArg,arg)};case 2:return function(value,index){return func.call(thisArg,value,index)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)}}return function(){return func.apply(thisArg,arguments)}};var dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;var argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;var objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objToString=objectProto.toString,MAX_SAFE_INTEGER=Math.pow(2,53)-1;var keys=Object.keys||function(){var hasOwnProperty=Object.prototype.hasOwnProperty,hasDontEnumBug=!{toString:null}.propertyIsEnumerable("toString"),dontEnums=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],dontEnumsLength=dontEnums.length;return function(obj){if(typeof obj!=="object"&&(typeof obj!=="function"||obj===null)){throw new TypeError("Object.keys called on non-object")}var result=[],prop,i;for(prop in obj){if(hasOwnProperty.call(obj,prop)){result.push(prop)}}if(hasDontEnumBug){for(i=0;i<dontEnumsLength;i++){if(hasOwnProperty.call(obj,dontEnums[i])){result.push(dontEnums[i])}}}return result}}();function equalObjects(object,other,equalFunc,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!==othLength&&!isLoose){return false}var index=objLength,key;while(index--){key=objProps[index];if(!(isLoose?key in other:hasOwnProperty.call(other,key))){return false}}var skipCtor=isLoose;while(++index<objLength){key=objProps[index];var objValue=object[key],othValue=other[key],result;if(!(result===undefined?equalFunc(objValue,othValue,isLoose,stackA,stackB):result)){return false}skipCtor||(skipCtor=key==="constructor")}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!==othCtor&&("constructor"in object&&"constructor"in other)&&!(typeof objCtor==="function"&&objCtor instanceof objCtor&&typeof othCtor==="function"&&othCtor instanceof othCtor)){return false}}return true}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object===+other;case errorTag:return object.name===other.name&&object.message===other.message;case numberTag:return object!==+object?other!==+other:object===+other;case regexpTag:case stringTag:return object===other+""}return false}var isObject=Rx.internals.isObject=function(value){var type=typeof value;return!!value&&(type==="object"||type==="function")};function isObjectLike(value){return!!value&&typeof value==="object"}function isLength(value){return typeof value==="number"&&value>-1&&value%1===0&&value<=MAX_SAFE_INTEGER}var isHostObject=function(){try{Object({toString:0}+"")}catch(e){return function(){return false}}return function(value){return typeof value.toString!=="function"&&typeof(value+"")==="string"}}();function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}var isArray=Array.isArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)===arrayTag};function arraySome(array,predicate){var index=-1,length=array.length;while(++index<length){if(predicate(array[index],index,array)){return true}}return false}function equalArrays(array,other,equalFunc,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length;if(arrLength!==othLength&&!(isLoose&&othLength>arrLength)){return false}while(++index<arrLength){var arrValue=array[index],othValue=other[index],result;if(result!==undefined){if(result){continue}return false}if(isLoose){if(!arraySome(other,function(othValue){return arrValue===othValue||equalFunc(arrValue,othValue,isLoose,stackA,stackB)})){return false}}else if(!(arrValue===othValue||equalFunc(arrValue,othValue,isLoose,stackA,stackB))){return false}}return true}function baseIsEqualDeep(object,other,equalFunc,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;if(!objIsArr){objTag=objToString.call(object);if(objTag===argsTag){objTag=objectTag}else if(objTag!==objectTag){objIsArr=isTypedArray(object)}}if(!othIsArr){othTag=objToString.call(other);if(othTag===argsTag){othTag=objectTag}}var objIsObj=objTag===objectTag&&!isHostObject(object),othIsObj=othTag===objectTag&&!isHostObject(other),isSameTag=objTag===othTag;if(isSameTag&&!(objIsArr||objIsObj)){return equalByTag(object,other,objTag)}if(!isLoose){var objIsWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othIsWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(objIsWrapped||othIsWrapped){return equalFunc(objIsWrapped?object.value():object,othIsWrapped?other.value():other,isLoose,stackA,stackB)}}if(!isSameTag){return false}stackA||(stackA=[]);stackB||(stackB=[]);var length=stackA.length;while(length--){if(stackA[length]===object){return stackB[length]===other}}stackA.push(object);stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,isLoose,stackA,stackB);stackA.pop();stackB.pop();return result}function baseIsEqual(value,other,isLoose,stackA,stackB){if(value===other){return true}if(value==null||other==null||!isObject(value)&&!isObjectLike(other)){return value!==value&&other!==other}return baseIsEqualDeep(value,other,baseIsEqual,isLoose,stackA,stackB)}var isEqual=Rx.internals.isEqual=function(value,other){return baseIsEqual(value,other)};var hasProp={}.hasOwnProperty,slice=Array.prototype.slice;var inherits=Rx.internals.inherits=function(child,parent){function __(){this.constructor=child}__.prototype=parent.prototype;child.prototype=new __};var addProperties=Rx.internals.addProperties=function(obj){for(var sources=[],i=1,len=arguments.length;i<len;i++){sources.push(arguments[i])}for(var idx=0,ln=sources.length;idx<ln;idx++){var source=sources[idx];for(var prop in source){obj[prop]=source[prop]}}};var addRef=Rx.internals.addRef=function(xs,r){return new AnonymousObservable(function(observer){return new BinaryDisposable(r.getDisposable(),xs.subscribe(observer))})};function arrayInitialize(count,factory){var a=new Array(count);for(var i=0;i<count;i++){a[i]=factory()}return a}var CompositeDisposable=Rx.CompositeDisposable=function(){var args=[],i,len;if(Array.isArray(arguments[0])){args=arguments[0]}else{len=arguments.length;args=new Array(len);for(i=0;i<len;i++){args[i]=arguments[i]}}this.disposables=args;this.isDisposed=false;this.length=args.length};var CompositeDisposablePrototype=CompositeDisposable.prototype;CompositeDisposablePrototype.add=function(item){if(this.isDisposed){item.dispose()}else{this.disposables.push(item);this.length++}};CompositeDisposablePrototype.remove=function(item){var shouldDispose=false;if(!this.isDisposed){var idx=this.disposables.indexOf(item);if(idx!==-1){shouldDispose=true;this.disposables.splice(idx,1);this.length--;item.dispose()}}return shouldDispose};CompositeDisposablePrototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var len=this.disposables.length,currentDisposables=new Array(len);for(var i=0;i<len;i++){currentDisposables[i]=this.disposables[i]}this.disposables=[];this.length=0;for(i=0;i<len;i++){currentDisposables[i].dispose()}}};var Disposable=Rx.Disposable=function(action){this.isDisposed=false;this.action=action||noop};Disposable.prototype.dispose=function(){if(!this.isDisposed){this.action();this.isDisposed=true}};var disposableCreate=Disposable.create=function(action){return new Disposable(action)};var disposableEmpty=Disposable.empty={dispose:noop};var isDisposable=Disposable.isDisposable=function(d){return d&&isFunction(d.dispose)};var checkDisposed=Disposable.checkDisposed=function(disposable){if(disposable.isDisposed){throw new ObjectDisposedError}};var disposableFixup=Disposable._fixup=function(result){return isDisposable(result)?result:disposableEmpty};var SingleAssignmentDisposable=Rx.SingleAssignmentDisposable=function(){this.isDisposed=false;this.current=null};SingleAssignmentDisposable.prototype.getDisposable=function(){return this.current};SingleAssignmentDisposable.prototype.setDisposable=function(value){if(this.current){throw new Error("Disposable has already been assigned")}var shouldDispose=this.isDisposed;!shouldDispose&&(this.current=value);shouldDispose&&value&&value.dispose()};SingleAssignmentDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=null;old&&old.dispose()}};var SerialDisposable=Rx.SerialDisposable=function(){this.isDisposed=false;this.current=null};SerialDisposable.prototype.getDisposable=function(){return this.current};SerialDisposable.prototype.setDisposable=function(value){var shouldDispose=this.isDisposed;if(!shouldDispose){var old=this.current;this.current=value}old&&old.dispose();shouldDispose&&value&&value.dispose()};SerialDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old=this.current;this.current=null}old&&old.dispose()};var BinaryDisposable=Rx.BinaryDisposable=function(first,second){this._first=first;this._second=second;this.isDisposed=false};BinaryDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;var old1=this._first;this._first=null;old1&&old1.dispose();var old2=this._second;this._second=null;old2&&old2.dispose()}};var NAryDisposable=Rx.NAryDisposable=function(disposables){this._disposables=disposables;this.isDisposed=false};NAryDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;for(var i=0,len=this._disposables.length;i<len;i++){this._disposables[i].dispose()}this._disposables.length=0}};var RefCountDisposable=Rx.RefCountDisposable=function(){function InnerDisposable(disposable){this.disposable=disposable;this.disposable.count++;this.isInnerDisposed=false}InnerDisposable.prototype.dispose=function(){if(!this.disposable.isDisposed&&!this.isInnerDisposed){this.isInnerDisposed=true;this.disposable.count--;if(this.disposable.count===0&&this.disposable.isPrimaryDisposed){this.disposable.isDisposed=true;this.disposable.underlyingDisposable.dispose()}}};function RefCountDisposable(disposable){this.underlyingDisposable=disposable;this.isDisposed=false;this.isPrimaryDisposed=false;this.count=0}RefCountDisposable.prototype.dispose=function(){if(!this.isDisposed&&!this.isPrimaryDisposed){this.isPrimaryDisposed=true;if(this.count===0){this.isDisposed=true;this.underlyingDisposable.dispose()}}};RefCountDisposable.prototype.getDisposable=function(){return this.isDisposed?disposableEmpty:new InnerDisposable(this)};return RefCountDisposable}();var ScheduledItem=Rx.internals.ScheduledItem=function(scheduler,state,action,dueTime,comparer){this.scheduler=scheduler;this.state=state;this.action=action;this.dueTime=dueTime;this.comparer=comparer||defaultSubComparer;this.disposable=new SingleAssignmentDisposable};ScheduledItem.prototype.invoke=function(){this.disposable.setDisposable(this.invokeCore())};ScheduledItem.prototype.compareTo=function(other){return this.comparer(this.dueTime,other.dueTime)};ScheduledItem.prototype.isCancelled=function(){return this.disposable.isDisposed};ScheduledItem.prototype.invokeCore=function(){return disposableFixup(this.action(this.scheduler,this.state))};var Scheduler=Rx.Scheduler=function(){function Scheduler(){}Scheduler.isScheduler=function(s){return s instanceof Scheduler};var schedulerProto=Scheduler.prototype;schedulerProto.schedule=function(state,action){throw new NotImplementedError};schedulerProto.scheduleFuture=function(state,dueTime,action){var dt=dueTime;dt instanceof Date&&(dt=dt-this.now());dt=Scheduler.normalize(dt);if(dt===0){return this.schedule(state,action)}return this._scheduleFuture(state,dt,action)};schedulerProto._scheduleFuture=function(state,dueTime,action){throw new NotImplementedError};Scheduler.now=defaultNow;Scheduler.prototype.now=defaultNow;Scheduler.normalize=function(timeSpan){timeSpan<0&&(timeSpan=0);return timeSpan};return Scheduler}();var normalizeTime=Scheduler.normalize,isScheduler=Scheduler.isScheduler;(function(schedulerProto){function invokeRecImmediate(scheduler,pair){var state=pair[0],action=pair[1],group=new CompositeDisposable;action(state,innerAction);return group;function innerAction(state2){var isAdded=false,isDone=false;var d=scheduler.schedule(state2,scheduleWork);if(!isDone){group.add(d);isAdded=true}function scheduleWork(_,state3){if(isAdded){group.remove(d)}else{isDone=true}action(state3,innerAction);return disposableEmpty}}}function invokeRecDate(scheduler,pair){var state=pair[0],action=pair[1],group=new CompositeDisposable;action(state,innerAction);return group;function innerAction(state2,dueTime1){var isAdded=false,isDone=false;var d=scheduler.scheduleFuture(state2,dueTime1,scheduleWork);if(!isDone){group.add(d);isAdded=true}function scheduleWork(_,state3){if(isAdded){group.remove(d)}else{isDone=true}action(state3,innerAction);return disposableEmpty}}}schedulerProto.scheduleRecursive=function(state,action){return this.schedule([state,action],invokeRecImmediate)};schedulerProto.scheduleRecursiveFuture=function(state,dueTime,action){return this.scheduleFuture([state,action],dueTime,invokeRecDate)}})(Scheduler.prototype);(function(schedulerProto){schedulerProto.schedulePeriodic=function(state,period,action){if(typeof root.setInterval==="undefined"){throw new NotSupportedError}period=normalizeTime(period);var s=state,id=root.setInterval(function(){s=action(s)},period);return disposableCreate(function(){root.clearInterval(id)})}})(Scheduler.prototype);var ImmediateScheduler=function(__super__){inherits(ImmediateScheduler,__super__);function ImmediateScheduler(){__super__.call(this)}ImmediateScheduler.prototype.schedule=function(state,action){return disposableFixup(action(this,state))};return ImmediateScheduler}(Scheduler);var immediateScheduler=Scheduler.immediate=new ImmediateScheduler;var CurrentThreadScheduler=function(__super__){var queue;function runTrampoline(){while(queue.length>0){var item=queue.dequeue();!item.isCancelled()&&item.invoke()}}inherits(CurrentThreadScheduler,__super__);function CurrentThreadScheduler(){__super__.call(this)}CurrentThreadScheduler.prototype.schedule=function(state,action){var si=new ScheduledItem(this,state,action,this.now());if(!queue){queue=new PriorityQueue(4);queue.enqueue(si);var result=tryCatch(runTrampoline)();queue=null;if(result===errorObj){thrower(result.e)}}else{queue.enqueue(si)}return si.disposable};CurrentThreadScheduler.prototype.scheduleRequired=function(){return!queue};return CurrentThreadScheduler}(Scheduler);var currentThreadScheduler=Scheduler.currentThread=new CurrentThreadScheduler;var SchedulePeriodicRecursive=Rx.internals.SchedulePeriodicRecursive=function(){function createTick(self){return function tick(command,recurse){recurse(0,self._period);var state=tryCatch(self._action)(self._state);if(state===errorObj){self._cancel.dispose();thrower(state.e)}self._state=state}}function SchedulePeriodicRecursive(scheduler,state,period,action){this._scheduler=scheduler;this._state=state;this._period=period;this._action=action}SchedulePeriodicRecursive.prototype.start=function(){var d=new SingleAssignmentDisposable;this._cancel=d;d.setDisposable(this._scheduler.scheduleRecursiveFuture(0,this._period,createTick(this)));return d};return SchedulePeriodicRecursive}();var scheduleMethod,clearMethod;var localTimer=function(){var localSetTimeout,localClearTimeout=noop;if(!!root.setTimeout){localSetTimeout=root.setTimeout;localClearTimeout=root.clearTimeout}else if(!!root.WScript){localSetTimeout=function(fn,time){root.WScript.Sleep(time);fn()}}else{throw new NotSupportedError}return{setTimeout:localSetTimeout,clearTimeout:localClearTimeout}}();var localSetTimeout=localTimer.setTimeout,localClearTimeout=localTimer.clearTimeout;(function(){var nextHandle=1,tasksByHandle={},currentlyRunning=false;clearMethod=function(handle){delete tasksByHandle[handle]};function runTask(handle){if(currentlyRunning){localSetTimeout(function(){runTask(handle)},0)}else{var task=tasksByHandle[handle];if(task){currentlyRunning=true;var result=tryCatch(task)();clearMethod(handle);currentlyRunning=false;if(result===errorObj){thrower(result.e)}}}}var reNative=new RegExp("^"+String(toString).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");var setImmediate=typeof(setImmediate=freeGlobal&&moduleExports&&freeGlobal.setImmediate)=="function"&&!reNative.test(setImmediate)&&setImmediate;function postMessageSupported(){if(!root.postMessage||root.importScripts){return false}var isAsync=false,oldHandler=root.onmessage;root.onmessage=function(){isAsync=true};root.postMessage("","*");root.onmessage=oldHandler;return isAsync}if(isFunction(setImmediate)){scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;setImmediate(function(){runTask(id)});return id}}else if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;process.nextTick(function(){runTask(id)});return id}}else if(postMessageSupported()){var MSG_PREFIX="ms.rx.schedule"+Math.random();var onGlobalPostMessage=function(event){if(typeof event.data==="string"&&event.data.substring(0,MSG_PREFIX.length)===MSG_PREFIX){runTask(event.data.substring(MSG_PREFIX.length))}};root.addEventListener("message",onGlobalPostMessage,false);scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;root.postMessage(MSG_PREFIX+id,"*");return id}}else if(!!root.MessageChannel){var channel=new root.MessageChannel;channel.port1.onmessage=function(e){runTask(e.data)};scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;channel.port2.postMessage(id);return id}}else if("document"in root&&"onreadystatechange"in root.document.createElement("script")){scheduleMethod=function(action){var scriptElement=root.document.createElement("script");var id=nextHandle++;tasksByHandle[id]=action;scriptElement.onreadystatechange=function(){runTask(id);scriptElement.onreadystatechange=null;scriptElement.parentNode.removeChild(scriptElement);scriptElement=null};root.document.documentElement.appendChild(scriptElement);return id}}else{scheduleMethod=function(action){var id=nextHandle++;tasksByHandle[id]=action;localSetTimeout(function(){runTask(id)},0);return id}}})();var DefaultScheduler=function(__super__){inherits(DefaultScheduler,__super__);function DefaultScheduler(){__super__.call(this)}function scheduleAction(disposable,action,scheduler,state){return function schedule(){disposable.setDisposable(Disposable._fixup(action(scheduler,state)))}}function ClearDisposable(id){this._id=id;this.isDisposed=false}ClearDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;clearMethod(this._id)}};function LocalClearDisposable(id){this._id=id;this.isDisposed=false}LocalClearDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;localClearTimeout(this._id)}};DefaultScheduler.prototype.schedule=function(state,action){var disposable=new SingleAssignmentDisposable,id=scheduleMethod(scheduleAction(disposable,action,this,state));return new BinaryDisposable(disposable,new ClearDisposable(id))};DefaultScheduler.prototype._scheduleFuture=function(state,dueTime,action){if(dueTime===0){return this.schedule(state,action)}var disposable=new SingleAssignmentDisposable,id=localSetTimeout(scheduleAction(disposable,action,this,state),dueTime);return new BinaryDisposable(disposable,new LocalClearDisposable(id))};function scheduleLongRunning(state,action,disposable){return function(){action(state,disposable)}}DefaultScheduler.prototype.scheduleLongRunning=function(state,action){var disposable=disposableCreate(noop);scheduleMethod(scheduleLongRunning(state,action,disposable));return disposable};return DefaultScheduler}(Scheduler);var defaultScheduler=Scheduler["default"]=Scheduler.async=new DefaultScheduler;function IndexedItem(id,value){this.id=id;this.value=value}IndexedItem.prototype.compareTo=function(other){var c=this.value.compareTo(other.value);c===0&&(c=this.id-other.id);return c};var PriorityQueue=Rx.internals.PriorityQueue=function(capacity){this.items=new Array(capacity);this.length=0};var priorityProto=PriorityQueue.prototype;priorityProto.isHigherPriority=function(left,right){return this.items[left].compareTo(this.items[right])<0};priorityProto.percolate=function(index){if(index>=this.length||index<0){return}var parent=index-1>>1;if(parent<0||parent===index){return}if(this.isHigherPriority(index,parent)){var temp=this.items[index];this.items[index]=this.items[parent];this.items[parent]=temp;this.percolate(parent)}};priorityProto.heapify=function(index){+index||(index=0);if(index>=this.length||index<0){return}var left=2*index+1,right=2*index+2,first=index;if(left<this.length&&this.isHigherPriority(left,first)){first=left}if(right<this.length&&this.isHigherPriority(right,first)){first=right}if(first!==index){var temp=this.items[index];this.items[index]=this.items[first];this.items[first]=temp;this.heapify(first)}};priorityProto.peek=function(){return this.items[0].value};priorityProto.removeAt=function(index){this.items[index]=this.items[--this.length];this.items[this.length]=undefined;this.heapify()};priorityProto.dequeue=function(){var result=this.peek();this.removeAt(0);return result};priorityProto.enqueue=function(item){var index=this.length++;this.items[index]=new IndexedItem(PriorityQueue.count++,item);this.percolate(index)};priorityProto.remove=function(item){for(var i=0;i<this.length;i++){if(this.items[i].value===item){this.removeAt(i);return true}}return false};PriorityQueue.count=0;var Notification=Rx.Notification=function(){function Notification(){}Notification.prototype._accept=function(onNext,onError,onCompleted){throw new NotImplementedError};Notification.prototype._acceptObserver=function(onNext,onError,onCompleted){throw new NotImplementedError};Notification.prototype.accept=function(observerOrOnNext,onError,onCompleted){return observerOrOnNext&&typeof observerOrOnNext==="object"?this._acceptObserver(observerOrOnNext):this._accept(observerOrOnNext,onError,onCompleted)};Notification.prototype.toObservable=function(scheduler){var self=this;isScheduler(scheduler)||(scheduler=immediateScheduler);return new AnonymousObservable(function(o){return scheduler.schedule(self,function(_,notification){notification._acceptObserver(o);notification.kind==="N"&&o.onCompleted()})})};return Notification}();var OnNextNotification=function(__super__){inherits(OnNextNotification,__super__);function OnNextNotification(value){this.value=value;this.kind="N"}OnNextNotification.prototype._accept=function(onNext){return onNext(this.value)};OnNextNotification.prototype._acceptObserver=function(o){return o.onNext(this.value)};OnNextNotification.prototype.toString=function(){return"OnNext("+this.value+")"};return OnNextNotification}(Notification);var OnErrorNotification=function(__super__){inherits(OnErrorNotification,__super__);function OnErrorNotification(error){this.error=error;this.kind="E"}OnErrorNotification.prototype._accept=function(onNext,onError){return onError(this.error)};OnErrorNotification.prototype._acceptObserver=function(o){return o.onError(this.error)};OnErrorNotification.prototype.toString=function(){return"OnError("+this.error+")"};return OnErrorNotification}(Notification);var OnCompletedNotification=function(__super__){inherits(OnCompletedNotification,__super__);function OnCompletedNotification(){this.kind="C"}OnCompletedNotification.prototype._accept=function(onNext,onError,onCompleted){return onCompleted()};OnCompletedNotification.prototype._acceptObserver=function(o){return o.onCompleted()};OnCompletedNotification.prototype.toString=function(){return"OnCompleted()"};return OnCompletedNotification}(Notification);var notificationCreateOnNext=Notification.createOnNext=function(value){return new OnNextNotification(value)};var notificationCreateOnError=Notification.createOnError=function(error){return new OnErrorNotification(error)};var notificationCreateOnCompleted=Notification.createOnCompleted=function(){return new OnCompletedNotification};var Observer=Rx.Observer=function(){};var observerCreate=Observer.create=function(onNext,onError,onCompleted){onNext||(onNext=noop);onError||(onError=defaultError);onCompleted||(onCompleted=noop);return new AnonymousObserver(onNext,onError,onCompleted)};var AbstractObserver=Rx.internals.AbstractObserver=function(__super__){inherits(AbstractObserver,__super__);function AbstractObserver(){this.isStopped=false}AbstractObserver.prototype.next=notImplemented;AbstractObserver.prototype.error=notImplemented;AbstractObserver.prototype.completed=notImplemented;AbstractObserver.prototype.onNext=function(value){!this.isStopped&&this.next(value)};AbstractObserver.prototype.onError=function(error){if(!this.isStopped){this.isStopped=true;this.error(error)}};AbstractObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.completed()}};AbstractObserver.prototype.dispose=function(){this.isStopped=true};AbstractObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.error(e);return true}return false};return AbstractObserver}(Observer);var AnonymousObserver=Rx.AnonymousObserver=function(__super__){inherits(AnonymousObserver,__super__);function AnonymousObserver(onNext,onError,onCompleted){__super__.call(this);this._onNext=onNext;this._onError=onError;this._onCompleted=onCompleted}AnonymousObserver.prototype.next=function(value){this._onNext(value)};AnonymousObserver.prototype.error=function(error){this._onError(error)};AnonymousObserver.prototype.completed=function(){this._onCompleted()};return AnonymousObserver}(AbstractObserver);var observableProto;var Observable=Rx.Observable=function(){function makeSubscribe(self,subscribe){return function(o){var oldOnError=o.onError;o.onError=function(e){makeStackTraceLong(e,self);oldOnError.call(o,e)};return subscribe.call(self,o)}}function Observable(){if(Rx.config.longStackSupport&&hasStacks){var oldSubscribe=this._subscribe;var e=tryCatch(thrower)(new Error).e;this.stack=e.stack.substring(e.stack.indexOf("\n")+1);this._subscribe=makeSubscribe(this,oldSubscribe)}}observableProto=Observable.prototype;Observable.isObservable=function(o){return o&&isFunction(o.subscribe)};observableProto.subscribe=observableProto.forEach=function(oOrOnNext,onError,onCompleted){return this._subscribe(typeof oOrOnNext==="object"?oOrOnNext:observerCreate(oOrOnNext,onError,onCompleted))};observableProto.subscribeOnNext=function(onNext,thisArg){return this._subscribe(observerCreate(typeof thisArg!=="undefined"?function(x){onNext.call(thisArg,x)}:onNext))};observableProto.subscribeOnError=function(onError,thisArg){return this._subscribe(observerCreate(null,typeof thisArg!=="undefined"?function(e){onError.call(thisArg,e)}:onError))};observableProto.subscribeOnCompleted=function(onCompleted,thisArg){return this._subscribe(observerCreate(null,null,typeof thisArg!=="undefined"?function(){onCompleted.call(thisArg)}:onCompleted))};return Observable}();var ScheduledObserver=Rx.internals.ScheduledObserver=function(__super__){inherits(ScheduledObserver,__super__);function ScheduledObserver(scheduler,observer){__super__.call(this);this.scheduler=scheduler;this.observer=observer;this.isAcquired=false;this.hasFaulted=false;this.queue=[];this.disposable=new SerialDisposable}function enqueueNext(observer,x){return function(){observer.onNext(x)}}function enqueueError(observer,e){return function(){observer.onError(e)}}function enqueueCompleted(observer){return function(){observer.onCompleted()}}ScheduledObserver.prototype.next=function(x){this.queue.push(enqueueNext(this.observer,x))};ScheduledObserver.prototype.error=function(e){this.queue.push(enqueueError(this.observer,e))};ScheduledObserver.prototype.completed=function(){this.queue.push(enqueueCompleted(this.observer))};function scheduleMethod(state,recurse){var work;if(state.queue.length>0){work=state.queue.shift()}else{state.isAcquired=false;return}var res=tryCatch(work)();if(res===errorObj){state.queue=[];state.hasFaulted=true;return thrower(res.e)}recurse(state)}ScheduledObserver.prototype.ensureActive=function(){var isOwner=false;if(!this.hasFaulted&&this.queue.length>0){isOwner=!this.isAcquired;this.isAcquired=true}isOwner&&this.disposable.setDisposable(this.scheduler.scheduleRecursive(this,scheduleMethod))};ScheduledObserver.prototype.dispose=function(){__super__.prototype.dispose.call(this);this.disposable.dispose()};return ScheduledObserver}(AbstractObserver);var ObservableBase=Rx.ObservableBase=function(__super__){inherits(ObservableBase,__super__);function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],self=state[1];var sub=tryCatch(self.subscribeCore).call(self,ado);if(sub===errorObj&&!ado.fail(errorObj.e)){thrower(errorObj.e)}ado.setDisposable(fixSubscriber(sub))}function ObservableBase(){__super__.call(this)}ObservableBase.prototype._subscribe=function(o){var ado=new AutoDetachObserver(o),state=[ado,this];if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.schedule(state,setDisposable)}else{setDisposable(null,state)}return ado};ObservableBase.prototype.subscribeCore=notImplemented;return ObservableBase}(Observable);var FlatMapObservable=Rx.FlatMapObservable=function(__super__){inherits(FlatMapObservable,__super__);function FlatMapObservable(source,selector,resultSelector,thisArg){this.resultSelector=isFunction(resultSelector)?resultSelector:null;this.selector=bindCallback(isFunction(selector)?selector:function(){return selector},thisArg,3);this.source=source;__super__.call(this)}FlatMapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.selector,this.resultSelector,this))};inherits(InnerObserver,AbstractObserver);function InnerObserver(observer,selector,resultSelector,source){this.i=0;this.selector=selector;this.resultSelector=resultSelector;this.source=source;this.o=observer;AbstractObserver.call(this)}InnerObserver.prototype._wrapResult=function(result,x,i){return this.resultSelector?result.map(function(y,i2){return this.resultSelector(x,y,i,i2)},this):result};InnerObserver.prototype.next=function(x){var i=this.i++;var result=tryCatch(this.selector)(x,i,this.source);if(result===errorObj){return this.o.onError(result.e)}isPromise(result)&&(result=observableFromPromise(result));(isArrayLike(result)||isIterable(result))&&(result=Observable.from(result));this.o.onNext(this._wrapResult(result,x,i))};InnerObserver.prototype.error=function(e){this.o.onError(e)};InnerObserver.prototype.completed=function(){this.o.onCompleted()};return FlatMapObservable}(ObservableBase);var Enumerable=Rx.internals.Enumerable=function(){};function IsDisposedDisposable(state){this._s=state;this.isDisposed=false}IsDisposedDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;this._s.isDisposed=true}};var ConcatEnumerableObservable=function(__super__){inherits(ConcatEnumerableObservable,__super__);function ConcatEnumerableObservable(sources){this.sources=sources;__super__.call(this)}function scheduleMethod(state,recurse){if(state.isDisposed){return}var currentItem=tryCatch(state.e.next).call(state.e);if(currentItem===errorObj){return state.o.onError(currentItem.e)}if(currentItem.done){return state.o.onCompleted()}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(new InnerObserver(state,recurse)))}ConcatEnumerableObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable;var state={isDisposed:false,o:o,subscription:subscription,e:this.sources[$iterator$]()};var cancelable=currentThreadScheduler.scheduleRecursive(state,scheduleMethod);return new NAryDisposable([subscription,cancelable,new IsDisposedDisposable(state)])};function InnerObserver(state,recurse){this._state=state;this._recurse=recurse;AbstractObserver.call(this)}inherits(InnerObserver,AbstractObserver);InnerObserver.prototype.next=function(x){this._state.o.onNext(x)};InnerObserver.prototype.error=function(e){this._state.o.onError(e)};InnerObserver.prototype.completed=function(){this._recurse(this._state)};return ConcatEnumerableObservable}(ObservableBase);Enumerable.prototype.concat=function(){return new ConcatEnumerableObservable(this)};var CatchErrorObservable=function(__super__){function CatchErrorObservable(sources){this.sources=sources;__super__.call(this)}inherits(CatchErrorObservable,__super__);function scheduleMethod(state,recurse){if(state.isDisposed){return}var currentItem=tryCatch(state.e.next).call(state.e);if(currentItem===errorObj){return state.o.onError(currentItem.e)}if(currentItem.done){return state.lastError!==null?state.o.onError(state.lastError):state.o.onCompleted()}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(new InnerObserver(state,recurse)))}CatchErrorObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable;var state={isDisposed:false,e:this.sources[$iterator$](),subscription:subscription,lastError:null,o:o};var cancelable=currentThreadScheduler.scheduleRecursive(state,scheduleMethod);return new NAryDisposable([subscription,cancelable,new IsDisposedDisposable(state)])};function InnerObserver(state,recurse){this._state=state;this._recurse=recurse;AbstractObserver.call(this)}inherits(InnerObserver,AbstractObserver);InnerObserver.prototype.next=function(x){this._state.o.onNext(x)};InnerObserver.prototype.error=function(e){this._state.lastError=e;this._recurse(this._state)};InnerObserver.prototype.completed=function(){this._state.o.onCompleted()};return CatchErrorObservable}(ObservableBase);Enumerable.prototype.catchError=function(){return new CatchErrorObservable(this)};var RepeatEnumerable=function(__super__){inherits(RepeatEnumerable,__super__);function RepeatEnumerable(v,c){this.v=v;this.c=c==null?-1:c}RepeatEnumerable.prototype[$iterator$]=function(){return new RepeatEnumerator(this)};function RepeatEnumerator(p){this.v=p.v;this.l=p.c}RepeatEnumerator.prototype.next=function(){if(this.l===0){return doneEnumerator}if(this.l>0){this.l--}return{done:false,value:this.v}};return RepeatEnumerable}(Enumerable);var enumerableRepeat=Enumerable.repeat=function(value,repeatCount){return new RepeatEnumerable(value,repeatCount)};var OfEnumerable=function(__super__){inherits(OfEnumerable,__super__);function OfEnumerable(s,fn,thisArg){this.s=s;this.fn=fn?bindCallback(fn,thisArg,3):null}OfEnumerable.prototype[$iterator$]=function(){return new OfEnumerator(this)};function OfEnumerator(p){this.i=-1;this.s=p.s;this.l=this.s.length;this.fn=p.fn}OfEnumerator.prototype.next=function(){return++this.i<this.l?{done:false,value:!this.fn?this.s[this.i]:this.fn(this.s[this.i],this.i,this.s)}:doneEnumerator};return OfEnumerable}(Enumerable);var enumerableOf=Enumerable.of=function(source,selector,thisArg){return new OfEnumerable(source,selector,thisArg)};var ToArrayObservable=function(__super__){inherits(ToArrayObservable,__super__);function ToArrayObservable(source){this.source=source;__super__.call(this)}ToArrayObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))};inherits(InnerObserver,AbstractObserver);function InnerObserver(o){this.o=o;this.a=[];AbstractObserver.call(this)}InnerObserver.prototype.next=function(x){this.a.push(x)};InnerObserver.prototype.error=function(e){this.o.onError(e)};InnerObserver.prototype.completed=function(){this.o.onNext(this.a);this.o.onCompleted()};return ToArrayObservable}(ObservableBase);observableProto.toArray=function(){return new ToArrayObservable(this)};Observable.create=function(subscribe,parent){return new AnonymousObservable(subscribe,parent)};var Defer=function(__super__){inherits(Defer,__super__);function Defer(factory){this._f=factory;__super__.call(this)}Defer.prototype.subscribeCore=function(o){var result=tryCatch(this._f)();if(result===errorObj){return observableThrow(result.e).subscribe(o)}isPromise(result)&&(result=observableFromPromise(result));return result.subscribe(o)};return Defer}(ObservableBase);var observableDefer=Observable.defer=function(observableFactory){return new Defer(observableFactory)};var EmptyObservable=function(__super__){inherits(EmptyObservable,__super__);function EmptyObservable(scheduler){this.scheduler=scheduler;__super__.call(this)}EmptyObservable.prototype.subscribeCore=function(observer){var sink=new EmptySink(observer,this.scheduler);return sink.run()};function EmptySink(observer,scheduler){this.observer=observer;this.scheduler=scheduler}function scheduleItem(s,state){state.onCompleted();return disposableEmpty}EmptySink.prototype.run=function(){var state=this.observer;return this.scheduler===immediateScheduler?scheduleItem(null,state):this.scheduler.schedule(state,scheduleItem)};return EmptyObservable}(ObservableBase);var EMPTY_OBSERVABLE=new EmptyObservable(immediateScheduler);var observableEmpty=Observable.empty=function(scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return scheduler===immediateScheduler?EMPTY_OBSERVABLE:new EmptyObservable(scheduler)};var FromObservable=function(__super__){inherits(FromObservable,__super__);function FromObservable(iterable,fn,scheduler){this._iterable=iterable;this._fn=fn;this._scheduler=scheduler;__super__.call(this)}function createScheduleMethod(o,it,fn){return function loopRecursive(i,recurse){var next=tryCatch(it.next).call(it);if(next===errorObj){return o.onError(next.e)}if(next.done){return o.onCompleted()}var result=next.value;if(isFunction(fn)){result=tryCatch(fn)(result,i);if(result===errorObj){return o.onError(result.e)}}o.onNext(result);recurse(i+1)}}FromObservable.prototype.subscribeCore=function(o){var list=Object(this._iterable),it=getIterable(list);return this._scheduler.scheduleRecursive(0,createScheduleMethod(o,it,this._fn))};return FromObservable}(ObservableBase);var maxSafeInteger=Math.pow(2,53)-1;function StringIterable(s){this._s=s}StringIterable.prototype[$iterator$]=function(){return new StringIterator(this._s)};function StringIterator(s){this._s=s;this._l=s.length;this._i=0}StringIterator.prototype[$iterator$]=function(){return this};StringIterator.prototype.next=function(){return this._i<this._l?{done:false,value:this._s.charAt(this._i++)}:doneEnumerator};function ArrayIterable(a){this._a=a}ArrayIterable.prototype[$iterator$]=function(){return new ArrayIterator(this._a)};function ArrayIterator(a){this._a=a;this._l=toLength(a);this._i=0}ArrayIterator.prototype[$iterator$]=function(){return this};ArrayIterator.prototype.next=function(){return this._i<this._l?{done:false,value:this._a[this._i++]}:doneEnumerator};function numberIsFinite(value){return typeof value==="number"&&root.isFinite(value)}function isNan(n){return n!==n}function getIterable(o){var i=o[$iterator$],it;if(!i&&typeof o==="string"){it=new StringIterable(o);return it[$iterator$]()}if(!i&&o.length!==undefined){it=new ArrayIterable(o);return it[$iterator$]()}if(!i){throw new TypeError("Object is not iterable")}return o[$iterator$]()}function sign(value){var number=+value;if(number===0){return number}if(isNaN(number)){return number}return number<0?-1:1}function toLength(o){var len=+o.length;if(isNaN(len)){return 0}if(len===0||!numberIsFinite(len)){return len}len=sign(len)*Math.floor(Math.abs(len));if(len<=0){return 0}if(len>maxSafeInteger){return maxSafeInteger}return len}var observableFrom=Observable.from=function(iterable,mapFn,thisArg,scheduler){if(iterable==null){throw new Error("iterable cannot be null.")}if(mapFn&&!isFunction(mapFn)){throw new Error("mapFn when provided must be a function")}if(mapFn){var mapper=bindCallback(mapFn,thisArg,2)}isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromObservable(iterable,mapper,scheduler)};var FromArrayObservable=function(__super__){inherits(FromArrayObservable,__super__);function FromArrayObservable(args,scheduler){this._args=args;this._scheduler=scheduler;__super__.call(this)}function scheduleMethod(o,args){var len=args.length;return function loopRecursive(i,recurse){if(i<len){o.onNext(args[i]);recurse(i+1)}else{o.onCompleted()}}}FromArrayObservable.prototype.subscribeCore=function(o){return this._scheduler.scheduleRecursive(0,scheduleMethod(o,this._args))};return FromArrayObservable}(ObservableBase);var observableFromArray=Observable.fromArray=function(array,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromArrayObservable(array,scheduler)};var NeverObservable=function(__super__){inherits(NeverObservable,__super__);function NeverObservable(){__super__.call(this)}NeverObservable.prototype.subscribeCore=function(observer){return disposableEmpty};return NeverObservable}(ObservableBase);var NEVER_OBSERVABLE=new NeverObservable;var observableNever=Observable.never=function(){return NEVER_OBSERVABLE};function observableOf(scheduler,array){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new FromArrayObservable(array,scheduler)}Observable.of=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return new FromArrayObservable(args,currentThreadScheduler)};Observable.ofWithScheduler=function(scheduler){var len=arguments.length,args=new Array(len-1);for(var i=1;i<len;i++){args[i-1]=arguments[i]}return new FromArrayObservable(args,scheduler)};var PairsObservable=function(__super__){inherits(PairsObservable,__super__);function PairsObservable(o,scheduler){this._o=o;this._keys=Object.keys(o);this._scheduler=scheduler;__super__.call(this)}function scheduleMethod(o,obj,keys){return function loopRecursive(i,recurse){if(i<keys.length){var key=keys[i];o.onNext([key,obj[key]]);recurse(i+1)}else{o.onCompleted()}}}PairsObservable.prototype.subscribeCore=function(o){return this._scheduler.scheduleRecursive(0,scheduleMethod(o,this._o,this._keys))};return PairsObservable}(ObservableBase);Observable.pairs=function(obj,scheduler){scheduler||(scheduler=currentThreadScheduler);return new PairsObservable(obj,scheduler)};var RangeObservable=function(__super__){inherits(RangeObservable,__super__);function RangeObservable(start,count,scheduler){this.start=start;this.rangeCount=count;this.scheduler=scheduler;__super__.call(this)}function loopRecursive(start,count,o){return function loop(i,recurse){if(i<count){o.onNext(start+i);recurse(i+1)}else{o.onCompleted()}}}RangeObservable.prototype.subscribeCore=function(o){return this.scheduler.scheduleRecursive(0,loopRecursive(this.start,this.rangeCount,o))};return RangeObservable}(ObservableBase);Observable.range=function(start,count,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new RangeObservable(start,count,scheduler)};var RepeatObservable=function(__super__){inherits(RepeatObservable,__super__);function RepeatObservable(value,repeatCount,scheduler){this.value=value;this.repeatCount=repeatCount==null?-1:repeatCount;this.scheduler=scheduler;__super__.call(this)}RepeatObservable.prototype.subscribeCore=function(observer){var sink=new RepeatSink(observer,this);return sink.run()};return RepeatObservable}(ObservableBase);function RepeatSink(observer,parent){this.observer=observer;this.parent=parent}RepeatSink.prototype.run=function(){var observer=this.observer,value=this.parent.value;function loopRecursive(i,recurse){if(i===-1||i>0){observer.onNext(value);i>0&&i--}if(i===0){return observer.onCompleted()}recurse(i)}return this.parent.scheduler.scheduleRecursive(this.parent.repeatCount,loopRecursive)};Observable.repeat=function(value,repeatCount,scheduler){isScheduler(scheduler)||(scheduler=currentThreadScheduler);return new RepeatObservable(value,repeatCount,scheduler)};var JustObservable=function(__super__){inherits(JustObservable,__super__);function JustObservable(value,scheduler){this._value=value;this._scheduler=scheduler;__super__.call(this)}JustObservable.prototype.subscribeCore=function(o){var state=[this._value,o];return this._scheduler===immediateScheduler?scheduleItem(null,state):this._scheduler.schedule(state,scheduleItem)};function scheduleItem(s,state){var value=state[0],observer=state[1];observer.onNext(value);observer.onCompleted();return disposableEmpty}return JustObservable}(ObservableBase);var observableReturn=Observable["return"]=Observable.just=function(value,scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new JustObservable(value,scheduler)};var ThrowObservable=function(__super__){inherits(ThrowObservable,__super__);function ThrowObservable(error,scheduler){this._error=error;this._scheduler=scheduler;__super__.call(this)}ThrowObservable.prototype.subscribeCore=function(o){var state=[this._error,o];return this._scheduler===immediateScheduler?scheduleItem(null,state):this._scheduler.schedule(state,scheduleItem)};function scheduleItem(s,state){var e=state[0],o=state[1];o.onError(e);return disposableEmpty}return ThrowObservable}(ObservableBase);var observableThrow=Observable["throw"]=function(error,scheduler){isScheduler(scheduler)||(scheduler=immediateScheduler);return new ThrowObservable(error,scheduler)};var CatchObservable=function(__super__){inherits(CatchObservable,__super__);function CatchObservable(source,fn){this.source=source;this._fn=fn;__super__.call(this)}CatchObservable.prototype.subscribeCore=function(o){var d1=new SingleAssignmentDisposable,subscription=new SerialDisposable;subscription.setDisposable(d1);d1.setDisposable(this.source.subscribe(new CatchObserver(o,subscription,this._fn)));return subscription};return CatchObservable}(ObservableBase);var CatchObserver=function(__super__){inherits(CatchObserver,__super__);function CatchObserver(o,s,fn){this._o=o;this._s=s;this._fn=fn;__super__.call(this)}CatchObserver.prototype.next=function(x){this._o.onNext(x)};CatchObserver.prototype.completed=function(){return this._o.onCompleted()};CatchObserver.prototype.error=function(e){var result=tryCatch(this._fn)(e);if(result===errorObj){return this._o.onError(result.e)}isPromise(result)&&(result=observableFromPromise(result));var d=new SingleAssignmentDisposable;this._s.setDisposable(d);d.setDisposable(result.subscribe(this._o))};return CatchObserver}(AbstractObserver);observableProto["catch"]=function(handlerOrSecond){return isFunction(handlerOrSecond)?new CatchObservable(this,handlerOrSecond):observableCatch([this,handlerOrSecond])};var observableCatch=Observable["catch"]=function(){var items;if(Array.isArray(arguments[0])){items=arguments[0]}else{var len=arguments.length;items=new Array(len);for(var i=0;i<len;i++){items[i]=arguments[i]}}return enumerableOf(items).catchError()};observableProto.combineLatest=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}if(Array.isArray(args[0])){args[0].unshift(this)}else{args.unshift(this)}return combineLatest.apply(this,args)};function falseFactory(){return false}function argumentsToArray(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return args}var CombineLatestObservable=function(__super__){inherits(CombineLatestObservable,__super__);function CombineLatestObservable(params,cb){this._params=params;this._cb=cb;__super__.call(this)}CombineLatestObservable.prototype.subscribeCore=function(observer){var len=this._params.length,subscriptions=new Array(len);var state={hasValue:arrayInitialize(len,falseFactory),hasValueAll:false,isDone:arrayInitialize(len,falseFactory),values:new Array(len)};for(var i=0;i<len;i++){var source=this._params[i],sad=new SingleAssignmentDisposable;subscriptions[i]=sad;isPromise(source)&&(source=observableFromPromise(source));sad.setDisposable(source.subscribe(new CombineLatestObserver(observer,i,this._cb,state)))}return new NAryDisposable(subscriptions)};return CombineLatestObservable}(ObservableBase);var CombineLatestObserver=function(__super__){inherits(CombineLatestObserver,__super__);function CombineLatestObserver(o,i,cb,state){this._o=o;this._i=i;this._cb=cb;this._state=state;__super__.call(this)}function notTheSame(i){return function(x,j){return j!==i}}CombineLatestObserver.prototype.next=function(x){this._state.values[this._i]=x;this._state.hasValue[this._i]=true;if(this._state.hasValueAll||(this._state.hasValueAll=this._state.hasValue.every(identity))){var res=tryCatch(this._cb).apply(null,this._state.values);if(res===errorObj){return this._o.onError(res.e)}this._o.onNext(res)}else if(this._state.isDone.filter(notTheSame(this._i)).every(identity)){this._o.onCompleted()}};CombineLatestObserver.prototype.error=function(e){this._o.onError(e)};CombineLatestObserver.prototype.completed=function(){this._state.isDone[this._i]=true;this._state.isDone.every(identity)&&this._o.onCompleted()};return CombineLatestObserver}(AbstractObserver);var combineLatest=Observable.combineLatest=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;Array.isArray(args[0])&&(args=args[0]);return new CombineLatestObservable(args,resultSelector)};observableProto.concat=function(){for(var args=[],i=0,len=arguments.length;i<len;i++){args.push(arguments[i])}args.unshift(this);return observableConcat.apply(null,args)};var ConcatObserver=function(__super__){inherits(ConcatObserver,__super__);function ConcatObserver(s,fn){this._s=s;this._fn=fn;__super__.call(this)}ConcatObserver.prototype.next=function(x){this._s.o.onNext(x)};ConcatObserver.prototype.error=function(e){this._s.o.onError(e)};ConcatObserver.prototype.completed=function(){this._s.i++;this._fn(this._s)};return ConcatObserver}(AbstractObserver);var ConcatObservable=function(__super__){inherits(ConcatObservable,__super__);function ConcatObservable(sources){this._sources=sources;__super__.call(this)}function scheduleRecursive(state,recurse){if(state.disposable.isDisposed){return}if(state.i===state.sources.length){return state.o.onCompleted()}var currentValue=state.sources[state.i];isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var d=new SingleAssignmentDisposable;state.subscription.setDisposable(d);d.setDisposable(currentValue.subscribe(new ConcatObserver(state,recurse)))}ConcatObservable.prototype.subscribeCore=function(o){var subscription=new SerialDisposable;var disposable=disposableCreate(noop);var state={o:o,i:0,subscription:subscription,disposable:disposable,sources:this._sources};var cancelable=immediateScheduler.scheduleRecursive(state,scheduleRecursive);return new NAryDisposable([subscription,disposable,cancelable])};return ConcatObservable}(ObservableBase);var observableConcat=Observable.concat=function(){var args;if(Array.isArray(arguments[0])){args=arguments[0]}else{args=new Array(arguments.length);for(var i=0,len=arguments.length;i<len;i++){args[i]=arguments[i]}}return new ConcatObservable(args)};observableProto.concatAll=function(){return this.merge(1)};var MergeObservable=function(__super__){inherits(MergeObservable,__super__);function MergeObservable(source,maxConcurrent){this.source=source;this.maxConcurrent=maxConcurrent;__super__.call(this)}MergeObservable.prototype.subscribeCore=function(observer){var g=new CompositeDisposable;g.add(this.source.subscribe(new MergeObserver(observer,this.maxConcurrent,g)));return g};return MergeObservable}(ObservableBase);var MergeObserver=function(__super__){function MergeObserver(o,max,g){this.o=o;this.max=max;this.g=g;this.done=false;this.q=[];this.activeCount=0;__super__.call(this)}inherits(MergeObserver,__super__);MergeObserver.prototype.handleSubscribe=function(xs){var sad=new SingleAssignmentDisposable;this.g.add(sad);isPromise(xs)&&(xs=observableFromPromise(xs));sad.setDisposable(xs.subscribe(new InnerObserver(this,sad)))};MergeObserver.prototype.next=function(innerSource){if(this.activeCount<this.max){this.activeCount++;this.handleSubscribe(innerSource)}else{this.q.push(innerSource)}};MergeObserver.prototype.error=function(e){this.o.onError(e)};MergeObserver.prototype.completed=function(){this.done=true;this.activeCount===0&&this.o.onCompleted()};function InnerObserver(parent,sad){this.parent=parent;this.sad=sad;__super__.call(this)}inherits(InnerObserver,__super__);InnerObserver.prototype.next=function(x){this.parent.o.onNext(x)};InnerObserver.prototype.error=function(e){this.parent.o.onError(e)};InnerObserver.prototype.completed=function(){this.parent.g.remove(this.sad);if(this.parent.q.length>0){this.parent.handleSubscribe(this.parent.q.shift())}else{this.parent.activeCount--;this.parent.done&&this.parent.activeCount===0&&this.parent.o.onCompleted()}};return MergeObserver}(AbstractObserver);observableProto.merge=function(maxConcurrentOrOther){return typeof maxConcurrentOrOther!=="number"?observableMerge(this,maxConcurrentOrOther):new MergeObservable(this,maxConcurrentOrOther)};var observableMerge=Observable.merge=function(){var scheduler,sources=[],i,len=arguments.length;if(!arguments[0]){scheduler=immediateScheduler;for(i=1;i<len;i++){sources.push(arguments[i])}}else if(isScheduler(arguments[0])){scheduler=arguments[0];for(i=1;i<len;i++){sources.push(arguments[i])}}else{scheduler=immediateScheduler;for(i=0;i<len;i++){sources.push(arguments[i])}}if(Array.isArray(sources[0])){sources=sources[0]}return observableOf(scheduler,sources).mergeAll()};var CompositeError=Rx.CompositeError=function(errors){this.innerErrors=errors;this.message="This contains multiple errors. Check the innerErrors";Error.call(this)};CompositeError.prototype=Object.create(Error.prototype);CompositeError.prototype.name="CompositeError";var MergeDelayErrorObservable=function(__super__){inherits(MergeDelayErrorObservable,__super__);function MergeDelayErrorObservable(source){this.source=source;__super__.call(this)}MergeDelayErrorObservable.prototype.subscribeCore=function(o){var group=new CompositeDisposable,m=new SingleAssignmentDisposable,state={isStopped:false,errors:[],o:o};group.add(m);m.setDisposable(this.source.subscribe(new MergeDelayErrorObserver(group,state)));return group};return MergeDelayErrorObservable}(ObservableBase);var MergeDelayErrorObserver=function(__super__){inherits(MergeDelayErrorObserver,__super__);function MergeDelayErrorObserver(group,state){this._group=group;this._state=state;__super__.call(this)}function setCompletion(o,errors){if(errors.length===0){o.onCompleted()}else if(errors.length===1){o.onError(errors[0])}else{o.onError(new CompositeError(errors))}}MergeDelayErrorObserver.prototype.next=function(x){var inner=new SingleAssignmentDisposable;this._group.add(inner);isPromise(x)&&(x=observableFromPromise(x));inner.setDisposable(x.subscribe(new InnerObserver(inner,this._group,this._state)))};MergeDelayErrorObserver.prototype.error=function(e){this._state.errors.push(e);this._state.isStopped=true;this._group.length===1&&setCompletion(this._state.o,this._state.errors)};MergeDelayErrorObserver.prototype.completed=function(){this._state.isStopped=true;this._group.length===1&&setCompletion(this._state.o,this._state.errors)};inherits(InnerObserver,__super__);function InnerObserver(inner,group,state){this._inner=inner;this._group=group;this._state=state;__super__.call(this)}InnerObserver.prototype.next=function(x){this._state.o.onNext(x)};InnerObserver.prototype.error=function(e){this._state.errors.push(e);this._group.remove(this._inner);this._state.isStopped&&this._group.length===1&&setCompletion(this._state.o,this._state.errors)};InnerObserver.prototype.completed=function(){this._group.remove(this._inner);this._state.isStopped&&this._group.length===1&&setCompletion(this._state.o,this._state.errors)};return MergeDelayErrorObserver}(AbstractObserver);Observable.mergeDelayError=function(){var args;if(Array.isArray(arguments[0])){args=arguments[0]}else{var len=arguments.length;args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}}var source=observableOf(null,args);return new MergeDelayErrorObservable(source)};var MergeAllObservable=function(__super__){inherits(MergeAllObservable,__super__);function MergeAllObservable(source){this.source=source;__super__.call(this)}MergeAllObservable.prototype.subscribeCore=function(o){var g=new CompositeDisposable,m=new SingleAssignmentDisposable;g.add(m);m.setDisposable(this.source.subscribe(new MergeAllObserver(o,g)));return g};return MergeAllObservable}(ObservableBase);var MergeAllObserver=function(__super__){function MergeAllObserver(o,g){this.o=o;this.g=g;this.done=false;__super__.call(this)}inherits(MergeAllObserver,__super__);MergeAllObserver.prototype.next=function(innerSource){var sad=new SingleAssignmentDisposable;this.g.add(sad);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));sad.setDisposable(innerSource.subscribe(new InnerObserver(this,sad)))};MergeAllObserver.prototype.error=function(e){this.o.onError(e)};MergeAllObserver.prototype.completed=function(){this.done=true;this.g.length===1&&this.o.onCompleted()};function InnerObserver(parent,sad){this.parent=parent;this.sad=sad;__super__.call(this)}inherits(InnerObserver,__super__);InnerObserver.prototype.next=function(x){this.parent.o.onNext(x)};InnerObserver.prototype.error=function(e){this.parent.o.onError(e)};InnerObserver.prototype.completed=function(){this.parent.g.remove(this.sad);this.parent.done&&this.parent.g.length===1&&this.parent.o.onCompleted()};return MergeAllObserver}(AbstractObserver);observableProto.mergeAll=function(){return new MergeAllObservable(this)};var SkipUntilObservable=function(__super__){inherits(SkipUntilObservable,__super__);function SkipUntilObservable(source,other){this._s=source;this._o=isPromise(other)?observableFromPromise(other):other;this._open=false;__super__.call(this)}SkipUntilObservable.prototype.subscribeCore=function(o){var leftSubscription=new SingleAssignmentDisposable;leftSubscription.setDisposable(this._s.subscribe(new SkipUntilSourceObserver(o,this)));isPromise(this._o)&&(this._o=observableFromPromise(this._o));var rightSubscription=new SingleAssignmentDisposable;rightSubscription.setDisposable(this._o.subscribe(new SkipUntilOtherObserver(o,this,rightSubscription)));return new BinaryDisposable(leftSubscription,rightSubscription)};return SkipUntilObservable}(ObservableBase);var SkipUntilSourceObserver=function(__super__){inherits(SkipUntilSourceObserver,__super__);function SkipUntilSourceObserver(o,p){this._o=o;this._p=p;__super__.call(this)}SkipUntilSourceObserver.prototype.next=function(x){this._p._open&&this._o.onNext(x)};SkipUntilSourceObserver.prototype.error=function(err){this._o.onError(err)};SkipUntilSourceObserver.prototype.onCompleted=function(){this._p._open&&this._o.onCompleted()};return SkipUntilSourceObserver}(AbstractObserver);var SkipUntilOtherObserver=function(__super__){inherits(SkipUntilOtherObserver,__super__);function SkipUntilOtherObserver(o,p,r){this._o=o;this._p=p;this._r=r;__super__.call(this)}SkipUntilOtherObserver.prototype.next=function(){this._p._open=true;this._r.dispose()};SkipUntilOtherObserver.prototype.error=function(err){this._o.onError(err)};SkipUntilOtherObserver.prototype.onCompleted=function(){this._r.dispose()};return SkipUntilOtherObserver}(AbstractObserver);observableProto.skipUntil=function(other){return new SkipUntilObservable(this,other)};var SwitchObservable=function(__super__){inherits(SwitchObservable,__super__);function SwitchObservable(source){this.source=source;__super__.call(this)}SwitchObservable.prototype.subscribeCore=function(o){var inner=new SerialDisposable,s=this.source.subscribe(new SwitchObserver(o,inner));return new BinaryDisposable(s,inner)};inherits(SwitchObserver,AbstractObserver);function SwitchObserver(o,inner){this.o=o;this.inner=inner;this.stopped=false;this.latest=0;this.hasLatest=false;AbstractObserver.call(this)}SwitchObserver.prototype.next=function(innerSource){var d=new SingleAssignmentDisposable,id=++this.latest;this.hasLatest=true;this.inner.setDisposable(d);isPromise(innerSource)&&(innerSource=observableFromPromise(innerSource));d.setDisposable(innerSource.subscribe(new InnerObserver(this,id)))};SwitchObserver.prototype.error=function(e){this.o.onError(e)};SwitchObserver.prototype.completed=function(){this.stopped=true;!this.hasLatest&&this.o.onCompleted()};inherits(InnerObserver,AbstractObserver);function InnerObserver(parent,id){this.parent=parent;this.id=id;AbstractObserver.call(this)}InnerObserver.prototype.next=function(x){this.parent.latest===this.id&&this.parent.o.onNext(x)};InnerObserver.prototype.error=function(e){this.parent.latest===this.id&&this.parent.o.onError(e)};InnerObserver.prototype.completed=function(){if(this.parent.latest===this.id){this.parent.hasLatest=false;this.parent.stopped&&this.parent.o.onCompleted()}};return SwitchObservable}(ObservableBase);observableProto["switch"]=observableProto.switchLatest=function(){return new SwitchObservable(this)};var TakeUntilObservable=function(__super__){inherits(TakeUntilObservable,__super__);function TakeUntilObservable(source,other){this.source=source;this.other=isPromise(other)?observableFromPromise(other):other;__super__.call(this)}TakeUntilObservable.prototype.subscribeCore=function(o){return new BinaryDisposable(this.source.subscribe(o),this.other.subscribe(new TakeUntilObserver(o)))};return TakeUntilObservable}(ObservableBase);var TakeUntilObserver=function(__super__){inherits(TakeUntilObserver,__super__);function TakeUntilObserver(o){this._o=o;__super__.call(this)}TakeUntilObserver.prototype.next=function(){this._o.onCompleted()};TakeUntilObserver.prototype.error=function(err){this._o.onError(err)};TakeUntilObserver.prototype.onCompleted=noop;return TakeUntilObserver}(AbstractObserver);observableProto.takeUntil=function(other){return new TakeUntilObservable(this,other)};function falseFactory(){return false}function argumentsToArray(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return args}var WithLatestFromObservable=function(__super__){inherits(WithLatestFromObservable,__super__);function WithLatestFromObservable(source,sources,resultSelector){this._s=source;this._ss=sources;this._cb=resultSelector;__super__.call(this)}WithLatestFromObservable.prototype.subscribeCore=function(o){var len=this._ss.length;var state={hasValue:arrayInitialize(len,falseFactory),hasValueAll:false,values:new Array(len)};var n=this._ss.length,subscriptions=new Array(n+1);for(var i=0;i<n;i++){var other=this._ss[i],sad=new SingleAssignmentDisposable;isPromise(other)&&(other=observableFromPromise(other));sad.setDisposable(other.subscribe(new WithLatestFromOtherObserver(o,i,state)));subscriptions[i]=sad}var outerSad=new SingleAssignmentDisposable;outerSad.setDisposable(this._s.subscribe(new WithLatestFromSourceObserver(o,this._cb,state)));subscriptions[n]=outerSad;return new NAryDisposable(subscriptions)};return WithLatestFromObservable}(ObservableBase);var WithLatestFromOtherObserver=function(__super__){inherits(WithLatestFromOtherObserver,__super__);function WithLatestFromOtherObserver(o,i,state){this._o=o;this._i=i;this._state=state;__super__.call(this)}WithLatestFromOtherObserver.prototype.next=function(x){this._state.values[this._i]=x;this._state.hasValue[this._i]=true;this._state.hasValueAll=this._state.hasValue.every(identity)};WithLatestFromOtherObserver.prototype.error=function(e){this._o.onError(e)};WithLatestFromOtherObserver.prototype.completed=noop;return WithLatestFromOtherObserver}(AbstractObserver);var WithLatestFromSourceObserver=function(__super__){inherits(WithLatestFromSourceObserver,__super__);function WithLatestFromSourceObserver(o,cb,state){this._o=o;this._cb=cb;this._state=state;__super__.call(this)}WithLatestFromSourceObserver.prototype.next=function(x){var allValues=[x].concat(this._state.values);if(!this._state.hasValueAll){return}var res=tryCatch(this._cb).apply(null,allValues);if(res===errorObj){return this._o.onError(res.e)}this._o.onNext(res)};WithLatestFromSourceObserver.prototype.error=function(e){this._o.onError(e)};WithLatestFromSourceObserver.prototype.completed=function(){this._o.onCompleted()};return WithLatestFromSourceObserver}(AbstractObserver);observableProto.withLatestFrom=function(){if(arguments.length===0){throw new Error("invalid arguments")}var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;Array.isArray(args[0])&&(args=args[0]);return new WithLatestFromObservable(this,args,resultSelector)};function falseFactory(){return false}function emptyArrayFactory(){return[]}var ZipObservable=function(__super__){inherits(ZipObservable,__super__);function ZipObservable(sources,resultSelector){this._s=sources;this._cb=resultSelector;__super__.call(this)}ZipObservable.prototype.subscribeCore=function(observer){var n=this._s.length,subscriptions=new Array(n),done=arrayInitialize(n,falseFactory),q=arrayInitialize(n,emptyArrayFactory);for(var i=0;i<n;i++){var source=this._s[i],sad=new SingleAssignmentDisposable;subscriptions[i]=sad;isPromise(source)&&(source=observableFromPromise(source));sad.setDisposable(source.subscribe(new ZipObserver(observer,i,this,q,done)))}return new NAryDisposable(subscriptions)};return ZipObservable}(ObservableBase);var ZipObserver=function(__super__){inherits(ZipObserver,__super__);function ZipObserver(o,i,p,q,d){this._o=o;this._i=i;this._p=p;this._q=q;this._d=d;__super__.call(this)}function notEmpty(x){return x.length>0}function shiftEach(x){return x.shift()}function notTheSame(i){return function(x,j){return j!==i}}ZipObserver.prototype.next=function(x){this._q[this._i].push(x);if(this._q.every(notEmpty)){var queuedValues=this._q.map(shiftEach);var res=tryCatch(this._p._cb).apply(null,queuedValues);if(res===errorObj){return this._o.onError(res.e)}this._o.onNext(res)}else if(this._d.filter(notTheSame(this._i)).every(identity)){this._o.onCompleted()}};ZipObserver.prototype.error=function(e){this._o.onError(e)};ZipObserver.prototype.completed=function(){this._d[this._i]=true;this._d.every(identity)&&this._o.onCompleted()};return ZipObserver}(AbstractObserver);observableProto.zip=function(){if(arguments.length===0){throw new Error("invalid arguments")}var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;Array.isArray(args[0])&&(args=args[0]);var parent=this;args.unshift(parent);return new ZipObservable(args,resultSelector)};Observable.zip=function(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}if(Array.isArray(args[0])){args=isFunction(args[1])?args[0].concat(args[1]):args[0]}var first=args.shift();return first.zip.apply(first,args)};function falseFactory(){return false}function emptyArrayFactory(){return[]}function argumentsToArray(){var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return args}var ZipIterableObservable=function(__super__){inherits(ZipIterableObservable,__super__);function ZipIterableObservable(sources,cb){this.sources=sources;this._cb=cb;__super__.call(this)}ZipIterableObservable.prototype.subscribeCore=function(o){var sources=this.sources,len=sources.length,subscriptions=new Array(len);var state={q:arrayInitialize(len,emptyArrayFactory),done:arrayInitialize(len,falseFactory),cb:this._cb,o:o};for(var i=0;i<len;i++){(function(i){var source=sources[i],sad=new SingleAssignmentDisposable;(isArrayLike(source)||isIterable(source))&&(source=observableFrom(source));subscriptions[i]=sad;sad.setDisposable(source.subscribe(new ZipIterableObserver(state,i)))})(i)}return new NAryDisposable(subscriptions)};return ZipIterableObservable}(ObservableBase);var ZipIterableObserver=function(__super__){inherits(ZipIterableObserver,__super__);function ZipIterableObserver(s,i){this._s=s;this._i=i;__super__.call(this)}function notEmpty(x){return x.length>0}function shiftEach(x){return x.shift()}function notTheSame(i){return function(x,j){return j!==i}}ZipIterableObserver.prototype.next=function(x){this._s.q[this._i].push(x);if(this._s.q.every(notEmpty)){var queuedValues=this._s.q.map(shiftEach),res=tryCatch(this._s.cb).apply(null,queuedValues);if(res===errorObj){return this._s.o.onError(res.e)}this._s.o.onNext(res)}else if(this._s.done.filter(notTheSame(this._i)).every(identity)){this._s.o.onCompleted()}};ZipIterableObserver.prototype.error=function(e){this._s.o.onError(e)};ZipIterableObserver.prototype.completed=function(){this._s.done[this._i]=true;this._s.done.every(identity)&&this._s.o.onCompleted()};return ZipIterableObserver}(AbstractObserver);observableProto.zipIterable=function(){if(arguments.length===0){throw new Error("invalid arguments")}var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}var resultSelector=isFunction(args[len-1])?args.pop():argumentsToArray;var parent=this;args.unshift(parent);return new ZipIterableObservable(args,resultSelector)};function asObservable(source){return function subscribe(o){return source.subscribe(o)}}observableProto.asObservable=function(){return new AnonymousObservable(asObservable(this),this)};var DematerializeObservable=function(__super__){inherits(DematerializeObservable,__super__);function DematerializeObservable(source){this.source=source;__super__.call(this)}DematerializeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new DematerializeObserver(o))};return DematerializeObservable}(ObservableBase);var DematerializeObserver=function(__super__){inherits(DematerializeObserver,__super__);function DematerializeObserver(o){this._o=o;__super__.call(this)}DematerializeObserver.prototype.next=function(x){x.accept(this._o)};DematerializeObserver.prototype.error=function(e){this._o.onError(e)};DematerializeObserver.prototype.completed=function(){this._o.onCompleted()};return DematerializeObserver}(AbstractObserver);observableProto.dematerialize=function(){return new DematerializeObservable(this)};var DistinctUntilChangedObservable=function(__super__){inherits(DistinctUntilChangedObservable,__super__);function DistinctUntilChangedObservable(source,keyFn,comparer){this.source=source;this.keyFn=keyFn;this.comparer=comparer;__super__.call(this)}DistinctUntilChangedObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new DistinctUntilChangedObserver(o,this.keyFn,this.comparer))};return DistinctUntilChangedObservable}(ObservableBase);var DistinctUntilChangedObserver=function(__super__){inherits(DistinctUntilChangedObserver,__super__);function DistinctUntilChangedObserver(o,keyFn,comparer){this.o=o;this.keyFn=keyFn;this.comparer=comparer;this.hasCurrentKey=false;this.currentKey=null;__super__.call(this)}DistinctUntilChangedObserver.prototype.next=function(x){var key=x,comparerEquals;if(isFunction(this.keyFn)){key=tryCatch(this.keyFn)(x);if(key===errorObj){return this.o.onError(key.e)}}if(this.hasCurrentKey){comparerEquals=tryCatch(this.comparer)(this.currentKey,key);if(comparerEquals===errorObj){return this.o.onError(comparerEquals.e)}}if(!this.hasCurrentKey||!comparerEquals){this.hasCurrentKey=true;this.currentKey=key;this.o.onNext(x)}};DistinctUntilChangedObserver.prototype.error=function(e){this.o.onError(e)};DistinctUntilChangedObserver.prototype.completed=function(){this.o.onCompleted()};return DistinctUntilChangedObserver}(AbstractObserver);observableProto.distinctUntilChanged=function(keyFn,comparer){comparer||(comparer=defaultComparer);return new DistinctUntilChangedObservable(this,keyFn,comparer)};var TapObservable=function(__super__){inherits(TapObservable,__super__);function TapObservable(source,observerOrOnNext,onError,onCompleted){this.source=source;this._oN=observerOrOnNext;this._oE=onError;this._oC=onCompleted;__super__.call(this)}TapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this))};inherits(InnerObserver,AbstractObserver);function InnerObserver(o,p){this.o=o;this.t=!p._oN||isFunction(p._oN)?observerCreate(p._oN||noop,p._oE||noop,p._oC||noop):p._oN;this.isStopped=false;AbstractObserver.call(this)}InnerObserver.prototype.next=function(x){var res=tryCatch(this.t.onNext).call(this.t,x);if(res===errorObj){this.o.onError(res.e)}this.o.onNext(x)};InnerObserver.prototype.error=function(err){var res=tryCatch(this.t.onError).call(this.t,err);if(res===errorObj){return this.o.onError(res.e)}this.o.onError(err)};InnerObserver.prototype.completed=function(){var res=tryCatch(this.t.onCompleted).call(this.t);if(res===errorObj){return this.o.onError(res.e)}this.o.onCompleted()};return TapObservable}(ObservableBase);observableProto["do"]=observableProto.tap=observableProto.doAction=function(observerOrOnNext,onError,onCompleted){return new TapObservable(this,observerOrOnNext,onError,onCompleted)};observableProto.doOnNext=observableProto.tapOnNext=function(onNext,thisArg){return this.tap(typeof thisArg!=="undefined"?function(x){onNext.call(thisArg,x)}:onNext)};observableProto.doOnError=observableProto.tapOnError=function(onError,thisArg){return this.tap(noop,typeof thisArg!=="undefined"?function(e){onError.call(thisArg,e)}:onError)};observableProto.doOnCompleted=observableProto.tapOnCompleted=function(onCompleted,thisArg){return this.tap(noop,null,typeof thisArg!=="undefined"?function(){onCompleted.call(thisArg)}:onCompleted)};var FinallyObservable=function(__super__){inherits(FinallyObservable,__super__);function FinallyObservable(source,fn,thisArg){this.source=source;this._fn=bindCallback(fn,thisArg,0);__super__.call(this)}FinallyObservable.prototype.subscribeCore=function(o){var d=tryCatch(this.source.subscribe).call(this.source,o);if(d===errorObj){this._fn();thrower(d.e)}return new FinallyDisposable(d,this._fn)};function FinallyDisposable(s,fn){this.isDisposed=false;this._s=s;this._fn=fn}FinallyDisposable.prototype.dispose=function(){if(!this.isDisposed){var res=tryCatch(this._s.dispose).call(this._s);this._fn();res===errorObj&&thrower(res.e)}};return FinallyObservable}(ObservableBase);observableProto["finally"]=function(action,thisArg){return new FinallyObservable(this,action,thisArg)};var IgnoreElementsObservable=function(__super__){inherits(IgnoreElementsObservable,__super__);function IgnoreElementsObservable(source){this.source=source;__super__.call(this)}IgnoreElementsObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o))};function InnerObserver(o){this.o=o;this.isStopped=false}InnerObserver.prototype.onNext=noop;InnerObserver.prototype.onError=function(err){if(!this.isStopped){this.isStopped=true;this.o.onError(err)}};InnerObserver.prototype.onCompleted=function(){if(!this.isStopped){this.isStopped=true;this.o.onCompleted()}};InnerObserver.prototype.dispose=function(){this.isStopped=true};InnerObserver.prototype.fail=function(e){if(!this.isStopped){this.isStopped=true;this.observer.onError(e);return true}return false};return IgnoreElementsObservable}(ObservableBase);observableProto.ignoreElements=function(){return new IgnoreElementsObservable(this)};var MaterializeObservable=function(__super__){inherits(MaterializeObservable,__super__);function MaterializeObservable(source,fn){this.source=source;__super__.call(this)}MaterializeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new MaterializeObserver(o))};return MaterializeObservable}(ObservableBase);var MaterializeObserver=function(__super__){inherits(MaterializeObserver,__super__);function MaterializeObserver(o){this._o=o;__super__.call(this)}MaterializeObserver.prototype.next=function(x){this._o.onNext(notificationCreateOnNext(x))};MaterializeObserver.prototype.error=function(e){this._o.onNext(notificationCreateOnError(e));this._o.onCompleted()};MaterializeObserver.prototype.completed=function(){this._o.onNext(notificationCreateOnCompleted());this._o.onCompleted()};return MaterializeObserver}(AbstractObserver);observableProto.materialize=function(){return new MaterializeObservable(this)};observableProto.repeat=function(repeatCount){return enumerableRepeat(this,repeatCount).concat()};observableProto.retry=function(retryCount){return enumerableRepeat(this,retryCount).catchError()};function repeat(value){return{"@@iterator":function(){return{next:function(){return{done:false,value:value}}}}}}var RetryWhenObservable=function(__super__){function createDisposable(state){return{isDisposed:false,dispose:function(){if(!this.isDisposed){this.isDisposed=true;state.isDisposed=true}}}}function RetryWhenObservable(source,notifier){this.source=source;this._notifier=notifier;__super__.call(this)}inherits(RetryWhenObservable,__super__);RetryWhenObservable.prototype.subscribeCore=function(o){var exceptions=new Subject,notifier=new Subject,handled=this._notifier(exceptions),notificationDisposable=handled.subscribe(notifier);var e=this.source["@@iterator"]();var state={isDisposed:false},lastError,subscription=new SerialDisposable;var cancelable=currentThreadScheduler.scheduleRecursive(null,function(_,recurse){if(state.isDisposed){return}var currentItem=e.next();if(currentItem.done){if(lastError){o.onError(lastError)}else{o.onCompleted()}return}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var outer=new SingleAssignmentDisposable;var inner=new SingleAssignmentDisposable;subscription.setDisposable(new BinaryDisposable(inner,outer));outer.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(exn){inner.setDisposable(notifier.subscribe(recurse,function(ex){o.onError(ex)},function(){o.onCompleted()}));exceptions.onNext(exn);outer.dispose()},function(){o.onCompleted()}))});return new NAryDisposable([notificationDisposable,subscription,cancelable,createDisposable(state)])};return RetryWhenObservable}(ObservableBase);observableProto.retryWhen=function(notifier){return new RetryWhenObservable(repeat(this),notifier)};function repeat(value){return{"@@iterator":function(){return{next:function(){return{done:false,value:value}}}}}}var RepeatWhenObservable=function(__super__){function createDisposable(state){return{isDisposed:false,dispose:function(){if(!this.isDisposed){this.isDisposed=true;state.isDisposed=true}}}}function RepeatWhenObservable(source,notifier){this.source=source;this._notifier=notifier;__super__.call(this)}inherits(RepeatWhenObservable,__super__);RepeatWhenObservable.prototype.subscribeCore=function(o){var completions=new Subject,notifier=new Subject,handled=this._notifier(completions),notificationDisposable=handled.subscribe(notifier);var e=this.source["@@iterator"]();var state={isDisposed:false},lastError,subscription=new SerialDisposable;var cancelable=currentThreadScheduler.scheduleRecursive(null,function(_,recurse){if(state.isDisposed){return}var currentItem=e.next();if(currentItem.done){if(lastError){o.onError(lastError)}else{o.onCompleted()}return}var currentValue=currentItem.value;isPromise(currentValue)&&(currentValue=observableFromPromise(currentValue));var outer=new SingleAssignmentDisposable;var inner=new SingleAssignmentDisposable;subscription.setDisposable(new BinaryDisposable(inner,outer));outer.setDisposable(currentValue.subscribe(function(x){o.onNext(x)},function(exn){o.onError(exn)},function(){inner.setDisposable(notifier.subscribe(recurse,function(ex){o.onError(ex)},function(){o.onCompleted()}));completions.onNext(null);outer.dispose()}))});return new NAryDisposable([notificationDisposable,subscription,cancelable,createDisposable(state)])};return RepeatWhenObservable}(ObservableBase);observableProto.repeatWhen=function(notifier){return new RepeatWhenObservable(repeat(this),notifier)};var ScanObservable=function(__super__){inherits(ScanObservable,__super__);function ScanObservable(source,accumulator,hasSeed,seed){this.source=source;this.accumulator=accumulator;this.hasSeed=hasSeed;this.seed=seed;__super__.call(this)}ScanObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new ScanObserver(o,this))};return ScanObservable}(ObservableBase);var ScanObserver=function(__super__){inherits(ScanObserver,__super__);function ScanObserver(o,parent){this._o=o;this._p=parent;this._fn=parent.accumulator;this._hs=parent.hasSeed;this._s=parent.seed;this._ha=false;this._a=null;this._hv=false;this._i=0;__super__.call(this)}ScanObserver.prototype.next=function(x){!this._hv&&(this._hv=true);if(this._ha){this._a=tryCatch(this._fn)(this._a,x,this._i,this._p)}else{this._a=this._hs?tryCatch(this._fn)(this._s,x,this._i,this._p):x;this._ha=true}if(this._a===errorObj){return this._o.onError(this._a.e)}this._o.onNext(this._a);this._i++};ScanObserver.prototype.error=function(e){this._o.onError(e)};ScanObserver.prototype.completed=function(){!this._hv&&this._hs&&this._o.onNext(this._s);this._o.onCompleted()};return ScanObserver}(AbstractObserver);observableProto.scan=function(){var hasSeed=false,seed,accumulator=arguments[0];if(arguments.length===2){hasSeed=true;seed=arguments[1]}return new ScanObservable(this,accumulator,hasSeed,seed)};var SkipLastObservable=function(__super__){inherits(SkipLastObservable,__super__);function SkipLastObservable(source,c){this.source=source;this._c=c;__super__.call(this)}SkipLastObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipLastObserver(o,this._c))};return SkipLastObservable}(ObservableBase);var SkipLastObserver=function(__super__){inherits(SkipLastObserver,__super__);function SkipLastObserver(o,c){this._o=o;this._c=c;this._q=[];__super__.call(this)}SkipLastObserver.prototype.next=function(x){this._q.push(x);this._q.length>this._c&&this._o.onNext(this._q.shift())};SkipLastObserver.prototype.error=function(e){this._o.onError(e)};SkipLastObserver.prototype.completed=function(){this._o.onCompleted()};return SkipLastObserver}(AbstractObserver);observableProto.skipLast=function(count){if(count<0){throw new ArgumentOutOfRangeError}return new SkipLastObservable(this,count)};observableProto.startWith=function(){var values,scheduler,start=0;if(!!arguments.length&&isScheduler(arguments[0])){scheduler=arguments[0];start=1}else{scheduler=immediateScheduler}for(var args=[],i=start,len=arguments.length;i<len;i++){args.push(arguments[i])}return observableConcat.apply(null,[observableFromArray(args,scheduler),this])};var TakeLastObserver=function(__super__){inherits(TakeLastObserver,__super__);function TakeLastObserver(o,c){this._o=o;this._c=c;this._q=[];__super__.call(this)}TakeLastObserver.prototype.next=function(x){this._q.push(x);this._q.length>this._c&&this._q.shift()};TakeLastObserver.prototype.error=function(e){this._o.onError(e)};TakeLastObserver.prototype.completed=function(){while(this._q.length>0){this._o.onNext(this._q.shift())}this._o.onCompleted()};return TakeLastObserver}(AbstractObserver);observableProto.takeLast=function(count){if(count<0){throw new ArgumentOutOfRangeError}var source=this;return new AnonymousObservable(function(o){return source.subscribe(new TakeLastObserver(o,count))},source)};observableProto.flatMapConcat=observableProto.concatMap=function(selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).merge(1)};var MapObservable=function(__super__){inherits(MapObservable,__super__);function MapObservable(source,selector,thisArg){this.source=source;this.selector=bindCallback(selector,thisArg,3);__super__.call(this)}function innerMap(selector,self){return function(x,i,o){return selector.call(this,self.selector(x,i,o),i,o)}}MapObservable.prototype.internalMap=function(selector,thisArg){return new MapObservable(this.source,innerMap(selector,this),thisArg)};MapObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.selector,this))};inherits(InnerObserver,AbstractObserver);function InnerObserver(o,selector,source){this.o=o;this.selector=selector;this.source=source;this.i=0;AbstractObserver.call(this)}InnerObserver.prototype.next=function(x){var result=tryCatch(this.selector)(x,this.i++,this.source);if(result===errorObj){return this.o.onError(result.e)}this.o.onNext(result)};InnerObserver.prototype.error=function(e){this.o.onError(e)};InnerObserver.prototype.completed=function(){this.o.onCompleted()};return MapObservable}(ObservableBase);observableProto.map=observableProto.select=function(selector,thisArg){var selectorFn=typeof selector==="function"?selector:function(){return selector};return this instanceof MapObservable?this.internalMap(selectorFn,thisArg):new MapObservable(this,selectorFn,thisArg)};function plucker(args,len){return function mapper(x){var currentProp=x;for(var i=0;i<len;i++){var p=currentProp[args[i]];if(typeof p!=="undefined"){currentProp=p}else{return undefined}}return currentProp}}observableProto.pluck=function(){var len=arguments.length,args=new Array(len);if(len===0){throw new Error("List of properties cannot be empty.")}for(var i=0;i<len;i++){args[i]=arguments[i]}return this.map(plucker(args,len))};observableProto.flatMap=observableProto.selectMany=observableProto.mergeMap=function(selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).mergeAll()};observableProto.flatMapLatest=observableProto.switchMap=function(selector,resultSelector,thisArg){return new FlatMapObservable(this,selector,resultSelector,thisArg).switchLatest()};var SkipObservable=function(__super__){inherits(SkipObservable,__super__);function SkipObservable(source,count){this.source=source;this._count=count;__super__.call(this)}SkipObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipObserver(o,this._count))};function SkipObserver(o,c){this._o=o;this._r=c;AbstractObserver.call(this)}inherits(SkipObserver,AbstractObserver);SkipObserver.prototype.next=function(x){if(this._r<=0){this._o.onNext(x)}else{this._r--}};SkipObserver.prototype.error=function(e){this._o.onError(e)};SkipObserver.prototype.completed=function(){this._o.onCompleted()};return SkipObservable}(ObservableBase);observableProto.skip=function(count){if(count<0){throw new ArgumentOutOfRangeError}return new SkipObservable(this,count)};var SkipWhileObservable=function(__super__){inherits(SkipWhileObservable,__super__);function SkipWhileObservable(source,fn){this.source=source;this._fn=fn;__super__.call(this)}SkipWhileObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new SkipWhileObserver(o,this))};return SkipWhileObservable}(ObservableBase);var SkipWhileObserver=function(__super__){inherits(SkipWhileObserver,__super__);function SkipWhileObserver(o,p){this._o=o;this._p=p;this._i=0;this._r=false;__super__.call(this)}SkipWhileObserver.prototype.next=function(x){if(!this._r){var res=tryCatch(this._p._fn)(x,this._i++,this._p);if(res===errorObj){return this._o.onError(res.e)}this._r=!res}this._r&&this._o.onNext(x)};SkipWhileObserver.prototype.error=function(e){this._o.onError(e)};SkipWhileObserver.prototype.completed=function(){this._o.onCompleted()};return SkipWhileObserver}(AbstractObserver);observableProto.skipWhile=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new SkipWhileObservable(this,fn)};var TakeObservable=function(__super__){inherits(TakeObservable,__super__);function TakeObservable(source,count){this.source=source;this._count=count;__super__.call(this)}TakeObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TakeObserver(o,this._count))};function TakeObserver(o,c){this._o=o;this._c=c;this._r=c;AbstractObserver.call(this)}inherits(TakeObserver,AbstractObserver);TakeObserver.prototype.next=function(x){if(this._r-- >0){this._o.onNext(x);this._r<=0&&this._o.onCompleted()}};TakeObserver.prototype.error=function(e){this._o.onError(e)};TakeObserver.prototype.completed=function(){this._o.onCompleted()};return TakeObservable}(ObservableBase);observableProto.take=function(count,scheduler){if(count<0){throw new ArgumentOutOfRangeError}if(count===0){return observableEmpty(scheduler)}return new TakeObservable(this,count)};var TakeWhileObservable=function(__super__){inherits(TakeWhileObservable,__super__);function TakeWhileObservable(source,fn){this.source=source;this._fn=fn;__super__.call(this)}TakeWhileObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TakeWhileObserver(o,this))};return TakeWhileObservable}(ObservableBase);var TakeWhileObserver=function(__super__){inherits(TakeWhileObserver,__super__);function TakeWhileObserver(o,p){this._o=o;this._p=p;this._i=0;this._r=true;__super__.call(this)}TakeWhileObserver.prototype.next=function(x){if(this._r){this._r=tryCatch(this._p._fn)(x,this._i++,this._p);if(this._r===errorObj){return this._o.onError(this._r.e)}}if(this._r){this._o.onNext(x)}else{this._o.onCompleted()}};TakeWhileObserver.prototype.error=function(e){this._o.onError(e)};TakeWhileObserver.prototype.completed=function(){this._o.onCompleted()};return TakeWhileObserver}(AbstractObserver);observableProto.takeWhile=function(predicate,thisArg){var fn=bindCallback(predicate,thisArg,3);return new TakeWhileObservable(this,fn)};var FilterObservable=function(__super__){inherits(FilterObservable,__super__);function FilterObservable(source,predicate,thisArg){this.source=source;this.predicate=bindCallback(predicate,thisArg,3);__super__.call(this)}FilterObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new InnerObserver(o,this.predicate,this))};function innerPredicate(predicate,self){return function(x,i,o){return self.predicate(x,i,o)&&predicate.call(this,x,i,o)}}FilterObservable.prototype.internalFilter=function(predicate,thisArg){return new FilterObservable(this.source,innerPredicate(predicate,this),thisArg)};inherits(InnerObserver,AbstractObserver);function InnerObserver(o,predicate,source){this.o=o;this.predicate=predicate;this.source=source;this.i=0;AbstractObserver.call(this)}InnerObserver.prototype.next=function(x){var shouldYield=tryCatch(this.predicate)(x,this.i++,this.source);if(shouldYield===errorObj){return this.o.onError(shouldYield.e)}shouldYield&&this.o.onNext(x)};InnerObserver.prototype.error=function(e){this.o.onError(e)};InnerObserver.prototype.completed=function(){this.o.onCompleted()};return FilterObservable}(ObservableBase);observableProto.filter=observableProto.where=function(predicate,thisArg){return this instanceof FilterObservable?this.internalFilter(predicate,thisArg):new FilterObservable(this,predicate,thisArg)};function createCbObservable(fn,ctx,selector,args){var o=new AsyncSubject;args.push(createCbHandler(o,ctx,selector));fn.apply(ctx,args);return o.asObservable()}function createCbHandler(o,ctx,selector){return function handler(){var len=arguments.length,results=new Array(len);for(var i=0;i<len;i++){results[i]=arguments[i]}if(isFunction(selector)){results=tryCatch(selector).apply(ctx,results);if(results===errorObj){return o.onError(results.e)}o.onNext(results)}else{if(results.length<=1){o.onNext(results[0])}else{o.onNext(results)}}o.onCompleted()}}Observable.fromCallback=function(fn,ctx,selector){return function(){typeof ctx==="undefined"&&(ctx=this);var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return createCbObservable(fn,ctx,selector,args)}};function createNodeObservable(fn,ctx,selector,args){var o=new AsyncSubject;args.push(createNodeHandler(o,ctx,selector));fn.apply(ctx,args);return o.asObservable()}function createNodeHandler(o,ctx,selector){return function handler(){var err=arguments[0];if(err){return o.onError(err)}var len=arguments.length,results=[];for(var i=1;i<len;i++){results[i-1]=arguments[i]}if(isFunction(selector)){var results=tryCatch(selector).apply(ctx,results);if(results===errorObj){return o.onError(results.e)}o.onNext(results)}else{if(results.length<=1){o.onNext(results[0])}else{o.onNext(results)}}o.onCompleted()}}Observable.fromNodeCallback=function(fn,ctx,selector){return function(){typeof ctx==="undefined"&&(ctx=this);var len=arguments.length,args=new Array(len);for(var i=0;i<len;i++){args[i]=arguments[i]}return createNodeObservable(fn,ctx,selector,args)}};function isNodeList(el){if(root.StaticNodeList){return el instanceof root.StaticNodeList||el instanceof root.NodeList}else{return Object.prototype.toString.call(el)==="[object NodeList]"}}function ListenDisposable(e,n,fn){this._e=e;this._n=n;this._fn=fn;this._e.addEventListener(this._n,this._fn,false);this.isDisposed=false}ListenDisposable.prototype.dispose=function(){if(!this.isDisposed){this._e.removeEventListener(this._n,this._fn,false);this.isDisposed=true}};function createEventListener(el,eventName,handler){var disposables=new CompositeDisposable;var elemToString=Object.prototype.toString.call(el);if(isNodeList(el)||elemToString==="[object HTMLCollection]"){for(var i=0,len=el.length;i<len;i++){disposables.add(createEventListener(el.item(i),eventName,handler))}}else if(el){disposables.add(new ListenDisposable(el,eventName,handler))}return disposables}Rx.config.useNativeEvents=false;var EventObservable=function(__super__){inherits(EventObservable,__super__);function EventObservable(el,name,fn){this._el=el;this._n=name;this._fn=fn;__super__.call(this)}function createHandler(o,fn){return function handler(){var results=arguments[0];if(isFunction(fn)){results=tryCatch(fn).apply(null,arguments);if(results===errorObj){return o.onError(results.e)}}o.onNext(results)}}EventObservable.prototype.subscribeCore=function(o){return createEventListener(this._el,this._n,createHandler(o,this._fn))};return EventObservable}(ObservableBase);Observable.fromEvent=function(element,eventName,selector){if(element.addListener){return fromEventPattern(function(h){element.addListener(eventName,h)},function(h){element.removeListener(eventName,h)},selector)}if(!Rx.config.useNativeEvents){if(typeof element.on==="function"&&typeof element.off==="function"){return fromEventPattern(function(h){element.on(eventName,h)},function(h){element.off(eventName,h)},selector)}}return new EventObservable(element,eventName,selector).publish().refCount()};var EventPatternObservable=function(__super__){inherits(EventPatternObservable,__super__);function EventPatternObservable(add,del,fn){this._add=add;this._del=del;this._fn=fn;__super__.call(this)}function createHandler(o,fn){return function handler(){var results=arguments[0];if(isFunction(fn)){results=tryCatch(fn).apply(null,arguments);if(results===errorObj){return o.onError(results.e)}}o.onNext(results)}}EventPatternObservable.prototype.subscribeCore=function(o){var fn=createHandler(o,this._fn);var returnValue=this._add(fn);return new EventPatternDisposable(this._del,fn,returnValue)};function EventPatternDisposable(del,fn,ret){this._del=del;this._fn=fn;this._ret=ret;this.isDisposed=false}EventPatternDisposable.prototype.dispose=function(){if(!this.isDisposed){isFunction(this._del)&&this._del(this._fn,this._ret);this.isDisposed=true}};return EventPatternObservable}(ObservableBase);var fromEventPattern=Observable.fromEventPattern=function(addHandler,removeHandler,selector){return new EventPatternObservable(addHandler,removeHandler,selector).publish().refCount()};var FromPromiseObservable=function(__super__){inherits(FromPromiseObservable,__super__);function FromPromiseObservable(p,s){this._p=p;this._s=s;__super__.call(this)}function scheduleNext(s,state){var o=state[0],data=state[1];o.onNext(data);o.onCompleted()}function scheduleError(s,state){var o=state[0],err=state[1];o.onError(err)}FromPromiseObservable.prototype.subscribeCore=function(o){var sad=new SingleAssignmentDisposable,self=this,p=this._p;if(isFunction(p)){p=tryCatch(p)();if(p===errorObj){o.onError(p.e);return sad}}p.then(function(data){sad.setDisposable(self._s.schedule([o,data],scheduleNext))},function(err){sad.setDisposable(self._s.schedule([o,err],scheduleError))});return sad};return FromPromiseObservable}(ObservableBase);var observableFromPromise=Observable.fromPromise=function(promise,scheduler){scheduler||(scheduler=defaultScheduler);return new FromPromiseObservable(promise,scheduler)};observableProto.toPromise=function(promiseCtor){promiseCtor||(promiseCtor=Rx.config.Promise);if(!promiseCtor){throw new NotSupportedError("Promise type not provided nor in Rx.config.Promise")}var source=this;return new promiseCtor(function(resolve,reject){var value;source.subscribe(function(v){value=v},reject,function(){resolve(value)})})};Observable.startAsync=function(functionAsync){var promise=tryCatch(functionAsync)();if(promise===errorObj){return observableThrow(promise.e)}return observableFromPromise(promise)};var MulticastObservable=function(__super__){inherits(MulticastObservable,__super__);function MulticastObservable(source,fn1,fn2){this.source=source;this._fn1=fn1;this._fn2=fn2;__super__.call(this)}MulticastObservable.prototype.subscribeCore=function(o){var connectable=this.source.multicast(this._fn1());return new BinaryDisposable(this._fn2(connectable).subscribe(o),connectable.connect())};return MulticastObservable}(ObservableBase);observableProto.multicast=function(subjectOrSubjectSelector,selector){return isFunction(subjectOrSubjectSelector)?new MulticastObservable(this,subjectOrSubjectSelector,selector):new ConnectableObservable(this,subjectOrSubjectSelector)};observableProto.publish=function(selector){return selector&&isFunction(selector)?this.multicast(function(){return new Subject},selector):this.multicast(new Subject)};observableProto.share=function(){return this.publish().refCount()};observableProto.publishLast=function(selector){return selector&&isFunction(selector)?this.multicast(function(){return new AsyncSubject},selector):this.multicast(new AsyncSubject)};observableProto.publishValue=function(initialValueOrSelector,initialValue){return arguments.length===2?this.multicast(function(){return new BehaviorSubject(initialValue)},initialValueOrSelector):this.multicast(new BehaviorSubject(initialValueOrSelector))};observableProto.shareValue=function(initialValue){return this.publishValue(initialValue).refCount()};observableProto.replay=function(selector,bufferSize,windowSize,scheduler){return selector&&isFunction(selector)?this.multicast(function(){return new ReplaySubject(bufferSize,windowSize,scheduler)},selector):this.multicast(new ReplaySubject(bufferSize,windowSize,scheduler))};observableProto.shareReplay=function(bufferSize,windowSize,scheduler){return this.replay(null,bufferSize,windowSize,scheduler).refCount()};var RefCountObservable=function(__super__){inherits(RefCountObservable,__super__);function RefCountObservable(source){this.source=source;this._count=0;this._connectableSubscription=null;__super__.call(this)}RefCountObservable.prototype.subscribeCore=function(o){var subscription=this.source.subscribe(o);++this._count===1&&(this._connectableSubscription=this.source.connect());return new RefCountDisposable(this,subscription)};function RefCountDisposable(p,s){this._p=p;this._s=s;this.isDisposed=false}RefCountDisposable.prototype.dispose=function(){if(!this.isDisposed){this.isDisposed=true;this._s.dispose();--this._p._count===0&&this._p._connectableSubscription.dispose()}};return RefCountObservable}(ObservableBase);var ConnectableObservable=Rx.ConnectableObservable=function(__super__){inherits(ConnectableObservable,__super__);function ConnectableObservable(source,subject){this.source=source;this._connection=null;this._source=source.asObservable();this._subject=subject;__super__.call(this)}function ConnectDisposable(parent,subscription){this._p=parent;this._s=subscription}ConnectDisposable.prototype.dispose=function(){if(this._s){this._s.dispose();this._s=null;this._p._connection=null}};ConnectableObservable.prototype.connect=function(){if(!this._connection){if(this._subject.isStopped){return disposableEmpty}var subscription=this._source.subscribe(this._subject);this._connection=new ConnectDisposable(this,subscription)}return this._connection};ConnectableObservable.prototype._subscribe=function(o){return this._subject.subscribe(o)};ConnectableObservable.prototype.refCount=function(){return new RefCountObservable(this)};return ConnectableObservable}(Observable);var TimerObservable=function(__super__){inherits(TimerObservable,__super__);function TimerObservable(dt,s){this._dt=dt;this._s=s;__super__.call(this)}TimerObservable.prototype.subscribeCore=function(o){return this._s.scheduleFuture(o,this._dt,scheduleMethod)};function scheduleMethod(s,o){o.onNext(0);o.onCompleted()}return TimerObservable}(ObservableBase);function _observableTimer(dueTime,scheduler){return new TimerObservable(dueTime,scheduler)}function observableTimerDateAndPeriod(dueTime,period,scheduler){return new AnonymousObservable(function(observer){var d=dueTime,p=normalizeTime(period);return scheduler.scheduleRecursiveFuture(0,d,function(count,self){if(p>0){var now=scheduler.now();d=new Date(d.getTime()+p);d.getTime()<=now&&(d=new Date(now+p))}observer.onNext(count);self(count+1,new Date(d))})})}function observableTimerTimeSpanAndPeriod(dueTime,period,scheduler){return dueTime===period?new AnonymousObservable(function(observer){return scheduler.schedulePeriodic(0,period,function(count){observer.onNext(count);return count+1})}):observableDefer(function(){return observableTimerDateAndPeriod(new Date(scheduler.now()+dueTime),period,scheduler)})}var observableinterval=Observable.interval=function(period,scheduler){return observableTimerTimeSpanAndPeriod(period,period,isScheduler(scheduler)?scheduler:defaultScheduler)};var observableTimer=Observable.timer=function(dueTime,periodOrScheduler,scheduler){var period;isScheduler(scheduler)||(scheduler=defaultScheduler);if(periodOrScheduler!=null&&typeof periodOrScheduler==="number"){period=periodOrScheduler}else if(isScheduler(periodOrScheduler)){scheduler=periodOrScheduler}if((dueTime instanceof Date||typeof dueTime==="number")&&period===undefined){return _observableTimer(dueTime,scheduler)}if(dueTime instanceof Date&&period!==undefined){return observableTimerDateAndPeriod(dueTime,periodOrScheduler,scheduler)}return observableTimerTimeSpanAndPeriod(dueTime,period,scheduler)};function observableDelayRelative(source,dueTime,scheduler){return new AnonymousObservable(function(o){var active=false,cancelable=new SerialDisposable,exception=null,q=[],running=false,subscription;subscription=source.materialize().timestamp(scheduler).subscribe(function(notification){var d,shouldRun;if(notification.value.kind==="E"){q=[];q.push(notification);exception=notification.value.error;shouldRun=!running}else{q.push({value:notification.value,timestamp:notification.timestamp+dueTime});shouldRun=!active;active=true}if(shouldRun){if(exception!==null){o.onError(exception)}else{d=new SingleAssignmentDisposable;cancelable.setDisposable(d);d.setDisposable(scheduler.scheduleRecursiveFuture(null,dueTime,function(_,self){var e,recurseDueTime,result,shouldRecurse;if(exception!==null){return}running=true;do{result=null;if(q.length>0&&q[0].timestamp-scheduler.now()<=0){result=q.shift().value}if(result!==null){result.accept(o)}}while(result!==null);shouldRecurse=false;recurseDueTime=0;if(q.length>0){shouldRecurse=true;recurseDueTime=Math.max(0,q[0].timestamp-scheduler.now())}else{active=false}e=exception;running=false;if(e!==null){o.onError(e)}else if(shouldRecurse){self(null,recurseDueTime)}}))}}});return new BinaryDisposable(subscription,cancelable)},source)}function observableDelayAbsolute(source,dueTime,scheduler){return observableDefer(function(){return observableDelayRelative(source,dueTime-scheduler.now(),scheduler)})}function delayWithSelector(source,subscriptionDelay,delayDurationSelector){var subDelay,selector;if(isFunction(subscriptionDelay)){selector=subscriptionDelay}else{subDelay=subscriptionDelay;selector=delayDurationSelector}return new AnonymousObservable(function(o){var delays=new CompositeDisposable,atEnd=false,subscription=new SerialDisposable;function start(){subscription.setDisposable(source.subscribe(function(x){var delay=tryCatch(selector)(x);if(delay===errorObj){return o.onError(delay.e)}var d=new SingleAssignmentDisposable;delays.add(d);d.setDisposable(delay.subscribe(function(){o.onNext(x);delays.remove(d);done()},function(e){o.onError(e)},function(){o.onNext(x);delays.remove(d);done()}))},function(e){o.onError(e)},function(){atEnd=true;subscription.dispose();done()}))}function done(){atEnd&&delays.length===0&&o.onCompleted()}if(!subDelay){start()}else{subscription.setDisposable(subDelay.subscribe(start,function(e){o.onError(e)},start))}return new BinaryDisposable(subscription,delays)},source)}observableProto.delay=function(){var firstArg=arguments[0];if(typeof firstArg==="number"||firstArg instanceof Date){var dueTime=firstArg,scheduler=arguments[1];isScheduler(scheduler)||(scheduler=defaultScheduler);return dueTime instanceof Date?observableDelayAbsolute(this,dueTime,scheduler):observableDelayRelative(this,dueTime,scheduler)}else if(Observable.isObservable(firstArg)||isFunction(firstArg)){return delayWithSelector(this,firstArg,arguments[1])}else{throw new Error("Invalid arguments")}};var DebounceObservable=function(__super__){inherits(DebounceObservable,__super__);function DebounceObservable(source,dt,s){isScheduler(s)||(s=defaultScheduler);this.source=source;this._dt=dt;this._s=s;__super__.call(this)}DebounceObservable.prototype.subscribeCore=function(o){var cancelable=new SerialDisposable;return new BinaryDisposable(this.source.subscribe(new DebounceObserver(o,this._dt,this._s,cancelable)),cancelable)};return DebounceObservable}(ObservableBase);var DebounceObserver=function(__super__){inherits(DebounceObserver,__super__);function DebounceObserver(observer,dueTime,scheduler,cancelable){this._o=observer;this._d=dueTime;this._scheduler=scheduler;this._c=cancelable;this._v=null;this._hv=false;this._id=0;__super__.call(this)}function scheduleFuture(s,state){state.self._hv&&state.self._id===state.currentId&&state.self._o.onNext(state.x);state.self._hv=false}DebounceObserver.prototype.next=function(x){this._hv=true;this._v=x;var currentId=++this._id,d=new SingleAssignmentDisposable;this._c.setDisposable(d);d.setDisposable(this._scheduler.scheduleFuture(this,this._d,function(_,self){self._hv&&self._id===currentId&&self._o.onNext(x);self._hv=false}))};DebounceObserver.prototype.error=function(e){this._c.dispose();this._o.onError(e);this._hv=false;this._id++};DebounceObserver.prototype.completed=function(){this._c.dispose();this._hv&&this._o.onNext(this._v);this._o.onCompleted();this._hv=false;this._id++};return DebounceObserver}(AbstractObserver);function debounceWithSelector(source,durationSelector){return new AnonymousObservable(function(o){var value,hasValue=false,cancelable=new SerialDisposable,id=0;var subscription=source.subscribe(function(x){var throttle=tryCatch(durationSelector)(x);if(throttle===errorObj){return o.onError(throttle.e)}isPromise(throttle)&&(throttle=observableFromPromise(throttle));hasValue=true;value=x;id++;var currentid=id,d=new SingleAssignmentDisposable;cancelable.setDisposable(d);d.setDisposable(throttle.subscribe(function(){hasValue&&id===currentid&&o.onNext(value);hasValue=false;d.dispose()},function(e){o.onError(e)},function(){hasValue&&id===currentid&&o.onNext(value);hasValue=false;d.dispose()}))},function(e){cancelable.dispose();o.onError(e);hasValue=false;id++},function(){cancelable.dispose();hasValue&&o.onNext(value);o.onCompleted();hasValue=false;id++});return new BinaryDisposable(subscription,cancelable)},source)}observableProto.debounce=function(){if(isFunction(arguments[0])){return debounceWithSelector(this,arguments[0])}else if(typeof arguments[0]==="number"){return new DebounceObservable(this,arguments[0],arguments[1])}else{throw new Error("Invalid arguments")}};var TimestampObservable=function(__super__){inherits(TimestampObservable,__super__);function TimestampObservable(source,s){this.source=source;this._s=s;__super__.call(this)}TimestampObservable.prototype.subscribeCore=function(o){return this.source.subscribe(new TimestampObserver(o,this._s))};return TimestampObservable}(ObservableBase);var TimestampObserver=function(__super__){inherits(TimestampObserver,__super__);function TimestampObserver(o,s){this._o=o;this._s=s;__super__.call(this)}TimestampObserver.prototype.next=function(x){this._o.onNext({value:x,timestamp:this._s.now()})};TimestampObserver.prototype.error=function(e){this._o.onError(e)};TimestampObserver.prototype.completed=function(){this._o.onCompleted()};return TimestampObserver}(AbstractObserver);observableProto.timestamp=function(scheduler){isScheduler(scheduler)||(scheduler=defaultScheduler);return new TimestampObservable(this,scheduler)};var SampleObservable=function(__super__){inherits(SampleObservable,__super__);function SampleObservable(source,sampler){this.source=source;this._sampler=sampler;__super__.call(this)}SampleObservable.prototype.subscribeCore=function(o){var state={o:o,atEnd:false,value:null,hasValue:false,sourceSubscription:new SingleAssignmentDisposable};state.sourceSubscription.setDisposable(this.source.subscribe(new SampleSourceObserver(state)));return new BinaryDisposable(state.sourceSubscription,this._sampler.subscribe(new SamplerObserver(state)))};return SampleObservable}(ObservableBase);var SamplerObserver=function(__super__){inherits(SamplerObserver,__super__);function SamplerObserver(s){this._s=s;__super__.call(this)}SamplerObserver.prototype._handleMessage=function(){if(this._s.hasValue){this._s.hasValue=false;this._s.o.onNext(this._s.value)}this._s.atEnd&&this._s.o.onCompleted()};SamplerObserver.prototype.next=function(){this._handleMessage()};SamplerObserver.prototype.error=function(e){this._s.onError(e)};SamplerObserver.prototype.completed=function(){this._handleMessage()};return SamplerObserver}(AbstractObserver);var SampleSourceObserver=function(__super__){inherits(SampleSourceObserver,__super__);function SampleSourceObserver(s){this._s=s;__super__.call(this)}SampleSourceObserver.prototype.next=function(x){this._s.hasValue=true;this._s.value=x};SampleSourceObserver.prototype.error=function(e){this._s.o.onError(e)};SampleSourceObserver.prototype.completed=function(){this._s.atEnd=true;this._s.sourceSubscription.dispose()};return SampleSourceObserver}(AbstractObserver);observableProto.sample=function(intervalOrSampler,scheduler){isScheduler(scheduler)||(scheduler=defaultScheduler);return typeof intervalOrSampler==="number"?new SampleObservable(this,observableinterval(intervalOrSampler,scheduler)):new SampleObservable(this,intervalOrSampler)};var TimeoutError=Rx.TimeoutError=function(message){this.message=message||"Timeout has occurred";this.name="TimeoutError";Error.call(this)};TimeoutError.prototype=Object.create(Error.prototype);function timeoutWithSelector(source,firstTimeout,timeoutDurationSelector,other){if(isFunction(firstTimeout)){other=timeoutDurationSelector;timeoutDurationSelector=firstTimeout;firstTimeout=observableNever()}Observable.isObservable(other)||(other=observableThrow(new TimeoutError));return new AnonymousObservable(function(o){var subscription=new SerialDisposable,timer=new SerialDisposable,original=new SingleAssignmentDisposable;subscription.setDisposable(original);var id=0,switched=false;function setTimer(timeout){var myId=id,d=new SingleAssignmentDisposable;function timerWins(){switched=myId===id;return switched}timer.setDisposable(d);d.setDisposable(timeout.subscribe(function(){timerWins()&&subscription.setDisposable(other.subscribe(o));d.dispose()},function(e){timerWins()&&o.onError(e)},function(){timerWins()&&subscription.setDisposable(other.subscribe(o))}))}setTimer(firstTimeout);function oWins(){var res=!switched;if(res){id++}return res}original.setDisposable(source.subscribe(function(x){if(oWins()){o.onNext(x);var timeout=tryCatch(timeoutDurationSelector)(x);if(timeout===errorObj){return o.onError(timeout.e)}setTimer(isPromise(timeout)?observableFromPromise(timeout):timeout)}},function(e){oWins()&&o.onError(e)},function(){oWins()&&o.onCompleted()}));return new BinaryDisposable(subscription,timer)},source)}function timeout(source,dueTime,other,scheduler){if(isScheduler(other)){scheduler=other;other=observableThrow(new TimeoutError)}if(other instanceof Error){other=observableThrow(other)}isScheduler(scheduler)||(scheduler=defaultScheduler);Observable.isObservable(other)||(other=observableThrow(new TimeoutError));return new AnonymousObservable(function(o){var id=0,original=new SingleAssignmentDisposable,subscription=new SerialDisposable,switched=false,timer=new SerialDisposable;subscription.setDisposable(original);function createTimer(){var myId=id;timer.setDisposable(scheduler.scheduleFuture(null,dueTime,function(){switched=id===myId;if(switched){isPromise(other)&&(other=observableFromPromise(other));subscription.setDisposable(other.subscribe(o))}}))}createTimer();original.setDisposable(source.subscribe(function(x){if(!switched){id++;o.onNext(x);createTimer()}},function(e){if(!switched){id++;o.onError(e)}},function(){if(!switched){id++;o.onCompleted()}}));return new BinaryDisposable(subscription,timer)},source)}observableProto.timeout=function(){var firstArg=arguments[0];if(firstArg instanceof Date||typeof firstArg==="number"){return timeout(this,firstArg,arguments[1],arguments[2])}else if(Observable.isObservable(firstArg)||isFunction(firstArg)){return timeoutWithSelector(this,firstArg,arguments[1],arguments[2])}else{throw new Error("Invalid arguments")}};observableProto.throttle=function(windowDuration,scheduler){isScheduler(scheduler)||(scheduler=defaultScheduler);var duration=+windowDuration||0;if(duration<=0){throw new RangeError("windowDuration cannot be less or equal zero.")}var source=this;return new AnonymousObservable(function(o){var lastOnNext=0;return source.subscribe(function(x){var now=scheduler.now();if(lastOnNext===0||now-lastOnNext>=duration){lastOnNext=now;o.onNext(x)}},function(e){o.onError(e)},function(){o.onCompleted()})},source)};var PausableObservable=function(__super__){inherits(PausableObservable,__super__);function PausableObservable(source,pauser){this.source=source;this.controller=new Subject;this.paused=true;if(pauser&&pauser.subscribe){this.pauser=this.controller.merge(pauser)}else{this.pauser=this.controller}__super__.call(this)}PausableObservable.prototype._subscribe=function(o){var conn=this.source.publish(),subscription=conn.subscribe(o),connection=disposableEmpty;var pausable=this.pauser.startWith(!this.paused).distinctUntilChanged().subscribe(function(b){if(b){connection=conn.connect()}else{connection.dispose();connection=disposableEmpty}});return new NAryDisposable([subscription,connection,pausable])};PausableObservable.prototype.pause=function(){this.paused=true;this.controller.onNext(false)};PausableObservable.prototype.resume=function(){this.paused=false;this.controller.onNext(true)};return PausableObservable}(Observable);observableProto.pausable=function(pauser){return new PausableObservable(this,pauser)};function combineLatestSource(source,subject,resultSelector){return new AnonymousObservable(function(o){var hasValue=[false,false],hasValueAll=false,isDone=false,values=new Array(2),err;function next(x,i){values[i]=x;hasValue[i]=true;if(hasValueAll||(hasValueAll=hasValue.every(identity))){if(err){return o.onError(err)}var res=tryCatch(resultSelector).apply(null,values);if(res===errorObj){return o.onError(res.e)}o.onNext(res)}isDone&&values[1]&&o.onCompleted()}return new BinaryDisposable(source.subscribe(function(x){next(x,0)},function(e){if(values[1]){o.onError(e)}else{err=e}},function(){isDone=true;values[1]&&o.onCompleted()}),subject.subscribe(function(x){next(x,1)},function(e){o.onError(e)},function(){isDone=true;next(true,1)}))},source)}var PausableBufferedObservable=function(__super__){inherits(PausableBufferedObservable,__super__);function PausableBufferedObservable(source,pauser){this.source=source;this.controller=new Subject;this.paused=true;if(pauser&&pauser.subscribe){this.pauser=this.controller.merge(pauser)}else{this.pauser=this.controller}__super__.call(this)}PausableBufferedObservable.prototype._subscribe=function(o){var q=[],previousShouldFire;function drainQueue(){while(q.length>0){o.onNext(q.shift())}}var subscription=combineLatestSource(this.source,this.pauser.startWith(!this.paused).distinctUntilChanged(),function(data,shouldFire){return{data:data,shouldFire:shouldFire}}).subscribe(function(results){if(previousShouldFire!==undefined&&results.shouldFire!==previousShouldFire){previousShouldFire=results.shouldFire;if(results.shouldFire){drainQueue()}}else{previousShouldFire=results.shouldFire;if(results.shouldFire){o.onNext(results.data)}else{q.push(results.data)}}},function(err){drainQueue();o.onError(err)},function(){drainQueue();o.onCompleted()});return subscription};PausableBufferedObservable.prototype.pause=function(){this.paused=true;this.controller.onNext(false)};PausableBufferedObservable.prototype.resume=function(){this.paused=false;this.controller.onNext(true)};return PausableBufferedObservable}(Observable);observableProto.pausableBuffered=function(pauser){return new PausableBufferedObservable(this,pauser)};var ControlledObservable=function(__super__){inherits(ControlledObservable,__super__);function ControlledObservable(source,enableQueue,scheduler){__super__.call(this);this.subject=new ControlledSubject(enableQueue,scheduler);this.source=source.multicast(this.subject).refCount()}ControlledObservable.prototype._subscribe=function(o){return this.source.subscribe(o)};ControlledObservable.prototype.request=function(numberOfItems){return this.subject.request(numberOfItems==null?-1:numberOfItems)};return ControlledObservable}(Observable);var ControlledSubject=function(__super__){inherits(ControlledSubject,__super__);function ControlledSubject(enableQueue,scheduler){enableQueue==null&&(enableQueue=true);__super__.call(this);this.subject=new Subject;this.enableQueue=enableQueue;this.queue=enableQueue?[]:null;this.requestedCount=0;this.requestedDisposable=null;this.error=null;this.hasFailed=false;this.hasCompleted=false;this.scheduler=scheduler||currentThreadScheduler}addProperties(ControlledSubject.prototype,Observer,{_subscribe:function(o){return this.subject.subscribe(o)},onCompleted:function(){this.hasCompleted=true;if(!this.enableQueue||this.queue.length===0){this.subject.onCompleted();this.disposeCurrentRequest()}else{this.queue.push(Notification.createOnCompleted())}},onError:function(error){this.hasFailed=true;this.error=error;if(!this.enableQueue||this.queue.length===0){this.subject.onError(error);this.disposeCurrentRequest()}else{this.queue.push(Notification.createOnError(error))}},onNext:function(value){if(this.requestedCount<=0){this.enableQueue&&this.queue.push(Notification.createOnNext(value))}else{this.requestedCount--===0&&this.disposeCurrentRequest();this.subject.onNext(value)}},_processRequest:function(numberOfItems){if(this.enableQueue){while(this.queue.length>0&&(numberOfItems>0||this.queue[0].kind!=="N")){var first=this.queue.shift();first.accept(this.subject);if(first.kind==="N"){numberOfItems--}else{this.disposeCurrentRequest();this.queue=[]}}}return numberOfItems},request:function(number){this.disposeCurrentRequest();var self=this;this.requestedDisposable=this.scheduler.schedule(number,function(s,i){var remaining=self._processRequest(i);var stopped=self.hasCompleted||self.hasFailed;if(!stopped&&remaining>0){self.requestedCount=remaining;return disposableCreate(function(){self.requestedCount=0})}});return this.requestedDisposable},disposeCurrentRequest:function(){if(this.requestedDisposable){this.requestedDisposable.dispose();this.requestedDisposable=null}}});return ControlledSubject}(Observable);observableProto.controlled=function(enableQueue,scheduler){if(enableQueue&&isScheduler(enableQueue)){scheduler=enableQueue;enableQueue=true}if(enableQueue==null){enableQueue=true}return new ControlledObservable(this,enableQueue,scheduler)};observableProto.pipe=function(dest){var source=this.pausableBuffered();function onDrain(){source.resume()}dest.addListener("drain",onDrain);source.subscribe(function(x){!dest.write(x)&&source.pause()},function(err){dest.emit("error",err)},function(){!dest._isStdio&&dest.end();dest.removeListener("drain",onDrain)});source.resume();return dest};var TransduceObserver=function(__super__){inherits(TransduceObserver,__super__);function TransduceObserver(o,xform){this._o=o;this._xform=xform;__super__.call(this)}TransduceObserver.prototype.next=function(x){var res=tryCatch(this._xform["@@transducer/step"]).call(this._xform,this._o,x);if(res===errorObj){this._o.onError(res.e)}};TransduceObserver.prototype.error=function(e){this._o.onError(e)};TransduceObserver.prototype.completed=function(){this._xform["@@transducer/result"](this._o)};return TransduceObserver}(AbstractObserver);function transformForObserver(o){return{"@@transducer/init":function(){return o},"@@transducer/step":function(obs,input){return obs.onNext(input)},"@@transducer/result":function(obs){return obs.onCompleted()}}}observableProto.transduce=function(transducer){var source=this;return new AnonymousObservable(function(o){var xform=transducer(transformForObserver(o));return source.subscribe(new TransduceObserver(o,xform))},source)};var AnonymousObservable=Rx.AnonymousObservable=function(__super__){inherits(AnonymousObservable,__super__);function fixSubscriber(subscriber){return subscriber&&isFunction(subscriber.dispose)?subscriber:isFunction(subscriber)?disposableCreate(subscriber):disposableEmpty}function setDisposable(s,state){var ado=state[0],self=state[1];var sub=tryCatch(self.__subscribe).call(self,ado);if(sub===errorObj&&!ado.fail(errorObj.e)){thrower(errorObj.e)}ado.setDisposable(fixSubscriber(sub))}function AnonymousObservable(subscribe,parent){this.source=parent;this.__subscribe=subscribe;__super__.call(this)}AnonymousObservable.prototype._subscribe=function(o){var ado=new AutoDetachObserver(o),state=[ado,this];if(currentThreadScheduler.scheduleRequired()){currentThreadScheduler.schedule(state,setDisposable)}else{setDisposable(null,state)}return ado};return AnonymousObservable}(Observable);var AutoDetachObserver=function(__super__){inherits(AutoDetachObserver,__super__);function AutoDetachObserver(observer){__super__.call(this);this.observer=observer;this.m=new SingleAssignmentDisposable}var AutoDetachObserverPrototype=AutoDetachObserver.prototype;AutoDetachObserverPrototype.next=function(value){var result=tryCatch(this.observer.onNext).call(this.observer,value);if(result===errorObj){this.dispose();thrower(result.e)}};AutoDetachObserverPrototype.error=function(err){var result=tryCatch(this.observer.onError).call(this.observer,err);this.dispose();result===errorObj&&thrower(result.e)};AutoDetachObserverPrototype.completed=function(){var result=tryCatch(this.observer.onCompleted).call(this.observer);this.dispose();result===errorObj&&thrower(result.e)};AutoDetachObserverPrototype.setDisposable=function(value){this.m.setDisposable(value)};AutoDetachObserverPrototype.getDisposable=function(){return this.m.getDisposable()};AutoDetachObserverPrototype.dispose=function(){__super__.prototype.dispose.call(this);this.m.dispose()};return AutoDetachObserver}(AbstractObserver);var InnerSubscription=function(s,o){this._s=s;this._o=o};InnerSubscription.prototype.dispose=function(){if(!this._s.isDisposed&&this._o!==null){var idx=this._s.observers.indexOf(this._o);this._s.observers.splice(idx,1);this._o=null}};var Subject=Rx.Subject=function(__super__){inherits(Subject,__super__);function Subject(){__super__.call(this);this.isDisposed=false;this.isStopped=false;this.observers=[];this.hasError=false}addProperties(Subject.prototype,Observer.prototype,{_subscribe:function(o){checkDisposed(this);if(!this.isStopped){this.observers.push(o);return new InnerSubscription(this,o)}if(this.hasError){o.onError(this.error);return disposableEmpty}o.onCompleted();return disposableEmpty},hasObservers:function(){checkDisposed(this);return this.observers.length>0},onCompleted:function(){checkDisposed(this);if(!this.isStopped){this.isStopped=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onCompleted()}this.observers.length=0}},onError:function(error){checkDisposed(this);if(!this.isStopped){this.isStopped=true;this.error=error;this.hasError=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0}},onNext:function(value){checkDisposed(this);if(!this.isStopped){for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onNext(value)}}},dispose:function(){this.isDisposed=true;this.observers=null}});Subject.create=function(observer,observable){return new AnonymousSubject(observer,observable)};return Subject}(Observable);var AsyncSubject=Rx.AsyncSubject=function(__super__){inherits(AsyncSubject,__super__);function AsyncSubject(){__super__.call(this);this.isDisposed=false;this.isStopped=false;this.hasValue=false;this.observers=[];this.hasError=false}addProperties(AsyncSubject.prototype,Observer.prototype,{_subscribe:function(o){checkDisposed(this);if(!this.isStopped){this.observers.push(o);return new InnerSubscription(this,o)}if(this.hasError){o.onError(this.error)}else if(this.hasValue){o.onNext(this.value);o.onCompleted()}else{o.onCompleted()}return disposableEmpty},hasObservers:function(){checkDisposed(this);return this.observers.length>0},onCompleted:function(){var i,len;checkDisposed(this);if(!this.isStopped){this.isStopped=true;var os=cloneArray(this.observers),len=os.length;if(this.hasValue){for(i=0;i<len;i++){var o=os[i];o.onNext(this.value);o.onCompleted()}}else{for(i=0;i<len;i++){os[i].onCompleted()}}this.observers.length=0}},onError:function(error){checkDisposed(this);if(!this.isStopped){this.isStopped=true;this.hasError=true;this.error=error;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0}},onNext:function(value){checkDisposed(this);if(this.isStopped){return}this.value=value;this.hasValue=true},dispose:function(){this.isDisposed=true;this.observers=null;this.error=null;this.value=null}});return AsyncSubject}(Observable);var AnonymousSubject=Rx.AnonymousSubject=function(__super__){inherits(AnonymousSubject,__super__);function AnonymousSubject(observer,observable){this.observer=observer;this.observable=observable;__super__.call(this)}addProperties(AnonymousSubject.prototype,Observer.prototype,{_subscribe:function(o){return this.observable.subscribe(o)},onCompleted:function(){this.observer.onCompleted()},onError:function(error){this.observer.onError(error)},onNext:function(value){this.observer.onNext(value)}});return AnonymousSubject}(Observable);var BehaviorSubject=Rx.BehaviorSubject=function(__super__){inherits(BehaviorSubject,__super__);function BehaviorSubject(value){__super__.call(this);this.value=value;this.observers=[];this.isDisposed=false;this.isStopped=false;this.hasError=false}addProperties(BehaviorSubject.prototype,Observer.prototype,{_subscribe:function(o){checkDisposed(this);if(!this.isStopped){this.observers.push(o);o.onNext(this.value);return new InnerSubscription(this,o)}if(this.hasError){o.onError(this.error)}else{o.onCompleted()}return disposableEmpty},getValue:function(){checkDisposed(this);if(this.hasError){thrower(this.error)}return this.value},hasObservers:function(){checkDisposed(this);return this.observers.length>0},onCompleted:function(){checkDisposed(this);if(this.isStopped){return}this.isStopped=true;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onCompleted()}this.observers.length=0},onError:function(error){checkDisposed(this);if(this.isStopped){return}this.isStopped=true;this.hasError=true;this.error=error;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onError(error)}this.observers.length=0},onNext:function(value){checkDisposed(this);if(this.isStopped){return}this.value=value;for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){os[i].onNext(value)}},dispose:function(){this.isDisposed=true;this.observers=null;this.value=null;this.error=null}});return BehaviorSubject}(Observable);var ReplaySubject=Rx.ReplaySubject=function(__super__){var maxSafeInteger=Math.pow(2,53)-1;function createRemovableDisposable(subject,observer){return disposableCreate(function(){observer.dispose();!subject.isDisposed&&subject.observers.splice(subject.observers.indexOf(observer),1)})}inherits(ReplaySubject,__super__);function ReplaySubject(bufferSize,windowSize,scheduler){this.bufferSize=bufferSize==null?maxSafeInteger:bufferSize;this.windowSize=windowSize==null?maxSafeInteger:windowSize;this.scheduler=scheduler||currentThreadScheduler;this.q=[];this.observers=[];this.isStopped=false;this.isDisposed=false;this.hasError=false;this.error=null;__super__.call(this)}addProperties(ReplaySubject.prototype,Observer.prototype,{_subscribe:function(o){checkDisposed(this);var so=new ScheduledObserver(this.scheduler,o),subscription=createRemovableDisposable(this,so);this._trim(this.scheduler.now());this.observers.push(so);for(var i=0,len=this.q.length;i<len;i++){so.onNext(this.q[i].value)}if(this.hasError){so.onError(this.error)}else if(this.isStopped){so.onCompleted()}so.ensureActive();return subscription},hasObservers:function(){checkDisposed(this);return this.observers.length>0},_trim:function(now){while(this.q.length>this.bufferSize){this.q.shift()}while(this.q.length>0&&now-this.q[0].interval>this.windowSize){this.q.shift()}},onNext:function(value){checkDisposed(this);if(this.isStopped){return}var now=this.scheduler.now();this.q.push({interval:now,value:value});this._trim(now);for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){var observer=os[i];observer.onNext(value);observer.ensureActive()}},onError:function(error){checkDisposed(this);if(this.isStopped){return}this.isStopped=true;this.error=error;this.hasError=true;var now=this.scheduler.now();this._trim(now);for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){var observer=os[i];observer.onError(error);observer.ensureActive()}this.observers.length=0},onCompleted:function(){checkDisposed(this);if(this.isStopped){return}this.isStopped=true;var now=this.scheduler.now();this._trim(now);for(var i=0,os=cloneArray(this.observers),len=os.length;i<len;i++){var observer=os[i];observer.onCompleted();observer.ensureActive()}this.observers.length=0},dispose:function(){this.isDisposed=true;this.observers=null}});return ReplaySubject}(Observable);Rx.Pauser=function(__super__){inherits(Pauser,__super__);function Pauser(){__super__.call(this)}Pauser.prototype.pause=function(){this.onNext(false)};Pauser.prototype.resume=function(){this.onNext(true)};return Pauser}(Subject);__LMtarget.Rx=Rx;var rEndingLine=captureLine()}).call(this,__LiteMolRxTemp,__LiteMolPromise);var __LiteMolRx=__LiteMolRxTemp.Rx;var CIFTools;(function(CIFTools){CIFTools.VERSION={number:"1.1.6",date:"June 26 2017"}})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Utils;(function(Utils){var ChunkedArray;(function(ChunkedArray){function is(x){return x.creator&&x.chunkSize}ChunkedArray.is=is;function add4(array,x,y,z,w){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;array.current[array.currentIndex++]=z;array.current[array.currentIndex++]=w;return array.elementCount++}ChunkedArray.add4=add4;function add3(array,x,y,z){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;array.current[array.currentIndex++]=z;return array.elementCount++}ChunkedArray.add3=add3;function add2(array,x,y){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;return array.elementCount++}ChunkedArray.add2=add2;function add(array,x){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;return array.elementCount++}ChunkedArray.add=add;function compact(array){var ret=array.creator(array.elementSize*array.elementCount),offset=(array.parts.length-1)*array.chunkSize,offsetInner=0,part;if(array.parts.length>1){if(array.parts[0].buffer){for(var i=0;i<array.parts.length-1;i++){ret.set(array.parts[i],array.chunkSize*i)}}else{for(var i=0;i<array.parts.length-1;i++){offsetInner=array.chunkSize*i;part=array.parts[i];for(var j=0;j<array.chunkSize;j++){ret[offsetInner+j]=part[j]}}}}if(array.current.buffer&&array.currentIndex>=array.chunkSize){ret.set(array.current,array.chunkSize*(array.parts.length-1))}else{for(var i=0;i<array.currentIndex;i++){ret[offset+i]=array.current[i]}}return ret}ChunkedArray.compact=compact;function forVertex3D(chunkVertexCount){if(chunkVertexCount===void 0){chunkVertexCount=262144}return create(function(size){return new Float32Array(size)},chunkVertexCount,3)}ChunkedArray.forVertex3D=forVertex3D;function forIndexBuffer(chunkIndexCount){if(chunkIndexCount===void 0){chunkIndexCount=262144}return create(function(size){return new Uint32Array(size)},chunkIndexCount,3)}ChunkedArray.forIndexBuffer=forIndexBuffer;function forTokenIndices(chunkTokenCount){if(chunkTokenCount===void 0){chunkTokenCount=131072}return create(function(size){return new Int32Array(size)},chunkTokenCount,2)}ChunkedArray.forTokenIndices=forTokenIndices;function forIndices(chunkTokenCount){if(chunkTokenCount===void 0){chunkTokenCount=131072}return create(function(size){return new Int32Array(size)},chunkTokenCount,1)}ChunkedArray.forIndices=forIndices;function forInt32(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return new Int32Array(size)},chunkSize,1)}ChunkedArray.forInt32=forInt32;function forFloat32(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return new Float32Array(size)},chunkSize,1)}ChunkedArray.forFloat32=forFloat32;function forArray(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return[]},chunkSize,1)}ChunkedArray.forArray=forArray;function create(creator,chunkElementCount,elementSize){chunkElementCount=chunkElementCount|0;if(chunkElementCount<=0)chunkElementCount=1;var chunkSize=chunkElementCount*elementSize;var current=creator(chunkSize);return{elementSize:elementSize,chunkSize:chunkSize,creator:creator,current:current,parts:[current],currentIndex:0,elementCount:0}}ChunkedArray.create=create})(ChunkedArray=Utils.ChunkedArray||(Utils.ChunkedArray={}))})(Utils=CIFTools.Utils||(CIFTools.Utils={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Utils;(function(Utils){var FastNumberParsers;(function(FastNumberParsers){"use strict";function parseIntSkipTrailingWhitespace(str,start,end){while(start<end&&str.charCodeAt(start)===32)start++;return parseInt(str,start,end)}FastNumberParsers.parseIntSkipTrailingWhitespace=parseIntSkipTrailingWhitespace;function parseInt(str,start,end){var ret=0,neg=1;if(str.charCodeAt(start)===45){neg=-1;start++}for(;start<end;start++){var c=str.charCodeAt(start)-48;if(c>9||c<0)return neg*ret|0;else ret=10*ret+c|0}return neg*ret}FastNumberParsers.parseInt=parseInt;function parseScientific(main,str,start,end){if(str.charCodeAt(start)===43)start++;return main*Math.pow(10,parseInt(str,start,end))}function parseFloatSkipTrailingWhitespace(str,start,end){while(start<end&&str.charCodeAt(start)===32)start++;return parseFloat(str,start,end)}FastNumberParsers.parseFloatSkipTrailingWhitespace=parseFloatSkipTrailingWhitespace;function parseFloat(str,start,end){var neg=1,ret=0,point=0,div=1;if(str.charCodeAt(start)===45){neg=-1;++start}while(start<end){var c=str.charCodeAt(start)-48;if(c>=0&&c<10){ret=ret*10+c;++start}else if(c===-2){++start;while(start<end){c=str.charCodeAt(start)-48;if(c>=0&&c<10){point=10*point+c;div=10*div;++start}else if(c===53||c===21){return parseScientific(neg*(ret+point/div),str,start+1,end)}else{return neg*(ret+point/div)}}return neg*(ret+point/div)}else if(c===53||c===21){return parseScientific(neg*ret,str,start+1,end)}else break}return neg*ret}FastNumberParsers.parseFloat=parseFloat})(FastNumberParsers=Utils.FastNumberParsers||(Utils.FastNumberParsers={}))})(Utils=CIFTools.Utils||(CIFTools.Utils={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Utils;(function(Utils){var __paddingSpaces=[];(function(){var s="";for(var i=0;i<512;i++){__paddingSpaces[i]=s;s=s+" "}})();var StringWriter;(function(StringWriter){function create(chunkCapacity){if(chunkCapacity===void 0){chunkCapacity=512}return{chunkData:[],chunkOffset:0,chunkCapacity:chunkCapacity,data:[]}}StringWriter.create=create;function asString(writer){if(!writer.data.length){if(writer.chunkData.length===writer.chunkOffset)return writer.chunkData.join("");return writer.chunkData.splice(0,writer.chunkOffset).join("")}if(writer.chunkOffset>0){writer.data[writer.data.length]=writer.chunkData.splice(0,writer.chunkOffset).join("")}return writer.data.join("")}StringWriter.asString=asString;function writeTo(writer,stream){finalize(writer);for(var _i=0,_a=writer.data;_i<_a.length;_i++){var s=_a[_i];stream.writeString(s)}}StringWriter.writeTo=writeTo;function finalize(writer){if(writer.chunkOffset>0){if(writer.chunkData.length===writer.chunkOffset)writer.data[writer.data.length]=writer.chunkData.join("");else writer.data[writer.data.length]=writer.chunkData.splice(0,writer.chunkOffset).join("");writer.chunkOffset=0}}function newline(writer){write(writer,"\n")}StringWriter.newline=newline;function whitespace(writer,len){write(writer,__paddingSpaces[len])}StringWriter.whitespace=whitespace;function write(writer,val){if(val===undefined||val===null){return}if(writer.chunkOffset===writer.chunkCapacity){writer.data[writer.data.length]=writer.chunkData.join("");writer.chunkOffset=0}writer.chunkData[writer.chunkOffset++]=val}StringWriter.write=write;function writeSafe(writer,val){if(writer.chunkOffset===writer.chunkCapacity){writer.data[writer.data.length]=writer.chunkData.join("");writer.chunkOffset=0}writer.chunkData[writer.chunkOffset++]=val}StringWriter.writeSafe=writeSafe;function writePadLeft(writer,val,totalWidth){if(val===undefined||val===null){write(writer,__paddingSpaces[totalWidth])}var padding=totalWidth-val.length;if(padding>0)write(writer,__paddingSpaces[padding]);write(writer,val)}StringWriter.writePadLeft=writePadLeft;function writePadRight(writer,val,totalWidth){if(val===undefined||val===null){write(writer,__paddingSpaces[totalWidth])}var padding=totalWidth-val.length;write(writer,val);if(padding>0)write(writer,__paddingSpaces[padding])}StringWriter.writePadRight=writePadRight;function writeInteger(writer,val){write(writer,""+val)}StringWriter.writeInteger=writeInteger;function writeIntegerPadLeft(writer,val,totalWidth){var s=""+val;var padding=totalWidth-s.length;if(padding>0)write(writer,__paddingSpaces[padding]);write(writer,s)}StringWriter.writeIntegerPadLeft=writeIntegerPadLeft;function writeIntegerPadRight(writer,val,totalWidth){var s=""+val;var padding=totalWidth-s.length;write(writer,s);if(padding>0)write(writer,__paddingSpaces[padding])}StringWriter.writeIntegerPadRight=writeIntegerPadRight;function writeFloat(writer,val,precisionMultiplier){write(writer,""+Math.round(precisionMultiplier*val)/precisionMultiplier)}StringWriter.writeFloat=writeFloat;function writeFloatPadLeft(writer,val,precisionMultiplier,totalWidth){var s=""+Math.round(precisionMultiplier*val)/precisionMultiplier;var padding=totalWidth-s.length;if(padding>0)write(writer,__paddingSpaces[padding]);write(writer,s)}StringWriter.writeFloatPadLeft=writeFloatPadLeft;function writeFloatPadRight(writer,val,precisionMultiplier,totalWidth){var s=""+Math.round(precisionMultiplier*val)/precisionMultiplier;var padding=totalWidth-s.length;write(writer,s);if(padding>0)write(writer,__paddingSpaces[padding])}StringWriter.writeFloatPadRight=writeFloatPadRight})(StringWriter=Utils.StringWriter||(Utils.StringWriter={}))})(Utils=CIFTools.Utils||(CIFTools.Utils={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){"use strict";var _UndefinedColumn=function(){function _UndefinedColumn(){this.isDefined=false}_UndefinedColumn.prototype.getString=function(row){return null};_UndefinedColumn.prototype.getInteger=function(row){return 0};_UndefinedColumn.prototype.getFloat=function(row){return 0};_UndefinedColumn.prototype.getValuePresence=function(row){return 1};_UndefinedColumn.prototype.areValuesEqual=function(rowA,rowB){return true};_UndefinedColumn.prototype.stringEquals=function(row,value){return value===null};return _UndefinedColumn}();CIFTools.UndefinedColumn=new _UndefinedColumn;var Category;(function(Category){function getMatrix(category,field,rows,cols,rowIndex){var ret=[];for(var i=1;i<=rows;i++){var row=[];for(var j=1;j<=cols;j++){row[j-1]=category.getColumn(field+"["+i+"]["+j+"]").getFloat(rowIndex)}ret[i-1]=row}return ret}Category.getMatrix=getMatrix;function getVector(category,field,rows,cols,rowIndex){var ret=[];for(var i=1;i<=rows;i++){ret[i-1]=category.getColumn(field+"["+i+"]").getFloat(rowIndex)}return ret}Category.getVector=getVector})(Category=CIFTools.Category||(CIFTools.Category={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){"use strict";var ParserResult;(function(ParserResult){function error(message,line){if(line===void 0){line=-1}return new ParserError(message,line)}ParserResult.error=error;function success(result,warnings){if(warnings===void 0){warnings=[]}return new ParserSuccess(result,warnings)}ParserResult.success=success})(ParserResult=CIFTools.ParserResult||(CIFTools.ParserResult={}));var ParserError=function(){function ParserError(message,line){this.message=message;this.line=line;this.isError=true}ParserError.prototype.toString=function(){if(this.line>=0){return"[Line "+this.line+"] "+this.message}return this.message};return ParserError}();CIFTools.ParserError=ParserError;var ParserSuccess=function(){function ParserSuccess(result,warnings){this.result=result;this.warnings=warnings;this.isError=false}return ParserSuccess}();CIFTools.ParserSuccess=ParserSuccess})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Text;(function(Text){"use strict";var ShortStringPool;(function(ShortStringPool){function create(){return Object.create(null)}ShortStringPool.create=create;function get(pool,str){if(str.length>6)return str;var value=pool[str];if(value!==void 0)return value;pool[str]=str;return str}ShortStringPool.get=get})(ShortStringPool||(ShortStringPool={}));var File=function(){function File(data){this.dataBlocks=[];this.data=data}File.prototype.toJSON=function(){return this.dataBlocks.map(function(b){return b.toJSON()})};return File}();Text.File=File;var DataBlock=function(){function DataBlock(data,header){this.header=header;this.data=data;this.categoryList=[];this.additionalData={};this.categoryMap=new Map}Object.defineProperty(DataBlock.prototype,"categories",{get:function(){return this.categoryList},enumerable:true,configurable:true});DataBlock.prototype.getCategory=function(name){return this.categoryMap.get(name)};DataBlock.prototype.addCategory=function(category){this.categoryList[this.categoryList.length]=category;this.categoryMap.set(category.name,category)};DataBlock.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(c){return c.toJSON()}),additionalData:this.additionalData}};return DataBlock}();Text.DataBlock=DataBlock;var Category=function(){function Category(data,name,startIndex,endIndex,columns,tokens,tokenCount){this.name=name;this.tokens=tokens;this.data=data;this.startIndex=startIndex;this.endIndex=endIndex;this.columnCount=columns.length;this.rowCount=tokenCount/columns.length|0;this.columnIndices=new Map;this.columnNameList=[];for(var i=0;i<columns.length;i++){var colName=columns[i].substr(name.length+1);this.columnIndices.set(colName,i);this.columnNameList.push(colName)}}Object.defineProperty(Category.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:true,configurable:true});Category.prototype.getColumn=function(name){var i=this.columnIndices.get(name);if(i!==void 0)return new Column(this,this.data,name,i);return CIFTools.UndefinedColumn};Category.prototype.toJSON=function(){var rows=[],data=this.data,tokens=this.tokens;var colNames=this.columnNameList;var strings=ShortStringPool.create();for(var i=0;i<this.rowCount;i++){var item={};for(var j=0;j<this.columnCount;j++){var tk=(i*this.columnCount+j)*2;item[colNames[j]]=ShortStringPool.get(strings,data.substring(tokens[tk],tokens[tk+1]))}rows[i]=item}return{name:this.name,columns:colNames,rows:rows}};return Category}();Text.Category=Category;var fastParseInt=CIFTools.Utils.FastNumberParsers.parseInt;var fastParseFloat=CIFTools.Utils.FastNumberParsers.parseFloat;var Column=function(){function Column(category,data,name,index){this.data=data;this.name=name;this.index=index;this.stringPool=ShortStringPool.create();this.isDefined=true;this.tokens=category.tokens;this.columnCount=category.columnCount}Column.prototype.getString=function(row){var i=(row*this.columnCount+this.index)*2;var ret=ShortStringPool.get(this.stringPool,this.data.substring(this.tokens[i],this.tokens[i+1]));if(ret==="."||ret==="?")return null;return ret};Column.prototype.getInteger=function(row){var i=(row*this.columnCount+this.index)*2;return fastParseInt(this.data,this.tokens[i],this.tokens[i+1])};Column.prototype.getFloat=function(row){var i=(row*this.columnCount+this.index)*2;return fastParseFloat(this.data,this.tokens[i],this.tokens[i+1])};Column.prototype.stringEquals=function(row,value){var aIndex=(row*this.columnCount+this.index)*2,s=this.tokens[aIndex],len=value.length;if(len!==this.tokens[aIndex+1]-s)return false;for(var i=0;i<len;i++){if(this.data.charCodeAt(i+s)!==value.charCodeAt(i))return false}return true};Column.prototype.areValuesEqual=function(rowA,rowB){var aIndex=(rowA*this.columnCount+this.index)*2,bIndex=(rowB*this.columnCount+this.index)*2;var aS=this.tokens[aIndex],bS=this.tokens[bIndex],len=this.tokens[aIndex+1]-aS;if(len!==this.tokens[bIndex+1]-bS)return false;for(var i=0;i<len;i++){if(this.data.charCodeAt(i+aS)!==this.data.charCodeAt(i+bS)){return false}}return true};Column.prototype.getValuePresence=function(row){var index=row*this.columnCount+this.index;var s=this.tokens[2*index];if(this.tokens[2*index+1]-s!==1)return 0;var v=this.data.charCodeAt(s);if(v===46)return 1;if(v===63)return 2;return 0};return Column}();Text.Column=Column})(Text=CIFTools.Text||(CIFTools.Text={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Text;(function(Text){"use strict";var TokenIndexBuilder;(function(TokenIndexBuilder){function resize(builder){var newBuffer=new Int32Array(1.61*builder.tokens.length|0);newBuffer.set(builder.tokens);builder.tokens=newBuffer;builder.tokensLenMinus2=newBuffer.length-2|0}function addToken(builder,start,end){if(builder.count>=builder.tokensLenMinus2){resize(builder)}builder.tokens[builder.count++]=start;builder.tokens[builder.count++]=end}TokenIndexBuilder.addToken=addToken;function create(size){return{tokensLenMinus2:size-2|0,count:0,tokens:new Int32Array(size)}}TokenIndexBuilder.create=create})(TokenIndexBuilder||(TokenIndexBuilder={}));function eatValue(state){while(state.position<state.length){switch(state.data.charCodeAt(state.position)){case 9:case 10:case 13:case 32:state.currentTokenEnd=state.position;return;default:++state.position;break}}state.currentTokenEnd=state.position}function eatEscaped(state,esc){var next,c;++state.position;while(state.position<state.length){c=state.data.charCodeAt(state.position);if(c===esc){next=state.data.charCodeAt(state.position+1);switch(next){case 9:case 10:case 13:case 32:state.currentTokenStart++;state.currentTokenEnd=state.position;state.isEscaped=true;++state.position;return;default:if(next===void 0){state.currentTokenStart++;state.currentTokenEnd=state.position;state.isEscaped=true;++state.position;return}++state.position;break}}else{if(c===10||c===13){state.currentTokenEnd=state.position;return}++state.position}}state.currentTokenEnd=state.position}function eatMultiline(state){var prev=59,pos=state.position+1,c;while(pos<state.length){c=state.data.charCodeAt(pos);if(c===59&&(prev===10||prev===13)){state.position=pos+1;state.currentTokenStart++;pos--;c=state.data.charCodeAt(pos);while(c===10||c===13){pos--;c=state.data.charCodeAt(pos)}state.currentTokenEnd=pos+1;state.isEscaped=true;return}else{if(c===13){state.currentLineNumber++}else if(c===10&&prev!==13){state.currentLineNumber++}prev=c;++pos}}state.position=pos;return prev}function skipCommentLine(state){while(state.position<state.length){var c=state.data.charCodeAt(state.position);if(c===10||c===13){return}++state.position}}function skipWhitespace(state){var prev=10;while(state.position<state.length){var c=state.data.charCodeAt(state.position);switch(c){case 9:case 32:prev=c;++state.position;break;case 10:if(prev!==13){++state.currentLineNumber}prev=c;++state.position;break;case 13:prev=c;++state.position;++state.currentLineNumber;break;default:return prev}}return prev}function isData(state){var c=state.data.charCodeAt(state.currentTokenStart);if(c!==68&&c!==100)return false;c=state.data.charCodeAt(state.currentTokenStart+1);if(c!==65&&c!==97)return false;c=state.data.charCodeAt(state.currentTokenStart+2);if(c!==84&&c!==116)return false;c=state.data.charCodeAt(state.currentTokenStart+3);if(c!==65&&c!==97)return false;return true}function isSave(state){var c=state.data.charCodeAt(state.currentTokenStart);if(c!==83&&c!==115)return false;c=state.data.charCodeAt(state.currentTokenStart+1);if(c!==65&&c!==97)return false;c=state.data.charCodeAt(state.currentTokenStart+2);if(c!==86&&c!==118)return false;c=state.data.charCodeAt(state.currentTokenStart+3);if(c!==69&&c!==101)return false;return true}function isLoop(state){if(state.currentTokenEnd-state.currentTokenStart!==5)return false;var c=state.data.charCodeAt(state.currentTokenStart);if(c!==76&&c!==108)return false;c=state.data.charCodeAt(state.currentTokenStart+1);if(c!==79&&c!==111)return false;c=state.data.charCodeAt(state.currentTokenStart+2);if(c!==79&&c!==111)return false;c=state.data.charCodeAt(state.currentTokenStart+3);if(c!==80&&c!==112)return false;return true}function isNamespace(state,start,end){var i,nsLen=end-start,offset=state.currentTokenStart-start,tokenLen=state.currentTokenEnd-state.currentTokenStart;if(tokenLen<nsLen)return false;for(i=start;i<end;++i){if(state.data.charCodeAt(i)!==state.data.charCodeAt(i+offset))return false}if(nsLen===tokenLen)return true;if(state.data.charCodeAt(i+offset)===46){return true}return false}function getNamespaceEnd(state){var i;for(i=state.currentTokenStart;i<state.currentTokenEnd;++i){if(state.data.charCodeAt(i)===46)return i}return i}function getNamespace(state,endIndex){return state.data.substring(state.currentTokenStart,endIndex)}function getTokenString(state){return state.data.substring(state.currentTokenStart,state.currentTokenEnd)}function moveNextInternal(state){var prev=skipWhitespace(state);if(state.position>=state.length){state.currentTokenType=6;return}state.currentTokenStart=state.position;state.currentTokenEnd=state.position;state.isEscaped=false;var c=state.data.charCodeAt(state.position);switch(c){case 35:skipCommentLine(state);state.currentTokenType=5;break;case 34:case 39:eatEscaped(state,c);state.currentTokenType=3;break;case 59:if(prev===10||prev===13){eatMultiline(state)}else{eatValue(state)}state.currentTokenType=3;break;default:eatValue(state);if(state.isEscaped){state.currentTokenType=3}else if(state.data.charCodeAt(state.currentTokenStart)===95){state.currentTokenType=4}else if(state.currentTokenEnd-state.currentTokenStart>=5&&state.data.charCodeAt(state.currentTokenStart+4)===95){if(isData(state))state.currentTokenType=0;else if(isSave(state))state.currentTokenType=1;else if(isLoop(state))state.currentTokenType=2;else state.currentTokenType=3}else{state.currentTokenType=3}break}}function moveNext(state){moveNextInternal(state);while(state.currentTokenType===5)moveNextInternal(state)}function createTokenizer(data){return{data:data,length:data.length,position:0,currentTokenStart:0,currentTokenEnd:0,currentTokenType:6,currentLineNumber:1,isEscaped:false}}function handleSingle(tokenizer,block){var nsStart=tokenizer.currentTokenStart,nsEnd=getNamespaceEnd(tokenizer),name=getNamespace(tokenizer,nsEnd),column,columns=[],tokens=TokenIndexBuilder.create(512),tokenCount=0,readingNames=true;while(readingNames){if(tokenizer.currentTokenType!==4||!isNamespace(tokenizer,nsStart,nsEnd)){readingNames=false;break}column=getTokenString(tokenizer);moveNext(tokenizer);if(tokenizer.currentTokenType!==3){return{hasError:true,errorLine:tokenizer.currentLineNumber,errorMessage:"Expected value."}}columns[columns.length]=column;TokenIndexBuilder.addToken(tokens,tokenizer.currentTokenStart,tokenizer.currentTokenEnd);tokenCount++;moveNext(tokenizer)}block.addCategory(new Text.Category(block.data,name,nsStart,tokenizer.currentTokenStart,columns,tokens.tokens,tokenCount));return{hasError:false,errorLine:0,errorMessage:""}}function handleLoop(tokenizer,block){var start=tokenizer.currentTokenStart,loopLine=tokenizer.currentLineNumber;moveNext(tokenizer);var name=getNamespace(tokenizer,getNamespaceEnd(tokenizer)),columns=[],tokens=TokenIndexBuilder.create(name==="_atom_site"?block.data.length/1.85|0:1024),tokenCount=0;while(tokenizer.currentTokenType===4){columns[columns.length]=getTokenString(tokenizer);moveNext(tokenizer)}while(tokenizer.currentTokenType===3){TokenIndexBuilder.addToken(tokens,tokenizer.currentTokenStart,tokenizer.currentTokenEnd);tokenCount++;moveNext(tokenizer)}if(tokenCount%columns.length!==0){return{hasError:true,errorLine:tokenizer.currentLineNumber,errorMessage:"The number of values for loop starting at line "+loopLine+" is not a multiple of the number of columns."}}block.addCategory(new Text.Category(block.data,name,start,tokenizer.currentTokenStart,columns,tokens.tokens,tokenCount));return{hasError:false,errorLine:0,errorMessage:""}}function error(line,message){return CIFTools.ParserResult.error(message,line)}function result(data){return CIFTools.ParserResult.success(data)}function parseInternal(data){var tokenizer=createTokenizer(data),cat,id,file=new Text.File(data),block=new Text.DataBlock(data,"default"),saveFrame=new Text.DataBlock(data,"empty"),inSaveFrame=false,blockSaveFrames;moveNext(tokenizer);while(tokenizer.currentTokenType!==6){var token=tokenizer.currentTokenType;if(token===0){if(inSaveFrame){return error(tokenizer.currentLineNumber,"Unexpected data block inside a save frame.")}if(block.categories.length>0){file.dataBlocks.push(block)}block=new Text.DataBlock(data,data.substring(tokenizer.currentTokenStart+5,tokenizer.currentTokenEnd));moveNext(tokenizer)}else if(token===1){id=data.substring(tokenizer.currentTokenStart+5,tokenizer.currentTokenEnd);if(id.length===0){if(saveFrame.categories.length>0){blockSaveFrames=block.additionalData["saveFrames"];if(!blockSaveFrames){blockSaveFrames=[];block.additionalData["saveFrames"]=blockSaveFrames}blockSaveFrames[blockSaveFrames.length]=saveFrame}inSaveFrame=false}else{if(inSaveFrame){return error(tokenizer.currentLineNumber,"Save frames cannot be nested.")}inSaveFrame=true;saveFrame=new Text.DataBlock(data,id)}moveNext(tokenizer)}else if(token===2){cat=handleLoop(tokenizer,inSaveFrame?saveFrame:block);if(cat.hasError){return error(cat.errorLine,cat.errorMessage)}}else if(token===4){cat=handleSingle(tokenizer,inSaveFrame?saveFrame:block);if(cat.hasError){return error(cat.errorLine,cat.errorMessage)}}else{return error(tokenizer.currentLineNumber,"Unexpected token. Expected data_, loop_, or data name.")}}if(inSaveFrame){return error(tokenizer.currentLineNumber,"Unfinished save frame (`"+saveFrame.header+"`).")}if(block.categories.length>0){file.dataBlocks.push(block)}return result(file)}function parse(data){return parseInternal(data)}Text.parse=parse})(Text=CIFTools.Text||(CIFTools.Text={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Text;(function(Text){"use strict";var StringWriter=CIFTools.Utils.StringWriter;var Writer=function(){function Writer(){this.writer=StringWriter.create();this.encoded=false;this.dataBlockCreated=false}Writer.prototype.startDataBlock=function(header){this.dataBlockCreated=true;StringWriter.write(this.writer,"data_"+(header||"").replace(/[ \n\t]/g,"").toUpperCase()+"\n#\n")};Writer.prototype.writeCategory=function(category,contexts){if(this.encoded){throw new Error("The writer contents have already been encoded, no more writing.")}if(!this.dataBlockCreated){throw new Error("No data block created.")}var src=!contexts||!contexts.length?[category(void 0)]:contexts.map(function(c){return category(c)});var data=src.filter(function(c){return c&&c.count>0});if(!data.length)return;var count=data.reduce(function(a,c){return a+(c.count===void 0?1:c.count)},0);if(!count)return;else if(count===1){writeCifSingleRecord(data[0],this.writer)}else{writeCifLoop(data,this.writer)}};Writer.prototype.encode=function(){this.encoded=true};Writer.prototype.flush=function(stream){StringWriter.writeTo(this.writer,stream)};return Writer}();Text.Writer=Writer;function isMultiline(value){return!!value&&value.indexOf("\n")>=0}function writeCifSingleRecord(category,writer){var fields=category.desc.fields;var data=category.data;var width=fields.reduce(function(w,s){return Math.max(w,s.name.length)},0)+category.desc.name.length+5;for(var _i=0,fields_1=fields;_i<fields_1.length;_i++){var f=fields_1[_i];StringWriter.writePadRight(writer,category.desc.name+"."+f.name,width);var presence=f.presence;var p=presence?presence(data,0):0;if(p!==0){if(p===1)writeNotSpecified(writer);else writeUnknown(writer)}else{var val=f.string(data,0);if(isMultiline(val)){writeMultiline(writer,val);StringWriter.newline(writer)}else{writeChecked(writer,val)}}StringWriter.newline(writer)}StringWriter.write(writer,"#\n")}function writeCifLoop(categories,writer){writeLine(writer,"loop_");var first=categories[0];var fields=first.desc.fields;for(var _i=0,fields_2=fields;_i<fields_2.length;_i++){var f=fields_2[_i];writeLine(writer,first.desc.name+"."+f.name)}for(var _a=0,categories_1=categories;_a<categories_1.length;_a++){var category=categories_1[_a];var data=category.data;var count=category.count;for(var i=0;i<count;i++){for(var _b=0,fields_3=fields;_b<fields_3.length;_b++){var f=fields_3[_b];var presence=f.presence;var p=presence?presence(data,i):0;if(p!==0){if(p===1)writeNotSpecified(writer);else writeUnknown(writer)}else{var val=f.string(data,i);if(isMultiline(val)){writeMultiline(writer,val);StringWriter.newline(writer)}else{writeChecked(writer,val)}}}StringWriter.newline(writer)}}StringWriter.write(writer,"#\n")}function writeLine(writer,val){StringWriter.write(writer,val);StringWriter.newline(writer)}function writeInteger(writer,val){StringWriter.writeSafe(writer,""+val+" ")}function writeFloat(writer,val,precisionMultiplier){StringWriter.writeSafe(writer,""+Math.round(precisionMultiplier*val)/precisionMultiplier+" ")}function writeNotSpecified(writer){StringWriter.writeSafe(writer,". ")}function writeUnknown(writer){StringWriter.writeSafe(writer,"? ")}function writeChecked(writer,val){if(!val){StringWriter.writeSafe(writer,". ");return}var escape=false,escapeCharStart="'",escapeCharEnd="' ";var hasWhitespace=false;var hasSingle=false;var hasDouble=false;for(var i=0,_l=val.length-1;i<_l;i++){var c=val.charCodeAt(i);switch(c){case 9:hasWhitespace=true;break;case 10:StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ");return;case 32:hasWhitespace=true;break;case 34:if(hasSingle){StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ");return}hasDouble=true;escape=true;escapeCharStart="'";escapeCharEnd="' ";break;case 39:if(hasDouble){StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ");return}escape=true;hasSingle=true;escapeCharStart='"';escapeCharEnd='" ';break}}var fst=val.charCodeAt(0);if(!escape&&(fst===35||fst===59||hasWhitespace)){escapeCharStart="'";escapeCharEnd="' ";escape=true}if(escape){StringWriter.writeSafe(writer,escapeCharStart+val+escapeCharEnd)}else{StringWriter.write(writer,val);StringWriter.writeSafe(writer," ")}}function writeMultiline(writer,val){StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ")}function writeToken(writer,data,start,end){var escape=false,escapeCharStart="'",escapeCharEnd="' ";for(var i=start;i<end-1;i++){var c=data.charCodeAt(i);switch(c){case 10:StringWriter.writeSafe(writer,"\n;"+data.substring(start,end));StringWriter.writeSafe(writer,"\n; ");return;case 34:escape=true;escapeCharStart="'";escapeCharEnd="' ";break;case 39:escape=true;escapeCharStart='"';escapeCharEnd='" ';break}}if(!escape&&data.charCodeAt(start)===59){escapeCharStart="'";escapeCharEnd="' ";escape=true}if(escape){StringWriter.writeSafe(writer,escapeCharStart+data.substring(start,end));StringWriter.writeSafe(writer,escapeCharStart)}else{StringWriter.write(writer,data.substring(start,end));StringWriter.writeSafe(writer," ")}}})(Text=CIFTools.Text||(CIFTools.Text={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){var MessagePack;(function(MessagePack){function map(state,length){var value={};for(var i=0;i<length;i++){var key=parse(state);value[key]=parse(state)}return value}function bin(state,length){var value=new Uint8Array(length);var o=state.offset;for(var i=0;i<length;i++)value[i]=state.buffer[i+o];state.offset+=length;return value}function str(state,length){var value=MessagePack.utf8Read(state.buffer,state.offset,length);state.offset+=length;return value}function array(state,length){var value=new Array(length);for(var i=0;i<length;i++){value[i]=parse(state)}return value}function parse(state){var type=state.buffer[state.offset];var value,length;if((type&128)===0){state.offset++;return type}if((type&240)===128){length=type&15;state.offset++;return map(state,length)}if((type&240)===144){length=type&15;state.offset++;return array(state,length)}if((type&224)===160){length=type&31;state.offset++;return str(state,length)}if((type&224)===224){value=state.dataView.getInt8(state.offset);state.offset++;return value}switch(type){case 192:state.offset++;return null;case 194:state.offset++;return false;case 195:state.offset++;return true;case 196:length=state.dataView.getUint8(state.offset+1);state.offset+=2;return bin(state,length);case 197:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return bin(state,length);case 198:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return bin(state,length);case 202:value=state.dataView.getFloat32(state.offset+1);state.offset+=5;return value;case 203:value=state.dataView.getFloat64(state.offset+1);state.offset+=9;return value;case 204:value=state.buffer[state.offset+1];state.offset+=2;return value;case 205:value=state.dataView.getUint16(state.offset+1);state.offset+=3;return value;case 206:value=state.dataView.getUint32(state.offset+1);state.offset+=5;return value;case 208:value=state.dataView.getInt8(state.offset+1);state.offset+=2;return value;case 209:value=state.dataView.getInt16(state.offset+1);state.offset+=3;return value;case 210:value=state.dataView.getInt32(state.offset+1);state.offset+=5;return value;case 217:length=state.dataView.getUint8(state.offset+1);state.offset+=2;return str(state,length);case 218:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return str(state,length);case 219:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return str(state,length);case 220:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return array(state,length);case 221:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return array(state,length);case 222:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return map(state,length);case 223:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return map(state,length)}throw new Error("Unknown type 0x"+type.toString(16))}function decode(buffer){return parse({buffer:buffer,offset:0,dataView:new DataView(buffer.buffer)})}MessagePack.decode=decode})(MessagePack=Binary.MessagePack||(Binary.MessagePack={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){var MessagePack;(function(MessagePack){function encode(value){var buffer=new ArrayBuffer(encodedSize(value));var view=new DataView(buffer);var bytes=new Uint8Array(buffer);encodeInternal(value,view,bytes,0);return bytes}MessagePack.encode=encode;function encodedSize(value){var type=typeof value;if(type==="string"){var length_1=MessagePack.utf8ByteCount(value);if(length_1<32){return 1+length_1}if(length_1<256){return 2+length_1}if(length_1<65536){return 3+length_1}if(length_1<4294967296){return 5+length_1}}if(value instanceof Uint8Array){var length_2=value.byteLength;if(length_2<256){return 2+length_2}if(length_2<65536){return 3+length_2}if(length_2<4294967296){return 5+length_2}}if(type==="number"){if(Math.floor(value)!==value)return 9;if(value>=0){if(value<128)return 1;if(value<256)return 2;if(value<65536)return 3;if(value<4294967296)return 5;throw new Error("Number too big 0x"+value.toString(16))}if(value>=-32)return 1;if(value>=-128)return 2;if(value>=-32768)return 3;if(value>=-2147483648)return 5;throw new Error("Number too small -0x"+value.toString(16).substr(1))}if(type==="boolean"||value===null||value===void 0)return 1;if(type==="object"){var length_3,size=0;if(Array.isArray(value)){length_3=value.length;for(var i=0;i<length_3;i++){size+=encodedSize(value[i])}}else{var keys=Object.keys(value);length_3=keys.length;for(var i=0;i<length_3;i++){var key=keys[i];size+=encodedSize(key)+encodedSize(value[key])}}if(length_3<16){return 1+size}if(length_3<65536){return 3+size}if(length_3<4294967296){return 5+size}throw new Error("Array or object too long 0x"+length_3.toString(16))}throw new Error("Unknown type "+type)}function encodeInternal(value,view,bytes,offset){var type=typeof value;if(type==="string"){var length_4=MessagePack.utf8ByteCount(value);if(length_4<32){view.setUint8(offset,length_4|160);MessagePack.utf8Write(bytes,offset+1,value);return 1+length_4}if(length_4<256){view.setUint8(offset,217);view.setUint8(offset+1,length_4);MessagePack.utf8Write(bytes,offset+2,value);return 2+length_4}if(length_4<65536){view.setUint8(offset,218);view.setUint16(offset+1,length_4);MessagePack.utf8Write(bytes,offset+3,value);return 3+length_4}if(length_4<4294967296){view.setUint8(offset,219);view.setUint32(offset+1,length_4);MessagePack.utf8Write(bytes,offset+5,value);return 5+length_4}}if(value instanceof Uint8Array){var length_5=value.byteLength;var bytes_1=new Uint8Array(view.buffer);if(length_5<256){view.setUint8(offset,196);view.setUint8(offset+1,length_5);bytes_1.set(value,offset+2);return 2+length_5}if(length_5<65536){view.setUint8(offset,197);view.setUint16(offset+1,length_5);bytes_1.set(value,offset+3);return 3+length_5}if(length_5<4294967296){view.setUint8(offset,198);view.setUint32(offset+1,length_5);bytes_1.set(value,offset+5);return 5+length_5}}if(type==="number"){if(!isFinite(value)){throw new Error("Number not finite: "+value)}if(Math.floor(value)!==value){view.setUint8(offset,203);view.setFloat64(offset+1,value);return 9}if(value>=0){if(value<128){view.setUint8(offset,value);return 1}if(value<256){view.setUint8(offset,204);view.setUint8(offset+1,value);return 2}if(value<65536){view.setUint8(offset,205);view.setUint16(offset+1,value);return 3}if(value<4294967296){view.setUint8(offset,206);view.setUint32(offset+1,value);return 5}throw new Error("Number too big 0x"+value.toString(16))}if(value>=-32){view.setInt8(offset,value);return 1}if(value>=-128){view.setUint8(offset,208);view.setInt8(offset+1,value);return 2}if(value>=-32768){view.setUint8(offset,209);view.setInt16(offset+1,value);return 3}if(value>=-2147483648){view.setUint8(offset,210);view.setInt32(offset+1,value);return 5}throw new Error("Number too small -0x"+(-value).toString(16).substr(1))}if(value===null||value===undefined){view.setUint8(offset,192);return 1}if(type==="boolean"){view.setUint8(offset,value?195:194);return 1}if(type==="object"){var length_6,size=0;var isArray=Array.isArray(value);var keys=void 0;if(isArray){length_6=value.length}else{keys=Object.keys(value);length_6=keys.length}if(length_6<16){view.setUint8(offset,length_6|(isArray?144:128));size=1}else if(length_6<65536){view.setUint8(offset,isArray?220:222);view.setUint16(offset+1,length_6);size=3}else if(length_6<4294967296){view.setUint8(offset,isArray?221:223);view.setUint32(offset+1,length_6);size=5}if(isArray){for(var i=0;i<length_6;i++){size+=encodeInternal(value[i],view,bytes,offset+size)}}else{for(var _i=0,_a=keys;_i<_a.length;_i++){var key=_a[_i];size+=encodeInternal(key,view,bytes,offset+size);size+=encodeInternal(value[key],view,bytes,offset+size)}}return size}throw new Error("Unknown type "+type)}})(MessagePack=Binary.MessagePack||(Binary.MessagePack={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){var MessagePack;(function(MessagePack){function utf8Write(data,offset,str){var byteLength=data.byteLength;for(var i=0,l=str.length;i<l;i++){var codePoint=str.charCodeAt(i);if(codePoint<128){data[offset++]=codePoint>>>0&127|0;continue}if(codePoint<2048){data[offset++]=codePoint>>>6&31|192;data[offset++]=codePoint>>>0&63|128;continue}if(codePoint<65536){data[offset++]=codePoint>>>12&15|224;data[offset++]=codePoint>>>6&63|128;data[offset++]=codePoint>>>0&63|128;continue}if(codePoint<1114112){data[offset++]=codePoint>>>18&7|240;data[offset++]=codePoint>>>12&63|128;data[offset++]=codePoint>>>6&63|128;data[offset++]=codePoint>>>0&63|128;continue}throw new Error("bad codepoint "+codePoint)}}MessagePack.utf8Write=utf8Write;var __chars=function(){var data=[];for(var i=0;i<1024;i++)data[i]=String.fromCharCode(i);return data}();function throwError(err){throw new Error(err)}function utf8Read(data,offset,length){var chars=__chars;var str=void 0,chunk=[],chunkSize=512,chunkOffset=0;for(var i=offset,end=offset+length;i<end;i++){var byte=data[i];if((byte&128)===0){chunk[chunkOffset++]=chars[byte]}else if((byte&224)===192){chunk[chunkOffset++]=chars[(byte&15)<<6|data[++i]&63]}else if((byte&240)===224){chunk[chunkOffset++]=String.fromCharCode((byte&15)<<12|(data[++i]&63)<<6|(data[++i]&63)<<0)}else if((byte&248)===240){chunk[chunkOffset++]=String.fromCharCode((byte&7)<<18|(data[++i]&63)<<12|(data[++i]&63)<<6|(data[++i]&63)<<0)}else throwError("Invalid byte "+byte.toString(16));if(chunkOffset===chunkSize){str=str||[];str[str.length]=chunk.join("");chunkOffset=0}}if(!str)return chunk.slice(0,chunkOffset).join("");if(chunkOffset>0){str[str.length]=chunk.slice(0,chunkOffset).join("")}return str.join("")}MessagePack.utf8Read=utf8Read;function utf8ByteCount(str){var count=0;for(var i=0,l=str.length;i<l;i++){var codePoint=str.charCodeAt(i);if(codePoint<128){count+=1;continue}if(codePoint<2048){count+=2;continue}if(codePoint<65536){count+=3;continue}if(codePoint<1114112){count+=4;continue}throwError("bad codepoint "+codePoint)}return count}MessagePack.utf8ByteCount=utf8ByteCount})(MessagePack=Binary.MessagePack||(Binary.MessagePack={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";function decode(data){var current=data.data;for(var i=data.encoding.length-1;i>=0;i--){current=Decoder.decodeStep(current,data.encoding[i])}return current}Binary.decode=decode;var Decoder;(function(Decoder){function decodeStep(data,encoding){switch(encoding.kind){case"ByteArray":{switch(encoding.type){case 4:return data;case 1:return int8(data);case 2:return int16(data);case 5:return uint16(data);case 3:return int32(data);case 6:return uint32(data);case 32:return float32(data);case 33:return float64(data);default:throw new Error("Unsupported ByteArray type.")}}case"FixedPoint":return fixedPoint(data,encoding);case"IntervalQuantization":return intervalQuantization(data,encoding);case"RunLength":return runLength(data,encoding);case"Delta":return delta(data,encoding);case"IntegerPacking":return integerPacking(data,encoding);case"StringArray":return stringArray(data,encoding)}}Decoder.decodeStep=decodeStep;function getIntArray(type,size){switch(type){case 1:return new Int8Array(size);case 2:return new Int16Array(size);case 3:return new Int32Array(size);case 4:return new Uint8Array(size);case 5:return new Uint16Array(size);case 6:return new Uint32Array(size);default:throw new Error("Unsupported integer data type.")}}function getFloatArray(type,size){switch(type){case 32:return new Float32Array(size);case 33:return new Float64Array(size);default:throw new Error("Unsupported floating data type.")}}var isLittleEndian=function(){var arrayBuffer=new ArrayBuffer(2);var uint8Array=new Uint8Array(arrayBuffer);var uint16array=new Uint16Array(arrayBuffer);uint8Array[0]=170;uint8Array[1]=187;if(uint16array[0]===48042)return true;return false}();function int8(data){return new Int8Array(data.buffer,data.byteOffset)}function flipByteOrder(data,bytes){var buffer=new ArrayBuffer(data.length);var ret=new Uint8Array(buffer);for(var i=0,n=data.length;i<n;i+=bytes){for(var j=0;j<bytes;j++){ret[i+bytes-j-1]=data[i+j]}}return buffer}function view(data,byteSize,c){if(isLittleEndian)return new c(data.buffer);return new c(flipByteOrder(data,byteSize))}function int16(data){return view(data,2,Int16Array)}function uint16(data){return view(data,2,Uint16Array)}function int32(data){return view(data,4,Int32Array)}function uint32(data){return view(data,4,Uint32Array)}function float32(data){return view(data,4,Float32Array)}function float64(data){return view(data,8,Float64Array)}function fixedPoint(data,encoding){var n=data.length;var output=getFloatArray(encoding.srcType,n);var f=1/encoding.factor;for(var i=0;i<n;i++){output[i]=f*data[i]}return output}function intervalQuantization(data,encoding){var n=data.length;var output=getFloatArray(encoding.srcType,n);var delta=(encoding.max-encoding.min)/(encoding.numSteps-1);var min=encoding.min;for(var i=0;i<n;i++){output[i]=min+delta*data[i]}return output}function runLength(data,encoding){var output=getIntArray(encoding.srcType,encoding.srcSize);var dataOffset=0;for(var i=0,il=data.length;i<il;i+=2){var value=data[i];var length_7=data[i+1];for(var j=0;j<length_7;++j){output[dataOffset++]=value}}return output}function delta(data,encoding){var n=data.length;var output=getIntArray(encoding.srcType,n);if(!n)return output;output[0]=data[0]+(encoding.origin|0);for(var i=1;i<n;++i){output[i]=data[i]+output[i-1]}return output}function integerPackingSigned(data,encoding){var upperLimit=encoding.byteCount===1?127:32767;var lowerLimit=-upperLimit-1;var n=data.length;var output=new Int32Array(encoding.srcSize);var i=0;var j=0;while(i<n){var value=0,t=data[i];while(t===upperLimit||t===lowerLimit){value+=t;i++;t=data[i]}value+=t;output[j]=value;i++;j++}return output}function integerPackingUnsigned(data,encoding){var upperLimit=encoding.byteCount===1?255:65535;var n=data.length;var output=new Int32Array(encoding.srcSize);var i=0;var j=0;while(i<n){var value=0,t=data[i];while(t===upperLimit){value+=t;i++;t=data[i]}value+=t;output[j]=value;i++;j++}return output}function integerPacking(data,encoding){return encoding.isUnsigned?integerPackingUnsigned(data,encoding):integerPackingSigned(data,encoding)}function stringArray(data,encoding){var str=encoding.stringData;var offsets=decode({encoding:encoding.offsetEncoding,data:encoding.offsets});var indices=decode({encoding:encoding.dataEncoding,data:data});var cache=Object.create(null);var result=new Array(indices.length);var offset=0;for(var _i=0,indices_1=indices;_i<indices_1.length;_i++){var i=indices_1[_i];if(i<0){result[offset++]=null;continue}var v=cache[i];if(v===void 0){v=str.substring(offsets[i],offsets[i+1]);cache[i]=v}result[offset++]=v}return result}})(Decoder||(Decoder={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";var File=function(){function File(data){this.dataBlocks=data.dataBlocks.map(function(b){return new DataBlock(b)})}File.prototype.toJSON=function(){return this.dataBlocks.map(function(b){return b.toJSON()})};return File}();Binary.File=File;var DataBlock=function(){function DataBlock(data){this.additionalData={};this.header=data.header;this.categoryList=data.categories.map(function(c){return new Category(c)});this.categoryMap=new Map;for(var _i=0,_a=this.categoryList;_i<_a.length;_i++){var c=_a[_i];this.categoryMap.set(c.name,c)}}Object.defineProperty(DataBlock.prototype,"categories",{get:function(){return this.categoryList},enumerable:true,configurable:true});DataBlock.prototype.getCategory=function(name){return this.categoryMap.get(name)};DataBlock.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(c){return c.toJSON()}),additionalData:this.additionalData}};return DataBlock}();Binary.DataBlock=DataBlock;var Category=function(){function Category(data){this.name=data.name;this.columnCount=data.columns.length;this.rowCount=data.rowCount;this.columnNameList=[];this.encodedColumns=new Map;for(var _i=0,_a=data.columns;_i<_a.length;_i++){var c=_a[_i];this.encodedColumns.set(c.name,c);this.columnNameList.push(c.name)}}Object.defineProperty(Category.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:true,configurable:true});Category.prototype.getColumn=function(name){var w=this.encodedColumns.get(name);if(w)return wrapColumn(w);return CIFTools.UndefinedColumn};Category.prototype.toJSON=function(){var _this=this;var rows=[];var columns=this.columnNameList.map(function(name){return{name:name,column:_this.getColumn(name)}});for(var i=0;i<this.rowCount;i++){var item={};for(var _i=0,columns_1=columns;_i<columns_1.length;_i++){var c=columns_1[_i];var d=c.column.getValuePresence(i);if(d===0)item[c.name]=c.column.getString(i);else if(d===1)item[c.name]=".";else item[c.name]="?"}rows[i]=item}return{name:this.name,columns:this.columnNames,rows:rows}};return Category}();Binary.Category=Category;function wrapColumn(column){if(!column.data.data)return CIFTools.UndefinedColumn;var data=Binary.decode(column.data);var mask=void 0;if(column.mask)mask=Binary.decode(column.mask);if(data.buffer&&data.byteLength&&data.BYTES_PER_ELEMENT){return mask?new MaskedNumericColumn(data,mask):new NumericColumn(data)}return mask?new MaskedStringColumn(data,mask):new StringColumn(data)}var fastParseInt=CIFTools.Utils.FastNumberParsers.parseInt;var fastParseFloat=CIFTools.Utils.FastNumberParsers.parseFloat;var NumericColumn=function(){function NumericColumn(data){this.data=data;this.isDefined=true}NumericColumn.prototype.getString=function(row){return""+this.data[row]};NumericColumn.prototype.getInteger=function(row){return this.data[row]|0};NumericColumn.prototype.getFloat=function(row){return 1*this.data[row]};NumericColumn.prototype.stringEquals=function(row,value){return this.data[row]===fastParseFloat(value,0,value.length)};NumericColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};NumericColumn.prototype.getValuePresence=function(row){return 0};return NumericColumn}();var MaskedNumericColumn=function(){function MaskedNumericColumn(data,mask){this.data=data;this.mask=mask;this.isDefined=true}MaskedNumericColumn.prototype.getString=function(row){return this.mask[row]===0?""+this.data[row]:null};MaskedNumericColumn.prototype.getInteger=function(row){return this.mask[row]===0?this.data[row]:0};MaskedNumericColumn.prototype.getFloat=function(row){return this.mask[row]===0?this.data[row]:0};MaskedNumericColumn.prototype.stringEquals=function(row,value){return this.mask[row]===0?this.data[row]===fastParseFloat(value,0,value.length):value===null||value===void 0};MaskedNumericColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};MaskedNumericColumn.prototype.getValuePresence=function(row){return this.mask[row]};return MaskedNumericColumn}();var StringColumn=function(){function StringColumn(data){this.data=data;this.isDefined=true}StringColumn.prototype.getString=function(row){return this.data[row]};StringColumn.prototype.getInteger=function(row){var v=this.data[row];return fastParseInt(v,0,v.length)};StringColumn.prototype.getFloat=function(row){var v=this.data[row];return fastParseFloat(v,0,v.length)};StringColumn.prototype.stringEquals=function(row,value){return this.data[row]===value};StringColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};StringColumn.prototype.getValuePresence=function(row){return 0};return StringColumn}();var MaskedStringColumn=function(){function MaskedStringColumn(data,mask){this.data=data;this.mask=mask;this.isDefined=true}MaskedStringColumn.prototype.getString=function(row){return this.mask[row]===0?this.data[row]:null};MaskedStringColumn.prototype.getInteger=function(row){if(this.mask[row]!==0)return 0;var v=this.data[row];return fastParseInt(v||"",0,(v||"").length)};MaskedStringColumn.prototype.getFloat=function(row){if(this.mask[row]!==0)return 0;var v=this.data[row];return fastParseFloat(v||"",0,(v||"").length)};MaskedStringColumn.prototype.stringEquals=function(row,value){return this.data[row]===value};MaskedStringColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};MaskedStringColumn.prototype.getValuePresence=function(row){return this.mask[row]};return MaskedStringColumn}()})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";var Encoder=function(){function Encoder(providers){this.providers=providers}Encoder.prototype.and=function(f){return new Encoder(this.providers.concat([f]))};Encoder.prototype.encode=function(data){var encoding=[];for(var _i=0,_a=this.providers;_i<_a.length;_i++){var p=_a[_i];var t=p(data);if(!t.encodings.length){throw new Error("Encodings must be non-empty.")}data=t.data;for(var _b=0,_c=t.encodings;_b<_c.length;_b++){var e=_c[_b];encoding.push(e)}}if(!(data instanceof Uint8Array)){throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.")}return{encoding:encoding,data:data}};return Encoder}();Binary.Encoder=Encoder;(function(Encoder){function by(f){return new Encoder([f])}Encoder.by=by;function uint8(data){return{encodings:[{kind:"ByteArray",type:4}],data:data}}function int8(data){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(data.buffer,data.byteOffset)}}var writers=(_a={},_a[2]=function(v,i,a){v.setInt16(2*i,a,true)},_a[5]=function(v,i,a){v.setUint16(2*i,a,true)},_a[3]=function(v,i,a){v.setInt32(4*i,a,true)},_a[6]=function(v,i,a){v.setUint32(4*i,a,true)},_a[32]=function(v,i,a){v.setFloat32(4*i,a,true)},_a[33]=function(v,i,a){v.setFloat64(8*i,a,true)},_a);var byteSizes=(_b={},_b[2]=2,_b[5]=2,_b[3]=4,_b[6]=4,_b[32]=4,_b[33]=8,_b);function byteArray(data){var type=Binary.Encoding.getDataType(data);if(type===1)return int8(data);else if(type===4)return uint8(data);var result=new Uint8Array(data.length*byteSizes[type]);var w=writers[type];var view=new DataView(result.buffer);for(var i=0,n=data.length;i<n;i++){w(view,i,data[i])}return{encodings:[{kind:"ByteArray",type:type}],data:result}}Encoder.byteArray=byteArray;function _fixedPoint(data,factor){var srcType=Binary.Encoding.getDataType(data);var result=new Int32Array(data.length);for(var i=0,n=data.length;i<n;i++){result[i]=Math.round(data[i]*factor)}return{encodings:[{kind:"FixedPoint",factor:factor,srcType:srcType}],data:result}}function fixedPoint(factor){return function(data){return _fixedPoint(data,factor)}}Encoder.fixedPoint=fixedPoint;function _intervalQuantizaiton(data,min,max,numSteps,arrayType){var srcType=Binary.Encoding.getDataType(data);if(!data.length){return{encodings:[{kind:"IntervalQuantization",min:min,max:max,numSteps:numSteps,srcType:srcType}],data:new Int32Array(0)}}if(max<min){var t=min;min=max;max=t}var delta=(max-min)/(numSteps-1);var output=new arrayType(data.length);for(var i=0,n=data.length;i<n;i++){var v=data[i];if(v<=min)output[i]=0;else if(v>=max)output[i]=numSteps;else output[i]=Math.round((v-min)/delta)|0}return{encodings:[{kind:"IntervalQuantization",min:min,max:max,numSteps:numSteps,srcType:srcType}],data:output}}function intervalQuantizaiton(min,max,numSteps,arrayType){if(arrayType===void 0){arrayType=Int32Array}return function(data){return _intervalQuantizaiton(data,min,max,numSteps,arrayType)}}Encoder.intervalQuantizaiton=intervalQuantizaiton;function runLength(data){var srcType=Binary.Encoding.getDataType(data);if(srcType===void 0){data=new Int32Array(data);srcType=3}if(!data.length){return{encodings:[{kind:"RunLength",srcType:srcType,srcSize:0}],data:new Int32Array(0)}}var fullLength=2;for(var i=1,il=data.length;i<il;i++){if(data[i-1]!==data[i]){fullLength+=2}}var output=new Int32Array(fullLength);var offset=0;var runLength=1;for(var i=1,il=data.length;i<il;i++){if(data[i-1]!==data[i]){output[offset]=data[i-1];output[offset+1]=runLength;runLength=1;offset+=2}else{++runLength}}output[offset]=data[data.length-1];output[offset+1]=runLength;return{encodings:[{kind:"RunLength",srcType:srcType,srcSize:data.length}],data:output}}Encoder.runLength=runLength;function delta(data){if(!Binary.Encoding.isSignedIntegerDataType(data)){throw new Error("Only signed integer types can be encoded using delta encoding.")}var srcType=Binary.Encoding.getDataType(data);if(srcType===void 0){data=new Int32Array(data);srcType=3}if(!data.length){return{encodings:[{kind:"Delta",origin:0,srcType:srcType}],data:new data.constructor(0)}}var output=new data.constructor(data.length);var origin=data[0];output[0]=data[0];for(var i=1,n=data.length;i<n;i++){output[i]=data[i]-data[i-1]}output[0]=0;return{encodings:[{kind:"Delta",origin:origin,srcType:srcType}],data:output}}Encoder.delta=delta;function isSigned(data){for(var i=0,n=data.length;i<n;i++){if(data[i]<0)return true}return false}function packingSize(data,upperLimit){var lowerLimit=-upperLimit-1;var size=0;for(var i=0,n=data.length;i<n;i++){var value=data[i];if(value===0){size+=1}else if(value>0){size+=Math.ceil(value/upperLimit);if(value%upperLimit===0)size+=1}else{size+=Math.ceil(value/lowerLimit);if(value%lowerLimit===0)size+=1}}return size}function determinePacking(data){var signed=isSigned(data);var size8=signed?packingSize(data,127):packingSize(data,255);var size16=signed?packingSize(data,32767):packingSize(data,65535);if(data.length*4<size16*2){return{isSigned:signed,size:data.length,bytesPerElement:4}}else if(size16*2<size8){return{isSigned:signed,size:size16,bytesPerElement:2}}else{return{isSigned:signed,size:size8,bytesPerElement:1}}}function _integerPacking(data,packing){var upperLimit=packing.isSigned?packing.bytesPerElement===1?127:32767:packing.bytesPerElement===1?255:65535;var lowerLimit=-upperLimit-1;var n=data.length;var packed=packing.isSigned?packing.bytesPerElement===1?new Int8Array(packing.size):new Int16Array(packing.size):packing.bytesPerElement===1?new Uint8Array(packing.size):new Uint16Array(packing.size);var j=0;for(var i=0;i<n;i++){var value=data[i];if(value>=0){while(value>=upperLimit){packed[j]=upperLimit;++j;value-=upperLimit}}else{while(value<=lowerLimit){packed[j]=lowerLimit;++j;value-=lowerLimit}}packed[j]=value;++j}var result=byteArray(packed);return{encodings:[{kind:"IntegerPacking",byteCount:packing.bytesPerElement,isUnsigned:!packing.isSigned,srcSize:n},result.encodings[0]],data:result.data}}function integerPacking(data){if(!(data instanceof Int32Array)){throw new Error("Integer packing can only be applied to Int32 data.")}var packing=determinePacking(data);if(packing.bytesPerElement===4){return byteArray(data)}return _integerPacking(data,packing)}Encoder.integerPacking=integerPacking;function stringArray(data){var map=Object.create(null);var strings=[];var accLength=0;var offsets=CIFTools.Utils.ChunkedArray.create(function(s){return new Int32Array(s)},1024,1);var output=new Int32Array(data.length);CIFTools.Utils.ChunkedArray.add(offsets,0);var i=0;for(var _i=0,data_1=data;_i<data_1.length;_i++){var s=data_1[_i];if(s===null||s===void 0){output[i++]=-1;continue}var index=map[s];if(index===void 0){accLength+=s.length;index=strings.length;strings[index]=s;map[s]=index;CIFTools.Utils.ChunkedArray.add(offsets,accLength)}output[i++]=index}var encOffsets=Encoder.by(delta).and(integerPacking).encode(CIFTools.Utils.ChunkedArray.compact(offsets));var encOutput=Encoder.by(delta).and(runLength).and(integerPacking).encode(output);return{encodings:[{kind:"StringArray",dataEncoding:encOutput.encoding,stringData:strings.join(""),offsetEncoding:encOffsets.encoding,offsets:encOffsets.data}],data:encOutput.data}}Encoder.stringArray=stringArray;var _a,_b})(Encoder=Binary.Encoder||(Binary.Encoder={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";Binary.VERSION="0.3.0";var Encoding;(function(Encoding){function getDataType(data){var srcType;if(data instanceof Int8Array)srcType=1;else if(data instanceof Int16Array)srcType=2;else if(data instanceof Int32Array)srcType=3;else if(data instanceof Uint8Array)srcType=4;else if(data instanceof Uint16Array)srcType=5;else if(data instanceof Uint32Array)srcType=6;else if(data instanceof Float32Array)srcType=32;else if(data instanceof Float64Array)srcType=33;else throw new Error("Unsupported integer data type.");return srcType}Encoding.getDataType=getDataType;function isSignedIntegerDataType(data){return data instanceof Int8Array||data instanceof Int16Array||data instanceof Int32Array}Encoding.isSignedIntegerDataType=isSignedIntegerDataType})(Encoding=Binary.Encoding||(Binary.Encoding={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";function checkVersions(min,current){for(var i=0;i<2;i++){if(min[i]>current[i])return false}return true}function parse(data){var minVersion=[0,3];try{var array=new Uint8Array(data);var unpacked=Binary.MessagePack.decode(array);if(!checkVersions(minVersion,unpacked.version.match(/(\d)\.(\d)\.\d/).slice(1))){return CIFTools.ParserResult.error("Unsupported format version. Current "+unpacked.version+", required "+minVersion.join(".")+".")}var file=new Binary.File(unpacked);return CIFTools.ParserResult.success(file)}catch(e){return CIFTools.ParserResult.error(""+e)}}Binary.parse=parse})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";function encodeField(field,data,totalCount){var array,isNative=false;if(field.typedArray){array=new field.typedArray(totalCount)}else{isNative=true;array=new Array(totalCount)}var mask=new Uint8Array(totalCount);var presence=field.presence;var getter=field.number?field.number:field.string;var allPresent=true;var offset=0;for(var _i=0,data_2=data;_i<data_2.length;_i++){var _d=data_2[_i];var d=_d.data;for(var i=0,_b=_d.count;i<_b;i++){var p=presence?presence(d,i):0;if(p!==0){mask[offset]=p;if(isNative)array[offset]=null;allPresent=false}else{mask[offset]=0;array[offset]=getter(d,i)}offset++}}var encoder=field.encoder?field.encoder:Binary.Encoder.by(Binary.Encoder.stringArray);var encoded=encoder.encode(array);var maskData=void 0;if(!allPresent){var maskRLE=Binary.Encoder.by(Binary.Encoder.runLength).and(Binary.Encoder.byteArray).encode(mask);if(maskRLE.data.length<mask.length){maskData=maskRLE}else{maskData=Binary.Encoder.by(Binary.Encoder.byteArray).encode(mask)}}return{name:field.name,data:encoded,mask:maskData}}var Writer=function(){function Writer(encoder){this.dataBlocks=[];this.data={encoder:encoder,version:Binary.VERSION,dataBlocks:this.dataBlocks}}Writer.prototype.startDataBlock=function(header){this.dataBlocks.push({header:(header||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})};Writer.prototype.writeCategory=function(category,contexts){if(!this.data){throw new Error("The writer contents have already been encoded, no more writing.")}if(!this.dataBlocks.length){throw new Error("No data block created.")}var src=!contexts||!contexts.length?[category(void 0)]:contexts.map(function(c){return category(c)});var categories=src.filter(function(c){return c&&c.count>0});if(!categories.length)return;var count=categories.reduce(function(a,c){return a+c.count},0);if(!count)return;var first=categories[0];var cat={name:first.desc.name,columns:[],rowCount:count};var data=categories.map(function(c){return{data:c.data,count:c.count}});for(var _i=0,_a=first.desc.fields;_i<_a.length;_i++){var f=_a[_i];cat.columns.push(encodeField(f,data,count))}this.dataBlocks[this.dataBlocks.length-1].categories.push(cat)};Writer.prototype.encode=function(){this.encodedData=Binary.MessagePack.encode(this.data);this.data=null;this.dataBlocks=null};Writer.prototype.flush=function(stream){stream.writeBinary(this.encodedData)};return Writer}();Binary.Writer=Writer})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var LiteMolCIFTools=CIFTools;var LiteMolTHREE=function(){var THREE={REVISION:"71"};if(Math.sign===undefined){Math.sign=function(x){return x<0?-1:x>0?1:+x}}THREE.log=function(){console.log.apply(console,arguments)};THREE.warn=function(){console.warn.apply(console,arguments)};THREE.error=function(){console.error.apply(console,arguments)};THREE.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};THREE.CullFaceNone=0;THREE.CullFaceBack=1;THREE.CullFaceFront=2;THREE.CullFaceFrontBack=3;THREE.FrontFaceDirectionCW=0;THREE.FrontFaceDirectionCCW=1;THREE.BasicShadowMap=0;THREE.PCFShadowMap=1;THREE.PCFSoftShadowMap=2;THREE.FrontSide=0;THREE.BackSide=1;THREE.DoubleSide=2;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.CustomBlending=5;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.MinEquation=103;THREE.MaxEquation=104;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.AddOperation=2;THREE.UVMapping=300;THREE.CubeReflectionMapping=301;THREE.CubeRefractionMapping=302;THREE.EquirectangularReflectionMapping=303;THREE.EquirectangularRefractionMapping=304;THREE.SphericalReflectionMapping=305;THREE.RepeatWrapping=1e3;THREE.ClampToEdgeWrapping=1001;THREE.MirroredRepeatWrapping=1002;THREE.NearestFilter=1003;THREE.NearestMipMapNearestFilter=1004;THREE.NearestMipMapLinearFilter=1005;THREE.LinearFilter=1006;THREE.LinearMipMapNearestFilter=1007;THREE.LinearMipMapLinearFilter=1008;THREE.UnsignedByteType=1009;THREE.ByteType=1010;THREE.ShortType=1011;THREE.UnsignedShortType=1012;THREE.IntType=1013;THREE.UnsignedIntType=1014;THREE.FloatType=1015;THREE.HalfFloatType=1025;THREE.UnsignedShort4444Type=1016;THREE.UnsignedShort5551Type=1017;THREE.UnsignedShort565Type=1018;THREE.AlphaFormat=1019;THREE.RGBFormat=1020;THREE.RGBAFormat=1021;THREE.LuminanceFormat=1022;THREE.LuminanceAlphaFormat=1023;THREE.RGBEFormat=THREE.RGBAFormat;THREE.RGB_S3TC_DXT1_Format=2001;THREE.RGBA_S3TC_DXT1_Format=2002;THREE.RGBA_S3TC_DXT3_Format=2003;THREE.RGBA_S3TC_DXT5_Format=2004;THREE.RGB_PVRTC_4BPPV1_Format=2100;THREE.RGB_PVRTC_2BPPV1_Format=2101;THREE.RGBA_PVRTC_4BPPV1_Format=2102;THREE.RGBA_PVRTC_2BPPV1_Format=2103;THREE.Projector=function(){THREE.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(vector,camera){THREE.warn("THREE.Projector: .projectVector() is now vector.project().");vector.project(camera)};this.unprojectVector=function(vector,camera){THREE.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");vector.unproject(camera)};this.pickingRay=function(vector,camera){THREE.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};THREE.CanvasRenderer=function(){THREE.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElement("canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};THREE.Color=function(color){if(arguments.length===3){return this.setRGB(arguments[0],arguments[1],arguments[2])}return this.set(color)};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(value){if(value instanceof THREE.Color){this.copy(value)}else if(typeof value==="number"){this.setHex(value)}else if(typeof value==="string"){this.setStyle(value)}return this},setHex:function(hex){hex=Math.floor(hex);this.r=(hex>>16&255)/255;this.g=(hex>>8&255)/255;this.b=(hex&255)/255;return this},setRGB:function(r,g,b){this.r=r;this.g=g;this.b=b;return this},setHSL:function(h,s,l){if(s===0){this.r=this.g=this.b=l}else{var hue2rgb=function(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*6*(2/3-t);return p};var p=l<=.5?l*(1+s):l+s-l*s;var q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this},setStyle:function(style){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(style)){var color=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(style);this.r=Math.min(255,parseInt(color[1],10))/255;this.g=Math.min(255,parseInt(color[2],10))/255;this.b=Math.min(255,parseInt(color[3],10))/255;return this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(style)){var color=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(style);this.r=Math.min(100,parseInt(color[1],10))/100;this.g=Math.min(100,parseInt(color[2],10))/100;this.b=Math.min(100,parseInt(color[3],10))/100;return this}if(/^\#([0-9a-f]{6})$/i.test(style)){var color=/^\#([0-9a-f]{6})$/i.exec(style);this.setHex(parseInt(color[1],16));return this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(style)){var color=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(style);this.setHex(parseInt(color[1]+color[1]+color[2]+color[2]+color[3]+color[3],16));return this}if(/^(\w+)$/i.test(style)){this.setHex(THREE.ColorKeywords[style]);return this}},copy:function(color){this.r=color.r;this.g=color.g;this.b=color.b;return this},copyGammaToLinear:function(color,gammaFactor){if(gammaFactor===undefined)gammaFactor=2;this.r=Math.pow(color.r,gammaFactor);this.g=Math.pow(color.g,gammaFactor);this.b=Math.pow(color.b,gammaFactor);return this},copyLinearToGamma:function(color,gammaFactor){if(gammaFactor===undefined)gammaFactor=2;var safeInverse=gammaFactor>0?1/gammaFactor:1;this.r=Math.pow(color.r,safeInverse);this.g=Math.pow(color.g,safeInverse);this.b=Math.pow(color.b,safeInverse);return this},convertGammaToLinear:function(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(optionalTarget){var hsl=optionalTarget||{h:0,s:0,l:0};var r=this.r,g=this.g,b=this.b;var max=Math.max(r,g,b);var min=Math.min(r,g,b);var hue,saturation;var lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=lightness<=.5?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this},add:function(color){this.r+=color.r;this.g+=color.g;this.b+=color.b;return this},addColors:function(color1,color2){this.r=color1.r+color2.r;this.g=color1.g+color2.g;this.b=color1.b+color2.b;return this},addScalar:function(s){this.r+=s;this.g+=s;this.b+=s;return this},multiply:function(color){this.r*=color.r;this.g*=color.g;this.b*=color.b;return this},multiplyScalar:function(s){this.r*=s;this.g*=s;this.b*=s;return this},lerp:function(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function(array){this.r=array[0];this.g=array[1];this.b=array[2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.r;array[offset+1]=this.g;array[offset+2]=this.b;return array},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};THREE.Quaternion=function(x,y,z,w){this._x=x||0;this._y=y||0;this._z=z||0;this._w=w!==undefined?w:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get w(){return this._w},set w(value){this._w=value;this.onChangeCallback()},set:function(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this.onChangeCallback();return this},copy:function(quaternion){this._x=quaternion.x;this._y=quaternion.y;this._z=quaternion.z;this._w=quaternion.w;this.onChangeCallback();return this},setFromEuler:function(euler,update){if(euler instanceof THREE.Euler===false){throw new Error("THREE.Quaternion: .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var c1=Math.cos(euler._x/2);var c2=Math.cos(euler._y/2);var c3=Math.cos(euler._z/2);var s1=Math.sin(euler._x/2);var s2=Math.sin(euler._y/2);var s3=Math.sin(euler._z/2);if(euler.order==="XYZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="YXZ"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(euler.order==="ZXY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="ZYX"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if(euler.order==="YZX"){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if(euler.order==="XZY"){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}if(update!==false)this.onChangeCallback();return this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=Math.sin(halfAngle);this._x=axis.x*s;this._y=axis.y*s;this._z=axis.z*s;this._w=Math.cos(halfAngle);this.onChangeCallback();return this},setFromRotationMatrix:function(m){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(trace>0){s=.5/Math.sqrt(trace+1);this._w=.25/s;this._x=(m32-m23)*s;this._y=(m13-m31)*s;this._z=(m21-m12)*s}else if(m11>m22&&m11>m33){s=2*Math.sqrt(1+m11-m22-m33);this._w=(m32-m23)/s;this._x=.25*s;this._y=(m12+m21)/s;this._z=(m13+m31)/s}else if(m22>m33){s=2*Math.sqrt(1+m22-m11-m33);this._w=(m13-m31)/s;this._x=(m12+m21)/s;this._y=.25*s;this._z=(m23+m32)/s}else{s=2*Math.sqrt(1+m33-m11-m22);this._w=(m21-m12)/s;this._x=(m13+m31)/s;this._y=(m23+m32)/s;this._z=.25*s}this.onChangeCallback();return this},setFromUnitVectors:function(){var v1,r;var EPS=1e-6;return function(vFrom,vTo){if(v1===undefined)v1=new THREE.Vector3;r=vFrom.dot(vTo)+1;if(r<EPS){r=0;if(Math.abs(vFrom.x)>Math.abs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0)}else{v1.set(0,-vFrom.z,vFrom.y)}}else{v1.crossVectors(vFrom,vTo)}this._x=v1.x;this._y=v1.y;this._z=v1.z;this._w=r;this.normalize();return this}}(),inverse:function(){this.conjugate().normalize();return this},conjugate:function(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var l=this.length();if(l===0){this._x=0;this._y=0;this._z=0;this._w=1}else{l=1/l;this._x=this._x*l;this._y=this._y*l;this._z=this._z*l;this._w=this._w*l}this.onChangeCallback();return this},multiply:function(q,p){if(p!==undefined){THREE.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(q,p)}return this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w;var qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;this.onChangeCallback();return this},multiplyVector3:function(vector){THREE.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return vector.applyQuaternion(this)},slerp:function(qb,t){if(t===0)return this;if(t===1)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w;var cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(cosHalfTheta<0){this._w=-qb._w;this._x=-qb._x;this._y=-qb._y;this._z=-qb._z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(cosHalfTheta>=1){this._w=w;this._x=x;this._y=y;this._z=z;return this}var halfTheta=Math.acos(cosHalfTheta);var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)<.001){this._w=.5*(w+this._w);this._x=.5*(x+this._x);this._y=.5*(y+this._y);this._z=.5*(z+this._z);return this}var ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;this._w=w*ratioA+this._w*ratioB;this._x=x*ratioA+this._x*ratioB;this._y=y*ratioA+this._y*ratioB;this._z=z*ratioA+this._z*ratioB;this.onChangeCallback();return this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function(array,offset){if(offset===undefined)offset=0;this._x=array[offset];this._y=array[offset+1];this._z=array[offset+2];this._w=array[offset+3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._w;return array},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}};THREE.Quaternion.slerp=function(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)};THREE.Vector2=function(x,y){this.x=x||0;this.y=y||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(x,y){this.x=x;this.y=y;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;return this},add:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;return this},addScalar:function(s){this.x+=s;this.y+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},sub:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;return this},subScalar:function(s){this.x-=s;this.y-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function(v){this.x*=v.x;this.y*=v.y;return this},multiplyScalar:function(s){this.x*=s;this.y*=s;return this},divide:function(v){this.x/=v.x;this.y/=v.y;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar}else{this.x=0;this.y=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector2;max=new THREE.Vector2}min.set(minVal,minVal);max.set(maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);return this},negate:function(){this.x=-this.x;this.y=-this.y;return this},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];return this},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},add:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},sub:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;return this},subScalar:function(s){this.x-=s;this.y-=s;this.z-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(v,w)}this.x*=v.x;this.y*=v.y;this.z*=v.z;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;return this},multiplyVectors:function(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var quaternion;return function(euler){if(euler instanceof THREE.Euler===false){THREE.error("THREE.Vector3: .applyEuler() now expects a Euler rotation rather than a Vector3 and order.")}if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromEuler(euler));return this}}(),applyAxisAngle:function(){var quaternion;return function(axis,angle){if(quaternion===undefined)quaternion=new THREE.Quaternion;this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle));return this}}(),applyMatrix3:function(m){var x=this.x;var y=this.y;var z=this.z;var e=m.elements;this.x=e[0]*x+e[3]*y+e[6]*z;this.y=e[1]*x+e[4]*y+e[7]*z;this.z=e[2]*x+e[5]*y+e[8]*z;return this},applyMatrix4:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12];this.y=e[1]*x+e[5]*y+e[9]*z+e[13];this.z=e[2]*x+e[6]*y+e[10]*z+e[14];return this},applyProjection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;var d=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*d;this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*d;this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*d;return this},applyQuaternion:function(q){var x=this.x;var y=this.y;var z=this.z;var qx=q.x;var qy=q.y;var qz=q.z;var qw=q.w;var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this},project:function(){var matrix;return function(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld));return this.applyProjection(matrix)}}(),unproject:function(){var matrix;return function(camera){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix));return this.applyProjection(matrix)}}(),transformDirection:function(m){var x=this.x,y=this.y,z=this.z;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z;this.y=e[1]*x+e[5]*y+e[9]*z;this.z=e[2]*x+e[6]*y+e[10]*z;this.normalize();return this},divide:function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar}else{this.x=0;this.y=0;this.z=0}return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector3;max=new THREE.Vector3}min.set(minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},cross:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(v,w)}var x=this.x,y=this.y,z=this.z;this.x=y*v.z-z*v.y;this.y=z*v.x-x*v.z;this.z=x*v.y-y*v.x;return this},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z;var bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this},projectOnVector:function(){var v1,dot;return function(vector){if(v1===undefined)v1=new THREE.Vector3;v1.copy(vector).normalize();dot=this.dot(v1);return this.copy(v1).multiplyScalar(dot)}}(),projectOnPlane:function(){var v1;return function(planeNormal){if(v1===undefined)v1=new THREE.Vector3;v1.copy(this).projectOnVector(planeNormal);return this.sub(v1)}}(),reflect:function(){var v1;return function(normal){if(v1===undefined)v1=new THREE.Vector3;return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function(v){var theta=this.dot(v)/(this.length()*v.length());return Math.acos(THREE.Math.clamp(theta,-1,1))},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},distanceToSquared:function(v){var dx=this.x-v.x;var dy=this.y-v.y;var dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},setEulerFromRotationMatrix:function(m,order){THREE.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(q,order){THREE.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(m){THREE.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(m)},getScaleFromMatrix:function(m){THREE.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(m)},getColumnFromMatrix:function(index,matrix){THREE.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(index,matrix)},setFromMatrixPosition:function(m){this.x=m.elements[12];this.y=m.elements[13];this.z=m.elements[14];return this},setFromMatrixScale:function(m){var sx=this.set(m.elements[0],m.elements[1],m.elements[2]).length();var sy=this.set(m.elements[4],m.elements[5],m.elements[6]).length();var sz=this.set(m.elements[8],m.elements[9],m.elements[10]).length();this.x=sx;this.y=sy;this.z=sz;return this},setFromMatrixColumn:function(index,matrix){var offset=index*4;var me=matrix.elements;this.x=me[offset];this.y=me[offset+1];this.z=me[offset+2];return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];this.z=attribute.array[index+2];return this},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==undefined?w:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},setX:function(x){this.x=x;return this},setY:function(y){this.y=y;return this},setZ:function(z){this.z=z;return this},setW:function(w){this.w=w;return this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index)}},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index)}},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w!==undefined?v.w:1;return this},add:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},addScalar:function(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s;return this},addVectors:function(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},sub:function(v,w){if(w!==undefined){THREE.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},subScalar:function(s){this.x-=s;this.y-=s;this.z-=s;this.w-=s;return this},subVectors:function(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;this.w*=scalar;return this},applyMatrix4:function(m){var x=this.x;var y=this.y;var z=this.z;var w=this.w;var e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;return this},divideScalar:function(scalar){if(scalar!==0){var invScalar=1/scalar;this.x*=invScalar;this.y*=invScalar;this.z*=invScalar;this.w*=invScalar}else{this.x=0;this.y=0;this.z=0;this.w=1}return this},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);var s=Math.sqrt(1-q.w*q.w);if(s<1e-4){this.x=1;this.y=0;this.z=0}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s}return this},setAxisAngleFromRotationMatrix:function(m){var angle,x,y,z,epsilon=.01,epsilon2=.1,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(Math.abs(m12-m21)<epsilon&&Math.abs(m13-m31)<epsilon&&Math.abs(m23-m32)<epsilon){if(Math.abs(m12+m21)<epsilon2&&Math.abs(m13+m31)<epsilon2&&Math.abs(m23+m32)<epsilon2&&Math.abs(m11+m22+m33-3)<epsilon2){this.set(1,0,0,0);return this}angle=Math.PI;var xx=(m11+1)/2;var yy=(m22+1)/2;var zz=(m33+1)/2;var xy=(m12+m21)/4;var xz=(m13+m31)/4;var yz=(m23+m32)/4;if(xx>yy&&xx>zz){if(xx<epsilon){x=0;y=.707106781;z=.707106781}else{x=Math.sqrt(xx);y=xy/x;z=xz/x}}else if(yy>zz){if(yy<epsilon){x=.707106781;y=0;z=.707106781}else{y=Math.sqrt(yy);x=xy/y;z=yz/y}}else{if(zz<epsilon){x=.707106781;y=.707106781;z=0}else{z=Math.sqrt(zz);x=xz/z;y=yz/z}}this.set(x,y,z,angle);return this}var s=Math.sqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));if(Math.abs(s)<.001)s=1;this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=Math.acos((m11+m22+m33-1)/2);return this},min:function(v){if(this.x>v.x){this.x=v.x}if(this.y>v.y){this.y=v.y}if(this.z>v.z){this.z=v.z}if(this.w>v.w){this.w=v.w}return this},max:function(v){if(this.x<v.x){this.x=v.x}if(this.y<v.y){this.y=v.y}if(this.z<v.z){this.z=v.z}if(this.w<v.w){this.w=v.w}return this},clamp:function(min,max){if(this.x<min.x){this.x=min.x}else if(this.x>max.x){this.x=max.x}if(this.y<min.y){this.y=min.y}else if(this.y>max.y){this.y=max.y}if(this.z<min.z){this.z=min.z}else if(this.z>max.z){this.z=max.z}if(this.w<min.w){this.w=min.w}else if(this.w>max.w){this.w=max.w}return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===undefined){min=new THREE.Vector4;max=new THREE.Vector4}min.set(minVal,minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.z=Math.floor(this.z);this.w=Math.floor(this.w);return this},ceil:function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);this.z=Math.ceil(this.z);this.w=Math.ceil(this.w);return this},round:function(){this.x=Math.round(this.x);this.y=Math.round(this.y);this.z=Math.round(this.z);this.w=Math.round(this.w);return this},roundToZero:function(){this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x);this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y);this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z);this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w);return this},negate:function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(l){var oldLength=this.length();if(oldLength!==0&&l!==oldLength){this.multiplyScalar(l/oldLength)}return this},lerp:function(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this},lerpVectors:function(v1,v2,alpha){this.subVectors(v2,v1).multiplyScalar(alpha).add(v1);return this},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function(array,offset){if(offset===undefined)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];this.w=array[offset+3];return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;array[offset+3]=this.w;return array},fromAttribute:function(attribute,index,offset){if(offset===undefined)offset=0;index=index*attribute.itemSize+offset;this.x=attribute.array[index];this.y=attribute.array[index+1];this.z=attribute.array[index+2];this.w=attribute.array[index+3];return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Euler=function(x,y,z,order){this._x=x||0;this._y=y||0;this._z=z||0;this._order=order||THREE.Euler.DefaultOrder};THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];THREE.Euler.DefaultOrder="XYZ";THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,get x(){return this._x},set x(value){this._x=value;this.onChangeCallback()},get y(){return this._y},set y(value){this._y=value;this.onChangeCallback()},get z(){return this._z},set z(value){this._z=value;this.onChangeCallback()},get order(){return this._order},set order(value){this._order=value;this.onChangeCallback()},set:function(x,y,z,order){this._x=x;this._y=y;this._z=z;this._order=order||this._order;this.onChangeCallback();return this},copy:function(euler){this._x=euler._x;this._y=euler._y;this._z=euler._z;this._order=euler._order;this.onChangeCallback();return this},setFromRotationMatrix:function(m,order,update){var clamp=THREE.Math.clamp;var te=m.elements;var m11=te[0],m12=te[4],m13=te[8];var m21=te[1],m22=te[5],m23=te[9];var m31=te[2],m32=te[6],m33=te[10];order=order||this._order;if(order==="XYZ"){this._y=Math.asin(clamp(m13,-1,1));if(Math.abs(m13)<.99999){this._x=Math.atan2(-m23,m33);this._z=Math.atan2(-m12,m11)}else{this._x=Math.atan2(m32,m22);this._z=0}}else if(order==="YXZ"){this._x=Math.asin(-clamp(m23,-1,1));if(Math.abs(m23)<.99999){this._y=Math.atan2(m13,m33);this._z=Math.atan2(m21,m22)}else{this._y=Math.atan2(-m31,m11);this._z=0}}else if(order==="ZXY"){this._x=Math.asin(clamp(m32,-1,1));if(Math.abs(m32)<.99999){this._y=Math.atan2(-m31,m33);this._z=Math.atan2(-m12,m22)}else{this._y=0;this._z=Math.atan2(m21,m11)}}else if(order==="ZYX"){this._y=Math.asin(-clamp(m31,-1,1));if(Math.abs(m31)<.99999){this._x=Math.atan2(m32,m33);this._z=Math.atan2(m21,m11)}else{this._x=0;this._z=Math.atan2(-m12,m22)}}else if(order==="YZX"){this._z=Math.asin(clamp(m21,-1,1));if(Math.abs(m21)<.99999){this._x=Math.atan2(-m23,m22);this._y=Math.atan2(-m31,m11)}else{this._x=0;this._y=Math.atan2(m13,m33)}}else if(order==="XZY"){this._z=Math.asin(-clamp(m12,-1,1));if(Math.abs(m12)<.99999){this._x=Math.atan2(m32,m22);this._y=Math.atan2(m13,m11)}else{this._x=Math.atan2(-m23,m33);this._y=0}}else{THREE.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order)}this._order=order;if(update!==false)this.onChangeCallback();return this},setFromQuaternion:function(){var matrix;return function(q,order,update){if(matrix===undefined)matrix=new THREE.Matrix4;matrix.makeRotationFromQuaternion(q);this.setFromRotationMatrix(matrix,order,update);return this}}(),setFromVector3:function(v,order){return this.set(v.x,v.y,v.z,order||this._order)},reorder:function(){var q=new THREE.Quaternion;return function(newOrder){q.setFromEuler(this);this.setFromQuaternion(q,newOrder)}}(),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function(array){this._x=array[0];this._y=array[1];this._z=array[2];if(array[3]!==undefined)this._order=array[3];this.onChangeCallback();return this},toArray:function(array,offset){if(array===undefined)array=[];if(offset===undefined)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._order;return array},toVector3:function(optionalResult){if(optionalResult){return optionalResult.set(this._x,this._y,this._z)}else{return new THREE.Vector3(this._x,this._y,this._z)}},onChange:function(callback){this.onChangeCallback=callback;return this},onChangeCallback:function(){},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}};THREE.Line3=function(start,end){this.start=start!==undefined?start:new THREE.Vector3;this.end=end!==undefined?end:new THREE.Vector3};THREE.Line3.prototype={constructor:THREE.Line3,set:function(start,end){this.start.copy(start);this.end.copy(end);return this},copy:function(line){this.start.copy(line.start);this.end.copy(line.end);return this},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var startP=new THREE.Vector3;var startEnd=new THREE.Vector3;return function(point,clampToLine){startP.subVectors(point,this.start);startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd);var startEnd_startP=startEnd.dot(startP);var t=startEnd_startP/startEnd2;if(clampToLine){t=THREE.Math.clamp(t,0,1)}return t}}(),closestPointToPoint:function(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine);var result=optionalTarget||new THREE.Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},applyMatrix4:function(matrix){this.start.applyMatrix4(matrix);this.end.applyMatrix4(matrix);return this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}};THREE.Box2=function(min,max){this.min=min!==undefined?min:new THREE.Vector2(Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector2(-Infinity,-Infinity)};THREE.Box2.prototype={constructor:THREE.Box2,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=Infinity;this.max.x=this.max.y=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector2;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector2;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}};THREE.Box3=function(min,max){this.min=min!==undefined?min:new THREE.Vector3(Infinity,Infinity,Infinity);this.max=max!==undefined?max:new THREE.Vector3(-Infinity,-Infinity,-Infinity)};THREE.Box3.prototype={constructor:THREE.Box3,set:function(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new THREE.Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),setFromObject:function(){var v1=new THREE.Vector3;return function(object){var scope=this;object.updateMatrixWorld(true);this.makeEmpty();object.traverse(function(node){var geometry=node.geometry;if(geometry!==undefined){if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;for(var i=0,il=vertices.length;i<il;i++){v1.copy(vertices[i]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}else if(geometry instanceof THREE.BufferGeometry&&geometry.attributes["position"]!==undefined){var positions=geometry.attributes["position"].array;for(var i=0,il=positions.length;i<il;i+=3){v1.set(positions[i],positions[i+1],positions[i+2]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}}});return this}}(),copy:function(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function(){this.min.x=this.min.y=this.min.z=Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.subVectors(this.max,this.min)},expandByPoint:function(point){this.min.min(point);this.max.max(point);return this},expandByVector:function(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function(point){if(point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z){return false}return true},containsBox:function(box){if(this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z){return true}return false},getParameter:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(box){if(box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z){return false}return true},clampPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),getBoundingSphere:function(){var v1=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Sphere;result.center=this.center();result.radius=this.size(v1).length()*.5;return result}}(),intersect:function(box){this.min.max(box.min);this.max.min(box.max);return this},union:function(box){this.min.min(box.min);this.max.max(box.max);return this},applyMatrix4:function(){var points=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(matrix){points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);this.makeEmpty();this.setFromPoints(points);return this}}(),translate:function(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}};THREE.Matrix3=function(){this.elements=new Float32Array([1,0,0,0,1,0,0,0,1]);if(arguments.length>0){THREE.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;te[0]=n11;te[3]=n12;te[6]=n13;te[1]=n21;te[4]=n22;te[7]=n23;te[2]=n31;te[5]=n32;te[8]=n33;return this},identity:function(){this.set(1,0,0,0,1,0,0,0,1);return this},copy:function(m){var me=m.elements;this.set(me[0],me[3],me[6],me[1],me[4],me[7],me[2],me[5],me[8]);return this},multiplyVector3:function(vector){THREE.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return vector.applyMatrix3(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix3: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1=new THREE.Vector3;return function(array,offset,length){if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset;i<length;i+=3,j+=3){v1.x=array[j];v1.y=array[j+1];v1.z=array[j+2];v1.applyMatrix3(this);array[j]=v1.x;array[j+1]=v1.y;array[j+2]=v1.z}return array}}(),multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[3]*=s;te[6]*=s;te[1]*=s;te[4]*=s;te[7]*=s;te[2]*=s;te[5]*=s;te[8]*=s;return this},determinant:function(){var te=this.elements;var a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function(matrix,throwOnInvertible){var me=matrix.elements;var te=this.elements;te[0]=me[10]*me[5]-me[6]*me[9];te[1]=-me[10]*me[1]+me[2]*me[9];te[2]=me[6]*me[1]-me[2]*me[5];te[3]=-me[10]*me[4]+me[6]*me[8];te[4]=me[10]*me[0]-me[2]*me[8];te[5]=-me[6]*me[0]+me[2]*me[4];te[6]=me[9]*me[4]-me[5]*me[8];te[7]=-me[9]*me[0]+me[1]*me[8];te[8]=me[5]*me[0]-me[1]*me[4];var det=me[0]*te[0]+me[1]*te[3]+me[2]*te[6];if(det===0){var msg="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{THREE.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},transpose:function(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];return array},getNormalMatrix:function(m){this.getInverse(m).transpose();return this},transposeIntoArray:function(r){var m=this.elements;r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8]]},clone:function(){return(new THREE.Matrix3).fromArray(this.elements)}};THREE.Matrix4=function(){this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);if(arguments.length>0){THREE.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(m){this.elements.set(m.elements);return this},extractPosition:function(m){THREE.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(m)},copyPosition:function(m){var te=this.elements;var me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this},extractBasis:function(xAxis,yAxis,zAxis){var te=this.elements;xAxis.set(te[0],te[1],te[2]);yAxis.set(te[4],te[5],te[6]);zAxis.set(te[8],te[9],te[10]);return this},makeBasis:function(xAxis,yAxis,zAxis){this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1);return this},extractRotation:function(){var v1=new THREE.Vector3;return function(m){var te=this.elements;var me=m.elements;var scaleX=1/v1.set(me[0],me[1],me[2]).length();var scaleY=1/v1.set(me[4],me[5],me[6]).length();var scaleZ=1/v1.set(me[8],me[9],me[10]).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this}}(),makeRotationFromEuler:function(euler){if(euler instanceof THREE.Euler===false){THREE.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var te=this.elements;var x=euler.x,y=euler.y,z=euler.z;var a=Math.cos(x),b=Math.sin(x);var c=Math.cos(y),d=Math.sin(y);var e=Math.cos(z),f=Math.sin(z);if(euler.order==="XYZ"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c}else if(euler.order==="YXZ"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c}else if(euler.order==="ZXY"){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c}else if(euler.order==="ZYX"){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c}else if(euler.order==="YZX"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f}else if(euler.order==="XZY"){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},setRotationFromQuaternion:function(q){THREE.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(q)},makeRotationFromQuaternion:function(q){var te=this.elements;var x=q.x,y=q.y,z=q.z,w=q.w;var x2=x+x,y2=y+y,z2=z+z;var xx=x*x2,xy=x*y2,xz=x*z2;var yy=y*y2,yz=y*z2,zz=z*z2;var wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},lookAt:function(){var x=new THREE.Vector3;var y=new THREE.Vector3;var z=new THREE.Vector3;return function(eye,target,up){var te=this.elements;z.subVectors(eye,target).normalize();if(z.length()===0){z.z=1}x.crossVectors(up,z).normalize();if(x.length()===0){z.x+=1e-4;x.crossVectors(up,z).normalize()}y.crossVectors(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this}}(),multiply:function(m,n){if(n!==undefined){THREE.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(m,n)}return this.multiplyMatrices(this,m)},multiplyMatrices:function(a,b){var ae=a.elements;var be=b.elements;var te=this.elements;var a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12];var a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13];var a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14];var a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15];var b11=be[0],b12=be[4],b13=be[8],b14=be[12];var b21=be[1],b22=be[5],b23=be[9],b24=be[13];var b31=be[2],b32=be[6],b33=be[10],b34=be[14];var b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this},multiplyToArray:function(a,b,r){var te=this.elements;this.multiplyMatrices(a,b);r[0]=te[0];r[1]=te[1];r[2]=te[2];r[3]=te[3];r[4]=te[4];r[5]=te[5];r[6]=te[6];r[7]=te[7];r[8]=te[8];r[9]=te[9];r[10]=te[10];r[11]=te[11];r[12]=te[12];r[13]=te[13];r[14]=te[14];r[15]=te[15];return this},multiplyScalar:function(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this},multiplyVector3:function(vector){THREE.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead.");return vector.applyProjection(this)},multiplyVector4:function(vector){THREE.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},multiplyVector3Array:function(a){THREE.warn("THREE.Matrix4: .multiplyVector3Array() has been renamed. Use matrix.applyToVector3Array( array ) instead.");return this.applyToVector3Array(a)},applyToVector3Array:function(){var v1=new THREE.Vector3;return function(array,offset,length){if(offset===undefined)offset=0;if(length===undefined)length=array.length;for(var i=0,j=offset;i<length;i+=3,j+=3){v1.x=array[j];v1.y=array[j+1];v1.z=array[j+2];v1.applyMatrix4(this);array[j]=v1.x;array[j+1]=v1.y;array[j+2]=v1.z}return array}}(),rotateAxis:function(v){THREE.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");v.transformDirection(this)},crossVector:function(vector){THREE.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},determinant:function(){var te=this.elements;var n11=te[0],n12=te[4],n13=te[8],n14=te[12];var n21=te[1],n22=te[5],n23=te[9],n24=te[13];var n31=te[2],n32=te[6],n33=te[10],n34=te[14];var n41=te[3],n42=te[7],n43=te[11],n44=te[15];return n41*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+n42*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+n43*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+n44*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function(){var te=this.elements;var tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this},flattenToArrayOffset:function(array,offset){var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];array[offset+9]=te[9];array[offset+10]=te[10];array[offset+11]=te[11];array[offset+12]=te[12];array[offset+13]=te[13];array[offset+14]=te[14];array[offset+15]=te[15];return array},getPosition:function(){var v1=new THREE.Vector3;return function(){THREE.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var te=this.elements;return v1.set(te[12],te[13],te[14])}}(),setPosition:function(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this},getInverse:function(m,throwOnInvertible){var te=this.elements;var me=m.elements;var n11=me[0],n12=me[4],n13=me[8],n14=me[12];var n21=me[1],n22=me[5],n23=me[9],n24=me[13];var n31=me[2],n32=me[6],n33=me[10],n34=me[14];var n41=me[3],n42=me[7],n43=me[11],n44=me[15];te[0]=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44;te[4]=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44;te[8]=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44;te[12]=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34;te[1]=n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44;te[5]=n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44;te[9]=n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44;te[13]=n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34;te[2]=n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44;te[6]=n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44;te[10]=n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44;te[14]=n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34;te[3]=n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43;te[7]=n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43;te[11]=n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43;te[15]=n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33;var det=n11*te[0]+n21*te[4]+n31*te[8]+n41*te[12];if(det==0){var msg="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(throwOnInvertible||false){throw new Error(msg)}else{THREE.warn(msg)}this.identity();return this}this.multiplyScalar(1/det);return this},translate:function(v){THREE.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(angle){THREE.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(angle){THREE.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(angle){THREE.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(axis,angle){THREE.error("THREE.Matrix4: .rotateByAxis() has been removed.")},scale:function(v){var te=this.elements;var x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this},getMaxScaleOnAxis:function(){var te=this.elements;var scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2];var scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6];var scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return Math.sqrt(Math.max(scaleXSq,Math.max(scaleYSq,scaleZSq)))},makeTranslation:function(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this},makeRotationX:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this},makeRotationY:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this},makeRotationZ:function(theta){var c=Math.cos(theta),s=Math.sin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(axis,angle){var c=Math.cos(angle);var s=Math.sin(angle);var t=1-c;var x=axis.x,y=axis.y,z=axis.z;var tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this},makeScale:function(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this},compose:function(position,quaternion,scale){this.makeRotationFromQuaternion(quaternion);this.scale(scale);this.setPosition(position);return this},decompose:function(){var vector=new THREE.Vector3;var matrix=new THREE.Matrix4;return function(position,quaternion,scale){var te=this.elements;var sx=vector.set(te[0],te[1],te[2]).length();var sy=vector.set(te[4],te[5],te[6]).length();var sz=vector.set(te[8],te[9],te[10]).length();var det=this.determinant();if(det<0){sx=-sx}position.x=te[12];position.y=te[13];position.z=te[14];matrix.elements.set(this.elements);var invSX=1/sx;var invSY=1/sy;var invSZ=1/sz;matrix.elements[0]*=invSX;matrix.elements[1]*=invSX;matrix.elements[2]*=invSX;matrix.elements[4]*=invSY;matrix.elements[5]*=invSY;matrix.elements[6]*=invSY;matrix.elements[8]*=invSZ;matrix.elements[9]*=invSZ;matrix.elements[10]*=invSZ;quaternion.setFromRotationMatrix(matrix);scale.x=sx;scale.y=sy;scale.z=sz;return this}}(),makeFrustum:function(left,right,bottom,top,near,far){var te=this.elements;var x=2*near/(right-left);var y=2*near/(top-bottom);var a=(right+left)/(right-left);var b=(top+bottom)/(top-bottom);var c=-(far+near)/(far-near);var d=-2*far*near/(far-near);te[0]=x;te[4]=0;te[8]=a;te[12]=0;te[1]=0;te[5]=y;te[9]=b;te[13]=0;te[2]=0;te[6]=0;te[10]=c;te[14]=d;te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this},makePerspective:function(fov,aspect,near,far){var ymax=near*Math.tan(THREE.Math.degToRad(fov*.5));var ymin=-ymax;var xmin=ymin*aspect;var xmax=ymax*aspect;return this.makeFrustum(xmin,xmax,ymin,ymax,near,far)},makeOrthographic:function(left,right,top,bottom,near,far){var te=this.elements;var w=right-left;var h=top-bottom;var p=far-near;var x=(right+left)/w;var y=(top+bottom)/h;var z=(far+near)/p;te[0]=2/w;te[4]=0;te[8]=0;te[12]=-x;te[1]=0;te[5]=2/h;te[9]=0;te[13]=-y;te[2]=0;te[6]=0;te[10]=-2/p;te[14]=-z;te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this},fromArray:function(array){this.elements.set(array);return this},toArray:function(){var te=this.elements;return[te[0],te[1],te[2],te[3],te[4],te[5],te[6],te[7],te[8],te[9],te[10],te[11],te[12],te[13],te[14],te[15]]},clone:function(){return(new THREE.Matrix4).fromArray(this.elements)}};THREE.Ray=function(origin,direction){this.origin=origin!==undefined?origin:new THREE.Vector3;this.direction=direction!==undefined?direction:new THREE.Vector3};THREE.Ray.prototype={constructor:THREE.Ray,set:function(origin,direction){this.origin.copy(origin);this.direction.copy(direction);return this},copy:function(ray){this.origin.copy(ray.origin);this.direction.copy(ray.direction);return this},at:function(t,optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.direction).multiplyScalar(t).add(this.origin)},recast:function(){var v1=new THREE.Vector3;return function(t){this.origin.copy(this.at(t,v1));return this}}(),closestPointToPoint:function(point,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);if(directionDistance<0){return result.copy(this.origin)}return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function(){var v1=new THREE.Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);if(directionDistance<0){return this.origin.distanceTo(point)}v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);return v1.distanceTo(point)}}(),distanceSqToSegment:function(){var segCenter=new THREE.Vector3;var segDir=new THREE.Vector3;var diff=new THREE.Vector3;return function(v0,v1,optionalPointOnRay,optionalPointOnSegment){segCenter.copy(v0).add(v1).multiplyScalar(.5);segDir.copy(v1).sub(v0).normalize();diff.copy(this.origin).sub(segCenter);var segExtent=v0.distanceTo(v1)*.5;var a01=-this.direction.dot(segDir);var b0=diff.dot(this.direction);var b1=-diff.dot(segDir);var c=diff.lengthSq();var det=Math.abs(1-a01*a01);var s0,s1,sqrDist,extDet;if(det>0){s0=a01*b1-b0;s1=a01*b0-b1;extDet=segExtent*det;if(s0>=0){if(s1>=-extDet){if(s1<=extDet){var invDet=1/det;s0*=invDet;s1*=invDet;sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else{s1=segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{s1=-segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{if(s1<=-extDet){s0=Math.max(0,-(-a01*segExtent+b0));s1=s0>0?-segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}else if(s1<=extDet){s0=0;s1=Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=s1*(s1+2*b1)+c}else{s0=Math.max(0,-(a01*segExtent+b0));s1=s0>0?segExtent:Math.min(Math.max(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}}}else{s1=a01>0?-segExtent:segExtent;s0=Math.max(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}if(optionalPointOnRay){optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin)}if(optionalPointOnSegment){optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter)}return sqrDist}}(),isIntersectionSphere:function(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},intersectSphere:function(){var v1=new THREE.Vector3;return function(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction);var d2=v1.dot(v1)-tca*tca;var radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;var thc=Math.sqrt(radius2-d2);var t0=tca-thc;var t1=tca+thc;if(t0<0&&t1<0)return null;if(t0<0)return this.at(t1,optionalTarget);return this.at(t0,optionalTarget)}}(),isIntersectionPlane:function(plane){var distToPoint=plane.distanceToPoint(this.origin);if(distToPoint===0){return true}var denominator=plane.normal.dot(this.direction);if(denominator*distToPoint<0){return true}return false},distanceToPlane:function(plane){var denominator=plane.normal.dot(this.direction);if(denominator==0){if(plane.distanceToPoint(this.origin)==0){return 0}return null}var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return t>=0?t:null},intersectPlane:function(plane,optionalTarget){var t=this.distanceToPlane(plane);if(t===null){return null}return this.at(t,optionalTarget)},isIntersectionBox:function(){var v=new THREE.Vector3;return function(box){return this.intersectBox(box,v)!==null}}(),intersectBox:function(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax;var invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z;var origin=this.origin;if(invdirx>=0){tmin=(box.min.x-origin.x)*invdirx;tmax=(box.max.x-origin.x)*invdirx}else{tmin=(box.max.x-origin.x)*invdirx;tmax=(box.min.x-origin.x)*invdirx}if(invdiry>=0){tymin=(box.min.y-origin.y)*invdiry;tymax=(box.max.y-origin.y)*invdiry}else{tymin=(box.max.y-origin.y)*invdiry;tymax=(box.min.y-origin.y)*invdiry}if(tmin>tymax||tymin>tmax)return null;if(tymin>tmin||tmin!==tmin)tmin=tymin;if(tymax<tmax||tmax!==tmax)tmax=tymax;if(invdirz>=0){tzmin=(box.min.z-origin.z)*invdirz;tzmax=(box.max.z-origin.z)*invdirz}else{tzmin=(box.max.z-origin.z)*invdirz;tzmax=(box.min.z-origin.z)*invdirz}if(tmin>tzmax||tzmin>tmax)return null;if(tzmin>tmin||tmin!==tmin)tmin=tzmin;if(tzmax<tmax||tmax!==tmax)tmax=tzmax;if(tmax<0)return null;return this.at(tmin>=0?tmin:tmax,optionalTarget)},intersectTriangle:function(){var diff=new THREE.Vector3;var edge1=new THREE.Vector3;var edge2=new THREE.Vector3;var normal=new THREE.Vector3;return function(a,b,c,backfaceCulling,optionalTarget){edge1.subVectors(b,a);edge2.subVectors(c,a);normal.crossVectors(edge1,edge2);var DdN=this.direction.dot(normal);var sign;if(DdN>0){if(backfaceCulling)return null;sign=1}else if(DdN<0){sign=-1;DdN=-DdN}else{return null}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(DdQxE2<0){return null}var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(DdE1xQ<0){return null}if(DdQxE2+DdE1xQ>DdN){return null}var QdN=-sign*diff.dot(normal);if(QdN<0){return null}return this.at(QdN/DdN,optionalTarget)}}(),applyMatrix4:function(matrix4){this.direction.add(this.origin).applyMatrix4(matrix4);this.origin.applyMatrix4(matrix4);this.direction.sub(this.origin);this.direction.normalize();return this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}};THREE.Sphere=function(center,radius){this.center=center!==undefined?center:new THREE.Vector3;this.radius=radius!==undefined?radius:0};THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(center,radius){this.center.copy(center);this.radius=radius;return this},setFromPoints:function(){var box=new THREE.Box3;return function(points,optionalCenter){var center=this.center;if(optionalCenter!==undefined){center.copy(optionalCenter)}else{box.setFromPoints(points).center(center)}var maxRadiusSq=0;for(var i=0,il=points.length;i<il;i++){maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(points[i]))}this.radius=Math.sqrt(maxRadiusSq);return this}}(),copy:function(sphere){this.center.copy(sphere.center);this.radius=sphere.radius;return this},empty:function(){return this.radius<=0},containsPoint:function(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},clampPoint:function(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point);var result=optionalTarget||new THREE.Vector3;result.copy(point);if(deltaLengthSq>this.radius*this.radius){result.sub(this.center).normalize();result.multiplyScalar(this.radius).add(this.center)}return result},getBoundingBox:function(optionalTarget){var box=optionalTarget||new THREE.Box3;box.set(this.center,this.center);box.expandByScalar(this.radius);return box},applyMatrix4:function(matrix){this.center.applyMatrix4(matrix);this.radius=this.radius*matrix.getMaxScaleOnAxis();return this},translate:function(offset){this.center.add(offset);return this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}};THREE.Frustum=function(p0,p1,p2,p3,p4,p5){this.planes=[p0!==undefined?p0:new THREE.Plane,p1!==undefined?p1:new THREE.Plane,p2!==undefined?p2:new THREE.Plane,p3!==undefined?p3:new THREE.Plane,p4!==undefined?p4:new THREE.Plane,p5!==undefined?p5:new THREE.Plane]};THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(p0,p1,p2,p3,p4,p5){var planes=this.planes;planes[0].copy(p0);planes[1].copy(p1);planes[2].copy(p2);planes[3].copy(p3);planes[4].copy(p4);planes[5].copy(p5);return this},copy:function(frustum){var planes=this.planes;for(var i=0;i<6;i++){planes[i].copy(frustum.planes[i])}return this},setFromMatrix:function(m){var planes=this.planes;var me=m.elements;var me0=me[0],me1=me[1],me2=me[2],me3=me[3];var me4=me[4],me5=me[5],me6=me[6],me7=me[7];var me8=me[8],me9=me[9],me10=me[10],me11=me[11];var me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();return this},intersectsObject:function(){var sphere=new THREE.Sphere;return function(object){var geometry=object.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(object.matrixWorld);return this.intersectsSphere(sphere)}}(),intersectsSphere:function(sphere){var planes=this.planes;var center=sphere.center;var negRadius=-sphere.radius;for(var i=0;i<6;i++){var distance=planes[i].distanceToPoint(center);if(distance<negRadius){return false}}return true},intersectsBox:function(){var p1=new THREE.Vector3,p2=new THREE.Vector3;return function(box){var planes=this.planes;for(var i=0;i<6;i++){var plane=planes[i];p1.x=plane.normal.x>0?box.min.x:box.max.x;p2.x=plane.normal.x>0?box.max.x:box.min.x;p1.y=plane.normal.y>0?box.min.y:box.max.y;p2.y=plane.normal.y>0?box.max.y:box.min.y;p1.z=plane.normal.z>0?box.min.z:box.max.z;p2.z=plane.normal.z>0?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1);var d2=plane.distanceToPoint(p2);if(d1<0&&d2<0){return false}}return true}}(),containsPoint:function(point){var planes=this.planes;for(var i=0;i<6;i++){if(planes[i].distanceToPoint(point)<0){return false}}return true},clone:function(){return(new THREE.Frustum).copy(this)}};THREE.Plane=function(normal,constant){this.normal=normal!==undefined?normal:new THREE.Vector3(1,0,0);this.constant=constant!==undefined?constant:0};THREE.Plane.prototype={constructor:THREE.Plane,set:function(normal,constant){this.normal.copy(normal);this.constant=constant;return this},setComponents:function(x,y,z,w){this.normal.set(x,y,z);this.constant=w;return this},setFromNormalAndCoplanarPoint:function(normal,point){this.normal.copy(normal);this.constant=-point.dot(this.normal);return this},setFromCoplanarPoints:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(normal,a);return this}}(),copy:function(plane){this.normal.copy(plane.normal);this.constant=plane.constant;return this},normalize:function(){var inverseNormalLength=1/this.normal.length();this.normal.multiplyScalar(inverseNormalLength);this.constant*=inverseNormalLength;return this},negate:function(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function(point){return this.normal.dot(point)+this.constant},distanceToSphere:function(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function(point,optionalTarget){return this.orthoPoint(point,optionalTarget).sub(point).negate()},orthoPoint:function(point,optionalTarget){var perpendicularMagnitude=this.distanceToPoint(point);var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(perpendicularMagnitude)},isIntersectionLine:function(line){var startSign=this.distanceToPoint(line.start);var endSign=this.distanceToPoint(line.end);return startSign<0&&endSign>0||endSign<0&&startSign>0},intersectLine:function(){var v1=new THREE.Vector3;return function(line,optionalTarget){var result=optionalTarget||new THREE.Vector3;var direction=line.delta(v1);var denominator=this.normal.dot(direction);if(denominator==0){if(this.distanceToPoint(line.start)==0){return result.copy(line.start)}return undefined}var t=-(line.start.dot(this.normal)+this.constant)/denominator;if(t<0||t>1){return undefined}return result.copy(direction).multiplyScalar(t).add(line.start)}}(),coplanarPoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var m1=new THREE.Matrix3;return function(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix);var newNormal=v1.copy(this.normal).applyMatrix3(normalMatrix);var newCoplanarPoint=this.coplanarPoint(v2);newCoplanarPoint.applyMatrix4(matrix);this.setFromNormalAndCoplanarPoint(newNormal,newCoplanarPoint);return this}}(),translate:function(offset){this.constant=this.constant-offset.dot(this.normal);return this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}};THREE.Math={generateUUID:function(){var chars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var uuid=new Array(36);var rnd=0,r;return function(){for(var i=0;i<36;i++){if(i==8||i==13||i==18||i==23){uuid[i]="-"}else if(i==14){uuid[i]="4"}else{if(rnd<=2)rnd=33554432+Math.random()*16777216|0;r=rnd&15;rnd=rnd>>4;uuid[i]=chars[i==19?r&3|8:r]}}return uuid.join("")}}(),clamp:function(x,a,b){return x<a?a:x>b?b:x},clampBottom:function(x,a){return x<a?a:x},mapLinear:function(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},smoothstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*(3-2*x)},smootherstep:function(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*x*(x*(x*6-15)+10)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(low,high){return Math.floor(this.randFloat(low,high))},randFloat:function(low,high){return low+Math.random()*(high-low)},randFloatSpread:function(range){return range*(.5-Math.random())},degToRad:function(){var degreeToRadiansFactor=Math.PI/180;return function(degrees){return degrees*degreeToRadiansFactor}}(),radToDeg:function(){var radianToDegreesFactor=180/Math.PI;return function(radians){return radians*radianToDegreesFactor}}(),isPowerOfTwo:function(value){return(value&value-1)===0&&value!==0},nextPowerOfTwo:function(value){value--;value|=value>>1;value|=value>>2;value|=value>>4;value|=value>>8;value|=value>>16;value++;return value}};THREE.Spline=function(points){this.points=points;var c=[],v3={x:0,y:0,z:0},point,intPoint,weight,w2,w3,pa,pb,pc,pd;this.initFromArray=function(a){this.points=[];for(var i=0;i<a.length;i++){this.points[i]={x:a[i][0],y:a[i][1],z:a[i][2]}}};this.getPoint=function(k){point=(this.points.length-1)*k;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>this.points.length-2?this.points.length-1:intPoint+1;c[3]=intPoint>this.points.length-3?this.points.length-1:intPoint+2;pa=this.points[c[0]];pb=this.points[c[1]];pc=this.points[c[2]];pd=this.points[c[3]];w2=weight*weight;w3=weight*w2;v3.x=interpolate(pa.x,pb.x,pc.x,pd.x,weight,w2,w3);v3.y=interpolate(pa.y,pb.y,pc.y,pd.y,weight,w2,w3);v3.z=interpolate(pa.z,pb.z,pc.z,pd.z,weight,w2,w3);return v3};this.getControlPointsArray=function(){var i,p,l=this.points.length,coords=[];for(i=0;i<l;i++){p=this.points[i];coords[i]=[p.x,p.y,p.z]}return coords};this.getLength=function(nSubDivisions){var i,index,nSamples,position,point=0,intPoint=0,oldIntPoint=0,oldPosition=new THREE.Vector3,tmpVec=new THREE.Vector3,chunkLengths=[],totalLength=0;chunkLengths[0]=0;if(!nSubDivisions)nSubDivisions=100;nSamples=this.points.length*nSubDivisions;oldPosition.copy(this.points[0]);for(i=1;i<nSamples;i++){index=i/nSamples;position=this.getPoint(index);tmpVec.copy(position);totalLength+=tmpVec.distanceTo(oldPosition);oldPosition.copy(position);point=(this.points.length-1)*index;intPoint=Math.floor(point);if(intPoint!=oldIntPoint){chunkLengths[intPoint]=totalLength;oldIntPoint=intPoint}}chunkLengths[chunkLengths.length]=totalLength;return{chunks:chunkLengths,total:totalLength}};this.reparametrizeByArcLength=function(samplingCoef){var i,j,index,indexCurrent,indexNext,realDistance,sampling,position,newpoints=[],tmpVec=new THREE.Vector3,sl=this.getLength();newpoints.push(tmpVec.copy(this.points[0]).clone());for(i=1;i<this.points.length;i++){realDistance=sl.chunks[i]-sl.chunks[i-1];sampling=Math.ceil(samplingCoef*realDistance/sl.total);indexCurrent=(i-1)/(this.points.length-1);indexNext=i/(this.points.length-1);for(j=1;j<sampling-1;j++){index=indexCurrent+j*(1/sampling)*(indexNext-indexCurrent);position=this.getPoint(index);newpoints.push(tmpVec.copy(position).clone())}newpoints.push(tmpVec.copy(this.points[i]).clone())}this.points=newpoints};function interpolate(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1}};THREE.Triangle=function(a,b,c){this.a=a!==undefined?a:new THREE.Vector3;this.b=b!==undefined?b:new THREE.Vector3;this.c=c!==undefined?c:new THREE.Vector3};THREE.Triangle.normal=function(){var v0=new THREE.Vector3;return function(a,b,c,optionalTarget){var result=optionalTarget||new THREE.Vector3;result.subVectors(c,b);v0.subVectors(a,b);result.cross(v0);var resultLengthSq=result.lengthSq();if(resultLengthSq>0){return result.multiplyScalar(1/Math.sqrt(resultLengthSq))}return result.set(0,0,0)}}();THREE.Triangle.barycoordFromPoint=function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(point,a,b,c,optionalTarget){v0.subVectors(c,a);v1.subVectors(b,a);v2.subVectors(point,a);var dot00=v0.dot(v0);var dot01=v0.dot(v1);var dot02=v0.dot(v2);var dot11=v1.dot(v1);var dot12=v1.dot(v2);var denom=dot00*dot11-dot01*dot01;var result=optionalTarget||new THREE.Vector3;if(denom==0){return result.set(-2,-1,-1)}var invDenom=1/denom;var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return result.set(1-u-v,v,u)}}();THREE.Triangle.containsPoint=function(){var v1=new THREE.Vector3;return function(point,a,b,c){var result=THREE.Triangle.barycoordFromPoint(point,a,b,c,v1);return result.x>=0&&result.y>=0&&result.x+result.y<=1}}();THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function(points,i0,i1,i2){this.a.copy(points[i0]);this.b.copy(points[i1]);this.c.copy(points[i2]);return this},copy:function(triangle){this.a.copy(triangle.a);this.b.copy(triangle.b);this.c.copy(triangle.c);return this},area:function(){var v0=new THREE.Vector3;var v1=new THREE.Vector3;return function(){v0.subVectors(this.c,this.b);v1.subVectors(this.a,this.b);return v0.cross(v1).length()*.5}}(),midpoint:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;return result.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(optionalTarget){return THREE.Triangle.normal(this.a,this.b,this.c,optionalTarget)},plane:function(optionalTarget){var result=optionalTarget||new THREE.Plane;return result.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(point,optionalTarget){return THREE.Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget)},containsPoint:function(point){return THREE.Triangle.containsPoint(point,this.a,this.b,this.c)},equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}};THREE.Clock=function(autoStart){this.autoStart=autoStart!==undefined?autoStart:true;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=false};THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();this.oldTime=this.startTime;this.running=true},stop:function(){this.getElapsedTime();this.running=false},getElapsedTime:function(){this.getDelta();return this.elapsedTime},getDelta:function(){var diff=0;if(this.autoStart&&!this.running){this.start()}if(this.running){var newTime=self.performance!==undefined&&self.performance.now!==undefined?self.performance.now():Date.now();diff=.001*(newTime-this.oldTime);this.oldTime=newTime;this.elapsedTime+=diff}return diff}};THREE.EventDispatcher=function(){};THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(object){object.addEventListener=THREE.EventDispatcher.prototype.addEventListener;object.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener;object.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener;object.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){if(this._listeners===undefined)this._listeners={};var listeners=this._listeners;if(listeners[type]===undefined){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}},hasEventListener:function(type,listener){if(this._listeners===undefined)return false;var listeners=this._listeners;if(listeners[type]!==undefined&&listeners[type].indexOf(listener)!==-1){return true}return false},removeEventListener:function(type,listener){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[type];if(listenerArray!==undefined){var index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}},dispatchEvent:function(event){if(this._listeners===undefined)return;var listeners=this._listeners;var listenerArray=listeners[event.type];if(listenerArray!==undefined){event.target=this;var array=[];var length=listenerArray.length;for(var i=0;i<length;i++){array[i]=listenerArray[i]}for(var i=0;i<length;i++){array[i].call(this,event)}}}};(function(THREE){THREE.Raycaster=function(origin,direction,near,far){this.ray=new THREE.Ray(origin,direction);this.near=near||0;this.far=far||Infinity;this.params={Sprite:{},Mesh:{},PointCloud:{threshold:1},LOD:{},Line:{}}};var descSort=function(a,b){return a.distance-b.distance};var intersectObject=function(object,raycaster,intersects,recursive){object.raycast(raycaster,intersects);if(recursive===true){var children=object.children;for(var i=0,l=children.length;i<l;i++){intersectObject(children[i],raycaster,intersects,true)}}};THREE.Raycaster.prototype={constructor:THREE.Raycaster,precision:1e-4,linePrecision:1,set:function(origin,direction){this.ray.set(origin,direction)},setFromCamera:function(coords,camera){if(camera instanceof THREE.PerspectiveCamera){this.ray.origin.copy(camera.position);this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(camera.position).normalize()}else if(camera instanceof THREE.OrthographicCamera){this.ray.origin.set(coords.x,coords.y,-1).unproject(camera);this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)}else{THREE.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function(object,recursive){var intersects=[];intersectObject(object,this,intersects,recursive);intersects.sort(descSort);return intersects},intersectObjects:function(objects,recursive){var intersects=[];if(objects instanceof Array===false){THREE.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return intersects}for(var i=0,l=objects.length;i<l;i++){intersectObject(objects[i],this,intersects,recursive)}intersects.sort(descSort);return intersects}}})(THREE);THREE.Object3D=function(){Object.defineProperty(this,"id",{value:THREE.Object3DIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Object3D";this.parent=undefined;this.children=[];this.up=THREE.Object3D.DefaultUp.clone();var position=new THREE.Vector3;var rotation=new THREE.Euler;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3(1,1,1);var onRotationChange=function(){quaternion.setFromEuler(rotation,false)};var onQuaternionChange=function(){rotation.setFromQuaternion(quaternion,undefined,false)};rotation.onChange(onRotationChange);quaternion.onChange(onQuaternionChange);Object.defineProperties(this,{position:{enumerable:true,value:position},rotation:{enumerable:true,value:rotation},quaternion:{enumerable:true,value:quaternion},scale:{enumerable:true,value:scale}});this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixAutoUpdate=true;this.matrixWorldNeedsUpdate=false;this.visible=true;this.castShadow=false;this.receiveShadow=false;this.frustumCulled=true;this.renderOrder=0;this.userData={}};THREE.Object3D.DefaultUp=new THREE.Vector3(0,1,0);THREE.Object3D.prototype={constructor:THREE.Object3D,get eulerOrder(){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");return this.rotation.order},set eulerOrder(value){THREE.warn("THREE.Object3D: .eulerOrder has been moved to .rotation.order.");this.rotation.order=value},get useQuaternion(){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(value){THREE.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(matrix){this.matrix.multiplyMatrices(matrix,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function(euler){this.quaternion.setFromEuler(euler,true)},setRotationFromMatrix:function(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:function(){var q1=new THREE.Quaternion;return function(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.multiply(q1);return this}}(),rotateX:function(){var v1=new THREE.Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new THREE.Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new THREE.Vector3;return function(axis,distance){v1.copy(axis).applyQuaternion(this.quaternion);this.position.add(v1.multiplyScalar(distance));return this}}(),translate:function(distance,axis){THREE.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(axis,distance)},translateX:function(){var v1=new THREE.Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new THREE.Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new THREE.Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var m1=new THREE.Matrix4;return function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}}(),lookAt:function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(vector,this.position,this.up);this.quaternion.setFromRotationMatrix(m1)}}(),add:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(object===this){THREE.error("THREE.Object3D.add: object can't be added as a child of itself.",object);return this}if(object instanceof THREE.Object3D){if(object.parent!==undefined){object.parent.remove(object)}object.parent=this;object.dispatchEvent({type:"added"});this.children.push(object)}else{THREE.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object)}return this},remove:function(object){if(arguments.length>1){for(var i=0;i<arguments.length;i++){this.remove(arguments[i])}}var index=this.children.indexOf(object);if(index!==-1){object.parent=undefined;object.dispatchEvent({type:"removed"});this.children.splice(index,1)}},getChildByName:function(name){THREE.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(name)},getObjectById:function(id){return this.getObjectByProperty("id",id)},getObjectByName:function(name){return this.getObjectByProperty("name",name)},getObjectByProperty:function(name,value){if(this[name]===value)return this;for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i];var object=child.getObjectByProperty(name,value);if(object!==undefined){return object}}return undefined},getWorldPosition:function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);return result.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var position=new THREE.Vector3;var scale=new THREE.Vector3;return function(optionalTarget){var result=optionalTarget||new THREE.Quaternion;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,result,scale);return result}}(),getWorldRotation:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Euler;this.getWorldQuaternion(quaternion);return result.setFromQuaternion(quaternion,this.rotation.order,false)}}(),getWorldScale:function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.updateMatrixWorld(true);this.matrixWorld.decompose(position,quaternion,result);return result}}(),getWorldDirection:function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,1).applyQuaternion(quaternion)}}(),raycast:function(){},traverse:function(callback){callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverse(callback)}},traverseVisible:function(callback){if(this.visible===false)return;callback(this);for(var i=0,l=this.children.length;i<l;i++){this.children[i].traverseVisible(callback)}},traverseAncestors:function(callback){if(this.parent){callback(this.parent);this.parent.traverseAncestors(callback)}},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(force){if(this.matrixAutoUpdate===true)this.updateMatrix();if(this.matrixWorldNeedsUpdate===true||force===true){if(this.parent===undefined){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}},toJSON:function(){var output={metadata:{version:4.3,type:"Object",generator:"ObjectExporter"}};var geometries={};var parseGeometry=function(geometry){if(output.geometries===undefined){output.geometries=[]}if(geometries[geometry.uuid]===undefined){var json=geometry.toJSON();delete json.metadata;geometries[geometry.uuid]=json;output.geometries.push(json)}return geometry.uuid};var materials={};var parseMaterial=function(material){if(output.materials===undefined){output.materials=[]}if(materials[material.uuid]===undefined){var json=material.toJSON();delete json.metadata;materials[material.uuid]=json;output.materials.push(json)}return material.uuid};var parseObject=function(object){var data={};data.uuid=object.uuid;data.type=object.type;if(object.name!=="")data.name=object.name;if(JSON.stringify(object.userData)!=="{}")data.userData=object.userData;if(object.visible!==true)data.visible=object.visible;if(object instanceof THREE.PerspectiveCamera){data.fov=object.fov;data.aspect=object.aspect;data.near=object.near;data.far=object.far}else if(object instanceof THREE.OrthographicCamera){data.left=object.left;data.right=object.right;data.top=object.top;data.bottom=object.bottom;data.near=object.near;data.far=object.far}else if(object instanceof THREE.AmbientLight){data.color=object.color.getHex()}else if(object instanceof THREE.DirectionalLight){data.color=object.color.getHex();data.intensity=object.intensity}else if(object instanceof THREE.PointLight){data.color=object.color.getHex();data.intensity=object.intensity;data.distance=object.distance;data.decay=object.decay}else if(object instanceof THREE.SpotLight){data.color=object.color.getHex();data.intensity=object.intensity;data.distance=object.distance;data.angle=object.angle;data.exponent=object.exponent;data.decay=object.decay}else if(object instanceof THREE.HemisphereLight){data.color=object.color.getHex();data.groundColor=object.groundColor.getHex()}else if(object instanceof THREE.Mesh||object instanceof THREE.Line||object instanceof THREE.PointCloud){data.geometry=parseGeometry(object.geometry);data.material=parseMaterial(object.material);if(object instanceof THREE.Line)data.mode=object.mode}else if(object instanceof THREE.Sprite){data.material=parseMaterial(object.material)}data.matrix=object.matrix.toArray();if(object.children.length>0){data.children=[];for(var i=0;i<object.children.length;i++){data.children.push(parseObject(object.children[i]))}}return data};output.object=parseObject(this);return output},clone:function(object,recursive){if(object===undefined)object=new THREE.Object3D;if(recursive===undefined)recursive=true;object.name=this.name;object.up.copy(this.up);object.position.copy(this.position);object.quaternion.copy(this.quaternion);object.scale.copy(this.scale);object.rotationAutoUpdate=this.rotationAutoUpdate;object.matrix.copy(this.matrix);object.matrixWorld.copy(this.matrixWorld);object.matrixAutoUpdate=this.matrixAutoUpdate;object.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate;object.visible=this.visible;object.castShadow=this.castShadow;object.receiveShadow=this.receiveShadow;object.frustumCulled=this.frustumCulled;object.userData=JSON.parse(JSON.stringify(this.userData));if(recursive===true){for(var i=0;i<this.children.length;i++){var child=this.children[i];object.add(child.clone())}}return object}};THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype);THREE.Object3DIdCount=0;THREE.Face3=function(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal instanceof THREE.Vector3?normal:new THREE.Vector3;this.vertexNormals=normal instanceof Array?normal:[];this.color=color instanceof THREE.Color?color:new THREE.Color;this.vertexColors=color instanceof Array?color:[];this.vertexTangents=[];this.materialIndex=materialIndex!==undefined?materialIndex:0};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var face=new THREE.Face3(this.a,this.b,this.c);face.normal.copy(this.normal);face.color.copy(this.color);face.materialIndex=this.materialIndex;for(var i=0,il=this.vertexNormals.length;i<il;i++){face.vertexNormals[i]=this.vertexNormals[i].clone()}for(var i=0,il=this.vertexColors.length;i<il;i++){face.vertexColors[i]=this.vertexColors[i].clone()}for(var i=0,il=this.vertexTangents.length;i<il;i++){face.vertexTangents[i]=this.vertexTangents[i].clone()}return face}};THREE.Face4=function(a,b,c,d,normal,color,materialIndex){THREE.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new THREE.Face3(a,b,c,normal,color,materialIndex)};THREE.BufferAttribute=function(array,itemSize){this.array=array;this.itemSize=itemSize;this.needsUpdate=false};THREE.BufferAttribute.prototype={constructor:THREE.BufferAttribute,get length(){return this.array.length},copyAt:function(index1,attribute,index2){index1*=this.itemSize;index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}return this},set:function(value,offset){if(offset===undefined)offset=0;this.array.set(value,offset);return this},setX:function(index,x){this.array[index*this.itemSize]=x;return this},setY:function(index,y){this.array[index*this.itemSize+1]=y;return this},setZ:function(index,z){this.array[index*this.itemSize+2]=z;return this},setXY:function(index,x,y){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;return this},setXYZ:function(index,x,y,z){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;this.array[index+2]=z;return this},setXYZW:function(index,x,y,z,w){index*=this.itemSize;this.array[index]=x;this.array[index+1]=y;this.array[index+2]=z;this.array[index+3]=w;return this},clone:function(){return new THREE.BufferAttribute(new this.array.constructor(this.array),this.itemSize)}};THREE.Int8Attribute=function(data,itemSize){THREE.warn("THREE.Int8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint8Attribute=function(data,itemSize){THREE.warn("THREE.Uint8Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint8ClampedAttribute=function(data,itemSize){THREE.warn("THREE.Uint8ClampedAttribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Int16Attribute=function(data,itemSize){THREE.warn("THREE.Int16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint16Attribute=function(data,itemSize){THREE.warn("THREE.Uint16Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Int32Attribute=function(data,itemSize){THREE.warn("THREE.Int32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Uint32Attribute=function(data,itemSize){THREE.warn("THREE.Uint32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Float32Attribute=function(data,itemSize){THREE.warn("THREE.Float32Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.Float64Attribute=function(data,itemSize){THREE.warn("THREE.Float64Attribute has been removed. Use THREE.BufferAttribute( array, itemSize ) instead.");return new THREE.BufferAttribute(data,itemSize)};THREE.DynamicBufferAttribute=function(array,itemSize){THREE.BufferAttribute.call(this,array,itemSize);this.updateRange={offset:0,count:-1}};THREE.DynamicBufferAttribute.prototype=Object.create(THREE.BufferAttribute.prototype);THREE.DynamicBufferAttribute.prototype.constructor=THREE.DynamicBufferAttribute;THREE.DynamicBufferAttribute.prototype.clone=function(){return new THREE.DynamicBufferAttribute(new this.array.constructor(this.array),this.itemSize)};THREE.BufferGeometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="BufferGeometry";this.attributes={};this.attributesKeys=[];this.drawcalls=[];this.offsets=this.drawcalls;this.boundingBox=null;this.boundingSphere=null};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(name,attribute){if(attribute instanceof THREE.BufferAttribute===false){THREE.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.attributes[name]={array:arguments[1],itemSize:arguments[2]};return}this.attributes[name]=attribute;this.attributesKeys=Object.keys(this.attributes)},getAttribute:function(name){return this.attributes[name]},addDrawCall:function(start,count,indexOffset){this.drawcalls.push({start:start,count:count,index:indexOffset!==undefined?indexOffset:0})},applyMatrix:function(matrix){var position=this.attributes.position;if(position!==undefined){matrix.applyToVector3Array(position.array);position.needsUpdate=true}var normal=this.attributes.normal;if(normal!==undefined){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);normalMatrix.applyToVector3Array(normal.array);normal.needsUpdate=true}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}},center:function(){this.computeBoundingBox();var offset=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(offset));return offset},fromGeometry:function(geometry,settings){settings=settings||{vertexColors:THREE.NoColors};var vertices=geometry.vertices;var faces=geometry.faces;var faceVertexUvs=geometry.faceVertexUvs;var vertexColors=settings.vertexColors;var hasFaceVertexUv=faceVertexUvs[0].length>0;var hasFaceVertexNormals=faces[0].vertexNormals.length==3;var positions=new Float32Array(faces.length*3*3);this.addAttribute("position",new THREE.BufferAttribute(positions,3));var normals=new Float32Array(faces.length*3*3);this.addAttribute("normal",new THREE.BufferAttribute(normals,3));if(vertexColors!==THREE.NoColors){var colors=new Float32Array(faces.length*3*3);this.addAttribute("color",new THREE.BufferAttribute(colors,3))}if(hasFaceVertexUv===true){var uvs=new Float32Array(faces.length*3*2);this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))}for(var i=0,i2=0,i3=0;i<faces.length;i++,i2+=6,i3+=9){var face=faces[i];var a=vertices[face.a];var b=vertices[face.b];var c=vertices[face.c];positions[i3]=a.x;positions[i3+1]=a.y;positions[i3+2]=a.z;positions[i3+3]=b.x;positions[i3+4]=b.y;positions[i3+5]=b.z;positions[i3+6]=c.x;positions[i3+7]=c.y;positions[i3+8]=c.z;if(hasFaceVertexNormals===true){var na=face.vertexNormals[0];var nb=face.vertexNormals[1];var nc=face.vertexNormals[2];normals[i3]=na.x;normals[i3+1]=na.y;normals[i3+2]=na.z;normals[i3+3]=nb.x;normals[i3+4]=nb.y;normals[i3+5]=nb.z;normals[i3+6]=nc.x;normals[i3+7]=nc.y;normals[i3+8]=nc.z}else{var n=face.normal;normals[i3]=n.x;normals[i3+1]=n.y;normals[i3+2]=n.z;normals[i3+3]=n.x;normals[i3+4]=n.y;normals[i3+5]=n.z;normals[i3+6]=n.x;normals[i3+7]=n.y;normals[i3+8]=n.z}if(vertexColors===THREE.FaceColors){var fc=face.color;colors[i3]=fc.r;colors[i3+1]=fc.g;colors[i3+2]=fc.b;colors[i3+3]=fc.r;colors[i3+4]=fc.g;colors[i3+5]=fc.b;colors[i3+6]=fc.r;colors[i3+7]=fc.g;colors[i3+8]=fc.b}else if(vertexColors===THREE.VertexColors){var vca=face.vertexColors[0];var vcb=face.vertexColors[1];var vcc=face.vertexColors[2];colors[i3]=vca.r;colors[i3+1]=vca.g;colors[i3+2]=vca.b;colors[i3+3]=vcb.r;colors[i3+4]=vcb.g;colors[i3+5]=vcb.b;colors[i3+6]=vcc.r;colors[i3+7]=vcc.g;colors[i3+8]=vcc.b}if(hasFaceVertexUv===true){var uva=faceVertexUvs[0][i][0];var uvb=faceVertexUvs[0][i][1];var uvc=faceVertexUvs[0][i][2];uvs[i2]=uva.x;uvs[i2+1]=uva.y;uvs[i2+2]=uvb.x;uvs[i2+3]=uvb.y;uvs[i2+4]=uvc.x;uvs[i2+5]=uvc.y}}this.computeBoundingSphere();return this},computeBoundingBox:function(){var vector=new THREE.Vector3;return function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}var positions=this.attributes.position.array;if(positions){var bb=this.boundingBox;bb.makeEmpty();for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);bb.expandByPoint(vector)}}if(positions===undefined||positions.length===0){this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){THREE.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.')}}}(),computeBoundingSphere:function(){var box=new THREE.Box3;var vector=new THREE.Vector3;return function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}var positions=this.attributes.position.array;if(positions){box.makeEmpty();var center=this.boundingSphere.center;for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);box.expandByPoint(vector)}box.center(center);var maxRadiusSq=0;for(var i=0,il=positions.length;i<il;i+=3){vector.set(positions[i],positions[i+1],positions[i+2]);maxRadiusSq=Math.max(maxRadiusSq,center.distanceToSquared(vector))}this.boundingSphere.radius=Math.sqrt(maxRadiusSq);if(isNaN(this.boundingSphere.radius)){THREE.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.')}}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var attributes=this.attributes;if(attributes.position){var positions=attributes.position.array;if(attributes.normal===undefined){this.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(positions.length),3))}else{var normals=attributes.normal.array;for(var i=0,il=normals.length;i<il;i++){normals[i]=0}}var normals=attributes.normal.array;var vA,vB,vC,pA=new THREE.Vector3,pB=new THREE.Vector3,pC=new THREE.Vector3,cb=new THREE.Vector3,ab=new THREE.Vector3;if(attributes.index){var indices=attributes.index.array;var offsets=this.offsets.length>0?this.offsets:[{start:0,count:indices.length,index:0}];for(var j=0,jl=offsets.length;j<jl;++j){var start=offsets[j].start;var count=offsets[j].count;var index=offsets[j].index;for(var i=start,il=start+count;i<il;i+=3){vA=(index+indices[i])*3;vB=(index+indices[i+1])*3;vC=(index+indices[i+2])*3;pA.fromArray(positions,vA);pB.fromArray(positions,vB);pC.fromArray(positions,vC);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[vA]+=cb.x;normals[vA+1]+=cb.y;normals[vA+2]+=cb.z;normals[vB]+=cb.x;normals[vB+1]+=cb.y;normals[vB+2]+=cb.z;normals[vC]+=cb.x;normals[vC+1]+=cb.y;normals[vC+2]+=cb.z}}}else{for(var i=0,il=positions.length;i<il;i+=9){pA.fromArray(positions,i);pB.fromArray(positions,i+3);pC.fromArray(positions,i+6);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[i]=cb.x;normals[i+1]=cb.y;normals[i+2]=cb.z;normals[i+3]=cb.x;normals[i+4]=cb.y;normals[i+5]=cb.z;normals[i+6]=cb.x;normals[i+7]=cb.y;normals[i+8]=cb.z}}this.normalizeNormals();attributes.normal.needsUpdate=true}},computeTangents:function(){if(this.attributes.index===undefined||this.attributes.position===undefined||this.attributes.normal===undefined||this.attributes.uv===undefined){THREE.warn("THREE.BufferGeometry: Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");return}var indices=this.attributes.index.array;var positions=this.attributes.position.array;var normals=this.attributes.normal.array;var uvs=this.attributes.uv.array;var nVertices=positions.length/3;if(this.attributes.tangent===undefined){this.addAttribute("tangent",new THREE.BufferAttribute(new Float32Array(4*nVertices),4))}var tangents=this.attributes.tangent.array;var tan1=[],tan2=[];for(var k=0;k<nVertices;k++){tan1[k]=new THREE.Vector3;tan2[k]=new THREE.Vector3}var vA=new THREE.Vector3,vB=new THREE.Vector3,vC=new THREE.Vector3,uvA=new THREE.Vector2,uvB=new THREE.Vector2,uvC=new THREE.Vector2,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r;var sdir=new THREE.Vector3,tdir=new THREE.Vector3;function handleTriangle(a,b,c){vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);uvA.fromArray(uvs,a*2);uvB.fromArray(uvs,b*2);uvC.fromArray(uvs,c*2);x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.x-uvA.x;s2=uvC.x-uvA.x;t1=uvB.y-uvA.y;t2=uvC.y-uvA.y;r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].add(sdir);tan1[b].add(sdir);tan1[c].add(sdir);tan2[a].add(tdir);tan2[b].add(tdir);tan2[c].add(tdir)}var i,il;var j,jl;var iA,iB,iC;if(this.drawcalls.length===0){this.addDrawCall(0,indices.length,0)}var drawcalls=this.drawcalls;for(j=0,jl=drawcalls.length;j<jl;++j){var start=drawcalls[j].start;var count=drawcalls[j].count;var index=drawcalls[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleTriangle(iA,iB,iC)}}var tmp=new THREE.Vector3,tmp2=new THREE.Vector3;var n=new THREE.Vector3,n2=new THREE.Vector3;var w,t,test;function handleVertex(v){n.fromArray(normals,v*3);n2.copy(n);t=tan1[v];tmp.copy(t);tmp.sub(n.multiplyScalar(n.dot(t))).normalize();tmp2.crossVectors(n2,t);test=tmp2.dot(tan2[v]);w=test<0?-1:1;tangents[v*4]=tmp.x;tangents[v*4+1]=tmp.y;tangents[v*4+2]=tmp.z;tangents[v*4+3]=w}for(j=0,jl=drawcalls.length;j<jl;++j){var start=drawcalls[j].start;var count=drawcalls[j].count;var index=drawcalls[j].index;for(i=start,il=start+count;i<il;i+=3){iA=index+indices[i];iB=index+indices[i+1];iC=index+indices[i+2];handleVertex(iA);handleVertex(iB);handleVertex(iC)}}},computeOffsets:function(size){if(size===undefined)size=65535;var indices=this.attributes.index.array;var vertices=this.attributes.position.array;var facesCount=indices.length/3;var sortedIndices=new Uint16Array(indices.length);var indexPtr=0;var vertexPtr=0;var offsets=[{start:0,count:0,index:0}];var offset=offsets[0];var duplicatedVertices=0;var newVerticeMaps=0;var faceVertices=new Int32Array(6);var vertexMap=new Int32Array(vertices.length);var revVertexMap=new Int32Array(vertices.length);for(var j=0;j<vertices.length;j++){vertexMap[j]=-1;revVertexMap[j]=-1}for(var findex=0;findex<facesCount;findex++){newVerticeMaps=0;for(var vo=0;vo<3;vo++){var vid=indices[findex*3+vo];if(vertexMap[vid]==-1){faceVertices[vo*2]=vid;faceVertices[vo*2+1]=-1;newVerticeMaps++}else if(vertexMap[vid]<offset.index){faceVertices[vo*2]=vid;faceVertices[vo*2+1]=-1;duplicatedVertices++}else{faceVertices[vo*2]=vid;faceVertices[vo*2+1]=vertexMap[vid]}}var faceMax=vertexPtr+newVerticeMaps;if(faceMax>offset.index+size){var new_offset={start:indexPtr,count:0,index:vertexPtr};offsets.push(new_offset);offset=new_offset;for(var v=0;v<6;v+=2){var new_vid=faceVertices[v+1];if(new_vid>-1&&new_vid<offset.index)faceVertices[v+1]=-1}}for(var v=0;v<6;v+=2){var vid=faceVertices[v];var new_vid=faceVertices[v+1];if(new_vid===-1)new_vid=vertexPtr++;vertexMap[vid]=new_vid;revVertexMap[new_vid]=vid;sortedIndices[indexPtr++]=new_vid-offset.index;offset.count++}}this.reorderBuffers(sortedIndices,revVertexMap,vertexPtr);this.offsets=offsets;this.drawcalls=offsets;return offsets},merge:function(geometry,offset){if(geometry instanceof THREE.BufferGeometry===false){THREE.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",geometry);return}if(offset===undefined)offset=0;var attributes=this.attributes;for(var key in attributes){if(geometry.attributes[key]===undefined)continue;var attribute1=attributes[key];var attributeArray1=attribute1.array;var attribute2=geometry.attributes[key];var attributeArray2=attribute2.array;var attributeSize=attribute2.itemSize;for(var i=0,j=attributeSize*offset;i<attributeArray2.length;i++,j++){attributeArray1[j]=attributeArray2[i]}}return this},normalizeNormals:function(){var normals=this.attributes.normal.array;var x,y,z,n;for(var i=0,il=normals.length;i<il;i+=3){x=normals[i];y=normals[i+1];z=normals[i+2];n=1/Math.sqrt(x*x+y*y+z*z);normals[i]*=n;normals[i+1]*=n;normals[i+2]*=n}},reorderBuffers:function(indexBuffer,indexMap,vertexCount){var sortedAttributes={};for(var attr in this.attributes){if(attr=="index")continue;var sourceArray=this.attributes[attr].array;sortedAttributes[attr]=new sourceArray.constructor(this.attributes[attr].itemSize*vertexCount)}for(var new_vid=0;new_vid<vertexCount;new_vid++){var vid=indexMap[new_vid];for(var attr in this.attributes){if(attr=="index")continue;var attrArray=this.attributes[attr].array;var attrSize=this.attributes[attr].itemSize;var sortedAttr=sortedAttributes[attr];for(var k=0;k<attrSize;k++)sortedAttr[new_vid*attrSize+k]=attrArray[vid*attrSize+k]}}this.attributes["index"].array=indexBuffer;for(var attr in this.attributes){if(attr=="index")continue;this.attributes[attr].array=sortedAttributes[attr];this.attributes[attr].numItems=this.attributes[attr].itemSize*vertexCount}},toJSON:function(){var output={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type,data:{attributes:{}}};var attributes=this.attributes;var offsets=this.offsets;var boundingSphere=this.boundingSphere;for(var key in attributes){var attribute=attributes[key];var array=Array.prototype.slice.call(attribute.array);output.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array}}if(offsets.length>0){output.data.offsets=JSON.parse(JSON.stringify(offsets))}if(boundingSphere!==null){output.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}}return output},clone:function(){var geometry=new THREE.BufferGeometry;for(var attr in this.attributes){var sourceAttr=this.attributes[attr];geometry.addAttribute(attr,sourceAttr.clone())}for(var i=0,il=this.offsets.length;i<il;i++){var offset=this.offsets[i];geometry.offsets.push({start:offset.start,index:offset.index,count:offset.count})}return geometry},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype);THREE.Geometry=function(){Object.defineProperty(this,"id",{value:THREE.GeometryIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.hasTangents=false;this.dynamic=true;this.verticesNeedUpdate=false;this.elementsNeedUpdate=false;this.uvsNeedUpdate=false;this.normalsNeedUpdate=false;this.tangentsNeedUpdate=false;this.colorsNeedUpdate=false;this.lineDistancesNeedUpdate=false;this.groupsNeedUpdate=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(matrix){var normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix);for(var i=0,il=this.vertices.length;i<il;i++){var vertex=this.vertices[i];vertex.applyMatrix4(matrix)}for(var i=0,il=this.faces.length;i<il;i++){var face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++){face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}}if(this.boundingBox!==null){this.computeBoundingBox()}if(this.boundingSphere!==null){this.computeBoundingSphere()}this.verticesNeedUpdate=true;this.normalsNeedUpdate=true},fromBufferGeometry:function(geometry){var scope=this;var attributes=geometry.attributes;var vertices=attributes.position.array;var indices=attributes.index!==undefined?attributes.index.array:undefined;var normals=attributes.normal!==undefined?attributes.normal.array:undefined;var colors=attributes.color!==undefined?attributes.color.array:undefined;var uvs=attributes.uv!==undefined?attributes.uv.array:undefined;var tempNormals=[];var tempUVs=[];for(var i=0,j=0;i<vertices.length;i+=3,j+=2){scope.vertices.push(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]));if(normals!==undefined){tempNormals.push(new THREE.Vector3(normals[i],normals[i+1],normals[i+2]))}if(colors!==undefined){scope.colors.push(new THREE.Color(colors[i],colors[i+1],colors[i+2]))}if(uvs!==undefined){tempUVs.push(new THREE.Vector2(uvs[j],uvs[j+1]))}}var addFace=function(a,b,c){var vertexNormals=normals!==undefined?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[];var vertexColors=colors!==undefined?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[];scope.faces.push(new THREE.Face3(a,b,c,vertexNormals,vertexColors));if(uvs!==undefined){scope.faceVertexUvs[0].push([tempUVs[a].clone(),tempUVs[b].clone(),tempUVs[c].clone()])}};if(indices!==undefined){var drawcalls=geometry.drawcalls;if(drawcalls.length>0){for(var i=0;i<drawcalls.length;i++){var drawcall=drawcalls[i];var start=drawcall.start;var count=drawcall.count;var index=drawcall.index;for(var j=start,jl=start+count;j<jl;j+=3){addFace(index+indices[j],index+indices[j+1],index+indices[j+2])}}}else{for(var i=0;i<indices.length;i+=3){addFace(indices[i],indices[i+1],indices[i+2])}}}else{for(var i=0;i<vertices.length/3;i+=3){addFace(i,i+1,i+2)}}this.computeFaceNormals();if(geometry.boundingBox!==null){this.boundingBox=geometry.boundingBox.clone()}if(geometry.boundingSphere!==null){this.boundingSphere=geometry.boundingSphere.clone()}return this},center:function(){this.computeBoundingBox();var offset=this.boundingBox.center().negate();this.applyMatrix((new THREE.Matrix4).setPosition(offset));return offset},computeFaceNormals:function(){var cb=new THREE.Vector3,ab=new THREE.Vector3;for(var f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f];var vA=this.vertices[face.a];var vB=this.vertices[face.b];var vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);cb.normalize();face.normal.copy(cb)}},computeVertexNormals:function(areaWeighted){var v,vl,f,fl,face,vertices;vertices=new Array(this.vertices.length);for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v]=new THREE.Vector3}if(areaWeighted){var vA,vB,vC;var cb=new THREE.Vector3,ab=new THREE.Vector3;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vA=this.vertices[face.a];vB=this.vertices[face.b];vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);vertices[face.a].add(cb);vertices[face.b].add(cb);vertices[face.c].add(cb)}}else{for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vertices[face.a].add(face.normal);vertices[face.b].add(face.normal);vertices[face.c].add(face.normal)}}for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].normalize()}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.vertexNormals[0]=vertices[face.a].clone();face.vertexNormals[1]=vertices[face.b].clone();face.vertexNormals[2]=vertices[face.c].clone()}},computeMorphNormals:function(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone()}else{face.__originalFaceNormal.copy(face.normal)}if(!face.__originalVertexNormals)face.__originalVertexNormals=[];for(i=0,il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone()}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i])}}}var tmpGeo=new THREE.Geometry;tmpGeo.faces=this.faces;for(i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals;var dstNormalsVertex=this.morphNormals[i].vertexNormals;var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){faceNormal=new THREE.Vector3;vertexNormals={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3};dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals)}}var morphNormals=this.morphNormals[i];tmpGeo.vertices=this.morphTargets[i].vertices;tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2])}}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals}},computeTangents:function(){var f,fl,v,vl,i,vertexIndex,face,uv,vA,vB,vC,uvA,uvB,uvC,x1,x2,y1,y2,z1,z2,s1,s2,t1,t2,r,t,test,tan1=[],tan2=[],sdir=new THREE.Vector3,tdir=new THREE.Vector3,tmp=new THREE.Vector3,tmp2=new THREE.Vector3,n=new THREE.Vector3,w;for(v=0,vl=this.vertices.length;v<vl;v++){tan1[v]=new THREE.Vector3;tan2[v]=new THREE.Vector3}function handleTriangle(context,a,b,c,ua,ub,uc){vA=context.vertices[a];vB=context.vertices[b];vC=context.vertices[c];uvA=uv[ua];uvB=uv[ub];uvC=uv[uc];x1=vB.x-vA.x;x2=vC.x-vA.x;y1=vB.y-vA.y;y2=vC.y-vA.y;z1=vB.z-vA.z;z2=vC.z-vA.z;s1=uvB.x-uvA.x;s2=uvC.x-uvA.x;t1=uvB.y-uvA.y;t2=uvC.y-uvA.y;r=1/(s1*t2-s2*t1);sdir.set((t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r);tdir.set((s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r);tan1[a].add(sdir);tan1[b].add(sdir);tan1[c].add(sdir);tan2[a].add(tdir);tan2[b].add(tdir);tan2[c].add(tdir)}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];uv=this.faceVertexUvs[0][f];handleTriangle(this,face.a,face.b,face.c,0,1,2)}var faceIndex=["a","b","c","d"];for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];for(i=0;i<Math.min(face.vertexNormals.length,3);i++){n.copy(face.vertexNormals[i]);vertexIndex=face[faceIndex[i]];t=tan1[vertexIndex];tmp.copy(t);tmp.sub(n.multiplyScalar(n.dot(t))).normalize();tmp2.crossVectors(face.vertexNormals[i],t);test=tmp2.dot(tan2[vertexIndex]);w=test<0?-1:1;face.vertexTangents[i]=new THREE.Vector4(tmp.x,tmp.y,tmp.z,w)}}this.hasTangents=true},computeLineDistances:function(){var d=0;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){if(i>0){d+=vertices[i].distanceTo(vertices[i-1])}this.lineDistances[i]=d}},computeBoundingBox:function(){if(this.boundingBox===null){this.boundingBox=new THREE.Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){if(this.boundingSphere===null){this.boundingSphere=new THREE.Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function(geometry,matrix,materialIndexOffset){if(geometry instanceof THREE.Geometry===false){THREE.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry);return}var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0];if(materialIndexOffset===undefined)materialIndexOffset=0;if(matrix!==undefined){normalMatrix=(new THREE.Matrix3).getNormalMatrix(matrix)}for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i];var vertexCopy=vertex.clone();if(matrix!==undefined)vertexCopy.applyMatrix4(matrix);vertices1.push(vertexCopy)}for(i=0,il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;faceCopy=new THREE.Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);faceCopy.normal.copy(face.normal);if(normalMatrix!==undefined){faceCopy.normal.applyMatrix3(normalMatrix).normalize()}for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(normalMatrix!==undefined){normal.applyMatrix3(normalMatrix).normalize()}faceCopy.vertexNormals.push(normal)}faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone())}faceCopy.materialIndex=face.materialIndex+materialIndexOffset;faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(uv===undefined){continue}for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(uv[j].clone())}uvs1.push(uvCopy)}},mergeMesh:function(mesh){if(mesh instanceof THREE.Mesh===false){THREE.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",mesh);return}mesh.matrixAutoUpdate&&mesh.updateMatrix();this.merge(mesh.geometry,mesh.matrix)},mergeVertices:function(){var verticesMap={};var unique=[],changes=[];var v,key;var precisionPoints=4;var precision=Math.pow(10,precisionPoints);var i,il,face;var indices,j,jl;for(i=0,il=this.vertices.length;i<il;i++){v=this.vertices[i];key=Math.round(v.x*precision)+"_"+Math.round(v.y*precision)+"_"+Math.round(v.z*precision);if(verticesMap[key]===undefined){verticesMap[key]=i;unique.push(this.vertices[i]);changes[i]=unique.length-1}else{changes[i]=changes[verticesMap[key]]}}var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){face=this.faces[i];face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];indices=[face.a,face.b,face.c];var dupIndex=-1;for(var n=0;n<3;n++){if(indices[n]==indices[(n+1)%3]){dupIndex=n;faceIndicesToRemove.push(i);break}}}for(i=faceIndicesToRemove.length-1;i>=0;i--){var idx=faceIndicesToRemove[i];this.faces.splice(idx,1);for(j=0,jl=this.faceVertexUvs.length;j<jl;j++){this.faceVertexUvs[j].splice(idx,1)}}var diff=this.vertices.length-unique.length;this.vertices=unique;return diff},toJSON:function(){var output={metadata:{version:4,type:"BufferGeometry",generator:"BufferGeometryExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")output.name=this.name;if(this.parameters!==undefined){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==undefined)output[key]=parameters[key]}return output}var vertices=[];for(var i=0;i<this.vertices.length;i++){var vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}var faces=[];var normals=[];var normalsHash={};var colors=[];var colorsHash={};var uvs=[];var uvsHash={};for(var i=0;i<this.faces.length;i++){var face=this.faces[i];var hasMaterial=false;var hasFaceUv=false;var hasFaceVertexUv=this.faceVertexUvs[0][i]!==undefined;var hasFaceNormal=face.normal.length()>0;var hasFaceVertexNormal=face.vertexNormals.length>0;var hasFaceColor=face.color.r!==1||face.color.g!==1||face.color.b!==1;var hasFaceVertexColor=face.vertexColors.length>0;var faceType=0;faceType=setBit(faceType,0,0);faceType=setBit(faceType,1,hasMaterial);faceType=setBit(faceType,2,hasFaceUv);faceType=setBit(faceType,3,hasFaceVertexUv);faceType=setBit(faceType,4,hasFaceNormal);faceType=setBit(faceType,5,hasFaceVertexNormal);faceType=setBit(faceType,6,hasFaceColor);faceType=setBit(faceType,7,hasFaceVertexColor);faces.push(faceType);faces.push(face.a,face.b,face.c);if(hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal){faces.push(getNormalIndex(face.normal))}if(hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor){faces.push(getColorIndex(face.color))}if(hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();if(normalsHash[hash]!==undefined){return normalsHash[hash]}normalsHash[hash]=normals.length/3;normals.push(normal.x,normal.y,normal.z);return normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();if(colorsHash[hash]!==undefined){return colorsHash[hash]}colorsHash[hash]=colors.length;colors.push(color.getHex());return colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();if(uvsHash[hash]!==undefined){return uvsHash[hash]}uvsHash[hash]=uvs.length/2;uvs.push(uv.x,uv.y);return uvsHash[hash]}output.data={};output.data.vertices=vertices;output.data.normals=normals;if(colors.length>0)output.data.colors=colors;if(uvs.length>0)output.data.uvs=[uvs];output.data.faces=faces;return output},clone:function(){var geometry=new THREE.Geometry;var vertices=this.vertices;for(var i=0,il=vertices.length;i<il;i++){geometry.vertices.push(vertices[i].clone())}var faces=this.faces;for(var i=0,il=faces.length;i<il;i++){geometry.faces.push(faces[i].clone())}for(var i=0,il=this.faceVertexUvs.length;i<il;i++){var faceVertexUvs=this.faceVertexUvs[i];if(geometry.faceVertexUvs[i]===undefined){geometry.faceVertexUvs[i]=[]}for(var j=0,jl=faceVertexUvs.length;j<jl;j++){var uvs=faceVertexUvs[j],uvsCopy=[];for(var k=0,kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone())}geometry.faceVertexUvs[i].push(uvsCopy)}}return geometry},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype);THREE.GeometryIdCount=0;THREE.Camera=function(){THREE.Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4};THREE.Camera.prototype=Object.create(THREE.Object3D.prototype);THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.getWorldDirection=function(){var quaternion=new THREE.Quaternion;return function(optionalTarget){var result=optionalTarget||new THREE.Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,-1).applyQuaternion(quaternion)}}();THREE.Camera.prototype.lookAt=function(){var m1=new THREE.Matrix4;return function(vector){m1.lookAt(this.position,vector,this.up);this.quaternion.setFromRotationMatrix(m1)}}();THREE.Camera.prototype.clone=function(camera){if(camera===undefined)camera=new THREE.Camera;THREE.Object3D.prototype.clone.call(this,camera);camera.matrixWorldInverse.copy(this.matrixWorldInverse);camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.CubeCamera=function(near,far,cubeResolution){THREE.Object3D.call(this);this.type="CubeCamera";var fov=90,aspect=1;var cameraPX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new THREE.Vector3(1,0,0));this.add(cameraPX);var cameraNX=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new THREE.Vector3(-1,0,0));this.add(cameraNX);var cameraPY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new THREE.Vector3(0,1,0));this.add(cameraPY);var cameraNY=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new THREE.Vector3(0,-1,0));this.add(cameraNY);var cameraPZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new THREE.Vector3(0,0,1));this.add(cameraPZ);var cameraNZ=new THREE.PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new THREE.Vector3(0,0,-1));this.add(cameraNZ);this.renderTarget=new THREE.WebGLRenderTargetCube(cubeResolution,cubeResolution,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(renderer,scene){var renderTarget=this.renderTarget;var generateMipmaps=renderTarget.generateMipmaps;renderTarget.generateMipmaps=false;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget)}};THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype);THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.OrthographicCamera=function(left,right,top,bottom,near,far){THREE.Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype);THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){var dx=(this.right-this.left)/(2*this.zoom);var dy=(this.top-this.bottom)/(2*this.zoom);var cx=(this.right+this.left)/2;var cy=(this.top+this.bottom)/2;this.projectionMatrix.makeOrthographic(cx-dx,cx+dx,cy+dy,cy-dy,this.near,this.far)};THREE.OrthographicCamera.prototype.clone=function(){var camera=new THREE.OrthographicCamera;THREE.Camera.prototype.clone.call(this,camera);camera.zoom=this.zoom;camera.left=this.left;camera.right=this.right;camera.top=this.top;camera.bottom=this.bottom;camera.near=this.near;camera.far=this.far;camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.PerspectiveCamera=function(fov,aspect,near,far){THREE.Camera.call(this);this.type="PerspectiveCamera";this.zoom=1;this.fov=fov!==undefined?fov:50;this.aspect=aspect!==undefined?aspect:1;this.near=near!==undefined?near:.1;this.far=far!==undefined?far:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype);THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(focalLength,frameHeight){if(frameHeight===undefined)frameHeight=24;this.fov=2*THREE.Math.radToDeg(Math.atan(frameHeight/(focalLength*2)));this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(fullWidth,fullHeight,x,y,width,height){this.fullWidth=fullWidth;this.fullHeight=fullHeight;this.x=x;this.y=y;this.width=width;this.height=height;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){var fov=THREE.Math.radToDeg(2*Math.atan(Math.tan(THREE.Math.degToRad(this.fov)*.5)/this.zoom));if(this.fullWidth){var aspect=this.fullWidth/this.fullHeight;var top=Math.tan(THREE.Math.degToRad(fov*.5))*this.near;var bottom=-top;var left=aspect*bottom;var right=aspect*top;var width=Math.abs(right-left);var height=Math.abs(top-bottom);this.projectionMatrix.makeFrustum(left+this.x*width/this.fullWidth,left+(this.x+this.width)*width/this.fullWidth,top-(this.y+this.height)*height/this.fullHeight,top-this.y*height/this.fullHeight,this.near,this.far)}else{this.projectionMatrix.makePerspective(fov,this.aspect,this.near,this.far)}};THREE.PerspectiveCamera.prototype.clone=function(){var camera=new THREE.PerspectiveCamera;THREE.Camera.prototype.clone.call(this,camera);camera.zoom=this.zoom;camera.fov=this.fov;camera.aspect=this.aspect;camera.near=this.near;camera.far=this.far;camera.projectionMatrix.copy(this.projectionMatrix);return camera};THREE.Light=function(color){THREE.Object3D.call(this);this.type="Light";this.color=new THREE.Color(color)};THREE.Light.prototype=Object.create(THREE.Object3D.prototype);THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.clone=function(light){if(light===undefined)light=new THREE.Light;THREE.Object3D.prototype.clone.call(this,light);light.color.copy(this.color);return light};THREE.AmbientLight=function(color){THREE.Light.call(this,color);this.type="AmbientLight"};THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype);THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.AmbientLight.prototype.clone=function(){var light=new THREE.AmbientLight;THREE.Light.prototype.clone.call(this,light);return light};THREE.AreaLight=function(color,intensity){THREE.Light.call(this,color);this.type="AreaLight";this.normal=new THREE.Vector3(0,-1,0);this.right=new THREE.Vector3(1,0,0);this.intensity=intensity!==undefined?intensity:1;this.width=1;this.height=1;this.constantAttenuation=1.5;this.linearAttenuation=.5;this.quadraticAttenuation=.1};THREE.AreaLight.prototype=Object.create(THREE.Light.prototype);THREE.AreaLight.prototype.constructor=THREE.AreaLight;THREE.DirectionalLight=function(color,intensity){THREE.Light.call(this,color);this.type="DirectionalLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraRight=500;this.shadowCameraTop=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype);THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.DirectionalLight.prototype.clone=function(){var light=new THREE.DirectionalLight;THREE.Light.prototype.clone.call(this,light);light.target=this.target.clone();light.intensity=this.intensity;light.castShadow=this.castShadow;light.onlyShadow=this.onlyShadow;light.shadowCameraNear=this.shadowCameraNear;light.shadowCameraFar=this.shadowCameraFar;light.shadowCameraLeft=this.shadowCameraLeft;light.shadowCameraRight=this.shadowCameraRight;light.shadowCameraTop=this.shadowCameraTop;light.shadowCameraBottom=this.shadowCameraBottom;light.shadowCameraVisible=this.shadowCameraVisible;light.shadowBias=this.shadowBias;light.shadowDarkness=this.shadowDarkness;light.shadowMapWidth=this.shadowMapWidth;light.shadowMapHeight=this.shadowMapHeight;light.shadowCascade=this.shadowCascade;light.shadowCascadeOffset.copy(this.shadowCascadeOffset);light.shadowCascadeCount=this.shadowCascadeCount;light.shadowCascadeBias=this.shadowCascadeBias.slice(0);light.shadowCascadeWidth=this.shadowCascadeWidth.slice(0);light.shadowCascadeHeight=this.shadowCascadeHeight.slice(0);light.shadowCascadeNearZ=this.shadowCascadeNearZ.slice(0);light.shadowCascadeFarZ=this.shadowCascadeFarZ.slice(0);return light};THREE.HemisphereLight=function(skyColor,groundColor,intensity){THREE.Light.call(this,skyColor);this.type="HemisphereLight";this.position.set(0,100,0);this.groundColor=new THREE.Color(groundColor);this.intensity=intensity!==undefined?intensity:1};THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype);THREE.HemisphereLight.prototype.constructor=THREE.HemisphereLight;THREE.HemisphereLight.prototype.clone=function(){var light=new THREE.HemisphereLight;THREE.Light.prototype.clone.call(this,light);light.groundColor.copy(this.groundColor);light.intensity=this.intensity;return light};THREE.PointLight=function(color,intensity,distance,decay){THREE.Light.call(this,color);this.type="PointLight";this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.decay=decay!==undefined?decay:1};THREE.PointLight.prototype=Object.create(THREE.Light.prototype);THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.PointLight.prototype.clone=function(){var light=new THREE.PointLight;THREE.Light.prototype.clone.call(this,light);light.intensity=this.intensity;light.distance=this.distance;light.decay=this.decay;return light};THREE.SpotLight=function(color,intensity,distance,angle,exponent,decay){THREE.Light.call(this,color);this.type="SpotLight";this.position.set(0,1,0);this.target=new THREE.Object3D;this.intensity=intensity!==undefined?intensity:1;this.distance=distance!==undefined?distance:0;this.angle=angle!==undefined?angle:Math.PI/3;this.exponent=exponent!==undefined?exponent:10;this.decay=decay!==undefined?decay:1;this.castShadow=false;this.onlyShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapWidth=512;this.shadowMapHeight=512;this.shadowMap=null;this.shadowMapSize=null;this.shadowCamera=null;this.shadowMatrix=null};THREE.SpotLight.prototype=Object.create(THREE.Light.prototype);THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.SpotLight.prototype.clone=function(){var light=new THREE.SpotLight;THREE.Light.prototype.clone.call(this,light);light.target=this.target.clone();light.intensity=this.intensity;light.distance=this.distance;light.angle=this.angle;light.exponent=this.exponent;light.decay=this.decay;light.castShadow=this.castShadow;light.onlyShadow=this.onlyShadow;light.shadowCameraNear=this.shadowCameraNear;light.shadowCameraFar=this.shadowCameraFar;light.shadowCameraFov=this.shadowCameraFov;light.shadowCameraVisible=this.shadowCameraVisible;light.shadowBias=this.shadowBias;light.shadowDarkness=this.shadowDarkness;light.shadowMapWidth=this.shadowMapWidth;light.shadowMapHeight=this.shadowMapHeight;return light};THREE.Cache={files:{},add:function(key,file){this.files[key]=file},get:function(key){return this.files[key]},remove:function(key){delete this.files[key]},clear:function(){this.files={}}};THREE.Loader=function(showStatus){this.showStatus=showStatus;this.statusDomElement=showStatus?THREE.Loader.prototype.addStatusElement():null;this.imageLoader=new THREE.ImageLoader;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:undefined,addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(progress){var message="Loaded ";if(progress.total){message+=(100*progress.loaded/progress.total).toFixed(0)+"%"}else{message+=(progress.loaded/1024).toFixed(2)+" KB"}this.statusDomElement.innerHTML=message},extractUrlBase:function(url){var parts=url.split("/");if(parts.length===1)return"./";parts.pop();return parts.join("/")+"/"},initMaterials:function(materials,texturePath){var array=[];for(var i=0;i<materials.length;++i){array[i]=this.createMaterial(materials[i],texturePath)}return array},needsTangents:function(materials){for(var i=0,il=materials.length;i<il;i++){var m=materials[i];if(m instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(m,texturePath){var scope=this;function nearest_pow2(n){var l=Math.log(n)/Math.LN2;return Math.pow(2,Math.round(l))}function create_texture(where,name,sourceFile,repeat,offset,wrap,anisotropy){var fullPath=texturePath+sourceFile;var texture;var loader=THREE.Loader.Handlers.get(fullPath);if(loader!==null){texture=loader.load(fullPath)}else{texture=new THREE.Texture;loader=scope.imageLoader;loader.crossOrigin=scope.crossOrigin;loader.load(fullPath,function(image){if(THREE.Math.isPowerOfTwo(image.width)===false||THREE.Math.isPowerOfTwo(image.height)===false){var width=nearest_pow2(image.width);var height=nearest_pow2(image.height);var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0,width,height);texture.image=canvas}else{texture.image=image}texture.needsUpdate=true})}texture.sourceFile=sourceFile;if(repeat){texture.repeat.set(repeat[0],repeat[1]);if(repeat[0]!==1)texture.wrapS=THREE.RepeatWrapping;if(repeat[1]!==1)texture.wrapT=THREE.RepeatWrapping}if(offset){texture.offset.set(offset[0],offset[1])}if(wrap){var wrapMap={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(wrapMap[wrap[0]]!==undefined)texture.wrapS=wrapMap[wrap[0]];if(wrapMap[wrap[1]]!==undefined)texture.wrapT=wrapMap[wrap[1]]}if(anisotropy){texture.anisotropy=anisotropy}where[name]=texture}function rgb2hex(rgb){return(rgb[0]*255<<16)+(rgb[1]*255<<8)+rgb[2]*255}var mtype="MeshLambertMaterial";var mpars={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:false};if(m.shading){var shading=m.shading.toLowerCase();if(shading==="phong")mtype="MeshPhongMaterial";else if(shading==="basic")mtype="MeshBasicMaterial"}if(m.blending!==undefined&&THREE[m.blending]!==undefined){mpars.blending=THREE[m.blending]}if(m.transparent!==undefined){mpars.transparent=m.transparent}if(m.opacity!==undefined&&m.opacity<1){mpars.transparent=true}if(m.depthTest!==undefined){mpars.depthTest=m.depthTest}if(m.depthWrite!==undefined){mpars.depthWrite=m.depthWrite}if(m.visible!==undefined){mpars.visible=m.visible}if(m.flipSided!==undefined){mpars.side=THREE.BackSide}if(m.doubleSided!==undefined){mpars.side=THREE.DoubleSide}if(m.wireframe!==undefined){mpars.wireframe=m.wireframe}if(m.vertexColors!==undefined){if(m.vertexColors==="face"){mpars.vertexColors=THREE.FaceColors}else if(m.vertexColors){mpars.vertexColors=THREE.VertexColors}}if(m.colorDiffuse){mpars.color=rgb2hex(m.colorDiffuse)}else if(m.DbgColor){mpars.color=m.DbgColor}if(m.colorSpecular){mpars.specular=rgb2hex(m.colorSpecular)}if(m.colorEmissive){mpars.emissive=rgb2hex(m.colorEmissive)}if(m.transparency!==undefined){console.warn("THREE.Loader: transparency has been renamed to opacity");m.opacity=m.transparency}if(m.opacity!==undefined){mpars.opacity=m.opacity}if(m.specularCoef){mpars.shininess=m.specularCoef}if(m.mapDiffuse&&texturePath){create_texture(mpars,"map",m.mapDiffuse,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy)}if(m.mapLight&&texturePath){create_texture(mpars,"lightMap",m.mapLight,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy)}if(m.mapBump&&texturePath){create_texture(mpars,"bumpMap",m.mapBump,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy)}if(m.mapNormal&&texturePath){create_texture(mpars,"normalMap",m.mapNormal,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy)}if(m.mapSpecular&&texturePath){create_texture(mpars,"specularMap",m.mapSpecular,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy)}if(m.mapAlpha&&texturePath){create_texture(mpars,"alphaMap",m.mapAlpha,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy)}if(m.mapBumpScale){mpars.bumpScale=m.mapBumpScale}if(m.mapNormalFactor){mpars.normalScale=new THREE.Vector2(m.mapNormalFactor,m.mapNormalFactor)}var material=new THREE[mtype](mpars);if(m.DbgName!==undefined)material.name=m.DbgName;return material}};THREE.Loader.Handlers={handlers:[],add:function(regex,loader){this.handlers.push(regex,loader)},get:function(file){for(var i=0,l=this.handlers.length;i<l;i+=2){var regex=this.handlers[i];var loader=this.handlers[i+1];if(regex.test(file)){return loader}}return null}};THREE.XHRLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=THREE.Cache.get(url);if(cached!==undefined){if(onLoad)onLoad(cached);return}var request=new XMLHttpRequest;request.open("GET",url,true);request.addEventListener("load",function(event){THREE.Cache.add(url,this.response);if(onLoad)onLoad(this.response);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){request.addEventListener("progress",function(event){onProgress(event)},false)}if(onError!==undefined){request.addEventListener("error",function(event){onError(event)},false)}if(this.crossOrigin!==undefined)request.crossOrigin=this.crossOrigin;if(this.responseType!==undefined)request.responseType=this.responseType;request.send(null);scope.manager.itemStart(url)},setResponseType:function(value){this.responseType=value},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.ImageLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var cached=THREE.Cache.get(url);if(cached!==undefined){onLoad(cached);return}var image=document.createElement("img");image.addEventListener("load",function(event){THREE.Cache.add(url,this);if(onLoad)onLoad(this);scope.manager.itemEnd(url)},false);if(onProgress!==undefined){image.addEventListener("progress",function(event){onProgress(event)},false)}if(onError!==undefined){image.addEventListener("error",function(event){onError(event)},false)}if(this.crossOrigin!==undefined)image.crossOrigin=this.crossOrigin;image.src=url;scope.manager.itemStart(url);return image},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.JSONLoader=function(showStatus){THREE.Loader.call(this,showStatus);this.withCredentials=false};THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype);THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(url,callback,texturePath){texturePath=texturePath&&typeof texturePath==="string"?texturePath:this.extractUrlBase(url);this.onLoadStart();this.loadAjaxJSON(this,url,callback,texturePath)};THREE.JSONLoader.prototype.loadAjaxJSON=function(context,url,callback,texturePath,callbackProgress){var xhr=new XMLHttpRequest;var length=0;xhr.onreadystatechange=function(){if(xhr.readyState===xhr.DONE){if(xhr.status===200||xhr.status===0){if(xhr.responseText){var json=JSON.parse(xhr.responseText);var metadata=json.metadata;if(metadata!==undefined){if(metadata.type==="object"){THREE.error("THREE.JSONLoader: "+url+" should be loaded with THREE.ObjectLoader instead.");return}if(metadata.type==="scene"){THREE.error("THREE.JSONLoader: "+url+" seems to be a Scene. Use THREE.SceneLoader instead.");return}}var result=context.parse(json,texturePath);callback(result.geometry,result.materials)}else{THREE.error("THREE.JSONLoader: "+url+" seems to be unreachable or the file is empty.")}context.onLoadComplete()}else{THREE.error("THREE.JSONLoader: Couldn't load "+url+" ("+xhr.status+")")}}else if(xhr.readyState===xhr.LOADING){if(callbackProgress){if(length===0){length=xhr.getResponseHeader("Content-Length")}callbackProgress({total:length,loaded:xhr.responseText.length})}}else if(xhr.readyState===xhr.HEADERS_RECEIVED){if(callbackProgress!==undefined){length=xhr.getResponseHeader("Content-Length")}}};xhr.open("GET",url,true);xhr.withCredentials=this.withCredentials;xhr.send(null)};THREE.JSONLoader.prototype.parse=function(json,texturePath){var geometry=new THREE.Geometry,scale=json.scale!==undefined?1/json.scale:1;parseModel(scale);parseSkin();parseMorphing(scale);geometry.computeFaceNormals();geometry.computeBoundingSphere();function parseModel(scale){function isBitSet(value,position){return value&1<<position}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,nUvLayers=0;if(json.uvs!==undefined){for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length)nUvLayers++}for(i=0;i<nUvLayers;i++){geometry.faceVertexUvs[i]=[]}}offset=0;zLength=vertices.length;while(offset<zLength){vertex=new THREE.Vector3;vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex)}offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);if(isQuad){faceA=new THREE.Face3;faceA.a=faces[offset];faceA.b=faces[offset+1];faceA.c=faces[offset+3];faceB=new THREE.Face3;faceB.a=faces[offset+1];faceB.b=faces[offset+2];faceB.c=faces[offset+3];offset+=4;if(hasMaterial){materialIndex=faces[offset++];faceA.materialIndex=materialIndex;faceB.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];geometry.faceVertexUvs[i][fi+1]=[];for(j=0;j<4;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);if(j!==2)geometry.faceVertexUvs[i][fi].push(uv);if(j!==0)geometry.faceVertexUvs[i][fi+1].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);faceB.normal.copy(faceA.normal)}if(hasFaceVertexNormal){for(i=0;i<4;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);if(i!==2)faceA.vertexNormals.push(normal);if(i!==0)faceB.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];hex=colors[colorIndex];faceA.color.setHex(hex);faceB.color.setHex(hex)}if(hasFaceVertexColor){for(i=0;i<4;i++){colorIndex=faces[offset++];hex=colors[colorIndex];if(i!==2)faceA.vertexColors.push(new THREE.Color(hex));if(i!==0)faceB.vertexColors.push(new THREE.Color(hex))}}geometry.faces.push(faceA);geometry.faces.push(faceB)}else{face=new THREE.Face3;face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];for(j=0;j<3;j++){uvIndex=faces[offset++];u=uvLayer[uvIndex*2];v=uvLayer[uvIndex*2+1];uv=new THREE.Vector2(u,v);geometry.faceVertexUvs[i][fi].push(uv)}}}if(hasFaceNormal){normalIndex=faces[offset++]*3;face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex])}if(hasFaceVertexNormal){for(i=0;i<3;i++){normalIndex=faces[offset++]*3;normal=new THREE.Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);face.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];face.color.setHex(colors[colorIndex])}if(hasFaceVertexColor){for(i=0;i<3;i++){colorIndex=faces[offset++];face.vertexColors.push(new THREE.Color(colors[colorIndex]))}}geometry.faces.push(face)}}}function parseSkin(){var influencesPerVertex=json.influencesPerVertex!==undefined?json.influencesPerVertex:2;if(json.skinWeights){for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i];var y=influencesPerVertex>1?json.skinWeights[i+1]:0;var z=influencesPerVertex>2?json.skinWeights[i+2]:0;var w=influencesPerVertex>3?json.skinWeights[i+3]:0;geometry.skinWeights.push(new THREE.Vector4(x,y,z,w))}}if(json.skinIndices){for(var i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i];var b=influencesPerVertex>1?json.skinIndices[i+1]:0;var c=influencesPerVertex>2?json.skinIndices[i+2]:0;var d=influencesPerVertex>3?json.skinIndices[i+3]:0;geometry.skinIndices.push(new THREE.Vector4(a,b,c,d))}}geometry.bones=json.bones;if(geometry.bones&&geometry.bones.length>0&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)){THREE.warn("THREE.JSONLoader: When skinning, number of vertices ("+geometry.vertices.length+"), skinIndices ("+geometry.skinIndices.length+"), and skinWeights ("+geometry.skinWeights.length+") should match.")}geometry.animation=json.animation;geometry.animations=json.animations}function parseMorphing(scale){if(json.morphTargets!==undefined){var i,l,v,vl,dstVertices,srcVertices;for(i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];dstVertices=geometry.morphTargets[i].vertices;srcVertices=json.morphTargets[i].vertices;for(v=0,vl=srcVertices.length;v<vl;v+=3){var vertex=new THREE.Vector3;vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex)}}}if(json.morphColors!==undefined){var i,l,c,cl,dstColors,srcColors,color;for(i=0,l=json.morphColors.length;i<l;i++){geometry.morphColors[i]={};geometry.morphColors[i].name=json.morphColors[i].name;geometry.morphColors[i].colors=[];dstColors=geometry.morphColors[i].colors;srcColors=json.morphColors[i].colors;for(c=0,cl=srcColors.length;c<cl;c+=3){color=new THREE.Color(16755200);color.setRGB(srcColors[c],srcColors[c+1],srcColors[c+2]);dstColors.push(color)}}}}if(json.materials===undefined||json.materials.length===0){return{geometry:geometry}}else{var materials=this.initMaterials(json.materials,texturePath);if(this.needsTangents(materials)){geometry.computeTangents()}return{geometry:geometry,materials:materials}}};THREE.LoadingManager=function(onLoad,onProgress,onError){var scope=this;var loaded=0,total=0;this.onLoad=onLoad;this.onProgress=onProgress;this.onError=onError;this.itemStart=function(url){total++};this.itemEnd=function(url){loaded++;if(scope.onProgress!==undefined){scope.onProgress(url,loaded,total)}if(loaded===total&&scope.onLoad!==undefined){scope.onLoad()}}};THREE.DefaultLoadingManager=new THREE.LoadingManager;THREE.BufferGeometryLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var geometry=new THREE.BufferGeometry;var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key];var typedArray=new self[attribute.type](attribute.array);geometry.addAttribute(key,new THREE.BufferAttribute(typedArray,attribute.itemSize))}var offsets=json.data.offsets;if(offsets!==undefined){geometry.offsets=JSON.parse(JSON.stringify(offsets))}var boundingSphere=json.data.boundingSphere;if(boundingSphere!==undefined){var center=new THREE.Vector3;if(boundingSphere.center!==undefined){center.fromArray(boundingSphere.center)}geometry.boundingSphere=new THREE.Sphere(center,boundingSphere.radius)}return geometry}};THREE.MaterialLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json){var material=new THREE[json.type];if(json.color!==undefined)material.color.setHex(json.color);if(json.emissive!==undefined)material.emissive.setHex(json.emissive);if(json.specular!==undefined)material.specular.setHex(json.specular);if(json.shininess!==undefined)material.shininess=json.shininess;if(json.uniforms!==undefined)material.uniforms=json.uniforms;if(json.vertexShader!==undefined)material.vertexShader=json.vertexShader;if(json.fragmentShader!==undefined)material.fragmentShader=json.fragmentShader;if(json.vertexColors!==undefined)material.vertexColors=json.vertexColors;if(json.shading!==undefined)material.shading=json.shading;if(json.blending!==undefined)material.blending=json.blending;if(json.side!==undefined)material.side=json.side;if(json.opacity!==undefined)material.opacity=json.opacity;if(json.transparent!==undefined)material.transparent=json.transparent;if(json.wireframe!==undefined)material.wireframe=json.wireframe;if(json.size!==undefined)material.size=json.size;if(json.sizeAttenuation!==undefined)material.sizeAttenuation=json.sizeAttenuation;if(json.materials!==undefined){for(var i=0,l=json.materials.length;i<l;i++){material.materials.push(this.parse(json.materials[i]))}}return material}};THREE.ObjectLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager;this.texturePath=""};THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(url,onLoad,onProgress,onError){if(this.texturePath===""){this.texturePath=url.substring(0,url.lastIndexOf("/")+1)}var scope=this;var loader=new THREE.XHRLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(text){scope.parse(JSON.parse(text),onLoad)},onProgress,onError)},setTexturePath:function(value){this.texturePath=value},setCrossOrigin:function(value){this.crossOrigin=value},parse:function(json,onLoad){var geometries=this.parseGeometries(json.geometries);var images=this.parseImages(json.images,function(){if(onLoad!==undefined)onLoad(object)});var textures=this.parseTextures(json.textures,images);var materials=this.parseMaterials(json.materials,textures);var object=this.parseObject(json.object,geometries,materials);if(json.images===undefined||json.images.length===0){if(onLoad!==undefined)onLoad(object)}return object},parseGeometries:function(json){var geometries={};if(json!==undefined){var geometryLoader=new THREE.JSONLoader;var bufferGeometryLoader=new THREE.BufferGeometryLoader;for(var i=0,l=json.length;i<l;i++){var geometry;var data=json[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":geometry=new THREE[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"CubeGeometry":geometry=new THREE.BoxGeometry(data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":geometry=new THREE.CircleGeometry(data.radius,data.segments);break;case"CylinderGeometry":geometry=new THREE.CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded);break;case"SphereGeometry":geometry=new THREE.SphereGeometry(data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"IcosahedronGeometry":geometry=new THREE.IcosahedronGeometry(data.radius,data.detail);break;case"TorusGeometry":geometry=new THREE.TorusGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":geometry=new THREE.TorusKnotGeometry(data.radius,data.tube,data.radialSegments,data.tubularSegments,data.p,data.q,data.heightScale);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data);break;case"Geometry":geometry=geometryLoader.parse(data.data).geometry;break}geometry.uuid=data.uuid;if(data.name!==undefined)geometry.name=data.name;geometries[data.uuid]=geometry}}return geometries},parseMaterials:function(json,textures){var materials={};if(json!==undefined){var getTexture=function(name){if(textures[name]===undefined){THREE.warn("THREE.ObjectLoader: Undefined texture",name)}return textures[name]};var loader=new THREE.MaterialLoader;for(var i=0,l=json.length;i<l;i++){var data=json[i];var material=loader.parse(data);material.uuid=data.uuid;if(data.name!==undefined)material.name=data.name;if(data.map!==undefined){material.map=getTexture(data.map)}if(data.bumpMap!==undefined){material.bumpMap=getTexture(data.bumpMap);if(data.bumpScale){material.bumpScale=new THREE.Vector2(data.bumpScale,data.bumpScale)}}if(data.alphaMap!==undefined){material.alphaMap=getTexture(data.alphaMap)}if(data.envMap!==undefined){material.envMap=getTexture(data.envMap)}if(data.normalMap!==undefined){material.normalMap=getTexture(data.normalMap);if(data.normalScale){material.normalScale=new THREE.Vector2(data.normalScale,data.normalScale)}}if(data.lightMap!==undefined){material.lightMap=getTexture(data.lightMap)}if(data.specularMap!==undefined){material.specularMap=getTexture(data.specularMap)}materials[data.uuid]=material}}return materials},parseImages:function(json,onLoad){var scope=this;var images={};if(json!==undefined&&json.length>0){var manager=new THREE.LoadingManager(onLoad);var loader=new THREE.ImageLoader(manager);loader.setCrossOrigin(this.crossOrigin);var loadImage=function(url){scope.manager.itemStart(url);return loader.load(url,function(){scope.manager.itemEnd(url)})};for(var i=0,l=json.length;i<l;i++){var image=json[i];var path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.texturePath+image.url;images[image.uuid]=loadImage(path)}}return images},parseTextures:function(json,images){var textures={};if(json!==undefined){for(var i=0,l=json.length;i<l;i++){var data=json[i];if(data.image===undefined){THREE.warn('THREE.ObjectLoader: No "image" speficied for',data.uuid)}if(images[data.image]===undefined){THREE.warn("THREE.ObjectLoader: Undefined image",data.image)}var texture=new THREE.Texture(images[data.image]);texture.needsUpdate=true;texture.uuid=data.uuid;if(data.name!==undefined)texture.name=data.name;if(data.repeat!==undefined)texture.repeat=new THREE.Vector2(data.repeat[0],data.repeat[1]);if(data.minFilter!==undefined)texture.minFilter=THREE[data.minFilter];if(data.magFilter!==undefined)texture.magFilter=THREE[data.magFilter];if(data.anisotropy!==undefined)texture.anisotropy=data.anisotropy;if(data.wrap instanceof Array){texture.wrapS=THREE[data.wrap[0]];texture.wrapT=THREE[data.wrap[1]]}textures[data.uuid]=texture}}return textures},parseObject:function(){var matrix=new THREE.Matrix4;return function(data,geometries,materials){var object;var getGeometry=function(name){if(geometries[name]===undefined){THREE.warn("THREE.ObjectLoader: Undefined geometry",name)}return geometries[name]};var getMaterial=function(name){if(materials[name]===undefined){THREE.warn("THREE.ObjectLoader: Undefined material",name)}return materials[name]};switch(data.type){case"Scene":object=new THREE.Scene;break;case"PerspectiveCamera":object=new THREE.PerspectiveCamera(data.fov,data.aspect,data.near,data.far);break;case"OrthographicCamera":object=new THREE.OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new THREE.AmbientLight(data.color);break;case"DirectionalLight":object=new THREE.DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new THREE.PointLight(data.color,data.intensity,data.distance,data.decay);break;case"SpotLight":object=new THREE.SpotLight(data.color,data.intensity,data.distance,data.angle,data.exponent,data.decay);break;case"HemisphereLight":object=new THREE.HemisphereLight(data.color,data.groundColor,data.intensity);break;case"Mesh":object=new THREE.Mesh(getGeometry(data.geometry),getMaterial(data.material));break;case"Line":object=new THREE.Line(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case"PointCloud":object=new THREE.PointCloud(getGeometry(data.geometry),getMaterial(data.material));break;case"Sprite":object=new THREE.Sprite(getMaterial(data.material));break;case"Group":object=new THREE.Group;break;default:object=new THREE.Object3D}object.uuid=data.uuid;if(data.name!==undefined)object.name=data.name;if(data.matrix!==undefined){matrix.fromArray(data.matrix);matrix.decompose(object.position,object.quaternion,object.scale)}else{if(data.position!==undefined)object.position.fromArray(data.position);if(data.rotation!==undefined)object.rotation.fromArray(data.rotation);if(data.scale!==undefined)object.scale.fromArray(data.scale)}if(data.visible!==undefined)object.visible=data.visible;if(data.userData!==undefined)object.userData=data.userData;if(data.children!==undefined){for(var child in data.children){object.add(this.parseObject(data.children[child],geometries,materials))}}return object}}()};THREE.TextureLoader=function(manager){this.manager=manager!==undefined?manager:THREE.DefaultLoadingManager};THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var loader=new THREE.ImageLoader(scope.manager);loader.setCrossOrigin(this.crossOrigin);loader.load(url,function(image){var texture=new THREE.Texture(image);texture.needsUpdate=true;if(onLoad!==undefined){onLoad(texture)}},onProgress,onError)},setCrossOrigin:function(value){this.crossOrigin=value}};THREE.DataTextureLoader=THREE.BinaryTextureLoader=function(){this._parser=null};THREE.BinaryTextureLoader.prototype={constructor:THREE.BinaryTextureLoader,load:function(url,onLoad,onProgress,onError){var scope=this;var texture=new THREE.DataTexture;var loader=new THREE.XHRLoader;loader.setResponseType("arraybuffer");loader.load(url,function(buffer){var texData=scope._parser(buffer);if(!texData)return;if(undefined!==texData.image){texture.image=texData.image}else if(undefined!==texData.data){texture.image.width=texData.width;texture.image.height=texData.height;texture.image.data=texData.data}texture.wrapS=undefined!==texData.wrapS?texData.wrapS:THREE.ClampToEdgeWrapping;texture.wrapT=undefined!==texData.wrapT?texData.wrapT:THREE.ClampToEdgeWrapping;texture.magFilter=undefined!==texData.magFilter?texData.magFilter:THREE.LinearFilter;texture.minFilter=undefined!==texData.minFilter?texData.minFilter:THREE.LinearMipMapLinearFilter;texture.anisotropy=undefined!==texData.anisotropy?texData.anisotropy:1;if(undefined!==texData.format){texture.format=texData.format}if(undefined!==texData.type){texture.type=texData.type}if(undefined!==texData.mipmaps){texture.mipmaps=texData.mipmaps}if(1===texData.mipmapCount){texture.minFilter=THREE.LinearFilter}texture.needsUpdate=true;if(onLoad)onLoad(texture,texData)},onProgress,onError);return texture}};THREE.CompressedTextureLoader=function(){this._parser=null};THREE.CompressedTextureLoader.prototype={constructor:THREE.CompressedTextureLoader,load:function(url,onLoad,onError){var scope=this;var images=[];var texture=new THREE.CompressedTexture;texture.image=images;var loader=new THREE.XHRLoader;loader.setResponseType("arraybuffer");if(url instanceof Array){var loaded=0;var loadTexture=function(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,true);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps};loaded+=1;if(loaded===6){if(texDatas.mipmapCount==1)texture.minFilter=THREE.LinearFilter;texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)}})};for(var i=0,il=url.length;i<il;++i){loadTexture(i)}}else{loader.load(url,function(buffer){var texDatas=scope._parser(buffer,true);if(texDatas.isCubemap){var faces=texDatas.mipmaps.length/texDatas.mipmapCount;for(var f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++){images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]);images[f].format=texDatas.format;images[f].width=texDatas.width;images[f].height=texDatas.height}}}else{texture.image.width=texDatas.width;texture.image.height=texDatas.height;texture.mipmaps=texDatas.mipmaps}if(texDatas.mipmapCount===1){texture.minFilter=THREE.LinearFilter}texture.format=texDatas.format;texture.needsUpdate=true;if(onLoad)onLoad(texture)})}return texture}};THREE.Material=function(){Object.defineProperty(this,"id",{value:THREE.MaterialIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.type="Material";this.side=THREE.FrontSide;this.opacity=1;this.transparent=false;this.blending=THREE.NormalBlending;this.blendSrc=THREE.SrcAlphaFactor;this.blendDst=THREE.OneMinusSrcAlphaFactor;this.blendEquation=THREE.AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthTest=true;this.depthWrite=true;this.colorWrite=true;this.polygonOffset=false;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.alphaTest=0;this.overdraw=0;this.visible=true;this._needsUpdate=true};THREE.Material.prototype={constructor:THREE.Material,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value},setValues:function(values){if(values===undefined)return;for(var key in values){var newValue=values[key];if(newValue===undefined){THREE.warn("THREE.Material: '"+key+"' parameter is undefined.");continue}if(key in this){var currentValue=this[key];if(currentValue instanceof THREE.Color){currentValue.set(newValue)}else if(currentValue instanceof THREE.Vector3&&newValue instanceof THREE.Vector3){currentValue.copy(newValue)}else if(key=="overdraw"){this[key]=Number(newValue)}else{this[key]=newValue}}}},toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type};if(this.name!=="")output.name=this.name;if(this instanceof THREE.MeshBasicMaterial){output.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshLambertMaterial){output.color=this.color.getHex();output.emissive=this.emissive.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.shading!==THREE.SmoothShading)output.shading=this.shading;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshPhongMaterial){output.color=this.color.getHex();output.emissive=this.emissive.getHex();output.specular=this.specular.getHex();output.shininess=this.shininess;if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.shading!==THREE.SmoothShading)output.shading=this.shading;if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshNormalMaterial){if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.MeshDepthMaterial){if(this.blending!==THREE.NormalBlending)output.blending=this.blending;if(this.side!==THREE.FrontSide)output.side=this.side}else if(this instanceof THREE.PointCloudMaterial){output.size=this.size;output.sizeAttenuation=this.sizeAttenuation;output.color=this.color.getHex();if(this.vertexColors!==THREE.NoColors)output.vertexColors=this.vertexColors;if(this.blending!==THREE.NormalBlending)output.blending=this.blending}else if(this instanceof THREE.ShaderMaterial){output.uniforms=this.uniforms;output.vertexShader=this.vertexShader;output.fragmentShader=this.fragmentShader}else if(this instanceof THREE.SpriteMaterial){output.color=this.color.getHex()}if(this.opacity<1)output.opacity=this.opacity;if(this.transparent!==false)output.transparent=this.transparent;if(this.wireframe!==false)output.wireframe=this.wireframe;return output},clone:function(material){if(material===undefined)material=new THREE.Material;material.name=this.name;material.side=this.side;material.opacity=this.opacity;material.transparent=this.transparent;material.blending=this.blending;material.blendSrc=this.blendSrc;material.blendDst=this.blendDst;material.blendEquation=this.blendEquation;material.blendSrcAlpha=this.blendSrcAlpha;material.blendDstAlpha=this.blendDstAlpha;material.blendEquationAlpha=this.blendEquationAlpha;material.depthTest=this.depthTest;material.depthWrite=this.depthWrite;material.polygonOffset=this.polygonOffset;material.polygonOffsetFactor=this.polygonOffsetFactor;material.polygonOffsetUnits=this.polygonOffsetUnits;material.alphaTest=this.alphaTest;material.overdraw=this.overdraw;material.visible=this.visible;return material},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Material.prototype);THREE.MaterialIdCount=0;THREE.LineBasicMaterial=function(parameters){THREE.Material.call(this);this.type="LineBasicMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.LineBasicMaterial.prototype.clone=function(){var material=new THREE.LineBasicMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.linecap=this.linecap;material.linejoin=this.linejoin;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.LineDashedMaterial=function(parameters){THREE.Material.call(this);this.type="LineDashedMaterial";this.color=new THREE.Color(16777215);this.linewidth=1;this.scale=1;this.dashSize=3;this.gapSize=1;this.vertexColors=false;this.fog=true;this.setValues(parameters)};THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype);THREE.LineDashedMaterial.prototype.constructor=THREE.LineDashedMaterial;THREE.LineDashedMaterial.prototype.clone=function(){var material=new THREE.LineDashedMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.linewidth=this.linewidth;material.scale=this.scale;material.dashSize=this.dashSize;material.gapSize=this.gapSize;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.MeshBasicMaterial=function(parameters){THREE.Material.call(this);this.type="MeshBasicMaterial";this.color=new THREE.Color(16777215);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.setValues(parameters)};THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshBasicMaterial.prototype.clone=function(){var material=new THREE.MeshBasicMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;return material};THREE.MeshLambertMaterial=function(parameters){THREE.Material.call(this);this.type="MeshLambertMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshLambertMaterial.prototype.clone=function(){var material=new THREE.MeshLambertMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.emissive.copy(this.emissive);material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.MeshPhongMaterial=function(parameters){THREE.Material.call(this);this.type="MeshPhongMaterial";this.color=new THREE.Color(16777215);this.emissive=new THREE.Color(0);this.specular=new THREE.Color(1118481);this.shininess=30;this.metal=false;this.wrapAround=false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=null;this.lightMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new THREE.Vector2(1,1);this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=THREE.MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.fog=true;this.shading=THREE.SmoothShading;this.wireframe=false;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.setValues(parameters)};THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshPhongMaterial.prototype.clone=function(){var material=new THREE.MeshPhongMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.emissive.copy(this.emissive);material.specular.copy(this.specular);material.shininess=this.shininess;material.metal=this.metal;material.wrapAround=this.wrapAround;material.wrapRGB.copy(this.wrapRGB);material.map=this.map;material.lightMap=this.lightMap;material.bumpMap=this.bumpMap;material.bumpScale=this.bumpScale;material.normalMap=this.normalMap;material.normalScale.copy(this.normalScale);material.specularMap=this.specularMap;material.alphaMap=this.alphaMap;material.envMap=this.envMap;material.combine=this.combine;material.reflectivity=this.reflectivity;material.refractionRatio=this.refractionRatio;material.fog=this.fog;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.wireframeLinecap=this.wireframeLinecap;material.wireframeLinejoin=this.wireframeLinejoin;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.MeshDepthMaterial=function(parameters){THREE.Material.call(this);this.type="MeshDepthMaterial";this.morphTargets=false;this.wireframe=false;this.wireframeLinewidth=1;this.setValues(parameters)};THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshDepthMaterial.prototype.clone=function(){var material=new THREE.MeshDepthMaterial;THREE.Material.prototype.clone.call(this,material);material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material};THREE.MeshNormalMaterial=function(parameters){THREE.Material.call(this,parameters);this.type="MeshNormalMaterial";this.wireframe=false;this.wireframeLinewidth=1;this.morphTargets=false;this.setValues(parameters)};THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype);THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshNormalMaterial.prototype.clone=function(){var material=new THREE.MeshNormalMaterial;THREE.Material.prototype.clone.call(this,material);material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;return material};THREE.MeshFaceMaterial=function(materials){this.uuid=THREE.Math.generateUUID();this.type="MeshFaceMaterial";this.materials=materials instanceof Array?materials:[]};THREE.MeshFaceMaterial.prototype={constructor:THREE.MeshFaceMaterial,toJSON:function(){var output={metadata:{version:4.2,type:"material",generator:"MaterialExporter"},uuid:this.uuid,type:this.type,materials:[]};for(var i=0,l=this.materials.length;i<l;i++){output.materials.push(this.materials[i].toJSON())}return output},clone:function(){var material=new THREE.MeshFaceMaterial;for(var i=0;i<this.materials.length;i++){material.materials.push(this.materials[i].clone())}return material}};THREE.PointCloudMaterial=function(parameters){THREE.Material.call(this);this.type="PointCloudMaterial";this.color=new THREE.Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=true;this.vertexColors=THREE.NoColors;this.fog=true;this.setValues(parameters)};THREE.PointCloudMaterial.prototype=Object.create(THREE.Material.prototype);THREE.PointCloudMaterial.prototype.constructor=THREE.PointCloudMaterial;THREE.PointCloudMaterial.prototype.clone=function(){var material=new THREE.PointCloudMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.size=this.size;material.sizeAttenuation=this.sizeAttenuation;material.vertexColors=this.vertexColors;material.fog=this.fog;return material};THREE.ParticleBasicMaterial=function(parameters){THREE.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(parameters)};THREE.ParticleSystemMaterial=function(parameters){THREE.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointCloudMaterial.");return new THREE.PointCloudMaterial(parameters)};THREE.ShaderMaterial=function(parameters){THREE.Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.attributes=null;this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.shading=THREE.SmoothShading;this.linewidth=1;this.wireframe=false;this.wireframeLinewidth=1;this.fog=false;this.lights=false;this.vertexColors=THREE.NoColors;this.skinning=false;this.morphTargets=false;this.morphNormals=false;this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=undefined;this.setValues(parameters)};THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype);THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.ShaderMaterial.prototype.clone=function(){var material=new THREE.ShaderMaterial;THREE.Material.prototype.clone.call(this,material);material.fragmentShader=this.fragmentShader;material.vertexShader=this.vertexShader;material.uniforms=THREE.UniformsUtils.clone(this.uniforms);material.attributes=this.attributes;material.defines=this.defines;material.shading=this.shading;material.wireframe=this.wireframe;material.wireframeLinewidth=this.wireframeLinewidth;material.fog=this.fog;material.lights=this.lights;material.vertexColors=this.vertexColors;material.skinning=this.skinning;material.morphTargets=this.morphTargets;material.morphNormals=this.morphNormals;return material};THREE.RawShaderMaterial=function(parameters){THREE.ShaderMaterial.call(this,parameters);this.type="RawShaderMaterial"};THREE.RawShaderMaterial.prototype=Object.create(THREE.ShaderMaterial.prototype);THREE.RawShaderMaterial.prototype.constructor=THREE.RawShaderMaterial;THREE.RawShaderMaterial.prototype.clone=function(){var material=new THREE.RawShaderMaterial;THREE.ShaderMaterial.prototype.clone.call(this,material);return material};THREE.SpriteMaterial=function(parameters){THREE.Material.call(this);this.type="SpriteMaterial";this.color=new THREE.Color(16777215);this.map=null;this.rotation=0;this.fog=false;this.setValues(parameters)};THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype);THREE.SpriteMaterial.prototype.constructor=THREE.SpriteMaterial;THREE.SpriteMaterial.prototype.clone=function(){var material=new THREE.SpriteMaterial;THREE.Material.prototype.clone.call(this,material);material.color.copy(this.color);material.map=this.map;material.rotation=this.rotation;material.fog=this.fog;return material};THREE.Texture=function(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Object.defineProperty(this,"id",{value:THREE.TextureIdCount++});this.uuid=THREE.Math.generateUUID();this.name="";this.sourceFile="";this.image=image!==undefined?image:THREE.Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=mapping!==undefined?mapping:THREE.Texture.DEFAULT_MAPPING;this.wrapS=wrapS!==undefined?wrapS:THREE.ClampToEdgeWrapping;this.wrapT=wrapT!==undefined?wrapT:THREE.ClampToEdgeWrapping;this.magFilter=magFilter!==undefined?magFilter:THREE.LinearFilter;this.minFilter=minFilter!==undefined?minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=anisotropy!==undefined?anisotropy:1;this.format=format!==undefined?format:THREE.RGBAFormat;this.type=type!==undefined?type:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.premultiplyAlpha=false;this.flipY=true;this.unpackAlignment=4;this._needsUpdate=false;this.onUpdate=null};THREE.Texture.DEFAULT_IMAGE=undefined;THREE.Texture.DEFAULT_MAPPING=THREE.UVMapping;THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(value){if(value===true)this.update();this._needsUpdate=value},clone:function(texture){if(texture===undefined)texture=new THREE.Texture;texture.image=this.image;texture.mipmaps=this.mipmaps.slice(0);texture.mapping=this.mapping;texture.wrapS=this.wrapS;texture.wrapT=this.wrapT;texture.magFilter=this.magFilter;texture.minFilter=this.minFilter;texture.anisotropy=this.anisotropy;texture.format=this.format;texture.type=this.type;texture.offset.copy(this.offset);texture.repeat.copy(this.repeat);texture.generateMipmaps=this.generateMipmaps;texture.premultiplyAlpha=this.premultiplyAlpha;texture.flipY=this.flipY;texture.unpackAlignment=this.unpackAlignment;return texture},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype);THREE.TextureIdCount=0;THREE.CubeTexture=function(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){mapping=mapping!==undefined?mapping:THREE.CubeReflectionMapping;THREE.Texture.call(this,images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.images=images};THREE.CubeTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CubeTexture.prototype.constructor=THREE.CubeTexture;THREE.CubeTexture.clone=function(texture){if(texture===undefined)texture=new THREE.CubeTexture;THREE.Texture.prototype.clone.call(this,texture);texture.images=this.images;return texture};THREE.CompressedTexture=function(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={width:width,height:height};this.mipmaps=mipmaps;this.flipY=false;this.generateMipmaps=false};THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype);THREE.CompressedTexture.prototype.constructor=THREE.CompressedTexture;THREE.CompressedTexture.prototype.clone=function(){var texture=new THREE.CompressedTexture;THREE.Texture.prototype.clone.call(this,texture);return texture};THREE.DataTexture=function(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy){THREE.Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={data:data,width:width,height:height}};THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype);THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var texture=new THREE.DataTexture;THREE.Texture.prototype.clone.call(this,texture);return texture};THREE.VideoTexture=function(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){THREE.Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.generateMipmaps=false;var scope=this;var update=function(){requestAnimationFrame(update);if(video.readyState===video.HAVE_ENOUGH_DATA){scope.needsUpdate=true}};update()};THREE.VideoTexture.prototype=Object.create(THREE.Texture.prototype);THREE.VideoTexture.prototype.constructor=THREE.VideoTexture;THREE.Group=function(){THREE.Object3D.call(this);this.type="Group"};THREE.Group.prototype=Object.create(THREE.Object3D.prototype);THREE.Group.prototype.constructor=THREE.Group;THREE.PointCloud=function(geometry,material){THREE.Object3D.call(this);this.type="PointCloud";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.PointCloudMaterial({color:Math.random()*16777215})};THREE.PointCloud.prototype=Object.create(THREE.Object3D.prototype);THREE.PointCloud.prototype.constructor=THREE.PointCloud;THREE.PointCloud.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;return function(raycaster,intersects){var object=this;var geometry=object.geometry;var threshold=raycaster.params.PointCloud.threshold;inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3);var position=new THREE.Vector3;var testPoint=function(point,index){var rayPointDistance=ray.distanceToPoint(point);if(rayPointDistance<localThreshold){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);intersects.push({distance:distance,distanceToRay:rayPointDistance,point:intersectPoint.clone(),index:index,face:null,object:object})}};if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;var positions=attributes.position.array;if(attributes.index!==undefined){var indices=attributes.index.array;var offsets=geometry.offsets;if(offsets.length===0){var offset={start:0,count:indices.length,index:0};offsets=[offset]}for(var oi=0,ol=offsets.length;oi<ol;++oi){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start,il=start+count;i<il;i++){var a=index+indices[i];position.fromArray(positions,a*3);testPoint(position,a)}}}else{var pointCount=positions.length/3;for(var i=0;i<pointCount;i++){position.set(positions[3*i],positions[3*i+1],positions[3*i+2]);testPoint(position,i)}}}else{var vertices=this.geometry.vertices;for(var i=0;i<vertices.length;i++){testPoint(vertices[i],i)}}}}();THREE.PointCloud.prototype.clone=function(object){if(object===undefined)object=new THREE.PointCloud(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.ParticleSystem=function(geometry,material){THREE.warn("THREE.ParticleSystem has been renamed to THREE.PointCloud.");return new THREE.PointCloud(geometry,material)};THREE.Line=function(geometry,material,mode){THREE.Object3D.call(this);this.type="Line";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.mode=mode!==undefined?mode:THREE.LineStrip};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=Object.create(THREE.Object3D.prototype);THREE.Line.prototype.constructor=THREE.Line;THREE.Line.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;return function(raycaster,intersects){var precision=raycaster.linePrecision;var precisionSq=precision*precision;var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var vStart=new THREE.Vector3;var vEnd=new THREE.Vector3;var interSegment=new THREE.Vector3;var interRay=new THREE.Vector3;var step=this.mode===THREE.LineStrip?1:2;if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;if(attributes.index!==undefined){var indices=attributes.index.array;var positions=attributes.position.array;var offsets=geometry.offsets;if(offsets.length===0){offsets=[{start:0,count:indices.length,index:0}]}for(var oi=0;oi<offsets.length;oi++){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start;i<start+count-1;i+=step){var a=index+indices[i];var b=index+indices[i+1];vStart.fromArray(positions,a*3);vEnd.fromArray(positions,b*3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,offsetIndex:oi,face:null,faceIndex:null,object:this})}}}else{var positions=attributes.position.array;for(var i=0;i<positions.length/3-1;i+=step){vStart.fromArray(positions,3*i);vEnd.fromArray(positions,3*i+3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else if(geometry instanceof THREE.Geometry){var vertices=geometry.vertices;var nbVertices=vertices.length;for(var i=0;i<nbVertices-1;i+=step){var distSq=ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment);if(distSq>precisionSq)continue;var distance=ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}}();THREE.Line.prototype.clone=function(object){if(object===undefined)object=new THREE.Line(this.geometry,this.material,this.mode);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.Mesh=function(geometry,material){THREE.Object3D.call(this);this.type="Mesh";this.geometry=geometry!==undefined?geometry:new THREE.Geometry;this.material=material!==undefined?material:new THREE.MeshBasicMaterial({color:Math.random()*16777215});this.updateMorphTargets()};THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype);THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets!==undefined&&this.geometry.morphTargets.length>0){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var m=0,ml=this.geometry.morphTargets.length;m<ml;m++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[m].name]=m}}};THREE.Mesh.prototype.getMorphTargetIndexByName=function(name){if(this.morphTargetDictionary[name]!==undefined){return this.morphTargetDictionary[name]}THREE.warn("THREE.Mesh.getMorphTargetIndexByName: morph target "+name+" does not exist. Returning 0.");return 0};THREE.Mesh.prototype.raycast=function(){var inverseMatrix=new THREE.Matrix4;var ray=new THREE.Ray;var sphere=new THREE.Sphere;var vA=new THREE.Vector3;var vB=new THREE.Vector3;var vC=new THREE.Vector3;return function(raycaster,intersects){var geometry=this.geometry;if(geometry.boundingSphere===null)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(this.matrixWorld);if(raycaster.ray.isIntersectionSphere(sphere)===false){return}inverseMatrix.getInverse(this.matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(geometry.boundingBox!==null){if(ray.isIntersectionBox(geometry.boundingBox)===false){return}}if(geometry instanceof THREE.BufferGeometry){var material=this.material;if(material===undefined)return;var attributes=geometry.attributes;var a,b,c;var precision=raycaster.precision;if(attributes.index!==undefined){var indices=attributes.index.array;var positions=attributes.position.array;var offsets=geometry.offsets;if(offsets.length===0){offsets=[{start:0,count:indices.length,index:0}]}for(var oi=0,ol=offsets.length;oi<ol;++oi){var start=offsets[oi].start;var count=offsets[oi].count;var index=offsets[oi].index;for(var i=start,il=start+count;i<il;i+=3){a=index+indices[i];b=index+indices[i+1];c=index+indices[i+2];vA.fromArray(positions,a*3);vB.fromArray(positions,b*3);vC.fromArray(positions,c*3);if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(vC,vB,vA,true)}else{var intersectionPoint=ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:null,object:this})}}}else{var positions=attributes.position.array;for(var i=0,j=0,il=positions.length;i<il;i+=3,j+=9){a=i;b=i+1;c=i+2;vA.fromArray(positions,j);vB.fromArray(positions,j+3);vC.fromArray(positions,j+6);if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(vC,vB,vA,true)}else{var intersectionPoint=ray.intersectTriangle(vA,vB,vC,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:new THREE.Face3(a,b,c,THREE.Triangle.normal(vA,vB,vC)),faceIndex:null,object:this})}}}else if(geometry instanceof THREE.Geometry){var isFaceMaterial=this.material instanceof THREE.MeshFaceMaterial;var objectMaterials=isFaceMaterial===true?this.material.materials:null;var a,b,c;var precision=raycaster.precision;var vertices=geometry.vertices;for(var f=0,fl=geometry.faces.length;f<fl;f++){var face=geometry.faces[f];var material=isFaceMaterial===true?objectMaterials[face.materialIndex]:this.material;if(material===undefined)continue;a=vertices[face.a];b=vertices[face.b];c=vertices[face.c];if(material.morphTargets===true){var morphTargets=geometry.morphTargets;var morphInfluences=this.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var t=0,tl=morphTargets.length;t<tl;t++){var influence=morphInfluences[t];if(influence===0)continue;var targets=morphTargets[t].vertices;vA.x+=(targets[face.a].x-a.x)*influence;vA.y+=(targets[face.a].y-a.y)*influence;vA.z+=(targets[face.a].z-a.z)*influence;vB.x+=(targets[face.b].x-b.x)*influence;vB.y+=(targets[face.b].y-b.y)*influence;vB.z+=(targets[face.b].z-b.z)*influence;vC.x+=(targets[face.c].x-c.x)*influence;vC.y+=(targets[face.c].y-c.y)*influence;vC.z+=(targets[face.c].z-c.z)*influence}vA.add(a);vB.add(b);vC.add(c);a=vA;b=vB;c=vC}if(material.side===THREE.BackSide){var intersectionPoint=ray.intersectTriangle(c,b,a,true)}else{var intersectionPoint=ray.intersectTriangle(a,b,c,material.side!==THREE.DoubleSide)}if(intersectionPoint===null)continue;intersectionPoint.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPoint);if(distance<precision||distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:intersectionPoint,face:face,faceIndex:f,object:this})}}}}();THREE.Mesh.prototype.clone=function(object,recursive){if(object===undefined)object=new THREE.Mesh(this.geometry,this.material);THREE.Object3D.prototype.clone.call(this,object,recursive);return object};THREE.Bone=function(skin){THREE.Object3D.call(this);this.type="Bone";this.skin=skin};THREE.Bone.prototype=Object.create(THREE.Object3D.prototype);THREE.Bone.prototype.constructor=THREE.Bone;THREE.Skeleton=function(bones,boneInverses,useVertexTexture){this.useVertexTexture=useVertexTexture!==undefined?useVertexTexture:true;this.identityMatrix=new THREE.Matrix4;bones=bones||[];this.bones=bones.slice(0);if(this.useVertexTexture){var size;if(this.bones.length>256)size=64;else if(this.bones.length>64)size=32;else if(this.bones.length>16)size=16;else size=8;this.boneTextureWidth=size;this.boneTextureHeight=size;this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4);this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType);this.boneTexture.minFilter=THREE.NearestFilter;this.boneTexture.magFilter=THREE.NearestFilter;this.boneTexture.generateMipmaps=false;this.boneTexture.flipY=false}else{this.boneMatrices=new Float32Array(16*this.bones.length)}if(boneInverses===undefined){this.calculateInverses()}else{if(this.bones.length===boneInverses.length){this.boneInverses=boneInverses.slice(0)}else{THREE.warn("THREE.Skeleton bonInverses is the wrong length.");this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){this.boneInverses.push(new THREE.Matrix4)}}}};THREE.Skeleton.prototype.calculateInverses=function(){this.boneInverses=[];for(var b=0,bl=this.bones.length;b<bl;b++){var inverse=new THREE.Matrix4;if(this.bones[b]){inverse.getInverse(this.bones[b].matrixWorld)}this.boneInverses.push(inverse)}};THREE.Skeleton.prototype.pose=function(){var bone;for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){bone.matrixWorld.getInverse(this.boneInverses[b])}}for(var b=0,bl=this.bones.length;b<bl;b++){bone=this.bones[b];if(bone){if(bone.parent){bone.matrix.getInverse(bone.parent.matrixWorld);bone.matrix.multiply(bone.matrixWorld)}else{bone.matrix.copy(bone.matrixWorld)}bone.matrix.decompose(bone.position,bone.quaternion,bone.scale)}}};THREE.Skeleton.prototype.update=function(){var offsetMatrix=new THREE.Matrix4;return function(){for(var b=0,bl=this.bones.length;b<bl;b++){var matrix=this.bones[b]?this.bones[b].matrixWorld:this.identityMatrix;offsetMatrix.multiplyMatrices(matrix,this.boneInverses[b]);offsetMatrix.flattenToArrayOffset(this.boneMatrices,b*16)}if(this.useVertexTexture){this.boneTexture.needsUpdate=true}}}();THREE.SkinnedMesh=function(geometry,material,useVertexTexture){THREE.Mesh.call(this,geometry,material);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new THREE.Matrix4;this.bindMatrixInverse=new THREE.Matrix4;var bones=[];if(this.geometry&&this.geometry.bones!==undefined){var bone,gbone,p,q,s;for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];p=gbone.pos;q=gbone.rotq;s=gbone.scl;bone=new THREE.Bone(this);bones.push(bone);bone.name=gbone.name;bone.position.set(p[0],p[1],p[2]);bone.quaternion.set(q[0],q[1],q[2],q[3]);if(s!==undefined){bone.scale.set(s[0],s[1],s[2])}else{bone.scale.set(1,1,1)}}for(var b=0,bl=this.geometry.bones.length;b<bl;++b){gbone=this.geometry.bones[b];if(gbone.parent!==-1){bones[gbone.parent].add(bones[b])}else{this.add(bones[b])}}}this.normalizeSkinWeights();this.updateMatrixWorld(true);this.bind(new THREE.Skeleton(bones,undefined,useVertexTexture))};THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.bind=function(skeleton,bindMatrix){this.skeleton=skeleton;if(bindMatrix===undefined){this.updateMatrixWorld(true);bindMatrix=this.matrixWorld}this.bindMatrix.copy(bindMatrix);this.bindMatrixInverse.getInverse(bindMatrix)};THREE.SkinnedMesh.prototype.pose=function(){this.skeleton.pose()};THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry){for(var i=0;i<this.geometry.skinIndices.length;i++){var sw=this.geometry.skinWeights[i];var scale=1/sw.lengthManhattan();if(scale!==Infinity){sw.multiplyScalar(scale)}else{sw.set(1)}}}else{}};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(force){THREE.Mesh.prototype.updateMatrixWorld.call(this,true);if(this.bindMode==="attached"){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if(this.bindMode==="detached"){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{THREE.warn("THREE.SkinnedMesh unreckognized bindMode: "+this.bindMode)}};THREE.SkinnedMesh.prototype.clone=function(object){if(object===undefined){object=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)}THREE.Mesh.prototype.clone.call(this,object);return object};THREE.MorphAnimMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.type="MorphAnimMesh";this.duration=1e3;this.mirroredLoop=false;this.time=0;this.lastKeyframe=0;this.currentKeyframe=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(start,end){this.startKeyframe=start;this.endKeyframe=end;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var geometry=this.geometry;if(!geometry.animations)geometry.animations={};var firstAnimation,animations=geometry.animations;var pattern=/([a-z]+)_?(\d+)/;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var parts=morph.name.match(pattern);if(parts&&parts.length>1){var label=parts[1];if(!animations[label])animations[label]={start:Infinity,end:-Infinity};var animation=animations[label];if(i<animation.start)animation.start=i;if(i>animation.end)animation.end=i;if(!firstAnimation)firstAnimation=label}}geometry.firstAnimation=firstAnimation};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(label,start,end){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[label]={start:start,end:end}};THREE.MorphAnimMesh.prototype.playAnimation=function(label,fps){var animation=this.geometry.animations[label];if(animation){this.setFrameRange(animation.start,animation.end);this.duration=1e3*((animation.end-animation.start)/fps);this.time=0}else{THREE.warn("THREE.MorphAnimMesh: animation["+label+"] undefined in .playAnimation()")}};THREE.MorphAnimMesh.prototype.updateAnimation=function(delta){var frameTime=this.duration/this.length;this.time+=this.direction*delta;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction*=-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time+=this.duration}var keyframe=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/frameTime),0,this.length-1);if(keyframe!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[keyframe]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=keyframe}var mix=this.time%frameTime/frameTime;if(this.directionBackwards){mix=1-mix}this.morphTargetInfluences[this.currentKeyframe]=mix;this.morphTargetInfluences[this.lastKeyframe]=1-mix};THREE.MorphAnimMesh.prototype.interpolateTargets=function(a,b,t){var influences=this.morphTargetInfluences;for(var i=0,l=influences.length;i<l;i++){influences[i]=0}if(a>-1)influences[a]=1-t;if(b>-1)influences[b]=t};THREE.MorphAnimMesh.prototype.clone=function(object){if(object===undefined)object=new THREE.MorphAnimMesh(this.geometry,this.material);object.duration=this.duration;object.mirroredLoop=this.mirroredLoop;object.time=this.time;object.lastKeyframe=this.lastKeyframe;object.currentKeyframe=this.currentKeyframe;object.direction=this.direction;object.directionBackwards=this.directionBackwards;THREE.Mesh.prototype.clone.call(this,object);return object};THREE.LOD=function(){THREE.Object3D.call(this);this.objects=[]};THREE.LOD.prototype=Object.create(THREE.Object3D.prototype);THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.addLevel=function(object,distance){if(distance===undefined)distance=0;distance=Math.abs(distance);for(var l=0;l<this.objects.length;l++){if(distance<this.objects[l].distance){break}}this.objects.splice(l,0,{distance:distance,object:object});this.add(object)};THREE.LOD.prototype.getObjectForDistance=function(distance){for(var i=1,l=this.objects.length;i<l;i++){if(distance<this.objects[i].distance){break}}return this.objects[i-1].object};THREE.LOD.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}}();THREE.LOD.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;return function(camera){if(this.objects.length>1){v1.setFromMatrixPosition(camera.matrixWorld);v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);this.objects[0].object.visible=true;for(var i=1,l=this.objects.length;i<l;i++){if(distance>=this.objects[i].distance){this.objects[i-1].object.visible=false;this.objects[i].object.visible=true}else{break}}for(;i<l;i++){this.objects[i].object.visible=false}}}}();THREE.LOD.prototype.clone=function(object){if(object===undefined)object=new THREE.LOD;THREE.Object3D.prototype.clone.call(this,object);for(var i=0,l=this.objects.length;i<l;i++){var x=this.objects[i].object.clone();x.visible=i===0;object.addLevel(x,this.objects[i].distance)}return object};THREE.Sprite=function(){var indices=new Uint16Array([0,1,2,0,2,3]);var vertices=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]);var uvs=new Float32Array([0,0,1,0,1,1,0,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("index",new THREE.BufferAttribute(indices,1));geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("uv",new THREE.BufferAttribute(uvs,2));return function(material){THREE.Object3D.call(this);this.type="Sprite";this.geometry=geometry;this.material=material!==undefined?material:new THREE.SpriteMaterial}}();THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype);THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.raycast=function(){var matrixPosition=new THREE.Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.distanceToPoint(matrixPosition);if(distance>this.scale.x){return}intersects.push({distance:distance,point:this.position,face:null,object:this})}}();THREE.Sprite.prototype.clone=function(object){if(object===undefined)object=new THREE.Sprite(this.material);THREE.Object3D.prototype.clone.call(this,object);return object};THREE.Particle=THREE.Sprite;THREE.LensFlare=function(texture,size,distance,blending,color){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=undefined;if(texture!==undefined){this.add(texture,size,distance,blending,color)}};THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype);THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.add=function(texture,size,distance,blending,color,opacity){if(size===undefined)size=-1;if(distance===undefined)distance=0;if(opacity===undefined)opacity=1;if(color===undefined)color=new THREE.Color(16777215);if(blending===undefined)blending=THREE.NormalBlending;distance=Math.min(distance,Math.max(0,distance));this.lensFlares.push({texture:texture,size:size,distance:distance,x:0,y:0,z:0,scale:1,rotation:1,opacity:opacity,color:color,blending:blending})};THREE.LensFlare.prototype.updateLensFlares=function(){var f,fl=this.lensFlares.length;var flare;var vecX=-this.positionScreen.x*2;var vecY=-this.positionScreen.y*2;for(f=0;f<fl;f++){flare=this.lensFlares[f];flare.x=this.positionScreen.x+vecX*flare.distance;flare.y=this.positionScreen.y+vecY*flare.distance;flare.wantedRotation=flare.x*Math.PI*.25;flare.rotation+=(flare.wantedRotation-flare.rotation)*.25}};THREE.Scene=function(){THREE.Object3D.call(this);this.type="Scene";this.fog=null;this.overrideMaterial=null;this.autoUpdate=true};THREE.Scene.prototype=Object.create(THREE.Object3D.prototype);THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.clone=function(object){if(object===undefined)object=new THREE.Scene;THREE.Object3D.prototype.clone.call(this,object);if(this.fog!==null)object.fog=this.fog.clone();if(this.overrideMaterial!==null)object.overrideMaterial=this.overrideMaterial.clone();object.autoUpdate=this.autoUpdate;object.matrixAutoUpdate=this.matrixAutoUpdate;return object};THREE.Fog=function(color,near,far){this.name="";this.color=new THREE.Color(color);this.near=near!==undefined?near:1;this.far=far!==undefined?far:1e3};THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)};THREE.FogExp2=function(color,density){this.name="";this.color=new THREE.Color(color);this.density=density!==undefined?density:25e-5};THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)};THREE.ShaderChunk={};THREE.ShaderChunk["common"]="#define PI 3.14159\n#define PI2 6.28318\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n\nfloat square( in float a ) { return a*a; }\nvec2  square( in vec2 a )  { return vec2( a.x*a.x, a.y*a.y ); }\nvec3  square( in vec3 a )  { return vec3( a.x*a.x, a.y*a.y, a.z*a.z ); }\nvec4  square( in vec4 a )  { return vec4( a.x*a.x, a.y*a.y, a.z*a.z, a.w*a.w ); }\nfloat saturate( in float a ) { return clamp( a, 0.0, 1.0 ); }\nvec2  saturate( in vec2 a )  { return clamp( a, 0.0, 1.0 ); }\nvec3  saturate( in vec3 a )  { return clamp( a, 0.0, 1.0 ); }\nvec4  saturate( in vec4 a )  { return clamp( a, 0.0, 1.0 ); }\nfloat average( in float a ) { return a; }\nfloat average( in vec2 a )  { return ( a.x + a.y) * 0.5; }\nfloat average( in vec3 a )  { return ( a.x + a.y + a.z) / 3.0; }\nfloat average( in vec4 a )  { return ( a.x + a.y + a.z + a.w) * 0.25; }\nfloat whiteCompliment( in float a ) { return saturate( 1.0 - a ); }\nvec2  whiteCompliment( in vec2 a )  { return saturate( vec2(1.0) - a ); }\nvec3  whiteCompliment( in vec3 a )  { return saturate( vec3(1.0) - a ); }\nvec4  whiteCompliment( in vec4 a )  { return saturate( vec4(1.0) - a ); }\nvec3 transformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( normal, 0.0 ) ).xyz );\n}\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\nvec3 inverseTransformDirection( in vec3 normal, in mat4 matrix ) {\n\treturn normalize( ( vec4( normal, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal) {\n\tfloat distance = dot( planeNormal, point-pointOnPlane );\n\treturn point - distance * planeNormal;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn pointOnLine + lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) );\n}\nfloat calcLightAttenuation( float lightDistance, float cutoffDistance, float decayExponent ) {\n\tif ( decayExponent > 0.0 ) {\n\t  return pow( saturate( 1.0 - lightDistance / cutoffDistance ), decayExponent );\n\t}\n\treturn 1.0;\n}\n\nvec3 inputToLinear( in vec3 a ) {\n#ifdef GAMMA_INPUT\n\treturn pow( a, vec3( float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\nvec3 linearToOutput( in vec3 a ) {\n#ifdef GAMMA_OUTPUT\n\treturn pow( a, vec3( 1.0 / float( GAMMA_FACTOR ) ) );\n#else\n\treturn a;\n#endif\n}\n";THREE.ShaderChunk["alphatest_fragment"]="#ifdef ALPHATEST\n\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n\n#endif\n";THREE.ShaderChunk["lights_lambert_vertex"]="vLightFront = vec3( 0.0 );\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack = vec3( 0.0 );\n\n#endif\n\ntransformedNormal = normalize( transformedNormal );\n\n#if MAX_DIR_LIGHTS > 0\n\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\tfloat dotProduct = dot( transformedNormal, dirVector );\n\tvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t#endif\n\n\t#endif\n\n\t#ifdef WRAP_AROUND\n\n\t\tvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\tdirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tdirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n\n\t\t#endif\n\n\t#endif\n\n\tvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n\n\t#endif\n\n}\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\tpointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tpointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t\tvLightFront += pointLightColor[ i ] * pointLightWeighting * attenuation;\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += pointLightColor[ i ] * pointLightWeightingBack * attenuation;\n\n\t\t#endif\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz - mvPosition.xyz;\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\t\tlVector = normalize( lVector );\n\n\t\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\t\t\tvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n\n\t\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\t\tvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\n\t\t\t\tspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n\n\t\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\t\tspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n\n\t\t\t\t#endif\n\n\t\t\t#endif\n\n\t\t\tvLightFront += spotLightColor[ i ] * spotLightWeighting * attenuation * spotEffect;\n\n\t\t\t#ifdef DOUBLE_SIDED\n\n\t\t\t\tvLightBack += spotLightColor[ i ] * spotLightWeightingBack * attenuation * spotEffect;\n\n\t\t\t#endif\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\tfloat dotProduct = dot( transformedNormal, lVector );\n\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\t\tfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\n\n\t\tvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\t#ifdef DOUBLE_SIDED\n\n\t\t\tvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n\n\t\t#endif\n\n\t}\n\n#endif\n\nvLightFront += ambientLightColor;\n\n#ifdef DOUBLE_SIDED\n\n\tvLightBack += ambientLightColor;\n\n#endif\n";THREE.ShaderChunk["map_particle_pars_fragment"]="#ifdef USE_MAP\n\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n\n#endif\n";THREE.ShaderChunk["default_vertex"]="#ifdef USE_SKINNING\n\n\tvec4 mvPosition = modelViewMatrix * skinned;\n\n#elif defined( USE_MORPHTARGETS )\n\n\tvec4 mvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n\n#else\n\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\n#endif\n\ngl_Position = projectionMatrix * mvPosition;\n";THREE.ShaderChunk["map_pars_fragment"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\n#endif\n\n#ifdef USE_MAP\n\n\tuniform sampler2D map;\n\n#endif";THREE.ShaderChunk["skinnormal_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\n\t#ifdef USE_MORPHNORMALS\n\n\tvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n\n\t#else\n\n\tvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n\tuniform float logDepthBufFC;\n\n#endif";THREE.ShaderChunk["lightmap_pars_vertex"]="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\n#endif";THREE.ShaderChunk["lights_phong_fragment"]="#ifndef FLAT_SHADED\n\n\tvec3 normal = normalize( vNormal );\n\n\t#ifdef DOUBLE_SIDED\n\n\t\tnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\n\t#endif\n\n#else\n\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n\n#endif\n\nvec3 viewPosition = normalize( vViewPosition );\n\n#ifdef USE_NORMALMAP\n\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n\n#elif defined( USE_BUMPMAP )\n\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n\n#endif\n\nvec3 totalDiffuseLight = vec3( 0.0 );\nvec3 totalSpecularLight = vec3( 0.0 );\n\n#if MAX_POINT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), pointLightDistance[ i ], pointLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 pointDiffuseWeight = mix( vec3( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += pointLightColor[ i ] * pointDiffuseWeight * attenuation;\n\n\t\t\t\t// specular\n\n\t\tvec3 pointHalfVector = normalize( lVector + viewPosition );\n\t\tfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\n\t\tfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, pointHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * attenuation * specularNormalization;\n\n\t}\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n\n\t\tvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\n\t\tvec3 lVector = lPosition.xyz + vViewPosition.xyz;\n\n\t\tfloat attenuation = calcLightAttenuation( length( lVector ), spotLightDistance[ i ], spotLightDecay[ i ] );\n\n\t\tlVector = normalize( lVector );\n\n\t\tfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\n\n\t\tif ( spotEffect > spotLightAngleCos[ i ] ) {\n\n\t\t\tspotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent[ i ] ), 0.0 );\n\n\t\t\t// diffuse\n\n\t\t\tfloat dotProduct = dot( normal, lVector );\n\n\t\t\t#ifdef WRAP_AROUND\n\n\t\t\t\tfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\t\tfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\t\tvec3 spotDiffuseWeight = mix( vec3( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n\n\t\t\t#else\n\n\t\t\t\tfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t\t#endif\n\n\t\t\ttotalDiffuseLight += spotLightColor[ i ] * spotDiffuseWeight * attenuation * spotEffect;\n\n\t\t\t// specular\n\n\t\t\tvec3 spotHalfVector = normalize( lVector + viewPosition );\n\t\t\tfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\n\t\t\tfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\n\n\t\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, spotHalfVector ), 0.0 ), 5.0 );\n\t\t\ttotalSpecularLight += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * attenuation * specularNormalization * spotEffect;\n\n\t\t}\n\n\t}\n\n#endif\n\n#if MAX_DIR_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\n\n\t\tvec3 dirVector = transformDirection( directionalLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, dirVector );\n\n\t\t#ifdef WRAP_AROUND\n\n\t\t\tfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\n\t\t\tfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\n\n\t\t\tvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n\n\t\t#else\n\n\t\t\tfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n\n\t\t#endif\n\n\t\ttotalDiffuseLight += directionalLightColor[ i ] * dirDiffuseWeight;\n\n\t\t// specular\n\n\t\tvec3 dirHalfVector = normalize( dirVector + viewPosition );\n\t\tfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\n\t\tfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\n\n\t\t/*\n\t\t// fresnel term from skin shader\n\t\tconst float F0 = 0.128;\n\n\t\tfloat base = 1.0 - dot( viewPosition, dirHalfVector );\n\t\tfloat exponential = pow( base, 5.0 );\n\n\t\tfloat fresnel = exponential + F0 * ( 1.0 - exponential );\n\t\t*/\n\n\t\t/*\n\t\t// fresnel term from fresnel shader\n\t\tconst float mFresnelBias = 0.08;\n\t\tconst float mFresnelScale = 0.3;\n\t\tconst float mFresnelPower = 5.0;\n\n\t\tfloat fresnel = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( -viewPosition ), normal ), mFresnelPower );\n\t\t*/\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\t// \t\tdirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization * fresnel;\n\n\t\tvec3 schlick = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( dirVector, dirHalfVector ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n\n\n\t}\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\n\n\t\tvec3 lVector = transformDirection( hemisphereLightDirection[ i ], viewMatrix );\n\n\t\t// diffuse\n\n\t\tfloat dotProduct = dot( normal, lVector );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\n\n\t\tvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n\n\t\ttotalDiffuseLight += hemiColor;\n\n\t\t// specular (sky light)\n\n\t\tvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\n\t\tfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\n\t\tfloat hemiSpecularWeightSky = specularStrength * max( pow( max( hemiDotNormalHalfSky, 0.0 ), shininess ), 0.0 );\n\n\t\t// specular (ground light)\n\n\t\tvec3 lVectorGround = -lVector;\n\n\t\tvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\n\t\tfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\n\t\tfloat hemiSpecularWeightGround = specularStrength * max( pow( max( hemiDotNormalHalfGround, 0.0 ), shininess ), 0.0 );\n\n\t\tfloat dotProductGround = dot( normal, lVectorGround );\n\n\t\tfloat specularNormalization = ( shininess + 2.0 ) / 8.0;\n\n\t\tvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVector, hemiHalfVectorSky ), 0.0 ), 5.0 );\n\t\tvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( max( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 0.0 ), 5.0 );\n\t\ttotalSpecularLight += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n\n\t}\n\n#endif\n\n#ifdef METAL\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) * specular + totalSpecularLight + emissive;\n\n#else\n\n\toutgoingLight += diffuseColor.rgb * ( totalDiffuseLight + ambientLightColor ) + totalSpecularLight + emissive;\n\n#endif\n";THREE.ShaderChunk["fog_pars_fragment"]="#ifdef USE_FOG\n\n\tuniform vec3 fogColor;\n\n\t#ifdef FOG_EXP2\n\n\t\tuniform float fogDensity;\n\n\t#else\n\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n\n#endif";THREE.ShaderChunk["morphnormal_vertex"]="#ifdef USE_MORPHNORMALS\n\n\tvec3 morphedNormal = vec3( 0.0 );\n\n\tmorphedNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tmorphedNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tmorphedNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tmorphedNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n\n\tmorphedNormal += normal;\n\n#endif";THREE.ShaderChunk["envmap_pars_fragment"]="#ifdef USE_ENVMAP\n\n\tuniform float reflectivity;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tuniform float refractionRatio;\n\n\t#else\n\n\t\tvarying vec3 vReflect;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_fragment"]="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n#endif";THREE.ShaderChunk["normalmap_pars_fragment"]="#ifdef USE_NORMALMAP\n\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\n\t// Per-Pixel Tangent Space Normal Mapping\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\n\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["lights_phong_pars_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n";THREE.ShaderChunk["lightmap_pars_fragment"]="#ifdef USE_LIGHTMAP\n\n\tvarying vec2 vUv2;\n\tuniform sampler2D lightMap;\n\n#endif";THREE.ShaderChunk["shadowmap_vertex"]="#ifdef USE_SHADOWMAP\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n\n\t}\n\n#endif";THREE.ShaderChunk["lights_phong_vertex"]="#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvWorldPosition = worldPosition.xyz;\n\n#endif";THREE.ShaderChunk["map_fragment"]="#ifdef USE_MAP\n\n\tvec4 texelColor = texture2D( map, vUv );\n\n\ttexelColor.xyz = inputToLinear( texelColor.xyz );\n\n\tdiffuseColor *= texelColor;\n\n#endif";THREE.ShaderChunk["lightmap_vertex"]="#ifdef USE_LIGHTMAP\n\n\tvUv2 = uv2;\n\n#endif";THREE.ShaderChunk["map_particle_fragment"]="#ifdef USE_MAP\n\n\tdiffuseColor *= texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\n#endif\n";THREE.ShaderChunk["color_pars_fragment"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif\n";THREE.ShaderChunk["color_vertex"]="#ifdef USE_COLOR\n\n\tvColor.xyz = inputToLinear( color.xyz );\n\n#endif";THREE.ShaderChunk["skinning_vertex"]="#ifdef USE_SKINNING\n\n\t#ifdef USE_MORPHTARGETS\n\n\tvec4 skinVertex = bindMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\tvec4 skinVertex = bindMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\tskinned  = bindMatrixInverse * skinned;\n\n#endif\n";THREE.ShaderChunk["envmap_pars_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvarying vec3 vReflect;\n\n\tuniform float refractionRatio;\n\n#endif\n";THREE.ShaderChunk["linear_to_gamma_fragment"]="\n\toutgoingLight = linearToOutput( outgoingLight );\n";THREE.ShaderChunk["color_pars_vertex"]="#ifdef USE_COLOR\n\n\tvarying vec3 vColor;\n\n#endif";THREE.ShaderChunk["lights_lambert_pars_vertex"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n";THREE.ShaderChunk["map_pars_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n\n#endif\n";THREE.ShaderChunk["envmap_fragment"]="#ifdef USE_ENVMAP\n\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\n\t\t// Transforming Normal Vectors with the Inverse Transformation\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\n\t\t#else\n\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t\t#endif\n\n\t#else\n\n\t\tvec3 reflectVec = vReflect;\n\n\t#endif\n\n\t#ifdef DOUBLE_SIDED\n\t\tfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n\t#else\n\t\tfloat flipNormal = 1.0;\n\t#endif\n\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = saturate( flipNormal * reflectVec.y * 0.5 + 0.5 );\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize((viewMatrix * vec4( reflectVec, 0.0 )).xyz + vec3(0.0,0.0,1.0));\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#endif\n\n\tenvColor.xyz = inputToLinear( envColor.xyz );\n\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["specularmap_pars_fragment"]="#ifdef USE_SPECULARMAP\n\n\tuniform sampler2D specularMap;\n\n#endif";THREE.ShaderChunk["logdepthbuf_vertex"]="#ifdef USE_LOGDEPTHBUF\n\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\n#else\n\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["morphtarget_pars_vertex"]="#ifdef USE_MORPHTARGETS\n\n\t#ifndef USE_MORPHNORMALS\n\n\tuniform float morphTargetInfluences[ 8 ];\n\n\t#else\n\n\tuniform float morphTargetInfluences[ 4 ];\n\n\t#endif\n\n#endif";THREE.ShaderChunk["specularmap_fragment"]="float specularStrength;\n\n#ifdef USE_SPECULARMAP\n\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n\n#else\n\n\tspecularStrength = 1.0;\n\n#endif";THREE.ShaderChunk["fog_fragment"]="#ifdef USE_FOG\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;\n\n\t#else\n\n\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n\n\t#endif\n\n\t#ifdef FOG_EXP2\n\n\t\tfloat fogFactor = exp2( - square( fogDensity ) * square( depth ) * LOG2 );\n\t\tfogFactor = whiteCompliment( fogFactor );\n\n\t#else\n\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n\n\t#endif\n\t\n\toutgoingLight = mix( outgoingLight, fogColor, fogFactor );\n\n#endif";THREE.ShaderChunk["bumpmap_pars_fragment"]="#ifdef USE_BUMPMAP\n\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\n\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\n\tvec2 dHdxy_fwd() {\n\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\n\t\treturn vec2( dBx, dBy );\n\n\t}\n\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\n\t\tvec3 vSigmaX = dFdx( surf_pos );\n\t\tvec3 vSigmaY = dFdy( surf_pos );\n\t\tvec3 vN = surf_norm;\t\t// normalized\n\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\n\t}\n\n#endif\n";THREE.ShaderChunk["defaultnormal_vertex"]="#ifdef USE_SKINNING\n\n\tvec3 objectNormal = skinnedNormal.xyz;\n\n#elif defined( USE_MORPHNORMALS )\n\n\tvec3 objectNormal = morphedNormal;\n\n#else\n\n\tvec3 objectNormal = normal;\n\n#endif\n\n#ifdef FLIP_SIDED\n\n\tobjectNormal = -objectNormal;\n\n#endif\n\nvec3 transformedNormal = normalMatrix * objectNormal;\n";THREE.ShaderChunk["lights_phong_pars_fragment"]="uniform vec3 ambientLightColor;\n\n#if MAX_DIR_LIGHTS > 0\n\n\tuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\n\tuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n\n#endif\n\n#if MAX_HEMI_LIGHTS > 0\n\n\tuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\n\tuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n\n#endif\n\n#if MAX_POINT_LIGHTS > 0\n\n\tuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n\n\tuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n\tuniform float pointLightDecay[ MAX_POINT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0\n\n\tuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\n\tuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n\tuniform float spotLightDecay[ MAX_SPOT_LIGHTS ];\n\n#endif\n\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP ) || defined( USE_ENVMAP )\n\n\tvarying vec3 vWorldPosition;\n\n#endif\n\n#ifdef WRAP_AROUND\n\n\tuniform vec3 wrapRGB;\n\n#endif\n\nvarying vec3 vViewPosition;\n\n#ifndef FLAT_SHADED\n\n\tvarying vec3 vNormal;\n\n#endif\n";THREE.ShaderChunk["skinbase_vertex"]="#ifdef USE_SKINNING\n\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n\n#endif";THREE.ShaderChunk["map_vertex"]="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP )\n\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n\n#endif";THREE.ShaderChunk["lightmap_fragment"]="#ifdef USE_LIGHTMAP\n\n\toutgoingLight *= diffuseColor.xyz * texture2D( lightMap, vUv2 ).xyz;\n\n#endif";THREE.ShaderChunk["shadowmap_pars_vertex"]="#ifdef USE_SHADOWMAP\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\tuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n\n#endif";THREE.ShaderChunk["color_fragment"]="#ifdef USE_COLOR\n\n\tdiffuseColor.rgb *= vColor;\n\n#endif";THREE.ShaderChunk["morphtarget_vertex"]="#ifdef USE_MORPHTARGETS\n\n\tvec3 morphed = vec3( 0.0 );\n\tmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\tmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\tmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\tmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\n\t#ifndef USE_MORPHNORMALS\n\n\tmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\tmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\tmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\tmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\n\t#endif\n\n\tmorphed += position;\n\n#endif";THREE.ShaderChunk["envmap_vertex"]="#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP ) && ! defined( PHONG )\n\n\tvec3 worldNormal = transformDirection( objectNormal, modelMatrix );\n\n\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\n\t#ifdef ENVMAP_MODE_REFLECTION\n\n\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\n\t#else\n\n\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["shadowmap_fragment"]="#ifdef USE_SHADOWMAP\n\n\t#ifdef SHADOWMAP_DEBUG\n\n\t\tvec3 frustumColors[3];\n\t\tfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\n\t\tfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\n\t\tfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n\n\t#endif\n\n\t#ifdef SHADOWMAP_CASCADE\n\n\t\tint inFrustumCount = 0;\n\n\t#endif\n\n\tfloat fDepth;\n\tvec3 shadowColor = vec3( 1.0 );\n\n\tfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n\n\t\tvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\n\n\t\t\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\n\t\t\t\t// if ( all( something, something ) ) using this instead\n\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\n\t\t\t\t// don't shadow pixels outside of light frustum\n\t\t\t\t// use just first frustum (for cascades)\n\t\t\t\t// don't shadow pixels behind far plane of light frustum\n\n\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\tinFrustumCount += int( inFrustum );\n\t\t\tbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n\n\t\t#else\n\n\t\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\n\t\t#endif\n\n\t\tbool frustumTest = all( frustumTestVec );\n\n\t\tif ( frustumTest ) {\n\n\t\t\tshadowCoord.z += shadowBias[ i ];\n\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t/*\n\t\t\t\t\t\t// nested loops breaks shader compiler / validator on some ATI cards when using OpenGL\n\t\t\t\t\t\t// must enroll loop manually\n\n\t\t\t\tfor ( float y = -1.25; y <= 1.25; y += 1.25 )\n\t\t\t\t\tfor ( float x = -1.25; x <= 1.25; x += 1.25 ) {\n\n\t\t\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy );\n\n\t\t\t\t\t\t\t\t// doesn't seem to produce any noticeable visual difference compared to simple texture2D lookup\n\t\t\t\t\t\t\t\t//vec4 rgbaDepth = texture2DProj( shadowMap[ i ], vec4( vShadowCoord[ i ].w * ( vec2( x * xPixelOffset, y * yPixelOffset ) + shadowCoord.xy ), 0.05, vShadowCoord[ i ].w ) );\n\n\t\t\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\t\t\tif ( fDepth < shadowCoord.z )\n\t\t\t\t\t\t\tshadow += 1.0;\n\n\t\t\t\t}\n\n\t\t\t\tshadow /= 9.0;\n\n\t\t*/\n\n\t\t\t\tconst float shadowDelta = 1.0 / 9.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.25 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.25 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.25 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.25 * yPixelOffset;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\t\t\t\tif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\n\t\t\t\t\t\t// Percentage-close filtering\n\t\t\t\t\t\t// (9 pixel kernel)\n\t\t\t\t\t\t// http://fabiensanglard.net/shadowmappingPCF/\n\n\t\t\t\tfloat shadow = 0.0;\n\n\t\t\t\tfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\n\t\t\t\tfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\n\n\t\t\t\tfloat dx0 = -1.0 * xPixelOffset;\n\t\t\t\tfloat dy0 = -1.0 * yPixelOffset;\n\t\t\t\tfloat dx1 = 1.0 * xPixelOffset;\n\t\t\t\tfloat dy1 = 1.0 * yPixelOffset;\n\n\t\t\t\tmat3 shadowKernel;\n\t\t\t\tmat3 depthKernel;\n\n\t\t\t\tdepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\n\t\t\t\tdepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\n\t\t\t\tdepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\n\t\t\t\tdepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\n\t\t\t\tdepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\n\t\t\t\tdepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\n\t\t\t\tdepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\n\t\t\t\tdepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\n\t\t\t\tdepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\n\n\t\t\t\tvec3 shadowZ = vec3( shadowCoord.z );\n\t\t\t\tshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\n\t\t\t\tshadowKernel[0] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\n\t\t\t\tshadowKernel[1] *= vec3(0.25);\n\n\t\t\t\tshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\n\t\t\t\tshadowKernel[2] *= vec3(0.25);\n\n\t\t\t\tvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\n\n\t\t\t\tshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\n\t\t\t\tshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\n\n\t\t\t\tvec4 shadowValues;\n\t\t\t\tshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\n\t\t\t\tshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\n\t\t\t\tshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\n\t\t\t\tshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\n\n\t\t\t\tshadow = dot( shadowValues, vec4( 1.0 ) );\n\n\t\t\t\tshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n\n\t\t\t#else\n\n\t\t\t\tvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\n\t\t\t\tfloat fDepth = unpackDepth( rgbaDepth );\n\n\t\t\t\tif ( fDepth < shadowCoord.z )\n\n\t\t// spot with multiple shadows is darker\n\n\t\t\t\t\tshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n\n\t\t// spot with multiple shadows has the same color as single shadow spot\n\n\t\t// \t\t\t\t\tshadowColor = min( shadowColor, vec3( shadowDarkness[ i ] ) );\n\n\t\t\t#endif\n\n\t\t}\n\n\n\t\t#ifdef SHADOWMAP_DEBUG\n\n\t\t\t#ifdef SHADOWMAP_CASCADE\n\n\t\t\t\tif ( inFrustum && inFrustumCount == 1 ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#else\n\n\t\t\t\tif ( inFrustum ) outgoingLight *= frustumColors[ i ];\n\n\t\t\t#endif\n\n\t\t#endif\n\n\t}\n\n\t// NOTE: I am unsure if this is correct in linear space.  -bhouston, Dec 29, 2014\n\tshadowColor = inputToLinear( shadowColor );\n\n\toutgoingLight = outgoingLight * shadowColor;\n\n#endif\n";THREE.ShaderChunk["worldpos_vertex"]="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\n\t#ifdef USE_SKINNING\n\n\t\tvec4 worldPosition = modelMatrix * skinned;\n\n\t#elif defined( USE_MORPHTARGETS )\n\n\t\tvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n\n\t#else\n\n\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["shadowmap_pars_fragment"]="#ifdef USE_SHADOWMAP\n\n\tuniform sampler2D shadowMap[ MAX_SHADOWS ];\n\tuniform vec2 shadowMapSize[ MAX_SHADOWS ];\n\n\tuniform float shadowDarkness[ MAX_SHADOWS ];\n\tuniform float shadowBias[ MAX_SHADOWS ];\n\n\tvarying vec4 vShadowCoord[ MAX_SHADOWS ];\n\n\tfloat unpackDepth( const in vec4 rgba_depth ) {\n\n\t\tconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\n\t\tfloat depth = dot( rgba_depth, bit_shift );\n\t\treturn depth;\n\n\t}\n\n#endif";THREE.ShaderChunk["skinning_pars_vertex"]="#ifdef USE_SKINNING\n\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\n\t#ifdef BONE_TEXTURE\n\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureWidth;\n\t\tuniform int boneTextureHeight;\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureWidth ) );\n\t\t\tfloat y = floor( j / float( boneTextureWidth ) );\n\n\t\t\tfloat dx = 1.0 / float( boneTextureWidth );\n\t\t\tfloat dy = 1.0 / float( boneTextureHeight );\n\n\t\t\ty = dy * ( y + 0.5 );\n\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\n\t\t\treturn bone;\n\n\t\t}\n\n\t#else\n\n\t\tuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n\n\t\tmat4 getBoneMatrix( const in float i ) {\n\n\t\t\tmat4 bone = boneGlobalMatrices[ int(i) ];\n\t\t\treturn bone;\n\n\t\t}\n\n\t#endif\n\n#endif\n";THREE.ShaderChunk["logdepthbuf_pars_fragment"]="#ifdef USE_LOGDEPTHBUF\n\n\tuniform float logDepthBufFC;\n\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\n\t\t#extension GL_EXT_frag_depth : enable\n\t\tvarying float vFragDepth;\n\n\t#endif\n\n#endif";THREE.ShaderChunk["alphamap_fragment"]="#ifdef USE_ALPHAMAP\n\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n\n#endif\n";THREE.ShaderChunk["alphamap_pars_fragment"]="#ifdef USE_ALPHAMAP\n\n\tuniform sampler2D alphaMap;\n\n#endif\n";THREE.UniformsUtils={merge:function(uniforms){var merged={};for(var u=0;u<uniforms.length;u++){var tmp=this.clone(uniforms[u]);for(var p in tmp){merged[p]=tmp[p]}}return merged},clone:function(uniforms_src){var uniforms_dst={};for(var u in uniforms_src){uniforms_dst[u]={};for(var p in uniforms_src[u]){var parameter_src=uniforms_src[u][p];if(parameter_src instanceof THREE.Color||parameter_src instanceof THREE.Vector2||parameter_src instanceof THREE.Vector3||parameter_src instanceof THREE.Vector4||parameter_src instanceof THREE.Matrix4||parameter_src instanceof THREE.Texture){uniforms_dst[u][p]=parameter_src.clone()}else if(parameter_src instanceof Array){uniforms_dst[u][p]=parameter_src.slice()}else{uniforms_dst[u][p]=parameter_src}}}return uniforms_dst}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},alphaMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},pointLightDecay:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]},spotLightDecay:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["shadowmap"]]),vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["skinbase_vertex"],"\t#ifdef USE_ENVMAP",THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"\t#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_lambert_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_lambert_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * vLightBack + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * vLightFront + emissive;","\t#endif",THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["bump"],THREE.UniformsLib["normalmap"],THREE.UniformsLib["fog"],THREE.UniformsLib["lights"],THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",THREE.ShaderChunk["common"],THREE.ShaderChunk["map_pars_vertex"],THREE.ShaderChunk["lightmap_pars_vertex"],THREE.ShaderChunk["envmap_pars_vertex"],THREE.ShaderChunk["lights_phong_pars_vertex"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["map_vertex"],THREE.ShaderChunk["lightmap_vertex"],THREE.ShaderChunk["color_vertex"],THREE.ShaderChunk["morphnormal_vertex"],THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["skinnormal_vertex"],THREE.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"\tvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["envmap_vertex"],THREE.ShaderChunk["lights_phong_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_pars_fragment"],THREE.ShaderChunk["alphamap_pars_fragment"],THREE.ShaderChunk["lightmap_pars_fragment"],THREE.ShaderChunk["envmap_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["lights_phong_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["bumpmap_pars_fragment"],THREE.ShaderChunk["normalmap_pars_fragment"],THREE.ShaderChunk["specularmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphamap_fragment"],THREE.ShaderChunk["alphatest_fragment"],THREE.ShaderChunk["specularmap_fragment"],THREE.ShaderChunk["lights_phong_fragment"],THREE.ShaderChunk["lightmap_fragment"],THREE.ShaderChunk["envmap_fragment"],THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["linear_to_gamma_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["particle"],THREE.UniformsLib["shadowmap"]]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["shadowmap_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\t#ifdef USE_SIZEATTENUATION","\t\tgl_PointSize = size * ( scale / length( mvPosition.xyz ) );","\t#else","\t\tgl_PointSize = size;","\t#endif","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],THREE.ShaderChunk["worldpos_vertex"],THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["map_particle_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["shadowmap_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( psColor, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["map_particle_fragment"],THREE.ShaderChunk["color_fragment"],THREE.ShaderChunk["alphatest_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["shadowmap_fragment"],THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib["common"],THREE.UniformsLib["fog"],{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["color_vertex"],"\tvLineDistance = scale * lineDistance;","\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","\tgl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk["common"],THREE.ShaderChunk["color_pars_fragment"],THREE.ShaderChunk["fog_pars_fragment"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tif ( mod( vLineDistance, totalSize ) > dashSize ) {","\t\tdiscard;","\t}","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],THREE.ShaderChunk["color_fragment"],"\toutgoingLight = diffuseColor.rgb;",THREE.ShaderChunk["fog_fragment"],"\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tfloat depth = gl_FragDepthEXT / gl_FragCoord.w;","\t#else","\t\tfloat depth = gl_FragCoord.z / gl_FragCoord.w;","\t#endif","\tfloat color = 1.0 - smoothstep( mNear, mFar, depth );","\tgl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},equirect:{uniforms:{tEquirect:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {","\tvWorldPosition = transformDirection( position, modelMatrix );","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","uniform float tFlip;","varying vec3 vWorldPosition;",THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"void main() {","vec3 direction = normalize( vWorldPosition );","vec2 sampleUV;","sampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );","sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","gl_FragColor = texture2D( tEquirect, sampleUV );",THREE.ShaderChunk["logdepthbuf_fragment"],"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["morphtarget_pars_vertex"],THREE.ShaderChunk["skinning_pars_vertex"],THREE.ShaderChunk["logdepthbuf_pars_vertex"],"void main() {",THREE.ShaderChunk["skinbase_vertex"],THREE.ShaderChunk["morphtarget_vertex"],THREE.ShaderChunk["skinning_vertex"],THREE.ShaderChunk["default_vertex"],THREE.ShaderChunk["logdepthbuf_vertex"],"}"].join("\n"),fragmentShader:[THREE.ShaderChunk["common"],THREE.ShaderChunk["logdepthbuf_pars_fragment"],"vec4 pack_depth( const in float depth ) {","\tconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","\tconst vec4 bit_mask = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","\tvec4 res = mod( depth * bit_shift * vec4( 255 ), vec4( 256 ) ) / vec4( 255 );","\tres -= res.xxyz * bit_mask;","\treturn res;","}","void main() {",THREE.ShaderChunk["logdepthbuf_fragment"],"\t#ifdef USE_LOGDEPTHBUF_EXT","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragDepthEXT );","\t#else","\t\tgl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","\t#endif","}"].join("\n")}};THREE.WebGLRenderer=function(parameters){parameters=parameters||{};var _canvas=parameters.canvas!==undefined?parameters.canvas:document.createElement("canvas"),_context=parameters.context!==undefined?parameters.context:null,pixelRatio=1,_precision=parameters.precision!==undefined?parameters.precision:"highp",_alpha=parameters.alpha!==undefined?parameters.alpha:false,_depth=parameters.depth!==undefined?parameters.depth:true,_stencil=parameters.stencil!==undefined?parameters.stencil:true,_antialias=parameters.antialias!==undefined?parameters.antialias:false,_premultipliedAlpha=parameters.premultipliedAlpha!==undefined?parameters.premultipliedAlpha:true,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==undefined?parameters.preserveDrawingBuffer:false,_logarithmicDepthBuffer=parameters.logarithmicDepthBuffer!==undefined?parameters.logarithmicDepthBuffer:false,_clearColor=new THREE.Color(0),_clearAlpha=0;var lights=[];var _webglObjects={};var _webglObjectsImmediate=[];var opaqueObjects=[];var transparentObjects=[];var sprites=[];var lensFlares=[];this.domElement=_canvas;this.context=null;this.autoClear=true;this.autoClearColor=true;this.autoClearDepth=true;this.autoClearStencil=true;this.sortObjects=true;this.gammaFactor=2;this.gammaInput=false;this.gammaOutput=false;this.shadowMapEnabled=false;this.shadowMapType=THREE.PCFShadowMap;this.shadowMapCullFace=THREE.CullFaceFront;this.shadowMapDebug=false;this.shadowMapCascade=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var _this=this,_programs=[],_currentProgram=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram="",_currentCamera=null,_usedTextureUnits=0,_viewportX=0,_viewportY=0,_viewportWidth=_canvas.width,_viewportHeight=_canvas.height,_currentWidth=0,_currentHeight=0,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_vector3=new THREE.Vector3,_direction=new THREE.Vector3,_lightsNeedUpdate=true,_lights={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[],decays:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[],decays:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};var _gl;var ctxLost=function(event){event.preventDefault();resetGLState();setDefaultGLState();_webglObjects={}};try{var attributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer};_gl=_context||_canvas.getContext("webgl",attributes)||_canvas.getContext("experimental-webgl",attributes);if(_gl===null){if(_canvas.getContext("webgl")!==null){throw"Error creating WebGL context with your selected attributes."}else{throw"Error creating WebGL context."}}_canvas.addEventListener("webglcontextlost",ctxLost,false)}catch(error){THREE.error("THREE.WebGLRenderer: "+error)}this.dispose=function(){_canvas.removeEventListener("webglcontextlost",ctxLost,false)};var state=new THREE.WebGLState(_gl,paramThreeToGL);if(_gl.getShaderPrecisionFormat===undefined){_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}var extensions=new THREE.WebGLExtensions(_gl);extensions.get("OES_texture_float");extensions.get("OES_texture_float_linear");extensions.get("OES_texture_half_float");extensions.get("OES_texture_half_float_linear");extensions.get("OES_standard_derivatives");if(_logarithmicDepthBuffer){extensions.get("EXT_frag_depth")}var glClearColor=function(r,g,b,a){if(_premultipliedAlpha===true){r*=a;g*=a;b*=a}_gl.clearColor(r,g,b,a)};var setDefaultGLState=function(){_gl.clearColor(0,0,0,1);_gl.clearDepth(1);_gl.clearStencil(0);_gl.enable(_gl.DEPTH_TEST);_gl.depthFunc(_gl.LEQUAL);_gl.frontFace(_gl.CCW);_gl.cullFace(_gl.BACK);_gl.enable(_gl.CULL_FACE);_gl.enable(_gl.BLEND);_gl.blendEquation(_gl.FUNC_ADD);_gl.blendFunc(_gl.SRC_ALPHA,_gl.ONE_MINUS_SRC_ALPHA);_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight);glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};var resetGLState=function(){_currentProgram=null;_currentCamera=null;_currentGeometryProgram="";_currentMaterialId=-1;_lightsNeedUpdate=true;state.reset()};setDefaultGLState();this.context=_gl;this.state=state;var _maxTextures=_gl.getParameter(_gl.MAX_TEXTURE_IMAGE_UNITS);var _maxVertexTextures=_gl.getParameter(_gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);var _maxTextureSize=_gl.getParameter(_gl.MAX_TEXTURE_SIZE);var _maxCubemapSize=_gl.getParameter(_gl.MAX_CUBE_MAP_TEXTURE_SIZE);var _supportsVertexTextures=_maxVertexTextures>0;var _supportsBoneTextures=_supportsVertexTextures&&extensions.get("OES_texture_float");var _vertexShaderPrecisionHighpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.HIGH_FLOAT);var _vertexShaderPrecisionMediumpFloat=_gl.getShaderPrecisionFormat(_gl.VERTEX_SHADER,_gl.MEDIUM_FLOAT);var _fragmentShaderPrecisionHighpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.HIGH_FLOAT);var _fragmentShaderPrecisionMediumpFloat=_gl.getShaderPrecisionFormat(_gl.FRAGMENT_SHADER,_gl.MEDIUM_FLOAT);var getCompressedTextureFormats=function(){var array;return function(){if(array!==undefined){return array}array=[];if(extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")){var formats=_gl.getParameter(_gl.COMPRESSED_TEXTURE_FORMATS);for(var i=0;i<formats.length;i++){array.push(formats[i])}}return array}}();var highpAvailable=_vertexShaderPrecisionHighpFloat.precision>0&&_fragmentShaderPrecisionHighpFloat.precision>0;var mediumpAvailable=_vertexShaderPrecisionMediumpFloat.precision>0&&_fragmentShaderPrecisionMediumpFloat.precision>0;if(_precision==="highp"&&!highpAvailable){if(mediumpAvailable){_precision="mediump";THREE.warn("THREE.WebGLRenderer: highp not supported, using mediump.")}else{_precision="lowp";THREE.warn("THREE.WebGLRenderer: highp and mediump not supported, using lowp.")}}if(_precision==="mediump"&&!mediumpAvailable){_precision="lowp";THREE.warn("THREE.WebGLRenderer: mediump not supported, using lowp.")}var shadowMapPlugin=new THREE.ShadowMapPlugin(this,lights,_webglObjects,_webglObjectsImmediate);var spritePlugin=new THREE.SpritePlugin(this,sprites);var lensFlarePlugin=new THREE.LensFlarePlugin(this,lensFlares);this.getContext=function(){return _gl};this.forceContextLoss=function(){extensions.get("WEBGL_lose_context").loseContext()};this.supportsVertexTextures=function(){return _supportsVertexTextures};this.supportsFloatTextures=function(){return extensions.get("OES_texture_float")};this.supportsHalfFloatTextures=function(){return extensions.get("OES_texture_half_float")};this.supportsStandardDerivatives=function(){return extensions.get("OES_standard_derivatives")};this.supportsCompressedTextureS3TC=function(){return extensions.get("WEBGL_compressed_texture_s3tc")};this.supportsCompressedTexturePVRTC=function(){return extensions.get("WEBGL_compressed_texture_pvrtc")};this.supportsBlendMinMax=function(){return extensions.get("EXT_blend_minmax")};this.getMaxAnisotropy=function(){var value;return function(){if(value!==undefined){return value}var extension=extensions.get("EXT_texture_filter_anisotropic");value=extension!==null?_gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0;return value}}();this.getPrecision=function(){return _precision};this.getPixelRatio=function(){return pixelRatio};this.setPixelRatio=function(value){pixelRatio=value};this.setSize=function(width,height,updateStyle){_canvas.width=width*pixelRatio;_canvas.height=height*pixelRatio;if(updateStyle!==false){_canvas.style.width=width+"px";_canvas.style.height=height+"px"}this.setViewport(0,0,width,height)};this.setViewport=function(x,y,width,height){_viewportX=x*pixelRatio;_viewportY=y*pixelRatio;_viewportWidth=width*pixelRatio;_viewportHeight=height*pixelRatio;_gl.viewport(_viewportX,_viewportY,_viewportWidth,_viewportHeight)};this.setScissor=function(x,y,width,height){_gl.scissor(x*pixelRatio,y*pixelRatio,width*pixelRatio,height*pixelRatio)};this.enableScissorTest=function(enable){enable?_gl.enable(_gl.SCISSOR_TEST):_gl.disable(_gl.SCISSOR_TEST)};this.getClearColor=function(){return _clearColor};this.setClearColor=function(color,alpha){_clearColor.set(color);_clearAlpha=alpha!==undefined?alpha:1;glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.getClearAlpha=function(){return _clearAlpha};this.setClearAlpha=function(alpha){_clearAlpha=alpha;glClearColor(_clearColor.r,_clearColor.g,_clearColor.b,_clearAlpha)};this.clear=function(color,depth,stencil){var bits=0;if(color===undefined||color)bits|=_gl.COLOR_BUFFER_BIT;if(depth===undefined||depth)bits|=_gl.DEPTH_BUFFER_BIT;if(stencil===undefined||stencil)bits|=_gl.STENCIL_BUFFER_BIT;_gl.clear(bits)};this.clearColor=function(){_gl.clear(_gl.COLOR_BUFFER_BIT)};this.clearDepth=function(){_gl.clear(_gl.DEPTH_BUFFER_BIT)};this.clearStencil=function(){_gl.clear(_gl.STENCIL_BUFFER_BIT)};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil)};this.resetGLState=resetGLState;function createParticleBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();_this.info.memory.geometries++}function createLineBuffers(geometry){geometry.__webglVertexBuffer=_gl.createBuffer();geometry.__webglColorBuffer=_gl.createBuffer();geometry.__webglLineDistanceBuffer=_gl.createBuffer();_this.info.memory.geometries++}function createMeshBuffers(geometryGroup){geometryGroup.__webglVertexBuffer=_gl.createBuffer();geometryGroup.__webglNormalBuffer=_gl.createBuffer();geometryGroup.__webglTangentBuffer=_gl.createBuffer();geometryGroup.__webglColorBuffer=_gl.createBuffer();geometryGroup.__webglUVBuffer=_gl.createBuffer();geometryGroup.__webglUV2Buffer=_gl.createBuffer();geometryGroup.__webglSkinIndicesBuffer=_gl.createBuffer();geometryGroup.__webglSkinWeightsBuffer=_gl.createBuffer();geometryGroup.__webglFaceBuffer=_gl.createBuffer();geometryGroup.__webglLineBuffer=_gl.createBuffer();var numMorphTargets=geometryGroup.numMorphTargets;if(numMorphTargets){geometryGroup.__webglMorphTargetsBuffers=[];for(var m=0,ml=numMorphTargets;m<ml;m++){geometryGroup.__webglMorphTargetsBuffers.push(_gl.createBuffer())}}var numMorphNormals=geometryGroup.numMorphNormals;if(numMorphNormals){geometryGroup.__webglMorphNormalsBuffers=[];for(var m=0,ml=numMorphNormals;m<ml;m++){geometryGroup.__webglMorphNormalsBuffers.push(_gl.createBuffer())}}_this.info.memory.geometries++}var onObjectRemoved=function(event){var object=event.target;object.traverse(function(child){child.removeEventListener("remove",onObjectRemoved);removeObject(child)})};var onGeometryDispose=function(event){var geometry=event.target;geometry.removeEventListener("dispose",onGeometryDispose);deallocateGeometry(geometry)};var onTextureDispose=function(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose);deallocateTexture(texture);_this.info.memory.textures--};var onRenderTargetDispose=function(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose);deallocateRenderTarget(renderTarget);_this.info.memory.textures--};var onMaterialDispose=function(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose);deallocateMaterial(material)};var deleteBuffers=function(geometry){var buffers=["__webglVertexBuffer","__webglNormalBuffer","__webglTangentBuffer","__webglColorBuffer","__webglUVBuffer","__webglUV2Buffer","__webglSkinIndicesBuffer","__webglSkinWeightsBuffer","__webglFaceBuffer","__webglLineBuffer","__webglLineDistanceBuffer"];for(var i=0,l=buffers.length;i<l;i++){var name=buffers[i];if(geometry[name]!==undefined){_gl.deleteBuffer(geometry[name]);delete geometry[name]}}if(geometry.__webglCustomAttributesList!==undefined){for(var name in geometry.__webglCustomAttributesList){_gl.deleteBuffer(geometry.__webglCustomAttributesList[name].buffer)}delete geometry.__webglCustomAttributesList}_this.info.memory.geometries--};var deallocateGeometry=function(geometry){delete geometry.__webglInit;if(geometry instanceof THREE.BufferGeometry){for(var name in geometry.attributes){var attribute=geometry.attributes[name];if(attribute.buffer!==undefined){_gl.deleteBuffer(attribute.buffer);delete attribute.buffer}}_this.info.memory.geometries--}else{var geometryGroupsList=geometryGroups[geometry.id];if(geometryGroupsList!==undefined){for(var i=0,l=geometryGroupsList.length;i<l;i++){var geometryGroup=geometryGroupsList[i];if(geometryGroup.numMorphTargets!==undefined){for(var m=0,ml=geometryGroup.numMorphTargets;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphTargetsBuffers[m])}delete geometryGroup.__webglMorphTargetsBuffers}if(geometryGroup.numMorphNormals!==undefined){for(var m=0,ml=geometryGroup.numMorphNormals;m<ml;m++){_gl.deleteBuffer(geometryGroup.__webglMorphNormalsBuffers[m])}delete geometryGroup.__webglMorphNormalsBuffers}deleteBuffers(geometryGroup)}delete geometryGroups[geometry.id]}else{deleteBuffers(geometry)}}_currentGeometryProgram=""};var deallocateTexture=function(texture){if(texture.image&&texture.image.__webglTextureCube){_gl.deleteTexture(texture.image.__webglTextureCube);delete texture.image.__webglTextureCube}else{if(texture.__webglInit===undefined)return;_gl.deleteTexture(texture.__webglTexture);delete texture.__webglTexture;delete texture.__webglInit}};var deallocateRenderTarget=function(renderTarget){if(!renderTarget||renderTarget.__webglTexture===undefined)return;_gl.deleteTexture(renderTarget.__webglTexture);delete renderTarget.__webglTexture;if(renderTarget instanceof THREE.WebGLRenderTargetCube){for(var i=0;i<6;i++){_gl.deleteFramebuffer(renderTarget.__webglFramebuffer[i]);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer[i])}}else{_gl.deleteFramebuffer(renderTarget.__webglFramebuffer);_gl.deleteRenderbuffer(renderTarget.__webglRenderbuffer)}delete renderTarget.__webglFramebuffer;delete renderTarget.__webglRenderbuffer};var deallocateMaterial=function(material){var program=material.program.program;if(program===undefined)return;material.program=undefined;var i,il,programInfo;var deleteProgram=false;for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program===program){programInfo.usedTimes--;if(programInfo.usedTimes===0){deleteProgram=true}break}}if(deleteProgram===true){var newPrograms=[];for(i=0,il=_programs.length;i<il;i++){programInfo=_programs[i];if(programInfo.program!==program){newPrograms.push(programInfo)}}_programs=newPrograms;_gl.deleteProgram(program);_this.info.memory.programs--}};function initCustomAttributes(object){var geometry=object.geometry;var material=object.material;var nvertices=geometry.vertices.length;if(material.attributes){if(geometry.__webglCustomAttributesList===undefined){geometry.__webglCustomAttributesList=[]}for(var name in material.attributes){var attribute=material.attributes[name];if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=name;attribute.needsUpdate=true}geometry.__webglCustomAttributesList.push(attribute)}}}function initParticleBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__webglParticleCount=nvertices;initCustomAttributes(object)}function initLineBuffers(geometry,object){var nvertices=geometry.vertices.length;geometry.__vertexArray=new Float32Array(nvertices*3);geometry.__colorArray=new Float32Array(nvertices*3);geometry.__lineDistanceArray=new Float32Array(nvertices*1);geometry.__webglLineCount=nvertices;initCustomAttributes(object)}function initMeshBuffers(geometryGroup,object){var geometry=object.geometry,faces3=geometryGroup.faces3,nvertices=faces3.length*3,ntris=faces3.length*1,nlines=faces3.length*3,material=getBufferMaterial(object,geometryGroup);geometryGroup.__vertexArray=new Float32Array(nvertices*3);geometryGroup.__normalArray=new Float32Array(nvertices*3);geometryGroup.__colorArray=new Float32Array(nvertices*3);geometryGroup.__uvArray=new Float32Array(nvertices*2);if(geometry.faceVertexUvs.length>1){geometryGroup.__uv2Array=new Float32Array(nvertices*2)}if(geometry.hasTangents){geometryGroup.__tangentArray=new Float32Array(nvertices*4)}if(object.geometry.skinWeights.length&&object.geometry.skinIndices.length){geometryGroup.__skinIndexArray=new Float32Array(nvertices*4);geometryGroup.__skinWeightArray=new Float32Array(nvertices*4)}var UintArray=extensions.get("OES_element_index_uint")!==null&&ntris>21845?Uint32Array:Uint16Array;geometryGroup.__typeArray=UintArray;geometryGroup.__faceArray=new UintArray(ntris*3);geometryGroup.__lineArray=new UintArray(nlines*2);var numMorphTargets=geometryGroup.numMorphTargets;if(numMorphTargets){geometryGroup.__morphTargetsArrays=[];for(var m=0,ml=numMorphTargets;m<ml;m++){geometryGroup.__morphTargetsArrays.push(new Float32Array(nvertices*3))}}var numMorphNormals=geometryGroup.numMorphNormals;if(numMorphNormals){geometryGroup.__morphNormalsArrays=[];for(var m=0,ml=numMorphNormals;m<ml;m++){geometryGroup.__morphNormalsArrays.push(new Float32Array(nvertices*3))}}geometryGroup.__webglFaceCount=ntris*3;geometryGroup.__webglLineCount=nlines*2;if(material.attributes){if(geometryGroup.__webglCustomAttributesList===undefined){geometryGroup.__webglCustomAttributesList=[]}for(var name in material.attributes){var originalAttribute=material.attributes[name];var attribute={};for(var property in originalAttribute){attribute[property]=originalAttribute[property]}if(!attribute.__webglInitialized||attribute.createUniqueBuffers){attribute.__webglInitialized=true;var size=1;if(attribute.type==="v2")size=2;else if(attribute.type==="v3")size=3;else if(attribute.type==="v4")size=4;else if(attribute.type==="c")size=3;attribute.size=size;attribute.array=new Float32Array(nvertices*size);attribute.buffer=_gl.createBuffer();attribute.buffer.belongsToAttribute=name;originalAttribute.needsUpdate=true;attribute.__original=originalAttribute}geometryGroup.__webglCustomAttributesList.push(attribute)}}geometryGroup.__inittedArrays=true}function getBufferMaterial(object,geometryGroup){return object.material instanceof THREE.MeshFaceMaterial?object.material.materials[geometryGroup.materialIndex]:object.material}function materialNeedsFaceNormals(material){return material instanceof THREE.MeshPhongMaterial===false&&material.shading===THREE.FlatShading}function setParticleBuffers(geometry,hint,object){var v,c,vertex,offset,color,vertices=geometry.vertices,vl=vertices.length,colors=geometry.colors,cl=colors.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,ca,cal,value,customAttribute;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){cal=customAttribute.value.length;offset=0;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);customAttribute.needsUpdate=false}}}function setLineBuffers(geometry,hint){var v,c,d,vertex,offset,color,vertices=geometry.vertices,colors=geometry.colors,lineDistances=geometry.lineDistances,vl=vertices.length,cl=colors.length,dl=lineDistances.length,vertexArray=geometry.__vertexArray,colorArray=geometry.__colorArray,lineDistanceArray=geometry.__lineDistanceArray,dirtyVertices=geometry.verticesNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyLineDistances=geometry.lineDistancesNeedUpdate,customAttributes=geometry.__webglCustomAttributesList,i,il,ca,cal,value,customAttribute;if(dirtyVertices){for(v=0;v<vl;v++){vertex=vertices[v];offset=v*3;vertexArray[offset]=vertex.x;vertexArray[offset+1]=vertex.y;vertexArray[offset+2]=vertex.z}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyColors){for(c=0;c<cl;c++){color=colors[c];offset=c*3;colorArray[offset]=color.r;colorArray[offset+1]=color.g;colorArray[offset+2]=color.b}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}if(dirtyLineDistances){for(d=0;d<dl;d++){lineDistanceArray[d]=lineDistances[d]}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometry.__webglLineDistanceBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,lineDistanceArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(customAttribute.needsUpdate&&(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices")){offset=0;cal=customAttribute.value.length;if(customAttribute.size===1){for(ca=0;ca<cal;ca++){customAttribute.array[ca]=customAttribute.value[ca]}}else if(customAttribute.size===2){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;offset+=2}}else if(customAttribute.size===3){if(customAttribute.type==="c"){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.r;customAttribute.array[offset+1]=value.g;customAttribute.array[offset+2]=value.b;offset+=3}}else{for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;offset+=3}}}else if(customAttribute.size===4){for(ca=0;ca<cal;ca++){value=customAttribute.value[ca];customAttribute.array[offset]=value.x;customAttribute.array[offset+1]=value.y;customAttribute.array[offset+2]=value.z;customAttribute.array[offset+3]=value.w;offset+=4}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint);customAttribute.needsUpdate=false}}}}function setMeshBuffers(geometryGroup,object,hint,dispose,material){if(!geometryGroup.__inittedArrays){return}var needsFaceNormals=materialNeedsFaceNormals(material);var f,fl,fi,face,vertexNormals,faceNormal,vertexColors,faceColor,vertexTangents,uv,uv2,v1,v2,v3,t1,t2,t3,n1,n2,n3,c1,c2,c3,sw1,sw2,sw3,si1,si2,si3,i,il,vn,uvi,uv2i,vk,vkl,vka,nka,chf,faceVertexNormals,vertexIndex=0,offset=0,offset_uv=0,offset_uv2=0,offset_face=0,offset_normal=0,offset_tangent=0,offset_line=0,offset_color=0,offset_skin=0,offset_morphTarget=0,offset_custom=0,value,vertexArray=geometryGroup.__vertexArray,uvArray=geometryGroup.__uvArray,uv2Array=geometryGroup.__uv2Array,normalArray=geometryGroup.__normalArray,tangentArray=geometryGroup.__tangentArray,colorArray=geometryGroup.__colorArray,skinIndexArray=geometryGroup.__skinIndexArray,skinWeightArray=geometryGroup.__skinWeightArray,morphTargetsArrays=geometryGroup.__morphTargetsArrays,morphNormalsArrays=geometryGroup.__morphNormalsArrays,customAttributes=geometryGroup.__webglCustomAttributesList,customAttribute,faceArray=geometryGroup.__faceArray,lineArray=geometryGroup.__lineArray,geometry=object.geometry,dirtyVertices=geometry.verticesNeedUpdate,dirtyElements=geometry.elementsNeedUpdate,dirtyUvs=geometry.uvsNeedUpdate,dirtyNormals=geometry.normalsNeedUpdate,dirtyTangents=geometry.tangentsNeedUpdate,dirtyColors=geometry.colorsNeedUpdate,dirtyMorphTargets=geometry.morphTargetsNeedUpdate,vertices=geometry.vertices,chunk_faces3=geometryGroup.faces3,obj_faces=geometry.faces,obj_uvs=geometry.faceVertexUvs[0],obj_uvs2=geometry.faceVertexUvs[1],obj_skinIndices=geometry.skinIndices,obj_skinWeights=geometry.skinWeights,morphTargets=geometry.morphTargets,morphNormals=geometry.morphNormals;if(dirtyVertices){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=vertices[face.a];v2=vertices[face.b];v3=vertices[face.c];vertexArray[offset]=v1.x;vertexArray[offset+1]=v1.y;vertexArray[offset+2]=v1.z;vertexArray[offset+3]=v2.x;vertexArray[offset+4]=v2.y;vertexArray[offset+5]=v2.z;vertexArray[offset+6]=v3.x;vertexArray[offset+7]=v3.y;vertexArray[offset+8]=v3.z;offset+=9}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,vertexArray,hint)}if(dirtyMorphTargets){for(vk=0,vkl=morphTargets.length;vk<vkl;vk++){offset_morphTarget=0;for(f=0,fl=chunk_faces3.length;f<fl;f++){chf=chunk_faces3[f];face=obj_faces[chf];v1=morphTargets[vk].vertices[face.a];v2=morphTargets[vk].vertices[face.b];v3=morphTargets[vk].vertices[face.c];vka=morphTargetsArrays[vk];vka[offset_morphTarget]=v1.x;vka[offset_morphTarget+1]=v1.y;vka[offset_morphTarget+2]=v1.z;vka[offset_morphTarget+3]=v2.x;vka[offset_morphTarget+4]=v2.y;vka[offset_morphTarget+5]=v2.z;vka[offset_morphTarget+6]=v3.x;vka[offset_morphTarget+7]=v3.y;vka[offset_morphTarget+8]=v3.z;if(material.morphNormals){if(needsFaceNormals){n1=morphNormals[vk].faceNormals[chf];n2=n1;n3=n1}else{faceVertexNormals=morphNormals[vk].vertexNormals[chf];n1=faceVertexNormals.a;n2=faceVertexNormals.b;n3=faceVertexNormals.c}nka=morphNormalsArrays[vk];nka[offset_morphTarget]=n1.x;nka[offset_morphTarget+1]=n1.y;nka[offset_morphTarget+2]=n1.z;nka[offset_morphTarget+3]=n2.x;nka[offset_morphTarget+4]=n2.y;nka[offset_morphTarget+5]=n2.z;nka[offset_morphTarget+6]=n3.x;nka[offset_morphTarget+7]=n3.y;nka[offset_morphTarget+8]=n3.z}offset_morphTarget+=9}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphTargetsArrays[vk],hint);if(material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[vk]);_gl.bufferData(_gl.ARRAY_BUFFER,morphNormalsArrays[vk],hint)}}}if(obj_skinWeights.length){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];sw1=obj_skinWeights[face.a];sw2=obj_skinWeights[face.b];sw3=obj_skinWeights[face.c];skinWeightArray[offset_skin]=sw1.x;skinWeightArray[offset_skin+1]=sw1.y;skinWeightArray[offset_skin+2]=sw1.z;skinWeightArray[offset_skin+3]=sw1.w;skinWeightArray[offset_skin+4]=sw2.x;skinWeightArray[offset_skin+5]=sw2.y;skinWeightArray[offset_skin+6]=sw2.z;skinWeightArray[offset_skin+7]=sw2.w;skinWeightArray[offset_skin+8]=sw3.x;skinWeightArray[offset_skin+9]=sw3.y;skinWeightArray[offset_skin+10]=sw3.z;skinWeightArray[offset_skin+11]=sw3.w;si1=obj_skinIndices[face.a];si2=obj_skinIndices[face.b];si3=obj_skinIndices[face.c];skinIndexArray[offset_skin]=si1.x;skinIndexArray[offset_skin+1]=si1.y;skinIndexArray[offset_skin+2]=si1.z;skinIndexArray[offset_skin+3]=si1.w;skinIndexArray[offset_skin+4]=si2.x;skinIndexArray[offset_skin+5]=si2.y;skinIndexArray[offset_skin+6]=si2.z;skinIndexArray[offset_skin+7]=si2.w;skinIndexArray[offset_skin+8]=si3.x;skinIndexArray[offset_skin+9]=si3.y;skinIndexArray[offset_skin+10]=si3.z;skinIndexArray[offset_skin+11]=si3.w;offset_skin+=12}if(offset_skin>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinIndexArray,hint);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,skinWeightArray,hint)}}if(dirtyColors){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexColors=face.vertexColors;faceColor=face.color;if(vertexColors.length===3&&material.vertexColors===THREE.VertexColors){c1=vertexColors[0];c2=vertexColors[1];c3=vertexColors[2]}else{c1=faceColor;c2=faceColor;c3=faceColor}colorArray[offset_color]=c1.r;colorArray[offset_color+1]=c1.g;colorArray[offset_color+2]=c1.b;colorArray[offset_color+3]=c2.r;colorArray[offset_color+4]=c2.g;colorArray[offset_color+5]=c2.b;colorArray[offset_color+6]=c3.r;colorArray[offset_color+7]=c3.g;colorArray[offset_color+8]=c3.b;offset_color+=9}if(offset_color>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,colorArray,hint)}}if(dirtyTangents&&geometry.hasTangents){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexTangents=face.vertexTangents;t1=vertexTangents[0];t2=vertexTangents[1];t3=vertexTangents[2];tangentArray[offset_tangent]=t1.x;tangentArray[offset_tangent+1]=t1.y;tangentArray[offset_tangent+2]=t1.z;tangentArray[offset_tangent+3]=t1.w;tangentArray[offset_tangent+4]=t2.x;tangentArray[offset_tangent+5]=t2.y;tangentArray[offset_tangent+6]=t2.z;tangentArray[offset_tangent+7]=t2.w;tangentArray[offset_tangent+8]=t3.x;tangentArray[offset_tangent+9]=t3.y;tangentArray[offset_tangent+10]=t3.z;tangentArray[offset_tangent+11]=t3.w;offset_tangent+=12}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,tangentArray,hint)}if(dirtyNormals){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];vertexNormals=face.vertexNormals;faceNormal=face.normal;if(vertexNormals.length===3&&needsFaceNormals===false){for(i=0;i<3;i++){vn=vertexNormals[i];normalArray[offset_normal]=vn.x;normalArray[offset_normal+1]=vn.y;normalArray[offset_normal+2]=vn.z;offset_normal+=3}}else{for(i=0;i<3;i++){normalArray[offset_normal]=faceNormal.x;normalArray[offset_normal+1]=faceNormal.y;normalArray[offset_normal+2]=faceNormal.z;offset_normal+=3}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,normalArray,hint)}if(dirtyUvs&&obj_uvs){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv=obj_uvs[fi];if(uv===undefined)continue;for(i=0;i<3;i++){uvi=uv[i];uvArray[offset_uv]=uvi.x;uvArray[offset_uv+1]=uvi.y;offset_uv+=2}}if(offset_uv>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,uvArray,hint)}}if(dirtyUvs&&obj_uvs2){for(f=0,fl=chunk_faces3.length;f<fl;f++){fi=chunk_faces3[f];uv2=obj_uvs2[fi];if(uv2===undefined)continue;for(i=0;i<3;i++){uv2i=uv2[i];uv2Array[offset_uv2]=uv2i.x;uv2Array[offset_uv2+1]=uv2i.y;offset_uv2+=2}}if(offset_uv2>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);_gl.bufferData(_gl.ARRAY_BUFFER,uv2Array,hint)}}if(dirtyElements){for(f=0,fl=chunk_faces3.length;f<fl;f++){faceArray[offset_face]=vertexIndex;faceArray[offset_face+1]=vertexIndex+1;faceArray[offset_face+2]=vertexIndex+2;offset_face+=3;lineArray[offset_line]=vertexIndex;lineArray[offset_line+1]=vertexIndex+1;lineArray[offset_line+2]=vertexIndex;lineArray[offset_line+3]=vertexIndex+2;lineArray[offset_line+4]=vertexIndex+1;lineArray[offset_line+5]=vertexIndex+2;offset_line+=6;vertexIndex+=3}_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,faceArray,hint);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.bufferData(_gl.ELEMENT_ARRAY_BUFFER,lineArray,hint)}if(customAttributes){for(i=0,il=customAttributes.length;i<il;i++){customAttribute=customAttributes[i];if(!customAttribute.__original.needsUpdate)continue;offset_custom=0;if(customAttribute.size===1){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];customAttribute.array[offset_custom]=customAttribute.value[face.a];customAttribute.array[offset_custom+1]=customAttribute.value[face.b];customAttribute.array[offset_custom+2]=customAttribute.value[face.c];offset_custom+=3}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];customAttribute.array[offset_custom]=value;customAttribute.array[offset_custom+1]=value;customAttribute.array[offset_custom+2]=value;offset_custom+=3}}}else if(customAttribute.size===2){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v2.x;customAttribute.array[offset_custom+3]=v2.y;customAttribute.array[offset_custom+4]=v3.x;customAttribute.array[offset_custom+5]=v3.y;offset_custom+=6}}}else if(customAttribute.size===3){var pp;if(customAttribute.type==="c"){pp=["r","g","b"]}else{pp=["x","y","z"]}if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1[pp[0]];customAttribute.array[offset_custom+1]=v1[pp[1]];customAttribute.array[offset_custom+2]=v1[pp[2]];customAttribute.array[offset_custom+3]=v2[pp[0]];customAttribute.array[offset_custom+4]=v2[pp[1]];customAttribute.array[offset_custom+5]=v2[pp[2]];customAttribute.array[offset_custom+6]=v3[pp[0]];customAttribute.array[offset_custom+7]=v3[pp[1]];customAttribute.array[offset_custom+8]=v3[pp[2]];offset_custom+=9}}}else if(customAttribute.size===4){if(customAttribute.boundTo===undefined||customAttribute.boundTo==="vertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){face=obj_faces[chunk_faces3[f]];v1=customAttribute.value[face.a];v2=customAttribute.value[face.b];v3=customAttribute.value[face.c];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}else if(customAttribute.boundTo==="faces"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value;v2=value;v3=value;customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}else if(customAttribute.boundTo==="faceVertices"){for(f=0,fl=chunk_faces3.length;f<fl;f++){value=customAttribute.value[chunk_faces3[f]];v1=value[0];v2=value[1];v3=value[2];customAttribute.array[offset_custom]=v1.x;customAttribute.array[offset_custom+1]=v1.y;customAttribute.array[offset_custom+2]=v1.z;customAttribute.array[offset_custom+3]=v1.w;customAttribute.array[offset_custom+4]=v2.x;customAttribute.array[offset_custom+5]=v2.y;customAttribute.array[offset_custom+6]=v2.z;customAttribute.array[offset_custom+7]=v2.w;customAttribute.array[offset_custom+8]=v3.x;customAttribute.array[offset_custom+9]=v3.y;customAttribute.array[offset_custom+10]=v3.z;customAttribute.array[offset_custom+11]=v3.w;offset_custom+=12}}}_gl.bindBuffer(_gl.ARRAY_BUFFER,customAttribute.buffer);_gl.bufferData(_gl.ARRAY_BUFFER,customAttribute.array,hint)}}if(dispose){delete geometryGroup.__inittedArrays;delete geometryGroup.__colorArray;delete geometryGroup.__normalArray;delete geometryGroup.__tangentArray;delete geometryGroup.__uvArray;delete geometryGroup.__uv2Array;delete geometryGroup.__faceArray;delete geometryGroup.__vertexArray;delete geometryGroup.__lineArray;delete geometryGroup.__skinIndexArray;delete geometryGroup.__skinWeightArray}}this.renderBufferImmediate=function(object,program,material){state.initAttributes();if(object.hasPositions&&!object.__webglVertexBuffer)object.__webglVertexBuffer=_gl.createBuffer();if(object.hasNormals&&!object.__webglNormalBuffer)object.__webglNormalBuffer=_gl.createBuffer();if(object.hasUvs&&!object.__webglUvBuffer)object.__webglUvBuffer=_gl.createBuffer();if(object.hasColors&&!object.__webglColorBuffer)object.__webglColorBuffer=_gl.createBuffer();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglVertexBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.position);_gl.vertexAttribPointer(program.attributes.position,3,_gl.FLOAT,false,0,0)}if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglNormalBuffer);if(material instanceof THREE.MeshPhongMaterial===false&&material.shading===THREE.FlatShading){var nx,ny,nz,nax,nbx,ncx,nay,nby,ncy,naz,nbz,ncz,normalArray,i,il=object.count*3;for(i=0;i<il;i+=9){normalArray=object.normalArray;nax=normalArray[i];nay=normalArray[i+1];naz=normalArray[i+2];nbx=normalArray[i+3];nby=normalArray[i+4];nbz=normalArray[i+5];ncx=normalArray[i+6];ncy=normalArray[i+7];ncz=normalArray[i+8];nx=(nax+nbx+ncx)/3;ny=(nay+nby+ncy)/3;nz=(naz+nbz+ncz)/3;normalArray[i]=nx;normalArray[i+1]=ny;normalArray[i+2]=nz;normalArray[i+3]=nx;normalArray[i+4]=ny;normalArray[i+5]=nz;normalArray[i+6]=nx;normalArray[i+7]=ny;normalArray[i+8]=nz}}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.normal);_gl.vertexAttribPointer(program.attributes.normal,3,_gl.FLOAT,false,0,0)}if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglUvBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.uv);_gl.vertexAttribPointer(program.attributes.uv,2,_gl.FLOAT,false,0,0)}if(object.hasColors&&material.vertexColors!==THREE.NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,object.__webglColorBuffer);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);state.enableAttribute(program.attributes.color);_gl.vertexAttribPointer(program.attributes.color,3,_gl.FLOAT,false,0,0)}state.disableUnusedAttributes();_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0};function setupVertexAttributes(material,program,geometry,startIndex){var geometryAttributes=geometry.attributes;var programAttributes=program.attributes;var programAttributesKeys=program.attributesKeys;for(var i=0,l=programAttributesKeys.length;i<l;i++){var key=programAttributesKeys[i];var programAttribute=programAttributes[key];if(programAttribute>=0){var geometryAttribute=geometryAttributes[key];if(geometryAttribute!==undefined){var size=geometryAttribute.itemSize;_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryAttribute.buffer);state.enableAttribute(programAttribute);_gl.vertexAttribPointer(programAttribute,size,_gl.FLOAT,false,0,startIndex*size*4)}else if(material.defaultAttributeValues!==undefined){if(material.defaultAttributeValues[key].length===2){_gl.vertexAttrib2fv(programAttribute,material.defaultAttributeValues[key])}else if(material.defaultAttributeValues[key].length===3){_gl.vertexAttrib3fv(programAttribute,material.defaultAttributeValues[key])}}}}state.disableUnusedAttributes()}this.renderBufferDirect=function(camera,lights,fog,material,geometry,object){if(material.visible===false)return;updateObject(object);var program=setProgram(camera,lights,fog,material,object);var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryProgram="direct_"+geometry.id+"_"+program.id+"_"+wireframeBit;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=true}if(updateBuffers){state.initAttributes()}if(object instanceof THREE.Mesh){var mode=material.wireframe===true?_gl.LINES:_gl.TRIANGLES;var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.vertices+=index.array.length;_this.info.render.faces+=index.array.length/3}else{updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count;_this.info.render.faces+=offsets[i].count/3}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes["position"];_gl.drawArrays(mode,0,position.array.length/position.itemSize);_this.info.render.calls++;_this.info.render.vertices+=position.array.length/position.itemSize;_this.info.render.faces+=position.array.length/(3*position.itemSize)}}else if(object instanceof THREE.PointCloud){var mode=_gl.POINTS;var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array&&extensions.get("OES_element_index_uint")){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.points+=index.array.length}else{if(offsets.length>1)updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.points+=offsets[i].count}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes.position;var offsets=geometry.offsets;if(offsets.length===0){_gl.drawArrays(mode,0,position.array.length/3);_this.info.render.calls++;_this.info.render.points+=position.array.length/3}else{for(var i=0,il=offsets.length;i<il;i++){_gl.drawArrays(mode,offsets[i].index,offsets[i].count);_this.info.render.calls++;_this.info.render.points+=offsets[i].count}}}}else if(object instanceof THREE.Line){var mode=object.mode===THREE.LineStrip?_gl.LINE_STRIP:_gl.LINES;state.setLineWidth(material.linewidth*pixelRatio);var index=geometry.attributes.index;if(index){var type,size;if(index.array instanceof Uint32Array){type=_gl.UNSIGNED_INT;size=4}else{type=_gl.UNSIGNED_SHORT;size=2}var offsets=geometry.offsets;if(offsets.length===0){if(updateBuffers){setupVertexAttributes(material,program,geometry,0);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,index.array.length,type,0);_this.info.render.calls++;_this.info.render.vertices+=index.array.length}else{if(offsets.length>1)updateBuffers=true;for(var i=0,il=offsets.length;i<il;i++){var startIndex=offsets[i].index;if(updateBuffers){setupVertexAttributes(material,program,geometry,startIndex);_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,index.buffer)}_gl.drawElements(mode,offsets[i].count,type,offsets[i].start*size);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count}}}else{if(updateBuffers){setupVertexAttributes(material,program,geometry,0)}var position=geometry.attributes.position;var offsets=geometry.offsets;if(offsets.length===0){_gl.drawArrays(mode,0,position.array.length/3);_this.info.render.calls++;_this.info.render.vertices+=position.array.length/3}else{for(var i=0,il=offsets.length;i<il;i++){_gl.drawArrays(mode,offsets[i].index,offsets[i].count);_this.info.render.calls++;_this.info.render.vertices+=offsets[i].count}}}}};this.renderBuffer=function(camera,lights,fog,material,geometryGroup,object){if(material.visible===false)return;updateObject(object);var program=setProgram(camera,lights,fog,material,object);var attributes=program.attributes;var updateBuffers=false,wireframeBit=material.wireframe?1:0,geometryProgram=geometryGroup.id+"_"+program.id+"_"+wireframeBit;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=true}if(updateBuffers){state.initAttributes()}if(!material.morphTargets&&attributes.position>=0){if(updateBuffers){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}}else{if(object.morphTargetBase){setupMorphTargets(material,geometryGroup,object)}}if(updateBuffers){if(geometryGroup.__webglCustomAttributesList){for(var i=0,il=geometryGroup.__webglCustomAttributesList.length;i<il;i++){var attribute=geometryGroup.__webglCustomAttributesList[i];if(attributes[attribute.buffer.belongsToAttribute]>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,attribute.buffer);state.enableAttribute(attributes[attribute.buffer.belongsToAttribute]);_gl.vertexAttribPointer(attributes[attribute.buffer.belongsToAttribute],attribute.size,_gl.FLOAT,false,0,0)}}}if(attributes.color>=0){if(object.geometry.colors.length>0||object.geometry.faces.length>0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglColorBuffer);state.enableAttribute(attributes.color);_gl.vertexAttribPointer(attributes.color,3,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib3fv(attributes.color,material.defaultAttributeValues.color)}}if(attributes.normal>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglNormalBuffer);state.enableAttribute(attributes.normal);_gl.vertexAttribPointer(attributes.normal,3,_gl.FLOAT,false,0,0)}if(attributes.tangent>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglTangentBuffer);state.enableAttribute(attributes.tangent);_gl.vertexAttribPointer(attributes.tangent,4,_gl.FLOAT,false,0,0)}if(attributes.uv>=0){if(object.geometry.faceVertexUvs[0]){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUVBuffer);state.enableAttribute(attributes.uv);_gl.vertexAttribPointer(attributes.uv,2,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib2fv(attributes.uv,material.defaultAttributeValues.uv)}}if(attributes.uv2>=0){if(object.geometry.faceVertexUvs[1]){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglUV2Buffer);state.enableAttribute(attributes.uv2);_gl.vertexAttribPointer(attributes.uv2,2,_gl.FLOAT,false,0,0)}else if(material.defaultAttributeValues!==undefined){_gl.vertexAttrib2fv(attributes.uv2,material.defaultAttributeValues.uv2)}}if(material.skinning&&attributes.skinIndex>=0&&attributes.skinWeight>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinIndicesBuffer);state.enableAttribute(attributes.skinIndex);_gl.vertexAttribPointer(attributes.skinIndex,4,_gl.FLOAT,false,0,0);_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglSkinWeightsBuffer);state.enableAttribute(attributes.skinWeight);_gl.vertexAttribPointer(attributes.skinWeight,4,_gl.FLOAT,false,0,0)}if(attributes.lineDistance>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglLineDistanceBuffer);state.enableAttribute(attributes.lineDistance);_gl.vertexAttribPointer(attributes.lineDistance,1,_gl.FLOAT,false,0,0)}}state.disableUnusedAttributes();if(object instanceof THREE.Mesh){var type=geometryGroup.__typeArray===Uint32Array?_gl.UNSIGNED_INT:_gl.UNSIGNED_SHORT;if(material.wireframe){state.setLineWidth(material.wireframeLinewidth*pixelRatio);if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglLineBuffer);_gl.drawElements(_gl.LINES,geometryGroup.__webglLineCount,type,0)}else{if(updateBuffers)_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,geometryGroup.__webglFaceBuffer);_gl.drawElements(_gl.TRIANGLES,geometryGroup.__webglFaceCount,type,0)}_this.info.render.calls++;_this.info.render.vertices+=geometryGroup.__webglFaceCount;_this.info.render.faces+=geometryGroup.__webglFaceCount/3}else if(object instanceof THREE.Line){var mode=object.mode===THREE.LineStrip?_gl.LINE_STRIP:_gl.LINES;state.setLineWidth(material.linewidth*pixelRatio);_gl.drawArrays(mode,0,geometryGroup.__webglLineCount);_this.info.render.calls++}else if(object instanceof THREE.PointCloud){_gl.drawArrays(_gl.POINTS,0,geometryGroup.__webglParticleCount);_this.info.render.calls++;_this.info.render.points+=geometryGroup.__webglParticleCount}};function setupMorphTargets(material,geometryGroup,object){var attributes=material.program.attributes;if(object.morphTargetBase!==-1&&attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[object.morphTargetBase]);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}else if(attributes.position>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglVertexBuffer);state.enableAttribute(attributes.position);_gl.vertexAttribPointer(attributes.position,3,_gl.FLOAT,false,0,0)}if(object.morphTargetForcedOrder.length){var m=0;var order=object.morphTargetForcedOrder;var influences=object.morphTargetInfluences;var attribute;while(m<material.numSupportedMorphTargets&&m<order.length){attribute=attributes["morphTarget"+m];if(attribute>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[order[m]]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}attribute=attributes["morphNormal"+m];if(attribute>=0&&material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[order[m]]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}object.__webglMorphTargetInfluences[m]=influences[order[m]];m++}}else{var activeInfluenceIndices=[];var influences=object.morphTargetInfluences;var morphTargets=object.geometry.morphTargets;if(influences.length>morphTargets.length){console.warn("THREE.WebGLRenderer: Influences array is bigger than morphTargets array.");influences.length=morphTargets.length}for(var i=0,il=influences.length;i<il;i++){var influence=influences[i];activeInfluenceIndices.push([influence,i])}if(activeInfluenceIndices.length>material.numSupportedMorphTargets){activeInfluenceIndices.sort(numericalSort);activeInfluenceIndices.length=material.numSupportedMorphTargets}else if(activeInfluenceIndices.length>material.numSupportedMorphNormals){activeInfluenceIndices.sort(numericalSort)}else if(activeInfluenceIndices.length===0){activeInfluenceIndices.push([0,0])}var attribute;for(var m=0,ml=material.numSupportedMorphTargets;m<ml;m++){if(activeInfluenceIndices[m]){var influenceIndex=activeInfluenceIndices[m][1];attribute=attributes["morphTarget"+m];if(attribute>=0){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphTargetsBuffers[influenceIndex]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}attribute=attributes["morphNormal"+m];if(attribute>=0&&material.morphNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,geometryGroup.__webglMorphNormalsBuffers[influenceIndex]);state.enableAttribute(attribute);_gl.vertexAttribPointer(attribute,3,_gl.FLOAT,false,0,0)}object.__webglMorphTargetInfluences[m]=influences[influenceIndex]}else{object.__webglMorphTargetInfluences[m]=0}}}if(material.program.uniforms.morphTargetInfluences!==null){_gl.uniform1fv(material.program.uniforms.morphTargetInfluences,object.__webglMorphTargetInfluences)}}function painterSortStable(a,b){if(a.object.renderOrder!==b.object.renderOrder){return a.object.renderOrder-b.object.renderOrder}else if(a.material.id!==b.material.id){return a.material.id-b.material.id}else if(a.z!==b.z){return a.z-b.z}else{return a.id-b.id}}function reversePainterSortStable(a,b){if(a.object.renderOrder!==b.object.renderOrder){return a.object.renderOrder-b.object.renderOrder}if(a.z!==b.z){return b.z-a.z}else{return a.id-b.id}}function numericalSort(a,b){return b[0]-a[0]}this.render=function(scene,camera,renderTarget,forceClear){if(camera instanceof THREE.Camera===false){THREE.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}var fog=scene.fog;_currentGeometryProgram="";_currentMaterialId=-1;_currentCamera=null;_lightsNeedUpdate=true;if(scene.autoUpdate===true)scene.updateMatrixWorld();if(camera.parent===undefined)camera.updateMatrixWorld();scene.traverse(function(object){if(object instanceof THREE.SkinnedMesh){object.skeleton.update()}});camera.matrixWorldInverse.getInverse(camera.matrixWorld);_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);lights.length=0;opaqueObjects.length=0;transparentObjects.length=0;sprites.length=0;lensFlares.length=0;projectObject(scene);if(_this.sortObjects===true){opaqueObjects.sort(painterSortStable);transparentObjects.sort(reversePainterSortStable)}shadowMapPlugin.render(scene,camera);_this.info.render.calls=0;_this.info.render.vertices=0;_this.info.render.faces=0;_this.info.render.points=0;this.setRenderTarget(renderTarget);if(this.autoClear||forceClear){this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil)}for(var i=0,il=_webglObjectsImmediate.length;i<il;i++){var webglObject=_webglObjectsImmediate[i];var object=webglObject.object;if(object.visible){setupMatrices(object,camera);unrollImmediateBufferMaterial(webglObject)}}if(scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;setMaterial(overrideMaterial);renderObjects(opaqueObjects,camera,lights,fog,overrideMaterial);renderObjects(transparentObjects,camera,lights,fog,overrideMaterial);renderObjectsImmediate(_webglObjectsImmediate,"",camera,lights,fog,overrideMaterial)}else{state.setBlending(THREE.NoBlending);renderObjects(opaqueObjects,camera,lights,fog,null);renderObjectsImmediate(_webglObjectsImmediate,"opaque",camera,lights,fog,null);renderObjects(transparentObjects,camera,lights,fog,null);renderObjectsImmediate(_webglObjectsImmediate,"transparent",camera,lights,fog,null)}spritePlugin.render(scene,camera);lensFlarePlugin.render(scene,camera,_currentWidth,_currentHeight);if(renderTarget&&renderTarget.generateMipmaps&&renderTarget.minFilter!==THREE.NearestFilter&&renderTarget.minFilter!==THREE.LinearFilter){updateRenderTargetMipmap(renderTarget)}state.setDepthTest(true);state.setDepthWrite(true);state.setColorWrite(true)};function projectObject(object){if(object.visible===false)return;if(object instanceof THREE.Scene||object instanceof THREE.Group){}else{initObject(object);if(object instanceof THREE.Light){lights.push(object)}else if(object instanceof THREE.Sprite){sprites.push(object)}else if(object instanceof THREE.LensFlare){lensFlares.push(object)}else{var webglObjects=_webglObjects[object.id];if(webglObjects&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){for(var i=0,l=webglObjects.length;i<l;i++){var webglObject=webglObjects[i];unrollBufferMaterial(webglObject);webglObject.render=true;if(_this.sortObjects===true){_vector3.setFromMatrixPosition(object.matrixWorld);_vector3.applyProjection(_projScreenMatrix);webglObject.z=_vector3.z}}}}}for(var i=0,l=object.children.length;i<l;i++){projectObject(object.children[i])}}function renderObjects(renderList,camera,lights,fog,overrideMaterial){var material;for(var i=0,l=renderList.length;i<l;i++){var webglObject=renderList[i];var object=webglObject.object;var buffer=webglObject.buffer;setupMatrices(object,camera);if(overrideMaterial){material=overrideMaterial}else{material=webglObject.material;if(!material)continue;setMaterial(material)}_this.setMaterialFaces(material);if(buffer instanceof THREE.BufferGeometry){_this.renderBufferDirect(camera,lights,fog,material,buffer,object)}else{_this.renderBuffer(camera,lights,fog,material,buffer,object)}}}function renderObjectsImmediate(renderList,materialType,camera,lights,fog,overrideMaterial){var material;for(var i=0,l=renderList.length;i<l;i++){var webglObject=renderList[i];var object=webglObject.object;if(object.visible){if(overrideMaterial){material=overrideMaterial}else{material=webglObject[materialType];if(!material)continue;setMaterial(material)}_this.renderImmediateObject(camera,lights,fog,material,object)}}}this.renderImmediateObject=function(camera,lights,fog,material,object){var program=setProgram(camera,lights,fog,material,object);_currentGeometryProgram="";_this.setMaterialFaces(material);if(object.immediateRenderCallback){object.immediateRenderCallback(program,_gl,_frustum)}else{object.render(function(object){_this.renderBufferImmediate(object,program,material)})}};function unrollImmediateBufferMaterial(globject){var object=globject.object,material=object.material;if(material.transparent){globject.transparent=material;globject.opaque=null}else{globject.opaque=material;globject.transparent=null}}function unrollBufferMaterial(globject){var object=globject.object;var buffer=globject.buffer;var geometry=object.geometry;var material=object.material;if(material instanceof THREE.MeshFaceMaterial){var materialIndex=geometry instanceof THREE.BufferGeometry?0:buffer.materialIndex;material=material.materials[materialIndex];globject.material=material;if(material.transparent){transparentObjects.push(globject)}else{opaqueObjects.push(globject)}}else if(material){globject.material=material;if(material.transparent){transparentObjects.push(globject)}else{opaqueObjects.push(globject)}}}function initObject(object){if(object.__webglInit===undefined){object.__webglInit=true;object._modelViewMatrix=new THREE.Matrix4;object._normalMatrix=new THREE.Matrix3;object.addEventListener("removed",onObjectRemoved)}var geometry=object.geometry;if(geometry===undefined){}else if(geometry.__webglInit===undefined){geometry.__webglInit=true;geometry.addEventListener("dispose",onGeometryDispose);if(geometry instanceof THREE.BufferGeometry){_this.info.memory.geometries++}else if(object instanceof THREE.Mesh){initGeometryGroups(object,geometry)}else if(object instanceof THREE.Line){if(geometry.__webglVertexBuffer===undefined){createLineBuffers(geometry);initLineBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true;geometry.lineDistancesNeedUpdate=true}}else if(object instanceof THREE.PointCloud){if(geometry.__webglVertexBuffer===undefined){createParticleBuffers(geometry);initParticleBuffers(geometry,object);geometry.verticesNeedUpdate=true;geometry.colorsNeedUpdate=true}}}if(object.__webglActive===undefined){object.__webglActive=true;if(object instanceof THREE.Mesh){if(geometry instanceof THREE.BufferGeometry){addBuffer(_webglObjects,geometry,object)}else if(geometry instanceof THREE.Geometry){var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,l=geometryGroupsList.length;i<l;i++){addBuffer(_webglObjects,geometryGroupsList[i],object)}}}else if(object instanceof THREE.Line||object instanceof THREE.PointCloud){addBuffer(_webglObjects,geometry,object)}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){addBufferImmediate(_webglObjectsImmediate,object)}}}var geometryGroups={};var geometryGroupCounter=0;function makeGroups(geometry,usesFaceMaterial){var maxVerticesInGroup=extensions.get("OES_element_index_uint")?4294967296:65535;var groupHash,hash_map={};var numMorphTargets=geometry.morphTargets.length;var numMorphNormals=geometry.morphNormals.length;var group;var groups={};var groupsList=[];for(var f=0,fl=geometry.faces.length;f<fl;f++){var face=geometry.faces[f];var materialIndex=usesFaceMaterial?face.materialIndex:0;if(!(materialIndex in hash_map)){hash_map[materialIndex]={hash:materialIndex,counter:0}}groupHash=hash_map[materialIndex].hash+"_"+hash_map[materialIndex].counter;if(!(groupHash in groups)){group={id:geometryGroupCounter++,faces3:[],materialIndex:materialIndex,vertices:0,numMorphTargets:numMorphTargets,numMorphNormals:numMorphNormals};groups[groupHash]=group;groupsList.push(group)}if(groups[groupHash].vertices+3>maxVerticesInGroup){hash_map[materialIndex].counter+=1;groupHash=hash_map[materialIndex].hash+"_"+hash_map[materialIndex].counter;if(!(groupHash in groups)){group={id:geometryGroupCounter++,faces3:[],materialIndex:materialIndex,vertices:0,numMorphTargets:numMorphTargets,numMorphNormals:numMorphNormals};groups[groupHash]=group;groupsList.push(group)}}groups[groupHash].faces3.push(f);groups[groupHash].vertices+=3}return groupsList}function initGeometryGroups(object,geometry){var material=object.material,addBuffers=false;if(geometryGroups[geometry.id]===undefined||geometry.groupsNeedUpdate===true){delete _webglObjects[object.id];geometryGroups[geometry.id]=makeGroups(geometry,material instanceof THREE.MeshFaceMaterial);geometry.groupsNeedUpdate=false}var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,il=geometryGroupsList.length;i<il;i++){var geometryGroup=geometryGroupsList[i];if(geometryGroup.__webglVertexBuffer===undefined){createMeshBuffers(geometryGroup);initMeshBuffers(geometryGroup,object);geometry.verticesNeedUpdate=true;geometry.morphTargetsNeedUpdate=true;geometry.elementsNeedUpdate=true;geometry.uvsNeedUpdate=true;geometry.normalsNeedUpdate=true;geometry.tangentsNeedUpdate=true;geometry.colorsNeedUpdate=true;addBuffers=true}else{addBuffers=false}if(addBuffers||object.__webglActive===undefined){addBuffer(_webglObjects,geometryGroup,object)}}object.__webglActive=true}function addBuffer(objlist,buffer,object){var id=object.id;objlist[id]=objlist[id]||[];objlist[id].push({id:id,buffer:buffer,object:object,material:null,z:0})}function addBufferImmediate(objlist,object){objlist.push({id:null,object:object,opaque:null,transparent:null,z:0})}function updateObject(object){var geometry=object.geometry;if(geometry instanceof THREE.BufferGeometry){var attributes=geometry.attributes;var attributesKeys=geometry.attributesKeys;for(var i=0,l=attributesKeys.length;i<l;i++){var key=attributesKeys[i];var attribute=attributes[key];var bufferType=key==="index"?_gl.ELEMENT_ARRAY_BUFFER:_gl.ARRAY_BUFFER;if(attribute.buffer===undefined){attribute.buffer=_gl.createBuffer();_gl.bindBuffer(bufferType,attribute.buffer);_gl.bufferData(bufferType,attribute.array,attribute instanceof THREE.DynamicBufferAttribute?_gl.DYNAMIC_DRAW:_gl.STATIC_DRAW);attribute.needsUpdate=false}else if(attribute.needsUpdate===true){_gl.bindBuffer(bufferType,attribute.buffer);if(attribute.updateRange===undefined||attribute.updateRange.count===-1){_gl.bufferSubData(bufferType,0,attribute.array)}else if(attribute.updateRange.count===0){console.error("THREE.WebGLRenderer.updateObject: using updateRange for THREE.DynamicBufferAttribute and marked as needsUpdate but count is 0, ensure you are using set methods or updating manually.")}else{_gl.bufferSubData(bufferType,attribute.updateRange.offset*attribute.array.BYTES_PER_ELEMENT,attribute.array.subarray(attribute.updateRange.offset,attribute.updateRange.offset+attribute.updateRange.count));attribute.updateRange.count=0}attribute.needsUpdate=false}}}else if(object instanceof THREE.Mesh){if(geometry.groupsNeedUpdate===true){initGeometryGroups(object,geometry)}var geometryGroupsList=geometryGroups[geometry.id];for(var i=0,il=geometryGroupsList.length;i<il;i++){var geometryGroup=geometryGroupsList[i];var material=getBufferMaterial(object,geometryGroup);var customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.morphTargetsNeedUpdate||geometry.elementsNeedUpdate||geometry.uvsNeedUpdate||geometry.normalsNeedUpdate||geometry.colorsNeedUpdate||geometry.tangentsNeedUpdate||customAttributesDirty){setMeshBuffers(geometryGroup,object,_gl.DYNAMIC_DRAW,!geometry.dynamic,material)}}geometry.verticesNeedUpdate=false;geometry.morphTargetsNeedUpdate=false;geometry.elementsNeedUpdate=false;geometry.uvsNeedUpdate=false;geometry.normalsNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.tangentsNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}else if(object instanceof THREE.Line){var material=getBufferMaterial(object,geometry);var customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||geometry.lineDistancesNeedUpdate||customAttributesDirty){setLineBuffers(geometry,_gl.DYNAMIC_DRAW)}geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;geometry.lineDistancesNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}else if(object instanceof THREE.PointCloud){var material=getBufferMaterial(object,geometry);var customAttributesDirty=material.attributes&&areCustomAttributesDirty(material);if(geometry.verticesNeedUpdate||geometry.colorsNeedUpdate||customAttributesDirty){setParticleBuffers(geometry,_gl.DYNAMIC_DRAW,object)}geometry.verticesNeedUpdate=false;geometry.colorsNeedUpdate=false;material.attributes&&clearCustomAttributes(material)}}function areCustomAttributesDirty(material){for(var name in material.attributes){if(material.attributes[name].needsUpdate)return true}return false}function clearCustomAttributes(material){for(var name in material.attributes){material.attributes[name].needsUpdate=false}}function removeObject(object){if(object instanceof THREE.Mesh||object instanceof THREE.PointCloud||object instanceof THREE.Line){delete _webglObjects[object.id]}else if(object instanceof THREE.ImmediateRenderObject||object.immediateRenderCallback){removeInstances(_webglObjectsImmediate,object)}delete object.__webglInit;delete object._modelViewMatrix;delete object._normalMatrix;delete object.__webglActive}function removeInstances(objlist,object){for(var o=objlist.length-1;o>=0;o--){if(objlist[o].object===object){objlist.splice(o,1)}}}var shaderIDs={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};function initMaterial(material,lights,fog,object){material.addEventListener("dispose",onMaterialDispose);var shaderID=shaderIDs[material.type];if(shaderID){var shader=THREE.ShaderLib[shaderID];material.__webglShader={uniforms:THREE.UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else{material.__webglShader={uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader}}var maxLightCount=allocateLights(lights);var maxShadows=allocateShadows(lights);var maxBones=allocateBones(object);var parameters={precision:_precision,supportsVertexTextures:_supportsVertexTextures,map:!!material.map,envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,lightMap:!!material.lightMap,bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,combine:material.combine,vertexColors:material.vertexColors,fog:fog,useFog:material.fog,fogExp:fog instanceof THREE.FogExp2,flatShading:material.shading===THREE.FlatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:_logarithmicDepthBuffer,skinning:material.skinning,maxBones:maxBones,useVertexTexture:_supportsBoneTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:_this.maxMorphTargets,maxMorphNormals:_this.maxMorphNormals,maxDirLights:maxLightCount.directional,maxPointLights:maxLightCount.point,maxSpotLights:maxLightCount.spot,maxHemiLights:maxLightCount.hemi,maxShadows:maxShadows,shadowMapEnabled:_this.shadowMapEnabled&&object.receiveShadow&&maxShadows>0,shadowMapType:_this.shadowMapType,shadowMapDebug:_this.shadowMapDebug,shadowMapCascade:_this.shadowMapCascade,alphaTest:material.alphaTest,metal:material.metal,wrapAround:material.wrapAround,doubleSided:material.side===THREE.DoubleSide,flipSided:material.side===THREE.BackSide};var chunks=[];if(shaderID){chunks.push(shaderID)}else{chunks.push(material.fragmentShader);chunks.push(material.vertexShader)}if(material.defines!==undefined){for(var name in material.defines){chunks.push(name);chunks.push(material.defines[name])}}for(var name in parameters){chunks.push(name);chunks.push(parameters[name])}var code=chunks.join();var program;for(var p=0,pl=_programs.length;p<pl;p++){var programInfo=_programs[p];if(programInfo.code===code){program=programInfo;program.usedTimes++;break}}if(program===undefined){program=new THREE.WebGLProgram(_this,code,material,parameters);_programs.push(program);_this.info.memory.programs=_programs.length}material.program=program;var attributes=program.attributes;if(material.morphTargets){material.numSupportedMorphTargets=0;var id,base="morphTarget";for(var i=0;i<_this.maxMorphTargets;i++){id=base+i;if(attributes[id]>=0){material.numSupportedMorphTargets++}}}if(material.morphNormals){material.numSupportedMorphNormals=0;var id,base="morphNormal";for(i=0;i<_this.maxMorphNormals;i++){id=base+i;if(attributes[id]>=0){material.numSupportedMorphNormals++}}}material.uniformsList=[];for(var u in material.__webglShader.uniforms){var location=material.program.uniforms[u];if(location){material.uniformsList.push([material.__webglShader.uniforms[u],location])}}}function setMaterial(material){if(material.transparent===true){state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha)}else{state.setBlending(THREE.NoBlending)}state.setDepthTest(material.depthTest);state.setDepthWrite(material.depthWrite);state.setColorWrite(material.colorWrite);state.setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)}function setProgram(camera,lights,fog,material,object){_usedTextureUnits=0;if(material.needsUpdate){if(material.program)deallocateMaterial(material);initMaterial(material,lights,fog,object);material.needsUpdate=false}if(material.morphTargets){if(!object.__webglMorphTargetInfluences){object.__webglMorphTargetInfluences=new Float32Array(_this.maxMorphTargets)}}var refreshProgram=false;var refreshMaterial=false;var refreshLights=false;var program=material.program,p_uniforms=program.uniforms,m_uniforms=material.__webglShader.uniforms;if(program.id!==_currentProgram){_gl.useProgram(program.program);_currentProgram=program.id;refreshProgram=true;refreshMaterial=true;refreshLights=true}if(material.id!==_currentMaterialId){if(_currentMaterialId===-1)refreshLights=true;_currentMaterialId=material.id;refreshMaterial=true}if(refreshProgram||camera!==_currentCamera){_gl.uniformMatrix4fv(p_uniforms.projectionMatrix,false,camera.projectionMatrix.elements);if(_logarithmicDepthBuffer){_gl.uniform1f(p_uniforms.logDepthBufFC,2/(Math.log(camera.far+1)/Math.LN2))}if(camera!==_currentCamera)_currentCamera=camera;if(material instanceof THREE.ShaderMaterial||material instanceof THREE.MeshPhongMaterial||material.envMap){if(p_uniforms.cameraPosition!==null){_vector3.setFromMatrixPosition(camera.matrixWorld);_gl.uniform3f(p_uniforms.cameraPosition,_vector3.x,_vector3.y,_vector3.z)}}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshBasicMaterial||material instanceof THREE.ShaderMaterial||material.skinning){if(p_uniforms.viewMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.viewMatrix,false,camera.matrixWorldInverse.elements)}}}if(material.skinning){if(object.bindMatrix&&p_uniforms.bindMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.bindMatrix,false,object.bindMatrix.elements)}if(object.bindMatrixInverse&&p_uniforms.bindMatrixInverse!==null){_gl.uniformMatrix4fv(p_uniforms.bindMatrixInverse,false,object.bindMatrixInverse.elements)}if(_supportsBoneTextures&&object.skeleton&&object.skeleton.useVertexTexture){if(p_uniforms.boneTexture!==null){var textureUnit=getTextureUnit();_gl.uniform1i(p_uniforms.boneTexture,textureUnit);_this.setTexture(object.skeleton.boneTexture,textureUnit)}if(p_uniforms.boneTextureWidth!==null){_gl.uniform1i(p_uniforms.boneTextureWidth,object.skeleton.boneTextureWidth)}if(p_uniforms.boneTextureHeight!==null){_gl.uniform1i(p_uniforms.boneTextureHeight,object.skeleton.boneTextureHeight)}}else if(object.skeleton&&object.skeleton.boneMatrices){if(p_uniforms.boneGlobalMatrices!==null){_gl.uniformMatrix4fv(p_uniforms.boneGlobalMatrices,false,object.skeleton.boneMatrices)}}}if(refreshMaterial){if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog)}if(material instanceof THREE.MeshPhongMaterial||material instanceof THREE.MeshLambertMaterial||material.lights){if(_lightsNeedUpdate){refreshLights=true;setupLights(lights);_lightsNeedUpdate=false}if(refreshLights){refreshUniformsLights(m_uniforms,_lights);markUniformsLightsNeedsUpdate(m_uniforms,true)}else{markUniformsLightsNeedsUpdate(m_uniforms,false)}}if(material instanceof THREE.MeshBasicMaterial||material instanceof THREE.MeshLambertMaterial||material instanceof THREE.MeshPhongMaterial){refreshUniformsCommon(m_uniforms,material)}if(material instanceof THREE.LineBasicMaterial){refreshUniformsLine(m_uniforms,material)}else if(material instanceof THREE.LineDashedMaterial){refreshUniformsLine(m_uniforms,material);refreshUniformsDash(m_uniforms,material)}else if(material instanceof THREE.PointCloudMaterial){refreshUniformsParticle(m_uniforms,material)}else if(material instanceof THREE.MeshPhongMaterial){refreshUniformsPhong(m_uniforms,material)}else if(material instanceof THREE.MeshLambertMaterial){refreshUniformsLambert(m_uniforms,material)}else if(material instanceof THREE.MeshDepthMaterial){m_uniforms.mNear.value=camera.near;m_uniforms.mFar.value=camera.far;m_uniforms.opacity.value=material.opacity}else if(material instanceof THREE.MeshNormalMaterial){m_uniforms.opacity.value=material.opacity}if(object.receiveShadow&&!material._shadowPass){refreshUniformsShadow(m_uniforms,lights)}loadUniformsGeneric(material.uniformsList)}loadUniformsMatrices(p_uniforms,object);if(p_uniforms.modelMatrix!==null){_gl.uniformMatrix4fv(p_uniforms.modelMatrix,false,object.matrixWorld.elements)}return program}function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;uniforms.diffuse.value=material.color;uniforms.map.value=material.map;uniforms.lightMap.value=material.lightMap;uniforms.specularMap.value=material.specularMap;uniforms.alphaMap.value=material.alphaMap;if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}var uvScaleMap;if(material.map){uvScaleMap=material.map}else if(material.specularMap){uvScaleMap=material.specularMap}else if(material.normalMap){uvScaleMap=material.normalMap}else if(material.bumpMap){uvScaleMap=material.bumpMap}else if(material.alphaMap){uvScaleMap=material.alphaMap}if(uvScaleMap!==undefined){var offset=uvScaleMap.offset;var repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}uniforms.envMap.value=material.envMap;uniforms.flipEnvMap.value=material.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;uniforms.reflectivity.value=material.reflectivity;uniforms.refractionRatio.value=material.refractionRatio}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity}function refreshUniformsDash(uniforms,material){uniforms.dashSize.value=material.dashSize;uniforms.totalSize.value=material.dashSize+material.gapSize;uniforms.scale.value=material.scale}function refreshUniformsParticle(uniforms,material){uniforms.psColor.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size;uniforms.scale.value=_canvas.height/2;uniforms.map.value=material.map;if(material.map!==null){var offset=material.map.offset;var repeat=material.map.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}}function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog instanceof THREE.Fog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far}else if(fog instanceof THREE.FogExp2){uniforms.fogDensity.value=fog.density}}function refreshUniformsPhong(uniforms,material){uniforms.shininess.value=material.shininess;uniforms.emissive.value=material.emissive;uniforms.specular.value=material.specular;if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB)}}function refreshUniformsLambert(uniforms,material){uniforms.emissive.value=material.emissive;if(material.wrapAround){uniforms.wrapRGB.value.copy(material.wrapRGB)}}function refreshUniformsLights(uniforms,lights){uniforms.ambientLightColor.value=lights.ambient;uniforms.directionalLightColor.value=lights.directional.colors;uniforms.directionalLightDirection.value=lights.directional.positions;uniforms.pointLightColor.value=lights.point.colors;uniforms.pointLightPosition.value=lights.point.positions;uniforms.pointLightDistance.value=lights.point.distances;uniforms.pointLightDecay.value=lights.point.decays;uniforms.spotLightColor.value=lights.spot.colors;uniforms.spotLightPosition.value=lights.spot.positions;uniforms.spotLightDistance.value=lights.spot.distances;uniforms.spotLightDirection.value=lights.spot.directions;uniforms.spotLightAngleCos.value=lights.spot.anglesCos;uniforms.spotLightExponent.value=lights.spot.exponents;uniforms.spotLightDecay.value=lights.spot.decays;uniforms.hemisphereLightSkyColor.value=lights.hemi.skyColors;uniforms.hemisphereLightGroundColor.value=lights.hemi.groundColors;uniforms.hemisphereLightDirection.value=lights.hemi.positions}function markUniformsLightsNeedsUpdate(uniforms,value){uniforms.ambientLightColor.needsUpdate=value;uniforms.directionalLightColor.needsUpdate=value;uniforms.directionalLightDirection.needsUpdate=value;uniforms.pointLightColor.needsUpdate=value;uniforms.pointLightPosition.needsUpdate=value;uniforms.pointLightDistance.needsUpdate=value;uniforms.pointLightDecay.needsUpdate=value;uniforms.spotLightColor.needsUpdate=value;uniforms.spotLightPosition.needsUpdate=value;uniforms.spotLightDistance.needsUpdate=value;uniforms.spotLightDirection.needsUpdate=value;uniforms.spotLightAngleCos.needsUpdate=value;uniforms.spotLightExponent.needsUpdate=value;uniforms.spotLightDecay.needsUpdate=value;uniforms.hemisphereLightSkyColor.needsUpdate=value;uniforms.hemisphereLightGroundColor.needsUpdate=value;uniforms.hemisphereLightDirection.needsUpdate=value}function refreshUniformsShadow(uniforms,lights){if(uniforms.shadowMatrix){var j=0;for(var i=0,il=lights.length;i<il;i++){var light=lights[i];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight||light instanceof THREE.DirectionalLight&&!light.shadowCascade){uniforms.shadowMap.value[j]=light.shadowMap;uniforms.shadowMapSize.value[j]=light.shadowMapSize;uniforms.shadowMatrix.value[j]=light.shadowMatrix;uniforms.shadowDarkness.value[j]=light.shadowDarkness;uniforms.shadowBias.value[j]=light.shadowBias;j++}}}}function loadUniformsMatrices(uniforms,object){_gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,object._modelViewMatrix.elements);if(uniforms.normalMatrix){_gl.uniformMatrix3fv(uniforms.normalMatrix,false,object._normalMatrix.elements)}}function getTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=_maxTextures){THREE.warn("WebGLRenderer: trying to use "+textureUnit+" texture units while this GPU supports only "+_maxTextures)}_usedTextureUnits+=1;return textureUnit}function loadUniformsGeneric(uniforms){var texture,textureUnit,offset;for(var j=0,jl=uniforms.length;j<jl;j++){var uniform=uniforms[j][0];if(uniform.needsUpdate===false)continue;var type=uniform.type;var value=uniform.value;var location=uniforms[j][1];switch(type){case"1i":_gl.uniform1i(location,value);break;case"1f":_gl.uniform1f(location,value);break;case"2f":_gl.uniform2f(location,value[0],value[1]);break;case"3f":_gl.uniform3f(location,value[0],value[1],value[2]);break;case"4f":_gl.uniform4f(location,value[0],value[1],value[2],value[3]);break;case"1iv":_gl.uniform1iv(location,value);break;case"3iv":_gl.uniform3iv(location,value);break;case"1fv":_gl.uniform1fv(location,value);break;case"2fv":_gl.uniform2fv(location,value);break;case"3fv":_gl.uniform3fv(location,value);break;case"4fv":_gl.uniform4fv(location,value);break;case"Matrix3fv":_gl.uniformMatrix3fv(location,false,value);break;case"Matrix4fv":_gl.uniformMatrix4fv(location,false,value);break;case"i":_gl.uniform1i(location,value);break;case"f":_gl.uniform1f(location,value);break;case"v2":_gl.uniform2f(location,value.x,value.y);break;case"v3":_gl.uniform3f(location,value.x,value.y,value.z);break;case"v4":_gl.uniform4f(location,value.x,value.y,value.z,value.w);break;case"c":_gl.uniform3f(location,value.r,value.g,value.b);break;case"iv1":_gl.uniform1iv(location,value);break;case"iv":_gl.uniform3iv(location,value);break;case"fv1":_gl.uniform1fv(location,value);break;case"fv":_gl.uniform3fv(location,value);break;case"v2v":if(uniform._array===undefined){uniform._array=new Float32Array(2*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*2;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y}_gl.uniform2fv(location,uniform._array);break;case"v3v":if(uniform._array===undefined){uniform._array=new Float32Array(3*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*3;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z}_gl.uniform3fv(location,uniform._array);break;case"v4v":if(uniform._array===undefined){uniform._array=new Float32Array(4*value.length)}for(var i=0,il=value.length;i<il;i++){offset=i*4;uniform._array[offset]=value[i].x;uniform._array[offset+1]=value[i].y;uniform._array[offset+2]=value[i].z;uniform._array[offset+3]=value[i].w}_gl.uniform4fv(location,uniform._array);break;case"m3":_gl.uniformMatrix3fv(location,false,value.elements);break;case"m3v":if(uniform._array===undefined){uniform._array=new Float32Array(9*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*9)}_gl.uniformMatrix3fv(location,false,uniform._array);break;case"m4":_gl.uniformMatrix4fv(location,false,value.elements);break;case"m4v":if(uniform._array===undefined){uniform._array=new Float32Array(16*value.length)}for(var i=0,il=value.length;i<il;i++){value[i].flattenToArrayOffset(uniform._array,i*16)}_gl.uniformMatrix4fv(location,false,uniform._array);break;case"t":texture=value;textureUnit=getTextureUnit();_gl.uniform1i(location,textureUnit);if(!texture)continue;if(texture instanceof THREE.CubeTexture||texture.image instanceof Array&&texture.image.length===6){setCubeTexture(texture,textureUnit)}else if(texture instanceof THREE.WebGLRenderTargetCube){setCubeTextureDynamic(texture,textureUnit)}else{_this.setTexture(texture,textureUnit)}break;case"tv":if(uniform._array===undefined){uniform._array=[]}for(var i=0,il=uniform.value.length;i<il;i++){uniform._array[i]=getTextureUnit()}_gl.uniform1iv(location,uniform._array);for(var i=0,il=uniform.value.length;i<il;i++){texture=uniform.value[i];textureUnit=uniform._array[i];if(!texture)continue;_this.setTexture(texture,textureUnit)}break;default:THREE.warn("THREE.WebGLRenderer: Unknown uniform type: "+type)}}}function setupMatrices(object,camera){object._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object._normalMatrix.getNormalMatrix(object._modelViewMatrix)}function setColorLinear(array,offset,color,intensity){array[offset]=color.r*intensity;array[offset+1]=color.g*intensity;array[offset+2]=color.b*intensity}function setupLights(lights){var l,ll,light,r=0,g=0,b=0,color,skyColor,groundColor,intensity,distance,zlights=_lights,dirColors=zlights.directional.colors,dirPositions=zlights.directional.positions,pointColors=zlights.point.colors,pointPositions=zlights.point.positions,pointDistances=zlights.point.distances,pointDecays=zlights.point.decays,spotColors=zlights.spot.colors,spotPositions=zlights.spot.positions,spotDistances=zlights.spot.distances,spotDirections=zlights.spot.directions,spotAnglesCos=zlights.spot.anglesCos,spotExponents=zlights.spot.exponents,spotDecays=zlights.spot.decays,hemiSkyColors=zlights.hemi.skyColors,hemiGroundColors=zlights.hemi.groundColors,hemiPositions=zlights.hemi.positions,dirLength=0,pointLength=0,spotLength=0,hemiLength=0,dirCount=0,pointCount=0,spotCount=0,hemiCount=0,dirOffset=0,pointOffset=0,spotOffset=0,hemiOffset=0;for(l=0,ll=lights.length;l<ll;l++){light=lights[l];if(light.onlyShadow)continue;color=light.color;intensity=light.intensity;distance=light.distance;if(light instanceof THREE.AmbientLight){if(!light.visible)continue;r+=color.r;g+=color.g;b+=color.b}else if(light instanceof THREE.DirectionalLight){dirCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.normalize();dirOffset=dirLength*3;dirPositions[dirOffset]=_direction.x;dirPositions[dirOffset+1]=_direction.y;dirPositions[dirOffset+2]=_direction.z;setColorLinear(dirColors,dirOffset,color,intensity);dirLength+=1}else if(light instanceof THREE.PointLight){pointCount+=1;if(!light.visible)continue;pointOffset=pointLength*3;setColorLinear(pointColors,pointOffset,color,intensity);_vector3.setFromMatrixPosition(light.matrixWorld);pointPositions[pointOffset]=_vector3.x;pointPositions[pointOffset+1]=_vector3.y;pointPositions[pointOffset+2]=_vector3.z;pointDistances[pointLength]=distance;pointDecays[pointLength]=light.distance===0?0:light.decay;pointLength+=1}else if(light instanceof THREE.SpotLight){spotCount+=1;if(!light.visible)continue;spotOffset=spotLength*3;setColorLinear(spotColors,spotOffset,color,intensity);_direction.setFromMatrixPosition(light.matrixWorld);spotPositions[spotOffset]=_direction.x;spotPositions[spotOffset+1]=_direction.y;spotPositions[spotOffset+2]=_direction.z;spotDistances[spotLength]=distance;_vector3.setFromMatrixPosition(light.target.matrixWorld);_direction.sub(_vector3);_direction.normalize();spotDirections[spotOffset]=_direction.x;spotDirections[spotOffset+1]=_direction.y;spotDirections[spotOffset+2]=_direction.z;spotAnglesCos[spotLength]=Math.cos(light.angle);spotExponents[spotLength]=light.exponent;spotDecays[spotLength]=light.distance===0?0:light.decay;spotLength+=1}else if(light instanceof THREE.HemisphereLight){hemiCount+=1;if(!light.visible)continue;_direction.setFromMatrixPosition(light.matrixWorld);_direction.normalize();hemiOffset=hemiLength*3;hemiPositions[hemiOffset]=_direction.x;hemiPositions[hemiOffset+1]=_direction.y;hemiPositions[hemiOffset+2]=_direction.z;skyColor=light.color;groundColor=light.groundColor;setColorLinear(hemiSkyColors,hemiOffset,skyColor,intensity);setColorLinear(hemiGroundColors,hemiOffset,groundColor,intensity);hemiLength+=1}}for(l=dirLength*3,ll=Math.max(dirColors.length,dirCount*3);l<ll;l++)dirColors[l]=0;for(l=pointLength*3,ll=Math.max(pointColors.length,pointCount*3);l<ll;l++)pointColors[l]=0;for(l=spotLength*3,ll=Math.max(spotColors.length,spotCount*3);l<ll;l++)spotColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiSkyColors.length,hemiCount*3);l<ll;l++)hemiSkyColors[l]=0;for(l=hemiLength*3,ll=Math.max(hemiGroundColors.length,hemiCount*3);l<ll;l++)hemiGroundColors[l]=0;zlights.directional.length=dirLength;zlights.point.length=pointLength;zlights.spot.length=spotLength;zlights.hemi.length=hemiLength;zlights.ambient[0]=r;zlights.ambient[1]=g;zlights.ambient[2]=b}this.setFaceCulling=function(cullFace,frontFaceDirection){if(cullFace===THREE.CullFaceNone){_gl.disable(_gl.CULL_FACE)}else{if(frontFaceDirection===THREE.FrontFaceDirectionCW){_gl.frontFace(_gl.CW)}else{_gl.frontFace(_gl.CCW)}if(cullFace===THREE.CullFaceBack){_gl.cullFace(_gl.BACK)}else if(cullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.FRONT_AND_BACK)}_gl.enable(_gl.CULL_FACE)}};this.setMaterialFaces=function(material){state.setDoubleSided(material.side===THREE.DoubleSide);state.setFlipSided(material.side===THREE.BackSide)};function setTextureParameters(textureType,texture,isImagePowerOfTwo){var extension;if(isImagePowerOfTwo){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,paramThreeToGL(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,paramThreeToGL(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,paramThreeToGL(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,paramThreeToGL(texture.minFilter))}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);if(texture.wrapS!==THREE.ClampToEdgeWrapping||texture.wrapT!==THREE.ClampToEdgeWrapping){THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+texture.sourceFile+" )")}_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter));if(texture.minFilter!==THREE.NearestFilter&&texture.minFilter!==THREE.LinearFilter){THREE.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+texture.sourceFile+" )")}}extension=extensions.get("EXT_texture_filter_anisotropic");if(extension&&texture.type!==THREE.FloatType&&texture.type!==THREE.HalfFloatType){if(texture.anisotropy>1||texture.__currentAnisotropy){_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(texture.anisotropy,_this.getMaxAnisotropy()));texture.__currentAnisotropy=texture.anisotropy}}}this.uploadTexture=function(texture){if(texture.__webglInit===undefined){texture.__webglInit=true;texture.addEventListener("dispose",onTextureDispose);texture.__webglTexture=_gl.createTexture();_this.info.memory.textures++}_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);texture.image=clampToMaxSize(texture.image,_maxTextureSize);var image=texture.image,isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isImagePowerOfTwo);var mipmap,mipmaps=texture.mipmaps;if(texture instanceof THREE.DataTexture){if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}texture.generateMipmaps=false}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data)}}else if(texture instanceof THREE.CompressedTexture){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(getCompressedTextureFormats().indexOf(glFormat)>-1){_gl.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}else{if(mipmaps.length>0&&isImagePowerOfTwo){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];_gl.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap)}texture.generateMipmaps=false}else{_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,texture.image)}}if(texture.generateMipmaps&&isImagePowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D);texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate()};this.setTexture=function(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);if(texture.needsUpdate){_this.uploadTexture(texture)}else{_gl.bindTexture(_gl.TEXTURE_2D,texture.__webglTexture)}};function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){var scale=maxSize/Math.max(image.width,image.height);var canvas=document.createElement("canvas");canvas.width=Math.floor(image.width*scale);canvas.height=Math.floor(image.height*scale);var context=canvas.getContext("2d");context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);THREE.warn("THREE.WebGLRenderer: image is too big ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height,image);return canvas}return image}function setCubeTexture(texture,slot){if(texture.image.length===6){if(texture.needsUpdate){if(!texture.image.__webglTextureCube){texture.addEventListener("dispose",onTextureDispose);texture.image.__webglTextureCube=_gl.createTexture();_this.info.memory.textures++}_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);var isCompressed=texture instanceof THREE.CompressedTexture;var isDataTexture=texture.image[0]instanceof THREE.DataTexture;var cubeImage=[];for(var i=0;i<6;i++){if(_this.autoScaleCubemaps&&!isCompressed&&!isDataTexture){cubeImage[i]=clampToMaxSize(texture.image[i],_maxCubemapSize)}else{cubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i]}}var image=cubeImage[0],isImagePowerOfTwo=THREE.Math.isPowerOfTwo(image.width)&&THREE.Math.isPowerOfTwo(image.height),glFormat=paramThreeToGL(texture.format),glType=paramThreeToGL(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isImagePowerOfTwo);for(var i=0;i<6;i++){if(!isCompressed){if(isDataTexture){_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data)}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i])}}else{var mipmap,mipmaps=cubeImage[i].mipmaps;for(var j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];if(texture.format!==THREE.RGBAFormat&&texture.format!==THREE.RGBFormat){if(getCompressedTextureFormats().indexOf(glFormat)>-1){_gl.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{THREE.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setCubeTexture()")}}else{_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}}if(texture.generateMipmaps&&isImagePowerOfTwo){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}texture.needsUpdate=false;if(texture.onUpdate)texture.onUpdate()}else{_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.image.__webglTextureCube)}}}function setCubeTextureDynamic(texture,slot){_gl.activeTexture(_gl.TEXTURE0+slot);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,texture.__webglTexture)}function setupFrameBuffer(framebuffer,renderTarget,textureTarget){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,textureTarget,renderTarget.__webglTexture,0)}function setupRenderBuffer(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else{_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height)}}this.setRenderTarget=function(renderTarget){var isCube=renderTarget instanceof THREE.WebGLRenderTargetCube;if(renderTarget&&renderTarget.__webglFramebuffer===undefined){if(renderTarget.depthBuffer===undefined)renderTarget.depthBuffer=true;if(renderTarget.stencilBuffer===undefined)renderTarget.stencilBuffer=true;renderTarget.addEventListener("dispose",onRenderTargetDispose);renderTarget.__webglTexture=_gl.createTexture();_this.info.memory.textures++;var isTargetPowerOfTwo=THREE.Math.isPowerOfTwo(renderTarget.width)&&THREE.Math.isPowerOfTwo(renderTarget.height),glFormat=paramThreeToGL(renderTarget.format),glType=paramThreeToGL(renderTarget.type);if(isCube){renderTarget.__webglFramebuffer=[];renderTarget.__webglRenderbuffer=[];_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget,isTargetPowerOfTwo);for(var i=0;i<6;i++){renderTarget.__webglFramebuffer[i]=_gl.createFramebuffer();renderTarget.__webglRenderbuffer[i]=_gl.createRenderbuffer();_gl.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer[i],renderTarget,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i);setupRenderBuffer(renderTarget.__webglRenderbuffer[i],renderTarget)}if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}else{renderTarget.__webglFramebuffer=_gl.createFramebuffer();if(renderTarget.shareDepthFrom){renderTarget.__webglRenderbuffer=renderTarget.shareDepthFrom.__webglRenderbuffer}else{renderTarget.__webglRenderbuffer=_gl.createRenderbuffer()}_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget,isTargetPowerOfTwo);_gl.texImage2D(_gl.TEXTURE_2D,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);setupFrameBuffer(renderTarget.__webglFramebuffer,renderTarget,_gl.TEXTURE_2D);if(renderTarget.shareDepthFrom){if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderTarget.__webglRenderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderTarget.__webglRenderbuffer)}}else{setupRenderBuffer(renderTarget.__webglRenderbuffer,renderTarget)}if(isTargetPowerOfTwo)_gl.generateMipmap(_gl.TEXTURE_2D)}if(isCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{_gl.bindTexture(_gl.TEXTURE_2D,null)}_gl.bindRenderbuffer(_gl.RENDERBUFFER,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}var framebuffer,width,height,vx,vy;if(renderTarget){if(isCube){framebuffer=renderTarget.__webglFramebuffer[renderTarget.activeCubeFace]}else{framebuffer=renderTarget.__webglFramebuffer}width=renderTarget.width;height=renderTarget.height;vx=0;vy=0}else{framebuffer=null;width=_viewportWidth;height=_viewportHeight;vx=_viewportX;vy=_viewportY}if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.viewport(vx,vy,width,height);_currentFramebuffer=framebuffer}_currentWidth=width;_currentHeight=height};this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(!(renderTarget instanceof THREE.WebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}if(renderTarget.__webglFramebuffer){if(renderTarget.format!==THREE.RGBAFormat){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA format. readPixels can read only RGBA format.");return}var restore=false;if(renderTarget.__webglFramebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTarget.__webglFramebuffer);restore=true}if(_gl.checkFramebufferStatus(_gl.FRAMEBUFFER)===_gl.FRAMEBUFFER_COMPLETE){_gl.readPixels(x,y,width,height,_gl.RGBA,_gl.UNSIGNED_BYTE,buffer)}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}if(restore){_gl.bindFramebuffer(_gl.FRAMEBUFFER,_currentFramebuffer)}}};function updateRenderTargetMipmap(renderTarget){if(renderTarget instanceof THREE.WebGLRenderTargetCube){_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);_gl.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{_gl.bindTexture(_gl.TEXTURE_2D,renderTarget.__webglTexture);_gl.generateMipmap(_gl.TEXTURE_2D);_gl.bindTexture(_gl.TEXTURE_2D,null)}}function filterFallback(f){if(f===THREE.NearestFilter||f===THREE.NearestMipMapNearestFilter||f===THREE.NearestMipMapLinearFilter){return _gl.NEAREST}return _gl.LINEAR}function paramThreeToGL(p){var extension;if(p===THREE.RepeatWrapping)return _gl.REPEAT;if(p===THREE.ClampToEdgeWrapping)return _gl.CLAMP_TO_EDGE;if(p===THREE.MirroredRepeatWrapping)return _gl.MIRRORED_REPEAT;if(p===THREE.NearestFilter)return _gl.NEAREST;if(p===THREE.NearestMipMapNearestFilter)return _gl.NEAREST_MIPMAP_NEAREST;if(p===THREE.NearestMipMapLinearFilter)return _gl.NEAREST_MIPMAP_LINEAR;if(p===THREE.LinearFilter)return _gl.LINEAR;if(p===THREE.LinearMipMapNearestFilter)return _gl.LINEAR_MIPMAP_NEAREST;if(p===THREE.LinearMipMapLinearFilter)return _gl.LINEAR_MIPMAP_LINEAR;if(p===THREE.UnsignedByteType)return _gl.UNSIGNED_BYTE;if(p===THREE.UnsignedShort4444Type)return _gl.UNSIGNED_SHORT_4_4_4_4;if(p===THREE.UnsignedShort5551Type)return _gl.UNSIGNED_SHORT_5_5_5_1;if(p===THREE.UnsignedShort565Type)return _gl.UNSIGNED_SHORT_5_6_5;if(p===THREE.ByteType)return _gl.BYTE;if(p===THREE.ShortType)return _gl.SHORT;if(p===THREE.UnsignedShortType)return _gl.UNSIGNED_SHORT;if(p===THREE.IntType)return _gl.INT;if(p===THREE.UnsignedIntType)return _gl.UNSIGNED_INT;if(p===THREE.FloatType)return _gl.FLOAT;extension=extensions.get("OES_texture_half_float");if(extension!==null){if(p===THREE.HalfFloatType)return extension.HALF_FLOAT_OES}if(p===THREE.AlphaFormat)return _gl.ALPHA;if(p===THREE.RGBFormat)return _gl.RGB;if(p===THREE.RGBAFormat)return _gl.RGBA;if(p===THREE.LuminanceFormat)return _gl.LUMINANCE;if(p===THREE.LuminanceAlphaFormat)return _gl.LUMINANCE_ALPHA;if(p===THREE.AddEquation)return _gl.FUNC_ADD;if(p===THREE.SubtractEquation)return _gl.FUNC_SUBTRACT;if(p===THREE.ReverseSubtractEquation)return _gl.FUNC_REVERSE_SUBTRACT;if(p===THREE.ZeroFactor)return _gl.ZERO;if(p===THREE.OneFactor)return _gl.ONE;if(p===THREE.SrcColorFactor)return _gl.SRC_COLOR;if(p===THREE.OneMinusSrcColorFactor)return _gl.ONE_MINUS_SRC_COLOR;if(p===THREE.SrcAlphaFactor)return _gl.SRC_ALPHA;if(p===THREE.OneMinusSrcAlphaFactor)return _gl.ONE_MINUS_SRC_ALPHA;if(p===THREE.DstAlphaFactor)return _gl.DST_ALPHA;if(p===THREE.OneMinusDstAlphaFactor)return _gl.ONE_MINUS_DST_ALPHA;if(p===THREE.DstColorFactor)return _gl.DST_COLOR;if(p===THREE.OneMinusDstColorFactor)return _gl.ONE_MINUS_DST_COLOR;if(p===THREE.SrcAlphaSaturateFactor)return _gl.SRC_ALPHA_SATURATE;extension=extensions.get("WEBGL_compressed_texture_s3tc");if(extension!==null){if(p===THREE.RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===THREE.RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===THREE.RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}extension=extensions.get("WEBGL_compressed_texture_pvrtc");if(extension!==null){if(p===THREE.RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===THREE.RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===THREE.RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===THREE.RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}extension=extensions.get("EXT_blend_minmax");if(extension!==null){if(p===THREE.MinEquation)return extension.MIN_EXT;if(p===THREE.MaxEquation)return extension.MAX_EXT}return 0}function allocateBones(object){if(_supportsBoneTextures&&object&&object.skeleton&&object.skeleton.useVertexTexture){return 1024}else{var nVertexUniforms=_gl.getParameter(_gl.MAX_VERTEX_UNIFORM_VECTORS);var nVertexMatrices=Math.floor((nVertexUniforms-20)/4);var maxBones=nVertexMatrices;if(object!==undefined&&object instanceof THREE.SkinnedMesh){maxBones=Math.min(object.skeleton.bones.length,maxBones);if(maxBones<object.skeleton.bones.length){THREE.warn("WebGLRenderer: too many bones - "+object.skeleton.bones.length+", this GPU supports just "+maxBones+" (try OpenGL instead of ANGLE)")}}return maxBones}}function allocateLights(lights){var dirLights=0;var pointLights=0;var spotLights=0;var hemiLights=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(light.onlyShadow||light.visible===false)continue;if(light instanceof THREE.DirectionalLight)dirLights++;if(light instanceof THREE.PointLight)pointLights++;if(light instanceof THREE.SpotLight)spotLights++;if(light instanceof THREE.HemisphereLight)hemiLights++}return{directional:dirLights,point:pointLights,spot:spotLights,hemi:hemiLights}}function allocateShadows(lights){var maxShadows=0;for(var l=0,ll=lights.length;l<ll;l++){var light=lights[l];if(!light.castShadow)continue;if(light instanceof THREE.SpotLight)maxShadows++;if(light instanceof THREE.DirectionalLight&&!light.shadowCascade)maxShadows++}return maxShadows}this.initMaterial=function(){THREE.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};this.addPrePlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};this.addPostPlugin=function(){THREE.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};this.updateShadowMap=function(){THREE.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}};THREE.WebGLRenderTarget=function(width,height,options){this.width=width;this.height=height;options=options||{};this.wrapS=options.wrapS!==undefined?options.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=options.wrapT!==undefined?options.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=options.magFilter!==undefined?options.magFilter:THREE.LinearFilter;this.minFilter=options.minFilter!==undefined?options.minFilter:THREE.LinearMipMapLinearFilter;this.anisotropy=options.anisotropy!==undefined?options.anisotropy:1;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=options.format!==undefined?options.format:THREE.RGBAFormat;this.type=options.type!==undefined?options.type:THREE.UnsignedByteType;this.depthBuffer=options.depthBuffer!==undefined?options.depthBuffer:true;this.stencilBuffer=options.stencilBuffer!==undefined?options.stencilBuffer:true;this.generateMipmaps=true;this.shareDepthFrom=options.shareDepthFrom!==undefined?options.shareDepthFrom:null};THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,setSize:function(width,height){if(this.width!==width||this.height!==height){this.width=width;this.height=height;this.dispose()}},clone:function(){var tmp=new THREE.WebGLRenderTarget(this.width,this.height);tmp.wrapS=this.wrapS;tmp.wrapT=this.wrapT;tmp.magFilter=this.magFilter;tmp.minFilter=this.minFilter;tmp.anisotropy=this.anisotropy;tmp.offset.copy(this.offset);tmp.repeat.copy(this.repeat);tmp.format=this.format;tmp.type=this.type;tmp.depthBuffer=this.depthBuffer;tmp.stencilBuffer=this.stencilBuffer;tmp.generateMipmaps=this.generateMipmaps;tmp.shareDepthFrom=this.shareDepthFrom;return tmp},dispose:function(){this.dispatchEvent({type:"dispose"})}};THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube=function(width,height,options){THREE.WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype);THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.WebGLExtensions=function(gl){var extensions={};this.get=function(name){if(extensions[name]!==undefined){return extensions[name]}var extension;switch(name){case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:extension=gl.getExtension(name)}if(extension===null){THREE.warn("THREE.WebGLRenderer: "+name+" extension not supported.")}extensions[name]=extension;return extension}};THREE.WebGLProgram=function(){var programIdCount=0;var generateDefines=function(defines){var value,chunk,chunks=[];for(var d in defines){value=defines[d];if(value===false)continue;chunk="#define "+d+" "+value;chunks.push(chunk)}return chunks.join("\n")};var cacheUniformLocations=function(gl,program,identifiers){var uniforms={};for(var i=0,l=identifiers.length;i<l;i++){var id=identifiers[i];uniforms[id]=gl.getUniformLocation(program,id)}return uniforms};var cacheAttributeLocations=function(gl,program,identifiers){var attributes={};for(var i=0,l=identifiers.length;i<l;i++){var id=identifiers[i];attributes[id]=gl.getAttribLocation(program,id)}return attributes};return function(renderer,code,material,parameters){var _this=renderer;var _gl=_this.context;var defines=material.defines;var uniforms=material.__webglShader.uniforms;var attributes=material.attributes;var vertexShader=material.__webglShader.vertexShader;var fragmentShader=material.__webglShader.fragmentShader;var index0AttributeName=material.index0AttributeName;if(index0AttributeName===undefined&&parameters.morphTargets===true){index0AttributeName="position"}var shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";if(parameters.shadowMapType===THREE.PCFShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF"}else if(parameters.shadowMapType===THREE.PCFSoftShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"}var envMapTypeDefine="ENVMAP_TYPE_CUBE";var envMapModeDefine="ENVMAP_MODE_REFLECTION";var envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";if(parameters.envMap){switch(material.envMap.mapping){case THREE.CubeReflectionMapping:case THREE.CubeRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE";break;case THREE.EquirectangularReflectionMapping:case THREE.EquirectangularRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_EQUIREC";break;case THREE.SphericalReflectionMapping:envMapTypeDefine="ENVMAP_TYPE_SPHERE";break}switch(material.envMap.mapping){case THREE.CubeRefractionMapping:case THREE.EquirectangularRefractionMapping:envMapModeDefine="ENVMAP_MODE_REFRACTION";break}switch(material.combine){case THREE.MultiplyOperation:envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";break;case THREE.MixOperation:envMapBlendingDefine="ENVMAP_BLENDING_MIX";break;case THREE.AddOperation:envMapBlendingDefine="ENVMAP_BLENDING_ADD";break}}var gammaFactorDefine=renderer.gammaFactor>0?renderer.gammaFactor:1;var customDefines=generateDefines(defines);var program=_gl.createProgram();var prefix_vertex,prefix_fragment;if(material instanceof THREE.RawShaderMaterial){prefix_vertex="";prefix_fragment=""}else{prefix_vertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;",customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+gammaFactorDefine,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,"#define MAX_BONES "+parameters.maxBones,parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals?"#define USE_MORPHNORMALS":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif",""].join("\n");prefix_fragment=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;",parameters.bumpMap||parameters.normalMap||parameters.flatShading?"#extension GL_OES_standard_derivatives : enable":"",customDefines,"#define MAX_DIR_LIGHTS "+parameters.maxDirLights,"#define MAX_POINT_LIGHTS "+parameters.maxPointLights,"#define MAX_SPOT_LIGHTS "+parameters.maxSpotLights,"#define MAX_HEMI_LIGHTS "+parameters.maxHemiLights,"#define MAX_SHADOWS "+parameters.maxShadows,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"",_this.gammaInput?"#define GAMMA_INPUT":"",_this.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+gammaFactorDefine,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapTypeDefine:"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.envMap?"#define "+envMapBlendingDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.metal?"#define METAL":"",parameters.wrapAround?"#define WRAP_AROUND":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",parameters.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n")}var glVertexShader=new THREE.WebGLShader(_gl,_gl.VERTEX_SHADER,prefix_vertex+vertexShader);var glFragmentShader=new THREE.WebGLShader(_gl,_gl.FRAGMENT_SHADER,prefix_fragment+fragmentShader);_gl.attachShader(program,glVertexShader);_gl.attachShader(program,glFragmentShader);if(index0AttributeName!==undefined){_gl.bindAttribLocation(program,0,index0AttributeName)}_gl.linkProgram(program);var programLogInfo=_gl.getProgramInfoLog(program);if(_gl.getProgramParameter(program,_gl.LINK_STATUS)===false){THREE.error("THREE.WebGLProgram: shader error: "+_gl.getError(),"gl.VALIDATE_STATUS",_gl.getProgramParameter(program,_gl.VALIDATE_STATUS),"gl.getPRogramInfoLog",programLogInfo)}if(programLogInfo!==""){}_gl.deleteShader(glVertexShader);_gl.deleteShader(glFragmentShader);var identifiers=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences","bindMatrix","bindMatrixInverse"];if(parameters.useVertexTexture){identifiers.push("boneTexture");identifiers.push("boneTextureWidth");identifiers.push("boneTextureHeight")}else{identifiers.push("boneGlobalMatrices")}if(parameters.logarithmicDepthBuffer){identifiers.push("logDepthBufFC")}for(var u in uniforms){identifiers.push(u)}this.uniforms=cacheUniformLocations(_gl,program,identifiers);identifiers=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"];for(var i=0;i<parameters.maxMorphTargets;i++){identifiers.push("morphTarget"+i)}for(var i=0;i<parameters.maxMorphNormals;i++){identifiers.push("morphNormal"+i)}for(var a in attributes){identifiers.push(a)}this.attributes=cacheAttributeLocations(_gl,program,identifiers);this.attributesKeys=Object.keys(this.attributes);this.id=programIdCount++;this.code=code;this.usedTimes=1;this.program=program;this.vertexShader=glVertexShader;this.fragmentShader=glFragmentShader;return this}}();THREE.WebGLShader=function(){var addLineNumbers=function(string){var lines=string.split("\n");for(var i=0;i<lines.length;i++){lines[i]=i+1+": "+lines[i]}return lines.join("\n")};return function(gl,type,string){var shader=gl.createShader(type);gl.shaderSource(shader,string);gl.compileShader(shader);if(gl.getShaderParameter(shader,gl.COMPILE_STATUS)===false){THREE.error("THREE.WebGLShader: Shader couldn't compile.")}return shader}}();THREE.WebGLState=function(gl,paramThreeToGL){var newAttributes=new Uint8Array(16);var enabledAttributes=new Uint8Array(16);var currentBlending=null;var currentBlendEquation=null;var currentBlendSrc=null;var currentBlendDst=null;var currentBlendEquationAlpha=null;var currentBlendSrcAlpha=null;var currentBlendDstAlpha=null;var currentDepthTest=null;var currentDepthWrite=null;var currentColorWrite=null;var currentDoubleSided=null;var currentFlipSided=null;var currentLineWidth=null;var currentPolygonOffset=null;var currentPolygonOffsetFactor=null;var currentPolygonOffsetUnits=null;this.initAttributes=function(){for(var i=0,l=newAttributes.length;i<l;i++){newAttributes[i]=0}};this.enableAttribute=function(attribute){newAttributes[attribute]=1;if(enabledAttributes[attribute]===0){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1}};this.disableUnusedAttributes=function(){for(var i=0,l=enabledAttributes.length;i<l;i++){if(enabledAttributes[i]!==newAttributes[i]){gl.disableVertexAttribArray(i);enabledAttributes[i]=0}}};this.setBlending=function(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha){if(blending!==currentBlending){if(blending===THREE.NoBlending){gl.disable(gl.BLEND)}else if(blending===THREE.AdditiveBlending){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE)}else if(blending===THREE.SubtractiveBlending){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR)}else if(blending===THREE.MultiplyBlending){gl.enable(gl.BLEND);gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.SRC_COLOR)}else if(blending===THREE.CustomBlending){gl.enable(gl.BLEND)}else{gl.enable(gl.BLEND);gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}currentBlending=blending}if(blending===THREE.CustomBlending){blendEquationAlpha=blendEquationAlpha||blendEquation;blendSrcAlpha=blendSrcAlpha||blendSrc;blendDstAlpha=blendDstAlpha||blendDst;if(blendEquation!==currentBlendEquation||blendEquationAlpha!==currentBlendEquationAlpha){gl.blendEquationSeparate(paramThreeToGL(blendEquation),paramThreeToGL(blendEquationAlpha));currentBlendEquation=blendEquation;currentBlendEquationAlpha=blendEquationAlpha}if(blendSrc!==currentBlendSrc||blendDst!==currentBlendDst||blendSrcAlpha!==currentBlendSrcAlpha||blendDstAlpha!==currentBlendDstAlpha){gl.blendFuncSeparate(paramThreeToGL(blendSrc),paramThreeToGL(blendDst),paramThreeToGL(blendSrcAlpha),paramThreeToGL(blendDstAlpha));currentBlendSrc=blendSrc;currentBlendDst=blendDst;currentBlendSrcAlpha=blendSrcAlpha;currentBlendDstAlpha=blendDstAlpha}}else{currentBlendEquation=null;currentBlendSrc=null;currentBlendDst=null;currentBlendEquationAlpha=null;currentBlendSrcAlpha=null;currentBlendDstAlpha=null}};this.setDepthTest=function(depthTest){if(currentDepthTest!==depthTest){if(depthTest){gl.enable(gl.DEPTH_TEST)}else{gl.disable(gl.DEPTH_TEST)}currentDepthTest=depthTest}};this.setDepthWrite=function(depthWrite){if(currentDepthWrite!==depthWrite){gl.depthMask(depthWrite);currentDepthWrite=depthWrite}};this.setColorWrite=function(colorWrite){if(currentColorWrite!==colorWrite){gl.colorMask(colorWrite,colorWrite,colorWrite,colorWrite);currentColorWrite=colorWrite}};this.setDoubleSided=function(doubleSided){if(currentDoubleSided!==doubleSided){if(doubleSided){gl.disable(gl.CULL_FACE)}else{gl.enable(gl.CULL_FACE)}currentDoubleSided=doubleSided}};this.setFlipSided=function(flipSided){if(currentFlipSided!==flipSided){if(flipSided){gl.frontFace(gl.CW)}else{gl.frontFace(gl.CCW)}currentFlipSided=flipSided}};this.setLineWidth=function(width){if(width!==currentLineWidth){gl.lineWidth(width);currentLineWidth=width}};this.setPolygonOffset=function(polygonoffset,factor,units){if(currentPolygonOffset!==polygonoffset){if(polygonoffset){gl.enable(gl.POLYGON_OFFSET_FILL)}else{gl.disable(gl.POLYGON_OFFSET_FILL)}currentPolygonOffset=polygonoffset}if(polygonoffset&&(currentPolygonOffsetFactor!==factor||currentPolygonOffsetUnits!==units)){gl.polygonOffset(factor,units);currentPolygonOffsetFactor=factor;currentPolygonOffsetUnits=units}};this.reset=function(){for(var i=0;i<enabledAttributes.length;i++){enabledAttributes[i]=0}currentBlending=null;currentDepthTest=null;currentDepthWrite=null;currentColorWrite=null;currentDoubleSided=null;currentFlipSided=null}};THREE.LensFlarePlugin=function(renderer,flares){var gl=renderer.context;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var hasVertexTexture;var tempTexture,occlusionTexture;var init=function(){var vertices=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);tempTexture=gl.createTexture();occlusionTexture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGB,16,16,0,gl.RGB,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,16,16,0,gl.RGBA,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);hasVertexTexture=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)>0;var shader;if(hasVertexTexture){shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}else{shader={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}}program=createProgram(shader);attributes={vertex:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={renderType:gl.getUniformLocation(program,"renderType"),map:gl.getUniformLocation(program,"map"),occlusionMap:gl.getUniformLocation(program,"occlusionMap"),opacity:gl.getUniformLocation(program,"opacity"),color:gl.getUniformLocation(program,"color"),scale:gl.getUniformLocation(program,"scale"),rotation:gl.getUniformLocation(program,"rotation"),screenPosition:gl.getUniformLocation(program,"screenPosition")}};this.render=function(scene,camera,viewportWidth,viewportHeight){if(flares.length===0)return;var tempPosition=new THREE.Vector3;var invAspect=viewportHeight/viewportWidth,halfViewportWidth=viewportWidth*.5,halfViewportHeight=viewportHeight*.5;var size=16/viewportHeight,scale=new THREE.Vector2(size*invAspect,size);var screenPosition=new THREE.Vector3(1,1,0),screenPositionPixels=new THREE.Vector2(1,1);if(program===undefined){init()}gl.useProgram(program);gl.enableVertexAttribArray(attributes.vertex);gl.enableVertexAttribArray(attributes.uv);gl.uniform1i(uniforms.occlusionMap,0);gl.uniform1i(uniforms.map,1);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.vertex,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.disable(gl.CULL_FACE);gl.depthMask(false);for(var i=0,l=flares.length;i<l;i++){size=16/viewportHeight;scale.set(size*invAspect,size);var flare=flares[i];tempPosition.set(flare.matrixWorld.elements[12],flare.matrixWorld.elements[13],flare.matrixWorld.elements[14]);tempPosition.applyMatrix4(camera.matrixWorldInverse);tempPosition.applyProjection(camera.projectionMatrix);screenPosition.copy(tempPosition);screenPositionPixels.x=screenPosition.x*halfViewportWidth+halfViewportWidth;screenPositionPixels.y=screenPosition.y*halfViewportHeight+halfViewportHeight;if(hasVertexTexture||screenPositionPixels.x>0&&screenPositionPixels.x<viewportWidth&&screenPositionPixels.y>0&&screenPositionPixels.y<viewportHeight){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGB,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,0);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.disable(gl.BLEND);gl.enable(gl.DEPTH_TEST);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,occlusionTexture);gl.copyTexImage2D(gl.TEXTURE_2D,0,gl.RGBA,screenPositionPixels.x-8,screenPositionPixels.y-8,16,16,0);gl.uniform1i(uniforms.renderType,1);gl.disable(gl.DEPTH_TEST);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,tempTexture);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);flare.positionScreen.copy(screenPosition);if(flare.customUpdateCallback){flare.customUpdateCallback(flare)}else{flare.updateLensFlares()}gl.uniform1i(uniforms.renderType,2);gl.enable(gl.BLEND);for(var j=0,jl=flare.lensFlares.length;j<jl;j++){var sprite=flare.lensFlares[j];if(sprite.opacity>.001&&sprite.scale>.001){screenPosition.x=sprite.x;screenPosition.y=sprite.y;screenPosition.z=sprite.z;size=sprite.size*sprite.scale/viewportHeight;scale.x=size*invAspect;scale.y=size;gl.uniform3f(uniforms.screenPosition,screenPosition.x,screenPosition.y,screenPosition.z);gl.uniform2f(uniforms.scale,scale.x,scale.y);gl.uniform1f(uniforms.rotation,sprite.rotation);gl.uniform1f(uniforms.opacity,sprite.opacity);gl.uniform3f(uniforms.color,sprite.color.r,sprite.color.g,sprite.color.b);renderer.state.setBlending(sprite.blending,sprite.blendEquation,sprite.blendSrc,sprite.blendDst);renderer.setTexture(sprite.texture,1);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}}}}gl.enable(gl.CULL_FACE);gl.enable(gl.DEPTH_TEST);gl.depthMask(true);renderer.resetGLState()};function createProgram(shader){var program=gl.createProgram();var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);var vertexShader=gl.createShader(gl.VERTEX_SHADER);var prefix="precision "+renderer.getPrecision()+" float;\n";gl.shaderSource(fragmentShader,prefix+shader.fragmentShader);gl.shaderSource(vertexShader,prefix+shader.vertexShader);gl.compileShader(fragmentShader);gl.compileShader(vertexShader);gl.attachShader(program,fragmentShader);gl.attachShader(program,vertexShader);gl.linkProgram(program);return program}};THREE.ShadowMapPlugin=function(_renderer,_lights,_webglObjects,_webglObjectsImmediate){var _gl=_renderer.context;var _depthMaterial,_depthMaterialMorph,_depthMaterialSkin,_depthMaterialMorphSkin,_frustum=new THREE.Frustum,_projScreenMatrix=new THREE.Matrix4,_min=new THREE.Vector3,_max=new THREE.Vector3,_matrixPosition=new THREE.Vector3,_renderList=[];var depthShader=THREE.ShaderLib["depthRGBA"];var depthUniforms=THREE.UniformsUtils.clone(depthShader.uniforms);_depthMaterial=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader});_depthMaterialMorph=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true});_depthMaterialSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,skinning:true});_depthMaterialMorphSkin=new THREE.ShaderMaterial({uniforms:depthUniforms,vertexShader:depthShader.vertexShader,fragmentShader:depthShader.fragmentShader,morphTargets:true,skinning:true});_depthMaterial._shadowPass=true;_depthMaterialMorph._shadowPass=true;_depthMaterialSkin._shadowPass=true;_depthMaterialMorphSkin._shadowPass=true;this.render=function(scene,camera){if(_renderer.shadowMapEnabled===false)return;var i,il,j,jl,n,shadowMap,shadowMatrix,shadowCamera,buffer,material,webglObject,object,light,lights=[],k=0,fog=null;_gl.clearColor(1,1,1,1);_gl.disable(_gl.BLEND);_gl.enable(_gl.CULL_FACE);_gl.frontFace(_gl.CCW);if(_renderer.shadowMapCullFace===THREE.CullFaceFront){_gl.cullFace(_gl.FRONT)}else{_gl.cullFace(_gl.BACK)}_renderer.state.setDepthTest(true);for(i=0,il=_lights.length;i<il;i++){light=_lights[i];if(!light.castShadow)continue;if(light instanceof THREE.DirectionalLight&&light.shadowCascade){for(n=0;n<light.shadowCascadeCount;n++){var virtualLight;if(!light.shadowCascadeArray[n]){virtualLight=createVirtualLight(light,n);virtualLight.originalCamera=camera;var gyro=new THREE.Gyroscope;gyro.position.copy(light.shadowCascadeOffset);gyro.add(virtualLight);gyro.add(virtualLight.target);camera.add(gyro);light.shadowCascadeArray[n]=virtualLight}else{virtualLight=light.shadowCascadeArray[n]}updateVirtualLight(light,n);lights[k]=virtualLight;k++}}else{lights[k]=light;k++}}for(i=0,il=lights.length;i<il;i++){light=lights[i];if(!light.shadowMap){var shadowFilter=THREE.LinearFilter;if(_renderer.shadowMapType===THREE.PCFSoftShadowMap){shadowFilter=THREE.NearestFilter}var pars={minFilter:shadowFilter,magFilter:shadowFilter,format:THREE.RGBAFormat};light.shadowMap=new THREE.WebGLRenderTarget(light.shadowMapWidth,light.shadowMapHeight,pars);light.shadowMapSize=new THREE.Vector2(light.shadowMapWidth,light.shadowMapHeight);light.shadowMatrix=new THREE.Matrix4}if(!light.shadowCamera){if(light instanceof THREE.SpotLight){light.shadowCamera=new THREE.PerspectiveCamera(light.shadowCameraFov,light.shadowMapWidth/light.shadowMapHeight,light.shadowCameraNear,light.shadowCameraFar)}else if(light instanceof THREE.DirectionalLight){light.shadowCamera=new THREE.OrthographicCamera(light.shadowCameraLeft,light.shadowCameraRight,light.shadowCameraTop,light.shadowCameraBottom,light.shadowCameraNear,light.shadowCameraFar)}else{THREE.error("THREE.ShadowMapPlugin: Unsupported light type for shadow",light);continue}scene.add(light.shadowCamera);if(scene.autoUpdate===true)scene.updateMatrixWorld()}if(light.shadowCameraVisible&&!light.cameraHelper){light.cameraHelper=new THREE.CameraHelper(light.shadowCamera);scene.add(light.cameraHelper)}if(light.isVirtual&&virtualLight.originalCamera==camera){updateShadowCamera(camera,light)}shadowMap=light.shadowMap;shadowMatrix=light.shadowMatrix;shadowCamera=light.shadowCamera;shadowCamera.position.setFromMatrixPosition(light.matrixWorld);_matrixPosition.setFromMatrixPosition(light.target.matrixWorld);shadowCamera.lookAt(_matrixPosition);shadowCamera.updateMatrixWorld();shadowCamera.matrixWorldInverse.getInverse(shadowCamera.matrixWorld);if(light.cameraHelper)light.cameraHelper.visible=light.shadowCameraVisible;if(light.shadowCameraVisible)light.cameraHelper.update();shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);shadowMatrix.multiply(shadowCamera.projectionMatrix);shadowMatrix.multiply(shadowCamera.matrixWorldInverse);_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_renderer.setRenderTarget(shadowMap);_renderer.clear();_renderList.length=0;projectObject(scene,scene,shadowCamera);var objectMaterial,useMorphing,useSkinning;for(j=0,jl=_renderList.length;j<jl;j++){webglObject=_renderList[j];object=webglObject.object;buffer=webglObject.buffer;objectMaterial=getObjectMaterial(object);useMorphing=object.geometry.morphTargets!==undefined&&object.geometry.morphTargets.length>0&&objectMaterial.morphTargets;useSkinning=object instanceof THREE.SkinnedMesh&&objectMaterial.skinning;if(object.customDepthMaterial){material=object.customDepthMaterial}else if(useSkinning){material=useMorphing?_depthMaterialMorphSkin:_depthMaterialSkin}else if(useMorphing){material=_depthMaterialMorph}else{material=_depthMaterial}_renderer.setMaterialFaces(objectMaterial);if(buffer instanceof THREE.BufferGeometry){_renderer.renderBufferDirect(shadowCamera,_lights,fog,material,buffer,object)}else{_renderer.renderBuffer(shadowCamera,_lights,fog,material,buffer,object)}}for(j=0,jl=_webglObjectsImmediate.length;j<jl;j++){webglObject=_webglObjectsImmediate[j];object=webglObject.object;if(object.visible&&object.castShadow){object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderer.renderImmediateObject(shadowCamera,_lights,fog,_depthMaterial,object)}}}var clearColor=_renderer.getClearColor(),clearAlpha=_renderer.getClearAlpha();_gl.clearColor(clearColor.r,clearColor.g,clearColor.b,clearAlpha);_gl.enable(_gl.BLEND);if(_renderer.shadowMapCullFace===THREE.CullFaceFront){_gl.cullFace(_gl.BACK)}_renderer.resetGLState()};function projectObject(scene,object,shadowCamera){if(object.visible){var webglObjects=_webglObjects[object.id];if(webglObjects&&object.castShadow&&(object.frustumCulled===false||_frustum.intersectsObject(object)===true)){for(var i=0,l=webglObjects.length;i<l;i++){var webglObject=webglObjects[i];object._modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);_renderList.push(webglObject)}}for(var i=0,l=object.children.length;i<l;i++){projectObject(scene,object.children[i],shadowCamera)}}}function createVirtualLight(light,cascade){var virtualLight=new THREE.DirectionalLight;virtualLight.isVirtual=true;virtualLight.onlyShadow=true;virtualLight.castShadow=true;virtualLight.shadowCameraNear=light.shadowCameraNear;virtualLight.shadowCameraFar=light.shadowCameraFar;virtualLight.shadowCameraLeft=light.shadowCameraLeft;virtualLight.shadowCameraRight=light.shadowCameraRight;virtualLight.shadowCameraBottom=light.shadowCameraBottom;virtualLight.shadowCameraTop=light.shadowCameraTop;virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];virtualLight.shadowMapWidth=light.shadowCascadeWidth[cascade];virtualLight.shadowMapHeight=light.shadowCascadeHeight[cascade];virtualLight.pointsWorld=[];virtualLight.pointsFrustum=[];var pointsWorld=virtualLight.pointsWorld,pointsFrustum=virtualLight.pointsFrustum;for(var i=0;i<8;i++){pointsWorld[i]=new THREE.Vector3;pointsFrustum[i]=new THREE.Vector3}var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];pointsFrustum[0].set(-1,-1,nearZ);pointsFrustum[1].set(1,-1,nearZ);pointsFrustum[2].set(-1,1,nearZ);pointsFrustum[3].set(1,1,nearZ);pointsFrustum[4].set(-1,-1,farZ);pointsFrustum[5].set(1,-1,farZ);pointsFrustum[6].set(-1,1,farZ);pointsFrustum[7].set(1,1,farZ);return virtualLight}function updateVirtualLight(light,cascade){var virtualLight=light.shadowCascadeArray[cascade];virtualLight.position.copy(light.position);virtualLight.target.position.copy(light.target.position);virtualLight.lookAt(virtualLight.target);virtualLight.shadowCameraVisible=light.shadowCameraVisible;virtualLight.shadowDarkness=light.shadowDarkness;virtualLight.shadowBias=light.shadowCascadeBias[cascade];var nearZ=light.shadowCascadeNearZ[cascade];var farZ=light.shadowCascadeFarZ[cascade];var pointsFrustum=virtualLight.pointsFrustum;pointsFrustum[0].z=nearZ;pointsFrustum[1].z=nearZ;pointsFrustum[2].z=nearZ;pointsFrustum[3].z=nearZ;pointsFrustum[4].z=farZ;pointsFrustum[5].z=farZ;pointsFrustum[6].z=farZ;pointsFrustum[7].z=farZ}function updateShadowCamera(camera,light){var shadowCamera=light.shadowCamera,pointsFrustum=light.pointsFrustum,pointsWorld=light.pointsWorld;_min.set(Infinity,Infinity,Infinity);_max.set(-Infinity,-Infinity,-Infinity);for(var i=0;i<8;i++){var p=pointsWorld[i];p.copy(pointsFrustum[i]);p.unproject(camera);p.applyMatrix4(shadowCamera.matrixWorldInverse);if(p.x<_min.x)_min.x=p.x;if(p.x>_max.x)_max.x=p.x;if(p.y<_min.y)_min.y=p.y;if(p.y>_max.y)_max.y=p.y;if(p.z<_min.z)_min.z=p.z;if(p.z>_max.z)_max.z=p.z}shadowCamera.left=_min.x;shadowCamera.right=_max.x;shadowCamera.top=_max.y;shadowCamera.bottom=_min.y;shadowCamera.updateProjectionMatrix()}function getObjectMaterial(object){return object.material instanceof THREE.MeshFaceMaterial?object.material.materials[0]:object.material}};THREE.SpritePlugin=function(renderer,sprites){var gl=renderer.context;var vertexBuffer,elementBuffer;var program,attributes,uniforms;var texture;var spritePosition=new THREE.Vector3;var spriteRotation=new THREE.Quaternion;var spriteScale=new THREE.Vector3;var init=function(){var vertices=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]);var faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);program=createProgram();attributes={position:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={uvOffset:gl.getUniformLocation(program,"uvOffset"),uvScale:gl.getUniformLocation(program,"uvScale"),rotation:gl.getUniformLocation(program,"rotation"),scale:gl.getUniformLocation(program,"scale"),color:gl.getUniformLocation(program,"color"),map:gl.getUniformLocation(program,"map"),opacity:gl.getUniformLocation(program,"opacity"),modelViewMatrix:gl.getUniformLocation(program,"modelViewMatrix"),projectionMatrix:gl.getUniformLocation(program,"projectionMatrix"),fogType:gl.getUniformLocation(program,"fogType"),fogDensity:gl.getUniformLocation(program,"fogDensity"),fogNear:gl.getUniformLocation(program,"fogNear"),fogFar:gl.getUniformLocation(program,"fogFar"),fogColor:gl.getUniformLocation(program,"fogColor"),alphaTest:gl.getUniformLocation(program,"alphaTest")};var canvas=document.createElement("canvas");canvas.width=8;canvas.height=8;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,8,8);texture=new THREE.Texture(canvas);texture.needsUpdate=true};this.render=function(scene,camera){if(sprites.length===0)return;if(program===undefined){init()}gl.useProgram(program);gl.enableVertexAttribArray(attributes.position);gl.enableVertexAttribArray(attributes.uv);gl.disable(gl.CULL_FACE);gl.enable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,false,2*8,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,false,2*8,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.uniformMatrix4fv(uniforms.projectionMatrix,false,camera.projectionMatrix.elements);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(uniforms.map,0);var oldFogType=0;var sceneFogType=0;var fog=scene.fog;if(fog){gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b);if(fog instanceof THREE.Fog){gl.uniform1f(uniforms.fogNear,fog.near);gl.uniform1f(uniforms.fogFar,fog.far);gl.uniform1i(uniforms.fogType,1);oldFogType=1;sceneFogType=1}else if(fog instanceof THREE.FogExp2){gl.uniform1f(uniforms.fogDensity,fog.density);gl.uniform1i(uniforms.fogType,2);oldFogType=2;sceneFogType=2}}else{gl.uniform1i(uniforms.fogType,0);oldFogType=0;sceneFogType=0}for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];sprite._modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld);sprite.z=-sprite._modelViewMatrix.elements[14]}sprites.sort(painterSortStable);var scale=[];for(var i=0,l=sprites.length;i<l;i++){var sprite=sprites[i];var material=sprite.material;gl.uniform1f(uniforms.alphaTest,material.alphaTest);gl.uniformMatrix4fv(uniforms.modelViewMatrix,false,sprite._modelViewMatrix.elements);sprite.matrixWorld.decompose(spritePosition,spriteRotation,spriteScale);scale[0]=spriteScale.x;scale[1]=spriteScale.y;var fogType=0;if(scene.fog&&material.fog){fogType=sceneFogType}if(oldFogType!==fogType){gl.uniform1i(uniforms.fogType,fogType);oldFogType=fogType}if(material.map!==null){gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y);gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y)}else{gl.uniform2f(uniforms.uvOffset,0,0);gl.uniform2f(uniforms.uvScale,1,1)}gl.uniform1f(uniforms.opacity,material.opacity);gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b);gl.uniform1f(uniforms.rotation,material.rotation);gl.uniform2fv(uniforms.scale,scale);renderer.state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst);renderer.state.setDepthTest(material.depthTest);renderer.state.setDepthWrite(material.depthWrite);if(material.map&&material.map.image&&material.map.image.width){renderer.setTexture(material.map,0)}else{renderer.setTexture(texture,0)}gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0)}gl.enable(gl.CULL_FACE);renderer.resetGLState()};function createProgram(){var program=gl.createProgram();var vertexShader=gl.createShader(gl.VERTEX_SHADER);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vertexShader,["precision "+renderer.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n"));gl.shaderSource(fragmentShader,["precision "+renderer.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n"));gl.compileShader(vertexShader);gl.compileShader(fragmentShader);gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);return program}function painterSortStable(a,b){if(a.z!==b.z){return b.z-a.z}else{return b.id-a.id}}};THREE.GeometryUtils={merge:function(geometry1,geometry2,materialIndexOffset){THREE.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var matrix;if(geometry2 instanceof THREE.Mesh){geometry2.matrixAutoUpdate&&geometry2.updateMatrix();matrix=geometry2.matrix;geometry2=geometry2.geometry}geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function(geometry){THREE.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return geometry.center()}};THREE.ImageUtils={crossOrigin:undefined,loadTexture:function(url,mapping,onLoad,onError){var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.Texture(undefined,mapping);loader.load(url,function(image){texture.image=image;texture.needsUpdate=true;if(onLoad)onLoad(texture)},undefined,function(event){if(onError)onError(event)});texture.sourceFile=url;return texture},loadTextureCube:function(array,mapping,onLoad,onError){var images=[];var loader=new THREE.ImageLoader;loader.crossOrigin=this.crossOrigin;var texture=new THREE.CubeTexture(images,mapping);texture.flipY=false;var loaded=0;var loadTexture=function(i){loader.load(array[i],function(image){texture.images[i]=image;loaded+=1;if(loaded===6){texture.needsUpdate=true;if(onLoad)onLoad(texture)}},undefined,onError)};for(var i=0,il=array.length;i<il;++i){loadTexture(i)}return texture},loadCompressedTexture:function(){THREE.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){THREE.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},getNormalMap:function(image,depth){var cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]};var subtract=function(a,b){return[a[0]-b[0],a[1]-b[1],a[2]-b[2]]};var normalize=function(a){var l=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[a[0]/l,a[1]/l,a[2]/l]};depth=depth|1;var width=image.width;var height=image.height;var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var context=canvas.getContext("2d");context.drawImage(image,0,0);var data=context.getImageData(0,0,width,height).data;var imageData=context.createImageData(width,height);var output=imageData.data;for(var x=0;x<width;x++){for(var y=0;y<height;y++){var ly=y-1<0?0:y-1;var uy=y+1>height-1?height-1:y+1;var lx=x-1<0?0:x-1;var ux=x+1>width-1?width-1:x+1;var points=[];var origin=[0,0,data[(y*width+x)*4]/255*depth];points.push([-1,0,data[(y*width+lx)*4]/255*depth]);points.push([-1,-1,data[(ly*width+lx)*4]/255*depth]);points.push([0,-1,data[(ly*width+x)*4]/255*depth]);points.push([1,-1,data[(ly*width+ux)*4]/255*depth]);points.push([1,0,data[(y*width+ux)*4]/255*depth]);points.push([1,1,data[(uy*width+ux)*4]/255*depth]);points.push([0,1,data[(uy*width+x)*4]/255*depth]);points.push([-1,1,data[(uy*width+lx)*4]/255*depth]);var normals=[];var num_points=points.length;for(var i=0;i<num_points;i++){var v1=points[i];var v2=points[(i+1)%num_points];v1=subtract(v1,origin);v2=subtract(v2,origin);normals.push(normalize(cross(v1,v2)))}var normal=[0,0,0];for(var i=0;i<normals.length;i++){normal[0]+=normals[i][0];normal[1]+=normals[i][1];normal[2]+=normals[i][2]}normal[0]/=normals.length;normal[1]/=normals.length;normal[2]/=normals.length;var idx=(y*width+x)*4;output[idx]=(normal[0]+1)/2*255|0;output[idx+1]=(normal[1]+1)/2*255|0;output[idx+2]=normal[2]*255|0;output[idx+3]=255}}context.putImageData(imageData,0,0);return canvas},generateDataTexture:function(width,height,color){var size=width*height;var data=new Uint8Array(3*size);var r=Math.floor(color.r*255);var g=Math.floor(color.g*255);var b=Math.floor(color.b*255);for(var i=0;i<size;i++){data[i*3]=r;data[i*3+1]=g;data[i*3+2]=b}var texture=new THREE.DataTexture(data,width,height,THREE.RGBFormat);texture.needsUpdate=true;return texture}};THREE.SceneUtils={createMultiMaterialObject:function(geometry,materials){var group=new THREE.Object3D;for(var i=0,l=materials.length;i<l;i++){group.add(new THREE.Mesh(geometry,materials[i]))}return group},detach:function(child,parent,scene){child.applyMatrix(parent.matrixWorld);parent.remove(child);scene.add(child)},attach:function(child,scene,parent){var matrixWorldInverse=new THREE.Matrix4;matrixWorldInverse.getInverse(parent.matrixWorld);child.applyMatrix(matrixWorldInverse);scene.remove(child);parent.add(child)}};THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){try{return this.faces[this.face][this.weight][this.style]}catch(e){throw"The font "+this.face+" with "+this.weight+" weight and "+this.style+" style is missing."}},loadFace:function(data){var family=data.familyName.toLowerCase();var ThreeFont=this;ThreeFont.faces[family]=ThreeFont.faces[family]||{};ThreeFont.faces[family][data.cssFontWeight]=ThreeFont.faces[family][data.cssFontWeight]||{};ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;ThreeFont.faces[family][data.cssFontWeight][data.cssFontStyle]=data;return data},drawText:function(text){var i,face=this.getFace(),scale=this.size/face.resolution,offset=0,chars=String(text).split(""),length=chars.length;var fontPaths=[];for(i=0;i<length;i++){var path=new THREE.Path;var ret=this.extractGlyphPoints(chars[i],face,scale,offset,path);offset+=ret.offset;fontPaths.push(ret.path)}var width=offset/2;return{paths:fontPaths,offset:width}},extractGlyphPoints:function(c,face,scale,offset,path){var pts=[];var i,i2,divisions,outline,action,length,scaleX,scaleY,x,y,cpx,cpy,cpx0,cpy0,cpx1,cpy1,cpx2,cpy2,laste,glyph=face.glyphs[c]||face.glyphs["?"];if(!glyph)return;if(glyph.o){outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));length=outline.length;scaleX=scale;scaleY=scale;for(i=0;i<length;){action=outline[i++];switch(action){case"m":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.moveTo(x,y);break;case"l":x=outline[i++]*scaleX+offset;y=outline[i++]*scaleY;path.lineTo(x,y);break;case"q":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy)}}break;case"b":cpx=outline[i++]*scaleX+offset;cpy=outline[i++]*scaleY;cpx1=outline[i++]*scaleX+offset;cpy1=outline[i++]*scaleY;cpx2=outline[i++]*scaleX+offset;cpy2=outline[i++]*scaleY;path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy);laste=pts[pts.length-1];if(laste){cpx0=laste.x;cpy0=laste.y;for(i2=1,divisions=this.divisions;i2<=divisions;i2++){var t=i2/divisions;THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy)}}break}}}return{offset:glyph.ha*scale,path:path}}};THREE.FontUtils.generateShapes=function(text,parameters){parameters=parameters||{};var size=parameters.size!==undefined?parameters.size:100;var curveSegments=parameters.curveSegments!==undefined?parameters.curveSegments:4;var font=parameters.font!==undefined?parameters.font:"helvetiker";var weight=parameters.weight!==undefined?parameters.weight:"normal";var style=parameters.style!==undefined?parameters.style:"normal";THREE.FontUtils.size=size;THREE.FontUtils.divisions=curveSegments;THREE.FontUtils.face=font;THREE.FontUtils.weight=weight;THREE.FontUtils.style=style;var data=THREE.FontUtils.drawText(text);var paths=data.paths;var shapes=[];for(var p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes())}return shapes};(function(namespace){var EPSILON=1e-10;var process=function(contour,indices){var n=contour.length;if(n<3)return null;var result=[],verts=[],vertIndices=[];var u,v,w;if(area(contour)>0){for(v=0;v<n;v++)verts[v]=v}else{for(v=0;v<n;v++)verts[v]=n-1-v}var nv=n;var count=2*nv;for(v=nv-1;nv>2;){if(count--<=0){THREE.warn("THREE.FontUtils: Warning, unable to triangulate polygon! in Triangulate.process()");if(indices)return vertIndices;return result}u=v;if(nv<=u)u=0;v=u+1;if(nv<=v)v=0;w=v+1;if(nv<=w)w=0;if(snip(contour,u,v,w,nv,verts)){var a,b,c,s,t;a=verts[u];b=verts[v];c=verts[w];result.push([contour[a],contour[b],contour[c]]);vertIndices.push([verts[u],verts[v],verts[w]]);for(s=v,t=v+1;t<nv;s++,t++){verts[s]=verts[t]}nv--;count=2*nv}}if(indices)return vertIndices;return result};var area=function(contour){var n=contour.length;var a=0;for(var p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y}return a*.5};var snip=function(contour,u,v,w,n,verts){var p;var ax,ay,bx,by;var cx,cy,px,py;ax=contour[verts[u]].x;ay=contour[verts[u]].y;bx=contour[verts[v]].x;by=contour[verts[v]].y;cx=contour[verts[w]].x;cy=contour[verts[w]].y;if(EPSILON>(bx-ax)*(cy-ay)-(by-ay)*(cx-ax))return false;var aX,aY,bX,bY,cX,cY;var apx,apy,bpx,bpy,cpx,cpy;var cCROSSap,bCROSScp,aCROSSbp;aX=cx-bx;aY=cy-by;bX=ax-cx;bY=ay-cy;cX=bx-ax;cY=by-ay;for(p=0;p<n;p++){px=contour[verts[p]].x;py=contour[verts[p]].y;if(px===ax&&py===ay||px===bx&&py===by||px===cx&&py===cy)continue;apx=px-ax;apy=py-ay;bpx=px-bx;bpy=py-by;cpx=px-cx;cpy=py-cy;aCROSSbp=aX*bpy-aY*bpx;cCROSSap=cX*apy-cY*apx;bCROSScp=bX*cpy-bY*cpx;if(aCROSSbp>=-EPSILON&&bCROSScp>=-EPSILON&&cCROSSap>=-EPSILON)return false}return true};namespace.Triangulate=process;namespace.Triangulate.area=area;return namespace})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.typeface_js=self._typeface_js;THREE.Audio=function(listener){THREE.Object3D.call(this);this.type="Audio";this.context=listener.context;this.source=this.context.createBufferSource();this.source.onended=this.onEnded.bind(this);this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.panner=this.context.createPanner();this.panner.connect(this.gain);this.autoplay=false;this.startTime=0;this.isPlaying=false};THREE.Audio.prototype=Object.create(THREE.Object3D.prototype);THREE.Audio.prototype.constructor=THREE.Audio;THREE.Audio.prototype.load=function(file){var scope=this;var request=new XMLHttpRequest;request.open("GET",file,true);request.responseType="arraybuffer";request.onload=function(e){scope.context.decodeAudioData(this.response,function(buffer){scope.source.buffer=buffer;if(scope.autoplay)scope.play()})};request.send();return this};THREE.Audio.prototype.play=function(){if(this.isPlaying===true){THREE.warn("THREE.Audio: Audio is already playing.");return}var source=this.context.createBufferSource();source.buffer=this.source.buffer;source.loop=this.source.loop;source.onended=this.source.onended;source.connect(this.panner);source.start(0,this.startTime);this.isPlaying=true;this.source=source};THREE.Audio.prototype.pause=function(){this.source.stop();this.startTime=this.context.currentTime};THREE.Audio.prototype.stop=function(){this.source.stop();this.startTime=0};THREE.Audio.prototype.onEnded=function(){this.isPlaying=false};THREE.Audio.prototype.setLoop=function(value){this.source.loop=value};THREE.Audio.prototype.setRefDistance=function(value){this.panner.refDistance=value};THREE.Audio.prototype.setRolloffFactor=function(value){this.panner.rolloffFactor=value};THREE.Audio.prototype.setVolume=function(value){this.gain.gain.value=value};THREE.Audio.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;return function(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);position.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(position.x,position.y,position.z)}}();THREE.AudioListener=function(){THREE.Object3D.call(this);this.type="AudioListener";this.context=new(window.AudioContext||window.webkitAudioContext)};THREE.AudioListener.prototype=Object.create(THREE.Object3D.prototype);THREE.AudioListener.prototype.constructor=THREE.AudioListener;THREE.AudioListener.prototype.updateMatrixWorld=function(){var position=new THREE.Vector3;var quaternion=new THREE.Quaternion;var scale=new THREE.Vector3;var orientation=new THREE.Vector3;var velocity=new THREE.Vector3;var positionPrev=new THREE.Vector3;return function(force){THREE.Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener;var up=this.up;this.matrixWorld.decompose(position,quaternion,scale);orientation.set(0,0,-1).applyQuaternion(quaternion);velocity.subVectors(position,positionPrev);listener.setPosition(position.x,position.y,position.z);listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z);listener.setVelocity(velocity.x,velocity.y,velocity.z);positionPrev.copy(position)}}();THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(t){THREE.warn("THREE.Curve: Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(u){var t=this.getUtoTmapping(u);return this.getPoint(t)};THREE.Curve.prototype.getPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPoint(d/divisions))}return pts};THREE.Curve.prototype.getSpacedPoints=function(divisions){if(!divisions)divisions=5;var d,pts=[];for(d=0;d<=divisions;d++){pts.push(this.getPointAt(d/divisions))}return pts};THREE.Curve.prototype.getLength=function(){var lengths=this.getLengths();return lengths[lengths.length-1]};THREE.Curve.prototype.getLengths=function(divisions){if(!divisions)divisions=this.__arcLengthDivisions?this.__arcLengthDivisions:200;if(this.cacheArcLengths&&this.cacheArcLengths.length==divisions+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=false;var cache=[];var current,last=this.getPoint(0);var p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current}this.cacheArcLengths=cache;return cache};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(u,distance){var arcLengths=this.getLengths();var i=0,il=arcLengths.length;var targetArcLength;if(distance){targetArcLength=distance}else{targetArcLength=u*arcLengths[il-1]}var low=0,high=il-1,comparison;while(low<=high){i=Math.floor(low+(high-low)/2);comparison=arcLengths[i]-targetArcLength;if(comparison<0){low=i+1}else if(comparison>0){high=i-1}else{high=i;break}}i=high;if(arcLengths[i]==targetArcLength){var t=i/(il-1);return t}var lengthBefore=arcLengths[i];var lengthAfter=arcLengths[i+1];var segmentLength=lengthAfter-lengthBefore;var segmentFraction=(targetArcLength-lengthBefore)/segmentLength;var t=(i+segmentFraction)/(il-1);return t};THREE.Curve.prototype.getTangent=function(t){var delta=1e-4;var t1=t-delta;var t2=t+delta;if(t1<0)t1=0;if(t2>1)t2=1;var pt1=this.getPoint(t1);var pt2=this.getPoint(t2);var vec=pt2.clone().sub(pt1);return vec.normalize()};THREE.Curve.prototype.getTangentAt=function(u){var t=this.getUtoTmapping(u);return this.getTangent(t)};THREE.Curve.Utils={tangentQuadraticBezier:function(t,p0,p1,p2){return 2*(1-t)*(p1-p0)+2*t*(p2-p1)},tangentCubicBezier:function(t,p0,p1,p2,p3){return-3*p0*(1-t)*(1-t)+3*p1*(1-t)*(1-t)-6*t*p1*(1-t)+6*t*p2*(1-t)-3*t*t*p2+3*t*t*p3},tangentSpline:function(t,p0,p1,p2,p3){var h00=6*t*t-6*t;var h10=3*t*t-4*t+1;var h01=-6*t*t+6*t;var h11=3*t*t-2*t;return h00+h10+h01+h11},interpolate:function(p0,p1,p2,p3,t){var v0=(p2-p0)*.5;var v1=(p3-p1)*.5;var t2=t*t;var t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}};THREE.Curve.create=function(constructor,getPointFunc){constructor.prototype=Object.create(THREE.Curve.prototype);constructor.prototype.constructor=constructor;constructor.prototype.getPoint=getPointFunc;return constructor};THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype);THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(curve){this.curves.push(curve)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var startPoint=this.curves[0].getPoint(0);var endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new THREE.LineCurve(endPoint,startPoint))}};THREE.CurvePath.prototype.getPoint=function(t){var d=t*this.getLength();var curveLengths=this.getCurveLengths();var i=0,diff,curve;while(i<curveLengths.length){if(curveLengths[i]>=d){diff=curveLengths[i]-d;curve=this.curves[i];var u=1-diff/curve.getLength();return curve.getPointAt(u)}i++}return null};THREE.CurvePath.prototype.getLength=function(){var lens=this.getCurveLengths();return lens[lens.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length){return this.cacheLengths}var lengths=[],sums=0;var i,il=this.curves.length;for(i=0;i<il;i++){sums+=this.curves[i].getLength();lengths.push(sums)}this.cacheLengths=lengths;return lengths};THREE.CurvePath.prototype.getBoundingBox=function(){var points=this.getPoints();var maxX,maxY,maxZ;var minX,minY,minZ;maxX=maxY=Number.NEGATIVE_INFINITY;minX=minY=Number.POSITIVE_INFINITY;var p,i,il,sum;var v3=points[0]instanceof THREE.Vector3;sum=v3?new THREE.Vector3:new THREE.Vector2;for(i=0,il=points.length;i<il;i++){p=points[i];if(p.x>maxX)maxX=p.x;else if(p.x<minX)minX=p.x;if(p.y>maxY)maxY=p.y;else if(p.y<minY)minY=p.y;if(v3){if(p.z>maxZ)maxZ=p.z;else if(p.z<minZ)minZ=p.z}sum.add(p)}var ret={minX:minX,minY:minY,maxX:maxX,maxY:maxY};if(v3){ret.maxZ=maxZ;ret.minZ=minZ}return ret};THREE.CurvePath.prototype.createPointsGeometry=function(divisions){var pts=this.getPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(divisions){var pts=this.getSpacedPoints(divisions,true);return this.createGeometry(pts)};THREE.CurvePath.prototype.createGeometry=function(points){var geometry=new THREE.Geometry;for(var i=0;i<points.length;i++){geometry.vertices.push(new THREE.Vector3(points[i].x,points[i].y,points[i].z||0))}return geometry};THREE.CurvePath.prototype.addWrapPath=function(bendpath){this.bends.push(bendpath)};THREE.CurvePath.prototype.getTransformedPoints=function(segments,bends){var oldPts=this.getPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(segments,bends){var oldPts=this.getSpacedPoints(segments);var i,il;if(!bends){bends=this.bends}for(i=0,il=bends.length;i<il;i++){oldPts=this.getWrapPoints(oldPts,bends[i])}return oldPts};THREE.CurvePath.prototype.getWrapPoints=function(oldPts,path){var bounds=this.getBoundingBox();var i,il,p,oldX,oldY,xNorm;for(i=0,il=oldPts.length;i<il;i++){p=oldPts[i];oldX=p.x;oldY=p.y;xNorm=oldX/bounds.maxX;xNorm=path.getUtoTmapping(xNorm,oldX);var pathPt=path.getPoint(xNorm);var normal=path.getTangent(xNorm);normal.set(-normal.y,normal.x).multiplyScalar(oldY);p.x=pathPt.x+normal.x;p.y=pathPt.y+normal.y}return oldPts};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype);THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;THREE.Gyroscope.prototype.updateMatrixWorld=function(){var translationObject=new THREE.Vector3;var quaternionObject=new THREE.Quaternion;var scaleObject=new THREE.Vector3;var translationWorld=new THREE.Vector3;var quaternionWorld=new THREE.Quaternion;var scaleWorld=new THREE.Vector3;return function(force){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||force){if(this.parent){this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(translationWorld,quaternionWorld,scaleWorld);this.matrix.decompose(translationObject,quaternionObject,scaleObject);this.matrixWorld.compose(translationWorld,quaternionObject,scaleWorld)}else{this.matrixWorld.copy(this.matrix)}this.matrixWorldNeedsUpdate=false;force=true}for(var i=0,l=this.children.length;i<l;i++){this.children[i].updateMatrixWorld(force)}}}();THREE.Path=function(points){THREE.CurvePath.call(this);this.actions=[];if(points){this.fromPoints(points)}};THREE.Path.prototype=Object.create(THREE.CurvePath.prototype);THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"};THREE.Path.prototype.fromPoints=function(vectors){this.moveTo(vectors[0].x,vectors[0].y);for(var v=1,vlen=vectors.length;v<vlen;v++){this.lineTo(vectors[v].x,vectors[v].y)}};THREE.Path.prototype.moveTo=function(x,y){var args=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:args})};THREE.Path.prototype.lineTo=function(x,y){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.LineCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(x,y));this.curves.push(curve);this.actions.push({action:THREE.PathActions.LINE_TO,args:args})};THREE.Path.prototype.quadraticCurveTo=function(aCPx,aCPy,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.QuadraticBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCPx,aCPy),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:args})};THREE.Path.prototype.bezierCurveTo=function(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var curve=new THREE.CubicBezierCurve(new THREE.Vector2(x0,y0),new THREE.Vector2(aCP1x,aCP1y),new THREE.Vector2(aCP2x,aCP2y),new THREE.Vector2(aX,aY));this.curves.push(curve);this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:args})};THREE.Path.prototype.splineThru=function(pts){var args=Array.prototype.slice.call(arguments);var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];var npts=[new THREE.Vector2(x0,y0)];Array.prototype.push.apply(npts,pts);var curve=new THREE.SplineCurve(npts);this.curves.push(curve);this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:args})};THREE.Path.prototype.arc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absarc=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.ellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var lastargs=this.actions[this.actions.length-1].args;var x0=lastargs[lastargs.length-2];var y0=lastargs[lastargs.length-1];this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise)};THREE.Path.prototype.absellipse=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){var args=Array.prototype.slice.call(arguments);var curve=new THREE.EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise);this.curves.push(curve);var lastPoint=curve.getPoint(1);args.push(lastPoint.x);args.push(lastPoint.y);this.actions.push({action:THREE.PathActions.ELLIPSE,args:args})};THREE.Path.prototype.getSpacedPoints=function(divisions,closedPath){if(!divisions)divisions=40;var points=[];for(var i=0;i<divisions;i++){points.push(this.getPoint(i/divisions))}return points};THREE.Path.prototype.getPoints=function(divisions,closedPath){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(divisions,closedPath)}divisions=divisions||12;var points=[];var i,il,item,action,args;var cpx,cpy,cpx2,cpy2,cpx1,cpy1,cpx0,cpy0,laste,j,t,tx,ty;for(i=0,il=this.actions.length;i<il;i++){item=this.actions[i];action=item.action;args=item.args;switch(action){case THREE.PathActions.MOVE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.LINE_TO:points.push(new THREE.Vector2(args[0],args[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:cpx=args[2];cpy=args[3];cpx1=args[0];cpy1=args[1];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b2(t,cpx0,cpx1,cpx);ty=THREE.Shape.Utils.b2(t,cpy0,cpy1,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.BEZIER_CURVE_TO:cpx=args[4];cpy=args[5];cpx1=args[0];cpy1=args[1];cpx2=args[2];cpy2=args[3];if(points.length>0){laste=points[points.length-1];cpx0=laste.x;cpy0=laste.y}else{laste=this.actions[i-1].args;cpx0=laste[laste.length-2];cpy0=laste[laste.length-1]}for(j=1;j<=divisions;j++){t=j/divisions;tx=THREE.Shape.Utils.b3(t,cpx0,cpx1,cpx2,cpx);ty=THREE.Shape.Utils.b3(t,cpy0,cpy1,cpy2,cpy);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.CSPLINE_THRU:laste=this.actions[i-1].args;var last=new THREE.Vector2(laste[laste.length-2],laste[laste.length-1]);var spts=[last];var n=divisions*args[0].length;spts=spts.concat(args[0]);var spline=new THREE.SplineCurve(spts);for(j=1;j<=n;j++){points.push(spline.getPointAt(j/n))}break;case THREE.PathActions.ARC:var aX=args[0],aY=args[1],aRadius=args[2],aStartAngle=args[3],aEndAngle=args[4],aClockwise=!!args[5];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+aRadius*Math.cos(angle);ty=aY+aRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break;case THREE.PathActions.ELLIPSE:var aX=args[0],aY=args[1],xRadius=args[2],yRadius=args[3],aStartAngle=args[4],aEndAngle=args[5],aClockwise=!!args[6];var deltaAngle=aEndAngle-aStartAngle;var angle;var tdivisions=divisions*2;for(j=1;j<=tdivisions;j++){t=j/tdivisions;if(!aClockwise){t=1-t}angle=aStartAngle+t*deltaAngle;tx=aX+xRadius*Math.cos(angle);ty=aY+yRadius*Math.sin(angle);points.push(new THREE.Vector2(tx,ty))}break}}var lastPoint=points[points.length-1];var EPSILON=1e-10;if(Math.abs(lastPoint.x-points[0].x)<EPSILON&&Math.abs(lastPoint.y-points[0].y)<EPSILON)points.splice(points.length-1,1);if(closedPath){points.push(points[0])}return points};THREE.Path.prototype.toShapes=function(isCCW,noHoles){function extractSubpaths(inActions){var i,il,item,action,args;var subPaths=[],lastPath=new THREE.Path;for(i=0,il=inActions.length;i<il;i++){item=inActions[i];args=item.args;action=item.action;if(action==THREE.PathActions.MOVE_TO){if(lastPath.actions.length!=0){subPaths.push(lastPath);lastPath=new THREE.Path}}lastPath[action].apply(lastPath,args)}if(lastPath.actions.length!=0){subPaths.push(lastPath)}return subPaths}function toShapesNoHoles(inSubpaths){var shapes=[];for(var i=0,il=inSubpaths.length;i<il;i++){var tmpPath=inSubpaths[i];var tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){var EPSILON=1e-10;var polyLen=inPolygon.length;var inside=false;for(var p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p];var edgeHighPt=inPolygon[q];var edgeDx=edgeHighPt.x-edgeLowPt.x;var edgeDy=edgeHighPt.y-edgeLowPt.y;if(Math.abs(edgeDy)>EPSILON){if(edgeDy<0){edgeLowPt=inPolygon[q];edgeDx=-edgeDx;edgeHighPt=inPolygon[p];edgeDy=-edgeDy}if(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y==edgeLowPt.y){if(inPt.x==edgeLowPt.x)return true}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(perpEdge==0)return true;if(perpEdge<0)continue;inside=!inside}}else{if(inPt.y!=edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return true}}return inside}var subPaths=extractSubpaths(this.actions);if(subPaths.length==0)return[];if(noHoles===true)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(subPaths.length==1){tmpPath=subPaths[0];tmpShape=new THREE.Shape;tmpShape.actions=tmpPath.actions;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes}var holesFirst=!THREE.Shape.Utils.isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var betterShapeHoles=[];var newShapes=[];var newShapeHoles=[];var mainIdx=0;var tmpPoints;newShapes[mainIdx]=undefined;newShapeHoles[mainIdx]=[];var i,il;for(i=0,il=subPaths.length;i<il;i++){tmpPath=subPaths[i];tmpPoints=tmpPath.getPoints();solid=THREE.Shape.Utils.isClockWise(tmpPoints);solid=isCCW?!solid:solid;if(solid){if(!holesFirst&&newShapes[mainIdx])mainIdx++;newShapes[mainIdx]={s:new THREE.Shape,p:tmpPoints};newShapes[mainIdx].s.actions=tmpPath.actions;newShapes[mainIdx].s.curves=tmpPath.curves;if(holesFirst)mainIdx++;newShapeHoles[mainIdx]=[]}else{newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]})}}if(!newShapes[0])return toShapesNoHoles(subPaths);if(newShapes.length>1){var ambigious=false;var toChange=[];for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){betterShapeHoles[sIdx]=[]}for(var sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){var sho=newShapeHoles[sIdx];for(var hIdx=0;hIdx<sho.length;hIdx++){var ho=sho[hIdx];var hole_unassigned=true;for(var s2Idx=0;s2Idx<newShapes.length;s2Idx++){if(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){if(sIdx!=s2Idx)toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx});if(hole_unassigned){hole_unassigned=false;betterShapeHoles[s2Idx].push(ho)}else{ambigious=true}}}if(hole_unassigned){betterShapeHoles[sIdx].push(ho)}}}if(toChange.length>0){if(!ambigious)newShapeHoles=betterShapeHoles}}var tmpHoles,j,jl;for(i=0,il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s;shapes.push(tmpShape);tmpHoles=newShapeHoles[i];for(j=0,jl=tmpHoles.length;j<jl;j++){tmpShape.holes.push(tmpHoles[j].h)}}return shapes};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=Object.create(THREE.Path.prototype);THREE.Shape.prototype.constructor=THREE.Shape;THREE.Shape.prototype.extrude=function(options){var extruded=new THREE.ExtrudeGeometry(this,options);return extruded};THREE.Shape.prototype.makeGeometry=function(options){var geometry=new THREE.ShapeGeometry(this,options);return geometry};THREE.Shape.prototype.getPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.getSpacedPointsHoles=function(divisions){var i,il=this.holes.length,holesPts=[];for(i=0;i<il;i++){holesPts[i]=this.holes[i].getTransformedSpacedPoints(divisions,this.bends)}return holesPts};THREE.Shape.prototype.extractAllPoints=function(divisions){return{shape:this.getTransformedPoints(divisions),holes:this.getPointsHoles(divisions)}};THREE.Shape.prototype.extractPoints=function(divisions){if(this.useSpacedPoints){return this.extractAllSpacedPoints(divisions)}return this.extractAllPoints(divisions)};THREE.Shape.prototype.extractAllSpacedPoints=function(divisions){return{shape:this.getTransformedSpacedPoints(divisions),holes:this.getSpacedPointsHoles(divisions)}};THREE.Shape.Utils={triangulateShape:function(contour,holes){function point_in_segment_2D_colin(inSegPt1,inSegPt2,inOtherPt){if(inSegPt1.x!=inSegPt2.x){if(inSegPt1.x<inSegPt2.x){return inSegPt1.x<=inOtherPt.x&&inOtherPt.x<=inSegPt2.x}else{return inSegPt2.x<=inOtherPt.x&&inOtherPt.x<=inSegPt1.x}}else{if(inSegPt1.y<inSegPt2.y){return inSegPt1.y<=inOtherPt.y&&inOtherPt.y<=inSegPt2.y}else{return inSegPt2.y<=inOtherPt.y&&inOtherPt.y<=inSegPt1.y}}}function intersect_segments_2D(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1,inSeg2Pt2,inExcludeAdjacentSegs){var EPSILON=1e-10;var seg1dx=inSeg1Pt2.x-inSeg1Pt1.x,seg1dy=inSeg1Pt2.y-inSeg1Pt1.y;var seg2dx=inSeg2Pt2.x-inSeg2Pt1.x,seg2dy=inSeg2Pt2.y-inSeg2Pt1.y;var seg1seg2dx=inSeg1Pt1.x-inSeg2Pt1.x;var seg1seg2dy=inSeg1Pt1.y-inSeg2Pt1.y;var limit=seg1dy*seg2dx-seg1dx*seg2dy;var perpSeg1=seg1dy*seg1seg2dx-seg1dx*seg1seg2dy;if(Math.abs(limit)>EPSILON){var perpSeg2;if(limit>0){if(perpSeg1<0||perpSeg1>limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2<0||perpSeg2>limit)return[]}else{if(perpSeg1>0||perpSeg1<limit)return[];perpSeg2=seg2dy*seg1seg2dx-seg2dx*seg1seg2dy;if(perpSeg2>0||perpSeg2<limit)return[]}if(perpSeg2==0){if(inExcludeAdjacentSegs&&(perpSeg1==0||perpSeg1==limit))return[];return[inSeg1Pt1]}if(perpSeg2==limit){if(inExcludeAdjacentSegs&&(perpSeg1==0||perpSeg1==limit))return[];return[inSeg1Pt2]}if(perpSeg1==0)return[inSeg2Pt1];if(perpSeg1==limit)return[inSeg2Pt2];var factorSeg1=perpSeg2/limit;return[{x:inSeg1Pt1.x+factorSeg1*seg1dx,y:inSeg1Pt1.y+factorSeg1*seg1dy}]}else{if(perpSeg1!=0||seg2dy*seg1seg2dx!=seg2dx*seg1seg2dy)return[];var seg1Pt=seg1dx==0&&seg1dy==0;var seg2Pt=seg2dx==0&&seg2dy==0;if(seg1Pt&&seg2Pt){if(inSeg1Pt1.x!=inSeg2Pt1.x||inSeg1Pt1.y!=inSeg2Pt1.y)return[];return[inSeg1Pt1]}if(seg1Pt){if(!point_in_segment_2D_colin(inSeg2Pt1,inSeg2Pt2,inSeg1Pt1))return[];return[inSeg1Pt1]}if(seg2Pt){if(!point_in_segment_2D_colin(inSeg1Pt1,inSeg1Pt2,inSeg2Pt1))return[];return[inSeg2Pt1]}var seg1min,seg1max,seg1minVal,seg1maxVal;var seg2min,seg2max,seg2minVal,seg2maxVal;if(seg1dx!=0){if(inSeg1Pt1.x<inSeg1Pt2.x){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.x;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.x}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.x;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.x}if(inSeg2Pt1.x<inSeg2Pt2.x){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.x;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.x}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.x;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.x}}else{if(inSeg1Pt1.y<inSeg1Pt2.y){seg1min=inSeg1Pt1;seg1minVal=inSeg1Pt1.y;seg1max=inSeg1Pt2;seg1maxVal=inSeg1Pt2.y}else{seg1min=inSeg1Pt2;seg1minVal=inSeg1Pt2.y;seg1max=inSeg1Pt1;seg1maxVal=inSeg1Pt1.y}if(inSeg2Pt1.y<inSeg2Pt2.y){seg2min=inSeg2Pt1;seg2minVal=inSeg2Pt1.y;seg2max=inSeg2Pt2;seg2maxVal=inSeg2Pt2.y}else{seg2min=inSeg2Pt2;seg2minVal=inSeg2Pt2.y;seg2max=inSeg2Pt1;seg2maxVal=inSeg2Pt1.y}}if(seg1minVal<=seg2minVal){if(seg1maxVal<seg2minVal)return[];if(seg1maxVal==seg2minVal){if(inExcludeAdjacentSegs)return[];return[seg2min]}if(seg1maxVal<=seg2maxVal)return[seg2min,seg1max];return[seg2min,seg2max]}else{if(seg1minVal>seg2maxVal)return[];if(seg1minVal==seg2maxVal){if(inExcludeAdjacentSegs)return[];return[seg1min]}if(seg1maxVal<=seg2maxVal)return[seg1min,seg1max];return[seg1min,seg2max]}}}function isPointInsideAngle(inVertex,inLegFromPt,inLegToPt,inOtherPt){var EPSILON=1e-10;var legFromPtX=inLegFromPt.x-inVertex.x,legFromPtY=inLegFromPt.y-inVertex.y;var legToPtX=inLegToPt.x-inVertex.x,legToPtY=inLegToPt.y-inVertex.y;var otherPtX=inOtherPt.x-inVertex.x,otherPtY=inOtherPt.y-inVertex.y;var from2toAngle=legFromPtX*legToPtY-legFromPtY*legToPtX;var from2otherAngle=legFromPtX*otherPtY-legFromPtY*otherPtX;if(Math.abs(from2toAngle)>EPSILON){var other2toAngle=otherPtX*legToPtY-otherPtY*legToPtX;if(from2toAngle>0){return from2otherAngle>=0&&other2toAngle>=0}else{return from2otherAngle>=0||other2toAngle>=0}}else{return from2otherAngle>0}}function removeHoles(contour,holes){var shape=contour.concat();var hole;function isCutLineInsideAngles(inShapeIdx,inHoleIdx){var lastShapeIdx=shape.length-1;var prevShapeIdx=inShapeIdx-1;if(prevShapeIdx<0)prevShapeIdx=lastShapeIdx;var nextShapeIdx=inShapeIdx+1;if(nextShapeIdx>lastShapeIdx)nextShapeIdx=0;var insideAngle=isPointInsideAngle(shape[inShapeIdx],shape[prevShapeIdx],shape[nextShapeIdx],hole[inHoleIdx]);if(!insideAngle){return false}var lastHoleIdx=hole.length-1;var prevHoleIdx=inHoleIdx-1;if(prevHoleIdx<0)prevHoleIdx=lastHoleIdx;var nextHoleIdx=inHoleIdx+1;if(nextHoleIdx>lastHoleIdx)nextHoleIdx=0;insideAngle=isPointInsideAngle(hole[inHoleIdx],hole[prevHoleIdx],hole[nextHoleIdx],shape[inShapeIdx]);if(!insideAngle){return false}return true}function intersectsShapeEdge(inShapePt,inHolePt){var sIdx,nextIdx,intersection;for(sIdx=0;sIdx<shape.length;sIdx++){nextIdx=sIdx+1;nextIdx%=shape.length;intersection=intersect_segments_2D(inShapePt,inHolePt,shape[sIdx],shape[nextIdx],true);if(intersection.length>0)return true}return false}var indepHoles=[];function intersectsHoleEdge(inShapePt,inHolePt){var ihIdx,chkHole,hIdx,nextIdx,intersection;for(ihIdx=0;ihIdx<indepHoles.length;ihIdx++){chkHole=holes[indepHoles[ihIdx]];for(hIdx=0;hIdx<chkHole.length;hIdx++){nextIdx=hIdx+1;nextIdx%=chkHole.length;intersection=intersect_segments_2D(inShapePt,inHolePt,chkHole[hIdx],chkHole[nextIdx],true);if(intersection.length>0)return true}}return false}var holeIndex,shapeIndex,shapePt,holePt,holeIdx,cutKey,failedCuts=[],tmpShape1,tmpShape2,tmpHole1,tmpHole2;for(var h=0,hl=holes.length;h<hl;h++){indepHoles.push(h)}var minShapeIndex=0;var counter=indepHoles.length*2;while(indepHoles.length>0){counter--;if(counter<0){console.log("Infinite Loop! Holes left:"+indepHoles.length+", Probably Hole outside Shape!");break}for(shapeIndex=minShapeIndex;shapeIndex<shape.length;shapeIndex++){shapePt=shape[shapeIndex];holeIndex=-1;for(var h=0;h<indepHoles.length;h++){holeIdx=indepHoles[h];cutKey=shapePt.x+":"+shapePt.y+":"+holeIdx;if(failedCuts[cutKey]!==undefined)continue;hole=holes[holeIdx];for(var h2=0;h2<hole.length;h2++){holePt=hole[h2];if(!isCutLineInsideAngles(shapeIndex,h2))continue;if(intersectsShapeEdge(shapePt,holePt))continue;if(intersectsHoleEdge(shapePt,holePt))continue;holeIndex=h2;indepHoles.splice(h,1);tmpShape1=shape.slice(0,shapeIndex+1);tmpShape2=shape.slice(shapeIndex);tmpHole1=hole.slice(holeIndex);tmpHole2=hole.slice(0,holeIndex+1);shape=tmpShape1.concat(tmpHole1).concat(tmpHole2).concat(tmpShape2);minShapeIndex=shapeIndex;break}if(holeIndex>=0)break;failedCuts[cutKey]=true}if(holeIndex>=0)break}}return shape}var i,il,f,face,key,index,allPointsMap={};var allpoints=contour.concat();for(var h=0,hl=holes.length;h<hl;h++){Array.prototype.push.apply(allpoints,holes[h])}for(i=0,il=allpoints.length;i<il;i++){key=allpoints[i].x+":"+allpoints[i].y;if(allPointsMap[key]!==undefined){THREE.warn("THREE.Shape: Duplicate point",key)}allPointsMap[key]=i}var shapeWithoutHoles=removeHoles(contour,holes);var triangles=THREE.FontUtils.Triangulate(shapeWithoutHoles,false);for(i=0,il=triangles.length;i<il;i++){face=triangles[i];for(f=0;f<3;f++){key=face[f].x+":"+face[f].y;index=allPointsMap[key];if(index!==undefined){face[f]=index}}}return triangles.concat()},isClockWise:function(pts){return THREE.FontUtils.Triangulate.area(pts)<0},b2p0:function(t,p){var k=1-t;return k*k*p},b2p1:function(t,p){return 2*(1-t)*t*p},b2p2:function(t,p){return t*t*p},b2:function(t,p0,p1,p2){return this.b2p0(t,p0)+this.b2p1(t,p1)+this.b2p2(t,p2)},b3p0:function(t,p){var k=1-t;return k*k*k*p},b3p1:function(t,p){var k=1-t;return 3*k*k*t*p},b3p2:function(t,p){var k=1-t;return 3*k*t*t*p},b3p3:function(t,p){return t*t*t*p},b3:function(t,p0,p1,p2,p3){return this.b3p0(t,p0)+this.b3p1(t,p1)+this.b3p2(t,p2)+this.b3p3(t,p3)}};THREE.LineCurve=function(v1,v2){this.v1=v1;this.v2=v2};THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(t){var point=this.v2.clone().sub(this.v1);point.multiplyScalar(t).add(this.v1);return point};THREE.LineCurve.prototype.getPointAt=function(u){return this.getPoint(u)};THREE.LineCurve.prototype.getTangent=function(t){var tangent=this.v2.clone().sub(this.v1);return tangent.normalize()};THREE.QuadraticBezierCurve=function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2};THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(t){var vector=new THREE.Vector2;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);return vector};THREE.QuadraticBezierCurve.prototype.getTangent=function(t){var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Curve.Utils.tangentQuadraticBezier(t,this.v0.y,this.v1.y,this.v2.y);return vector.normalize()};THREE.CubicBezierCurve=function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3};THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype);THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(t){var tx,ty;tx=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(tx,ty)};THREE.CubicBezierCurve.prototype.getTangent=function(t){var tx,ty;tx=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);ty=THREE.Curve.Utils.tangentCubicBezier(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var tangent=new THREE.Vector2(tx,ty);tangent.normalize();return tangent};THREE.SplineCurve=function(points){this.points=points==undefined?[]:points};THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype);THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector2;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);return vector};THREE.EllipseCurve=function(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise){this.aX=aX;this.aY=aY;this.xRadius=xRadius;this.yRadius=yRadius;this.aStartAngle=aStartAngle;this.aEndAngle=aEndAngle;this.aClockwise=aClockwise};THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype);THREE.EllipseCurve.prototype.constructor=THREE.EllipseCurve;THREE.EllipseCurve.prototype.getPoint=function(t){var deltaAngle=this.aEndAngle-this.aStartAngle;if(deltaAngle<0)deltaAngle+=Math.PI*2;if(deltaAngle>Math.PI*2)deltaAngle-=Math.PI*2;var angle;if(this.aClockwise===true){angle=this.aEndAngle+(1-t)*(Math.PI*2-deltaAngle)}else{angle=this.aStartAngle+t*deltaAngle}var vector=new THREE.Vector2;vector.x=this.aX+this.xRadius*Math.cos(angle);vector.y=this.aY+this.yRadius*Math.sin(angle);return vector};THREE.ArcCurve=function(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){THREE.EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)};THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype);THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.LineCurve3=THREE.Curve.create(function(v1,v2){this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.subVectors(this.v2,this.v1);vector.multiplyScalar(t);vector.add(this.v1);return vector});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(v0,v1,v2){this.v0=v0;this.v1=v1;this.v2=v2},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b2(t,this.v0.x,this.v1.x,this.v2.x);vector.y=THREE.Shape.Utils.b2(t,this.v0.y,this.v1.y,this.v2.y);vector.z=THREE.Shape.Utils.b2(t,this.v0.z,this.v1.z,this.v2.z);return vector});THREE.CubicBezierCurve3=THREE.Curve.create(function(v0,v1,v2,v3){this.v0=v0;this.v1=v1;this.v2=v2;this.v3=v3},function(t){var vector=new THREE.Vector3;vector.x=THREE.Shape.Utils.b3(t,this.v0.x,this.v1.x,this.v2.x,this.v3.x);vector.y=THREE.Shape.Utils.b3(t,this.v0.y,this.v1.y,this.v2.y,this.v3.y);vector.z=THREE.Shape.Utils.b3(t,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return vector});THREE.SplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-1)*t;var intPoint=Math.floor(point);var weight=point-intPoint;var point0=points[intPoint==0?intPoint:intPoint-1];var point1=points[intPoint];var point2=points[intPoint>points.length-2?points.length-1:intPoint+1];var point3=points[intPoint>points.length-3?points.length-1:intPoint+2];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.ClosedSplineCurve3=THREE.Curve.create(function(points){this.points=points==undefined?[]:points},function(t){var points=this.points;var point=(points.length-0)*t;var intPoint=Math.floor(point);var weight=point-intPoint;intPoint+=intPoint>0?0:(Math.floor(Math.abs(intPoint)/points.length)+1)*points.length;var point0=points[(intPoint-1)%points.length];var point1=points[intPoint%points.length];var point2=points[(intPoint+1)%points.length];var point3=points[(intPoint+2)%points.length];var vector=new THREE.Vector3;vector.x=THREE.Curve.Utils.interpolate(point0.x,point1.x,point2.x,point3.x,weight);vector.y=THREE.Curve.Utils.interpolate(point0.y,point1.y,point2.y,point3.y,weight);vector.z=THREE.Curve.Utils.interpolate(point0.z,point1.z,point2.z,point3.z,weight);return vector});THREE.AnimationHandler={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2,add:function(){THREE.warn("THREE.AnimationHandler.add() has been deprecated.")},get:function(){THREE.warn("THREE.AnimationHandler.get() has been deprecated.")},remove:function(){THREE.warn("THREE.AnimationHandler.remove() has been deprecated.")},animations:[],init:function(data){if(data.initialized===true)return data;for(var h=0;h<data.hierarchy.length;h++){for(var k=0;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time<0){data.hierarchy[h].keys[k].time=0}if(data.hierarchy[h].keys[k].rot!==undefined&&!(data.hierarchy[h].keys[k].rot instanceof THREE.Quaternion)){var quat=data.hierarchy[h].keys[k].rot;data.hierarchy[h].keys[k].rot=(new THREE.Quaternion).fromArray(quat)}}if(data.hierarchy[h].keys.length&&data.hierarchy[h].keys[0].morphTargets!==undefined){var usedMorphTargets={};for(var k=0;k<data.hierarchy[h].keys.length;k++){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){var morphTargetName=data.hierarchy[h].keys[k].morphTargets[m];usedMorphTargets[morphTargetName]=-1}}data.hierarchy[h].usedMorphTargets=usedMorphTargets;for(var k=0;k<data.hierarchy[h].keys.length;k++){var influences={};for(var morphTargetName in usedMorphTargets){for(var m=0;m<data.hierarchy[h].keys[k].morphTargets.length;m++){if(data.hierarchy[h].keys[k].morphTargets[m]===morphTargetName){influences[morphTargetName]=data.hierarchy[h].keys[k].morphTargetsInfluences[m];break}}if(m===data.hierarchy[h].keys[k].morphTargets.length){influences[morphTargetName]=0}}data.hierarchy[h].keys[k].morphTargetsInfluences=influences}}for(var k=1;k<data.hierarchy[h].keys.length;k++){if(data.hierarchy[h].keys[k].time===data.hierarchy[h].keys[k-1].time){data.hierarchy[h].keys.splice(k,1);k--}}for(var k=0;k<data.hierarchy[h].keys.length;k++){data.hierarchy[h].keys[k].index=k}}data.initialized=true;return data},parse:function(root){var parseRecurseHierarchy=function(root,hierarchy){hierarchy.push(root);for(var c=0;c<root.children.length;c++)parseRecurseHierarchy(root.children[c],hierarchy)};var hierarchy=[];if(root instanceof THREE.SkinnedMesh){for(var b=0;b<root.skeleton.bones.length;b++){hierarchy.push(root.skeleton.bones[b])}}else{parseRecurseHierarchy(root,hierarchy)}return hierarchy},play:function(animation){if(this.animations.indexOf(animation)===-1){this.animations.push(animation)}},stop:function(animation){var index=this.animations.indexOf(animation);if(index!==-1){this.animations.splice(index,1)}},update:function(deltaTimeMS){for(var i=0;i<this.animations.length;i++){this.animations[i].resetBlendWeights()}for(var i=0;i<this.animations.length;i++){this.animations[i].update(deltaTimeMS)}}};THREE.Animation=function(root,data){this.root=root;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(root);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=true;this.weight=0;this.interpolationType=THREE.AnimationHandler.LINEAR};THREE.Animation.prototype={constructor:THREE.Animation,keyTypes:["pos","rot","scl"],play:function(startTime,weight){this.currentTime=startTime!==undefined?startTime:0;this.weight=weight!==undefined?weight:1;this.isPlaying=true;this.reset();THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;THREE.AnimationHandler.stop(this)},reset:function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];if(object.animationCache===undefined){object.animationCache={animations:{},blending:{positionWeight:0,quaternionWeight:0,scaleWeight:0}}}var name=this.data.name;var animations=object.animationCache.animations;var animationCache=animations[name];if(animationCache===undefined){animationCache={prevKey:{pos:0,rot:0,scl:0},nextKey:{pos:0,rot:0,scl:0},originalMatrix:object.matrix};animations[name]=animationCache}for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=this.data.hierarchy[h].keys[0];var nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}}},resetBlendWeights:function(){for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache;if(animationCache!==undefined){var blending=animationCache.blending;blending.positionWeight=0;blending.quaternionWeight=0;blending.scaleWeight=0}}},update:function(){var points=[];var target=new THREE.Vector3;var newVector=new THREE.Vector3;var newQuat=new THREE.Quaternion;var interpolateCatmullRom=function(points,scale){var c=[],v3=[],point,intPoint,weight,w2,w3,pa,pb,pc,pd;point=(points.length-1)*scale;intPoint=Math.floor(point);weight=point-intPoint;c[0]=intPoint===0?intPoint:intPoint-1;c[1]=intPoint;c[2]=intPoint>points.length-2?intPoint:intPoint+1;c[3]=intPoint>points.length-3?intPoint:intPoint+2;pa=points[c[0]];pb=points[c[1]];pc=points[c[2]];pd=points[c[3]];w2=weight*weight;w3=weight*w2;v3[0]=interpolate(pa[0],pb[0],pc[0],pd[0],weight,w2,w3);v3[1]=interpolate(pa[1],pb[1],pc[1],pd[1],weight,w2,w3);v3[2]=interpolate(pa[2],pb[2],pc[2],pd[2],weight,w2,w3);return v3};var interpolate=function(p0,p1,p2,p3,t,t2,t3){var v0=(p2-p0)*.5,v1=(p3-p1)*.5;return(2*(p1-p2)+v0+v1)*t3+(-3*(p1-p2)-2*v0-v1)*t2+v0*t+p1};return function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;if(this.weight===0)return;var duration=this.data.length;if(this.currentTime>duration||this.currentTime<0){if(this.loop){this.currentTime%=duration;if(this.currentTime<0)this.currentTime+=duration;this.reset()}else{this.stop()}}for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var animationCache=object.animationCache.animations[this.data.name];var blending=object.animationCache.blending;for(var t=0;t<3;t++){var type=this.keyTypes[t];var prevKey=animationCache.prevKey[type];var nextKey=animationCache.nextKey[type];if(this.timeScale>0&&nextKey.time<=this.currentTime||this.timeScale<0&&prevKey.time>=this.currentTime){prevKey=this.data.hierarchy[h].keys[0];nextKey=this.getNextKeyWith(type,h,1);while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=this.getNextKeyWith(type,h,nextKey.index+1)}animationCache.prevKey[type]=prevKey;animationCache.nextKey[type]=nextKey}var scale=(this.currentTime-prevKey.time)/(nextKey.time-prevKey.time);var prevXYZ=prevKey[type];var nextXYZ=nextKey[type];if(scale<0)scale=0;if(scale>1)scale=1;if(type==="pos"){if(this.interpolationType===THREE.AnimationHandler.LINEAR){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.positionWeight);object.position.lerp(newVector,proportionalWeight);blending.positionWeight+=this.weight}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){points[0]=this.getPrevKeyWith("pos",h,prevKey.index-1)["pos"];points[1]=prevXYZ;points[2]=nextXYZ;points[3]=this.getNextKeyWith("pos",h,nextKey.index+1)["pos"];scale=scale*.33+.33;var currentPoint=interpolateCatmullRom(points,scale);var proportionalWeight=this.weight/(this.weight+blending.positionWeight);blending.positionWeight+=this.weight;var vector=object.position;vector.x=vector.x+(currentPoint[0]-vector.x)*proportionalWeight;vector.y=vector.y+(currentPoint[1]-vector.y)*proportionalWeight;vector.z=vector.z+(currentPoint[2]-vector.z)*proportionalWeight;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){var forwardPoint=interpolateCatmullRom(points,scale*1.01);target.set(forwardPoint[0],forwardPoint[1],forwardPoint[2]);target.sub(vector);target.y=0;target.normalize();var angle=Math.atan2(target.x,target.z);object.rotation.set(0,angle,0)}}}else if(type==="rot"){THREE.Quaternion.slerp(prevXYZ,nextXYZ,newQuat,scale);if(blending.quaternionWeight===0){object.quaternion.copy(newQuat);blending.quaternionWeight=this.weight}else{var proportionalWeight=this.weight/(this.weight+blending.quaternionWeight);THREE.Quaternion.slerp(object.quaternion,newQuat,object.quaternion,proportionalWeight);blending.quaternionWeight+=this.weight}}else if(type==="scl"){newVector.x=prevXYZ[0]+(nextXYZ[0]-prevXYZ[0])*scale;newVector.y=prevXYZ[1]+(nextXYZ[1]-prevXYZ[1])*scale;newVector.z=prevXYZ[2]+(nextXYZ[2]-prevXYZ[2])*scale;var proportionalWeight=this.weight/(this.weight+blending.scaleWeight);object.scale.lerp(newVector,proportionalWeight);blending.scaleWeight+=this.weight}}}return true}}(),getNextKeyWith:function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key<keys.length-1?key:keys.length-1}else{key=key%keys.length}for(;key<keys.length;key++){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[0]},getPrevKeyWith:function(type,h,key){var keys=this.data.hierarchy[h].keys;if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){key=key>0?key:0}else{key=key>=0?key:key+keys.length}for(;key>=0;key--){if(keys[key][type]!==undefined){return keys[key]}}return this.data.hierarchy[h].keys[keys.length-1]}};THREE.KeyFrameAnimation=function(data){this.root=data.node;this.data=THREE.AnimationHandler.init(data);this.hierarchy=THREE.AnimationHandler.parse(this.root);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.isPaused=true;this.loop=true;for(var h=0,hl=this.hierarchy.length;h<hl;h++){var keys=this.data.hierarchy[h].keys,sids=this.data.hierarchy[h].sids,obj=this.hierarchy[h];if(keys.length&&sids){for(var s=0;s<sids.length;s++){var sid=sids[s],next=this.getNextKeyWith(sid,h,0);if(next){next.apply(sid)}}obj.matrixAutoUpdate=false;this.data.hierarchy[h].node.updateMatrix();obj.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype={constructor:THREE.KeyFrameAnimation,play:function(startTime){this.currentTime=startTime!==undefined?startTime:0;if(this.isPlaying===false){this.isPlaying=true;var h,hl=this.hierarchy.length,object,node;for(h=0;h<hl;h++){object=this.hierarchy[h];node=this.data.hierarchy[h];if(node.animationCache===undefined){node.animationCache={};node.animationCache.prevKey=null;node.animationCache.nextKey=null;node.animationCache.originalMatrix=object.matrix}var keys=this.data.hierarchy[h].keys;if(keys.length){node.animationCache.prevKey=keys[0];node.animationCache.nextKey=keys[1];this.startTime=Math.min(keys[0].time,this.startTime);this.endTime=Math.max(keys[keys.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.play(this)},stop:function(){this.isPlaying=false;this.isPaused=false;THREE.AnimationHandler.stop(this);for(var h=0;h<this.data.hierarchy.length;h++){var obj=this.hierarchy[h];var node=this.data.hierarchy[h];if(node.animationCache!==undefined){var original=node.animationCache.originalMatrix;original.copy(obj.matrix);obj.matrix=original;delete node.animationCache}}},update:function(delta){if(this.isPlaying===false)return;this.currentTime+=delta*this.timeScale;var duration=this.data.length;if(this.loop===true&&this.currentTime>duration){this.currentTime%=duration}this.currentTime=Math.min(this.currentTime,duration);for(var h=0,hl=this.hierarchy.length;h<hl;h++){var object=this.hierarchy[h];var node=this.data.hierarchy[h];var keys=node.keys,animationCache=node.animationCache;if(keys.length){var prevKey=animationCache.prevKey;var nextKey=animationCache.nextKey;if(nextKey.time<=this.currentTime){while(nextKey.time<this.currentTime&&nextKey.index>prevKey.index){prevKey=nextKey;nextKey=keys[prevKey.index+1]}animationCache.prevKey=prevKey;animationCache.nextKey=nextKey}if(nextKey.time>=this.currentTime){prevKey.interpolate(nextKey,this.currentTime)}else{prevKey.interpolate(nextKey,nextKey.time)}this.data.hierarchy[h].node.updateMatrix();object.matrixWorldNeedsUpdate=true}}},getNextKeyWith:function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key%keys.length;for(;key<keys.length;key++){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[0]},getPrevKeyWith:function(sid,h,key){var keys=this.data.hierarchy[h].keys;key=key>=0?key:key+keys.length;for(;key>=0;key--){if(keys[key].hasTarget(sid)){return keys[key]}}return keys[keys.length-1]}};THREE.MorphAnimation=function(mesh){this.mesh=mesh;this.frames=mesh.morphTargetInfluences.length;this.currentTime=0;this.duration=1e3;this.loop=true;this.lastFrame=0;this.currentFrame=0;this.isPlaying=false};THREE.MorphAnimation.prototype={constructor:THREE.MorphAnimation,play:function(){this.isPlaying=true},pause:function(){this.isPlaying=false},update:function(delta){if(this.isPlaying===false)return;this.currentTime+=delta;if(this.loop===true&&this.currentTime>this.duration){this.currentTime%=this.duration}this.currentTime=Math.min(this.currentTime,this.duration);var interpolation=this.duration/this.frames;var frame=Math.floor(this.currentTime/interpolation);var influences=this.mesh.morphTargetInfluences;if(frame!=this.currentFrame){influences[this.lastFrame]=0;influences[this.currentFrame]=1;influences[frame]=0;this.lastFrame=this.currentFrame;this.currentFrame=frame}influences[frame]=this.currentTime%interpolation/interpolation;influences[this.lastFrame]=1-influences[frame]}};THREE.BoxGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){THREE.Geometry.call(this);this.type="BoxGeometry";this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};this.widthSegments=widthSegments||1;this.heightSegments=heightSegments||1;this.depthSegments=depthSegments||1;var scope=this;var width_half=width/2;var height_half=height/2;var depth_half=depth/2;buildPlane("z","y",-1,-1,depth,height,width_half,0);buildPlane("z","y",1,-1,depth,height,-width_half,1);buildPlane("x","z",1,1,width,depth,height_half,2);buildPlane("x","z",1,-1,width,depth,-height_half,3);buildPlane("x","y",1,-1,width,height,depth_half,4);buildPlane("x","y",-1,-1,width,height,-depth_half,5);function buildPlane(u,v,udir,vdir,width,height,depth,materialIndex){var w,ix,iy,gridX=scope.widthSegments,gridY=scope.heightSegments,width_half=width/2,height_half=height/2,offset=scope.vertices.length;if(u==="x"&&v==="y"||u==="y"&&v==="x"){w="z"}else if(u==="x"&&v==="z"||u==="z"&&v==="x"){w="y";gridY=scope.depthSegments}else if(u==="z"&&v==="y"||u==="y"&&v==="z"){w="x";gridX=scope.depthSegments}var gridX1=gridX+1,gridY1=gridY+1,segment_width=width/gridX,segment_height=height/gridY,normal=new THREE.Vector3;normal[w]=depth>0?1:-1;for(iy=0;iy<gridY1;iy++){for(ix=0;ix<gridX1;ix++){var vector=new THREE.Vector3;vector[u]=(ix*segment_width-width_half)*udir;vector[v]=(iy*segment_height-height_half)*vdir;vector[w]=depth;scope.vertices.push(vector)}}for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;var uva=new THREE.Vector2(ix/gridX,1-iy/gridY);var uvb=new THREE.Vector2(ix/gridX,1-(iy+1)/gridY);var uvc=new THREE.Vector2((ix+1)/gridX,1-(iy+1)/gridY);var uvd=new THREE.Vector2((ix+1)/gridX,1-iy/gridY);var face=new THREE.Face3(a+offset,b+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uva,uvb,uvd]);face=new THREE.Face3(b+offset,c+offset,d+offset);face.normal.copy(normal);face.vertexNormals.push(normal.clone(),normal.clone(),normal.clone());face.materialIndex=materialIndex;scope.faces.push(face);scope.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}}this.mergeVertices()};THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.BoxGeometry.prototype.constructor=THREE.BoxGeometry;THREE.CircleGeometry=function(radius,segments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;segments=segments!==undefined?Math.max(3,segments):8;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;var i,uvs=[],center=new THREE.Vector3,centerUV=new THREE.Vector2(.5,.5);this.vertices.push(center);uvs.push(centerUV);for(i=0;i<=segments;i++){var vertex=new THREE.Vector3;var segment=thetaStart+i/segments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/radius+1)/2,(vertex.y/radius+1)/2))}var n=new THREE.Vector3(0,0,1);for(i=1;i<=segments;i++){this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[i].clone(),uvs[i+1].clone(),centerUV.clone()])}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CircleGeometry.prototype.constructor=THREE.CircleGeometry;THREE.CubeGeometry=function(width,height,depth,widthSegments,heightSegments,depthSegments){THREE.warn("THREE.CubeGeometry has been renamed to THREE.BoxGeometry.");return new THREE.BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments)};THREE.CylinderGeometry=function(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};radiusTop=radiusTop!==undefined?radiusTop:20;radiusBottom=radiusBottom!==undefined?radiusBottom:20;height=height!==undefined?height:100;radialSegments=radialSegments||8;heightSegments=heightSegments||1;openEnded=openEnded!==undefined?openEnded:false;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:2*Math.PI;var heightHalf=height/2;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];var v=y/heightSegments;var radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments;var vertex=new THREE.Vector3;vertex.x=radius*Math.sin(u*thetaLength+thetaStart);vertex.y=-v*height+heightHalf;vertex.z=radius*Math.cos(u*thetaLength+thetaStart);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}var tanTheta=(radiusBottom-radiusTop)/height;var na,nb;for(x=0;x<radialSegments;x++){if(radiusTop!==0){na=this.vertices[vertices[0][x]].clone();nb=this.vertices[vertices[0][x+1]].clone()}else{na=this.vertices[vertices[1][x]].clone();nb=this.vertices[vertices[1][x+1]].clone()}na.setY(Math.sqrt(na.x*na.x+na.z*na.z)*tanTheta).normalize();nb.setY(Math.sqrt(nb.x*nb.x+nb.z*nb.z)*tanTheta).normalize();for(y=0;y<heightSegments;y++){var v1=vertices[y][x];var v2=vertices[y+1][x];var v3=vertices[y+1][x+1];var v4=vertices[y][x+1];var n1=na.clone();var n2=na.clone();var n3=nb.clone();var n4=nb.clone();var uv1=uvs[y][x].clone();var uv2=uvs[y+1][x].clone();var uv3=uvs[y+1][x+1].clone();var uv4=uvs[y][x+1].clone();this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}if(openEnded===false&&radiusTop>0){this.vertices.push(new THREE.Vector3(0,heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[0][x];var v2=vertices[0][x+1];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,1,0);var n2=new THREE.Vector3(0,1,0);var n3=new THREE.Vector3(0,1,0);var uv1=uvs[0][x].clone();var uv2=uvs[0][x+1].clone();var uv3=new THREE.Vector2(uv2.x,0);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}if(openEnded===false&&radiusBottom>0){this.vertices.push(new THREE.Vector3(0,-heightHalf,0));for(x=0;x<radialSegments;x++){var v1=vertices[heightSegments][x+1];var v2=vertices[heightSegments][x];var v3=this.vertices.length-1;var n1=new THREE.Vector3(0,-1,0);var n2=new THREE.Vector3(0,-1,0);var n3=new THREE.Vector3(0,-1,0);var uv1=uvs[heightSegments][x+1].clone();var uv2=uvs[heightSegments][x].clone();var uv3=new THREE.Vector2(uv2.x,1);this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}}this.computeFaceNormals()};THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(shapes,options){if(typeof shapes==="undefined"){shapes=[];return}THREE.Geometry.call(this);this.type="ExtrudeGeometry";shapes=shapes instanceof Array?shapes:[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(shapes,options){var sl=shapes.length;for(var s=0;s<sl;s++){var shape=shapes[s];this.addShape(shape,options)}};THREE.ExtrudeGeometry.prototype.addShape=function(shape,options){var amount=options.amount!==undefined?options.amount:100;var bevelThickness=options.bevelThickness!==undefined?options.bevelThickness:6;var bevelSize=options.bevelSize!==undefined?options.bevelSize:bevelThickness-2;var bevelSegments=options.bevelSegments!==undefined?options.bevelSegments:3;var bevelEnabled=options.bevelEnabled!==undefined?options.bevelEnabled:true;var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var steps=options.steps!==undefined?options.steps:1;var extrudePath=options.extrudePath;var extrudePts,extrudeByPath=false;var material=options.material;var extrudeMaterial=options.extrudeMaterial;var uvgen=options.UVGenerator!==undefined?options.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;var splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=true;bevelEnabled=false;splineTube=options.frames!==undefined?options.frames:new THREE.TubeGeometry.FrenetFrames(extrudePath,steps,false);binormal=new THREE.Vector3;normal=new THREE.Vector3;position2=new THREE.Vector3}if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0}var ahole,h,hl;var scope=this;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];if(THREE.Shape.Utils.isClockWise(ahole)){holes[h]=ahole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole)}function scalePt2(pt,vec,size){if(!vec)THREE.error("THREE.ExtrudeGeometry: vec does not exist");return vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var EPSILON=1e-10;var v_trans_x,v_trans_y,shrink_by=1;var v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y;var v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y;var v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;var colinear0=v_prev_x*v_next_y-v_prev_y*v_next_x;if(Math.abs(colinear0)>EPSILON){var v_prev_len=Math.sqrt(v_prev_lensq);var v_next_len=Math.sqrt(v_next_x*v_next_x+v_next_y*v_next_y);var ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len;var ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len;var ptNextShift_x=inNext.x-v_next_y/v_next_len;var ptNextShift_y=inNext.y+v_next_x/v_next_len;var sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-(ptNextShift_y-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x);v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;var v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;if(v_trans_lensq<=2){return new THREE.Vector2(v_trans_x,v_trans_y)}else{shrink_by=Math.sqrt(v_trans_lensq/2)}}else{var direction_eq=false;if(v_prev_x>EPSILON){if(v_next_x>EPSILON){direction_eq=true}}else{if(v_prev_x<-EPSILON){if(v_next_x<-EPSILON){direction_eq=true}}else{if(Math.sign(v_prev_y)==Math.sign(v_next_y)){direction_eq=true}}}if(direction_eq){v_trans_x=-v_prev_y;v_trans_y=v_prev_x;shrink_by=Math.sqrt(v_prev_lensq)}else{v_trans_x=v_prev_x;v_trans_y=v_prev_y;shrink_by=Math.sqrt(v_prev_lensq/2)}}return new THREE.Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}var contourMovements=[];for(var i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k])}var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0,il=ahole.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k])}holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z)}}}bs=bevelSize;for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0)}else{normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s)}else{normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}}for(b=bevelSegments-1;b>=0;b--){t=b/bevelSegments;z=bevelThickness*(1-t);bs=bevelSize*Math.sin(t*Math.PI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z)}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z)}}}}buildLidFaces();buildSideFaces();function buildLidFaces(){if(bevelEnabled){var layer=0;var offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset)}layer=steps+bevelSegments*2;offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset)}}else{for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0])}for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}}function buildSideFaces(){var layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);layeroffset+=ahole.length}}function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(--i>=0){j=i;k=i-1;if(k<0)k=contour.length-1;var s=0,sl=steps+bevelSegments*2;for(s=0;s<sl;s++){var slen1=vlen*s;var slen2=vlen*(s+1);var a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d,contour,s,sl,j,k)}}}function v(x,y,z){scope.vertices.push(new THREE.Vector3(x,y,z))}function f3(a,b,c){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,c,null,null,material));var uvs=uvgen.generateTopUV(scope,a,b,c);scope.faceVertexUvs[0].push(uvs)}function f4(a,b,c,d,wallContour,stepIndex,stepsLength,contourIndex1,contourIndex2){a+=shapesOffset;b+=shapesOffset;c+=shapesOffset;d+=shapesOffset;scope.faces.push(new THREE.Face3(a,b,d,null,null,extrudeMaterial));scope.faces.push(new THREE.Face3(b,c,d,null,null,extrudeMaterial));var uvs=uvgen.generateSideWallUV(scope,a,b,c,d);scope.faceVertexUvs[0].push([uvs[0],uvs[1],uvs[3]]);scope.faceVertexUvs[0].push([uvs[1],uvs[2],uvs[3]])}};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(geometry,indexA,indexB,indexC){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];return[new THREE.Vector2(a.x,a.y),new THREE.Vector2(b.x,b.y),new THREE.Vector2(c.x,c.y)]},generateSideWallUV:function(geometry,indexA,indexB,indexC,indexD){var vertices=geometry.vertices;var a=vertices[indexA];var b=vertices[indexB];var c=vertices[indexC];var d=vertices[indexD];if(Math.abs(a.y-b.y)<.01){return[new THREE.Vector2(a.x,1-a.z),new THREE.Vector2(b.x,1-b.z),new THREE.Vector2(c.x,1-c.z),new THREE.Vector2(d.x,1-d.z)]}else{return[new THREE.Vector2(a.y,1-a.z),new THREE.Vector2(b.y,1-b.z),new THREE.Vector2(c.y,1-c.z),new THREE.Vector2(d.y,1-d.z)]}}};THREE.ShapeGeometry=function(shapes,options){THREE.Geometry.call(this);this.type="ShapeGeometry";if(shapes instanceof Array===false)shapes=[shapes];this.addShapeList(shapes,options);this.computeFaceNormals()};THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ShapeGeometry.prototype.constructor=THREE.ShapeGeometry;THREE.ShapeGeometry.prototype.addShapeList=function(shapes,options){for(var i=0,l=shapes.length;i<l;i++){this.addShape(shapes[i],options)}return this};THREE.ShapeGeometry.prototype.addShape=function(shape,options){if(options===undefined)options={};var curveSegments=options.curveSegments!==undefined?options.curveSegments:12;var material=options.material;var uvgen=options.UVGenerator===undefined?THREE.ExtrudeGeometry.WorldUVGenerator:options.UVGenerator;var i,l,hole;var shapesOffset=this.vertices.length;var shapePoints=shape.extractPoints(curveSegments);var vertices=shapePoints.shape;var holes=shapePoints.holes;var reverse=!THREE.Shape.Utils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(i=0,l=holes.length;i<l;i++){hole=holes[i];if(THREE.Shape.Utils.isClockWise(hole)){holes[i]=hole.reverse()}}reverse=false}var faces=THREE.Shape.Utils.triangulateShape(vertices,holes);var contour=vertices;for(i=0,l=holes.length;i<l;i++){hole=holes[i];vertices=vertices.concat(hole)}var vert,vlen=vertices.length;var face,flen=faces.length;for(i=0;i<vlen;i++){vert=vertices[i];this.vertices.push(new THREE.Vector3(vert.x,vert.y,0))}for(i=0;i<flen;i++){face=faces[i];var a=face[0]+shapesOffset;var b=face[1]+shapesOffset;var c=face[2]+shapesOffset;this.faces.push(new THREE.Face3(a,b,c,null,null,material));this.faceVertexUvs[0].push(uvgen.generateTopUV(this,a,b,c))}};THREE.LatheGeometry=function(points,segments,phiStart,phiLength){THREE.Geometry.call(this);this.type="LatheGeometry";this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};segments=segments||12;phiStart=phiStart||0;phiLength=phiLength||2*Math.PI;var inversePointLength=1/(points.length-1);var inverseSegments=1/segments;for(var i=0,il=segments;i<=il;i++){var phi=phiStart+i*inverseSegments*phiLength;var c=Math.cos(phi),s=Math.sin(phi);for(var j=0,jl=points.length;j<jl;j++){var pt=points[j];var vertex=new THREE.Vector3;vertex.x=c*pt.x-s*pt.y;vertex.y=s*pt.x+c*pt.y;vertex.z=pt.z;this.vertices.push(vertex)}}var np=points.length;for(var i=0,il=segments;i<il;i++){for(var j=0,jl=points.length-1;j<jl;j++){var base=j+np*i;var a=base;var b=base+np;var c=base+1+np;var d=base+1;var u0=i*inverseSegments;var v0=j*inversePointLength;var u1=u0+inverseSegments;var v1=v0+inversePointLength;this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([new THREE.Vector2(u0,v0),new THREE.Vector2(u1,v0),new THREE.Vector2(u0,v1)]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([new THREE.Vector2(u1,v0),new THREE.Vector2(u1,v1),new THREE.Vector2(u0,v1)])}}this.mergeVertices();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(width,height,widthSegments,heightSegments){console.info("THREE.PlaneGeometry: Consider using THREE.PlaneBufferGeometry for lower memory footprint.");THREE.Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};this.fromBufferGeometry(new THREE.PlaneBufferGeometry(width,height,widthSegments,heightSegments))};THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.PlaneBufferGeometry=function(width,height,widthSegments,heightSegments){THREE.BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};var width_half=width/2;var height_half=height/2;var gridX=widthSegments||1;var gridY=heightSegments||1;var gridX1=gridX+1;var gridY1=gridY+1;var segment_width=width/gridX;var segment_height=height/gridY;var vertices=new Float32Array(gridX1*gridY1*3);var normals=new Float32Array(gridX1*gridY1*3);var uvs=new Float32Array(gridX1*gridY1*2);var offset=0;var offset2=0;for(var iy=0;iy<gridY1;iy++){var y=iy*segment_height-height_half;for(var ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices[offset]=x;vertices[offset+1]=-y;normals[offset+2]=1;uvs[offset2]=ix/gridX;uvs[offset2+1]=1-iy/gridY;offset+=3;offset2+=2}}offset=0;var indices=new(vertices.length/3>65535?Uint32Array:Uint16Array)(gridX*gridY*6);for(var iy=0;iy<gridY;iy++){for(var ix=0;ix<gridX;ix++){var a=ix+gridX1*iy;var b=ix+gridX1*(iy+1);var c=ix+1+gridX1*(iy+1);var d=ix+1+gridX1*iy;indices[offset]=a;indices[offset+1]=b;indices[offset+2]=d;indices[offset+3]=b;indices[offset+4]=c;indices[offset+5]=d;offset+=6}}this.addAttribute("index",new THREE.BufferAttribute(indices,1));this.addAttribute("position",new THREE.BufferAttribute(vertices,3));this.addAttribute("normal",new THREE.BufferAttribute(normals,3));this.addAttribute("uv",new THREE.BufferAttribute(uvs,2))};THREE.PlaneBufferGeometry.prototype=Object.create(THREE.BufferGeometry.prototype);THREE.PlaneBufferGeometry.prototype.constructor=THREE.PlaneBufferGeometry;THREE.RingGeometry=function(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};innerRadius=innerRadius||0;outerRadius=outerRadius||50;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI*2;thetaSegments=thetaSegments!==undefined?Math.max(3,thetaSegments):8;phiSegments=phiSegments!==undefined?Math.max(1,phiSegments):8;var i,o,uvs=[],radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments;for(i=0;i<phiSegments+1;i++){for(o=0;o<thetaSegments+1;o++){var vertex=new THREE.Vector3;var segment=thetaStart+o/thetaSegments*thetaLength;vertex.x=radius*Math.cos(segment);vertex.y=radius*Math.sin(segment);this.vertices.push(vertex);uvs.push(new THREE.Vector2((vertex.x/outerRadius+1)/2,(vertex.y/outerRadius+1)/2))}radius+=radiusStep}var n=new THREE.Vector3(0,0,1);for(i=0;i<phiSegments;i++){var thetaSegment=i*(thetaSegments+1);for(o=0;o<thetaSegments;o++){var segment=o+thetaSegment;var v1=segment;var v2=segment+thetaSegments+1;var v3=segment+thetaSegments+2;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()]);v1=segment;v2=segment+thetaSegments+2;v3=segment+1;this.faces.push(new THREE.Face3(v1,v2,v3,[n.clone(),n.clone(),n.clone()]));this.faceVertexUvs[0].push([uvs[v1].clone(),uvs[v2].clone(),uvs[v3].clone()])}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.RingGeometry.prototype.constructor=THREE.RingGeometry;THREE.SphereGeometry=function(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){THREE.Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||50;widthSegments=Math.max(3,Math.floor(widthSegments)||8);heightSegments=Math.max(2,Math.floor(heightSegments)||6);phiStart=phiStart!==undefined?phiStart:0;phiLength=phiLength!==undefined?phiLength:Math.PI*2;thetaStart=thetaStart!==undefined?thetaStart:0;thetaLength=thetaLength!==undefined?thetaLength:Math.PI;var x,y,vertices=[],uvs=[];for(y=0;y<=heightSegments;y++){var verticesRow=[];var uvsRow=[];for(x=0;x<=widthSegments;x++){var u=x/widthSegments;var v=y/heightSegments;var vertex=new THREE.Vector3;vertex.x=-radius*Math.cos(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);vertex.y=radius*Math.cos(thetaStart+v*thetaLength);vertex.z=radius*Math.sin(phiStart+u*phiLength)*Math.sin(thetaStart+v*thetaLength);this.vertices.push(vertex);verticesRow.push(this.vertices.length-1);uvsRow.push(new THREE.Vector2(u,1-v))}vertices.push(verticesRow);uvs.push(uvsRow)}for(y=0;y<heightSegments;y++){for(x=0;x<widthSegments;x++){var v1=vertices[y][x+1];var v2=vertices[y][x];var v3=vertices[y+1][x];var v4=vertices[y+1][x+1];var n1=this.vertices[v1].clone().normalize();var n2=this.vertices[v2].clone().normalize();var n3=this.vertices[v3].clone().normalize();var n4=this.vertices[v4].clone().normalize();var uv1=uvs[y][x+1].clone();var uv2=uvs[y][x].clone();var uv3=uvs[y+1][x].clone();var uv4=uvs[y+1][x+1].clone();if(Math.abs(this.vertices[v1].y)===radius){uv1.x=(uv1.x+uv2.x)/2;this.faces.push(new THREE.Face3(v1,v3,v4,[n1,n3,n4]));this.faceVertexUvs[0].push([uv1,uv3,uv4])}else if(Math.abs(this.vertices[v3].y)===radius){uv3.x=(uv3.x+uv4.x)/2;this.faces.push(new THREE.Face3(v1,v2,v3,[n1,n2,n3]));this.faceVertexUvs[0].push([uv1,uv2,uv3])}else{this.faces.push(new THREE.Face3(v1,v2,v4,[n1,n2,n4]));this.faceVertexUvs[0].push([uv1,uv2,uv4]);this.faces.push(new THREE.Face3(v2,v3,v4,[n2.clone(),n3,n4.clone()]));this.faceVertexUvs[0].push([uv2.clone(),uv3,uv4.clone()])}}}this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius)};THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(text,parameters){parameters=parameters||{};var textShapes=THREE.FontUtils.generateShapes(text,parameters);parameters.amount=parameters.height!==undefined?parameters.height:50;if(parameters.bevelThickness===undefined)parameters.bevelThickness=10;if(parameters.bevelSize===undefined)parameters.bevelSize=8;if(parameters.bevelEnabled===undefined)parameters.bevelEnabled=false;THREE.ExtrudeGeometry.call(this,textShapes,parameters);this.type="TextGeometry"};THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype);THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.TorusGeometry=function(radius,tube,radialSegments,tubularSegments,arc){THREE.Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};radius=radius||100;tube=tube||40;radialSegments=radialSegments||8;tubularSegments=tubularSegments||6;arc=arc||Math.PI*2;var center=new THREE.Vector3,uvs=[],normals=[];for(var j=0;j<=radialSegments;j++){for(var i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc;var v=j/radialSegments*Math.PI*2;center.x=radius*Math.cos(u);center.y=radius*Math.sin(u);var vertex=new THREE.Vector3;vertex.x=(radius+tube*Math.cos(v))*Math.cos(u);vertex.y=(radius+tube*Math.cos(v))*Math.sin(u);vertex.z=tube*Math.sin(v);this.vertices.push(vertex);uvs.push(new THREE.Vector2(i/tubularSegments,j/radialSegments));normals.push(vertex.clone().sub(center).normalize())}}for(var j=1;j<=radialSegments;j++){for(var i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1;var b=(tubularSegments+1)*(j-1)+i-1;var c=(tubularSegments+1)*(j-1)+i;var d=(tubularSegments+1)*j+i;var face=new THREE.Face3(a,b,d,[normals[a].clone(),normals[b].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[a].clone(),uvs[b].clone(),uvs[d].clone()]);face=new THREE.Face3(b,c,d,[normals[b].clone(),normals[c].clone(),normals[d].clone()]);this.faces.push(face);this.faceVertexUvs[0].push([uvs[b].clone(),uvs[c].clone(),uvs[d].clone()])}}this.computeFaceNormals()};THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(radius,tube,radialSegments,tubularSegments,p,q,heightScale){THREE.Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,p:p,q:q,heightScale:heightScale};radius=radius||100;tube=tube||40;radialSegments=radialSegments||64;tubularSegments=tubularSegments||8;p=p||2;q=q||3;heightScale=heightScale||1;var grid=new Array(radialSegments);var tang=new THREE.Vector3;var n=new THREE.Vector3;var bitan=new THREE.Vector3;for(var i=0;i<radialSegments;++i){grid[i]=new Array(tubularSegments);var u=i/radialSegments*2*p*Math.PI;var p1=getPos(u,q,p,radius,heightScale);var p2=getPos(u+.01,q,p,radius,heightScale);tang.subVectors(p2,p1);n.addVectors(p2,p1);bitan.crossVectors(tang,n);n.crossVectors(bitan,tang);bitan.normalize();n.normalize();for(var j=0;j<tubularSegments;++j){var v=j/tubularSegments*2*Math.PI;var cx=-tube*Math.cos(v);var cy=tube*Math.sin(v);var pos=new THREE.Vector3;pos.x=p1.x+cx*n.x+cy*bitan.x;pos.y=p1.y+cx*n.y+cy*bitan.y;pos.z=p1.z+cx*n.z+cy*bitan.z;grid[i][j]=this.vertices.push(pos)-1}}for(var i=0;i<radialSegments;++i){for(var j=0;j<tubularSegments;++j){var ip=(i+1)%radialSegments;var jp=(j+1)%tubularSegments;var a=grid[i][j];var b=grid[ip][j];var c=grid[ip][jp];var d=grid[i][jp];var uva=new THREE.Vector2(i/radialSegments,j/tubularSegments);var uvb=new THREE.Vector2((i+1)/radialSegments,j/tubularSegments);var uvc=new THREE.Vector2((i+1)/radialSegments,(j+1)/tubularSegments);var uvd=new THREE.Vector2(i/radialSegments,(j+1)/tubularSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals();function getPos(u,in_q,in_p,radius,heightScale){var cu=Math.cos(u);var su=Math.sin(u);var quOverP=in_q/in_p*u;var cs=Math.cos(quOverP);var tx=radius*(2+cs)*.5*cu;var ty=radius*(2+cs)*su*.5;var tz=heightScale*radius*Math.sin(quOverP)*.5;return new THREE.Vector3(tx,ty,tz)}};THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(path,segments,radius,radialSegments,closed,taper){THREE.Geometry.call(this);this.type="TubeGeometry";this.parameters={path:path,segments:segments,radius:radius,radialSegments:radialSegments,closed:closed};segments=segments||64;radius=radius||1;radialSegments=radialSegments||8;closed=closed||false;taper=taper||THREE.TubeGeometry.NoTaper;var grid=[];var scope=this,tangent,normal,binormal,numpoints=segments+1,u,v,r,cx,cy,pos,pos2=new THREE.Vector3,i,j,ip,jp,a,b,c,d,uva,uvb,uvc,uvd;var frames=new THREE.TubeGeometry.FrenetFrames(path,segments,closed),tangents=frames.tangents,normals=frames.normals,binormals=frames.binormals;this.tangents=tangents;this.normals=normals;this.binormals=binormals;function vert(x,y,z){return scope.vertices.push(new THREE.Vector3(x,y,z))-1}for(i=0;i<numpoints;i++){grid[i]=[];u=i/(numpoints-1);pos=path.getPointAt(u);tangent=tangents[i];normal=normals[i];binormal=binormals[i];r=radius*taper(u);for(j=0;j<radialSegments;j++){v=j/radialSegments*2*Math.PI;cx=-r*Math.cos(v);cy=r*Math.sin(v);pos2.copy(pos);pos2.x+=cx*normal.x+cy*binormal.x;pos2.y+=cx*normal.y+cy*binormal.y;pos2.z+=cx*normal.z+cy*binormal.z;grid[i][j]=vert(pos2.x,pos2.y,pos2.z)}}for(i=0;i<segments;i++){for(j=0;j<radialSegments;j++){ip=closed?(i+1)%segments:i+1;jp=(j+1)%radialSegments;a=grid[i][j];b=grid[ip][j];c=grid[ip][jp];d=grid[i][jp];uva=new THREE.Vector2(i/segments,j/radialSegments);uvb=new THREE.Vector2((i+1)/segments,j/radialSegments);uvc=new THREE.Vector2((i+1)/segments,(j+1)/radialSegments);uvd=new THREE.Vector2(i/segments,(j+1)/radialSegments);this.faces.push(new THREE.Face3(a,b,d));this.faceVertexUvs[0].push([uva,uvb,uvd]);this.faces.push(new THREE.Face3(b,c,d));this.faceVertexUvs[0].push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.NoTaper=function(u){return 1};THREE.TubeGeometry.SinusoidalTaper=function(u){return Math.sin(Math.PI*u)};THREE.TubeGeometry.FrenetFrames=function(path,segments,closed){var normal=new THREE.Vector3,tangents=[],normals=[],binormals=[],vec=new THREE.Vector3,mat=new THREE.Matrix4,numpoints=segments+1,theta,epsilon=1e-4,smallest,tx,ty,tz,i,u;this.tangents=tangents;this.normals=normals;this.binormals=binormals;for(i=0;i<numpoints;i++){u=i/(numpoints-1);tangents[i]=path.getTangentAt(u);tangents[i].normalize()}initialNormal3();function initialNormal3(){normals[0]=new THREE.Vector3;binormals[0]=new THREE.Vector3;smallest=Number.MAX_VALUE;tx=Math.abs(tangents[0].x);ty=Math.abs(tangents[0].y);tz=Math.abs(tangents[0].z);if(tx<=smallest){smallest=tx;normal.set(1,0,0)}if(ty<=smallest){smallest=ty;normal.set(0,1,0)}if(tz<=smallest){normal.set(0,0,1)}vec.crossVectors(tangents[0],normal).normalize();normals[0].crossVectors(tangents[0],vec);binormals[0].crossVectors(tangents[0],normals[0])}for(i=1;i<numpoints;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.crossVectors(tangents[i-1],tangents[i]);if(vec.length()>epsilon){vec.normalize();theta=Math.acos(THREE.Math.clamp(tangents[i-1].dot(tangents[i]),-1,1));normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))}binormals[i].crossVectors(tangents[i],normals[i])}if(closed){theta=Math.acos(THREE.Math.clamp(normals[0].dot(normals[numpoints-1]),-1,1));theta/=numpoints-1;if(tangents[0].dot(vec.crossVectors(normals[0],normals[numpoints-1]))>0){theta=-theta}for(i=1;i<numpoints;i++){normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i));binormals[i].crossVectors(tangents[i],normals[i])}}};THREE.PolyhedronGeometry=function(vertices,indices,radius,detail){THREE.Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};radius=radius||1;detail=detail||0;var that=this;for(var i=0,l=vertices.length;i<l;i+=3){prepare(new THREE.Vector3(vertices[i],vertices[i+1],vertices[i+2]))}var p=this.vertices;var faces=[];for(var i=0,j=0,l=indices.length;i<l;i+=3,j++){var v1=p[indices[i]];var v2=p[indices[i+1]];var v3=p[indices[i+2]];faces[j]=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()])}var centroid=new THREE.Vector3;for(var i=0,l=faces.length;i<l;i++){subdivide(faces[i],detail)}for(var i=0,l=this.faceVertexUvs[0].length;i<l;i++){var uvs=this.faceVertexUvs[0][i];var x0=uvs[0].x;var x1=uvs[1].x;var x2=uvs[2].x;var max=Math.max(x0,Math.max(x1,x2));var min=Math.min(x0,Math.min(x1,x2));if(max>.9&&min<.1){if(x0<.2)uvs[0].x+=1;if(x1<.2)uvs[1].x+=1;if(x2<.2)uvs[2].x+=1}}for(var i=0,l=this.vertices.length;i<l;i++){this.vertices[i].multiplyScalar(radius)}this.mergeVertices();this.computeFaceNormals();this.boundingSphere=new THREE.Sphere(new THREE.Vector3,radius);function prepare(vector){var vertex=vector.normalize().clone();vertex.index=that.vertices.push(vertex)-1;var u=azimuth(vector)/2/Math.PI+.5;var v=inclination(vector)/Math.PI+.5;vertex.uv=new THREE.Vector2(u,1-v);return vertex}function make(v1,v2,v3){var face=new THREE.Face3(v1.index,v2.index,v3.index,[v1.clone(),v2.clone(),v3.clone()]);that.faces.push(face);centroid.copy(v1).add(v2).add(v3).divideScalar(3);var azi=azimuth(centroid);that.faceVertexUvs[0].push([correctUV(v1.uv,v1,azi),correctUV(v2.uv,v2,azi),correctUV(v3.uv,v3,azi)])}function subdivide(face,detail){var cols=Math.pow(2,detail);var a=prepare(that.vertices[face.a]);var b=prepare(that.vertices[face.b]);var c=prepare(that.vertices[face.c]);var v=[];for(var i=0;i<=cols;i++){v[i]=[];var aj=prepare(a.clone().lerp(c,i/cols));var bj=prepare(b.clone().lerp(c,i/cols));var rows=cols-i;for(var j=0;j<=rows;j++){if(j==0&&i==cols){v[i][j]=aj}else{v[i][j]=prepare(aj.clone().lerp(bj,j/rows))}}}for(var i=0;i<cols;i++){for(var j=0;j<2*(cols-i)-1;j++){var k=Math.floor(j/2);if(j%2==0){make(v[i][k+1],v[i+1][k],v[i][k])}else{make(v[i][k+1],v[i+1][k+1],v[i+1][k])}}}}function azimuth(vector){return Math.atan2(vector.z,-vector.x)}function inclination(vector){return Math.atan2(-vector.y,Math.sqrt(vector.x*vector.x+vector.z*vector.z))}function correctUV(uv,vector,azimuth){if(azimuth<0&&uv.x===1)uv=new THREE.Vector2(uv.x-1,uv.y);if(vector.x===0&&vector.z===0)uv=new THREE.Vector2(azimuth/2/Math.PI+.5,uv.y);return uv.clone()}};THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.DodecahedronGeometry=function(radius,detail){this.parameters={radius:radius,detail:detail};var t=(1+Math.sqrt(5))/2;var r=1/t;var vertices=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r];var indices=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail)};THREE.DodecahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.DodecahedronGeometry.prototype.constructor=THREE.DodecahedronGeometry;THREE.IcosahedronGeometry=function(radius,detail){var t=(1+Math.sqrt(5))/2;var vertices=[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1];var indices=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="IcosahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(radius,detail){this.parameters={radius:radius,detail:detail};var vertices=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1];var indices=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="OctahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(radius,detail){var vertices=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1];var indices=[2,1,0,0,3,2,1,3,0,2,3,1];THREE.PolyhedronGeometry.call(this,vertices,indices,radius,detail);this.type="TetrahedronGeometry";this.parameters={radius:radius,detail:detail}};THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(func,slices,stacks){THREE.Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:func,slices:slices,stacks:stacks};var verts=this.vertices;var faces=this.faces;var uvs=this.faceVertexUvs[0];var i,j,p;var u,v;var sliceCount=slices+1;for(i=0;i<=stacks;i++){v=i/stacks;for(j=0;j<=slices;j++){u=j/slices;p=func(u,v);verts.push(p)}}var a,b,c,d;var uva,uvb,uvc,uvd;for(i=0;i<stacks;i++){for(j=0;j<slices;j++){a=i*sliceCount+j;b=i*sliceCount+j+1;c=(i+1)*sliceCount+j+1;d=(i+1)*sliceCount+j;uva=new THREE.Vector2(j/slices,i/stacks);uvb=new THREE.Vector2((j+1)/slices,i/stacks);uvc=new THREE.Vector2((j+1)/slices,(i+1)/stacks);uvd=new THREE.Vector2(j/slices,(i+1)/stacks);faces.push(new THREE.Face3(a,b,d));uvs.push([uva,uvb,uvd]);faces.push(new THREE.Face3(b,c,d));uvs.push([uvb.clone(),uvc,uvd.clone()])}}this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype);THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.AxisHelper=function(size){size=size||1;var vertices=new Float32Array([0,0,0,size,0,0,0,0,0,0,size,0,0,0,0,0,0,size]);var colors=new Float32Array([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1]);var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(vertices,3));geometry.addAttribute("color",new THREE.BufferAttribute(colors,3));var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,geometry,material,THREE.LinePieces)};THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype);THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(){var lineGeometry=new THREE.Geometry;lineGeometry.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0));var coneGeometry=new THREE.CylinderGeometry(0,.5,1,5,1);coneGeometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));return function(dir,origin,length,color,headLength,headWidth){THREE.Object3D.call(this);if(color===undefined)color=16776960;if(length===undefined)length=1;if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.position.copy(origin);this.line=new THREE.Line(lineGeometry,new THREE.LineBasicMaterial({color:color}));this.line.matrixAutoUpdate=false;this.add(this.line);this.cone=new THREE.Mesh(coneGeometry,new THREE.MeshBasicMaterial({color:color}));this.cone.matrixAutoUpdate=false;this.add(this.cone);this.setDirection(dir);this.setLength(length,headLength,headWidth)}}();THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(){var axis=new THREE.Vector3;var radians;return function(dir){if(dir.y>.99999){this.quaternion.set(0,0,0,1)}else if(dir.y<-.99999){this.quaternion.set(1,0,0,0)}else{axis.set(dir.z,0,-dir.x).normalize();radians=Math.acos(dir.y);this.quaternion.setFromAxisAngle(axis,radians)}}}();THREE.ArrowHelper.prototype.setLength=function(length,headLength,headWidth){if(headLength===undefined)headLength=.2*length;if(headWidth===undefined)headWidth=.2*headLength;this.line.scale.set(1,length-headLength,1);this.line.updateMatrix();this.cone.scale.set(headWidth,headLength,headWidth);this.cone.position.y=length;this.cone.updateMatrix()};THREE.ArrowHelper.prototype.setColor=function(color){this.line.material.color.set(color);this.cone.material.color.set(color)};THREE.BoxHelper=function(object){var geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(72),3));THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces);if(object!==undefined){this.update(object)}};THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype);THREE.BoxHelper.prototype.constructor=THREE.BoxHelper;THREE.BoxHelper.prototype.update=function(object){var geometry=object.geometry;if(geometry.boundingBox===null){geometry.computeBoundingBox()}var min=geometry.boundingBox.min;var max=geometry.boundingBox.max;var vertices=this.geometry.attributes.position.array;vertices[0]=max.x;vertices[1]=max.y;vertices[2]=max.z;vertices[3]=min.x;vertices[4]=max.y;vertices[5]=max.z;vertices[6]=min.x;vertices[7]=max.y;vertices[8]=max.z;vertices[9]=min.x;vertices[10]=min.y;vertices[11]=max.z;vertices[12]=min.x;vertices[13]=min.y;vertices[14]=max.z;vertices[15]=max.x;vertices[16]=min.y;vertices[17]=max.z;vertices[18]=max.x;vertices[19]=min.y;vertices[20]=max.z;vertices[21]=max.x;vertices[22]=max.y;vertices[23]=max.z;vertices[24]=max.x;vertices[25]=max.y;vertices[26]=min.z;vertices[27]=min.x;vertices[28]=max.y;vertices[29]=min.z;vertices[30]=min.x;vertices[31]=max.y;vertices[32]=min.z;vertices[33]=min.x;vertices[34]=min.y;vertices[35]=min.z;vertices[36]=min.x;vertices[37]=min.y;vertices[38]=min.z;vertices[39]=max.x;vertices[40]=min.y;vertices[41]=min.z;vertices[42]=max.x;vertices[43]=min.y;vertices[44]=min.z;vertices[45]=max.x;vertices[46]=max.y;vertices[47]=min.z;vertices[48]=max.x;vertices[49]=max.y;vertices[50]=max.z;vertices[51]=max.x;vertices[52]=max.y;vertices[53]=min.z;vertices[54]=min.x;vertices[55]=max.y;vertices[56]=max.z;vertices[57]=min.x;vertices[58]=max.y;vertices[59]=min.z;vertices[60]=min.x;vertices[61]=min.y;vertices[62]=max.z;vertices[63]=min.x;vertices[64]=min.y;vertices[65]=min.z;vertices[66]=max.x;vertices[67]=min.y;vertices[68]=max.z;vertices[69]=max.x;vertices[70]=min.y;vertices[71]=min.z;this.geometry.attributes.position.needsUpdate=true;this.geometry.computeBoundingSphere();this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.BoundingBoxHelper=function(object,hex){var color=hex!==undefined?hex:8947848;this.object=object;this.box=new THREE.Box3;THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:color,wireframe:true}))};THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.BoundingBoxHelper.prototype.constructor=THREE.BoundingBoxHelper;THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object);this.box.size(this.scale);this.box.center(this.position)};THREE.CameraHelper=function(camera){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});var pointMap={};var hexFrustum=16755200;var hexCone=16711680;var hexUp=43775;var hexTarget=16777215;var hexCross=3355443;addLine("n1","n2",hexFrustum);addLine("n2","n4",hexFrustum);addLine("n4","n3",hexFrustum);addLine("n3","n1",hexFrustum);addLine("f1","f2",hexFrustum);addLine("f2","f4",hexFrustum);addLine("f4","f3",hexFrustum);addLine("f3","f1",hexFrustum);addLine("n1","f1",hexFrustum);addLine("n2","f2",hexFrustum);addLine("n3","f3",hexFrustum);addLine("n4","f4",hexFrustum);addLine("p","n1",hexCone);addLine("p","n2",hexCone);addLine("p","n3",hexCone);addLine("p","n4",hexCone);addLine("u1","u2",hexUp);addLine("u2","u3",hexUp);addLine("u3","u1",hexUp);addLine("c","t",hexTarget);addLine("p","c",hexCross);addLine("cn1","cn2",hexCross);addLine("cn3","cn4",hexCross);addLine("cf1","cf2",hexCross);addLine("cf3","cf4",hexCross);function addLine(a,b,hex){addPoint(a,hex);addPoint(b,hex)}function addPoint(id,hex){geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(hex));if(pointMap[id]===undefined){pointMap[id]=[]}pointMap[id].push(geometry.vertices.length-1)}THREE.Line.call(this,geometry,material,THREE.LinePieces);this.camera=camera;this.matrix=camera.matrixWorld;this.matrixAutoUpdate=false;this.pointMap=pointMap;this.update()};THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype);THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){var geometry,pointMap;var vector=new THREE.Vector3;var camera=new THREE.Camera;var setPoint=function(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(points!==undefined){for(var i=0,il=points.length;i<il;i++){geometry.vertices[points[i]].copy(vector)}}};return function(){geometry=this.geometry;pointMap=this.pointMap;var w=1,h=1;camera.projectionMatrix.copy(this.camera.projectionMatrix);setPoint("c",0,0,-1);setPoint("t",0,0,1);setPoint("n1",-w,-h,-1);setPoint("n2",w,-h,-1);setPoint("n3",-w,h,-1);setPoint("n4",w,h,-1);setPoint("f1",-w,-h,1);setPoint("f2",w,-h,1);setPoint("f3",-w,h,1);setPoint("f4",w,h,1);setPoint("u1",w*.7,h*1.1,-1);setPoint("u2",-w*.7,h*1.1,-1);setPoint("u3",0,h*2,-1);setPoint("cf1",-w,0,1);setPoint("cf2",w,0,1);setPoint("cf3",0,-h,1);setPoint("cf4",0,h,1);setPoint("cn1",-w,0,-1);setPoint("cn2",w,0,-1);setPoint("cn3",0,-h,-1);setPoint("cn4",0,h,-1);geometry.verticesNeedUpdate=true}}();THREE.DirectionalLightHelper=function(light,size){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;size=size||1;var geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3(-size,size,0),new THREE.Vector3(size,size,0),new THREE.Vector3(size,-size,0),new THREE.Vector3(-size,-size,0),new THREE.Vector3(-size,size,0));var material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.lightPlane=new THREE.Line(geometry,material);this.add(this.lightPlane);geometry=new THREE.Geometry;geometry.vertices.push(new THREE.Vector3,new THREE.Vector3);material=new THREE.LineBasicMaterial({fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine=new THREE.Line(geometry,material);this.add(this.targetLine);this.update()};THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.DirectionalLightHelper.prototype.constructor=THREE.DirectionalLightHelper;THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};THREE.DirectionalLightHelper.prototype.update=function(){var v1=new THREE.Vector3;var v2=new THREE.Vector3;var v3=new THREE.Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld);v2.setFromMatrixPosition(this.light.target.matrixWorld);v3.subVectors(v2,v1);this.lightPlane.lookAt(v3);this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity);this.targetLine.geometry.vertices[1].copy(v3);this.targetLine.geometry.verticesNeedUpdate=true;this.targetLine.material.color.copy(this.lightPlane.material.color)}}();THREE.EdgesHelper=function(object,hex,thresholdAngle){var color=hex!==undefined?hex:16777215;thresholdAngle=thresholdAngle!==undefined?thresholdAngle:1;var thresholdDot=Math.cos(THREE.Math.degToRad(thresholdAngle));var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry=new THREE.BufferGeometry;var geometry2;if(object.geometry instanceof THREE.BufferGeometry){geometry2=new THREE.Geometry;geometry2.fromBufferGeometry(object.geometry)}else{geometry2=object.geometry.clone()}geometry2.mergeVertices();geometry2.computeFaceNormals();var vertices=geometry2.vertices;var faces=geometry2.faces;var numEdges=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){hash[key]={vert1:edge[0],vert2:edge[1],face1:i,face2:undefined};numEdges++}else{hash[key].face2=i}}}var coords=new Float32Array(numEdges*2*3);var index=0;for(var key in hash){var h=hash[key];if(h.face2===undefined||faces[h.face1].normal.dot(faces[h.face2].normal)<=thresholdDot){var vertex=vertices[h.vert1];coords[index++]=vertex.x;coords[index++]=vertex.y;coords[index++]=vertex.z;vertex=vertices[h.vert2];coords[index++]=vertex.x;coords[index++]=vertex.y;coords[index++]=vertex.z}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3));THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color}),THREE.LinePieces);this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype);THREE.EdgesHelper.prototype.constructor=THREE.EdgesHelper;THREE.FaceNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16776960;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=this.object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){geometry.vertices.push(new THREE.Vector3,new THREE.Vector3)}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.FaceNormalsHelper.prototype.constructor=THREE.FaceNormalsHelper;THREE.FaceNormalsHelper.prototype.update=function(){var vertices=this.geometry.vertices;var object=this.object;var objectVertices=object.geometry.vertices;var objectFaces=object.geometry.faces;var objectWorldMatrix=object.matrixWorld;object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(objectWorldMatrix);for(var i=0,i2=0,l=objectFaces.length;i<l;i++,i2+=2){var face=objectFaces[i];vertices[i2].copy(objectVertices[face.a]).add(objectVertices[face.b]).add(objectVertices[face.c]).divideScalar(3).applyMatrix4(objectWorldMatrix);vertices[i2+1].copy(face.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size).add(vertices[i2])}this.geometry.verticesNeedUpdate=true;return this};THREE.GridHelper=function(size,step){var geometry=new THREE.Geometry;var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924);this.color2=new THREE.Color(8947848);for(var i=-size;i<=size;i+=step){geometry.vertices.push(new THREE.Vector3(-size,0,i),new THREE.Vector3(size,0,i),new THREE.Vector3(i,0,-size),new THREE.Vector3(i,0,size));var color=i===0?this.color1:this.color2;geometry.colors.push(color,color,color,color)}THREE.Line.call(this,geometry,material,THREE.LinePieces)};THREE.GridHelper.prototype=Object.create(THREE.Line.prototype);THREE.GridHelper.prototype.constructor=THREE.GridHelper;THREE.GridHelper.prototype.setColors=function(colorCenterLine,colorGrid){this.color1.set(colorCenterLine);this.color2.set(colorGrid);this.geometry.colorsNeedUpdate=true};THREE.HemisphereLightHelper=function(light,sphereSize){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;this.colors=[new THREE.Color,new THREE.Color];var geometry=new THREE.SphereGeometry(sphereSize,4,2);geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var i=0,il=8;i<il;i++){geometry.faces[i].color=this.colors[i<4?0:1]}var material=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:true});this.lightSphere=new THREE.Mesh(geometry,material);this.add(this.lightSphere);this.update()};THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.HemisphereLightHelper.prototype.constructor=THREE.HemisphereLightHelper;THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose();this.lightSphere.material.dispose()};THREE.HemisphereLightHelper.prototype.update=function(){var vector=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity);this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity);this.lightSphere.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate());this.lightSphere.geometry.colorsNeedUpdate=true}}();THREE.PointLightHelper=function(light,sphereSize){this.light=light;this.light.updateMatrixWorld();var geometry=new THREE.SphereGeometry(sphereSize,4,2);var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});material.color.copy(this.light.color).multiplyScalar(this.light.intensity);THREE.Mesh.call(this,geometry,material);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=false};THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype);THREE.PointLightHelper.prototype.constructor=THREE.PointLightHelper;THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)};THREE.SkeletonHelper=function(object){this.bones=this.getBoneList(object);var geometry=new THREE.Geometry;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3);geometry.colors.push(new THREE.Color(0,0,1));geometry.colors.push(new THREE.Color(0,1,0))}}var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:false,depthWrite:false,transparent:true});THREE.Line.call(this,geometry,material,THREE.LinePieces);this.root=object;this.matrix=object.matrixWorld;this.matrixAutoUpdate=false;this.update()};THREE.SkeletonHelper.prototype=Object.create(THREE.Line.prototype);THREE.SkeletonHelper.prototype.constructor=THREE.SkeletonHelper;THREE.SkeletonHelper.prototype.getBoneList=function(object){var boneList=[];if(object instanceof THREE.Bone){boneList.push(object)}for(var i=0;i<object.children.length;i++){boneList.push.apply(boneList,this.getBoneList(object.children[i]))}return boneList};THREE.SkeletonHelper.prototype.update=function(){var geometry=this.geometry;var matrixWorldInv=(new THREE.Matrix4).getInverse(this.root.matrixWorld);var boneMatrix=new THREE.Matrix4;var j=0;for(var i=0;i<this.bones.length;i++){var bone=this.bones[i];if(bone.parent instanceof THREE.Bone){boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld);geometry.vertices[j].setFromMatrixPosition(boneMatrix);boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld);geometry.vertices[j+1].setFromMatrixPosition(boneMatrix);j+=2}}geometry.verticesNeedUpdate=true;geometry.computeBoundingSphere()};THREE.SpotLightHelper=function(light){THREE.Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=false;var geometry=new THREE.CylinderGeometry(0,1,1,8,1,true);geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0));geometry.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var material=new THREE.MeshBasicMaterial({wireframe:true,fog:false});this.cone=new THREE.Mesh(geometry,material);this.add(this.cone);this.update()};THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype);THREE.SpotLightHelper.prototype.constructor=THREE.SpotLightHelper;THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};THREE.SpotLightHelper.prototype.update=function(){var vector=new THREE.Vector3;var vector2=new THREE.Vector3;return function(){var coneLength=this.light.distance?this.light.distance:1e4;var coneWidth=coneLength*Math.tan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength);vector.setFromMatrixPosition(this.light.matrixWorld);vector2.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(vector2.sub(vector));this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}();THREE.VertexNormalsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:16711680;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){geometry.vertices.push(new THREE.Vector3,new THREE.Vector3)}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.normalMatrix=new THREE.Matrix3;this.update()};THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexNormalsHelper.prototype.constructor=THREE.VertexNormalsHelper;THREE.VertexNormalsHelper.prototype.update=function(object){var v1=new THREE.Vector3;return function(object){var keys=["a","b","c","d"];this.object.updateMatrixWorld(true);this.normalMatrix.getNormalMatrix(this.object.matrixWorld);var vertices=this.geometry.vertices;var verts=this.object.geometry.vertices;var faces=this.object.geometry.faces;var worldMatrix=this.object.matrixWorld;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){var vertexId=face[keys[j]];var vertex=verts[vertexId];var normal=face.vertexNormals[j];vertices[idx].copy(vertex).applyMatrix4(worldMatrix);v1.copy(normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);v1.add(vertices[idx]);idx=idx+1;vertices[idx].copy(v1);idx=idx+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.VertexTangentsHelper=function(object,size,hex,linewidth){this.object=object;this.size=size!==undefined?size:1;var color=hex!==undefined?hex:255;var width=linewidth!==undefined?linewidth:1;var geometry=new THREE.Geometry;var faces=object.geometry.faces;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexTangents.length;j<jl;j++){geometry.vertices.push(new THREE.Vector3);geometry.vertices.push(new THREE.Vector3)}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color,linewidth:width}),THREE.LinePieces);this.matrixAutoUpdate=false;this.update()};THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype);THREE.VertexTangentsHelper.prototype.constructor=THREE.VertexTangentsHelper;THREE.VertexTangentsHelper.prototype.update=function(object){var v1=new THREE.Vector3;return function(object){var keys=["a","b","c","d"];this.object.updateMatrixWorld(true);var vertices=this.geometry.vertices;var verts=this.object.geometry.vertices;var faces=this.object.geometry.faces;var worldMatrix=this.object.matrixWorld;var idx=0;for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0,jl=face.vertexTangents.length;j<jl;j++){var vertexId=face[keys[j]];var vertex=verts[vertexId];var tangent=face.vertexTangents[j];vertices[idx].copy(vertex).applyMatrix4(worldMatrix);v1.copy(tangent).transformDirection(worldMatrix).multiplyScalar(this.size);v1.add(vertices[idx]);idx=idx+1;vertices[idx].copy(v1);idx=idx+1}}this.geometry.verticesNeedUpdate=true;return this}}();THREE.WireframeHelper=function(object,hex){var color=hex!==undefined?hex:16777215;var edge=[0,0],hash={};var sortFunction=function(a,b){return a-b};var keys=["a","b","c"];var geometry=new THREE.BufferGeometry;if(object.geometry instanceof THREE.Geometry){var vertices=object.geometry.vertices;var faces=object.geometry.faces;var numEdges=0;var edges=new Uint32Array(6*faces.length);for(var i=0,l=faces.length;i<l;i++){var face=faces[i];for(var j=0;j<3;j++){edge[0]=face[keys[j]];edge[1]=face[keys[(j+1)%3]];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var vertex=vertices[edges[2*i+j]];var index=6*i+3*j;coords[index+0]=vertex.x;coords[index+1]=vertex.y;coords[index+2]=vertex.z}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}else if(object.geometry instanceof THREE.BufferGeometry){if(object.geometry.attributes.index!==undefined){var vertices=object.geometry.attributes.position.array;var indices=object.geometry.attributes.index.array;var drawcalls=object.geometry.drawcalls;var numEdges=0;if(drawcalls.length===0){drawcalls=[{count:indices.length,index:0,start:0}]}var edges=new Uint32Array(2*indices.length);for(var o=0,ol=drawcalls.length;o<ol;++o){var start=drawcalls[o].start;var count=drawcalls[o].count;var index=drawcalls[o].index;for(var i=start,il=start+count;i<il;i+=3){for(var j=0;j<3;j++){edge[0]=index+indices[i+j];edge[1]=index+indices[i+(j+1)%3];edge.sort(sortFunction);var key=edge.toString();if(hash[key]===undefined){edges[2*numEdges]=edge[0];edges[2*numEdges+1]=edge[1];hash[key]=true;numEdges++}}}}var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numEdges;i<l;i++){for(var j=0;j<2;j++){var index=6*i+3*j;var index2=3*edges[2*i+j];coords[index+0]=vertices[index2];coords[index+1]=vertices[index2+1];coords[index+2]=vertices[index2+2]}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}else{var vertices=object.geometry.attributes.position.array;var numEdges=vertices.length/3;var numTris=numEdges/3;var coords=new Float32Array(numEdges*2*3);for(var i=0,l=numTris;i<l;i++){for(var j=0;j<3;j++){var index=18*i+6*j;var index1=9*i+3*j;coords[index+0]=vertices[index1];coords[index+1]=vertices[index1+1];coords[index+2]=vertices[index1+2];var index2=9*i+3*((j+1)%3);coords[index+3]=vertices[index2];coords[index+4]=vertices[index2+1];coords[index+5]=vertices[index2+2]}}geometry.addAttribute("position",new THREE.BufferAttribute(coords,3))}}THREE.Line.call(this,geometry,new THREE.LineBasicMaterial({color:color}),THREE.LinePieces);this.matrix=object.matrixWorld;this.matrixAutoUpdate=false};THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype);THREE.WireframeHelper.prototype.constructor=THREE.WireframeHelper;THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(renderCallback){}};THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype);THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.MorphBlendMesh=function(geometry,material){THREE.Mesh.call(this,geometry,material);this.animationsMap={};this.animationsList=[];var numFrames=this.geometry.morphTargets.length;var name="__default";var startFrame=0;var endFrame=numFrames-1;var fps=numFrames/1;this.createAnimation(name,startFrame,endFrame,fps);this.setAnimationWeight(name,1)};THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype);THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(name,start,end,fps){var animation={startFrame:start,endFrame:end,length:end-start+1,fps:fps,duration:(end-start)/fps,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[name]=animation;this.animationsList.push(animation)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(fps){var pattern=/([a-z]+)_?(\d+)/;var firstAnimation,frameRanges={};var geometry=this.geometry;for(var i=0,il=geometry.morphTargets.length;i<il;i++){var morph=geometry.morphTargets[i];var chunks=morph.name.match(pattern);if(chunks&&chunks.length>1){var name=chunks[1];if(!frameRanges[name])frameRanges[name]={start:Infinity,end:-Infinity};var range=frameRanges[name];if(i<range.start)range.start=i;if(i>range.end)range.end=i;if(!firstAnimation)firstAnimation=name}}for(var name in frameRanges){var range=frameRanges[name];this.createAnimation(name,range.start,range.end,fps)}this.firstAnimation=firstAnimation};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=1;animation.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(name){var animation=this.animationsMap[name];if(animation){animation.direction=-1;animation.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(name,fps){var animation=this.animationsMap[name];if(animation){animation.fps=fps;animation.duration=(animation.end-animation.start)/animation.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(name,duration){var animation=this.animationsMap[name];if(animation){animation.duration=duration;animation.fps=(animation.end-animation.start)/animation.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(name,weight){var animation=this.animationsMap[name];if(animation){animation.weight=weight}};THREE.MorphBlendMesh.prototype.setAnimationTime=function(name,time){var animation=this.animationsMap[name];if(animation){animation.time=time}};THREE.MorphBlendMesh.prototype.getAnimationTime=function(name){var time=0;var animation=this.animationsMap[name];if(animation){time=animation.time}return time};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(name){var duration=-1;var animation=this.animationsMap[name];if(animation){duration=animation.duration}return duration};THREE.MorphBlendMesh.prototype.playAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.time=0;animation.active=true}else{THREE.warn("THREE.MorphBlendMesh: animation["+name+"] undefined in .playAnimation()")}};THREE.MorphBlendMesh.prototype.stopAnimation=function(name){var animation=this.animationsMap[name];if(animation){animation.active=false}};THREE.MorphBlendMesh.prototype.update=function(delta){for(var i=0,il=this.animationsList.length;i<il;i++){var animation=this.animationsList[i];if(!animation.active)continue;var frameTime=animation.duration/animation.length;animation.time+=animation.direction*delta;if(animation.mirroredLoop){if(animation.time>animation.duration||animation.time<0){animation.direction*=-1;if(animation.time>animation.duration){animation.time=animation.duration;animation.directionBackwards=true}if(animation.time<0){animation.time=0;animation.directionBackwards=false}}}else{animation.time=animation.time%animation.duration;if(animation.time<0)animation.time+=animation.duration}var keyframe=animation.startFrame+THREE.Math.clamp(Math.floor(animation.time/frameTime),0,animation.length-1);var weight=animation.weight;if(keyframe!==animation.currentFrame){this.morphTargetInfluences[animation.lastFrame]=0;this.morphTargetInfluences[animation.currentFrame]=1*weight;this.morphTargetInfluences[keyframe]=0;animation.lastFrame=animation.currentFrame;animation.currentFrame=keyframe}var mix=animation.time%frameTime/frameTime;if(animation.directionBackwards)mix=1-mix;this.morphTargetInfluences[animation.currentFrame]=mix*weight;this.morphTargetInfluences[animation.lastFrame]=(1-mix)*weight}};(function(){var iev=0;var ieold=/MSIE (\d+\.\d+);/.test(navigator.userAgent);var trident=!!navigator.userAgent.match(/Trident\/7.0/);var rv=navigator.userAgent.indexOf("rv:11.0");if(ieold)iev=new Number(RegExp.$1);if(navigator.appVersion.indexOf("MSIE 10")!=-1)iev=10;if(trident&&rv!=-1)iev=11;if(iev>0){HTMLElement.prototype.getBoundingClientRect=function(){var oldGetBoundingClientRect=HTMLElement.prototype.getBoundingClientRect;return function(){try{return oldGetBoundingClientRect.apply(this,arguments)}catch(e){return{left:"",right:"",top:"",bottom:""}}}}()}})();return THREE}();var __LiteMolImmutable;(function(global,factory){__LiteMolImmutable=factory()})({},function(){"use strict";var SLICE$0=Array.prototype.slice;function createClass(ctor,superClass){if(superClass){ctor.prototype=Object.create(superClass.prototype)}ctor.prototype.constructor=ctor}function Iterable(value){return isIterable(value)?value:Seq(value)}createClass(KeyedIterable,Iterable);function KeyedIterable(value){return isKeyed(value)?value:KeyedSeq(value)}createClass(IndexedIterable,Iterable);function IndexedIterable(value){return isIndexed(value)?value:IndexedSeq(value)}createClass(SetIterable,Iterable);function SetIterable(value){return isIterable(value)&&!isAssociative(value)?value:SetSeq(value)}function isIterable(maybeIterable){return!!(maybeIterable&&maybeIterable[IS_ITERABLE_SENTINEL])}function isKeyed(maybeKeyed){return!!(maybeKeyed&&maybeKeyed[IS_KEYED_SENTINEL])}function isIndexed(maybeIndexed){return!!(maybeIndexed&&maybeIndexed[IS_INDEXED_SENTINEL])}function isAssociative(maybeAssociative){return isKeyed(maybeAssociative)||isIndexed(maybeAssociative)}function isOrdered(maybeOrdered){return!!(maybeOrdered&&maybeOrdered[IS_ORDERED_SENTINEL])}Iterable.isIterable=isIterable;Iterable.isKeyed=isKeyed;Iterable.isIndexed=isIndexed;Iterable.isAssociative=isAssociative;Iterable.isOrdered=isOrdered;Iterable.Keyed=KeyedIterable;Iterable.Indexed=IndexedIterable;Iterable.Set=SetIterable;var IS_ITERABLE_SENTINEL="@@__IMMUTABLE_ITERABLE__@@";var IS_KEYED_SENTINEL="@@__IMMUTABLE_KEYED__@@";var IS_INDEXED_SENTINEL="@@__IMMUTABLE_INDEXED__@@";var IS_ORDERED_SENTINEL="@@__IMMUTABLE_ORDERED__@@";var DELETE="delete";var SHIFT=5;var SIZE=1<<SHIFT;var MASK=SIZE-1;var NOT_SET={};var CHANGE_LENGTH={value:false};var DID_ALTER={value:false};function MakeRef(ref){ref.value=false;return ref}function SetRef(ref){ref&&(ref.value=true)}function OwnerID(){}function arrCopy(arr,offset){offset=offset||0;var len=Math.max(0,arr.length-offset);var newArr=new Array(len);for(var ii=0;ii<len;ii++){newArr[ii]=arr[ii+offset]}return newArr}function ensureSize(iter){if(iter.size===undefined){iter.size=iter.__iterate(returnTrue)}return iter.size}function wrapIndex(iter,index){if(typeof index!=="number"){var uint32Index=index>>>0;if(""+uint32Index!==index||uint32Index===4294967295){return NaN}index=uint32Index}return index<0?ensureSize(iter)+index:index}function returnTrue(){return true}function wholeSlice(begin,end,size){return(begin===0||size!==undefined&&begin<=-size)&&(end===undefined||size!==undefined&&end>=size)}function resolveBegin(begin,size){return resolveIndex(begin,size,0)}function resolveEnd(end,size){return resolveIndex(end,size,size)}function resolveIndex(index,size,defaultIndex){return index===undefined?defaultIndex:index<0?Math.max(0,size+index):size===undefined?index:Math.min(size,index)}var ITERATE_KEYS=0;var ITERATE_VALUES=1;var ITERATE_ENTRIES=2;var REAL_ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";var ITERATOR_SYMBOL=REAL_ITERATOR_SYMBOL||FAUX_ITERATOR_SYMBOL;function Iterator(next){this.next=next}Iterator.prototype.toString=function(){return"[Iterator]"};Iterator.KEYS=ITERATE_KEYS;Iterator.VALUES=ITERATE_VALUES;Iterator.ENTRIES=ITERATE_ENTRIES;Iterator.prototype.inspect=Iterator.prototype.toSource=function(){return this.toString()};Iterator.prototype[ITERATOR_SYMBOL]=function(){return this};function iteratorValue(type,k,v,iteratorResult){var value=type===0?k:type===1?v:[k,v];iteratorResult?iteratorResult.value=value:iteratorResult={value:value,done:false};return iteratorResult}function iteratorDone(){return{value:undefined,done:true}}function hasIterator(maybeIterable){return!!getIteratorFn(maybeIterable)}function isIterator(maybeIterator){return maybeIterator&&typeof maybeIterator.next==="function"}function getIterator(iterable){var iteratorFn=getIteratorFn(iterable);return iteratorFn&&iteratorFn.call(iterable)}function getIteratorFn(iterable){var iteratorFn=iterable&&(REAL_ITERATOR_SYMBOL&&iterable[REAL_ITERATOR_SYMBOL]||iterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}function isArrayLike(value){return value&&typeof value.length==="number"}createClass(Seq,Iterable);function Seq(value){return value===null||value===undefined?emptySequence():isIterable(value)?value.toSeq():seqFromValue(value)}Seq.of=function(){return Seq(arguments)};Seq.prototype.toSeq=function(){return this};Seq.prototype.toString=function(){return this.__toString("Seq {","}")};Seq.prototype.cacheResult=function(){if(!this._cache&&this.__iterateUncached){this._cache=this.entrySeq().toArray();this.size=this._cache.length}return this};Seq.prototype.__iterate=function(fn,reverse){return seqIterate(this,fn,reverse,true)};Seq.prototype.__iterator=function(type,reverse){return seqIterator(this,type,reverse,true)};createClass(KeyedSeq,Seq);function KeyedSeq(value){return value===null||value===undefined?emptySequence().toKeyedSeq():isIterable(value)?isKeyed(value)?value.toSeq():value.fromEntrySeq():keyedSeqFromValue(value)}KeyedSeq.prototype.toKeyedSeq=function(){return this};createClass(IndexedSeq,Seq);function IndexedSeq(value){return value===null||value===undefined?emptySequence():!isIterable(value)?indexedSeqFromValue(value):isKeyed(value)?value.entrySeq():value.toIndexedSeq()}IndexedSeq.of=function(){return IndexedSeq(arguments)};IndexedSeq.prototype.toIndexedSeq=function(){return this};IndexedSeq.prototype.toString=function(){return this.__toString("Seq [","]")};IndexedSeq.prototype.__iterate=function(fn,reverse){return seqIterate(this,fn,reverse,false)};IndexedSeq.prototype.__iterator=function(type,reverse){return seqIterator(this,type,reverse,false)};createClass(SetSeq,Seq);function SetSeq(value){return(value===null||value===undefined?emptySequence():!isIterable(value)?indexedSeqFromValue(value):isKeyed(value)?value.entrySeq():value).toSetSeq()}SetSeq.of=function(){return SetSeq(arguments)};SetSeq.prototype.toSetSeq=function(){return this};Seq.isSeq=isSeq;Seq.Keyed=KeyedSeq;Seq.Set=SetSeq;Seq.Indexed=IndexedSeq;var IS_SEQ_SENTINEL="@@__IMMUTABLE_SEQ__@@";Seq.prototype[IS_SEQ_SENTINEL]=true;createClass(ArraySeq,IndexedSeq);function ArraySeq(array){this._array=array;this.size=array.length}ArraySeq.prototype.get=function(index,notSetValue){return this.has(index)?this._array[wrapIndex(this,index)]:notSetValue};ArraySeq.prototype.__iterate=function(fn,reverse){var array=this._array;var maxIndex=array.length-1;for(var ii=0;ii<=maxIndex;ii++){if(fn(array[reverse?maxIndex-ii:ii],ii,this)===false){return ii+1}}return ii};ArraySeq.prototype.__iterator=function(type,reverse){var array=this._array;var maxIndex=array.length-1;var ii=0;return new Iterator(function(){return ii>maxIndex?iteratorDone():iteratorValue(type,ii,array[reverse?maxIndex-ii++:ii++])})};createClass(ObjectSeq,KeyedSeq);function ObjectSeq(object){var keys=Object.keys(object);this._object=object;this._keys=keys;this.size=keys.length}ObjectSeq.prototype.get=function(key,notSetValue){if(notSetValue!==undefined&&!this.has(key)){return notSetValue}return this._object[key]};ObjectSeq.prototype.has=function(key){return this._object.hasOwnProperty(key)};ObjectSeq.prototype.__iterate=function(fn,reverse){var object=this._object;var keys=this._keys;var maxIndex=keys.length-1;for(var ii=0;ii<=maxIndex;ii++){var key=keys[reverse?maxIndex-ii:ii];if(fn(object[key],key,this)===false){return ii+1}}return ii};ObjectSeq.prototype.__iterator=function(type,reverse){var object=this._object;var keys=this._keys;var maxIndex=keys.length-1;var ii=0;return new Iterator(function(){var key=keys[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,key,object[key])})};ObjectSeq.prototype[IS_ORDERED_SENTINEL]=true;createClass(IterableSeq,IndexedSeq);function IterableSeq(iterable){this._iterable=iterable;this.size=iterable.length||iterable.size}IterableSeq.prototype.__iterateUncached=function(fn,reverse){if(reverse){return this.cacheResult().__iterate(fn,reverse)}var iterable=this._iterable;var iterator=getIterator(iterable);var iterations=0;if(isIterator(iterator)){var step;while(!(step=iterator.next()).done){if(fn(step.value,iterations++,this)===false){break}}}return iterations};IterableSeq.prototype.__iteratorUncached=function(type,reverse){if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterable=this._iterable;var iterator=getIterator(iterable);if(!isIterator(iterator)){return new Iterator(iteratorDone)}var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value)})};createClass(IteratorSeq,IndexedSeq);function IteratorSeq(iterator){this._iterator=iterator;this._iteratorCache=[]}IteratorSeq.prototype.__iterateUncached=function(fn,reverse){if(reverse){return this.cacheResult().__iterate(fn,reverse)}var iterator=this._iterator;var cache=this._iteratorCache;var iterations=0;while(iterations<cache.length){if(fn(cache[iterations],iterations++,this)===false){return iterations}}var step;while(!(step=iterator.next()).done){var val=step.value;cache[iterations]=val;if(fn(val,iterations++,this)===false){break}}return iterations};IteratorSeq.prototype.__iteratorUncached=function(type,reverse){if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=this._iterator;var cache=this._iteratorCache;var iterations=0;return new Iterator(function(){if(iterations>=cache.length){var step=iterator.next();if(step.done){return step}cache[iterations]=step.value}return iteratorValue(type,iterations,cache[iterations++])})};function isSeq(maybeSeq){return!!(maybeSeq&&maybeSeq[IS_SEQ_SENTINEL])}var EMPTY_SEQ;function emptySequence(){return EMPTY_SEQ||(EMPTY_SEQ=new ArraySeq([]))}function keyedSeqFromValue(value){var seq=Array.isArray(value)?new ArraySeq(value).fromEntrySeq():isIterator(value)?new IteratorSeq(value).fromEntrySeq():hasIterator(value)?new IterableSeq(value).fromEntrySeq():typeof value==="object"?new ObjectSeq(value):undefined;if(!seq){throw new TypeError("Expected Array or iterable object of [k, v] entries, "+"or keyed object: "+value)}return seq}function indexedSeqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(!seq){throw new TypeError("Expected Array or iterable object of values: "+value)}return seq}function seqFromValue(value){var seq=maybeIndexedSeqFromValue(value)||typeof value==="object"&&new ObjectSeq(value);if(!seq){throw new TypeError("Expected Array or iterable object of values, or keyed object: "+value)}return seq}function maybeIndexedSeqFromValue(value){return isArrayLike(value)?new ArraySeq(value):isIterator(value)?new IteratorSeq(value):hasIterator(value)?new IterableSeq(value):undefined}function seqIterate(seq,fn,reverse,useKeys){var cache=seq._cache;if(cache){var maxIndex=cache.length-1;for(var ii=0;ii<=maxIndex;ii++){var entry=cache[reverse?maxIndex-ii:ii];if(fn(entry[1],useKeys?entry[0]:ii,seq)===false){return ii+1}}return ii}return seq.__iterateUncached(fn,reverse)}function seqIterator(seq,type,reverse,useKeys){var cache=seq._cache;if(cache){var maxIndex=cache.length-1;var ii=0;return new Iterator(function(){var entry=cache[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,useKeys?entry[0]:ii-1,entry[1])})}return seq.__iteratorUncached(type,reverse)}function fromJS(json,converter){return converter?fromJSWith(converter,json,"",{"":json}):fromJSDefault(json)}function fromJSWith(converter,json,key,parentJSON){if(Array.isArray(json)){return converter.call(parentJSON,key,IndexedSeq(json).map(function(v,k){return fromJSWith(converter,v,k,json)}))}if(isPlainObj(json)){return converter.call(parentJSON,key,KeyedSeq(json).map(function(v,k){return fromJSWith(converter,v,k,json)}))}return json}function fromJSDefault(json){if(Array.isArray(json)){return IndexedSeq(json).map(fromJSDefault).toList()}if(isPlainObj(json)){return KeyedSeq(json).map(fromJSDefault).toMap()}return json}function isPlainObj(value){return value&&(value.constructor===Object||value.constructor===undefined)}function is(valueA,valueB){if(valueA===valueB||valueA!==valueA&&valueB!==valueB){return true}if(!valueA||!valueB){return false}if(typeof valueA.valueOf==="function"&&typeof valueB.valueOf==="function"){valueA=valueA.valueOf();valueB=valueB.valueOf();if(valueA===valueB||valueA!==valueA&&valueB!==valueB){return true}if(!valueA||!valueB){return false}}if(typeof valueA.equals==="function"&&typeof valueB.equals==="function"&&valueA.equals(valueB)){return true}return false}function deepEqual(a,b){if(a===b){return true}if(!isIterable(b)||a.size!==undefined&&b.size!==undefined&&a.size!==b.size||a.__hash!==undefined&&b.__hash!==undefined&&a.__hash!==b.__hash||isKeyed(a)!==isKeyed(b)||isIndexed(a)!==isIndexed(b)||isOrdered(a)!==isOrdered(b)){return false}if(a.size===0&&b.size===0){return true}var notAssociative=!isAssociative(a);if(isOrdered(a)){var entries=a.entries();return b.every(function(v,k){var entry=entries.next().value;return entry&&is(entry[1],v)&&(notAssociative||is(entry[0],k))})&&entries.next().done}var flipped=false;if(a.size===undefined){if(b.size===undefined){if(typeof a.cacheResult==="function"){a.cacheResult()}}else{flipped=true;var _=a;a=b;b=_}}var allEqual=true;var bSize=b.__iterate(function(v,k){if(notAssociative?!a.has(v):flipped?!is(v,a.get(k,NOT_SET)):!is(a.get(k,NOT_SET),v)){allEqual=false;return false}});return allEqual&&a.size===bSize}createClass(Repeat,IndexedSeq);function Repeat(value,times){if(!(this instanceof Repeat)){return new Repeat(value,times)}this._value=value;this.size=times===undefined?Infinity:Math.max(0,times);if(this.size===0){if(EMPTY_REPEAT){return EMPTY_REPEAT}EMPTY_REPEAT=this}}Repeat.prototype.toString=function(){if(this.size===0){return"Repeat []"}return"Repeat [ "+this._value+" "+this.size+" times ]"};Repeat.prototype.get=function(index,notSetValue){return this.has(index)?this._value:notSetValue};Repeat.prototype.includes=function(searchValue){return is(this._value,searchValue)};Repeat.prototype.slice=function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:new Repeat(this._value,resolveEnd(end,size)-resolveBegin(begin,size))};Repeat.prototype.reverse=function(){return this};Repeat.prototype.indexOf=function(searchValue){if(is(this._value,searchValue)){return 0}return-1};Repeat.prototype.lastIndexOf=function(searchValue){if(is(this._value,searchValue)){return this.size}return-1};Repeat.prototype.__iterate=function(fn,reverse){for(var ii=0;ii<this.size;ii++){if(fn(this._value,ii,this)===false){return ii+1}}return ii};Repeat.prototype.__iterator=function(type,reverse){var this$0=this;var ii=0;return new Iterator(function(){return ii<this$0.size?iteratorValue(type,ii++,this$0._value):iteratorDone()})};Repeat.prototype.equals=function(other){return other instanceof Repeat?is(this._value,other._value):deepEqual(other)};var EMPTY_REPEAT;function invariant(condition,error){if(!condition)throw new Error(error)}createClass(Range,IndexedSeq);function Range(start,end,step){if(!(this instanceof Range)){return new Range(start,end,step)}invariant(step!==0,"Cannot step a Range by 0");start=start||0;if(end===undefined){end=Infinity}step=step===undefined?1:Math.abs(step);if(end<start){step=-step}this._start=start;this._end=end;this._step=step;this.size=Math.max(0,Math.ceil((end-start)/step-1)+1);if(this.size===0){if(EMPTY_RANGE){return EMPTY_RANGE}EMPTY_RANGE=this}}Range.prototype.toString=function(){if(this.size===0){return"Range []"}return"Range [ "+this._start+"..."+this._end+(this._step!==1?" by "+this._step:"")+" ]"};Range.prototype.get=function(index,notSetValue){return this.has(index)?this._start+wrapIndex(this,index)*this._step:notSetValue};Range.prototype.includes=function(searchValue){var possibleIndex=(searchValue-this._start)/this._step;return possibleIndex>=0&&possibleIndex<this.size&&possibleIndex===Math.floor(possibleIndex)};Range.prototype.slice=function(begin,end){if(wholeSlice(begin,end,this.size)){return this}begin=resolveBegin(begin,this.size);end=resolveEnd(end,this.size);if(end<=begin){return new Range(0,0)}return new Range(this.get(begin,this._end),this.get(end,this._end),this._step)};Range.prototype.indexOf=function(searchValue){var offsetValue=searchValue-this._start;if(offsetValue%this._step===0){var index=offsetValue/this._step;if(index>=0&&index<this.size){return index}}return-1};Range.prototype.lastIndexOf=function(searchValue){return this.indexOf(searchValue)};Range.prototype.__iterate=function(fn,reverse){var maxIndex=this.size-1;var step=this._step;var value=reverse?this._start+maxIndex*step:this._start;for(var ii=0;ii<=maxIndex;ii++){if(fn(value,ii,this)===false){return ii+1}value+=reverse?-step:step}return ii};Range.prototype.__iterator=function(type,reverse){var maxIndex=this.size-1;var step=this._step;var value=reverse?this._start+maxIndex*step:this._start;var ii=0;return new Iterator(function(){var v=value;value+=reverse?-step:step;return ii>maxIndex?iteratorDone():iteratorValue(type,ii++,v)})};Range.prototype.equals=function(other){return other instanceof Range?this._start===other._start&&this._end===other._end&&this._step===other._step:deepEqual(this,other)};var EMPTY_RANGE;createClass(Collection,Iterable);function Collection(){throw TypeError("Abstract")}createClass(KeyedCollection,Collection);function KeyedCollection(){}createClass(IndexedCollection,Collection);function IndexedCollection(){}createClass(SetCollection,Collection);function SetCollection(){}Collection.Keyed=KeyedCollection;Collection.Indexed=IndexedCollection;Collection.Set=SetCollection;var imul=typeof Math.imul==="function"&&Math.imul(4294967295,2)===-2?Math.imul:function imul(a,b){a=a|0;b=b|0;var c=a&65535;var d=b&65535;return c*d+((a>>>16)*d+c*(b>>>16)<<16>>>0)|0};function smi(i32){return i32>>>1&1073741824|i32&3221225471}function hash(o){if(o===false||o===null||o===undefined){return 0}if(typeof o.valueOf==="function"){o=o.valueOf();if(o===false||o===null||o===undefined){return 0}}if(o===true){return 1}var type=typeof o;if(type==="number"){var h=o|0;if(h!==o){h^=o*4294967295}while(o>4294967295){o/=4294967295;h^=o}return smi(h)}if(type==="string"){return o.length>STRING_HASH_CACHE_MIN_STRLEN?cachedHashString(o):hashString(o)}if(typeof o.hashCode==="function"){return o.hashCode()}if(type==="object"){return hashJSObj(o)}if(typeof o.toString==="function"){return hashString(o.toString())}throw new Error("Value type "+type+" cannot be hashed.")}function cachedHashString(string){var hash=stringHashCache[string];if(hash===undefined){hash=hashString(string);if(STRING_HASH_CACHE_SIZE===STRING_HASH_CACHE_MAX_SIZE){STRING_HASH_CACHE_SIZE=0;stringHashCache={}}STRING_HASH_CACHE_SIZE++;stringHashCache[string]=hash}return hash}function hashString(string){var hash=0;for(var ii=0;ii<string.length;ii++){hash=31*hash+string.charCodeAt(ii)|0}return smi(hash)}function hashJSObj(obj){var hash;if(usingWeakMap){hash=weakMap.get(obj);if(hash!==undefined){return hash}}hash=obj[UID_HASH_KEY];if(hash!==undefined){return hash}if(!canDefineProperty){hash=obj.propertyIsEnumerable&&obj.propertyIsEnumerable[UID_HASH_KEY];if(hash!==undefined){return hash}hash=getIENodeHash(obj);if(hash!==undefined){return hash}}hash=++objHashUID;if(objHashUID&1073741824){objHashUID=0}if(usingWeakMap){weakMap.set(obj,hash)}else if(isExtensible!==undefined&&isExtensible(obj)===false){throw new Error("Non-extensible objects are not allowed as keys.")}else if(canDefineProperty){Object.defineProperty(obj,UID_HASH_KEY,{enumerable:false,configurable:false,writable:false,value:hash})}else if(obj.propertyIsEnumerable!==undefined&&obj.propertyIsEnumerable===obj.constructor.prototype.propertyIsEnumerable){obj.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)};obj.propertyIsEnumerable[UID_HASH_KEY]=hash}else if(obj.nodeType!==undefined){obj[UID_HASH_KEY]=hash}else{throw new Error("Unable to set a non-enumerable property on object.")}return hash}var isExtensible=Object.isExtensible;var canDefineProperty=function(){try{Object.defineProperty({},"@",{});return true}catch(e){return false}}();function getIENodeHash(node){if(node&&node.nodeType>0){switch(node.nodeType){case 1:return node.uniqueID;case 9:return node.documentElement&&node.documentElement.uniqueID}}}var usingWeakMap=typeof WeakMap==="function";var weakMap;if(usingWeakMap){weakMap=new WeakMap}var objHashUID=0;var UID_HASH_KEY="__immutablehash__";if(typeof Symbol==="function"){UID_HASH_KEY=Symbol(UID_HASH_KEY)}var STRING_HASH_CACHE_MIN_STRLEN=16;var STRING_HASH_CACHE_MAX_SIZE=255;var STRING_HASH_CACHE_SIZE=0;var stringHashCache={};function assertNotInfinite(size){invariant(size!==Infinity,"Cannot perform this action with an infinite size.")}createClass(Map,KeyedCollection);function Map(value){return value===null||value===undefined?emptyMap():isMap(value)&&!isOrdered(value)?value:emptyMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v,k){return map.set(k,v)})})}Map.of=function(){var keyValues=SLICE$0.call(arguments,0);return emptyMap().withMutations(function(map){for(var i=0;i<keyValues.length;i+=2){if(i+1>=keyValues.length){throw new Error("Missing value for key: "+keyValues[i])}map.set(keyValues[i],keyValues[i+1])}})};Map.prototype.toString=function(){return this.__toString("Map {","}")};Map.prototype.get=function(k,notSetValue){return this._root?this._root.get(0,undefined,k,notSetValue):notSetValue};Map.prototype.set=function(k,v){return updateMap(this,k,v)};Map.prototype.setIn=function(keyPath,v){return this.updateIn(keyPath,NOT_SET,function(){return v})};Map.prototype.remove=function(k){return updateMap(this,k,NOT_SET)};Map.prototype.deleteIn=function(keyPath){return this.updateIn(keyPath,function(){return NOT_SET})};Map.prototype.update=function(k,notSetValue,updater){return arguments.length===1?k(this):this.updateIn([k],notSetValue,updater)};Map.prototype.updateIn=function(keyPath,notSetValue,updater){if(!updater){updater=notSetValue;notSetValue=undefined}var updatedValue=updateInDeepMap(this,forceIterator(keyPath),notSetValue,updater);return updatedValue===NOT_SET?undefined:updatedValue};Map.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=0;this._root=null;this.__hash=undefined;this.__altered=true;return this}return emptyMap()};Map.prototype.merge=function(){return mergeIntoMapWith(this,undefined,arguments)};Map.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoMapWith(this,merger,iters)};Map.prototype.mergeIn=function(keyPath){var iters=SLICE$0.call(arguments,1);return this.updateIn(keyPath,emptyMap(),function(m){return typeof m.merge==="function"?m.merge.apply(m,iters):iters[iters.length-1]})};Map.prototype.mergeDeep=function(){return mergeIntoMapWith(this,deepMerger,arguments)};Map.prototype.mergeDeepWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoMapWith(this,deepMergerWith(merger),iters)};Map.prototype.mergeDeepIn=function(keyPath){var iters=SLICE$0.call(arguments,1);return this.updateIn(keyPath,emptyMap(),function(m){return typeof m.mergeDeep==="function"?m.mergeDeep.apply(m,iters):iters[iters.length-1]})};Map.prototype.sort=function(comparator){return OrderedMap(sortFactory(this,comparator))};Map.prototype.sortBy=function(mapper,comparator){return OrderedMap(sortFactory(this,comparator,mapper))};Map.prototype.withMutations=function(fn){var mutable=this.asMutable();fn(mutable);return mutable.wasAltered()?mutable.__ensureOwner(this.__ownerID):this};Map.prototype.asMutable=function(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)};Map.prototype.asImmutable=function(){return this.__ensureOwner()};Map.prototype.wasAltered=function(){return this.__altered};Map.prototype.__iterator=function(type,reverse){return new MapIterator(this,type,reverse)};Map.prototype.__iterate=function(fn,reverse){var this$0=this;var iterations=0;this._root&&this._root.iterate(function(entry){iterations++;return fn(entry[1],entry[0],this$0)},reverse);return iterations};Map.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}if(!ownerID){this.__ownerID=ownerID;this.__altered=false;return this}return makeMap(this.size,this._root,ownerID,this.__hash)};function isMap(maybeMap){return!!(maybeMap&&maybeMap[IS_MAP_SENTINEL])}Map.isMap=isMap;var IS_MAP_SENTINEL="@@__IMMUTABLE_MAP__@@";var MapPrototype=Map.prototype;MapPrototype[IS_MAP_SENTINEL]=true;MapPrototype[DELETE]=MapPrototype.remove;MapPrototype.removeIn=MapPrototype.deleteIn;function ArrayMapNode(ownerID,entries){this.ownerID=ownerID;this.entries=entries}ArrayMapNode.prototype.get=function(shift,keyHash,key,notSetValue){var entries=this.entries;for(var ii=0,len=entries.length;ii<len;ii++){if(is(key,entries[ii][0])){return entries[ii][1]}}return notSetValue};ArrayMapNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET;var entries=this.entries;var idx=0;for(var len=entries.length;idx<len;idx++){if(is(key,entries[idx][0])){break}}var exists=idx<len;if(exists?entries[idx][1]===value:removed){return this}SetRef(didAlter);(removed||!exists)&&SetRef(didChangeSize);if(removed&&entries.length===1){return}if(!exists&&!removed&&entries.length>=MAX_ARRAY_MAP_SIZE){return createNodes(ownerID,entries,key,value)}var isEditable=ownerID&&ownerID===this.ownerID;var newEntries=isEditable?entries:arrCopy(entries);if(exists){if(removed){idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop()}else{newEntries[idx]=[key,value]}}else{newEntries.push([key,value])}if(isEditable){this.entries=newEntries;return this}return new ArrayMapNode(ownerID,newEntries)};function BitmapIndexedNode(ownerID,bitmap,nodes){this.ownerID=ownerID;this.bitmap=bitmap;this.nodes=nodes}BitmapIndexedNode.prototype.get=function(shift,keyHash,key,notSetValue){if(keyHash===undefined){keyHash=hash(key)}var bit=1<<((shift===0?keyHash:keyHash>>>shift)&MASK);var bitmap=this.bitmap;return(bitmap&bit)===0?notSetValue:this.nodes[popCount(bitmap&bit-1)].get(shift+SHIFT,keyHash,key,notSetValue)};BitmapIndexedNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(keyHash===undefined){keyHash=hash(key)}var keyHashFrag=(shift===0?keyHash:keyHash>>>shift)&MASK;var bit=1<<keyHashFrag;var bitmap=this.bitmap;var exists=(bitmap&bit)!==0;if(!exists&&value===NOT_SET){return this}var idx=popCount(bitmap&bit-1);var nodes=this.nodes;var node=exists?nodes[idx]:undefined;var newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node){return this}if(!exists&&newNode&&nodes.length>=MAX_BITMAP_INDEXED_SIZE){return expandNodes(ownerID,nodes,bitmap,keyHashFrag,newNode)}if(exists&&!newNode&&nodes.length===2&&isLeafNode(nodes[idx^1])){return nodes[idx^1]}if(exists&&newNode&&nodes.length===1&&isLeafNode(newNode)){return newNode}var isEditable=ownerID&&ownerID===this.ownerID;var newBitmap=exists?newNode?bitmap:bitmap^bit:bitmap|bit;var newNodes=exists?newNode?setIn(nodes,idx,newNode,isEditable):spliceOut(nodes,idx,isEditable):spliceIn(nodes,idx,newNode,isEditable);if(isEditable){this.bitmap=newBitmap;this.nodes=newNodes;return this}return new BitmapIndexedNode(ownerID,newBitmap,newNodes)};function HashArrayMapNode(ownerID,count,nodes){this.ownerID=ownerID;this.count=count;this.nodes=nodes}HashArrayMapNode.prototype.get=function(shift,keyHash,key,notSetValue){if(keyHash===undefined){keyHash=hash(key)}var idx=(shift===0?keyHash:keyHash>>>shift)&MASK;var node=this.nodes[idx];return node?node.get(shift+SHIFT,keyHash,key,notSetValue):notSetValue};HashArrayMapNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(keyHash===undefined){keyHash=hash(key)}var idx=(shift===0?keyHash:keyHash>>>shift)&MASK;var removed=value===NOT_SET;var nodes=this.nodes;var node=nodes[idx];if(removed&&!node){return this}var newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node){return this}var newCount=this.count;if(!node){newCount++}else if(!newNode){newCount--;if(newCount<MIN_HASH_ARRAY_MAP_SIZE){return packNodes(ownerID,nodes,newCount,idx)}}var isEditable=ownerID&&ownerID===this.ownerID;var newNodes=setIn(nodes,idx,newNode,isEditable);if(isEditable){this.count=newCount;this.nodes=newNodes;return this}return new HashArrayMapNode(ownerID,newCount,newNodes)};function HashCollisionNode(ownerID,keyHash,entries){this.ownerID=ownerID;this.keyHash=keyHash;this.entries=entries}HashCollisionNode.prototype.get=function(shift,keyHash,key,notSetValue){var entries=this.entries;for(var ii=0,len=entries.length;ii<len;ii++){if(is(key,entries[ii][0])){return entries[ii][1]}}return notSetValue};HashCollisionNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(keyHash===undefined){keyHash=hash(key)}var removed=value===NOT_SET;if(keyHash!==this.keyHash){if(removed){return this}SetRef(didAlter);SetRef(didChangeSize);return mergeIntoNode(this,ownerID,shift,keyHash,[key,value])}var entries=this.entries;var idx=0;for(var len=entries.length;idx<len;idx++){if(is(key,entries[idx][0])){break}}var exists=idx<len;if(exists?entries[idx][1]===value:removed){return this}SetRef(didAlter);(removed||!exists)&&SetRef(didChangeSize);if(removed&&len===2){return new ValueNode(ownerID,this.keyHash,entries[idx^1])}var isEditable=ownerID&&ownerID===this.ownerID;var newEntries=isEditable?entries:arrCopy(entries);if(exists){if(removed){idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop()}else{newEntries[idx]=[key,value]}}else{newEntries.push([key,value])}if(isEditable){this.entries=newEntries;return this}return new HashCollisionNode(ownerID,this.keyHash,newEntries)};function ValueNode(ownerID,keyHash,entry){this.ownerID=ownerID;this.keyHash=keyHash;this.entry=entry}ValueNode.prototype.get=function(shift,keyHash,key,notSetValue){return is(key,this.entry[0])?this.entry[1]:notSetValue};ValueNode.prototype.update=function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET;var keyMatch=is(key,this.entry[0]);if(keyMatch?value===this.entry[1]:removed){return this}SetRef(didAlter);if(removed){SetRef(didChangeSize);return}if(keyMatch){if(ownerID&&ownerID===this.ownerID){this.entry[1]=value;return this}return new ValueNode(ownerID,this.keyHash,[key,value])}SetRef(didChangeSize);return mergeIntoNode(this,ownerID,shift,hash(key),[key,value])};ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(fn,reverse){var entries=this.entries;for(var ii=0,maxIndex=entries.length-1;ii<=maxIndex;ii++){if(fn(entries[reverse?maxIndex-ii:ii])===false){return false}}};BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(fn,reverse){var nodes=this.nodes;for(var ii=0,maxIndex=nodes.length-1;ii<=maxIndex;ii++){var node=nodes[reverse?maxIndex-ii:ii];if(node&&node.iterate(fn,reverse)===false){return false}}};ValueNode.prototype.iterate=function(fn,reverse){return fn(this.entry)};createClass(MapIterator,Iterator);function MapIterator(map,type,reverse){this._type=type;this._reverse=reverse;this._stack=map._root&&mapIteratorFrame(map._root)}MapIterator.prototype.next=function(){var type=this._type;var stack=this._stack;while(stack){var node=stack.node;var index=stack.index++;var maxIndex;if(node.entry){if(index===0){return mapIteratorValue(type,node.entry)}}else if(node.entries){maxIndex=node.entries.length-1;if(index<=maxIndex){return mapIteratorValue(type,node.entries[this._reverse?maxIndex-index:index])}}else{maxIndex=node.nodes.length-1;if(index<=maxIndex){var subNode=node.nodes[this._reverse?maxIndex-index:index];if(subNode){if(subNode.entry){return mapIteratorValue(type,subNode.entry)}stack=this._stack=mapIteratorFrame(subNode,stack)}continue}}stack=this._stack=this._stack.__prev}return iteratorDone()};function mapIteratorValue(type,entry){return iteratorValue(type,entry[0],entry[1])}function mapIteratorFrame(node,prev){return{node:node,index:0,__prev:prev}}function makeMap(size,root,ownerID,hash){var map=Object.create(MapPrototype);map.size=size;map._root=root;map.__ownerID=ownerID;map.__hash=hash;map.__altered=false;return map}var EMPTY_MAP;function emptyMap(){return EMPTY_MAP||(EMPTY_MAP=makeMap(0))}function updateMap(map,k,v){var newRoot;var newSize;if(!map._root){if(v===NOT_SET){return map}newSize=1;newRoot=new ArrayMapNode(map.__ownerID,[[k,v]])}else{var didChangeSize=MakeRef(CHANGE_LENGTH);var didAlter=MakeRef(DID_ALTER);newRoot=updateNode(map._root,map.__ownerID,0,undefined,k,v,didChangeSize,didAlter);if(!didAlter.value){return map}newSize=map.size+(didChangeSize.value?v===NOT_SET?-1:1:0)}if(map.__ownerID){map.size=newSize;map._root=newRoot;map.__hash=undefined;map.__altered=true;return map}return newRoot?makeMap(newSize,newRoot):emptyMap()}function updateNode(node,ownerID,shift,keyHash,key,value,didChangeSize,didAlter){if(!node){if(value===NOT_SET){return node}SetRef(didAlter);SetRef(didChangeSize);return new ValueNode(ownerID,keyHash,[key,value])}return node.update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter)}function isLeafNode(node){return node.constructor===ValueNode||node.constructor===HashCollisionNode}function mergeIntoNode(node,ownerID,shift,keyHash,entry){if(node.keyHash===keyHash){return new HashCollisionNode(ownerID,keyHash,[node.entry,entry])}var idx1=(shift===0?node.keyHash:node.keyHash>>>shift)&MASK;var idx2=(shift===0?keyHash:keyHash>>>shift)&MASK;var newNode;var nodes=idx1===idx2?[mergeIntoNode(node,ownerID,shift+SHIFT,keyHash,entry)]:(newNode=new ValueNode(ownerID,keyHash,entry),idx1<idx2?[node,newNode]:[newNode,node]);return new BitmapIndexedNode(ownerID,1<<idx1|1<<idx2,nodes)}function createNodes(ownerID,entries,key,value){if(!ownerID){ownerID=new OwnerID}var node=new ValueNode(ownerID,hash(key),[key,value]);for(var ii=0;ii<entries.length;ii++){var entry=entries[ii];node=node.update(ownerID,0,undefined,entry[0],entry[1])}return node}function packNodes(ownerID,nodes,count,excluding){var bitmap=0;var packedII=0;var packedNodes=new Array(count);for(var ii=0,bit=1,len=nodes.length;ii<len;ii++,bit<<=1){var node=nodes[ii];if(node!==undefined&&ii!==excluding){bitmap|=bit;packedNodes[packedII++]=node}}return new BitmapIndexedNode(ownerID,bitmap,packedNodes)}function expandNodes(ownerID,nodes,bitmap,including,node){var count=0;var expandedNodes=new Array(SIZE);for(var ii=0;bitmap!==0;ii++,bitmap>>>=1){expandedNodes[ii]=bitmap&1?nodes[count++]:undefined}expandedNodes[including]=node;return new HashArrayMapNode(ownerID,count+1,expandedNodes)}function mergeIntoMapWith(map,merger,iterables){var iters=[];for(var ii=0;ii<iterables.length;ii++){var value=iterables[ii];var iter=KeyedIterable(value);if(!isIterable(value)){iter=iter.map(function(v){return fromJS(v)})}iters.push(iter)}return mergeIntoCollectionWith(map,merger,iters)}function deepMerger(existing,value,key){return existing&&existing.mergeDeep&&isIterable(value)?existing.mergeDeep(value):is(existing,value)?existing:value}function deepMergerWith(merger){return function(existing,value,key){if(existing&&existing.mergeDeepWith&&isIterable(value)){return existing.mergeDeepWith(merger,value)}var nextValue=merger(existing,value,key);return is(existing,nextValue)?existing:nextValue}}function mergeIntoCollectionWith(collection,merger,iters){iters=iters.filter(function(x){return x.size!==0});if(iters.length===0){return collection}if(collection.size===0&&!collection.__ownerID&&iters.length===1){return collection.constructor(iters[0])}return collection.withMutations(function(collection){var mergeIntoMap=merger?function(value,key){collection.update(key,NOT_SET,function(existing){return existing===NOT_SET?value:merger(existing,value,key)})}:function(value,key){collection.set(key,value)};for(var ii=0;ii<iters.length;ii++){iters[ii].forEach(mergeIntoMap)}})}function updateInDeepMap(existing,keyPathIter,notSetValue,updater){var isNotSet=existing===NOT_SET;var step=keyPathIter.next();if(step.done){var existingValue=isNotSet?notSetValue:existing;var newValue=updater(existingValue);return newValue===existingValue?existing:newValue}invariant(isNotSet||existing&&existing.set,"invalid keyPath");var key=step.value;var nextExisting=isNotSet?NOT_SET:existing.get(key,NOT_SET);var nextUpdated=updateInDeepMap(nextExisting,keyPathIter,notSetValue,updater);return nextUpdated===nextExisting?existing:nextUpdated===NOT_SET?existing.remove(key):(isNotSet?emptyMap():existing).set(key,nextUpdated)}function popCount(x){x=x-(x>>1&1431655765);x=(x&858993459)+(x>>2&858993459);x=x+(x>>4)&252645135;x=x+(x>>8);x=x+(x>>16);return x&127}function setIn(array,idx,val,canEdit){var newArray=canEdit?array:arrCopy(array);newArray[idx]=val;return newArray}function spliceIn(array,idx,val,canEdit){var newLen=array.length+1;if(canEdit&&idx+1===newLen){array[idx]=val;return array}var newArray=new Array(newLen);var after=0;for(var ii=0;ii<newLen;ii++){if(ii===idx){newArray[ii]=val;after=-1}else{newArray[ii]=array[ii+after]}}return newArray}function spliceOut(array,idx,canEdit){var newLen=array.length-1;if(canEdit&&idx===newLen){array.pop();return array}var newArray=new Array(newLen);var after=0;for(var ii=0;ii<newLen;ii++){if(ii===idx){after=1}newArray[ii]=array[ii+after]}return newArray}var MAX_ARRAY_MAP_SIZE=SIZE/4;var MAX_BITMAP_INDEXED_SIZE=SIZE/2;var MIN_HASH_ARRAY_MAP_SIZE=SIZE/4;createClass(List,IndexedCollection);function List(value){var empty=emptyList();if(value===null||value===undefined){return empty}if(isList(value)){return value}var iter=IndexedIterable(value);var size=iter.size;if(size===0){return empty}assertNotInfinite(size);if(size>0&&size<SIZE){return makeList(0,size,SHIFT,null,new VNode(iter.toArray()))}return empty.withMutations(function(list){list.setSize(size);iter.forEach(function(v,i){return list.set(i,v)})})}List.of=function(){return this(arguments)};List.prototype.toString=function(){return this.__toString("List [","]")};List.prototype.get=function(index,notSetValue){index=wrapIndex(this,index);if(index>=0&&index<this.size){index+=this._origin;var node=listNodeFor(this,index);return node&&node.array[index&MASK]}return notSetValue};List.prototype.set=function(index,value){return updateList(this,index,value)};List.prototype.remove=function(index){return!this.has(index)?this:index===0?this.shift():index===this.size-1?this.pop():this.splice(index,1)};List.prototype.insert=function(index,value){return this.splice(index,0,value)};List.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=this._origin=this._capacity=0;this._level=SHIFT;this._root=this._tail=null;this.__hash=undefined;this.__altered=true;return this}return emptyList()};List.prototype.push=function(){var values=arguments;var oldSize=this.size;return this.withMutations(function(list){setListBounds(list,0,oldSize+values.length);for(var ii=0;ii<values.length;ii++){list.set(oldSize+ii,values[ii])}})};List.prototype.pop=function(){return setListBounds(this,0,-1)};List.prototype.unshift=function(){var values=arguments;return this.withMutations(function(list){setListBounds(list,-values.length);for(var ii=0;ii<values.length;ii++){list.set(ii,values[ii])}})};List.prototype.shift=function(){return setListBounds(this,1)};List.prototype.merge=function(){return mergeIntoListWith(this,undefined,arguments)};List.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoListWith(this,merger,iters)};List.prototype.mergeDeep=function(){return mergeIntoListWith(this,deepMerger,arguments)};List.prototype.mergeDeepWith=function(merger){var iters=SLICE$0.call(arguments,1);return mergeIntoListWith(this,deepMergerWith(merger),iters)};List.prototype.setSize=function(size){return setListBounds(this,0,size)};List.prototype.slice=function(begin,end){var size=this.size;if(wholeSlice(begin,end,size)){return this}return setListBounds(this,resolveBegin(begin,size),resolveEnd(end,size))};List.prototype.__iterator=function(type,reverse){var index=0;var values=iterateList(this,reverse);return new Iterator(function(){var value=values();return value===DONE?iteratorDone():iteratorValue(type,index++,value)})};List.prototype.__iterate=function(fn,reverse){var index=0;var values=iterateList(this,reverse);var value;while((value=values())!==DONE){if(fn(value,index++,this)===false){break}}return index};List.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}if(!ownerID){this.__ownerID=ownerID;return this}return makeList(this._origin,this._capacity,this._level,this._root,this._tail,ownerID,this.__hash)};function isList(maybeList){return!!(maybeList&&maybeList[IS_LIST_SENTINEL])}List.isList=isList;var IS_LIST_SENTINEL="@@__IMMUTABLE_LIST__@@";var ListPrototype=List.prototype;ListPrototype[IS_LIST_SENTINEL]=true;ListPrototype[DELETE]=ListPrototype.remove;ListPrototype.setIn=MapPrototype.setIn;ListPrototype.deleteIn=ListPrototype.removeIn=MapPrototype.removeIn;ListPrototype.update=MapPrototype.update;ListPrototype.updateIn=MapPrototype.updateIn;ListPrototype.mergeIn=MapPrototype.mergeIn;ListPrototype.mergeDeepIn=MapPrototype.mergeDeepIn;ListPrototype.withMutations=MapPrototype.withMutations;ListPrototype.asMutable=MapPrototype.asMutable;ListPrototype.asImmutable=MapPrototype.asImmutable;ListPrototype.wasAltered=MapPrototype.wasAltered;function VNode(array,ownerID){this.array=array;this.ownerID=ownerID}VNode.prototype.removeBefore=function(ownerID,level,index){if(index===level?1<<level:0||this.array.length===0){return this}var originIndex=index>>>level&MASK;if(originIndex>=this.array.length){return new VNode([],ownerID)}var removingFirst=originIndex===0;var newChild;if(level>0){var oldChild=this.array[originIndex];newChild=oldChild&&oldChild.removeBefore(ownerID,level-SHIFT,index);if(newChild===oldChild&&removingFirst){return this}}if(removingFirst&&!newChild){return this}var editable=editableVNode(this,ownerID);if(!removingFirst){for(var ii=0;ii<originIndex;ii++){editable.array[ii]=undefined}}if(newChild){editable.array[originIndex]=newChild}return editable};VNode.prototype.removeAfter=function(ownerID,level,index){if(index===(level?1<<level:0)||this.array.length===0){return this}var sizeIndex=index-1>>>level&MASK;if(sizeIndex>=this.array.length){return this}var newChild;if(level>0){var oldChild=this.array[sizeIndex];newChild=oldChild&&oldChild.removeAfter(ownerID,level-SHIFT,index);if(newChild===oldChild&&sizeIndex===this.array.length-1){return this}}var editable=editableVNode(this,ownerID);editable.array.splice(sizeIndex+1);if(newChild){editable.array[sizeIndex]=newChild}return editable};var DONE={};function iterateList(list,reverse){var left=list._origin;var right=list._capacity;var tailPos=getTailOffset(right);var tail=list._tail;return iterateNodeOrLeaf(list._root,list._level,0);function iterateNodeOrLeaf(node,level,offset){return level===0?iterateLeaf(node,offset):iterateNode(node,level,offset)}function iterateLeaf(node,offset){var array=offset===tailPos?tail&&tail.array:node&&node.array;var from=offset>left?0:left-offset;var to=right-offset;if(to>SIZE){to=SIZE}return function(){if(from===to){return DONE}var idx=reverse?--to:from++;return array&&array[idx]}}function iterateNode(node,level,offset){var values;var array=node&&node.array;var from=offset>left?0:left-offset>>level;var to=(right-offset>>level)+1;if(to>SIZE){to=SIZE}return function(){do{if(values){var value=values();if(value!==DONE){return value}values=null}if(from===to){return DONE}var idx=reverse?--to:from++;values=iterateNodeOrLeaf(array&&array[idx],level-SHIFT,offset+(idx<<level))}while(true)}}}function makeList(origin,capacity,level,root,tail,ownerID,hash){var list=Object.create(ListPrototype);list.size=capacity-origin;list._origin=origin;list._capacity=capacity;list._level=level;list._root=root;list._tail=tail;list.__ownerID=ownerID;list.__hash=hash;list.__altered=false;return list}var EMPTY_LIST;function emptyList(){return EMPTY_LIST||(EMPTY_LIST=makeList(0,0,SHIFT))}function updateList(list,index,value){index=wrapIndex(list,index);if(index!==index){return list}if(index>=list.size||index<0){return list.withMutations(function(list){index<0?setListBounds(list,index).set(0,value):setListBounds(list,0,index+1).set(index,value)})}index+=list._origin;var newTail=list._tail;var newRoot=list._root;var didAlter=MakeRef(DID_ALTER);if(index>=getTailOffset(list._capacity)){newTail=updateVNode(newTail,list.__ownerID,0,index,value,didAlter)}else{newRoot=updateVNode(newRoot,list.__ownerID,list._level,index,value,didAlter)}if(!didAlter.value){return list}if(list.__ownerID){list._root=newRoot;list._tail=newTail;list.__hash=undefined;list.__altered=true;return list}return makeList(list._origin,list._capacity,list._level,newRoot,newTail)}function updateVNode(node,ownerID,level,index,value,didAlter){var idx=index>>>level&MASK;var nodeHas=node&&idx<node.array.length;if(!nodeHas&&value===undefined){return node}var newNode;if(level>0){var lowerNode=node&&node.array[idx];var newLowerNode=updateVNode(lowerNode,ownerID,level-SHIFT,index,value,didAlter);if(newLowerNode===lowerNode){return node}newNode=editableVNode(node,ownerID);newNode.array[idx]=newLowerNode;return newNode}if(nodeHas&&node.array[idx]===value){return node}SetRef(didAlter);newNode=editableVNode(node,ownerID);if(value===undefined&&idx===newNode.array.length-1){newNode.array.pop()}else{newNode.array[idx]=value}return newNode}function editableVNode(node,ownerID){if(ownerID&&node&&ownerID===node.ownerID){return node}return new VNode(node?node.array.slice():[],ownerID)}function listNodeFor(list,rawIndex){if(rawIndex>=getTailOffset(list._capacity)){return list._tail}if(rawIndex<1<<list._level+SHIFT){var node=list._root;var level=list._level;while(node&&level>0){node=node.array[rawIndex>>>level&MASK];level-=SHIFT}return node}}function setListBounds(list,begin,end){if(begin!==undefined){begin=begin|0}if(end!==undefined){end=end|0}var owner=list.__ownerID||new OwnerID;var oldOrigin=list._origin;var oldCapacity=list._capacity;var newOrigin=oldOrigin+begin;var newCapacity=end===undefined?oldCapacity:end<0?oldCapacity+end:oldOrigin+end;if(newOrigin===oldOrigin&&newCapacity===oldCapacity){return list}if(newOrigin>=newCapacity){return list.clear()}var newLevel=list._level;var newRoot=list._root;var offsetShift=0;while(newOrigin+offsetShift<0){newRoot=new VNode(newRoot&&newRoot.array.length?[undefined,newRoot]:[],owner);newLevel+=SHIFT;offsetShift+=1<<newLevel}if(offsetShift){newOrigin+=offsetShift;oldOrigin+=offsetShift;newCapacity+=offsetShift;oldCapacity+=offsetShift}var oldTailOffset=getTailOffset(oldCapacity);var newTailOffset=getTailOffset(newCapacity);while(newTailOffset>=1<<newLevel+SHIFT){newRoot=new VNode(newRoot&&newRoot.array.length?[newRoot]:[],owner);newLevel+=SHIFT}var oldTail=list._tail;var newTail=newTailOffset<oldTailOffset?listNodeFor(list,newCapacity-1):newTailOffset>oldTailOffset?new VNode([],owner):oldTail;if(oldTail&&newTailOffset>oldTailOffset&&newOrigin<oldCapacity&&oldTail.array.length){newRoot=editableVNode(newRoot,owner);var node=newRoot;for(var level=newLevel;level>SHIFT;level-=SHIFT){var idx=oldTailOffset>>>level&MASK;node=node.array[idx]=editableVNode(node.array[idx],owner)}node.array[oldTailOffset>>>SHIFT&MASK]=oldTail}if(newCapacity<oldCapacity){newTail=newTail&&newTail.removeAfter(owner,0,newCapacity)}if(newOrigin>=newTailOffset){newOrigin-=newTailOffset;newCapacity-=newTailOffset;newLevel=SHIFT;newRoot=null;newTail=newTail&&newTail.removeBefore(owner,0,newOrigin)}else if(newOrigin>oldOrigin||newTailOffset<oldTailOffset){offsetShift=0;while(newRoot){var beginIndex=newOrigin>>>newLevel&MASK;if(beginIndex!==newTailOffset>>>newLevel&MASK){break}if(beginIndex){offsetShift+=(1<<newLevel)*beginIndex}newLevel-=SHIFT;newRoot=newRoot.array[beginIndex]}if(newRoot&&newOrigin>oldOrigin){newRoot=newRoot.removeBefore(owner,newLevel,newOrigin-offsetShift)}if(newRoot&&newTailOffset<oldTailOffset){newRoot=newRoot.removeAfter(owner,newLevel,newTailOffset-offsetShift)}if(offsetShift){newOrigin-=offsetShift;newCapacity-=offsetShift}}if(list.__ownerID){list.size=newCapacity-newOrigin;list._origin=newOrigin;list._capacity=newCapacity;list._level=newLevel;list._root=newRoot;list._tail=newTail;list.__hash=undefined;list.__altered=true;return list}return makeList(newOrigin,newCapacity,newLevel,newRoot,newTail)}function mergeIntoListWith(list,merger,iterables){var iters=[];var maxSize=0;for(var ii=0;ii<iterables.length;ii++){var value=iterables[ii];var iter=IndexedIterable(value);if(iter.size>maxSize){maxSize=iter.size}if(!isIterable(value)){iter=iter.map(function(v){return fromJS(v)})}iters.push(iter)}if(maxSize>list.size){list=list.setSize(maxSize)}return mergeIntoCollectionWith(list,merger,iters)}function getTailOffset(size){return size<SIZE?0:size-1>>>SHIFT<<SHIFT}createClass(OrderedMap,Map);function OrderedMap(value){return value===null||value===undefined?emptyOrderedMap():isOrderedMap(value)?value:emptyOrderedMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v,k){return map.set(k,v)})})}OrderedMap.of=function(){return this(arguments)};OrderedMap.prototype.toString=function(){return this.__toString("OrderedMap {","}")};OrderedMap.prototype.get=function(k,notSetValue){var index=this._map.get(k);return index!==undefined?this._list.get(index)[1]:notSetValue};OrderedMap.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=0;this._map.clear();this._list.clear();return this}return emptyOrderedMap()};OrderedMap.prototype.set=function(k,v){return updateOrderedMap(this,k,v)};OrderedMap.prototype.remove=function(k){return updateOrderedMap(this,k,NOT_SET)};OrderedMap.prototype.wasAltered=function(){return this._map.wasAltered()||this._list.wasAltered()};OrderedMap.prototype.__iterate=function(fn,reverse){var this$0=this;return this._list.__iterate(function(entry){return entry&&fn(entry[1],entry[0],this$0)},reverse)};OrderedMap.prototype.__iterator=function(type,reverse){return this._list.fromEntrySeq().__iterator(type,reverse)};OrderedMap.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}var newMap=this._map.__ensureOwner(ownerID);var newList=this._list.__ensureOwner(ownerID);if(!ownerID){this.__ownerID=ownerID;this._map=newMap;this._list=newList;return this}return makeOrderedMap(newMap,newList,ownerID,this.__hash)};function isOrderedMap(maybeOrderedMap){return isMap(maybeOrderedMap)&&isOrdered(maybeOrderedMap)}OrderedMap.isOrderedMap=isOrderedMap;OrderedMap.prototype[IS_ORDERED_SENTINEL]=true;OrderedMap.prototype[DELETE]=OrderedMap.prototype.remove;function makeOrderedMap(map,list,ownerID,hash){var omap=Object.create(OrderedMap.prototype);omap.size=map?map.size:0;omap._map=map;omap._list=list;omap.__ownerID=ownerID;omap.__hash=hash;return omap}var EMPTY_ORDERED_MAP;function emptyOrderedMap(){return EMPTY_ORDERED_MAP||(EMPTY_ORDERED_MAP=makeOrderedMap(emptyMap(),emptyList()))}function updateOrderedMap(omap,k,v){var map=omap._map;var list=omap._list;var i=map.get(k);var has=i!==undefined;var newMap;var newList;if(v===NOT_SET){if(!has){return omap}if(list.size>=SIZE&&list.size>=map.size*2){newList=list.filter(function(entry,idx){return entry!==undefined&&i!==idx});newMap=newList.toKeyedSeq().map(function(entry){return entry[0]}).flip().toMap();if(omap.__ownerID){newMap.__ownerID=newList.__ownerID=omap.__ownerID}}else{newMap=map.remove(k);newList=i===list.size-1?list.pop():list.set(i,undefined)}}else{if(has){if(v===list.get(i)[1]){return omap}newMap=map;newList=list.set(i,[k,v])}else{newMap=map.set(k,list.size);newList=list.set(list.size,[k,v])}}if(omap.__ownerID){omap.size=newMap.size;omap._map=newMap;omap._list=newList;omap.__hash=undefined;return omap}return makeOrderedMap(newMap,newList)}createClass(ToKeyedSequence,KeyedSeq);function ToKeyedSequence(indexed,useKeys){this._iter=indexed;this._useKeys=useKeys;this.size=indexed.size}ToKeyedSequence.prototype.get=function(key,notSetValue){return this._iter.get(key,notSetValue)};ToKeyedSequence.prototype.has=function(key){return this._iter.has(key)};ToKeyedSequence.prototype.valueSeq=function(){return this._iter.valueSeq()};ToKeyedSequence.prototype.reverse=function(){var this$0=this;var reversedSequence=reverseFactory(this,true);if(!this._useKeys){reversedSequence.valueSeq=function(){return this$0._iter.toSeq().reverse()}}return reversedSequence};ToKeyedSequence.prototype.map=function(mapper,context){var this$0=this;var mappedSequence=mapFactory(this,mapper,context);if(!this._useKeys){mappedSequence.valueSeq=function(){return this$0._iter.toSeq().map(mapper,context)}}return mappedSequence};ToKeyedSequence.prototype.__iterate=function(fn,reverse){var this$0=this;var ii;return this._iter.__iterate(this._useKeys?function(v,k){return fn(v,k,this$0)}:(ii=reverse?resolveSize(this):0,function(v){return fn(v,reverse?--ii:ii++,this$0)}),reverse)};ToKeyedSequence.prototype.__iterator=function(type,reverse){if(this._useKeys){return this._iter.__iterator(type,reverse)}var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);var ii=reverse?resolveSize(this):0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,reverse?--ii:ii++,step.value,step)})};ToKeyedSequence.prototype[IS_ORDERED_SENTINEL]=true;createClass(ToIndexedSequence,IndexedSeq);function ToIndexedSequence(iter){this._iter=iter;this.size=iter.size}ToIndexedSequence.prototype.includes=function(value){return this._iter.includes(value)};ToIndexedSequence.prototype.__iterate=function(fn,reverse){var this$0=this;var iterations=0;return this._iter.__iterate(function(v){return fn(v,iterations++,this$0)},reverse)};ToIndexedSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value,step)})};createClass(ToSetSequence,SetSeq);function ToSetSequence(iter){this._iter=iter;this.size=iter.size}ToSetSequence.prototype.has=function(key){return this._iter.includes(key)};ToSetSequence.prototype.__iterate=function(fn,reverse){var this$0=this;return this._iter.__iterate(function(v){return fn(v,v,this$0)},reverse)};ToSetSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,step.value,step.value,step)})};createClass(FromEntriesSequence,KeyedSeq);function FromEntriesSequence(entries){this._iter=entries;this.size=entries.size}FromEntriesSequence.prototype.entrySeq=function(){return this._iter.toSeq()};FromEntriesSequence.prototype.__iterate=function(fn,reverse){var this$0=this;return this._iter.__iterate(function(entry){if(entry){validateEntry(entry);var indexedIterable=isIterable(entry);return fn(indexedIterable?entry.get(1):entry[1],indexedIterable?entry.get(0):entry[0],this$0)}},reverse)};FromEntriesSequence.prototype.__iterator=function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){while(true){var step=iterator.next();if(step.done){return step}var entry=step.value;if(entry){validateEntry(entry);var indexedIterable=isIterable(entry);return iteratorValue(type,indexedIterable?entry.get(0):entry[0],indexedIterable?entry.get(1):entry[1],step)}}})};ToIndexedSequence.prototype.cacheResult=ToKeyedSequence.prototype.cacheResult=ToSetSequence.prototype.cacheResult=FromEntriesSequence.prototype.cacheResult=cacheResultThrough;function flipFactory(iterable){var flipSequence=makeSequence(iterable);flipSequence._iter=iterable;flipSequence.size=iterable.size;flipSequence.flip=function(){return iterable};flipSequence.reverse=function(){var reversedSequence=iterable.reverse.apply(this);reversedSequence.flip=function(){return iterable.reverse()};return reversedSequence};flipSequence.has=function(key){return iterable.includes(key)};flipSequence.includes=function(key){return iterable.has(key)};flipSequence.cacheResult=cacheResultThrough;flipSequence.__iterateUncached=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k){return fn(k,v,this$0)!==false},reverse)};flipSequence.__iteratorUncached=function(type,reverse){if(type===ITERATE_ENTRIES){var iterator=iterable.__iterator(type,reverse);return new Iterator(function(){var step=iterator.next();if(!step.done){var k=step.value[0];step.value[0]=step.value[1];step.value[1]=k}return step})}return iterable.__iterator(type===ITERATE_VALUES?ITERATE_KEYS:ITERATE_VALUES,reverse)};return flipSequence}function mapFactory(iterable,mapper,context){var mappedSequence=makeSequence(iterable);mappedSequence.size=iterable.size;mappedSequence.has=function(key){return iterable.has(key)};mappedSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v===NOT_SET?notSetValue:mapper.call(context,v,key,iterable)};mappedSequence.__iterateUncached=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k,c){return fn(mapper.call(context,v,k,c),k,this$0)!==false},reverse)};mappedSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);return new Iterator(function(){var step=iterator.next();if(step.done){return step}var entry=step.value;var key=entry[0];return iteratorValue(type,key,mapper.call(context,entry[1],key,iterable),step)})};return mappedSequence}function reverseFactory(iterable,useKeys){var reversedSequence=makeSequence(iterable);reversedSequence._iter=iterable;reversedSequence.size=iterable.size;reversedSequence.reverse=function(){return iterable};if(iterable.flip){reversedSequence.flip=function(){var flipSequence=flipFactory(iterable);flipSequence.reverse=function(){return iterable.flip()};return flipSequence}}reversedSequence.get=function(key,notSetValue){return iterable.get(useKeys?key:-1-key,notSetValue)};reversedSequence.has=function(key){return iterable.has(useKeys?key:-1-key)};reversedSequence.includes=function(value){return iterable.includes(value)};reversedSequence.cacheResult=cacheResultThrough;reversedSequence.__iterate=function(fn,reverse){var this$0=this;return iterable.__iterate(function(v,k){return fn(v,k,this$0)},!reverse)};reversedSequence.__iterator=function(type,reverse){return iterable.__iterator(type,!reverse)};return reversedSequence}function filterFactory(iterable,predicate,context,useKeys){var filterSequence=makeSequence(iterable);if(useKeys){filterSequence.has=function(key){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&!!predicate.call(context,v,key,iterable)};filterSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&predicate.call(context,v,key,iterable)?v:notSetValue}}filterSequence.__iterateUncached=function(fn,reverse){var this$0=this;var iterations=0;iterable.__iterate(function(v,k,c){if(predicate.call(context,v,k,c)){iterations++;return fn(v,useKeys?k:iterations-1,this$0)}},reverse);return iterations};filterSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);var iterations=0;return new Iterator(function(){while(true){var step=iterator.next();if(step.done){return step}var entry=step.value;var key=entry[0];var value=entry[1];if(predicate.call(context,value,key,iterable)){return iteratorValue(type,useKeys?key:iterations++,value,step)}}})};return filterSequence}function countByFactory(iterable,grouper,context){var groups=Map().asMutable();iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),0,function(a){return a+1})});return groups.asImmutable()}function groupByFactory(iterable,grouper,context){var isKeyedIter=isKeyed(iterable);var groups=(isOrdered(iterable)?OrderedMap():Map()).asMutable();iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),function(a){return a=a||[],a.push(isKeyedIter?[k,v]:v),a})});var coerce=iterableClass(iterable);return groups.map(function(arr){return reify(iterable,coerce(arr))})}function sliceFactory(iterable,begin,end,useKeys){var originalSize=iterable.size;if(begin!==undefined){begin=begin|0}if(end!==undefined){end=end|0}if(wholeSlice(begin,end,originalSize)){return iterable}var resolvedBegin=resolveBegin(begin,originalSize);var resolvedEnd=resolveEnd(end,originalSize);if(resolvedBegin!==resolvedBegin||resolvedEnd!==resolvedEnd){return sliceFactory(iterable.toSeq().cacheResult(),begin,end,useKeys)}var resolvedSize=resolvedEnd-resolvedBegin;var sliceSize;if(resolvedSize===resolvedSize){sliceSize=resolvedSize<0?0:resolvedSize}var sliceSeq=makeSequence(iterable);sliceSeq.size=sliceSize===0?sliceSize:iterable.size&&sliceSize||undefined;if(!useKeys&&isSeq(iterable)&&sliceSize>=0){sliceSeq.get=function(index,notSetValue){index=wrapIndex(this,index);return index>=0&&index<sliceSize?iterable.get(index+resolvedBegin,notSetValue):notSetValue}}sliceSeq.__iterateUncached=function(fn,reverse){var this$0=this;if(sliceSize===0){return 0}if(reverse){return this.cacheResult().__iterate(fn,reverse)}var skipped=0;var isSkipping=true;var iterations=0;iterable.__iterate(function(v,k){if(!(isSkipping&&(isSkipping=skipped++<resolvedBegin))){iterations++;return fn(v,useKeys?k:iterations-1,this$0)!==false&&iterations!==sliceSize}});return iterations};sliceSeq.__iteratorUncached=function(type,reverse){if(sliceSize!==0&&reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=sliceSize!==0&&iterable.__iterator(type,reverse);var skipped=0;var iterations=0;return new Iterator(function(){while(skipped++<resolvedBegin){iterator.next()}if(++iterations>sliceSize){return iteratorDone()}var step=iterator.next();if(useKeys||type===ITERATE_VALUES){return step}else if(type===ITERATE_KEYS){return iteratorValue(type,iterations-1,undefined,step)}else{return iteratorValue(type,iterations-1,step.value[1],step)}})};return sliceSeq}function takeWhileFactory(iterable,predicate,context){var takeSequence=makeSequence(iterable);takeSequence.__iterateUncached=function(fn,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterate(fn,reverse)}var iterations=0;iterable.__iterate(function(v,k,c){return predicate.call(context,v,k,c)&&++iterations&&fn(v,k,this$0)});return iterations};takeSequence.__iteratorUncached=function(type,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);var iterating=true;return new Iterator(function(){if(!iterating){return iteratorDone()}var step=iterator.next();if(step.done){return step}var entry=step.value;var k=entry[0];var v=entry[1];if(!predicate.call(context,v,k,this$0)){iterating=false;return iteratorDone()}return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})};return takeSequence}function skipWhileFactory(iterable,predicate,context,useKeys){var skipSequence=makeSequence(iterable);skipSequence.__iterateUncached=function(fn,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterate(fn,reverse)}var isSkipping=true;var iterations=0;iterable.__iterate(function(v,k,c){if(!(isSkipping&&(isSkipping=predicate.call(context,v,k,c)))){iterations++;return fn(v,useKeys?k:iterations-1,this$0)}});return iterations};skipSequence.__iteratorUncached=function(type,reverse){var this$0=this;if(reverse){return this.cacheResult().__iterator(type,reverse)}var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);var skipping=true;var iterations=0;return new Iterator(function(){var step,k,v;do{step=iterator.next();if(step.done){if(useKeys||type===ITERATE_VALUES){return step}else if(type===ITERATE_KEYS){return iteratorValue(type,iterations++,undefined,step)}else{return iteratorValue(type,iterations++,step.value[1],step)}}var entry=step.value;k=entry[0];v=entry[1];skipping&&(skipping=predicate.call(context,v,k,this$0))}while(skipping);return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})};return skipSequence}function concatFactory(iterable,values){var isKeyedIterable=isKeyed(iterable);var iters=[iterable].concat(values).map(function(v){if(!isIterable(v)){v=isKeyedIterable?keyedSeqFromValue(v):indexedSeqFromValue(Array.isArray(v)?v:[v])}else if(isKeyedIterable){v=KeyedIterable(v)}return v}).filter(function(v){return v.size!==0});if(iters.length===0){return iterable}if(iters.length===1){var singleton=iters[0];if(singleton===iterable||isKeyedIterable&&isKeyed(singleton)||isIndexed(iterable)&&isIndexed(singleton)){return singleton}}var concatSeq=new ArraySeq(iters);if(isKeyedIterable){concatSeq=concatSeq.toKeyedSeq()}else if(!isIndexed(iterable)){concatSeq=concatSeq.toSetSeq()}concatSeq=concatSeq.flatten(true);concatSeq.size=iters.reduce(function(sum,seq){if(sum!==undefined){var size=seq.size;if(size!==undefined){return sum+size}}},0);return concatSeq}function flattenFactory(iterable,depth,useKeys){var flatSequence=makeSequence(iterable);flatSequence.__iterateUncached=function(fn,reverse){var iterations=0;var stopped=false;function flatDeep(iter,currentDepth){var this$0=this;iter.__iterate(function(v,k){if((!depth||currentDepth<depth)&&isIterable(v)){flatDeep(v,currentDepth+1)}else if(fn(v,useKeys?k:iterations++,this$0)===false){stopped=true}return!stopped},reverse)}flatDeep(iterable,0);return iterations};flatSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(type,reverse);var stack=[];var iterations=0;return new Iterator(function(){while(iterator){var step=iterator.next();if(step.done!==false){iterator=stack.pop();continue}var v=step.value;if(type===ITERATE_ENTRIES){v=v[1]}if((!depth||stack.length<depth)&&isIterable(v)){stack.push(iterator);iterator=v.__iterator(type,reverse)}else{return useKeys?step:iteratorValue(type,iterations++,v,step)}}return iteratorDone()})};return flatSequence}function flatMapFactory(iterable,mapper,context){var coerce=iterableClass(iterable);return iterable.toSeq().map(function(v,k){return coerce(mapper.call(context,v,k,iterable))}).flatten(true)}function interposeFactory(iterable,separator){var interposedSequence=makeSequence(iterable);interposedSequence.size=iterable.size&&iterable.size*2-1;interposedSequence.__iterateUncached=function(fn,reverse){var this$0=this;var iterations=0;iterable.__iterate(function(v,k){return(!iterations||fn(separator,iterations++,this$0)!==false)&&fn(v,iterations++,this$0)!==false},reverse);return iterations};interposedSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_VALUES,reverse);var iterations=0;var step;return new Iterator(function(){if(!step||iterations%2){step=iterator.next();if(step.done){return step}}return iterations%2?iteratorValue(type,iterations++,separator):iteratorValue(type,iterations++,step.value,step)})};return interposedSequence}function sortFactory(iterable,comparator,mapper){if(!comparator){comparator=defaultComparator}var isKeyedIterable=isKeyed(iterable);var index=0;var entries=iterable.toSeq().map(function(v,k){return[k,v,index++,mapper?mapper(v,k,iterable):v]}).toArray();entries.sort(function(a,b){return comparator(a[3],b[3])||a[2]-b[2]}).forEach(isKeyedIterable?function(v,i){entries[i].length=2}:function(v,i){entries[i]=v[1]});return isKeyedIterable?KeyedSeq(entries):isIndexed(iterable)?IndexedSeq(entries):SetSeq(entries)}function maxFactory(iterable,comparator,mapper){if(!comparator){comparator=defaultComparator}if(mapper){var entry=iterable.toSeq().map(function(v,k){return[v,mapper(v,k,iterable)]}).reduce(function(a,b){return maxCompare(comparator,a[1],b[1])?b:a});return entry&&entry[0]}else{return iterable.reduce(function(a,b){return maxCompare(comparator,a,b)?b:a})}}function maxCompare(comparator,a,b){var comp=comparator(b,a);return comp===0&&b!==a&&(b===undefined||b===null||b!==b)||comp>0}function zipWithFactory(keyIter,zipper,iters){var zipSequence=makeSequence(keyIter);zipSequence.size=new ArraySeq(iters).map(function(i){return i.size}).min();zipSequence.__iterate=function(fn,reverse){var iterator=this.__iterator(ITERATE_VALUES,reverse);var step;var iterations=0;while(!(step=iterator.next()).done){if(fn(step.value,iterations++,this)===false){break}}return iterations};zipSequence.__iteratorUncached=function(type,reverse){var iterators=iters.map(function(i){return i=Iterable(i),getIterator(reverse?i.reverse():i)});var iterations=0;var isDone=false;return new Iterator(function(){var steps;if(!isDone){steps=iterators.map(function(i){return i.next()});isDone=steps.some(function(s){return s.done})}if(isDone){return iteratorDone()}return iteratorValue(type,iterations++,zipper.apply(null,steps.map(function(s){return s.value})))})};return zipSequence}function reify(iter,seq){return isSeq(iter)?seq:iter.constructor(seq)}function validateEntry(entry){if(entry!==Object(entry)){throw new TypeError("Expected [K, V] tuple: "+entry)}}function resolveSize(iter){assertNotInfinite(iter.size);return ensureSize(iter)}function iterableClass(iterable){return isKeyed(iterable)?KeyedIterable:isIndexed(iterable)?IndexedIterable:SetIterable}function makeSequence(iterable){return Object.create((isKeyed(iterable)?KeyedSeq:isIndexed(iterable)?IndexedSeq:SetSeq).prototype)}function cacheResultThrough(){if(this._iter.cacheResult){this._iter.cacheResult();this.size=this._iter.size;return this}else{return Seq.prototype.cacheResult.call(this)}}function defaultComparator(a,b){return a>b?1:a<b?-1:0}function forceIterator(keyPath){var iter=getIterator(keyPath);if(!iter){if(!isArrayLike(keyPath)){throw new TypeError("Expected iterable or array-like: "+keyPath)}iter=getIterator(Iterable(keyPath))}return iter}createClass(Record,KeyedCollection);function Record(defaultValues,name){var hasInitialized;var RecordType=function Record(values){if(values instanceof RecordType){return values}if(!(this instanceof RecordType)){return new RecordType(values)}if(!hasInitialized){hasInitialized=true;var keys=Object.keys(defaultValues);setProps(RecordTypePrototype,keys);RecordTypePrototype.size=keys.length;RecordTypePrototype._name=name;RecordTypePrototype._keys=keys;RecordTypePrototype._defaultValues=defaultValues}this._map=Map(values)};var RecordTypePrototype=RecordType.prototype=Object.create(RecordPrototype);RecordTypePrototype.constructor=RecordType;return RecordType}Record.prototype.toString=function(){return this.__toString(recordName(this)+" {","}")};Record.prototype.has=function(k){return this._defaultValues.hasOwnProperty(k)};Record.prototype.get=function(k,notSetValue){if(!this.has(k)){return notSetValue}var defaultVal=this._defaultValues[k];return this._map?this._map.get(k,defaultVal):defaultVal};Record.prototype.clear=function(){if(this.__ownerID){this._map&&this._map.clear();return this}var RecordType=this.constructor;return RecordType._empty||(RecordType._empty=makeRecord(this,emptyMap()))};Record.prototype.set=function(k,v){if(!this.has(k)){throw new Error('Cannot set unknown key "'+k+'" on '+recordName(this))}if(this._map&&!this._map.has(k)){var defaultVal=this._defaultValues[k];if(v===defaultVal){return this}}var newMap=this._map&&this._map.set(k,v);if(this.__ownerID||newMap===this._map){return this}return makeRecord(this,newMap)};Record.prototype.remove=function(k){if(!this.has(k)){return this}var newMap=this._map&&this._map.remove(k);if(this.__ownerID||newMap===this._map){return this}return makeRecord(this,newMap)};Record.prototype.wasAltered=function(){return this._map.wasAltered()};Record.prototype.__iterator=function(type,reverse){var this$0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return this$0.get(k)}).__iterator(type,reverse)};Record.prototype.__iterate=function(fn,reverse){var this$0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return this$0.get(k)}).__iterate(fn,reverse)};Record.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}var newMap=this._map&&this._map.__ensureOwner(ownerID);if(!ownerID){this.__ownerID=ownerID;this._map=newMap;return this}return makeRecord(this,newMap,ownerID)};var RecordPrototype=Record.prototype;RecordPrototype[DELETE]=RecordPrototype.remove;RecordPrototype.deleteIn=RecordPrototype.removeIn=MapPrototype.removeIn;RecordPrototype.merge=MapPrototype.merge;RecordPrototype.mergeWith=MapPrototype.mergeWith;RecordPrototype.mergeIn=MapPrototype.mergeIn;RecordPrototype.mergeDeep=MapPrototype.mergeDeep;RecordPrototype.mergeDeepWith=MapPrototype.mergeDeepWith;RecordPrototype.mergeDeepIn=MapPrototype.mergeDeepIn;RecordPrototype.setIn=MapPrototype.setIn;RecordPrototype.update=MapPrototype.update;RecordPrototype.updateIn=MapPrototype.updateIn;RecordPrototype.withMutations=MapPrototype.withMutations;RecordPrototype.asMutable=MapPrototype.asMutable;RecordPrototype.asImmutable=MapPrototype.asImmutable;function makeRecord(likeRecord,map,ownerID){var record=Object.create(Object.getPrototypeOf(likeRecord));record._map=map;record.__ownerID=ownerID;return record}function recordName(record){return record._name||record.constructor.name||"Record"}function setProps(prototype,names){try{names.forEach(setProp.bind(undefined,prototype))}catch(error){}}function setProp(prototype,name){Object.defineProperty(prototype,name,{get:function(){return this.get(name)},set:function(value){invariant(this.__ownerID,"Cannot set on an immutable record.");this.set(name,value)}})}createClass(Set,SetCollection);function Set(value){return value===null||value===undefined?emptySet():isSet(value)&&!isOrdered(value)?value:emptySet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v){return set.add(v)})})}Set.of=function(){return this(arguments)};Set.fromKeys=function(value){return this(KeyedIterable(value).keySeq())};Set.prototype.toString=function(){return this.__toString("Set {","}")};Set.prototype.has=function(value){return this._map.has(value)};Set.prototype.add=function(value){return updateSet(this,this._map.set(value,true))};Set.prototype.remove=function(value){return updateSet(this,this._map.remove(value))};Set.prototype.clear=function(){return updateSet(this,this._map.clear())};Set.prototype.union=function(){var iters=SLICE$0.call(arguments,0);iters=iters.filter(function(x){return x.size!==0});if(iters.length===0){return this}if(this.size===0&&!this.__ownerID&&iters.length===1){return this.constructor(iters[0])}return this.withMutations(function(set){for(var ii=0;ii<iters.length;ii++){SetIterable(iters[ii]).forEach(function(value){return set.add(value)})}})};Set.prototype.intersect=function(){var iters=SLICE$0.call(arguments,0);if(iters.length===0){return this}iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){if(!iters.every(function(iter){return iter.includes(value)})){set.remove(value)}})})};Set.prototype.subtract=function(){var iters=SLICE$0.call(arguments,0);if(iters.length===0){return this}iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){if(iters.some(function(iter){return iter.includes(value)})){set.remove(value)}})})};Set.prototype.merge=function(){return this.union.apply(this,arguments)};Set.prototype.mergeWith=function(merger){var iters=SLICE$0.call(arguments,1);return this.union.apply(this,iters)};Set.prototype.sort=function(comparator){return OrderedSet(sortFactory(this,comparator))};Set.prototype.sortBy=function(mapper,comparator){return OrderedSet(sortFactory(this,comparator,mapper))};Set.prototype.wasAltered=function(){return this._map.wasAltered()};Set.prototype.__iterate=function(fn,reverse){var this$0=this;return this._map.__iterate(function(_,k){return fn(k,k,this$0)},reverse)};Set.prototype.__iterator=function(type,reverse){return this._map.map(function(_,k){return k}).__iterator(type,reverse)};Set.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}var newMap=this._map.__ensureOwner(ownerID);if(!ownerID){this.__ownerID=ownerID;this._map=newMap;return this}return this.__make(newMap,ownerID)};function isSet(maybeSet){return!!(maybeSet&&maybeSet[IS_SET_SENTINEL])}Set.isSet=isSet;var IS_SET_SENTINEL="@@__IMMUTABLE_SET__@@";var SetPrototype=Set.prototype;SetPrototype[IS_SET_SENTINEL]=true;SetPrototype[DELETE]=SetPrototype.remove;SetPrototype.mergeDeep=SetPrototype.merge;SetPrototype.mergeDeepWith=SetPrototype.mergeWith;SetPrototype.withMutations=MapPrototype.withMutations;SetPrototype.asMutable=MapPrototype.asMutable;SetPrototype.asImmutable=MapPrototype.asImmutable;SetPrototype.__empty=emptySet;SetPrototype.__make=makeSet;function updateSet(set,newMap){if(set.__ownerID){set.size=newMap.size;set._map=newMap;return set}return newMap===set._map?set:newMap.size===0?set.__empty():set.__make(newMap)}function makeSet(map,ownerID){var set=Object.create(SetPrototype);set.size=map?map.size:0;set._map=map;set.__ownerID=ownerID;return set}var EMPTY_SET;function emptySet(){return EMPTY_SET||(EMPTY_SET=makeSet(emptyMap()))}createClass(OrderedSet,Set);function OrderedSet(value){return value===null||value===undefined?emptyOrderedSet():isOrderedSet(value)?value:emptyOrderedSet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size);iter.forEach(function(v){return set.add(v)})})}OrderedSet.of=function(){return this(arguments)};OrderedSet.fromKeys=function(value){return this(KeyedIterable(value).keySeq())};OrderedSet.prototype.toString=function(){return this.__toString("OrderedSet {","}")};function isOrderedSet(maybeOrderedSet){return isSet(maybeOrderedSet)&&isOrdered(maybeOrderedSet)}OrderedSet.isOrderedSet=isOrderedSet;var OrderedSetPrototype=OrderedSet.prototype;OrderedSetPrototype[IS_ORDERED_SENTINEL]=true;OrderedSetPrototype.__empty=emptyOrderedSet;OrderedSetPrototype.__make=makeOrderedSet;function makeOrderedSet(map,ownerID){var set=Object.create(OrderedSetPrototype);set.size=map?map.size:0;set._map=map;set.__ownerID=ownerID;return set}var EMPTY_ORDERED_SET;function emptyOrderedSet(){return EMPTY_ORDERED_SET||(EMPTY_ORDERED_SET=makeOrderedSet(emptyOrderedMap()))}createClass(Stack,IndexedCollection);function Stack(value){return value===null||value===undefined?emptyStack():isStack(value)?value:emptyStack().unshiftAll(value)}Stack.of=function(){return this(arguments)};Stack.prototype.toString=function(){return this.__toString("Stack [","]")};Stack.prototype.get=function(index,notSetValue){var head=this._head;index=wrapIndex(this,index);while(head&&index--){head=head.next}return head?head.value:notSetValue};Stack.prototype.peek=function(){return this._head&&this._head.value};Stack.prototype.push=function(){if(arguments.length===0){return this}var newSize=this.size+arguments.length;var head=this._head;for(var ii=arguments.length-1;ii>=0;ii--){head={value:arguments[ii],next:head}}if(this.__ownerID){this.size=newSize;this._head=head;this.__hash=undefined;this.__altered=true;return this}return makeStack(newSize,head)};Stack.prototype.pushAll=function(iter){iter=IndexedIterable(iter);if(iter.size===0){return this}assertNotInfinite(iter.size);var newSize=this.size;var head=this._head;iter.reverse().forEach(function(value){newSize++;head={value:value,next:head}});if(this.__ownerID){this.size=newSize;this._head=head;this.__hash=undefined;this.__altered=true;return this}return makeStack(newSize,head)};Stack.prototype.pop=function(){return this.slice(1)};Stack.prototype.unshift=function(){return this.push.apply(this,arguments)};Stack.prototype.unshiftAll=function(iter){return this.pushAll(iter)};Stack.prototype.shift=function(){return this.pop.apply(this,arguments)};Stack.prototype.clear=function(){if(this.size===0){return this}if(this.__ownerID){this.size=0;this._head=undefined;this.__hash=undefined;this.__altered=true;return this}return emptyStack()};Stack.prototype.slice=function(begin,end){if(wholeSlice(begin,end,this.size)){return this}var resolvedBegin=resolveBegin(begin,this.size);var resolvedEnd=resolveEnd(end,this.size);if(resolvedEnd!==this.size){return IndexedCollection.prototype.slice.call(this,begin,end)}var newSize=this.size-resolvedBegin;var head=this._head;while(resolvedBegin--){head=head.next}if(this.__ownerID){this.size=newSize;this._head=head;this.__hash=undefined;this.__altered=true;return this}return makeStack(newSize,head)};Stack.prototype.__ensureOwner=function(ownerID){if(ownerID===this.__ownerID){return this}if(!ownerID){this.__ownerID=ownerID;this.__altered=false;return this}return makeStack(this.size,this._head,ownerID,this.__hash)};Stack.prototype.__iterate=function(fn,reverse){if(reverse){return this.reverse().__iterate(fn)}var iterations=0;var node=this._head;while(node){if(fn(node.value,iterations++,this)===false){break}node=node.next}return iterations};Stack.prototype.__iterator=function(type,reverse){if(reverse){return this.reverse().__iterator(type)}var iterations=0;var node=this._head;return new Iterator(function(){if(node){var value=node.value;node=node.next;return iteratorValue(type,iterations++,value)}return iteratorDone()})};function isStack(maybeStack){return!!(maybeStack&&maybeStack[IS_STACK_SENTINEL])}Stack.isStack=isStack;var IS_STACK_SENTINEL="@@__IMMUTABLE_STACK__@@";var StackPrototype=Stack.prototype;StackPrototype[IS_STACK_SENTINEL]=true;StackPrototype.withMutations=MapPrototype.withMutations;StackPrototype.asMutable=MapPrototype.asMutable;StackPrototype.asImmutable=MapPrototype.asImmutable;StackPrototype.wasAltered=MapPrototype.wasAltered;function makeStack(size,head,ownerID,hash){var map=Object.create(StackPrototype);map.size=size;map._head=head;map.__ownerID=ownerID;map.__hash=hash;map.__altered=false;return map}var EMPTY_STACK;function emptyStack(){return EMPTY_STACK||(EMPTY_STACK=makeStack(0))}function mixin(ctor,methods){var keyCopier=function(key){ctor.prototype[key]=methods[key]};Object.keys(methods).forEach(keyCopier);Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(methods).forEach(keyCopier);return ctor}Iterable.Iterator=Iterator;mixin(Iterable,{toArray:function(){assertNotInfinite(this.size);var array=new Array(this.size||0);this.valueSeq().__iterate(function(v,i){array[i]=v});return array},toIndexedSeq:function(){return new ToIndexedSequence(this)},toJS:function(){return this.toSeq().map(function(value){return value&&typeof value.toJS==="function"?value.toJS():value}).__toJS()},toJSON:function(){return this.toSeq().map(function(value){return value&&typeof value.toJSON==="function"?value.toJSON():value}).__toJS()},toKeyedSeq:function(){return new ToKeyedSequence(this,true)},toMap:function(){return Map(this.toKeyedSeq())},toObject:function(){assertNotInfinite(this.size);var object={};this.__iterate(function(v,k){object[k]=v});return object},toOrderedMap:function(){return OrderedMap(this.toKeyedSeq())},toOrderedSet:function(){return OrderedSet(isKeyed(this)?this.valueSeq():this)},toSet:function(){return Set(isKeyed(this)?this.valueSeq():this)},toSetSeq:function(){return new ToSetSequence(this)},toSeq:function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Stack(isKeyed(this)?this.valueSeq():this)},toList:function(){return List(isKeyed(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(head,tail){if(this.size===0){return head+tail}return head+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+tail},concat:function(){var values=SLICE$0.call(arguments,0);return reify(this,concatFactory(this,values))},includes:function(searchValue){return this.some(function(value){return is(value,searchValue)})},entries:function(){return this.__iterator(ITERATE_ENTRIES)},every:function(predicate,context){assertNotInfinite(this.size);var returnValue=true;this.__iterate(function(v,k,c){if(!predicate.call(context,v,k,c)){returnValue=false;return false}});return returnValue},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,true))},find:function(predicate,context,notSetValue){var entry=this.findEntry(predicate,context);return entry?entry[1]:notSetValue},findEntry:function(predicate,context){var found;this.__iterate(function(v,k,c){if(predicate.call(context,v,k,c)){found=[k,v];return false}});return found},findLastEntry:function(predicate,context){return this.toSeq().reverse().findEntry(predicate,context)},forEach:function(sideEffect,context){assertNotInfinite(this.size);return this.__iterate(context?sideEffect.bind(context):sideEffect)},join:function(separator){assertNotInfinite(this.size);separator=separator!==undefined?""+separator:",";var joined="";var isFirst=true;this.__iterate(function(v){isFirst?isFirst=false:joined+=separator;joined+=v!==null&&v!==undefined?v.toString():""});return joined},keys:function(){return this.__iterator(ITERATE_KEYS)},map:function(mapper,context){return reify(this,mapFactory(this,mapper,context))},reduce:function(reducer,initialReduction,context){assertNotInfinite(this.size);var reduction;var useFirst;if(arguments.length<2){useFirst=true}else{reduction=initialReduction}this.__iterate(function(v,k,c){if(useFirst){useFirst=false;reduction=v}else{reduction=reducer.call(context,reduction,v,k,c)}});return reduction},reduceRight:function(reducer,initialReduction,context){var reversed=this.toKeyedSeq().reverse();return reversed.reduce.apply(reversed,arguments)},reverse:function(){return reify(this,reverseFactory(this,true))},slice:function(begin,end){return reify(this,sliceFactory(this,begin,end,true))},some:function(predicate,context){return!this.every(not(predicate),context)},sort:function(comparator){return reify(this,sortFactory(this,comparator))},values:function(){return this.__iterator(ITERATE_VALUES)},butLast:function(){return this.slice(0,-1)},isEmpty:function(){return this.size!==undefined?this.size===0:!this.some(function(){return true})},count:function(predicate,context){return ensureSize(predicate?this.toSeq().filter(predicate,context):this)},countBy:function(grouper,context){return countByFactory(this,grouper,context)},equals:function(other){return deepEqual(this,other)},entrySeq:function(){var iterable=this;if(iterable._cache){return new ArraySeq(iterable._cache)}var entriesSequence=iterable.toSeq().map(entryMapper).toIndexedSeq();entriesSequence.fromEntrySeq=function(){return iterable.toSeq()};return entriesSequence},filterNot:function(predicate,context){return this.filter(not(predicate),context)},findLast:function(predicate,context,notSetValue){return this.toKeyedSeq().reverse().find(predicate,context,notSetValue)},first:function(){return this.find(returnTrue)},flatMap:function(mapper,context){return reify(this,flatMapFactory(this,mapper,context))},flatten:function(depth){return reify(this,flattenFactory(this,depth,true))},fromEntrySeq:function(){return new FromEntriesSequence(this)},get:function(searchKey,notSetValue){return this.find(function(_,key){return is(key,searchKey)},undefined,notSetValue)},getIn:function(searchKeyPath,notSetValue){var nested=this;var iter=forceIterator(searchKeyPath);var step;while(!(step=iter.next()).done){var key=step.value;nested=nested&&nested.get?nested.get(key,NOT_SET):NOT_SET;if(nested===NOT_SET){return notSetValue}}return nested},groupBy:function(grouper,context){return groupByFactory(this,grouper,context)},has:function(searchKey){return this.get(searchKey,NOT_SET)!==NOT_SET},hasIn:function(searchKeyPath){return this.getIn(searchKeyPath,NOT_SET)!==NOT_SET},isSubset:function(iter){iter=typeof iter.includes==="function"?iter:Iterable(iter);return this.every(function(value){return iter.includes(value)})},isSuperset:function(iter){iter=typeof iter.isSubset==="function"?iter:Iterable(iter);return iter.isSubset(this)},keySeq:function(){return this.toSeq().map(keyMapper).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(comparator){return maxFactory(this,comparator)},maxBy:function(mapper,comparator){return maxFactory(this,comparator,mapper)},min:function(comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator)},minBy:function(mapper,comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator,mapper)},rest:function(){return this.slice(1)},skip:function(amount){return this.slice(Math.max(0,amount))},skipLast:function(amount){return reify(this,this.toSeq().reverse().skip(amount).reverse())},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,true))},skipUntil:function(predicate,context){return this.skipWhile(not(predicate),context)},sortBy:function(mapper,comparator){return reify(this,sortFactory(this,comparator,mapper))},take:function(amount){return this.slice(0,Math.max(0,amount))},takeLast:function(amount){return reify(this,this.toSeq().reverse().take(amount).reverse())},takeWhile:function(predicate,context){return reify(this,takeWhileFactory(this,predicate,context))},takeUntil:function(predicate,context){return this.takeWhile(not(predicate),context)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=hashIterable(this))}});var IterablePrototype=Iterable.prototype;IterablePrototype[IS_ITERABLE_SENTINEL]=true;IterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.values;IterablePrototype.__toJS=IterablePrototype.toArray;IterablePrototype.__toStringMapper=quoteString;IterablePrototype.inspect=IterablePrototype.toSource=function(){return this.toString()};IterablePrototype.chain=IterablePrototype.flatMap;IterablePrototype.contains=IterablePrototype.includes;(function(){try{Object.defineProperty(IterablePrototype,"length",{get:function(){if(!Iterable.noLengthWarning){var stack;try{throw new Error}catch(error){stack=error.stack}if(stack.indexOf("_wrapObject")===-1){console&&console.warn&&console.warn("iterable.length has been deprecated, "+"use iterable.size or iterable.count(). "+"This warning will become a silent error in a future version. "+stack);return this.size}}}})}catch(e){}})();mixin(KeyedIterable,{flip:function(){return reify(this,flipFactory(this))},findKey:function(predicate,context){var entry=this.findEntry(predicate,context);return entry&&entry[0]},findLastKey:function(predicate,context){return this.toSeq().reverse().findKey(predicate,context)},keyOf:function(searchValue){return this.findKey(function(value){return is(value,searchValue)})},lastKeyOf:function(searchValue){return this.findLastKey(function(value){return is(value,searchValue)})},mapEntries:function(mapper,context){var this$0=this;var iterations=0;return reify(this,this.toSeq().map(function(v,k){return mapper.call(context,[k,v],iterations++,this$0)}).fromEntrySeq())},mapKeys:function(mapper,context){var this$0=this;return reify(this,this.toSeq().flip().map(function(k,v){return mapper.call(context,k,v,this$0)}).flip())}});var KeyedIterablePrototype=KeyedIterable.prototype;KeyedIterablePrototype[IS_KEYED_SENTINEL]=true;KeyedIterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.entries;KeyedIterablePrototype.__toJS=IterablePrototype.toObject;KeyedIterablePrototype.__toStringMapper=function(v,k){return JSON.stringify(k)+": "+quoteString(v)};mixin(IndexedIterable,{toKeyedSeq:function(){return new ToKeyedSequence(this,false)},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,false))},findIndex:function(predicate,context){var entry=this.findEntry(predicate,context);return entry?entry[0]:-1},indexOf:function(searchValue){var key=this.toKeyedSeq().keyOf(searchValue);return key===undefined?-1:key},lastIndexOf:function(searchValue){var key=this.toKeyedSeq().reverse().keyOf(searchValue);return key===undefined?-1:key},reverse:function(){return reify(this,reverseFactory(this,false))},slice:function(begin,end){return reify(this,sliceFactory(this,begin,end,false))},splice:function(index,removeNum){var numArgs=arguments.length;removeNum=Math.max(removeNum|0,0);if(numArgs===0||numArgs===2&&!removeNum){return this}index=resolveBegin(index,index<0?this.count():this.size);var spliced=this.slice(0,index);return reify(this,numArgs===1?spliced:spliced.concat(arrCopy(arguments,2),this.slice(index+removeNum)))},findLastIndex:function(predicate,context){var key=this.toKeyedSeq().findLastKey(predicate,context);return key===undefined?-1:key},first:function(){return this.get(0)},flatten:function(depth){return reify(this,flattenFactory(this,depth,false))},get:function(index,notSetValue){index=wrapIndex(this,index);return index<0||(this.size===Infinity||this.size!==undefined&&index>this.size)?notSetValue:this.find(function(_,key){return key===index},undefined,notSetValue)},has:function(index){index=wrapIndex(this,index);return index>=0&&(this.size!==undefined?this.size===Infinity||index<this.size:this.indexOf(index)!==-1)},interpose:function(separator){return reify(this,interposeFactory(this,separator))},interleave:function(){var iterables=[this].concat(arrCopy(arguments));var zipped=zipWithFactory(this.toSeq(),IndexedSeq.of,iterables);var interleaved=zipped.flatten(true);if(zipped.size){interleaved.size=zipped.size*iterables.length}return reify(this,interleaved)},last:function(){return this.get(-1)},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,false))},zip:function(){var iterables=[this].concat(arrCopy(arguments));return reify(this,zipWithFactory(this,defaultZipper,iterables))},zipWith:function(zipper){var iterables=arrCopy(arguments);iterables[0]=this;return reify(this,zipWithFactory(this,zipper,iterables))}});IndexedIterable.prototype[IS_INDEXED_SENTINEL]=true;IndexedIterable.prototype[IS_ORDERED_SENTINEL]=true;mixin(SetIterable,{get:function(value,notSetValue){return this.has(value)?value:notSetValue},includes:function(value){return this.has(value)},keySeq:function(){return this.valueSeq()}});SetIterable.prototype.has=IterablePrototype.includes;SetIterable.prototype.contains=SetIterable.prototype.includes;mixin(KeyedSeq,KeyedIterable.prototype);mixin(IndexedSeq,IndexedIterable.prototype);mixin(SetSeq,SetIterable.prototype);mixin(KeyedCollection,KeyedIterable.prototype);mixin(IndexedCollection,IndexedIterable.prototype);mixin(SetCollection,SetIterable.prototype);function keyMapper(v,k){return k}function entryMapper(v,k){return[k,v]}function not(predicate){return function(){return!predicate.apply(this,arguments)}}function neg(predicate){return function(){return-predicate.apply(this,arguments)}}function quoteString(value){return typeof value==="string"?JSON.stringify(value):value}function defaultZipper(){return arrCopy(arguments)}function defaultNegComparator(a,b){return a<b?1:a>b?-1:0}function hashIterable(iterable){if(iterable.size===Infinity){return 0}var ordered=isOrdered(iterable);var keyed=isKeyed(iterable);var h=ordered?1:0;var size=iterable.__iterate(keyed?ordered?function(v,k){h=31*h+hashMerge(hash(v),hash(k))|0}:function(v,k){h=h+hashMerge(hash(v),hash(k))|0}:ordered?function(v){h=31*h+hash(v)|0}:function(v){h=h+hash(v)|0});return murmurHashOfSize(size,h)}function murmurHashOfSize(size,h){h=imul(h,3432918353);h=imul(h<<15|h>>>-15,461845907);h=imul(h<<13|h>>>-13,5);h=(h+3864292196|0)^size;h=imul(h^h>>>16,2246822507);h=imul(h^h>>>13,3266489909);h=smi(h^h>>>16);return h}function hashMerge(a,b){return a^b+2654435769+(a<<6)+(a>>2)|0}var Immutable={Iterable:Iterable,Seq:Seq,Collection:Collection,Map:Map,OrderedMap:OrderedMap,List:List,Stack:Stack,Set:Set,OrderedSet:OrderedSet,Record:Record,Range:Range,Repeat:Repeat,is:is,fromJS:fromJS};return Immutable});var __LiteMolZlib={};(function(){"use strict";function q(b){throw b}var t=void 0,u=!0,aa=this;function A(b,a){var c=b.split("."),d=aa;!(c[0]in d)&&d.execScript&&d.execScript("var "+c[0]);for(var e;c.length&&(e=c.shift());)!c.length&&a!==t?d[e]=a:d=d[e]?d[e]:d[e]={}}var B="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array&&"undefined"!==typeof Uint32Array&&"undefined"!==typeof DataView;function F(b,a){this.index="number"===typeof a?a:0;this.m=0;this.buffer=b instanceof(B?Uint8Array:Array)?b:new(B?Uint8Array:Array)(32768);2*this.buffer.length<=this.index&&q(Error("invalid index"));this.buffer.length<=this.index&&this.f()}F.prototype.f=function(){var b=this.buffer,a,c=b.length,d=new(B?Uint8Array:Array)(c<<1);if(B)d.set(b);else for(a=0;a<c;++a)d[a]=b[a];return this.buffer=d};F.prototype.d=function(b,a,c){var d=this.buffer,e=this.index,f=this.m,g=d[e],k;c&&1<a&&(b=8<a?(H[b&255]<<24|H[b>>>8&255]<<16|H[b>>>16&255]<<8|H[b>>>24&255])>>32-a:H[b]>>8-a);if(8>a+f)g=g<<a|b,f+=a;else for(k=0;k<a;++k)g=g<<1|b>>a-k-1&1,8===++f&&(f=0,d[e++]=H[g],g=0,e===d.length&&(d=this.f()));d[e]=g;this.buffer=d;this.m=f;this.index=e};F.prototype.finish=function(){var b=this.buffer,a=this.index,c;0<this.m&&(b[a]<<=8-this.m,b[a]=H[b[a]],a++);B?c=b.subarray(0,a):(b.length=a,c=b);return c};var ba=new(B?Uint8Array:Array)(256),ca;for(ca=0;256>ca;++ca){for(var K=ca,da=K,ea=7,K=K>>>1;K;K>>>=1)da<<=1,da|=K&1,--ea;ba[ca]=(da<<ea&255)>>>0}var H=ba;function ja(b,a,c){var d,e="number"===typeof a?a:a=0,f="number"===typeof c?c:b.length;d=-1;for(e=f&7;e--;++a)d=d>>>8^O[(d^b[a])&255];for(e=f>>3;e--;a+=8)d=d>>>8^O[(d^b[a])&255],d=d>>>8^O[(d^b[a+1])&255],d=d>>>8^O[(d^b[a+2])&255],d=d>>>8^O[(d^b[a+3])&255],d=d>>>8^O[(d^b[a+4])&255],d=d>>>8^O[(d^b[a+5])&255],d=d>>>8^O[(d^b[a+6])&255],d=d>>>8^O[(d^b[a+7])&255];return(d^4294967295)>>>0}var ka=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],O=B?new Uint32Array(ka):ka;function P(){}P.prototype.getName=function(){return this.name};P.prototype.getData=function(){return this.data};P.prototype.Y=function(){return this.Z};A("Zlib.GunzipMember",P);A("Zlib.GunzipMember.prototype.getName",P.prototype.getName);A("Zlib.GunzipMember.prototype.getData",P.prototype.getData);A("Zlib.GunzipMember.prototype.getMtime",P.prototype.Y);function la(b){this.buffer=new(B?Uint16Array:Array)(2*b);this.length=0}la.prototype.getParent=function(b){return 2*((b-2)/4|0)};la.prototype.push=function(b,a){var c,d,e=this.buffer,f;c=this.length;e[this.length++]=a;for(e[this.length++]=b;0<c;)if(d=this.getParent(c),e[c]>e[d])f=e[c],e[c]=e[d],e[d]=f,f=e[c+1],e[c+1]=e[d+1],e[d+1]=f,c=d;else break;return this.length};la.prototype.pop=function(){var b,a,c=this.buffer,d,e,f;a=c[0];b=c[1];this.length-=2;c[0]=c[this.length];c[1]=c[this.length+1];for(f=0;;){e=2*f+2;if(e>=this.length)break;e+2<this.length&&c[e+2]>c[e]&&(e+=2);if(c[e]>c[f])d=c[f],c[f]=c[e],c[e]=d,d=c[f+1],c[f+1]=c[e+1],c[e+1]=d;else break;f=e}return{index:b,value:a,length:this.length}};function ma(b){var a=b.length,c=0,d=Number.POSITIVE_INFINITY,e,f,g,k,h,l,s,p,m,n;for(p=0;p<a;++p)b[p]>c&&(c=b[p]),b[p]<d&&(d=b[p]);e=1<<c;f=new(B?Uint32Array:Array)(e);g=1;k=0;for(h=2;g<=c;){for(p=0;p<a;++p)if(b[p]===g){l=0;s=k;for(m=0;m<g;++m)l=l<<1|s&1,s>>=1;n=g<<16|p;for(m=l;m<e;m+=h)f[m]=n;++k}++g;k<<=1;h<<=1}return[f,c,d]}function na(b,a){this.k=qa;this.I=0;this.input=B&&b instanceof Array?new Uint8Array(b):b;this.b=0;a&&(a.lazy&&(this.I=a.lazy),"number"===typeof a.compressionType&&(this.k=a.compressionType),a.outputBuffer&&(this.a=B&&a.outputBuffer instanceof Array?new Uint8Array(a.outputBuffer):a.outputBuffer),"number"===typeof a.outputIndex&&(this.b=a.outputIndex));this.a||(this.a=new(B?Uint8Array:Array)(32768))}var qa=2,ra={NONE:0,v:1,o:qa,ba:3},sa=[],S;for(S=0;288>S;S++)switch(u){case 143>=S:sa.push([S+48,8]);break;case 255>=S:sa.push([S-144+400,9]);break;case 279>=S:sa.push([S-256+0,7]);break;case 287>=S:sa.push([S-280+192,8]);break;default:q("invalid literal: "+S)}na.prototype.g=function(){var b,a,c,d,e=this.input;switch(this.k){case 0:c=0;for(d=e.length;c<d;){a=B?e.subarray(c,c+65535):e.slice(c,c+65535);c+=a.length;var f=a,g=c===d,k=t,h=t,l=t,s=t,p=t,m=this.a,n=this.b;if(B){for(m=new Uint8Array(this.a.buffer);m.length<=n+f.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}k=g?1:0;m[n++]=k|0;h=f.length;l=~h+65536&65535;m[n++]=h&255;m[n++]=h>>>8&255;m[n++]=l&255;m[n++]=l>>>8&255;if(B)m.set(f,n),n+=f.length,m=m.subarray(0,n);else{s=0;for(p=f.length;s<p;++s)m[n++]=f[s];m.length=n}this.b=n;this.a=m}break;case 1:var r=new F(B?new Uint8Array(this.a.buffer):this.a,this.b);r.d(1,1,u);r.d(1,2,u);var v=ta(this,e),x,Q,y;x=0;for(Q=v.length;x<Q;x++)if(y=v[x],F.prototype.d.apply(r,sa[y]),256<y)r.d(v[++x],v[++x],u),r.d(v[++x],5),r.d(v[++x],v[++x],u);else if(256===y)break;this.a=r.finish();this.b=this.a.length;break;case qa:var E=new F(B?new Uint8Array(this.a.buffer):this.a,this.b),Ka,R,X,Y,Z,pb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],fa,La,ga,Ma,oa,wa=Array(19),Na,$,pa,C,Oa;Ka=qa;E.d(1,1,u);E.d(Ka,2,u);R=ta(this,e);fa=ua(this.W,15);La=va(fa);ga=ua(this.V,7);Ma=va(ga);for(X=286;257<X&&0===fa[X-1];X--);for(Y=30;1<Y&&0===ga[Y-1];Y--);var Pa=X,Qa=Y,J=new(B?Uint32Array:Array)(Pa+Qa),w,L,z,ha,I=new(B?Uint32Array:Array)(316),G,D,M=new(B?Uint8Array:Array)(19);for(w=L=0;w<Pa;w++)J[L++]=fa[w];for(w=0;w<Qa;w++)J[L++]=ga[w];if(!B){w=0;for(ha=M.length;w<ha;++w)M[w]=0}w=G=0;for(ha=J.length;w<ha;w+=L){for(L=1;w+L<ha&&J[w+L]===J[w];++L);z=L;if(0===J[w])if(3>z)for(;0<z--;)I[G++]=0,M[0]++;else for(;0<z;)D=138>z?z:138,D>z-3&&D<z&&(D=z-3),10>=D?(I[G++]=17,I[G++]=D-3,M[17]++):(I[G++]=18,I[G++]=D-11,M[18]++),z-=D;else if(I[G++]=J[w],M[J[w]]++,z--,3>z)for(;0<z--;)I[G++]=J[w],M[J[w]]++;else for(;0<z;)D=6>z?z:6,D>z-3&&D<z&&(D=z-3),I[G++]=16,I[G++]=D-3,M[16]++,z-=D}b=B?I.subarray(0,G):I.slice(0,G);oa=ua(M,7);for(C=0;19>C;C++)wa[C]=oa[pb[C]];for(Z=19;4<Z&&0===wa[Z-1];Z--);Na=va(oa);E.d(X-257,5,u);E.d(Y-1,5,u);E.d(Z-4,4,u);for(C=0;C<Z;C++)E.d(wa[C],3,u);C=0;for(Oa=b.length;C<Oa;C++)if($=b[C],E.d(Na[$],oa[$],u),16<=$){C++;switch($){case 16:pa=2;break;case 17:pa=3;break;case 18:pa=7;break;default:q("invalid code: "+$)}E.d(b[C],pa,u)}var Ra=[La,fa],Sa=[Ma,ga],N,Ta,ia,za,Ua,Va,Wa,Xa;Ua=Ra[0];Va=Ra[1];Wa=Sa[0];Xa=Sa[1];N=0;for(Ta=R.length;N<Ta;++N)if(ia=R[N],E.d(Ua[ia],Va[ia],u),256<ia)E.d(R[++N],R[++N],u),za=R[++N],E.d(Wa[za],Xa[za],u),E.d(R[++N],R[++N],u);else if(256===ia)break;this.a=E.finish();this.b=this.a.length;break;default:q("invalid compression type")}return this.a};function xa(b,a){this.length=b;this.Q=a}var ya=function(){function b(a){switch(u){case 3===a:return[257,a-3,0];case 4===a:return[258,a-4,0];case 5===a:return[259,a-5,0];case 6===a:return[260,a-6,0];case 7===a:return[261,a-7,0];case 8===a:return[262,a-8,0];case 9===a:return[263,a-9,0];case 10===a:return[264,a-10,0];case 12>=a:return[265,a-11,1];case 14>=a:return[266,a-13,1];case 16>=a:return[267,a-15,1];case 18>=a:return[268,a-17,1];case 22>=a:return[269,a-19,2];case 26>=a:return[270,a-23,2];case 30>=a:return[271,a-27,2];case 34>=a:return[272,a-31,2];case 42>=a:return[273,a-35,3];case 50>=a:return[274,a-43,3];case 58>=a:return[275,a-51,3];case 66>=a:return[276,a-59,3];case 82>=a:return[277,a-67,4];case 98>=a:return[278,a-83,4];case 114>=a:return[279,a-99,4];case 130>=a:return[280,a-115,4];case 162>=a:return[281,a-131,5];case 194>=a:return[282,a-163,5];case 226>=a:return[283,a-195,5];case 257>=a:return[284,a-227,5];case 258===a:return[285,a-258,0];default:q("invalid length: "+a)}}var a=[],c,d;for(c=3;258>=c;c++)d=b(c),a[c]=d[2]<<24|d[1]<<16|d[0];return a}(),Aa=B?new Uint32Array(ya):ya;function ta(b,a){function c(a,c){var b=a.Q,d=[],e=0,f;f=Aa[a.length];d[e++]=f&65535;d[e++]=f>>16&255;d[e++]=f>>24;var g;switch(u){case 1===b:g=[0,b-1,0];break;case 2===b:g=[1,b-2,0];break;case 3===b:g=[2,b-3,0];break;case 4===b:g=[3,b-4,0];break;case 6>=b:g=[4,b-5,1];break;case 8>=b:g=[5,b-7,1];break;case 12>=b:g=[6,b-9,2];break;case 16>=b:g=[7,b-13,2];break;case 24>=b:g=[8,b-17,3];break;case 32>=b:g=[9,b-25,3];break;case 48>=b:g=[10,b-33,4];break;case 64>=b:g=[11,b-49,4];break;case 96>=b:g=[12,b-65,5];break;case 128>=b:g=[13,b-97,5];break;case 192>=b:g=[14,b-129,6];break;case 256>=b:g=[15,b-193,6];break;case 384>=b:g=[16,b-257,7];break;case 512>=b:g=[17,b-385,7];break;case 768>=b:g=[18,b-513,8];break;case 1024>=b:g=[19,b-769,8];break;case 1536>=b:g=[20,b-1025,9];break;case 2048>=b:g=[21,b-1537,9];break;case 3072>=b:g=[22,b-2049,10];break;case 4096>=b:g=[23,b-3073,10];break;case 6144>=b:g=[24,b-4097,11];break;case 8192>=b:g=[25,b-6145,11];break;case 12288>=b:g=[26,b-8193,12];break;case 16384>=b:g=[27,b-12289,12];break;case 24576>=b:g=[28,b-16385,13];break;case 32768>=b:g=[29,b-24577,13];break;default:q("invalid distance")}f=g;d[e++]=f[0];d[e++]=f[1];d[e++]=f[2];var h,k;h=0;for(k=d.length;h<k;++h)m[n++]=d[h];v[d[0]]++;x[d[3]]++;r=a.length+c-1;p=null}var d,e,f,g,k,h={},l,s,p,m=B?new Uint16Array(2*a.length):[],n=0,r=0,v=new(B?Uint32Array:Array)(286),x=new(B?Uint32Array:Array)(30),Q=b.I,y;if(!B){for(f=0;285>=f;)v[f++]=0;for(f=0;29>=f;)x[f++]=0}v[256]=1;d=0;for(e=a.length;d<e;++d){f=k=0;for(g=3;f<g&&d+f!==e;++f)k=k<<8|a[d+f];h[k]===t&&(h[k]=[]);l=h[k];if(!(0<r--)){for(;0<l.length&&32768<d-l[0];)l.shift();if(d+3>=e){p&&c(p,-1);f=0;for(g=e-d;f<g;++f)y=a[d+f],m[n++]=y,++v[y];break}0<l.length?(s=Ba(a,d,l),p?p.length<s.length?(y=a[d-1],m[n++]=y,++v[y],c(s,0)):c(p,-1):s.length<Q?p=s:c(s,0)):p?c(p,-1):(y=a[d],m[n++]=y,++v[y])}l.push(d)}m[n++]=256;v[256]++;b.W=v;b.V=x;return B?m.subarray(0,n):m}function Ba(b,a,c){var d,e,f=0,g,k,h,l,s=b.length;k=0;l=c.length;a:for(;k<l;k++){d=c[l-k-1];g=3;if(3<f){for(h=f;3<h;h--)if(b[d+h-1]!==b[a+h-1])continue a;g=f}for(;258>g&&a+g<s&&b[d+g]===b[a+g];)++g;g>f&&(e=d,f=g);if(258===g)break}return new xa(f,a-e)}function ua(b,a){var c=b.length,d=new la(572),e=new(B?Uint8Array:Array)(c),f,g,k,h,l;if(!B)for(h=0;h<c;h++)e[h]=0;for(h=0;h<c;++h)0<b[h]&&d.push(h,b[h]);f=Array(d.length/2);g=new(B?Uint32Array:Array)(d.length/2);if(1===f.length)return e[d.pop().index]=1,e;h=0;for(l=d.length/2;h<l;++h)f[h]=d.pop(),g[h]=f[h].value;k=Ca(g,g.length,a);h=0;for(l=f.length;h<l;++h)e[f[h].index]=k[h];return e}function Ca(b,a,c){function d(b){var c=h[b][l[b]];c===a?(d(b+1),d(b+1)):--g[c];++l[b]}var e=new(B?Uint16Array:Array)(c),f=new(B?Uint8Array:Array)(c),g=new(B?Uint8Array:Array)(a),k=Array(c),h=Array(c),l=Array(c),s=(1<<c)-a,p=1<<c-1,m,n,r,v,x;e[c-1]=a;for(n=0;n<c;++n)s<p?f[n]=0:(f[n]=1,s-=p),s<<=1,e[c-2-n]=(e[c-1-n]/2|0)+a;e[0]=f[0];k[0]=Array(e[0]);h[0]=Array(e[0]);for(n=1;n<c;++n)e[n]>2*e[n-1]+f[n]&&(e[n]=2*e[n-1]+f[n]),k[n]=Array(e[n]),h[n]=Array(e[n]);for(m=0;m<a;++m)g[m]=c;for(r=0;r<e[c-1];++r)k[c-1][r]=b[r],h[c-1][r]=r;for(m=0;m<c;++m)l[m]=0;1===f[c-1]&&(--g[0],++l[c-1]);for(n=c-2;0<=n;--n){v=m=0;x=l[n+1];for(r=0;r<e[n];r++)v=k[n+1][x]+k[n+1][x+1],v>b[m]?(k[n][r]=v,h[n][r]=a,x+=2):(k[n][r]=b[m],h[n][r]=m,++m);l[n]=0;1===f[n]&&d(n)}return g}function va(b){var a=new(B?Uint16Array:Array)(b.length),c=[],d=[],e=0,f,g,k,h;f=0;for(g=b.length;f<g;f++)c[b[f]]=(c[b[f]]|0)+1;f=1;for(g=16;f<=g;f++)d[f]=e,e+=c[f]|0,e<<=1;f=0;for(g=b.length;f<g;f++){e=d[b[f]];d[b[f]]+=1;k=a[f]=0;for(h=b[f];k<h;k++)a[f]=a[f]<<1|e&1,e>>>=1}return a}function Da(b,a){this.input=b;this.b=this.c=0;this.i={};a&&(a.flags&&(this.i=a.flags),"string"===typeof a.filename&&(this.filename=a.filename),"string"===typeof a.comment&&(this.A=a.comment),a.deflateOptions&&(this.l=a.deflateOptions));this.l||(this.l={})}Da.prototype.g=function(){var b,a,c,d,e,f,g,k,h=new(B?Uint8Array:Array)(32768),l=0,s=this.input,p=this.c,m=this.filename,n=this.A;h[l++]=31;h[l++]=139;h[l++]=8;b=0;this.i.fname&&(b|=Ea);this.i.fcomment&&(b|=Fa);this.i.fhcrc&&(b|=Ga);h[l++]=b;a=(Date.now?Date.now():+new Date)/1e3|0;h[l++]=a&255;h[l++]=a>>>8&255;h[l++]=a>>>16&255;h[l++]=a>>>24&255;h[l++]=0;h[l++]=Ha;if(this.i.fname!==t){g=0;for(k=m.length;g<k;++g)f=m.charCodeAt(g),255<f&&(h[l++]=f>>>8&255),h[l++]=f&255;h[l++]=0}if(this.i.comment){g=0;for(k=n.length;g<k;++g)f=n.charCodeAt(g),255<f&&(h[l++]=f>>>8&255),h[l++]=f&255;h[l++]=0}this.i.fhcrc&&(c=ja(h,0,l)&65535,h[l++]=c&255,h[l++]=c>>>8&255);this.l.outputBuffer=h;this.l.outputIndex=l;e=new na(s,this.l);h=e.g();l=e.b;B&&(l+8>h.buffer.byteLength?(this.a=new Uint8Array(l+8),this.a.set(new Uint8Array(h.buffer)),h=this.a):h=new Uint8Array(h.buffer));d=ja(s,t,t);h[l++]=d&255;h[l++]=d>>>8&255;h[l++]=d>>>16&255;h[l++]=d>>>24&255;k=s.length;h[l++]=k&255;h[l++]=k>>>8&255;h[l++]=k>>>16&255;h[l++]=k>>>24&255;this.c=p;B&&l<h.length&&(this.a=h=h.subarray(0,l));return h};var Ha=255,Ga=2,Ea=8,Fa=16;A("Zlib.Gzip",Da);A("Zlib.Gzip.prototype.compress",Da.prototype.g);function T(b,a){this.p=[];this.q=32768;this.e=this.j=this.c=this.u=0;this.input=B?new Uint8Array(b):b;this.w=!1;this.r=Ia;this.M=!1;if(a||!(a={}))a.index&&(this.c=a.index),a.bufferSize&&(this.q=a.bufferSize),a.bufferType&&(this.r=a.bufferType),a.resize&&(this.M=a.resize);switch(this.r){case Ja:this.b=32768;this.a=new(B?Uint8Array:Array)(32768+this.q+258);break;case Ia:this.b=0;this.a=new(B?Uint8Array:Array)(this.q);this.f=this.U;this.B=this.R;this.s=this.T;break;default:q(Error("invalid inflate mode"))}}var Ja=0,Ia=1,Ya={O:Ja,N:Ia};T.prototype.h=function(){for(;!this.w;){var b=U(this,3);b&1&&(this.w=u);b>>>=1;switch(b){case 0:var a=this.input,c=this.c,d=this.a,e=this.b,f=a.length,g=t,k=t,h=d.length,l=t;this.e=this.j=0;c+1>=f&&q(Error("invalid uncompressed block header: LEN"));g=a[c++]|a[c++]<<8;c+1>=f&&q(Error("invalid uncompressed block header: NLEN"));k=a[c++]|a[c++]<<8;g===~k&&q(Error("invalid uncompressed block header: length verify"));c+g>a.length&&q(Error("input buffer is broken"));switch(this.r){case Ja:for(;e+g>d.length;){l=h-e;g-=l;if(B)d.set(a.subarray(c,c+l),e),e+=l,c+=l;else for(;l--;)d[e++]=a[c++];this.b=e;d=this.f();e=this.b}break;case Ia:for(;e+g>d.length;)d=this.f({F:2});break;default:q(Error("invalid inflate mode"))}if(B)d.set(a.subarray(c,c+g),e),e+=g,c+=g;else for(;g--;)d[e++]=a[c++];this.c=c;this.b=e;this.a=d;break;case 1:this.s(Za,$a);break;case 2:ab(this);break;default:q(Error("unknown BTYPE: "+b))}}return this.B()};var bb=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cb=B?new Uint16Array(bb):bb,db=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],eb=B?new Uint16Array(db):db,fb=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],gb=B?new Uint8Array(fb):fb,hb=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],ib=B?new Uint16Array(hb):hb,jb=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],kb=B?new Uint8Array(jb):jb,lb=new(B?Uint8Array:Array)(288),V,mb;V=0;for(mb=lb.length;V<mb;++V)lb[V]=143>=V?8:255>=V?9:279>=V?7:8;var Za=ma(lb),nb=new(B?Uint8Array:Array)(30),ob,qb;ob=0;for(qb=nb.length;ob<qb;++ob)nb[ob]=5;var $a=ma(nb);function U(b,a){for(var c=b.j,d=b.e,e=b.input,f=b.c,g=e.length,k;d<a;)f>=g&&q(Error("input buffer is broken")),c|=e[f++]<<d,d+=8;k=c&(1<<a)-1;b.j=c>>>a;b.e=d-a;b.c=f;return k}function rb(b,a){for(var c=b.j,d=b.e,e=b.input,f=b.c,g=e.length,k=a[0],h=a[1],l,s;d<h&&!(f>=g);)c|=e[f++]<<d,d+=8;l=k[c&(1<<h)-1];s=l>>>16;b.j=c>>s;b.e=d-s;b.c=f;return l&65535}function ab(b){function a(a,b,c){var d,e=this.J,f,g;for(g=0;g<a;)switch(d=rb(this,b),d){case 16:for(f=3+U(this,2);f--;)c[g++]=e;break;case 17:for(f=3+U(this,3);f--;)c[g++]=0;e=0;break;case 18:for(f=11+U(this,7);f--;)c[g++]=0;e=0;break;default:e=c[g++]=d}this.J=e;return c}var c=U(b,5)+257,d=U(b,5)+1,e=U(b,4)+4,f=new(B?Uint8Array:Array)(cb.length),g,k,h,l;for(l=0;l<e;++l)f[cb[l]]=U(b,3);if(!B){l=e;for(e=f.length;l<e;++l)f[cb[l]]=0}g=ma(f);k=new(B?Uint8Array:Array)(c);h=new(B?Uint8Array:Array)(d);b.J=0;b.s(ma(a.call(b,c,g,k)),ma(a.call(b,d,g,h)))}T.prototype.s=function(b,a){var c=this.a,d=this.b;this.C=b;for(var e=c.length-258,f,g,k,h;256!==(f=rb(this,b));)if(256>f)d>=e&&(this.b=d,c=this.f(),d=this.b),c[d++]=f;else{g=f-257;h=eb[g];0<gb[g]&&(h+=U(this,gb[g]));f=rb(this,a);k=ib[f];0<kb[f]&&(k+=U(this,kb[f]));d>=e&&(this.b=d,c=this.f(),d=this.b);for(;h--;)c[d]=c[d++-k]}for(;8<=this.e;)this.e-=8,this.c--;this.b=d};T.prototype.T=function(b,a){var c=this.a,d=this.b;this.C=b;for(var e=c.length,f,g,k,h;256!==(f=rb(this,b));)if(256>f)d>=e&&(c=this.f(),e=c.length),c[d++]=f;else{g=f-257;h=eb[g];0<gb[g]&&(h+=U(this,gb[g]));f=rb(this,a);k=ib[f];0<kb[f]&&(k+=U(this,kb[f]));d+h>e&&(c=this.f(),e=c.length);for(;h--;)c[d]=c[d++-k]}for(;8<=this.e;)this.e-=8,this.c--;this.b=d};T.prototype.f=function(){var b=new(B?Uint8Array:Array)(this.b-32768),a=this.b-32768,c,d,e=this.a;if(B)b.set(e.subarray(32768,b.length));else{c=0;for(d=b.length;c<d;++c)b[c]=e[c+32768]}this.p.push(b);this.u+=b.length;if(B)e.set(e.subarray(a,a+32768));else for(c=0;32768>c;++c)e[c]=e[a+c];this.b=32768;return e};T.prototype.U=function(b){var a,c=this.input.length/this.c+1|0,d,e,f,g=this.input,k=this.a;b&&("number"===typeof b.F&&(c=b.F),"number"===typeof b.P&&(c+=b.P));2>c?(d=(g.length-this.c)/this.C[2],f=258*(d/2)|0,e=f<k.length?k.length+f:k.length<<1):e=k.length*c;B?(a=new Uint8Array(e),a.set(k)):a=k;return this.a=a};T.prototype.B=function(){var b=0,a=this.a,c=this.p,d,e=new(B?Uint8Array:Array)(this.u+(this.b-32768)),f,g,k,h;if(0===c.length)return B?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);f=0;for(g=c.length;f<g;++f){d=c[f];k=0;for(h=d.length;k<h;++k)e[b++]=d[k]}f=32768;for(g=this.b;f<g;++f)e[b++]=a[f];this.p=[];return this.buffer=e};T.prototype.R=function(){var b,a=this.b;B?this.M?(b=new Uint8Array(a),b.set(this.a.subarray(0,a))):b=this.a.subarray(0,a):(this.a.length>a&&(this.a.length=a),b=this.a);return this.buffer=b};function sb(b){this.input=b;this.c=0;this.t=[];this.D=!1}sb.prototype.X=function(){this.D||this.h();return this.t.slice()};sb.prototype.h=function(){for(var b=this.input.length;this.c<b;){var a=new P,c=t,d=t,e=t,f=t,g=t,k=t,h=t,l=t,s=t,p=this.input,m=this.c;a.G=p[m++];a.H=p[m++];(31!==a.G||139!==a.H)&&q(Error("invalid file signature:"+a.G+","+a.H));a.z=p[m++];switch(a.z){case 8:break;default:q(Error("unknown compression method: "+a.z))}a.n=p[m++];l=p[m++]|p[m++]<<8|p[m++]<<16|p[m++]<<24;a.Z=new Date(1e3*l);a.fa=p[m++];a.ea=p[m++];0<(a.n&4)&&(a.aa=p[m++]|p[m++]<<8,m+=a.aa);if(0<(a.n&Ea)){h=[];for(k=0;0<(g=p[m++]);)h[k++]=String.fromCharCode(g);a.name=h.join("")}if(0<(a.n&Fa)){h=[];for(k=0;0<(g=p[m++]);)h[k++]=String.fromCharCode(g);a.A=h.join("")}0<(a.n&Ga)&&(a.S=ja(p,0,m)&65535,a.S!==(p[m++]|p[m++]<<8)&&q(Error("invalid header crc16")));c=p[p.length-4]|p[p.length-3]<<8|p[p.length-2]<<16|p[p.length-1]<<24;p.length-m-4-4<512*c&&(f=c);d=new T(p,{index:m,bufferSize:f});a.data=e=d.h();m=d.c;a.ca=s=(p[m++]|p[m++]<<8|p[m++]<<16|p[m++]<<24)>>>0;ja(e,t,t)!==s&&q(Error("invalid CRC-32 checksum: 0x"+ja(e,t,t).toString(16)+" / 0x"+s.toString(16)));a.da=c=(p[m++]|p[m++]<<8|p[m++]<<16|p[m++]<<24)>>>0;(e.length&4294967295)!==c&&q(Error("invalid input size: "+(e.length&4294967295)+" / "+c));this.t.push(a);this.c=m}this.D=u;var n=this.t,r,v,x=0,Q=0,y;r=0;for(v=n.length;r<v;++r)Q+=n[r].data.length;if(B){y=new Uint8Array(Q);for(r=0;r<v;++r)y.set(n[r].data,x),x+=n[r].data.length}else{y=[];for(r=0;r<v;++r)y[r]=n[r].data;y=Array.prototype.concat.apply([],y)}return y};A("Zlib.Gunzip",sb);A("Zlib.Gunzip.prototype.decompress",sb.prototype.h);A("Zlib.Gunzip.prototype.getMembers",sb.prototype.X);function tb(b){if("string"===typeof b){var a=b.split(""),c,d;c=0;for(d=a.length;c<d;c++)a[c]=(a[c].charCodeAt(0)&255)>>>0;b=a}for(var e=1,f=0,g=b.length,k,h=0;0<g;){k=1024<g?1024:g;g-=k;do{e+=b[h++],f+=e}while(--k);e%=65521;f%=65521}return(f<<16|e)>>>0}function ub(b,a){var c,d;this.input=b;this.c=0;if(a||!(a={}))a.index&&(this.c=a.index),a.verify&&(this.$=a.verify);c=b[this.c++];d=b[this.c++];switch(c&15){case vb:this.method=vb;break;default:q(Error("unsupported compression method"))}0!==((c<<8)+d)%31&&q(Error("invalid fcheck flag:"+((c<<8)+d)%31));d&32&&q(Error("fdict flag is not supported"));this.L=new T(b,{index:this.c,bufferSize:a.bufferSize,bufferType:a.bufferType,resize:a.resize})}ub.prototype.h=function(){var b=this.input,a,c;a=this.L.h();this.c=this.L.c;this.$&&(c=(b[this.c++]<<24|b[this.c++]<<16|b[this.c++]<<8|b[this.c++])>>>0,c!==tb(a)&&q(Error("invalid adler-32 checksum")));return a};var vb=8;function wb(b,a){this.input=b;this.a=new(B?Uint8Array:Array)(32768);this.k=W.o;var c={},d;if((a||!(a={}))&&"number"===typeof a.compressionType)this.k=a.compressionType;for(d in a)c[d]=a[d];c.outputBuffer=this.a;this.K=new na(this.input,c)}var W=ra;wb.prototype.g=function(){var b,a,c,d,e,f,g,k=0;g=this.a;b=vb;switch(b){case vb:a=Math.LOG2E*Math.log(32768)-8;break;default:q(Error("invalid compression method"))}c=a<<4|b;g[k++]=c;switch(b){case vb:switch(this.k){case W.NONE:e=0;break;case W.v:e=1;break;case W.o:e=2;break;default:q(Error("unsupported compression type"))}break;default:q(Error("invalid compression method"))}d=e<<6|0;g[k++]=d|31-(256*c+d)%31;f=tb(this.input);this.K.b=k;g=this.K.g();k=g.length;B&&(g=new Uint8Array(g.buffer),g.length<=k+4&&(this.a=new Uint8Array(g.length+4),this.a.set(g),g=this.a),g=g.subarray(0,k+4));g[k++]=f>>24&255;g[k++]=f>>16&255;g[k++]=f>>8&255;g[k++]=f&255;return g};function xb(b,a){var c,d,e,f;if(Object.keys)c=Object.keys(a);else for(d in c=[],e=0,a)c[e++]=d;e=0;for(f=c.length;e<f;++e)d=c[e],A(b+"."+d,a[d])}A("Zlib.Inflate",ub);A("Zlib.Inflate.prototype.decompress",ub.prototype.h);xb("Zlib.Inflate.BufferType",{ADAPTIVE:Ya.N,BLOCK:Ya.O});A("Zlib.Deflate",wb);A("Zlib.Deflate.compress",function(b,a){return new wb(b,a).g()});A("Zlib.Deflate.prototype.compress",wb.prototype.g);xb("Zlib.Deflate.CompressionType",{NONE:W.NONE,FIXED:W.v,DYNAMIC:W.o})}).call(__LiteMolZlib);var LiteMolZlib=__LiteMolZlib.Zlib;var __LiteMolReact;(function(){var exports={};var __module__={};!function(t){if("object"==typeof exports&&"undefined"!=typeof __module__)__module__.exports=t();else if(true)!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=t,__WEBPACK_AMD_DEFINE_RESULT__=typeof __WEBPACK_AMD_DEFINE_FACTORY__==="function"?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__));else{var e;e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,e.React=t()}}(function(){return function t(e,n,r){function o(a,u){if(!n[a]){if(!e[a]){var s=void 0;if(!u&&s)return s(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find __module__ '"+a+"'");throw c.code="__module___NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return o(n||t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var i=void 0,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){"use strict";function r(t){var e={"=":"=0",":":"=2"};return"$"+(""+t).replace(/[=:]/g,function(t){return e[t]})}function o(t){var e=/(=0|=2)/g,n={"=0":"=","=2":":"};return(""+("."===t[0]&&"$"===t[1]?t.substring(2):t.substring(1))).replace(e,function(t){return n[t]})}var i={escape:r,unescape:o};e.exports=i},{}],2:[function(t,e,n){"use strict";var r=t(19),o=(t(24),function(t){var e=this;if(e.instancePool.length){var n=e.instancePool.pop();return e.call(n,t),n}return new e(t)}),i=function(t,e){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,t,e),r}return new n(t,e)},a=function(t,e,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,t,e,n),o}return new r(t,e,n)},u=function(t,e,n,r){var o=this;if(o.instancePool.length){var i=o.instancePool.pop();return o.call(i,t,e,n,r),i}return new o(t,e,n,r)},s=function(t){var e=this;t instanceof e||r("25"),t.destructor(),e.instancePool.length<e.poolSize&&e.instancePool.push(t)},c=o,l=function(t,e){var n=t;return n.instancePool=[],n.getPooled=e||c,n.poolSize||(n.poolSize=10),n.release=s,n},f={addPoolingTo:l,oneArgumentPooler:o,twoArgumentPooler:i,threeArgumentPooler:a,fourArgumentPooler:u};e.exports=f},{19:19,24:24}],3:[function(t,e,n){"use strict";var r=t(26),o=t(4),i=t(5),a=t(7),u=t(8),s=t(11),c=t(13),l=t(15),f=t(18),p=u.createElement,d=u.createFactory,y=u.cloneElement,h=r,m=function(t){return t},v={Children:{map:i.map,forEach:i.forEach,count:i.count,toArray:i.toArray,only:f},Component:o.Component,PureComponent:o.PureComponent,createElement:p,cloneElement:y,isValidElement:u.isValidElement,PropTypes:s,createClass:l,createFactory:d,createMixin:m,DOM:a,version:c,__spread:h};e.exports=v},{11:11,13:13,15:15,18:18,26:26,4:4,5:5,7:7,8:8}],4:[function(t,e,n){"use strict";function r(t,e,n){this.props=t,this.context=e,this.refs=c,this.updater=n||s}function o(t,e,n){this.props=t,this.context=e,this.refs=c,this.updater=n||s}function i(){}var a=t(19),u=t(26),s=t(10),c=(t(14),t(23));t(24),t(17);r.prototype.isReactComponent={},r.prototype.setState=function(t,e){"object"!=typeof t&&"function"!=typeof t&&null!=t&&a("85"),this.updater.enqueueSetState(this,t),e&&this.updater.enqueueCallback(this,e,"setState")},r.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this),t&&this.updater.enqueueCallback(this,t,"forceUpdate")};i.prototype=r.prototype,o.prototype=new i,o.prototype.constructor=o,u(o.prototype,r.prototype),o.prototype.isPureReactComponent=!0,e.exports={Component:r,PureComponent:o}},{10:10,14:14,17:17,19:19,23:23,24:24,26:26}],5:[function(t,e,n){"use strict";function r(t){return(""+t).replace(E,"$&/")}function o(t,e){this.func=t,this.context=e,this.count=0}function i(t,e,n){var r=t.func,o=t.context;r.call(o,e,t.count++)}function a(t,e,n){if(null==t)return t;var r=o.getPooled(e,n);v(t,i,r),o.release(r)}function u(t,e,n,r){this.result=t,this.keyPrefix=e,this.func=n,this.context=r,this.count=0}function s(t,e,n){var o=t.result,i=t.keyPrefix,a=t.func,u=t.context,s=a.call(u,e,t.count++);Array.isArray(s)?c(s,o,n,m.thatReturnsArgument):null!=s&&(h.isValidElement(s)&&(s=h.cloneAndReplaceKey(s,i+(!s.key||e&&e.key===s.key?"":r(s.key)+"/")+n)),o.push(s))}function c(t,e,n,o,i){var a="";null!=n&&(a=r(n)+"/");var c=u.getPooled(e,a,o,i);v(t,s,c),u.release(c)}function l(t,e,n){if(null==t)return t;var r=[];return c(t,r,null,e,n),r}function f(t,e,n){return null}function p(t,e){return v(t,f,null)}function d(t){var e=[];return c(t,e,null,m.thatReturnsArgument),e}var y=t(2),h=t(8),m=t(22),v=t(20),b=y.twoArgumentPooler,g=y.fourArgumentPooler,E=/\/+/g;o.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},y.addPoolingTo(o,b),u.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},y.addPoolingTo(u,g);var x={forEach:a,map:l,mapIntoWithKeyPrefixInternal:c,count:p,toArray:d};e.exports=x},{2:2,20:20,22:22,8:8}],6:[function(t,e,n){"use strict";var r={current:null};e.exports=r},{}],7:[function(t,e,n){"use strict";var r=t(8),o=r.createFactory,i={a:o("a"),abbr:o("abbr"),address:o("address"),area:o("area"),article:o("article"),aside:o("aside"),audio:o("audio"),b:o("b"),base:o("base"),bdi:o("bdi"),bdo:o("bdo"),big:o("big"),blockquote:o("blockquote"),body:o("body"),br:o("br"),button:o("button"),canvas:o("canvas"),caption:o("caption"),cite:o("cite"),code:o("code"),col:o("col"),colgroup:o("colgroup"),data:o("data"),datalist:o("datalist"),dd:o("dd"),del:o("del"),details:o("details"),dfn:o("dfn"),dialog:o("dialog"),div:o("div"),dl:o("dl"),dt:o("dt"),em:o("em"),embed:o("embed"),fieldset:o("fieldset"),figcaption:o("figcaption"),figure:o("figure"),footer:o("footer"),form:o("form"),h1:o("h1"),h2:o("h2"),h3:o("h3"),h4:o("h4"),h5:o("h5"),h6:o("h6"),head:o("head"),header:o("header"),hgroup:o("hgroup"),hr:o("hr"),html:o("html"),i:o("i"),iframe:o("iframe"),img:o("img"),input:o("input"),ins:o("ins"),kbd:o("kbd"),keygen:o("keygen"),label:o("label"),legend:o("legend"),li:o("li"),link:o("link"),main:o("main"),map:o("map"),mark:o("mark"),menu:o("menu"),menuitem:o("menuitem"),meta:o("meta"),meter:o("meter"),nav:o("nav"),noscript:o("noscript"),object:o("object"),ol:o("ol"),optgroup:o("optgroup"),option:o("option"),output:o("output"),p:o("p"),param:o("param"),picture:o("picture"),pre:o("pre"),progress:o("progress"),q:o("q"),rp:o("rp"),rt:o("rt"),ruby:o("ruby"),s:o("s"),samp:o("samp"),script:o("script"),section:o("section"),select:o("select"),small:o("small"),source:o("source"),span:o("span"),strong:o("strong"),style:o("style"),sub:o("sub"),summary:o("summary"),sup:o("sup"),table:o("table"),tbody:o("tbody"),td:o("td"),textarea:o("textarea"),tfoot:o("tfoot"),th:o("th"),thead:o("thead"),time:o("time"),title:o("title"),tr:o("tr"),track:o("track"),u:o("u"),ul:o("ul"),var:o("var"),video:o("video"),wbr:o("wbr"),circle:o("circle"),clipPath:o("clipPath"),defs:o("defs"),ellipse:o("ellipse"),g:o("g"),image:o("image"),line:o("line"),linearGradient:o("linearGradient"),mask:o("mask"),path:o("path"),pattern:o("pattern"),polygon:o("polygon"),polyline:o("polyline"),radialGradient:o("radialGradient"),rect:o("rect"),stop:o("stop"),svg:o("svg"),text:o("text"),tspan:o("tspan")};e.exports=i},{8:8}],8:[function(t,e,n){"use strict";function r(t){return void 0!==t.ref}function o(t){return void 0!==t.key}var i=t(26),a=t(6),u=(t(25),t(14),Object.prototype.hasOwnProperty),s=t(9),c={key:!0,ref:!0,__self:!0,__source:!0},l=function(t,e,n,r,o,i,a){return{$$typeof:s,type:t,key:e,ref:n,props:a,_owner:i}};l.createElement=function(t,e,n){var i,s={},f=null,p=null;if(null!=e){r(e)&&(p=e.ref),o(e)&&(f=""+e.key),void 0===e.__self?null:e.__self,void 0===e.__source?null:e.__source;for(i in e)u.call(e,i)&&!c.hasOwnProperty(i)&&(s[i]=e[i])}var d=arguments.length-2;if(1===d)s.children=n;else if(d>1){for(var y=Array(d),h=0;h<d;h++)y[h]=arguments[h+2];s.children=y}if(t&&t.defaultProps){var m=t.defaultProps;for(i in m)void 0===s[i]&&(s[i]=m[i])}return l(t,f,p,0,0,a.current,s)},l.createFactory=function(t){var e=l.createElement.bind(null,t);return e.type=t,e},l.cloneAndReplaceKey=function(t,e){return l(t.type,e,t.ref,t._self,t._source,t._owner,t.props)},l.cloneElement=function(t,e,n){var s,f=i({},t.props),p=t.key,d=t.ref,y=(t._self,t._source,t._owner);if(null!=e){r(e)&&(d=e.ref,y=a.current),o(e)&&(p=""+e.key);var h;t.type&&t.type.defaultProps&&(h=t.type.defaultProps);for(s in e)u.call(e,s)&&!c.hasOwnProperty(s)&&(void 0===e[s]&&void 0!==h?f[s]=h[s]:f[s]=e[s])}var m=arguments.length-2;if(1===m)f.children=n;else if(m>1){for(var v=Array(m),b=0;b<m;b++)v[b]=arguments[b+2];f.children=v}return l(t.type,p,d,0,0,y,f)},l.isValidElement=function(t){return"object"==typeof t&&null!==t&&t.$$typeof===s},e.exports=l},{14:14,25:25,26:26,6:6,9:9}],9:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;e.exports=r},{}],10:[function(t,e,n){"use strict";var r=(t(25),{isMounted:function(t){return!1},enqueueCallback:function(t,e){},enqueueForceUpdate:function(t){},enqueueReplaceState:function(t,e){},enqueueSetState:function(t,e){}});e.exports=r},{25:25}],11:[function(t,e,n){"use strict";var r=t(8),o=r.isValidElement,i=t(28);e.exports=i(o)},{28:28,8:8}],12:[function(t,e,n){"use strict";var r=t(26),o=t(3),i=r(o,{__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:t(6)}});e.exports=i},{26:26,3:3,6:6}],13:[function(t,e,n){"use strict";e.exports="15.6.1"},{}],14:[function(t,e,n){"use strict";e.exports=!1},{}],15:[function(t,e,n){"use strict";var r=t(4),o=r.Component,i=t(8),a=i.isValidElement,u=t(10),s=t(21);e.exports=s(o,a,u)},{10:10,21:21,4:4,8:8}],16:[function(t,e,n){"use strict";function r(t){var e=t&&(o&&t[o]||t[i]);if("function"==typeof e)return e}var o="function"==typeof Symbol&&Symbol.iterator,i="@@iterator";e.exports=r},{}],17:[function(t,e,n){"use strict";var r=function(){};e.exports=r},{}],18:[function(t,e,n){"use strict";function r(t){return i.isValidElement(t)||o("143"),t}var o=t(19),i=t(8);t(24);e.exports=r},{19:19,24:24,8:8}],19:[function(t,e,n){"use strict";function r(t){for(var e=arguments.length-1,n="Minified React error #"+t+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant="+t,r=0;r<e;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);n+=" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.";var o=new Error(n);throw o.name="Invariant Violation",o.framesToPop=1,o}e.exports=r},{}],20:[function(t,e,n){"use strict";function r(t,e){return t&&"object"==typeof t&&null!=t.key?c.escape(t.key):e.toString(36)}function o(t,e,n,i){var p=typeof t;if("undefined"!==p&&"boolean"!==p||(t=null),null===t||"string"===p||"number"===p||"object"===p&&t.$$typeof===u)return n(i,t,""===e?l+r(t,0):e),1;var d,y,h=0,m=""===e?l:e+f;if(Array.isArray(t))for(var v=0;v<t.length;v++)d=t[v],y=m+r(d,v),h+=o(d,y,n,i);else{var b=s(t);if(b){var g,E=b.call(t);if(b!==t.entries)for(var x=0;!(g=E.next()).done;)d=g.value,y=m+r(d,x++),h+=o(d,y,n,i);else for(;!(g=E.next()).done;){var _=g.value;_&&(d=_[1],y=m+c.escape(_[0])+f+r(d,0),h+=o(d,y,n,i))}}else if("object"===p){var P=String(t);a("31","[object Object]"===P?"object with keys {"+Object.keys(t).join(", ")+"}":P,"")}}return h}function i(t,e,n){return null==t?0:o(t,"",e,n)}var a=t(19),u=(t(6),t(9)),s=t(16),c=(t(24),t(1)),l=(t(25),"."),f=":";e.exports=i},{1:1,16:16,19:19,24:24,25:25,6:6,9:9}],21:[function(t,e,n){"use strict";function r(t){return t}function o(t,e,n){function o(t,e){var n=b.hasOwnProperty(e)?b[e]:null;_.hasOwnProperty(e)&&u("OVERRIDE_BASE"===n,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",e),t&&u("DEFINE_MANY"===n||"DEFINE_MANY_MERGED"===n,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",e)}function c(t,n){if(n){u("function"!=typeof n,"ReactClass: You're attempting to use a component class or function as a mixin. Instead, just use a regular object."),u(!e(n),"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object.");var r=t.prototype,i=r.__reactAutoBindPairs;n.hasOwnProperty(s)&&g.mixins(t,n.mixins);for(var a in n)if(n.hasOwnProperty(a)&&a!==s){var c=n[a],l=r.hasOwnProperty(a);if(o(l,a),g.hasOwnProperty(a))g[a](t,c);else{var f=b.hasOwnProperty(a),y="function"==typeof c,h=y&&!f&&!l&&!1!==n.autobind;if(h)i.push(a,c),r[a]=c;else if(l){var m=b[a];u(f&&("DEFINE_MANY_MERGED"===m||"DEFINE_MANY"===m),"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",m,a),"DEFINE_MANY_MERGED"===m?r[a]=p(r[a],c):"DEFINE_MANY"===m&&(r[a]=d(r[a],c))}else r[a]=c}}}else;}function l(t,e){if(e)for(var n in e){var r=e[n];if(e.hasOwnProperty(n)){var o=n in g;u(!o,'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',n);var i=n in t;u(!i,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",n),t[n]=r}}}function f(t,e){u(t&&e&&"object"==typeof t&&"object"==typeof e,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects.");for(var n in e)e.hasOwnProperty(n)&&(u(void 0===t[n],"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",n),t[n]=e[n]);return t}function p(t,e){return function(){var n=t.apply(this,arguments),r=e.apply(this,arguments);if(null==n)return r;if(null==r)return n;var o={};return f(o,n),f(o,r),o}}function d(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function y(t,e){var n=e.bind(t);return n}function h(t){for(var e=t.__reactAutoBindPairs,n=0;n<e.length;n+=2){var r=e[n],o=e[n+1];t[r]=y(t,o)}}function m(t){var e=r(function(t,r,o){this.__reactAutoBindPairs.length&&h(this),this.props=t,this.context=r,this.refs=a,this.updater=o||n,this.state=null;var i=this.getInitialState?this.getInitialState():null;u("object"==typeof i&&!Array.isArray(i),"%s.getInitialState(): must return an object or null",e.displayName||"ReactCompositeComponent"),this.state=i});e.prototype=new P,e.prototype.constructor=e,e.prototype.__reactAutoBindPairs=[],v.forEach(c.bind(null,e)),c(e,E),c(e,t),c(e,x),e.getDefaultProps&&(e.defaultProps=e.getDefaultProps()),u(e.prototype.render,"createClass(...): Class specification must implement a `render` method.");for(var o in b)e.prototype[o]||(e.prototype[o]=null);return e}var v=[],b={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"},g={displayName:function(t,e){t.displayName=e},mixins:function(t,e){if(e)for(var n=0;n<e.length;n++)c(t,e[n])},childContextTypes:function(t,e){t.childContextTypes=i({},t.childContextTypes,e)},contextTypes:function(t,e){t.contextTypes=i({},t.contextTypes,e)},getDefaultProps:function(t,e){t.getDefaultProps?t.getDefaultProps=p(t.getDefaultProps,e):t.getDefaultProps=e},propTypes:function(t,e){t.propTypes=i({},t.propTypes,e)},statics:function(t,e){l(t,e)},autobind:function(){}},E={componentDidMount:function(){this.__isMounted=!0}},x={componentWillUnmount:function(){this.__isMounted=!1}},_={replaceState:function(t,e){this.updater.enqueueReplaceState(this,t,e)},isMounted:function(){return!!this.__isMounted}},P=function(){};return i(P.prototype,t.prototype,_),m}var i=t(26),a=t(23),u=t(24),s="mixins";e.exports=o},{23:23,24:24,25:25,26:26}],22:[function(t,e,n){"use strict";function r(t){return function(){return t}}var o=function(){};o.thatReturns=r,o.thatReturnsFalse=r(!1),o.thatReturnsTrue=r(!0),o.thatReturnsNull=r(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(t){return t},e.exports=o},{}],23:[function(t,e,n){"use strict";var r={};e.exports=r},{}],24:[function(t,e,n){"use strict";function r(t,e,n,r,i,a,u,s){if(o(e),!t){var c;if(void 0===e)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,i,a,u,s],f=0;c=new Error(e.replace(/%s/g,function(){return l[f++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}}var o=function(t){};e.exports=r},{}],25:[function(t,e,n){"use strict";var r=t(22),o=r;e.exports=o},{22:22}],26:[function(t,e,n){"use strict";function r(t){if(null===t||void 0===t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;e.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,u,s=r(t),c=1;c<arguments.length;c++){n=Object(arguments[c]);for(var l in n)i.call(n,l)&&(s[l]=n[l]);if(o){u=o(n);for(var f=0;f<u.length;f++)a.call(n,u[f])&&(s[u[f]]=n[u[f]])}}return s}},{}],27:[function(t,e,n){"use strict";function r(t,e,n,r,o){}e.exports=r},{24:24,25:25,30:30}],28:[function(t,e,n){"use strict";var r=t(29);e.exports=function(t){return r(t,!1)}},{29:29}],29:[function(t,e,n){"use strict";var r=t(22),o=t(24),i=t(25),a=t(30),u=t(27);e.exports=function(t,e){function n(t){var e=t&&(w&&t[w]||t[N]);if("function"==typeof e)return e}function s(t,e){return t===e?0!==t||1/t==1/e:t!==t&&e!==e}function c(t){this.message=t,this.stack=""}function l(t){function n(n,r,i,u,s,l,f){if(u=u||A,l=l||i,f!==a)if(e)o(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else;return null==r[i]?n?new c(null===r[i]?"The "+s+" `"+l+"` is marked as required in `"+u+"`, but its value is `null`.":"The "+s+" `"+l+"` is marked as required in `"+u+"`, but its value is `undefined`."):null:t(r,i,u,s,l)}var r=n.bind(null,!1);return r.isRequired=n.bind(null,!0),r}function f(t){function e(e,n,r,o,i,a){var u=e[n];if(E(u)!==t)return new c("Invalid "+o+" `"+i+"` of type `"+x(u)+"` supplied to `"+r+"`, expected `"+t+"`.");return null}return l(e)}function p(t){function e(e,n,r,o,i){if("function"!=typeof t)return new c("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside arrayOf.");var u=e[n];if(!Array.isArray(u)){return new c("Invalid "+o+" `"+i+"` of type `"+E(u)+"` supplied to `"+r+"`, expected an array.")}for(var s=0;s<u.length;s++){var l=t(u,s,r,o,i+"["+s+"]",a);if(l instanceof Error)return l}return null}return l(e)}function d(t){function e(e,n,r,o,i){if(!(e[n]instanceof t)){var a=t.name||A;return new c("Invalid "+o+" `"+i+"` of type `"+P(e[n])+"` supplied to `"+r+"`, expected instance of `"+a+"`.")}return null}return l(e)}function y(t){function e(e,n,r,o,i){for(var a=e[n],u=0;u<t.length;u++)if(s(a,t[u]))return null;return new c("Invalid "+o+" `"+i+"` of value `"+a+"` supplied to `"+r+"`, expected one of "+JSON.stringify(t)+".")}return Array.isArray(t)?l(e):r.thatReturnsNull}function h(t){function e(e,n,r,o,i){if("function"!=typeof t)return new c("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var u=e[n],s=E(u);if("object"!==s)return new c("Invalid "+o+" `"+i+"` of type `"+s+"` supplied to `"+r+"`, expected an object.");for(var l in u)if(u.hasOwnProperty(l)){var f=t(u,l,r,o,i+"."+l,a);if(f instanceof Error)return f}return null}return l(e)}function m(t){function e(e,n,r,o,i){for(var u=0;u<t.length;u++){if(null==(0,t[u])(e,n,r,o,i,a))return null}return new c("Invalid "+o+" `"+i+"` supplied to `"+r+"`.")}if(!Array.isArray(t))return r.thatReturnsNull;for(var n=0;n<t.length;n++){var o=t[n];if("function"!=typeof o)return i(!1,"Invalid argument supplid to oneOfType. Expected an array of check functions, but received %s at index %s.",_(o),n),r.thatReturnsNull}return l(e)}function v(t){function e(e,n,r,o,i){var u=e[n],s=E(u);if("object"!==s)return new c("Invalid "+o+" `"+i+"` of type `"+s+"` supplied to `"+r+"`, expected `object`.");for(var l in t){var f=t[l];if(f){var p=f(u,l,r,o,i+"."+l,a);if(p)return p}}return null}return l(e)}function b(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(b);if(null===e||t(e))return!0;var r=n(e);if(!r)return!1;var o,i=r.call(e);if(r!==e.entries){for(;!(o=i.next()).done;)if(!b(o.value))return!1}else for(;!(o=i.next()).done;){var a=o.value;if(a&&!b(a[1]))return!1}return!0;default:return!1}}function g(t,e){return"symbol"===t||("Symbol"===e["@@toStringTag"]||"function"==typeof Symbol&&e instanceof Symbol)}function E(t){var e=typeof t;return Array.isArray(t)?"array":t instanceof RegExp?"object":g(e,t)?"symbol":e}function x(t){if(void 0===t||null===t)return""+t;var e=E(t);if("object"===e){if(t instanceof Date)return"date";if(t instanceof RegExp)return"regexp"}return e}function _(t){var e=x(t);switch(e){case"array":case"object":return"an "+e;case"boolean":case"date":case"regexp":return"a "+e;default:return e}}function P(t){return t.constructor&&t.constructor.name?t.constructor.name:A}var w="function"==typeof Symbol&&Symbol.iterator,N="@@iterator",A="<<anonymous>>",O={array:f("array"),bool:f("boolean"),func:f("function"),number:f("number"),object:f("object"),string:f("string"),symbol:f("symbol"),any:function(){return l(r.thatReturnsNull)}(),arrayOf:p,element:function(){function e(e,n,r,o,i){var a=e[n];if(!t(a)){return new c("Invalid "+o+" `"+i+"` of type `"+E(a)+"` supplied to `"+r+"`, expected a single ReactElement.")}return null}return l(e)}(),instanceOf:d,node:function(){function t(t,e,n,r,o){return b(t[e])?null:new c("Invalid "+r+" `"+o+"` supplied to `"+n+"`, expected a ReactNode.")}return l(t)}(),objectOf:h,oneOf:y,oneOfType:m,shape:v};return c.prototype=Error.prototype,O.checkPropTypes=u,O.PropTypes=O,O}},{22:22,24:24,25:25,27:27,30:30}],30:[function(t,e,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}]},{},[12])(12)});__LiteMolReact=__module__.exports})();var __LiteMolReactDOM;(function(){var exports={};var __module__={};!function(e){if("object"==typeof exports&&"undefined"!=typeof __module__)__module__.exports=e(__LiteMolReact);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.ReactDOM=e(t.React)}}(function(e){return function(t){return function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u=void 0;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find __module__ '"+a+"'");throw l.code="__module___NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n||e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i=void 0,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){"use strict";var r={Properties:{"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},DOMAttributeNames:{},DOMPropertyNames:{}};t.exports=r},{}],2:[function(e,t,n){"use strict";var r=e(33),o=e(132),i={focusDOMComponent:function(){o(r.getNodeFromInstance(this))}};t.exports=i},{132:132,33:33}],3:[function(e,t,n){"use strict";function r(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function o(e){switch(e){case"topCompositionStart":return T.compositionStart;case"topCompositionEnd":return T.compositionEnd;case"topCompositionUpdate":return T.compositionUpdate}}function i(e,t){return"topKeyDown"===e&&t.keyCode===y}function a(e,t){switch(e){case"topKeyUp":return-1!==g.indexOf(t.keyCode);case"topKeyDown":return t.keyCode!==y;case"topKeyPress":case"topMouseDown":case"topBlur":return!0;default:return!1}}function s(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function u(e,t,n,r){var u,l;if(_?u=o(e):P?a(e,n)&&(u=T.compositionEnd):i(e,n)&&(u=T.compositionStart),!u)return null;E&&(P||u!==T.compositionStart?u===T.compositionEnd&&P&&(l=P.getData()):P=h.getPooled(r));var c=m.getPooled(u,t,n,r);if(l)c.data=l;else{var p=s(n);null!==p&&(c.data=p)}return d.accumulateTwoPhaseDispatches(c),c}function l(e,t){switch(e){case"topCompositionEnd":return s(t);case"topKeyPress":return t.which!==x?null:(k=!0,w);case"topTextInput":var n=t.data;return n===w&&k?null:n;default:return null}}function c(e,t){if(P){if("topCompositionEnd"===e||!_&&a(e,t)){var n=P.getData();return h.release(P),P=null,n}return null}switch(e){case"topPaste":return null;case"topKeyPress":return t.which&&!r(t)?String.fromCharCode(t.which):null;case"topCompositionEnd":return E?null:t.data;default:return null}}function p(e,t,n,r){var o;if(!(o=b?l(e,n):c(e,n)))return null;var i=v.getPooled(T.beforeInput,t,n,r);return i.data=o,d.accumulateTwoPhaseDispatches(i),i}var d=e(19),f=e(124),h=e(20),m=e(78),v=e(82),g=[9,13,27,32],y=229,_=f.canUseDOM&&"CompositionEvent"in window,C=null;f.canUseDOM&&"documentMode"in document&&(C=document.documentMode);var b=f.canUseDOM&&"TextEvent"in window&&!C&&!function(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}(),E=f.canUseDOM&&(!_||C&&C>8&&C<=11),x=32,w=String.fromCharCode(x),T={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["topCompositionEnd","topKeyPress","topTextInput","topPaste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:["topBlur","topCompositionEnd","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:["topBlur","topCompositionStart","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:["topBlur","topCompositionUpdate","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]}},k=!1,P=null,S={eventTypes:T,extractEvents:function(e,t,n,r){return[u(e,t,n,r),p(e,t,n,r)]}};t.exports=S},{124:124,19:19,20:20,78:78,82:82}],4:[function(e,t,n){"use strict";function r(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var o={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(o).forEach(function(e){i.forEach(function(t){o[r(t,e)]=o[e]})});var a={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},s={isUnitlessNumber:o,shorthandPropertyExpansions:a};t.exports=s},{}],5:[function(e,t,n){"use strict";var r=e(4),o=e(124),i=(e(58),e(126),e(94)),a=e(137),s=e(141),u=(e(143),s(function(e){return a(e)})),l=!1,c="cssFloat";if(o.canUseDOM){var p=document.createElement("div").style;try{p.font=""}catch(e){l=!0}void 0===document.documentElement.style.cssFloat&&(c="styleFloat")}var d={createMarkupForStyles:function(e,t){var n="";for(var r in e)if(e.hasOwnProperty(r)){var o=0===r.indexOf("--"),a=e[r];null!=a&&(n+=u(r)+":",n+=i(r,a,t,o)+";")}return n||null},setValueForStyles:function(e,t,n){var o=e.style;for(var a in t)if(t.hasOwnProperty(a)){var s=0===a.indexOf("--"),u=i(a,t[a],n,s);if("float"!==a&&"cssFloat"!==a||(a=c),s)o.setProperty(a,u);else if(u)o[a]=u;else{var p=l&&r.shorthandPropertyExpansions[a];if(p)for(var d in p)o[d]="";else o[a]=""}}}};t.exports=d},{124:124,126:126,137:137,141:141,143:143,4:4,58:58,94:94}],6:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=e(113),i=e(24),a=(e(138),function(){function e(t){r(this,e),this._callbacks=null,this._contexts=null,this._arg=t}return e.prototype.enqueue=function(e,t){this._callbacks=this._callbacks||[],this._callbacks.push(e),this._contexts=this._contexts||[],this._contexts.push(t)},e.prototype.notifyAll=function(){var e=this._callbacks,t=this._contexts,n=this._arg;if(e&&t){e.length!==t.length&&o("24"),this._callbacks=null,this._contexts=null;for(var r=0;r<e.length;r++)e[r].call(t[r],n);e.length=0,t.length=0}},e.prototype.checkpoint=function(){return this._callbacks?this._callbacks.length:0},e.prototype.rollback=function(e){this._callbacks&&this._contexts&&(this._callbacks.length=e,this._contexts.length=e)},e.prototype.reset=function(){this._callbacks=null,this._contexts=null},e.prototype.destructor=function(){this.reset()},e}());t.exports=i.addPoolingTo(a)},{113:113,138:138,24:24}],7:[function(e,t,n){"use strict";function r(e,t,n){var r=k.getPooled(I.change,e,t,n);return r.type="change",E.accumulateTwoPhaseDispatches(r),r}function o(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function i(e){var t=r(R,e,S(e));T.batchedUpdates(a,t)}function a(e){b.enqueueEvents(e),b.processEventQueue(!1)}function s(e,t){O=e,R=t,O.attachEvent("onchange",i)}function u(){O&&(O.detachEvent("onchange",i),O=null,R=null)}function l(e,t){var n=P.updateValueIfChanged(e),r=!0===t.simulated&&L._allowSimulatedPassThrough;if(n||r)return e}function c(e,t){if("topChange"===e)return t}function p(e,t,n){"topFocus"===e?(u(),s(t,n)):"topBlur"===e&&u()}function d(e,t){O=e,R=t,O.attachEvent("onpropertychange",h)}function f(){O&&(O.detachEvent("onpropertychange",h),O=null,R=null)}function h(e){"value"===e.propertyName&&l(R,e)&&i(e)}function m(e,t,n){"topFocus"===e?(f(),d(t,n)):"topBlur"===e&&f()}function v(e,t,n){if("topSelectionChange"===e||"topKeyUp"===e||"topKeyDown"===e)return l(R,n)}function g(e){var t=e.nodeName;return t&&"input"===t.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function y(e,t,n){if("topClick"===e)return l(t,n)}function _(e,t,n){if("topInput"===e||"topChange"===e)return l(t,n)}function C(e,t){if(null!=e){var n=e._wrapperState||t._wrapperState;if(n&&n.controlled&&"number"===t.type){var r=""+t.value;t.getAttribute("value")!==r&&t.setAttribute("value",r)}}}var b=e(16),E=e(19),x=e(124),w=e(33),T=e(71),k=e(80),P=e(108),S=e(102),N=e(110),M=e(111),I={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:["topBlur","topChange","topClick","topFocus","topInput","topKeyDown","topKeyUp","topSelectionChange"]}},O=null,R=null,A=!1;x.canUseDOM&&(A=N("change")&&(!document.documentMode||document.documentMode>8));var D=!1;x.canUseDOM&&(D=N("input")&&(!("documentMode"in document)||document.documentMode>9));var L={eventTypes:I,_allowSimulatedPassThrough:!0,_isInputEventSupported:D,extractEvents:function(e,t,n,i){var a,s,u=t?w.getNodeFromInstance(t):window;if(o(u)?A?a=c:s=p:M(u)?D?a=_:(a=v,s=m):g(u)&&(a=y),a){var l=a(e,t,n);if(l)return r(l,n,i)}s&&s(e,u,t),"topBlur"===e&&C(t,u)}};t.exports=L},{102:102,108:108,110:110,111:111,124:124,16:16,19:19,33:33,71:71,80:80}],8:[function(e,t,n){"use strict";function r(e,t){return Array.isArray(t)&&(t=t[1]),t?t.nextSibling:e.firstChild}function o(e,t,n){c.insertTreeBefore(e,t,n)}function i(e,t,n){Array.isArray(t)?s(e,t[0],t[1],n):m(e,t,n)}function a(e,t){if(Array.isArray(t)){var n=t[1];t=t[0],u(e,t,n),e.removeChild(n)}e.removeChild(t)}function s(e,t,n,r){for(var o=t;;){var i=o.nextSibling;if(m(e,o,r),o===n)break;o=i}}function u(e,t,n){for(;;){var r=t.nextSibling;if(r===n)break;e.removeChild(r)}}function l(e,t,n){var r=e.parentNode,o=e.nextSibling;o===t?n&&m(r,document.createTextNode(n),o):n?(h(o,n),u(r,o,t)):u(r,e,t)}var c=e(9),p=e(13),d=(e(33),e(58),e(93)),f=e(115),h=e(116),m=d(function(e,t,n){e.insertBefore(t,n)}),v=p.dangerouslyReplaceNodeWithMarkup,g={dangerouslyReplaceNodeWithMarkup:v,replaceDelimitedText:l,processUpdates:function(e,t){for(var n=0;n<t.length;n++){var s=t[n];switch(s.type){case"INSERT_MARKUP":o(e,s.content,r(e,s.afterNode));break;case"MOVE_EXISTING":i(e,s.fromNode,r(e,s.afterNode));break;case"SET_MARKUP":f(e,s.content);break;case"TEXT_CONTENT":h(e,s.content);break;case"REMOVE_NODE":a(e,s.fromNode)}}}};t.exports=g},{115:115,116:116,13:13,33:33,58:58,9:9,93:93}],9:[function(e,t,n){"use strict";function r(e){if(h){var t=e.node,n=e.children;if(n.length)for(var r=0;r<n.length;r++)m(t,n[r],null);else null!=e.html?p(t,e.html):null!=e.text&&f(t,e.text)}}function o(e,t){e.parentNode.replaceChild(t.node,e),r(t)}function i(e,t){h?e.children.push(t):e.node.appendChild(t.node)}function a(e,t){h?e.html=t:p(e.node,t)}function s(e,t){h?e.text=t:f(e.node,t)}function u(){return this.node.nodeName}function l(e){return{node:e,children:[],html:null,text:null,toString:u}}var c=e(10),p=e(115),d=e(93),f=e(116),h="undefined"!=typeof document&&"number"==typeof document.documentMode||"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent&&/\bEdge\/\d/.test(navigator.userAgent),m=d(function(e,t,n){11===t.node.nodeType||1===t.node.nodeType&&"object"===t.node.nodeName.toLowerCase()&&(null==t.node.namespaceURI||t.node.namespaceURI===c.html)?(r(t),e.insertBefore(t.node,n)):(e.insertBefore(t.node,n),r(t))});l.insertTreeBefore=m,l.replaceChildWithTree=o,l.queueChild=i,l.queueHTML=a,l.queueText=s,t.exports=l},{10:10,115:115,116:116,93:93}],10:[function(e,t,n){"use strict";var r={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};t.exports=r},{}],11:[function(e,t,n){"use strict";function r(e,t){return(e&t)===t}var o=e(113),i=(e(138),{MUST_USE_PROPERTY:1,HAS_BOOLEAN_VALUE:4,HAS_NUMERIC_VALUE:8,HAS_POSITIVE_NUMERIC_VALUE:24,HAS_OVERLOADED_BOOLEAN_VALUE:32,injectDOMPropertyConfig:function(e){var t=i,n=e.Properties||{},a=e.DOMAttributeNamespaces||{},u=e.DOMAttributeNames||{},l=e.DOMPropertyNames||{},c=e.DOMMutationMethods||{};e.isCustomAttribute&&s._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var p in n){s.properties.hasOwnProperty(p)&&o("48",p);var d=p.toLowerCase(),f=n[p],h={attributeName:d,attributeNamespace:null,propertyName:p,mutationMethod:null,mustUseProperty:r(f,t.MUST_USE_PROPERTY),hasBooleanValue:r(f,t.HAS_BOOLEAN_VALUE),hasNumericValue:r(f,t.HAS_NUMERIC_VALUE),hasPositiveNumericValue:r(f,t.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:r(f,t.HAS_OVERLOADED_BOOLEAN_VALUE)};if(h.hasBooleanValue+h.hasNumericValue+h.hasOverloadedBooleanValue<=1||o("50",p),u.hasOwnProperty(p)){var m=u[p];h.attributeName=m}a.hasOwnProperty(p)&&(h.attributeNamespace=a[p]),l.hasOwnProperty(p)&&(h.propertyName=l[p]),c.hasOwnProperty(p)&&(h.mutationMethod=c[p]),s.properties[p]=h}}}),a=":A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",s={ID_ATTRIBUTE_NAME:"data-reactid",ROOT_ATTRIBUTE_NAME:"data-reactroot",ATTRIBUTE_NAME_START_CHAR:a,ATTRIBUTE_NAME_CHAR:a+"\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",properties:{},getPossibleStandardName:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<s._isCustomAttributeFunctions.length;t++)if((0,s._isCustomAttributeFunctions[t])(e))return!0;return!1},injection:i};t.exports=s},{113:113,138:138}],12:[function(e,t,n){"use strict";function r(e){return!!l.hasOwnProperty(e)||!u.hasOwnProperty(e)&&(s.test(e)?(l[e]=!0,!0):(u[e]=!0,!1))}function o(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&t<1||e.hasOverloadedBooleanValue&&!1===t}var i=e(11),a=(e(33),e(58),e(112)),s=(e(143),new RegExp("^["+i.ATTRIBUTE_NAME_START_CHAR+"]["+i.ATTRIBUTE_NAME_CHAR+"]*$")),u={},l={},c={createMarkupForID:function(e){return i.ID_ATTRIBUTE_NAME+"="+a(e)},setAttributeForID:function(e,t){e.setAttribute(i.ID_ATTRIBUTE_NAME,t)},createMarkupForRoot:function(){return i.ROOT_ATTRIBUTE_NAME+'=""'},setAttributeForRoot:function(e){e.setAttribute(i.ROOT_ATTRIBUTE_NAME,"")},createMarkupForProperty:function(e,t){var n=i.properties.hasOwnProperty(e)?i.properties[e]:null;if(n){if(o(n,t))return"";var r=n.attributeName;return n.hasBooleanValue||n.hasOverloadedBooleanValue&&!0===t?r+'=""':r+"="+a(t)}return i.isCustomAttribute(e)?null==t?"":e+"="+a(t):null},createMarkupForCustomAttribute:function(e,t){return r(e)&&null!=t?e+"="+a(t):""},setValueForProperty:function(e,t,n){var r=i.properties.hasOwnProperty(t)?i.properties[t]:null;if(r){var a=r.mutationMethod;if(a)a(e,n);else{if(o(r,n))return void this.deleteValueForProperty(e,t);if(r.mustUseProperty)e[r.propertyName]=n;else{var s=r.attributeName,u=r.attributeNamespace;u?e.setAttributeNS(u,s,""+n):r.hasBooleanValue||r.hasOverloadedBooleanValue&&!0===n?e.setAttribute(s,""):e.setAttribute(s,""+n)}}}else if(i.isCustomAttribute(t))return void c.setValueForAttribute(e,t,n)},setValueForAttribute:function(e,t,n){r(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForAttribute:function(e,t){e.removeAttribute(t)},deleteValueForProperty:function(e,t){var n=i.properties.hasOwnProperty(t)?i.properties[t]:null;if(n){var r=n.mutationMethod;if(r)r(e,void 0);else if(n.mustUseProperty){var o=n.propertyName;n.hasBooleanValue?e[o]=!1:e[o]=""}else e.removeAttribute(n.attributeName)}else i.isCustomAttribute(t)&&e.removeAttribute(t)}};t.exports=c},{11:11,112:112,143:143,33:33,58:58}],13:[function(e,t,n){"use strict";var r=e(113),o=e(9),i=e(124),a=e(129),s=e(130),u=(e(138),{dangerouslyReplaceNodeWithMarkup:function(e,t){if(i.canUseDOM||r("56"),t||r("57"),"HTML"===e.nodeName&&r("58"),"string"==typeof t){var n=a(t,s)[0];e.parentNode.replaceChild(n,e)}else o.replaceChildWithTree(e,t)}});t.exports=u},{113:113,124:124,129:129,130:130,138:138,9:9}],14:[function(e,t,n){"use strict";var r=["ResponderEventPlugin","SimpleEventPlugin","TapEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin"];t.exports=r},{}],15:[function(e,t,n){"use strict";var r=e(19),o=e(33),i=e(84),a={mouseEnter:{registrationName:"onMouseEnter",dependencies:["topMouseOut","topMouseOver"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["topMouseOut","topMouseOver"]}},s={eventTypes:a,extractEvents:function(e,t,n,s){if("topMouseOver"===e&&(n.relatedTarget||n.fromElement))return null;if("topMouseOut"!==e&&"topMouseOver"!==e)return null;var u;if(s.window===s)u=s;else{var l=s.ownerDocument;u=l?l.defaultView||l.parentWindow:window}var c,p;if("topMouseOut"===e){c=t;var d=n.relatedTarget||n.toElement;p=d?o.getClosestInstanceFromNode(d):null}else c=null,p=t;if(c===p)return null;var f=null==c?u:o.getNodeFromInstance(c),h=null==p?u:o.getNodeFromInstance(p),m=i.getPooled(a.mouseLeave,c,n,s);m.type="mouseleave",m.target=f,m.relatedTarget=h;var v=i.getPooled(a.mouseEnter,p,n,s);return v.type="mouseenter",v.target=h,v.relatedTarget=f,r.accumulateEnterLeaveDispatches(m,v,c,p),[m,v]}};t.exports=s},{19:19,33:33,84:84}],16:[function(e,t,n){"use strict";function r(e){return"button"===e||"input"===e||"select"===e||"textarea"===e}function o(e,t,n){switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":return!(!n.disabled||!r(t));default:return!1}}var i=e(113),a=e(17),s=e(18),u=e(50),l=e(91),c=e(98),p=(e(138),{}),d=null,f=function(e,t){e&&(s.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},h=function(e){return f(e,!0)},m=function(e){return f(e,!1)},v=function(e){return"."+e._rootNodeID},g={injection:{injectEventPluginOrder:a.injectEventPluginOrder,injectEventPluginsByName:a.injectEventPluginsByName},putListener:function(e,t,n){"function"!=typeof n&&i("94",t,typeof n);var r=v(e);(p[t]||(p[t]={}))[r]=n;var o=a.registrationName__module__s[t];o&&o.didPutListener&&o.didPutListener(e,t,n)},getListener:function(e,t){var n=p[t];if(o(t,e._currentElement.type,e._currentElement.props))return null;var r=v(e);return n&&n[r]},deleteListener:function(e,t){var n=a.registrationName__module__s[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t);var r=p[t];r&&delete r[v(e)]},deleteAllListeners:function(e){var t=v(e);for(var n in p)if(p.hasOwnProperty(n)&&p[n][t]){var r=a.registrationName__module__s[n];r&&r.willDeleteListener&&r.willDeleteListener(e,n),delete p[n][t]}},extractEvents:function(e,t,n,r){for(var o,i=a.plugins,s=0;s<i.length;s++){var u=i[s];if(u){var c=u.extractEvents(e,t,n,r);c&&(o=l(o,c))}}return o},enqueueEvents:function(e){e&&(d=l(d,e))},processEventQueue:function(e){var t=d;d=null,e?c(t,h):c(t,m),d&&i("95"),u.rethrowCaughtError()},__purge:function(){p={}},__getListenerBank:function(){return p}};t.exports=g},{113:113,138:138,17:17,18:18,50:50,91:91,98:98}],17:[function(e,t,n){"use strict";function r(){if(s)for(var e in u){var t=u[e],n=s.indexOf(e);if(n>-1||a("96",e),!l.plugins[n]){t.extractEvents||a("97",e),l.plugins[n]=t;var r=t.eventTypes;for(var i in r)o(r[i],t,i)||a("98",i,e)}}}function o(e,t,n){l.eventNameDispatchConfigs.hasOwnProperty(n)&&a("99",n),l.eventNameDispatchConfigs[n]=e;var r=e.phasedRegistrationNames;if(r){for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];i(s,t,n)}return!0}return!!e.registrationName&&(i(e.registrationName,t,n),!0)}function i(e,t,n){l.registrationName__module__s[e]&&a("100",e),l.registrationName__module__s[e]=t,l.registrationNameDependencies[e]=t.eventTypes[n].dependencies}var a=e(113),s=(e(138),null),u={},l={plugins:[],eventNameDispatchConfigs:{},registrationName__module__s:{},registrationNameDependencies:{},possibleRegistrationNames:null,injectEventPluginOrder:function(e){s&&a("101"),s=Array.prototype.slice.call(e),r()},injectEventPluginsByName:function(e){var t=!1;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];u.hasOwnProperty(n)&&u[n]===o||(u[n]&&a("102",n),u[n]=o,t=!0)}t&&r()},getPlugin__module__ForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return l.registrationName__module__s[t.registrationName]||null;if(void 0!==t.phasedRegistrationNames){var n=t.phasedRegistrationNames;for(var r in n)if(n.hasOwnProperty(r)){var o=l.registrationName__module__s[n[r]];if(o)return o}}return null},_resetEventPlugins:function(){s=null;for(var e in u)u.hasOwnProperty(e)&&delete u[e];l.plugins.length=0;var t=l.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var r=l.registrationName__module__s;for(var o in r)r.hasOwnProperty(o)&&delete r[o]}};t.exports=l},{113:113,138:138}],18:[function(e,t,n){"use strict";function r(e){return"topMouseUp"===e||"topTouchEnd"===e||"topTouchCancel"===e}function o(e){return"topMouseMove"===e||"topTouchMove"===e}function i(e){return"topMouseDown"===e||"topTouchStart"===e}function a(e,t,n,r){var o=e.type||"unknown-event";e.currentTarget=g.getNodeFromInstance(r),t?m.invokeGuardedCallbackWithCatch(o,n,e):m.invokeGuardedCallback(o,n,e),e.currentTarget=null}function s(e,t){var n=e._dispatchListeners,r=e._dispatchInstances;if(Array.isArray(n))for(var o=0;o<n.length&&!e.isPropagationStopped();o++)a(e,t,n[o],r[o]);else n&&a(e,t,n,r);e._dispatchListeners=null,e._dispatchInstances=null}function u(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t)){for(var r=0;r<t.length&&!e.isPropagationStopped();r++)if(t[r](e,n[r]))return n[r]}else if(t&&t(e,n))return n;return null}function l(e){var t=u(e);return e._dispatchInstances=null,e._dispatchListeners=null,t}function c(e){var t=e._dispatchListeners,n=e._dispatchInstances;Array.isArray(t)&&h("103"),e.currentTarget=t?g.getNodeFromInstance(n):null;var r=t?t(e):null;return e.currentTarget=null,e._dispatchListeners=null,e._dispatchInstances=null,r}function p(e){return!!e._dispatchListeners}var d,f,h=e(113),m=e(50),v=(e(138),e(143),{injectComponentTree:function(e){d=e},injectTreeTraversal:function(e){f=e}}),g={isEndish:r,isMoveish:o,isStartish:i,executeDirectDispatch:c,executeDispatchesInOrder:s,executeDispatchesInOrderStopAtTrue:l,hasDispatches:p,getInstanceFromNode:function(e){return d.getInstanceFromNode(e)},getNodeFromInstance:function(e){return d.getNodeFromInstance(e)},isAncestor:function(e,t){return f.isAncestor(e,t)},getLowestCommonAncestor:function(e,t){return f.getLowestCommonAncestor(e,t)},getParentInstance:function(e){return f.getParentInstance(e)},traverseTwoPhase:function(e,t,n){return f.traverseTwoPhase(e,t,n)},traverseEnterLeave:function(e,t,n,r,o){return f.traverseEnterLeave(e,t,n,r,o)},injection:v};t.exports=g},{113:113,138:138,143:143,50:50}],19:[function(e,t,n){"use strict";function r(e,t,n){var r=t.dispatchConfig.phasedRegistrationNames[n];return g(e,r)}function o(e,t,n){var o=r(e,n,t);o&&(n._dispatchListeners=m(n._dispatchListeners,o),n._dispatchInstances=m(n._dispatchInstances,e))}function i(e){e&&e.dispatchConfig.phasedRegistrationNames&&h.traverseTwoPhase(e._targetInst,o,e)}function a(e){if(e&&e.dispatchConfig.phasedRegistrationNames){var t=e._targetInst,n=t?h.getParentInstance(t):null;h.traverseTwoPhase(n,o,e)}}function s(e,t,n){if(n&&n.dispatchConfig.registrationName){var r=n.dispatchConfig.registrationName,o=g(e,r);o&&(n._dispatchListeners=m(n._dispatchListeners,o),n._dispatchInstances=m(n._dispatchInstances,e))}}function u(e){e&&e.dispatchConfig.registrationName&&s(e._targetInst,null,e)}function l(e){v(e,i)}function c(e){v(e,a)}function p(e,t,n,r){h.traverseEnterLeave(n,r,s,e,t)}function d(e){v(e,u)}var f=e(16),h=e(18),m=e(91),v=e(98),g=(e(143),f.getListener),y={accumulateTwoPhaseDispatches:l,accumulateTwoPhaseDispatchesSkipTarget:c,accumulateDirectDispatches:d,accumulateEnterLeaveDispatches:p};t.exports=y},{143:143,16:16,18:18,91:91,98:98}],20:[function(e,t,n){"use strict";function r(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var o=e(144),i=e(24),a=e(106);o(r.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[a()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,r=n.length,o=this.getText(),i=o.length;for(e=0;e<r&&n[e]===o[e];e++);var a=r-e;for(t=1;t<=a&&n[r-t]===o[i-t];t++);var s=t>1?1-t:void 0;return this._fallbackText=o.slice(e,s),this._fallbackText}}),i.addPoolingTo(r),t.exports=r},{106:106,144:144,24:24}],21:[function(e,t,n){"use strict";var r=e(11),o=r.injection.MUST_USE_PROPERTY,i=r.injection.HAS_BOOLEAN_VALUE,a=r.injection.HAS_NUMERIC_VALUE,s=r.injection.HAS_POSITIVE_NUMERIC_VALUE,u=r.injection.HAS_OVERLOADED_BOOLEAN_VALUE,l={isCustomAttribute:RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+r.ATTRIBUTE_NAME_CHAR+"]*$")),Properties:{accept:0,acceptCharset:0,accessKey:0,action:0,allowFullScreen:i,allowTransparency:0,alt:0,as:0,async:i,autoComplete:0,autoPlay:i,capture:i,cellPadding:0,cellSpacing:0,charSet:0,challenge:0,checked:o|i,cite:0,classID:0,className:0,cols:s,colSpan:0,content:0,contentEditable:0,contextMenu:0,controls:i,coords:0,crossOrigin:0,data:0,dateTime:0,default:i,defer:i,dir:0,disabled:i,download:u,draggable:0,encType:0,form:0,formAction:0,formEncType:0,formMethod:0,formNoValidate:i,formTarget:0,frameBorder:0,headers:0,height:0,hidden:i,high:0,href:0,hrefLang:0,htmlFor:0,httpEquiv:0,icon:0,id:0,inputMode:0,integrity:0,is:0,keyParams:0,keyType:0,kind:0,label:0,lang:0,list:0,loop:i,low:0,manifest:0,marginHeight:0,marginWidth:0,max:0,maxLength:0,media:0,mediaGroup:0,method:0,min:0,minLength:0,multiple:o|i,muted:o|i,name:0,nonce:0,noValidate:i,open:i,optimum:0,pattern:0,placeholder:0,playsInline:i,poster:0,preload:0,profile:0,radioGroup:0,readOnly:i,referrerPolicy:0,rel:0,required:i,reversed:i,role:0,rows:s,rowSpan:a,sandbox:0,scope:0,scoped:i,scrolling:0,seamless:i,selected:o|i,shape:0,size:s,sizes:0,span:s,spellCheck:0,src:0,srcDoc:0,srcLang:0,srcSet:0,start:a,step:0,style:0,summary:0,tabIndex:0,target:0,title:0,type:0,useMap:0,value:0,width:0,wmode:0,wrap:0,about:0,datatype:0,inlist:0,prefix:0,property:0,resource:0,typeof:0,vocab:0,autoCapitalize:0,autoCorrect:0,autoSave:0,color:0,itemProp:0,itemScope:i,itemType:0,itemID:0,itemRef:0,results:0,security:0,unselectable:0},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{},DOMMutationMethods:{value:function(e,t){if(null==t)return e.removeAttribute("value");"number"!==e.type||!1===e.hasAttribute("value")?e.setAttribute("value",""+t):e.validity&&!e.validity.badInput&&e.ownerDocument.activeElement!==e&&e.setAttribute("value",""+t)}}};t.exports=l},{11:11}],22:[function(e,t,n){"use strict";function r(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}function o(e){var t=/(=0|=2)/g,n={"=0":"=","=2":":"};return(""+("."===e[0]&&"$"===e[1]?e.substring(2):e.substring(1))).replace(t,function(e){return n[e]})}var i={escape:r,unescape:o};t.exports=i},{}],23:[function(e,t,n){"use strict";function r(e){null!=e.checkedLink&&null!=e.valueLink&&s("87")}function o(e){r(e),(null!=e.value||null!=e.onChange)&&s("88")}function i(e){r(e),(null!=e.checked||null!=e.onChange)&&s("89")}function a(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var s=e(113),u=e(64),l=e(146),c=e(121),p=l(c.isValidElement),d=(e(138),e(143),{button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0}),f={value:function(e,t,n){return!e[t]||d[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:p.func},h={},m={checkPropTypes:function(e,t,n){for(var r in f){if(f.hasOwnProperty(r))var o=f[r](t,r,e,"prop",null,u);o instanceof Error&&!(o.message in h)&&(h[o.message]=!0,a(n))}},getValue:function(e){return e.valueLink?(o(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(i(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(o(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(i(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};t.exports=m},{113:113,121:121,138:138,143:143,146:146,64:64}],24:[function(e,t,n){"use strict";var r=e(113),o=(e(138),function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)}),i=function(e,t){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t),r}return new n(e,t)},a=function(e,t,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,e,t,n),o}return new r(e,t,n)},s=function(e,t,n,r){var o=this;if(o.instancePool.length){var i=o.instancePool.pop();return o.call(i,e,t,n,r),i}return new o(e,t,n,r)},u=function(e){var t=this;e instanceof t||r("25"),e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},l=o,c=function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||l,n.poolSize||(n.poolSize=10),n.release=u,n},p={addPoolingTo:c,oneArgumentPooler:o,twoArgumentPooler:i,threeArgumentPooler:a,fourArgumentPooler:s};t.exports=p},{113:113,138:138}],25:[function(e,t,n){"use strict";function r(e){return Object.prototype.hasOwnProperty.call(e,m)||(e[m]=f++,p[e[m]]={}),p[e[m]]}var o,i=e(144),a=e(17),s=e(51),u=e(90),l=e(107),c=e(110),p={},d=!1,f=0,h={topAbort:"abort",topAnimationEnd:l("animationend")||"animationend",topAnimationIteration:l("animationiteration")||"animationiteration",topAnimationStart:l("animationstart")||"animationstart",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topTransitionEnd:l("transitionend")||"transitionend",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},m="_reactListenersID"+String(Math.random()).slice(2),v=i({},s,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(v.handleTopLevel),v.ReactEventListener=e}},setEnabled:function(e){v.ReactEventListener&&v.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!v.ReactEventListener||!v.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,o=r(n),i=a.registrationNameDependencies[e],s=0;s<i.length;s++){var u=i[s];o.hasOwnProperty(u)&&o[u]||("topWheel"===u?c("wheel")?v.ReactEventListener.trapBubbledEvent("topWheel","wheel",n):c("mousewheel")?v.ReactEventListener.trapBubbledEvent("topWheel","mousewheel",n):v.ReactEventListener.trapBubbledEvent("topWheel","DOMMouseScroll",n):"topScroll"===u?c("scroll",!0)?v.ReactEventListener.trapCapturedEvent("topScroll","scroll",n):v.ReactEventListener.trapBubbledEvent("topScroll","scroll",v.ReactEventListener.WINDOW_HANDLE):"topFocus"===u||"topBlur"===u?(c("focus",!0)?(v.ReactEventListener.trapCapturedEvent("topFocus","focus",n),v.ReactEventListener.trapCapturedEvent("topBlur","blur",n)):c("focusin")&&(v.ReactEventListener.trapBubbledEvent("topFocus","focusin",n),v.ReactEventListener.trapBubbledEvent("topBlur","focusout",n)),o.topBlur=!0,o.topFocus=!0):h.hasOwnProperty(u)&&v.ReactEventListener.trapBubbledEvent(u,h[u],n),o[u]=!0)}},trapBubbledEvent:function(e,t,n){return v.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return v.ReactEventListener.trapCapturedEvent(e,t,n)},supportsEventPageXY:function(){if(!document.createEvent)return!1;var e=document.createEvent("MouseEvent");return null!=e&&"pageX"in e},ensureScrollValueMonitoring:function(){if(void 0===o&&(o=v.supportsEventPageXY()),!o&&!d){var e=u.refreshScrollValues;v.ReactEventListener.monitorScrollValue(e),d=!0}}});t.exports=v},{107:107,110:110,144:144,17:17,51:51,90:90}],26:[function(e,t,n){(function(n){"use strict";function r(e,t,n,r){var o=void 0===e[n];null!=t&&o&&(e[n]=i(t,!0))}var o=e(66),i=e(109),a=(e(22),e(117)),s=e(118);e(143);void 0!==n&&n.env;var u={instantiateChildren:function(e,t,n,o){if(null==e)return null;var i={};return s(e,r,i),i},updateChildren:function(e,t,n,r,s,u,l,c,p){if(t||e){var d,f;for(d in t)if(t.hasOwnProperty(d)){f=e&&e[d];var h=f&&f._currentElement,m=t[d];if(null!=f&&a(h,m))o.receiveComponent(f,m,s,c),t[d]=f;else{f&&(r[d]=o.getHostNode(f),o.unmountComponent(f,!1));var v=i(m,!0);t[d]=v;var g=o.mountComponent(v,s,u,l,c,p);n.push(g)}}for(d in e)!e.hasOwnProperty(d)||t&&t.hasOwnProperty(d)||(f=e[d],r[d]=o.getHostNode(f),o.unmountComponent(f,!1))}},unmountChildren:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];o.unmountComponent(r,t)}}};t.exports=u}).call(this,void 0)},{109:109,117:117,118:118,143:143,22:22,66:66}],27:[function(e,t,n){"use strict";var r=e(8),o=e(37),i={processChildrenUpdates:o.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkup:r.dangerouslyReplaceNodeWithMarkup};t.exports=i},{37:37,8:8}],28:[function(e,t,n){"use strict";var r=e(113),o=(e(138),!1),i={replaceNodeWithMarkup:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){o&&r("104"),i.replaceNodeWithMarkup=e.replaceNodeWithMarkup,i.processChildrenUpdates=e.processChildrenUpdates,o=!0}}};t.exports=i},{113:113,138:138}],29:[function(e,t,n){"use strict";function r(e){}function o(e){return!(!e.prototype||!e.prototype.isReactComponent)}function i(e){return!(!e.prototype||!e.prototype.isPureReactComponent)}var a=e(113),s=e(144),u=e(121),l=e(28),c=e(120),p=e(50),d=e(57),f=(e(58),e(62)),h=e(66),m=e(131),v=(e(138),e(142)),g=e(117),y=(e(143),{ImpureClass:0,PureClass:1,StatelessFunctional:2});r.prototype.render=function(){var e=d.get(this)._currentElement.type,t=e(this.props,this.context,this.updater);return t};var _=1,C={construct:function(e){this._currentElement=e,this._rootNodeID=0,this._compositeType=null,this._instance=null,this._hostParent=null,this._hostContainerInfo=null,this._updateBatchNumber=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedNodeType=null,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null,this._calledComponentWillUnmount=!1},mountComponent:function(e,t,n,s){this._context=s,this._mountOrder=_++,this._hostParent=t,this._hostContainerInfo=n;var l,c=this._currentElement.props,p=this._processContext(s),f=this._currentElement.type,h=e.getUpdateQueue(),v=o(f),g=this._constructComponent(v,c,p,h);v||null!=g&&null!=g.render?i(f)?this._compositeType=y.PureClass:this._compositeType=y.ImpureClass:(l=g,null===g||!1===g||u.isValidElement(g)||a("105",f.displayName||f.name||"Component"),g=new r(f),this._compositeType=y.StatelessFunctional),g.props=c,g.context=p,g.refs=m,g.updater=h,this._instance=g,d.set(g,this);var C=g.state;void 0===C&&(g.state=C=null),("object"!=typeof C||Array.isArray(C))&&a("106",this.getName()||"ReactCompositeComponent"),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1;var b;return b=g.unstable_handleError?this.performInitialMountWithErrorHandling(l,t,n,e,s):this.performInitialMount(l,t,n,e,s),g.componentDidMount&&e.getReactMountReady().enqueue(g.componentDidMount,g),b},_constructComponent:function(e,t,n,r){return this._constructComponentWithoutOwner(e,t,n,r)},_constructComponentWithoutOwner:function(e,t,n,r){var o=this._currentElement.type;return e?new o(t,n,r):o(t,n,r)},performInitialMountWithErrorHandling:function(e,t,n,r,o){var i,a=r.checkpoint();try{i=this.performInitialMount(e,t,n,r,o)}catch(s){r.rollback(a),this._instance.unstable_handleError(s),this._pendingStateQueue&&(this._instance.state=this._processPendingState(this._instance.props,this._instance.context)),a=r.checkpoint(),this._renderedComponent.unmountComponent(!0),r.rollback(a),i=this.performInitialMount(e,t,n,r,o)}return i},performInitialMount:function(e,t,n,r,o){var i=this._instance;i.componentWillMount&&(i.componentWillMount(),this._pendingStateQueue&&(i.state=this._processPendingState(i.props,i.context))),void 0===e&&(e=this._renderValidatedComponent());var a=f.getType(e);this._renderedNodeType=a;var s=this._instantiateReactComponent(e,a!==f.EMPTY);return this._renderedComponent=s,h.mountComponent(s,r,t,n,this._processChildContext(o),0)},getHostNode:function(){return h.getHostNode(this._renderedComponent)},unmountComponent:function(e){if(this._renderedComponent){var t=this._instance;if(t.componentWillUnmount&&!t._calledComponentWillUnmount)if(t._calledComponentWillUnmount=!0,e){var n=this.getName()+".componentWillUnmount()";p.invokeGuardedCallback(n,t.componentWillUnmount.bind(t))}else t.componentWillUnmount();this._renderedComponent&&(h.unmountComponent(this._renderedComponent,e),this._renderedNodeType=null,this._renderedComponent=null,this._instance=null),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=0,this._topLevelWrapper=null,d.remove(t)}},_maskContext:function(e){var t=this._currentElement.type,n=t.contextTypes;if(!n)return m;var r={};for(var o in n)r[o]=e[o];return r},_processContext:function(e){return this._maskContext(e)},_processChildContext:function(e){var t,n=this._currentElement.type,r=this._instance;if(r.getChildContext&&(t=r.getChildContext()),t){"object"!=typeof n.childContextTypes&&a("107",this.getName()||"ReactCompositeComponent");for(var o in t)o in n.childContextTypes||a("108",this.getName()||"ReactCompositeComponent",o);return s({},e,t)}return e},_checkContextTypes:function(e,t,n){},receiveComponent:function(e,t,n){var r=this._currentElement,o=this._context;this._pendingElement=null,this.updateComponent(t,r,e,o,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement?h.receiveComponent(this,this._pendingElement,e,this._context):null!==this._pendingStateQueue||this._pendingForceUpdate?this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context):this._updateBatchNumber=null},updateComponent:function(e,t,n,r,o){var i=this._instance;null==i&&a("136",this.getName()||"ReactCompositeComponent");var s,u=!1;this._context===o?s=i.context:(s=this._processContext(o),u=!0);var l=t.props,c=n.props;t!==n&&(u=!0),u&&i.componentWillReceiveProps&&i.componentWillReceiveProps(c,s);var p=this._processPendingState(c,s),d=!0;this._pendingForceUpdate||(i.shouldComponentUpdate?d=i.shouldComponentUpdate(c,p,s):this._compositeType===y.PureClass&&(d=!v(l,c)||!v(i.state,p))),this._updateBatchNumber=null,d?(this._pendingForceUpdate=!1,this._performComponentUpdate(n,c,p,s,e,o)):(this._currentElement=n,this._context=o,i.props=c,i.state=p,i.context=s)},_processPendingState:function(e,t){var n=this._instance,r=this._pendingStateQueue,o=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!r)return n.state;if(o&&1===r.length)return r[0];for(var i=s({},o?r[0]:n.state),a=o?1:0;a<r.length;a++){var u=r[a];s(i,"function"==typeof u?u.call(n,i,e,t):u)}return i},_performComponentUpdate:function(e,t,n,r,o,i){var a,s,u,l=this._instance,c=Boolean(l.componentDidUpdate);c&&(a=l.props,s=l.state,u=l.context),l.componentWillUpdate&&l.componentWillUpdate(t,n,r),this._currentElement=e,this._context=i,l.props=t,l.state=n,l.context=r,this._updateRenderedComponent(o,i),c&&o.getReactMountReady().enqueue(l.componentDidUpdate.bind(l,a,s,u),l)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,r=n._currentElement,o=this._renderValidatedComponent();if(g(r,o))h.receiveComponent(n,o,e,this._processChildContext(t));else{var i=h.getHostNode(n);h.unmountComponent(n,!1);var a=f.getType(o);this._renderedNodeType=a;var s=this._instantiateReactComponent(o,a!==f.EMPTY);this._renderedComponent=s;var u=h.mountComponent(s,e,this._hostParent,this._hostContainerInfo,this._processChildContext(t),0);this._replaceNodeWithMarkup(i,u,n)}},_replaceNodeWithMarkup:function(e,t,n){l.replaceNodeWithMarkup(e,t,n)},_renderValidatedComponentWithoutOwnerOrContext:function(){return this._instance.render()},_renderValidatedComponent:function(){var e;if(this._compositeType!==y.StatelessFunctional){c.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{c.current=null}}else e=this._renderValidatedComponentWithoutOwnerOrContext();return null===e||!1===e||u.isValidElement(e)||a("109",this.getName()||"ReactCompositeComponent"),e},attachRef:function(e,t){var n=this.getPublicInstance();null==n&&a("110");var r=t.getPublicInstance();(n.refs===m?n.refs={}:n.refs)[e]=r},detachRef:function(e){delete this.getPublicInstance().refs[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return this._compositeType===y.StatelessFunctional?null:e},_instantiateReactComponent:null};t.exports=C},{113:113,117:117,120:120,121:121,131:131,138:138,142:142,143:143,144:144,28:28,50:50,57:57,58:58,62:62,66:66}],30:[function(e,t,n){"use strict";var r=e(33),o=e(47),i=e(60),a=e(66),s=e(71),u=e(72),l=e(96),c=e(103),p=e(114);e(143);o.inject();var d={findDOMNode:l,render:i.render,unmountComponentAtNode:i.unmountComponentAtNode,version:u,unstable_batchedUpdates:s.batchedUpdates,unstable_renderSubtreeIntoContainer:p};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({ComponentTree:{getClosestInstanceFromNode:r.getClosestInstanceFromNode,getNodeFromInstance:function(e){return e._renderedComponent&&(e=c(e)),e?r.getNodeFromInstance(e):null}},Mount:i,Reconciler:a});t.exports=d},{103:103,114:114,143:143,33:33,47:47,60:60,66:66,71:71,72:72,96:96}],31:[function(e,t,n){"use strict";function r(e){if(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" This DOM node was rendered by `"+n+"`."}}return""}function o(e,t){t&&(Q[e._tag]&&(null!=t.children||null!=t.dangerouslySetInnerHTML)&&v("137",e._tag,e._currentElement._owner?" Check the render method of "+e._currentElement._owner.getName()+".":""),null!=t.dangerouslySetInnerHTML&&(null!=t.children&&v("60"),"object"==typeof t.dangerouslySetInnerHTML&&H in t.dangerouslySetInnerHTML||v("61")),null!=t.style&&"object"!=typeof t.style&&v("62",r(e)))}function i(e,t,n,r){if(!(r instanceof A)){var o=e._hostContainerInfo,i=o._node&&o._node.nodeType===K,s=i?o._node:o._ownerDocument;j(t,s),r.getReactMountReady().enqueue(a,{inst:e,registrationName:t,listener:n})}}function a(){var e=this;w.putListener(e.inst,e.registrationName,e.listener)}function s(){var e=this;N.postMountWrapper(e)}function u(){var e=this;O.postMountWrapper(e)}function l(){var e=this;M.postMountWrapper(e)}function c(){L.track(this)}function p(){var e=this;e._rootNodeID||v("63");var t=V(e);switch(t||v("64"),e._tag){case"iframe":case"object":e._wrapperState.listeners=[k.trapBubbledEvent("topLoad","load",t)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var n in z)z.hasOwnProperty(n)&&e._wrapperState.listeners.push(k.trapBubbledEvent(n,z[n],t));break;case"source":e._wrapperState.listeners=[k.trapBubbledEvent("topError","error",t)];break;case"img":e._wrapperState.listeners=[k.trapBubbledEvent("topError","error",t),k.trapBubbledEvent("topLoad","load",t)];break;case"form":e._wrapperState.listeners=[k.trapBubbledEvent("topReset","reset",t),k.trapBubbledEvent("topSubmit","submit",t)];break;case"input":case"select":case"textarea":e._wrapperState.listeners=[k.trapBubbledEvent("topInvalid","invalid",t)]}}function d(){I.postUpdateWrapper(this)}function f(e){Z.call($,e)||(G.test(e)||v("65",e),$[e]=!0)}function h(e,t){return e.indexOf("-")>=0||null!=t.is}function m(e){var t=e.type;f(t),this._currentElement=e,this._tag=t.toLowerCase(),this._namespaceURI=null,this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._hostNode=null,this._hostParent=null,this._rootNodeID=0,this._domID=0,this._hostContainerInfo=null,this._wrapperState=null,this._topLevelWrapper=null,this._flags=0}var v=e(113),g=e(144),y=e(2),_=e(5),C=e(9),b=e(10),E=e(11),x=e(12),w=e(16),T=e(17),k=e(25),P=e(32),S=e(33),N=e(38),M=e(39),I=e(40),O=e(43),R=(e(58),e(61)),A=e(68),D=(e(130),e(95)),L=(e(138),e(110),e(142),e(108)),U=(e(119),e(143),P),F=w.deleteListener,V=S.getNodeFromInstance,j=k.listenTo,B=T.registrationName__module__s,W={string:!0,number:!0},H="__html",q={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null},K=11,z={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},Y={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},X={listing:!0,pre:!0,textarea:!0},Q=g({menuitem:!0},Y),G=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,$={},Z={}.hasOwnProperty,J=1;m.displayName="ReactDOMComponent",m.Mixin={mountComponent:function(e,t,n,r){this._rootNodeID=J++,this._domID=n._idCounter++,this._hostParent=t,this._hostContainerInfo=n;var i=this._currentElement.props;switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":this._wrapperState={listeners:null},e.getReactMountReady().enqueue(p,this);break;case"input":N.mountWrapper(this,i,t),i=N.getHostProps(this,i),e.getReactMountReady().enqueue(c,this),e.getReactMountReady().enqueue(p,this);break;case"option":M.mountWrapper(this,i,t),i=M.getHostProps(this,i);break;case"select":I.mountWrapper(this,i,t),i=I.getHostProps(this,i),e.getReactMountReady().enqueue(p,this);break;case"textarea":O.mountWrapper(this,i,t),i=O.getHostProps(this,i),e.getReactMountReady().enqueue(c,this),e.getReactMountReady().enqueue(p,this)}o(this,i);var a,d;null!=t?(a=t._namespaceURI,d=t._tag):n._tag&&(a=n._namespaceURI,d=n._tag),(null==a||a===b.svg&&"foreignobject"===d)&&(a=b.html),a===b.html&&("svg"===this._tag?a=b.svg:"math"===this._tag&&(a=b.mathml)),this._namespaceURI=a;var f;if(e.useCreateElement){var h,m=n._ownerDocument;if(a===b.html)if("script"===this._tag){var v=m.createElement("div"),g=this._currentElement.type;v.innerHTML="<"+g+"></"+g+">",h=v.removeChild(v.firstChild)}else h=i.is?m.createElement(this._currentElement.type,i.is):m.createElement(this._currentElement.type);else h=m.createElementNS(a,this._currentElement.type);S.precacheNode(this,h),this._flags|=U.hasCachedChildNodes,this._hostParent||x.setAttributeForRoot(h),this._updateDOMProperties(null,i,e);var _=C(h);this._createInitialChildren(e,i,r,_),f=_}else{var E=this._createOpenTagMarkupAndPutListeners(e,i),w=this._createContentMarkup(e,i,r);f=!w&&Y[this._tag]?E+"/>":E+">"+w+"</"+this._currentElement.type+">"}switch(this._tag){case"input":e.getReactMountReady().enqueue(s,this),i.autoFocus&&e.getReactMountReady().enqueue(y.focusDOMComponent,this);break;case"textarea":e.getReactMountReady().enqueue(u,this),i.autoFocus&&e.getReactMountReady().enqueue(y.focusDOMComponent,this);break;case"select":case"button":i.autoFocus&&e.getReactMountReady().enqueue(y.focusDOMComponent,this);break;case"option":e.getReactMountReady().enqueue(l,this)}return f},_createOpenTagMarkupAndPutListeners:function(e,t){var n="<"+this._currentElement.type;for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];if(null!=o)if(B.hasOwnProperty(r))o&&i(this,r,o,e);else{"style"===r&&(o&&(o=this._previousStyleCopy=g({},t.style)),o=_.createMarkupForStyles(o,this));var a=null;null!=this._tag&&h(this._tag,t)?q.hasOwnProperty(r)||(a=x.createMarkupForCustomAttribute(r,o)):a=x.createMarkupForProperty(r,o),a&&(n+=" "+a)}}return e.renderToStaticMarkup?n:(this._hostParent||(n+=" "+x.createMarkupForRoot()),n+=" "+x.createMarkupForID(this._domID))},_createContentMarkup:function(e,t,n){var r="",o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&(r=o.__html);else{var i=W[typeof t.children]?t.children:null,a=null!=i?null:t.children;if(null!=i)r=D(i);else if(null!=a){var s=this.mountChildren(a,e,n);r=s.join("")}}return X[this._tag]&&"\n"===r.charAt(0)?"\n"+r:r},_createInitialChildren:function(e,t,n,r){var o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&C.queueHTML(r,o.__html);else{var i=W[typeof t.children]?t.children:null,a=null!=i?null:t.children;if(null!=i)""!==i&&C.queueText(r,i);else if(null!=a)for(var s=this.mountChildren(a,e,n),u=0;u<s.length;u++)C.queueChild(r,s[u])}},receiveComponent:function(e,t,n){var r=this._currentElement;this._currentElement=e,this.updateComponent(t,r,e,n)},updateComponent:function(e,t,n,r){var i=t.props,a=this._currentElement.props;switch(this._tag){case"input":i=N.getHostProps(this,i),a=N.getHostProps(this,a);break;case"option":i=M.getHostProps(this,i),a=M.getHostProps(this,a);break;case"select":i=I.getHostProps(this,i),a=I.getHostProps(this,a);break;case"textarea":i=O.getHostProps(this,i),a=O.getHostProps(this,a)}switch(o(this,a),this._updateDOMProperties(i,a,e),this._updateDOMChildren(i,a,e,r),this._tag){case"input":N.updateWrapper(this);break;case"textarea":O.updateWrapper(this);break;case"select":e.getReactMountReady().enqueue(d,this)}},_updateDOMProperties:function(e,t,n){var r,o,a;for(r in e)if(!t.hasOwnProperty(r)&&e.hasOwnProperty(r)&&null!=e[r])if("style"===r){var s=this._previousStyleCopy;for(o in s)s.hasOwnProperty(o)&&(a=a||{},a[o]="");this._previousStyleCopy=null}else B.hasOwnProperty(r)?e[r]&&F(this,r):h(this._tag,e)?q.hasOwnProperty(r)||x.deleteValueForAttribute(V(this),r):(E.properties[r]||E.isCustomAttribute(r))&&x.deleteValueForProperty(V(this),r);for(r in t){var u=t[r],l="style"===r?this._previousStyleCopy:null!=e?e[r]:void 0;if(t.hasOwnProperty(r)&&u!==l&&(null!=u||null!=l))if("style"===r)if(u?u=this._previousStyleCopy=g({},u):this._previousStyleCopy=null,l){for(o in l)!l.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(a=a||{},a[o]="");for(o in u)u.hasOwnProperty(o)&&l[o]!==u[o]&&(a=a||{},a[o]=u[o])}else a=u;else if(B.hasOwnProperty(r))u?i(this,r,u,n):l&&F(this,r);else if(h(this._tag,t))q.hasOwnProperty(r)||x.setValueForAttribute(V(this),r,u);else if(E.properties[r]||E.isCustomAttribute(r)){var c=V(this);null!=u?x.setValueForProperty(c,r,u):x.deleteValueForProperty(c,r)}}a&&_.setValueForStyles(V(this),a,this)},_updateDOMChildren:function(e,t,n,r){var o=W[typeof e.children]?e.children:null,i=W[typeof t.children]?t.children:null,a=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,s=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,u=null!=o?null:e.children,l=null!=i?null:t.children,c=null!=o||null!=a,p=null!=i||null!=s;null!=u&&null==l?this.updateChildren(null,n,r):c&&!p&&this.updateTextContent(""),null!=i?o!==i&&this.updateTextContent(""+i):null!=s?a!==s&&this.updateMarkup(""+s):null!=l&&this.updateChildren(l,n,r)},getHostNode:function(){return V(this)},unmountComponent:function(e){switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":var t=this._wrapperState.listeners;if(t)for(var n=0;n<t.length;n++)t[n].remove();break;case"input":case"textarea":L.stopTracking(this);break;case"html":case"head":case"body":v("66",this._tag)}this.unmountChildren(e),S.uncacheNode(this),w.deleteAllListeners(this),this._rootNodeID=0,this._domID=0,this._wrapperState=null},getPublicInstance:function(){return V(this)}},g(m.prototype,m.Mixin,R.Mixin),t.exports=m},{10:10,108:108,11:11,110:110,113:113,119:119,12:12,130:130,138:138,142:142,143:143,144:144,16:16,17:17,2:2,25:25,32:32,33:33,38:38,39:39,40:40,43:43,5:5,58:58,61:61,68:68,9:9,95:95}],32:[function(e,t,n){"use strict";var r={hasCachedChildNodes:1};t.exports=r},{}],33:[function(e,t,n){"use strict";function r(e,t){return 1===e.nodeType&&e.getAttribute(h)===String(t)||8===e.nodeType&&e.nodeValue===" react-text: "+t+" "||8===e.nodeType&&e.nodeValue===" react-empty: "+t+" "}function o(e){for(var t;t=e._renderedComponent;)e=t;return e}function i(e,t){var n=o(e);n._hostNode=t,t[v]=n}function a(e){var t=e._hostNode;t&&(delete t[v],e._hostNode=null)}function s(e,t){if(!(e._flags&m.hasCachedChildNodes)){var n=e._renderedChildren,a=t.firstChild;e:for(var s in n)if(n.hasOwnProperty(s)){var u=n[s],l=o(u)._domID;if(0!==l){for(;null!==a;a=a.nextSibling)if(r(a,l)){i(u,a);continue e}p("32",l)}}e._flags|=m.hasCachedChildNodes}}function u(e){if(e[v])return e[v];for(var t=[];!e[v];){if(t.push(e),!e.parentNode)return null;e=e.parentNode}for(var n,r;e&&(r=e[v]);e=t.pop())n=r,t.length&&s(r,e);return n}function l(e){var t=u(e);return null!=t&&t._hostNode===e?t:null}function c(e){if(void 0===e._hostNode&&p("33"),e._hostNode)return e._hostNode;for(var t=[];!e._hostNode;)t.push(e),e._hostParent||p("34"),e=e._hostParent;for(;t.length;e=t.pop())s(e,e._hostNode);return e._hostNode}var p=e(113),d=e(11),f=e(32),h=(e(138),d.ID_ATTRIBUTE_NAME),m=f,v="__reactInternalInstance$"+Math.random().toString(36).slice(2),g={getClosestInstanceFromNode:u,getInstanceFromNode:l,getNodeFromInstance:c,precacheChildNodes:s,precacheNode:i,uncacheNode:a};t.exports=g},{11:11,113:113,138:138,32:32}],34:[function(e,t,n){"use strict";function r(e,t){return{_topLevelWrapper:e,_idCounter:1,_ownerDocument:t?t.nodeType===o?t:t.ownerDocument:null,_node:t,_tag:t?t.nodeName.toLowerCase():null,_namespaceURI:t?t.namespaceURI:null}}var o=(e(119),9);t.exports=r},{119:119}],35:[function(e,t,n){"use strict";var r=e(144),o=e(9),i=e(33),a=function(e){this._currentElement=null,this._hostNode=null,this._hostParent=null,this._hostContainerInfo=null,this._domID=0};r(a.prototype,{mountComponent:function(e,t,n,r){var a=n._idCounter++;this._domID=a,this._hostParent=t,this._hostContainerInfo=n;var s=" react-empty: "+this._domID+" ";if(e.useCreateElement){var u=n._ownerDocument,l=u.createComment(s);return i.precacheNode(this,l),o(l)}return e.renderToStaticMarkup?"":"\x3c!--"+s+"--\x3e"},receiveComponent:function(){},getHostNode:function(){return i.getNodeFromInstance(this)},unmountComponent:function(){i.uncacheNode(this)}}),t.exports=a},{144:144,33:33,9:9}],36:[function(e,t,n){"use strict";var r={useCreateElement:!0,useFiber:!1};t.exports=r},{}],37:[function(e,t,n){"use strict";var r=e(8),o=e(33),i={dangerouslyProcessChildrenUpdates:function(e,t){var n=o.getNodeFromInstance(e);r.processUpdates(n,t)}};t.exports=i},{33:33,8:8}],38:[function(e,t,n){"use strict";function r(){this._rootNodeID&&d.updateWrapper(this)}function o(e){return"checkbox"===e.type||"radio"===e.type?null!=e.checked:null!=e.value}function i(e){var t=this._currentElement.props,n=l.executeOnChange(t,e);p.asap(r,this);var o=t.name;if("radio"===t.type&&null!=o){for(var i=c.getNodeFromInstance(this),s=i;s.parentNode;)s=s.parentNode;for(var u=s.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),d=0;d<u.length;d++){var f=u[d];if(f!==i&&f.form===i.form){var h=c.getInstanceFromNode(f);h||a("90"),p.asap(r,h)}}}return n}var a=e(113),s=e(144),u=e(12),l=e(23),c=e(33),p=e(71),d=(e(138),e(143),{getHostProps:function(e,t){var n=l.getValue(t),r=l.getChecked(t);return s({type:void 0,step:void 0,min:void 0,max:void 0},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=n?n:e._wrapperState.initialValue,checked:null!=r?r:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange})},mountWrapper:function(e,t){var n=t.defaultValue;e._wrapperState={initialChecked:null!=t.checked?t.checked:t.defaultChecked,initialValue:null!=t.value?t.value:n,listeners:null,onChange:i.bind(e),controlled:o(t)}},updateWrapper:function(e){var t=e._currentElement.props,n=t.checked;null!=n&&u.setValueForProperty(c.getNodeFromInstance(e),"checked",n||!1);var r=c.getNodeFromInstance(e),o=l.getValue(t);if(null!=o)if(0===o&&""===r.value)r.value="0";else if("number"===t.type){var i=parseFloat(r.value,10)||0;(o!=i||o==i&&r.value!=o)&&(r.value=""+o)}else r.value!==""+o&&(r.value=""+o);else null==t.value&&null!=t.defaultValue&&r.defaultValue!==""+t.defaultValue&&(r.defaultValue=""+t.defaultValue),null==t.checked&&null!=t.defaultChecked&&(r.defaultChecked=!!t.defaultChecked)},postMountWrapper:function(e){var t=e._currentElement.props,n=c.getNodeFromInstance(e);switch(t.type){case"submit":case"reset":break;case"color":case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":n.value="",n.value=n.defaultValue;break;default:n.value=n.value}var r=n.name;""!==r&&(n.name=""),n.defaultChecked=!n.defaultChecked,n.defaultChecked=!n.defaultChecked,""!==r&&(n.name=r)}});t.exports=d},{113:113,12:12,138:138,143:143,144:144,23:23,33:33,71:71}],39:[function(e,t,n){"use strict";function r(e){var t="";return i.Children.forEach(e,function(e){null!=e&&("string"==typeof e||"number"==typeof e?t+=e:u||(u=!0))}),t}var o=e(144),i=e(121),a=e(33),s=e(40),u=(e(143),!1),l={mountWrapper:function(e,t,n){var o=null;if(null!=n){var i=n;"optgroup"===i._tag&&(i=i._hostParent),null!=i&&"select"===i._tag&&(o=s.getSelectValueContext(i))}var a=null;if(null!=o){var u;if(u=null!=t.value?t.value+"":r(t.children),a=!1,Array.isArray(o)){for(var l=0;l<o.length;l++)if(""+o[l]===u){a=!0;break}}else a=""+o===u}e._wrapperState={selected:a}},postMountWrapper:function(e){var t=e._currentElement.props;null!=t.value&&a.getNodeFromInstance(e).setAttribute("value",t.value)},getHostProps:function(e,t){var n=o({selected:void 0,children:void 0},t);null!=e._wrapperState.selected&&(n.selected=e._wrapperState.selected);var i=r(t.children);return i&&(n.children=i),n}};t.exports=l},{121:121,143:143,144:144,33:33,40:40}],40:[function(e,t,n){"use strict";function r(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=s.getValue(e);null!=t&&o(this,Boolean(e.multiple),t)}}function o(e,t,n){var r,o,i=u.getNodeFromInstance(e).options;if(t){for(r={},o=0;o<n.length;o++)r[""+n[o]]=!0;for(o=0;o<i.length;o++){var a=r.hasOwnProperty(i[o].value);i[o].selected!==a&&(i[o].selected=a)}}else{for(r=""+n,o=0;o<i.length;o++)if(i[o].value===r)return void(i[o].selected=!0);i.length&&(i[0].selected=!0)}}function i(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);return this._rootNodeID&&(this._wrapperState.pendingUpdate=!0),l.asap(r,this),n}var a=e(144),s=e(23),u=e(33),l=e(71),c=(e(143),!1),p={getHostProps:function(e,t){return a({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,t){var n=s.getValue(t);e._wrapperState={pendingUpdate:!1,initialValue:null!=n?n:t.defaultValue,listeners:null,onChange:i.bind(e),wasMultiple:Boolean(t.multiple)},void 0===t.value||void 0===t.defaultValue||c||(c=!0)},getSelectValueContext:function(e){return e._wrapperState.initialValue},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var n=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var r=s.getValue(t);null!=r?(e._wrapperState.pendingUpdate=!1,o(e,Boolean(t.multiple),r)):n!==Boolean(t.multiple)&&(null!=t.defaultValue?o(e,Boolean(t.multiple),t.defaultValue):o(e,Boolean(t.multiple),t.multiple?[]:""))}};t.exports=p},{143:143,144:144,23:23,33:33,71:71}],41:[function(e,t,n){"use strict";function r(e,t,n,r){return e===n&&t===r}function o(e){var t=document.selection,n=t.createRange(),r=n.text.length,o=n.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",n);var i=o.text.length;return{start:i,end:i+r}}function i(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,o=t.anchorOffset,i=t.focusNode,a=t.focusOffset,s=t.getRangeAt(0);try{s.startContainer.nodeType,s.endContainer.nodeType}catch(e){return null}var u=r(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),l=u?0:s.toString().length,c=s.cloneRange();c.selectNodeContents(e),c.setEnd(s.startContainer,s.startOffset);var p=r(c.startContainer,c.startOffset,c.endContainer,c.endOffset),d=p?0:c.toString().length,f=d+l,h=document.createRange();h.setStart(n,o),h.setEnd(i,a);var m=h.collapsed;return{start:m?f:d,end:m?d:f}}function a(e,t){var n,r,o=document.selection.createRange().duplicate();void 0===t.end?(n=t.start,r=n):t.start>t.end?(n=t.end,r=t.start):(n=t.start,r=t.end),o.moveToElementText(e),o.moveStart("character",n),o.setEndPoint("EndToStart",o),o.moveEnd("character",r-n),o.select()}function s(e,t){if(window.getSelection){var n=window.getSelection(),r=e[c()].length,o=Math.min(t.start,r),i=void 0===t.end?o:Math.min(t.end,r);if(!n.extend&&o>i){var a=i;i=o,o=a}var s=l(e,o),u=l(e,i);if(s&&u){var p=document.createRange();p.setStart(s.node,s.offset),n.removeAllRanges(),o>i?(n.addRange(p),n.extend(u.node,u.offset)):(p.setEnd(u.node,u.offset),n.addRange(p))}}}var u=e(124),l=e(105),c=e(106),p=u.canUseDOM&&"selection"in document&&!("getSelection"in window),d={getOffsets:p?o:i,setOffsets:p?a:s};t.exports=d},{105:105,106:106,124:124}],42:[function(e,t,n){"use strict";var r=e(113),o=e(144),i=e(8),a=e(9),s=e(33),u=e(95),l=(e(138),e(119),function(e){this._currentElement=e,this._stringText=""+e,this._hostNode=null,this._hostParent=null,this._domID=0,this._mountIndex=0,this._closingComment=null,this._commentNodes=null});o(l.prototype,{mountComponent:function(e,t,n,r){var o=n._idCounter++,i=" react-text: "+o+" ";if(this._domID=o,this._hostParent=t,e.useCreateElement){var l=n._ownerDocument,c=l.createComment(i),p=l.createComment(" /react-text "),d=a(l.createDocumentFragment());return a.queueChild(d,a(c)),this._stringText&&a.queueChild(d,a(l.createTextNode(this._stringText))),a.queueChild(d,a(p)),s.precacheNode(this,c),this._closingComment=p,d}var f=u(this._stringText);return e.renderToStaticMarkup?f:"\x3c!--"+i+"--\x3e"+f+"\x3c!-- /react-text --\x3e"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;if(n!==this._stringText){this._stringText=n;var r=this.getHostNode();i.replaceDelimitedText(r[0],r[1],n)}}},getHostNode:function(){var e=this._commentNodes;if(e)return e;if(!this._closingComment)for(var t=s.getNodeFromInstance(this),n=t.nextSibling;;){if(null==n&&r("67",this._domID),8===n.nodeType&&" /react-text "===n.nodeValue){this._closingComment=n;break}n=n.nextSibling}return e=[this._hostNode,this._closingComment],this._commentNodes=e,e},unmountComponent:function(){this._closingComment=null,this._commentNodes=null,s.uncacheNode(this)}}),t.exports=l},{113:113,119:119,138:138,144:144,33:33,8:8,9:9,95:95}],43:[function(e,t,n){"use strict";function r(){this._rootNodeID&&c.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);return l.asap(r,this),n}var i=e(113),a=e(144),s=e(23),u=e(33),l=e(71),c=(e(138),e(143),{getHostProps:function(e,t){return null!=t.dangerouslySetInnerHTML&&i("91"),a({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue,onChange:e._wrapperState.onChange})},mountWrapper:function(e,t){var n=s.getValue(t),r=n;if(null==n){var a=t.defaultValue,u=t.children;null!=u&&(null!=a&&i("92"),Array.isArray(u)&&(u.length<=1||i("93"),u=u[0]),a=""+u),null==a&&(a=""),r=a}e._wrapperState={initialValue:""+r,listeners:null,onChange:o.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=u.getNodeFromInstance(e),r=s.getValue(t);if(null!=r){var o=""+r;o!==n.value&&(n.value=o),null==t.defaultValue&&(n.defaultValue=o)}null!=t.defaultValue&&(n.defaultValue=t.defaultValue)},postMountWrapper:function(e){var t=u.getNodeFromInstance(e),n=t.textContent;n===e._wrapperState.initialValue&&(t.value=n)}});t.exports=c},{113:113,138:138,143:143,144:144,23:23,33:33,71:71}],44:[function(e,t,n){"use strict";function r(e,t){"_hostNode"in e||u("33"),"_hostNode"in t||u("33");for(var n=0,r=e;r;r=r._hostParent)n++;for(var o=0,i=t;i;i=i._hostParent)o++;for(;n-o>0;)e=e._hostParent,n--;for(;o-n>0;)t=t._hostParent,o--;for(var a=n;a--;){if(e===t)return e;e=e._hostParent,t=t._hostParent}return null}function o(e,t){"_hostNode"in e||u("35"),"_hostNode"in t||u("35");for(;t;){if(t===e)return!0;t=t._hostParent}return!1}function i(e){return"_hostNode"in e||u("36"),e._hostParent}function a(e,t,n){for(var r=[];e;)r.push(e),e=e._hostParent;var o;for(o=r.length;o-- >0;)t(r[o],"captured",n);for(o=0;o<r.length;o++)t(r[o],"bubbled",n)}function s(e,t,n,o,i){for(var a=e&&t?r(e,t):null,s=[];e&&e!==a;)s.push(e),e=e._hostParent;for(var u=[];t&&t!==a;)u.push(t),t=t._hostParent;var l;for(l=0;l<s.length;l++)n(s[l],"bubbled",o);for(l=u.length;l-- >0;)n(u[l],"captured",i)}var u=e(113);e(138);t.exports={isAncestor:o,getLowestCommonAncestor:r,getParentInstance:i,traverseTwoPhase:a,traverseEnterLeave:s}},{113:113,138:138}],45:[function(e,t,n){"use strict";var r=e(121),o=e(30),i=o;r.addons&&(r.__SECRET_INJECTED_REACT_DOM_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=i),t.exports=i},{121:121,30:30}],46:[function(e,t,n){"use strict";function r(){this.reinitializeTransaction()}var o=e(144),i=e(71),a=e(89),s=e(130),u={initialize:s,close:function(){d.isBatchingUpdates=!1}},l={initialize:s,close:i.flushBatchedUpdates.bind(i)},c=[l,u];o(r.prototype,a,{getTransactionWrappers:function(){return c}});var p=new r,d={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,r,o,i){var a=d.isBatchingUpdates;return d.isBatchingUpdates=!0,a?e(t,n,r,o,i):p.perform(e,null,t,n,r,o,i)}};t.exports=d},{130:130,144:144,71:71,89:89}],47:[function(e,t,n){"use strict";function r(){x||(x=!0,y.EventEmitter.injectReactEventListener(g),y.EventPluginHub.injectEventPluginOrder(s),y.EventPluginUtils.injectComponentTree(d),y.EventPluginUtils.injectTreeTraversal(h),y.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:E,EnterLeaveEventPlugin:u,ChangeEventPlugin:a,SelectEventPlugin:b,BeforeInputEventPlugin:i}),y.HostComponent.injectGenericComponentClass(p),y.HostComponent.injectTextComponentClass(m),y.DOMProperty.injectDOMPropertyConfig(o),y.DOMProperty.injectDOMPropertyConfig(l),y.DOMProperty.injectDOMPropertyConfig(C),y.EmptyComponent.injectEmptyComponentFactory(function(e){return new f(e)}),y.Updates.injectReconcileTransaction(_),y.Updates.injectBatchingStrategy(v),y.Component.injectEnvironment(c))}var o=e(1),i=e(3),a=e(7),s=e(14),u=e(15),l=e(21),c=e(27),p=e(31),d=e(33),f=e(35),h=e(44),m=e(42),v=e(46),g=e(52),y=e(55),_=e(65),C=e(73),b=e(74),E=e(75),x=!1;t.exports={inject:r}},{1:1,14:14,15:15,21:21,27:27,3:3,31:31,33:33,35:35,42:42,44:44,46:46,52:52,55:55,65:65,7:7,73:73,74:74,75:75}],48:[function(e,t,n){"use strict";var r="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103;t.exports=r},{}],49:[function(e,t,n){"use strict";var r,o={injectEmptyComponentFactory:function(e){r=e}},i={create:function(e){return r(e)}};i.injection=o,t.exports=i},{}],50:[function(e,t,n){"use strict";function r(e,t,n){try{t(n)}catch(e){null===o&&(o=e)}}var o=null,i={invokeGuardedCallback:r,invokeGuardedCallbackWithCatch:r,rethrowCaughtError:function(){if(o){var e=o;throw o=null,e}}};t.exports=i},{}],51:[function(e,t,n){"use strict";function r(e){o.enqueueEvents(e),o.processEventQueue(!1)}var o=e(16),i={handleTopLevel:function(e,t,n,i){r(o.extractEvents(e,t,n,i))}};t.exports=i},{16:16}],52:[function(e,t,n){"use strict";function r(e){for(;e._hostParent;)e=e._hostParent;var t=p.getNodeFromInstance(e),n=t.parentNode;return p.getClosestInstanceFromNode(n)}function o(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function i(e){var t=f(e.nativeEvent),n=p.getClosestInstanceFromNode(t),o=n;do{e.ancestors.push(o),o=o&&r(o)}while(o);for(var i=0;i<e.ancestors.length;i++)n=e.ancestors[i],m._handleTopLevel(e.topLevelType,n,e.nativeEvent,f(e.nativeEvent))}function a(e){e(h(window))}var s=e(144),u=e(123),l=e(124),c=e(24),p=e(33),d=e(71),f=e(102),h=e(135);s(o.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),c.addPoolingTo(o,c.twoArgumentPooler);var m={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:l.canUseDOM?window:null,setHandleTopLevel:function(e){m._handleTopLevel=e},setEnabled:function(e){m._enabled=!!e},isEnabled:function(){return m._enabled},trapBubbledEvent:function(e,t,n){return n?u.listen(n,t,m.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){return n?u.capture(n,t,m.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=a.bind(null,e);u.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(m._enabled){var n=o.getPooled(e,t);try{d.batchedUpdates(i,n)}finally{o.release(n)}}}};t.exports=m},{102:102,123:123,124:124,135:135,144:144,24:24,33:33,71:71}],53:[function(e,t,n){"use strict";var r={logTopLevelRenders:!1};t.exports=r},{}],54:[function(e,t,n){"use strict";function r(e){return s||a("111",e.type),new s(e)}function o(e){return new u(e)}function i(e){return e instanceof u}var a=e(113),s=(e(138),null),u=null,l={injectGenericComponentClass:function(e){s=e},injectTextComponentClass:function(e){u=e}},c={createInternalComponent:r,createInstanceForText:o,isTextComponent:i,injection:l};t.exports=c},{113:113,138:138}],55:[function(e,t,n){"use strict";var r=e(11),o=e(16),i=e(18),a=e(28),s=e(49),u=e(25),l=e(54),c=e(71),p={Component:a.injection,DOMProperty:r.injection,EmptyComponent:s.injection,EventPluginHub:o.injection,EventPluginUtils:i.injection,EventEmitter:u.injection,HostComponent:l.injection,Updates:c.injection};t.exports=p},{11:11,16:16,18:18,25:25,28:28,49:49,54:54,71:71}],56:[function(e,t,n){"use strict";function r(e){return i(document.documentElement,e)}var o=e(41),i=e(127),a=e(132),s=e(133),u={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=s();return{focusedElem:e,selectionRange:u.hasSelectionCapabilities(e)?u.getSelection(e):null}},restoreSelection:function(e){var t=s(),n=e.focusedElem,o=e.selectionRange;t!==n&&r(n)&&(u.hasSelectionCapabilities(n)&&u.setSelection(n,o),a(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=o.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,r=t.end;if(void 0===r&&(r=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(r,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var i=e.createTextRange();i.collapse(!0),i.moveStart("character",n),i.moveEnd("character",r-n),i.select()}else o.setOffsets(e,t)}};t.exports=u},{127:127,132:132,133:133,41:41}],57:[function(e,t,n){"use strict";var r={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};t.exports=r},{}],58:[function(e,t,n){"use strict";t.exports={debugTool:null}},{}],59:[function(e,t,n){"use strict";var r=e(92),o=/\/?>/,i=/^<\!\-\-/,a={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=r(e);return i.test(e)?e:e.replace(o," "+a.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var n=t.getAttribute(a.CHECKSUM_ATTR_NAME);return n=n&&parseInt(n,10),r(e)===n}};t.exports=a},{92:92}],60:[function(e,t,n){"use strict";function r(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++)if(e.charAt(r)!==t.charAt(r))return r;return e.length===t.length?-1:n}function o(e){return e?e.nodeType===A?e.documentElement:e.firstChild:null}function i(e){return e.getAttribute&&e.getAttribute(I)||""}function a(e,t,n,r,o){var i;if(b.logTopLevelRenders){var a=e._currentElement.props.child,s=a.type;i="React mount: "+("string"==typeof s?s:s.displayName||s.name),console.time(i)}var u=w.mountComponent(e,n,null,_(e,t),o,0);i&&console.timeEnd(i),e._renderedComponent._topLevelWrapper=e,V._mountImageIntoNode(u,t,e,r,n)}function s(e,t,n,r){var o=k.ReactReconcileTransaction.getPooled(!n&&C.useCreateElement);o.perform(a,null,e,t,o,n,r),k.ReactReconcileTransaction.release(o)}function u(e,t,n){for(w.unmountComponent(e,n),t.nodeType===A&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function l(e){var t=o(e);if(t){var n=y.getInstanceFromNode(t);return!(!n||!n._hostParent)}}function c(e){return!(!e||e.nodeType!==R&&e.nodeType!==A&&e.nodeType!==D)}function p(e){var t=o(e),n=t&&y.getInstanceFromNode(t);return n&&!n._hostParent?n:null}function d(e){var t=p(e);return t?t._hostContainerInfo._topLevelWrapper:null}var f=e(113),h=e(9),m=e(11),v=e(121),g=e(25),y=(e(120),e(33)),_=e(34),C=e(36),b=e(53),E=e(57),x=(e(58),e(59)),w=e(66),T=e(70),k=e(71),P=e(131),S=e(109),N=(e(138),e(115)),M=e(117),I=(e(143),m.ID_ATTRIBUTE_NAME),O=m.ROOT_ATTRIBUTE_NAME,R=1,A=9,D=11,L={},U=1,F=function(){this.rootID=U++};F.prototype.isReactComponent={},F.prototype.render=function(){return this.props.child},F.isReactTopLevelWrapper=!0;var V={TopLevelWrapper:F,_instancesByReactRootID:L,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,r,o){return V.scrollMonitor(r,function(){T.enqueueElementInternal(e,t,n),o&&T.enqueueCallbackInternal(e,o)}),e},_renderNewRootComponent:function(e,t,n,r){c(t)||f("37"),g.ensureScrollValueMonitoring();var o=S(e,!1);k.batchedUpdates(s,o,t,n,r);var i=o._instance.rootID;return L[i]=o,o},renderSubtreeIntoContainer:function(e,t,n,r){return null!=e&&E.has(e)||f("38"),V._renderSubtreeIntoContainer(e,t,n,r)},_renderSubtreeIntoContainer:function(e,t,n,r){T.validateCallback(r,"ReactDOM.render"),v.isValidElement(t)||f("39","string"==typeof t?" Instead of passing a string like 'div', pass React.createElement('div') or <div />.":"function"==typeof t?" Instead of passing a class like Foo, pass React.createElement(Foo) or <Foo />.":null!=t&&void 0!==t.props?" This may be caused by unintentionally loading two independent copies of React.":"");var a,s=v.createElement(F,{child:t});if(e){var u=E.get(e);a=u._processChildContext(u._context)}else a=P;var c=d(n);if(c){var p=c._currentElement,h=p.props.child;if(M(h,t)){var m=c._renderedComponent.getPublicInstance(),g=r&&function(){r.call(m)};return V._updateRootComponent(c,s,a,n,g),m}V.unmountComponentAtNode(n)}var y=o(n),_=y&&!!i(y),C=l(n),b=_&&!c&&!C,x=V._renderNewRootComponent(s,n,b,a)._renderedComponent.getPublicInstance();return r&&r.call(x),x},render:function(e,t,n){return V._renderSubtreeIntoContainer(null,e,t,n)},unmountComponentAtNode:function(e){c(e)||f("40");var t=d(e);return t?(delete L[t._instance.rootID],k.batchedUpdates(u,t,e,!1),!0):(l(e),1===e.nodeType&&e.hasAttribute(O),!1)},_mountImageIntoNode:function(e,t,n,i,a){if(c(t)||f("41"),i){var s=o(t);if(x.canReuseMarkup(e,s))return void y.precacheNode(n,s);var u=s.getAttribute(x.CHECKSUM_ATTR_NAME);s.removeAttribute(x.CHECKSUM_ATTR_NAME);var l=s.outerHTML;s.setAttribute(x.CHECKSUM_ATTR_NAME,u);var p=e,d=r(p,l),m=" (client) "+p.substring(d-20,d+20)+"\n (server) "+l.substring(d-20,d+20);t.nodeType===A&&f("42",m)}if(t.nodeType===A&&f("43"),a.useCreateElement){for(;t.lastChild;)t.removeChild(t.lastChild);h.insertTreeBefore(t,e,null)}else N(t,e),y.precacheNode(n,t.firstChild)}};t.exports=V},{109:109,11:11,113:113,115:115,117:117,120:120,121:121,131:131,138:138,143:143,25:25,33:33,34:34,36:36,53:53,57:57,58:58,59:59,66:66,70:70,71:71,9:9}],61:[function(e,t,n){"use strict";function r(e,t,n){return{type:"INSERT_MARKUP",content:e,fromIndex:null,fromNode:null,toIndex:n,afterNode:t}}function o(e,t,n){return{type:"MOVE_EXISTING",content:null,fromIndex:e._mountIndex,fromNode:d.getHostNode(e),toIndex:n,afterNode:t}}function i(e,t){return{type:"REMOVE_NODE",content:null,fromIndex:e._mountIndex,fromNode:t,toIndex:null,afterNode:null}}function a(e){return{type:"SET_MARKUP",content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function s(e){return{type:"TEXT_CONTENT",content:e,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function u(e,t){return t&&(e=e||[],e.push(t)),e}function l(e,t){p.processChildrenUpdates(e,t)}var c=e(113),p=e(28),d=(e(57),e(58),e(120),e(66)),f=e(26),h=(e(130),e(97)),m=(e(138),{Mixin:{_reconcilerInstantiateChildren:function(e,t,n){return f.instantiateChildren(e,t,n)},_reconcilerUpdateChildren:function(e,t,n,r,o,i){var a;return a=h(t,0),f.updateChildren(e,a,n,r,o,this,this._hostContainerInfo,i,0),a},mountChildren:function(e,t,n){var r=this._reconcilerInstantiateChildren(e,t,n);this._renderedChildren=r;var o=[],i=0;for(var a in r)if(r.hasOwnProperty(a)){var s=r[a],u=d.mountComponent(s,t,this,this._hostContainerInfo,n,0);s._mountIndex=i++,o.push(u)}return o},updateTextContent:function(e){var t=this._renderedChildren;f.unmountChildren(t,!1);for(var n in t)t.hasOwnProperty(n)&&c("118");l(this,[s(e)])},updateMarkup:function(e){var t=this._renderedChildren;f.unmountChildren(t,!1);for(var n in t)t.hasOwnProperty(n)&&c("118");l(this,[a(e)])},updateChildren:function(e,t,n){this._updateChildren(e,t,n)},_updateChildren:function(e,t,n){var r=this._renderedChildren,o={},i=[],a=this._reconcilerUpdateChildren(r,e,i,o,t,n);if(a||r){var s,c=null,p=0,f=0,h=0,m=null;for(s in a)if(a.hasOwnProperty(s)){var v=r&&r[s],g=a[s];v===g?(c=u(c,this.moveChild(v,m,p,f)),f=Math.max(v._mountIndex,f),v._mountIndex=p):(v&&(f=Math.max(v._mountIndex,f)),c=u(c,this._mountChildAtIndex(g,i[h],m,p,t,n)),h++),p++,m=d.getHostNode(g)}for(s in o)o.hasOwnProperty(s)&&(c=u(c,this._unmountChild(r[s],o[s])));c&&l(this,c),this._renderedChildren=a}},unmountChildren:function(e){var t=this._renderedChildren;f.unmountChildren(t,e),this._renderedChildren=null},moveChild:function(e,t,n,r){if(e._mountIndex<r)return o(e,t,n)},createChild:function(e,t,n){return r(n,t,e._mountIndex)},removeChild:function(e,t){return i(e,t)},_mountChildAtIndex:function(e,t,n,r,o,i){return e._mountIndex=r,this.createChild(e,n,t)},_unmountChild:function(e,t){var n=this.removeChild(e,t);return e._mountIndex=null,n}}});t.exports=m},{113:113,120:120,130:130,138:138,26:26,28:28,57:57,58:58,66:66,97:97}],62:[function(e,t,n){"use strict";var r=e(113),o=e(121),i=(e(138),{HOST:0,COMPOSITE:1,EMPTY:2,getType:function(e){return null===e||!1===e?i.EMPTY:o.isValidElement(e)?"function"==typeof e.type?i.COMPOSITE:i.HOST:void r("26",e)}});t.exports=i},{113:113,121:121,138:138}],63:[function(e,t,n){"use strict";function r(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)}var o=e(113),i=(e(138),{addComponentAsRefTo:function(e,t,n){r(n)||o("119"),n.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,n){r(n)||o("120");var i=n.getPublicInstance();i&&i.refs[t]===e.getPublicInstance()&&n.detachRef(t)}});t.exports=i},{113:113,138:138}],64:[function(e,t,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}],65:[function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=i.getPooled(null),this.useCreateElement=e}var o=e(144),i=e(6),a=e(24),s=e(25),u=e(56),l=(e(58),e(89)),c=e(70),p={initialize:u.getSelectionInformation,close:u.restoreSelection},d={initialize:function(){var e=s.isEnabled();return s.setEnabled(!1),e},close:function(e){s.setEnabled(e)}},f={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},h=[p,d,f],m={getTransactionWrappers:function(){return h},getReactMountReady:function(){return this.reactMountReady},getUpdateQueue:function(){return c},checkpoint:function(){return this.reactMountReady.checkpoint()},rollback:function(e){this.reactMountReady.rollback(e)},destructor:function(){i.release(this.reactMountReady),this.reactMountReady=null}};o(r.prototype,l,m),a.addPoolingTo(r),t.exports=r},{144:144,24:24,25:25,56:56,58:58,6:6,70:70,89:89}],66:[function(e,t,n){"use strict";function r(){o.attachRefs(this,this._currentElement)}var o=e(67),i=(e(58),e(143),{mountComponent:function(e,t,n,o,i,a){var s=e.mountComponent(t,n,o,i,a);return e._currentElement&&null!=e._currentElement.ref&&t.getReactMountReady().enqueue(r,e),s},getHostNode:function(e){return e.getHostNode()},unmountComponent:function(e,t){o.detachRefs(e,e._currentElement),e.unmountComponent(t)},receiveComponent:function(e,t,n,i){var a=e._currentElement;if(t!==a||i!==e._context){var s=o.shouldUpdateRefs(a,t);s&&o.detachRefs(e,a),e.receiveComponent(t,n,i),s&&e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e)}},performUpdateIfNecessary:function(e,t,n){e._updateBatchNumber===n&&e.performUpdateIfNecessary(t)}});t.exports=i},{143:143,58:58,67:67}],67:[function(e,t,n){"use strict";function r(e,t,n){"function"==typeof e?e(t.getPublicInstance()):i.addComponentAsRefTo(t,e,n)}function o(e,t,n){"function"==typeof e?e(null):i.removeComponentAsRefFrom(t,e,n)}var i=e(63),a={};a.attachRefs=function(e,t){if(null!==t&&"object"==typeof t){var n=t.ref;null!=n&&r(n,e,t._owner)}},a.shouldUpdateRefs=function(e,t){var n=null,r=null;null!==e&&"object"==typeof e&&(n=e.ref,r=e._owner);var o=null,i=null;return null!==t&&"object"==typeof t&&(o=t.ref,i=t._owner),n!==o||"string"==typeof o&&i!==r},a.detachRefs=function(e,t){if(null!==t&&"object"==typeof t){var n=t.ref;null!=n&&o(n,e,t._owner)}},t.exports=a},{63:63}],68:[function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.useCreateElement=!1,this.updateQueue=new s(this)}var o=e(144),i=e(24),a=e(89),s=(e(58),e(69)),u=[],l={enqueue:function(){}},c={getTransactionWrappers:function(){return u},getReactMountReady:function(){return l},getUpdateQueue:function(){return this.updateQueue},destructor:function(){},checkpoint:function(){},rollback:function(){}};o(r.prototype,a,c),i.addPoolingTo(r),t.exports=r},{144:144,24:24,58:58,69:69,89:89}],69:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=e(70),i=(e(143),function(){function e(t){r(this,e),this.transaction=t}return e.prototype.isMounted=function(e){return!1},e.prototype.enqueueCallback=function(e,t,n){this.transaction.isInTransaction()&&o.enqueueCallback(e,t,n)},e.prototype.enqueueForceUpdate=function(e){this.transaction.isInTransaction()&&o.enqueueForceUpdate(e)},e.prototype.enqueueReplaceState=function(e,t){this.transaction.isInTransaction()&&o.enqueueReplaceState(e,t)},e.prototype.enqueueSetState=function(e,t){this.transaction.isInTransaction()&&o.enqueueSetState(e,t)},e}());t.exports=i},{143:143,70:70}],70:[function(e,t,n){"use strict";function r(e){u.enqueueUpdate(e)}function o(e){var t=typeof e;if("object"!==t)return t;var n=e.constructor&&e.constructor.name||t,r=Object.keys(e);return r.length>0&&r.length<20?n+" (keys: "+r.join(", ")+")":n}function i(e,t){var n=s.get(e);return n||null}var a=e(113),s=(e(120),e(57)),u=(e(58),e(71)),l=(e(138),e(143),{isMounted:function(e){var t=s.get(e);return!!t&&!!t._renderedComponent},enqueueCallback:function(e,t,n){l.validateCallback(t,n);var o=i(e);if(!o)return null;o._pendingCallbacks?o._pendingCallbacks.push(t):o._pendingCallbacks=[t],r(o)},enqueueCallbackInternal:function(e,t){e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],r(e)},enqueueForceUpdate:function(e){var t=i(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,r(t))},enqueueReplaceState:function(e,t,n){var o=i(e,"replaceState");o&&(o._pendingStateQueue=[t],o._pendingReplaceState=!0,void 0!==n&&null!==n&&(l.validateCallback(n,"replaceState"),o._pendingCallbacks?o._pendingCallbacks.push(n):o._pendingCallbacks=[n]),r(o))},enqueueSetState:function(e,t){var n=i(e,"setState");n&&((n._pendingStateQueue||(n._pendingStateQueue=[])).push(t),r(n))},enqueueElementInternal:function(e,t,n){e._pendingElement=t,e._context=n,r(e)},validateCallback:function(e,t){e&&"function"!=typeof e&&a("122",t,o(e))}});t.exports=l},{113:113,120:120,138:138,143:143,57:57,58:58,71:71}],71:[function(e,t,n){"use strict";function r(){P.ReactReconcileTransaction&&b||c("123")}function o(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=d.getPooled(),this.reconcileTransaction=P.ReactReconcileTransaction.getPooled(!0)}function i(e,t,n,o,i,a){return r(),b.batchedUpdates(e,t,n,o,i,a)}function a(e,t){return e._mountOrder-t._mountOrder}function s(e){var t=e.dirtyComponentsLength;t!==g.length&&c("124",t,g.length),g.sort(a),y++;for(var n=0;n<t;n++){var r=g[n],o=r._pendingCallbacks;r._pendingCallbacks=null;var i;if(h.logTopLevelRenders){var s=r;r._currentElement.type.isReactTopLevelWrapper&&(s=r._renderedComponent),i="React update: "+s.getName(),console.time(i)}if(m.performUpdateIfNecessary(r,e.reconcileTransaction,y),i&&console.timeEnd(i),o)for(var u=0;u<o.length;u++)e.callbackQueue.enqueue(o[u],r.getPublicInstance())}}function u(e){if(r(),!b.isBatchingUpdates)return void b.batchedUpdates(u,e);g.push(e),null==e._updateBatchNumber&&(e._updateBatchNumber=y+1)}function l(e,t){b.isBatchingUpdates||c("125"),_.enqueue(e,t),C=!0}var c=e(113),p=e(144),d=e(6),f=e(24),h=e(53),m=e(66),v=e(89),g=(e(138),[]),y=0,_=d.getPooled(),C=!1,b=null,E={initialize:function(){this.dirtyComponentsLength=g.length},close:function(){this.dirtyComponentsLength!==g.length?(g.splice(0,this.dirtyComponentsLength),T()):g.length=0}},x={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},w=[E,x];p(o.prototype,v,{getTransactionWrappers:function(){return w},destructor:function(){this.dirtyComponentsLength=null,d.release(this.callbackQueue),this.callbackQueue=null,P.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return v.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)}}),f.addPoolingTo(o);var T=function(){for(;g.length||C;){if(g.length){var e=o.getPooled();e.perform(s,null,e),o.release(e)}if(C){C=!1;var t=_;_=d.getPooled(),t.notifyAll(),d.release(t)}}},k={injectReconcileTransaction:function(e){e||c("126"),P.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e||c("127"),"function"!=typeof e.batchedUpdates&&c("128"),"boolean"!=typeof e.isBatchingUpdates&&c("129"),b=e}},P={ReactReconcileTransaction:null,batchedUpdates:i,enqueueUpdate:u,flushBatchedUpdates:T,injection:k,asap:l};t.exports=P},{113:113,138:138,144:144,24:24,53:53,6:6,66:66,89:89}],72:[function(e,t,n){"use strict";t.exports="15.6.1"},{}],73:[function(e,t,n){"use strict";var r={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},o={accentHeight:"accent-height",accumulate:0,additive:0,alignmentBaseline:"alignment-baseline",allowReorder:"allowReorder",alphabetic:0,amplitude:0,arabicForm:"arabic-form",ascent:0,attributeName:"attributeName",attributeType:"attributeType",autoReverse:"autoReverse",azimuth:0,baseFrequency:"baseFrequency",baseProfile:"baseProfile",baselineShift:"baseline-shift",bbox:0,begin:0,bias:0,by:0,calcMode:"calcMode",capHeight:"cap-height",clip:0,clipPath:"clip-path",clipRule:"clip-rule",clipPathUnits:"clipPathUnits",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",contentScriptType:"contentScriptType",contentStyleType:"contentStyleType",cursor:0,cx:0,cy:0,d:0,decelerate:0,descent:0,diffuseConstant:"diffuseConstant",direction:0,display:0,divisor:0,dominantBaseline:"dominant-baseline",dur:0,dx:0,dy:0,edgeMode:"edgeMode",elevation:0,enableBackground:"enable-background",end:0,exponent:0,externalResourcesRequired:"externalResourcesRequired",fill:0,fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:0,filterRes:"filterRes",filterUnits:"filterUnits",floodColor:"flood-color",floodOpacity:"flood-opacity",focusable:0,fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",glyphRef:"glyphRef",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",hanging:0,horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",ideographic:0,imageRendering:"image-rendering",in:0,in2:0,intercept:0,k:0,k1:0,k2:0,k3:0,k4:0,kernelMatrix:"kernelMatrix",kernelUnitLength:"kernelUnitLength",kerning:0,keyPoints:"keyPoints",keySplines:"keySplines",keyTimes:"keyTimes",lengthAdjust:"lengthAdjust",letterSpacing:"letter-spacing",lightingColor:"lighting-color",limitingConeAngle:"limitingConeAngle",local:0,markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",markerHeight:"markerHeight",markerUnits:"markerUnits",markerWidth:"markerWidth",mask:0,maskContentUnits:"maskContentUnits",maskUnits:"maskUnits",mathematical:0,mode:0,numOctaves:"numOctaves",offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pathLength:"pathLength",patternContentUnits:"patternContentUnits",patternTransform:"patternTransform",patternUnits:"patternUnits",pointerEvents:"pointer-events",points:0,pointsAtX:"pointsAtX",pointsAtY:"pointsAtY",pointsAtZ:"pointsAtZ",preserveAlpha:"preserveAlpha",preserveAspectRatio:"preserveAspectRatio",primitiveUnits:"primitiveUnits",r:0,radius:0,refX:"refX",refY:"refY",renderingIntent:"rendering-intent",repeatCount:"repeatCount",repeatDur:"repeatDur",requiredExtensions:"requiredExtensions",requiredFeatures:"requiredFeatures",restart:0,result:0,rotate:0,rx:0,ry:0,scale:0,seed:0,shapeRendering:"shape-rendering",slope:0,spacing:0,specularConstant:"specularConstant",specularExponent:"specularExponent",speed:0,spreadMethod:"spreadMethod",startOffset:"startOffset",stdDeviation:"stdDeviation",stemh:0,stemv:0,stitchTiles:"stitchTiles",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",string:0,stroke:0,strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",surfaceScale:"surfaceScale",systemLanguage:"systemLanguage",tableValues:"tableValues",targetX:"targetX",targetY:"targetY",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",textLength:"textLength",to:0,transform:0,u1:0,u2:0,underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicode:0,unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",values:0,vectorEffect:"vector-effect",version:0,vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",viewBox:"viewBox",viewTarget:"viewTarget",visibility:0,widths:0,wordSpacing:"word-spacing",writingMode:"writing-mode",x:0,xHeight:"x-height",x1:0,x2:0,xChannelSelector:"xChannelSelector",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlns:0,xmlnsXlink:"xmlns:xlink",xmlLang:"xml:lang",xmlSpace:"xml:space",y:0,y1:0,y2:0,yChannelSelector:"yChannelSelector",z:0,zoomAndPan:"zoomAndPan"},i={Properties:{},DOMAttributeNamespaces:{xlinkActuate:r.xlink,xlinkArcrole:r.xlink,xlinkHref:r.xlink,xlinkRole:r.xlink,xlinkShow:r.xlink,xlinkTitle:r.xlink,xlinkType:r.xlink,xmlBase:r.xml,xmlLang:r.xml,xmlSpace:r.xml},DOMAttributeNames:{}};Object.keys(o).forEach(function(e){i.Properties[e]=0,o[e]&&(i.DOMAttributeNames[e]=o[e])}),t.exports=i},{}],74:[function(e,t,n){"use strict";function r(e){if("selectionStart"in e&&u.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}function o(e,t){if(y||null==m||m!==c())return null;var n=r(m);if(!g||!d(g,n)){g=n;var o=l.getPooled(h.select,v,e,t);return o.type="select",o.target=m,i.accumulateTwoPhaseDispatches(o),o}return null}var i=e(19),a=e(124),s=e(33),u=e(56),l=e(80),c=e(133),p=e(111),d=e(142),f=a.canUseDOM&&"documentMode"in document&&document.documentMode<=11,h={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:["topBlur","topContextMenu","topFocus","topKeyDown","topKeyUp","topMouseDown","topMouseUp","topSelectionChange"]}},m=null,v=null,g=null,y=!1,_=!1,C={eventTypes:h,extractEvents:function(e,t,n,r){if(!_)return null;var i=t?s.getNodeFromInstance(t):window;switch(e){case"topFocus":(p(i)||"true"===i.contentEditable)&&(m=i,v=t,g=null);break;case"topBlur":m=null,v=null,g=null;break;case"topMouseDown":y=!0;break;case"topContextMenu":case"topMouseUp":return y=!1,o(n,r);case"topSelectionChange":if(f)break;case"topKeyDown":case"topKeyUp":return o(n,r)}return null},didPutListener:function(e,t,n){"onSelect"===t&&(_=!0)}};t.exports=C},{111:111,124:124,133:133,142:142,19:19,33:33,56:56,80:80}],75:[function(e,t,n){"use strict";function r(e){return"."+e._rootNodeID}function o(e){return"button"===e||"input"===e||"select"===e||"textarea"===e}var i=e(113),a=e(123),s=e(19),u=e(33),l=e(76),c=e(77),p=e(80),d=e(81),f=e(83),h=e(84),m=e(79),v=e(85),g=e(86),y=e(87),_=e(88),C=e(130),b=e(99),E=(e(138),{}),x={};["abort","animationEnd","animationIteration","animationStart","blur","canPlay","canPlayThrough","click","contextMenu","copy","cut","doubleClick","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","focus","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","progress","rateChange","reset","scroll","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchMove","touchStart","transitionEnd","volumeChange","waiting","wheel"].forEach(function(e){var t=e[0].toUpperCase()+e.slice(1),n="on"+t,r="top"+t,o={phasedRegistrationNames:{bubbled:n,captured:n+"Capture"},dependencies:[r]};E[e]=o,x[r]=o});var w={},T={eventTypes:E,extractEvents:function(e,t,n,r){var o=x[e];if(!o)return null;var a;switch(e){case"topAbort":case"topCanPlay":case"topCanPlayThrough":case"topDurationChange":case"topEmptied":case"topEncrypted":case"topEnded":case"topError":case"topInput":case"topInvalid":case"topLoad":case"topLoadedData":case"topLoadedMetadata":case"topLoadStart":case"topPause":case"topPlay":case"topPlaying":case"topProgress":case"topRateChange":case"topReset":case"topSeeked":case"topSeeking":case"topStalled":case"topSubmit":case"topSuspend":case"topTimeUpdate":case"topVolumeChange":case"topWaiting":a=p;break;case"topKeyPress":if(0===b(n))return null;case"topKeyDown":case"topKeyUp":a=f;break;case"topBlur":case"topFocus":a=d;break;case"topClick":if(2===n.button)return null;case"topDoubleClick":case"topMouseDown":case"topMouseMove":case"topMouseUp":case"topMouseOut":case"topMouseOver":case"topContextMenu":a=h;break;case"topDrag":case"topDragEnd":case"topDragEnter":case"topDragExit":case"topDragLeave":case"topDragOver":case"topDragStart":case"topDrop":a=m;break;case"topTouchCancel":case"topTouchEnd":case"topTouchMove":case"topTouchStart":a=v;break;case"topAnimationEnd":case"topAnimationIteration":case"topAnimationStart":a=l;break;case"topTransitionEnd":a=g;break;case"topScroll":a=y;break;case"topWheel":a=_;break;case"topCopy":case"topCut":case"topPaste":a=c}a||i("86",e);var u=a.getPooled(o,t,n,r);return s.accumulateTwoPhaseDispatches(u),u},didPutListener:function(e,t,n){if("onClick"===t&&!o(e._tag)){var i=r(e),s=u.getNodeFromInstance(e);w[i]||(w[i]=a.listen(s,"click",C))}},willDeleteListener:function(e,t){if("onClick"===t&&!o(e._tag)){var n=r(e);w[n].remove(),delete w[n]}}};t.exports=T},{113:113,123:123,130:130,138:138,19:19,33:33,76:76,77:77,79:79,80:80,81:81,83:83,84:84,85:85,86:86,87:87,88:88,99:99}],76:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(80),i={animationName:null,elapsedTime:null,pseudoElement:null};o.augmentClass(r,i),t.exports=r},{80:80}],77:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(80),i={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};o.augmentClass(r,i),t.exports=r},{80:80}],78:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(80),i={data:null};o.augmentClass(r,i),t.exports=r},{80:80}],79:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(84),i={dataTransfer:null};o.augmentClass(r,i),t.exports=r},{84:84}],80:[function(e,t,n){"use strict";function r(e,t,n,r){this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n;var o=this.constructor.Interface;for(var i in o)if(o.hasOwnProperty(i)){var s=o[i];s?this[i]=s(n):"target"===i?this.target=r:this[i]=n[i]}var u=null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue;return this.isDefaultPrevented=u?a.thatReturnsTrue:a.thatReturnsFalse,this.isPropagationStopped=a.thatReturnsFalse,this}var o=e(144),i=e(24),a=e(130),s=(e(143),["dispatchConfig","_targetInst","nativeEvent","isDefaultPrevented","isPropagationStopped","_dispatchListeners","_dispatchInstances"]),u={type:null,target:null,currentTarget:a.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};o(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=a.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=a.thatReturnsTrue)},persist:function(){this.isPersistent=a.thatReturnsTrue},isPersistent:a.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;for(var n=0;n<s.length;n++)this[s[n]]=null}}),r.Interface=u,r.augmentClass=function(e,t){var n=this,r=function(){};r.prototype=n.prototype;var a=new r;o(a,e.prototype),e.prototype=a,e.prototype.constructor=e,e.Interface=o({},n.Interface,t),e.augmentClass=n.augmentClass,i.addPoolingTo(e,i.fourArgumentPooler)},i.addPoolingTo(r,i.fourArgumentPooler),t.exports=r},{130:130,143:143,144:144,24:24}],81:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(87),i={relatedTarget:null};o.augmentClass(r,i),t.exports=r},{87:87}],82:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(80),i={data:null};o.augmentClass(r,i),t.exports=r},{80:80}],83:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(87),i=e(99),a=e(100),s=e(101),u={key:a,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:s,charCode:function(e){return"keypress"===e.type?i(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?i(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};o.augmentClass(r,u),t.exports=r},{100:100,101:101,87:87,99:99}],84:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(87),i=e(90),a=e(101),s={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:a,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+i.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+i.currentScrollTop}};o.augmentClass(r,s),t.exports=r},{101:101,87:87,90:90}],85:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(87),i=e(101),a={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:i};o.augmentClass(r,a),t.exports=r},{101:101,87:87}],86:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(80),i={propertyName:null,elapsedTime:null,pseudoElement:null};o.augmentClass(r,i),t.exports=r},{80:80}],87:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(80),i=e(102),a={view:function(e){if(e.view)return e.view;var t=i(e);if(t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};o.augmentClass(r,a),t.exports=r},{102:102,80:80}],88:[function(e,t,n){"use strict";function r(e,t,n,r){return o.call(this,e,t,n,r)}var o=e(84),i={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};o.augmentClass(r,i),t.exports=r},{84:84}],89:[function(e,t,n){"use strict";var r=e(113),o=(e(138),{}),i={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,n,o,i,a,s,u){this.isInTransaction()&&r("27");var l,c;try{this._isInTransaction=!0,l=!0,this.initializeAll(0),c=e.call(t,n,o,i,a,s,u),l=!1}finally{try{if(l)try{this.closeAll(0)}catch(e){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return c},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var r=t[n];try{this.wrapperInitData[n]=o,this.wrapperInitData[n]=r.initialize?r.initialize.call(this):null}finally{if(this.wrapperInitData[n]===o)try{this.initializeAll(n+1)}catch(e){}}}},closeAll:function(e){this.isInTransaction()||r("28");for(var t=this.transactionWrappers,n=e;n<t.length;n++){var i,a=t[n],s=this.wrapperInitData[n];try{i=!0,s!==o&&a.close&&a.close.call(this,s),i=!1}finally{if(i)try{this.closeAll(n+1)}catch(e){}}}this.wrapperInitData.length=0}};t.exports=i},{113:113,138:138}],90:[function(e,t,n){"use strict";var r={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){r.currentScrollLeft=e.x,r.currentScrollTop=e.y}};t.exports=r},{}],91:[function(e,t,n){"use strict";function r(e,t){return null==t&&o("30"),null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}var o=e(113);e(138);t.exports=r},{113:113,138:138}],92:[function(e,t,n){"use strict";function r(e){for(var t=1,n=0,r=0,i=e.length,a=-4&i;r<a;){for(var s=Math.min(r+4096,a);r<s;r+=4)n+=(t+=e.charCodeAt(r))+(t+=e.charCodeAt(r+1))+(t+=e.charCodeAt(r+2))+(t+=e.charCodeAt(r+3));t%=o,n%=o}for(;r<i;r++)n+=t+=e.charCodeAt(r);return t%=o,n%=o,t|n<<16}var o=65521;t.exports=r},{}],93:[function(e,t,n){"use strict";var r=function(e){return"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,o){MSApp.execUnsafeLocalFunction(function(){return e(t,n,r,o)})}:e};t.exports=r},{}],94:[function(e,t,n){"use strict";function r(e,t,n,r){if(null==t||"boolean"==typeof t||""===t)return"";var o=isNaN(t);return r||o||0===t||i.hasOwnProperty(e)&&i[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var o=e(4),i=(e(143),o.isUnitlessNumber);t.exports=r},{143:143,4:4}],95:[function(e,t,n){"use strict";function r(e){var t=""+e,n=i.exec(t);if(!n)return t;var r,o="",a=0,s=0;for(a=n.index;a<t.length;a++){switch(t.charCodeAt(a)){case 34:r="&quot;";break;case 38:r="&amp;";break;case 39:r="&#x27;";break;case 60:r="&lt;";break;case 62:r="&gt;";break;default:continue}s!==a&&(o+=t.substring(s,a)),s=a+1,o+=r}return s!==a?o+t.substring(s,a):o}function o(e){return"boolean"==typeof e||"number"==typeof e?""+e:r(e)}var i=/["'&<>]/;t.exports=o},{}],96:[function(e,t,n){"use strict";function r(e){if(null==e)return null;if(1===e.nodeType)return e;var t=a.get(e);if(t)return t=s(t),t?i.getNodeFromInstance(t):null;"function"==typeof e.render?o("44"):o("45",Object.keys(e))}var o=e(113),i=(e(120),e(33)),a=e(57),s=e(103);e(138),e(143);t.exports=r},{103:103,113:113,120:120,138:138,143:143,33:33,57:57}],97:[function(e,t,n){(function(n){"use strict";function r(e,t,n,r){if(e&&"object"==typeof e){var o=e;void 0===o[n]&&null!=t&&(o[n]=t)}}function o(e,t){if(null==e)return e;var n={};return i(e,r,n),n}var i=(e(22),e(118));e(143);void 0!==n&&n.env,t.exports=o}).call(this,void 0)},{118:118,143:143,22:22}],98:[function(e,t,n){"use strict";function r(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}t.exports=r},{}],99:[function(e,t,n){"use strict";function r(e){var t,n=e.keyCode;return"charCode"in e?0===(t=e.charCode)&&13===n&&(t=13):t=n,t>=32||13===t?t:0}t.exports=r},{}],100:[function(e,t,n){"use strict";function r(e){if(e.key){var t=i[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=o(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?a[e.keyCode]||"Unidentified":""}var o=e(99),i={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},a={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};t.exports=r},{99:99}],101:[function(e,t,n){"use strict";function r(e){var t=this,n=t.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var r=i[e];return!!r&&!!n[r]}function o(e){return r}var i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};t.exports=o},{}],102:[function(e,t,n){"use strict";function r(e){var t=e.target||e.srcElement||window;return t.correspondingUseElement&&(t=t.correspondingUseElement),3===t.nodeType?t.parentNode:t}t.exports=r},{}],103:[function(e,t,n){"use strict";function r(e){for(var t;(t=e._renderedNodeType)===o.COMPOSITE;)e=e._renderedComponent;return t===o.HOST?e._renderedComponent:t===o.EMPTY?null:void 0}var o=e(62);t.exports=r},{62:62}],104:[function(e,t,n){"use strict";function r(e){var t=e&&(o&&e[o]||e[i]);if("function"==typeof t)return t}var o="function"==typeof Symbol&&Symbol.iterator,i="@@iterator";t.exports=r},{}],105:[function(e,t,n){"use strict";function r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function i(e,t){for(var n=r(e),i=0,a=0;n;){if(3===n.nodeType){if(a=i+n.textContent.length,i<=t&&a>=t)return{node:n,offset:t-i};i=a}n=r(o(n))}}t.exports=i},{}],106:[function(e,t,n){"use strict";function r(){return!i&&o.canUseDOM&&(i="textContent"in document.documentElement?"textContent":"innerText"),i}var o=e(124),i=null;t.exports=r},{124:124}],107:[function(e,t,n){"use strict";function r(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n["ms"+e]="MS"+t,n["O"+e]="o"+t.toLowerCase(),n}function o(e){if(s[e])return s[e];if(!a[e])return e;var t=a[e];for(var n in t)if(t.hasOwnProperty(n)&&n in u)return s[e]=t[n];return""}var i=e(124),a={animationend:r("Animation","AnimationEnd"),animationiteration:r("Animation","AnimationIteration"),animationstart:r("Animation","AnimationStart"),transitionend:r("Transition","TransitionEnd")},s={},u={};i.canUseDOM&&(u=document.createElement("div").style,"AnimationEvent"in window||(delete a.animationend.animation,delete a.animationiteration.animation,delete a.animationstart.animation),"TransitionEvent"in window||delete a.transitionend.transition),t.exports=o},{124:124}],108:[function(e,t,n){"use strict";function r(e){var t=e.type,n=e.nodeName;return n&&"input"===n.toLowerCase()&&("checkbox"===t||"radio"===t)}function o(e){return e._wrapperState.valueTracker}function i(e,t){e._wrapperState.valueTracker=t}function a(e){delete e._wrapperState.valueTracker}function s(e){var t;return e&&(t=r(e)?""+e.checked:e.value),t}var u=e(33),l={_getTrackerFromNode:function(e){return o(u.getInstanceFromNode(e))},track:function(e){if(!o(e)){var t=u.getNodeFromInstance(e),n=r(t)?"checked":"value",s=Object.getOwnPropertyDescriptor(t.constructor.prototype,n),l=""+t[n];t.hasOwnProperty(n)||"function"!=typeof s.get||"function"!=typeof s.set||(Object.defineProperty(t,n,{enumerable:s.enumerable,configurable:!0,get:function(){return s.get.call(this)},set:function(e){l=""+e,s.set.call(this,e)}}),i(e,{getValue:function(){return l},setValue:function(e){l=""+e},stopTracking:function(){a(e),delete t[n]}}))}},updateValueIfChanged:function(e){if(!e)return!1;var t=o(e);if(!t)return l.track(e),!0;var n=t.getValue(),r=s(u.getNodeFromInstance(e));return r!==n&&(t.setValue(r),!0)},stopTracking:function(e){var t=o(e);t&&t.stopTracking()}};t.exports=l},{33:33}],109:[function(e,t,n){"use strict";function r(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}function o(e){return"function"==typeof e&&void 0!==e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function i(e,t){var n;if(null===e||!1===e)n=l.create(i);else if("object"==typeof e){var s=e,u=s.type;if("function"!=typeof u&&"string"!=typeof u){var d="";d+=r(s._owner),a("130",null==u?u:typeof u,d)}"string"==typeof s.type?n=c.createInternalComponent(s):o(s.type)?(n=new s.type(s),n.getHostNode||(n.getHostNode=n.getNativeNode)):n=new p(s)}else"string"==typeof e||"number"==typeof e?n=c.createInstanceForText(e):a("131",typeof e);return n._mountIndex=0,n._mountImage=null,n}var a=e(113),s=e(144),u=e(29),l=e(49),c=e(54),p=(e(122),e(138),e(143),function(e){this.construct(e)});s(p.prototype,u,{_instantiateReactComponent:i}),t.exports=i},{113:113,122:122,138:138,143:143,144:144,29:29,49:49,54:54}],110:[function(e,t,n){"use strict";function r(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var a=document.createElement("div");a.setAttribute(n,"return;"),r="function"==typeof a[n]}return!r&&o&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var o,i=e(124);i.canUseDOM&&(o=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("","")),t.exports=r},{124:124}],111:[function(e,t,n){"use strict";function r(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!o[e.type]:"textarea"===t}var o={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};t.exports=r},{}],112:[function(e,t,n){"use strict";function r(e){return'"'+o(e)+'"'}var o=e(95);t.exports=r},{95:95}],113:[function(e,t,n){"use strict";function r(e){for(var t=arguments.length-1,n="Minified React error #"+e+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)n+="&args[]="+encodeURIComponent(arguments[r+1]);n+=" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.";var o=new Error(n);throw o.name="Invariant Violation",o.framesToPop=1,o}t.exports=r},{}],114:[function(e,t,n){"use strict";var r=e(60);t.exports=r.renderSubtreeIntoContainer},{60:60}],115:[function(e,t,n){"use strict";var r,o=e(124),i=e(10),a=/^[ \r\n\t\f]/,s=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,u=e(93),l=u(function(e,t){if(e.namespaceURI!==i.svg||"innerHTML"in e)e.innerHTML=t;else{r=r||document.createElement("div"),r.innerHTML="<svg>"+t+"</svg>";for(var n=r.firstChild;n.firstChild;)e.appendChild(n.firstChild)}});if(o.canUseDOM){var c=document.createElement("div");c.innerHTML=" ",""===c.innerHTML&&(l=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),a.test(t)||"<"===t[0]&&s.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t}),c=null}t.exports=l},{10:10,124:124,93:93}],116:[function(e,t,n){"use strict";var r=e(124),o=e(95),i=e(115),a=function(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t};r.canUseDOM&&("textContent"in document.documentElement||(a=function(e,t){if(3===e.nodeType)return void(e.nodeValue=t);i(e,o(t))})),t.exports=a},{115:115,124:124,95:95}],117:[function(e,t,n){"use strict";function r(e,t){var n=null===e||!1===e,r=null===t||!1===t;if(n||r)return n===r;var o=typeof e,i=typeof t;return"string"===o||"number"===o?"string"===i||"number"===i:"object"===i&&e.type===t.type&&e.key===t.key}t.exports=r},{}],118:[function(e,t,n){"use strict";function r(e,t){return e&&"object"==typeof e&&null!=e.key?l.escape(e.key):t.toString(36)}function o(e,t,n,i){var d=typeof e;if("undefined"!==d&&"boolean"!==d||(e=null),null===e||"string"===d||"number"===d||"object"===d&&e.$$typeof===s)return n(i,e,""===t?c+r(e,0):t),1;var f,h,m=0,v=""===t?c:t+p;if(Array.isArray(e))for(var g=0;g<e.length;g++)f=e[g],h=v+r(f,g),m+=o(f,h,n,i);else{var y=u(e);if(y){var _,C=y.call(e);if(y!==e.entries)for(var b=0;!(_=C.next()).done;)f=_.value,h=v+r(f,b++),m+=o(f,h,n,i);else for(;!(_=C.next()).done;){var E=_.value;E&&(f=E[1],h=v+l.escape(E[0])+p+r(f,0),m+=o(f,h,n,i))}}else if("object"===d){var x=String(e);a("31","[object Object]"===x?"object with keys {"+Object.keys(e).join(", ")+"}":x,"")}}return m}function i(e,t,n){return null==e?0:o(e,"",t,n)}var a=e(113),s=(e(120),e(48)),u=e(104),l=(e(138),e(22)),c=(e(143),"."),p=":";t.exports=i},{104:104,113:113,120:120,138:138,143:143,22:22,48:48}],119:[function(e,t,n){"use strict";var r=(e(144),e(130)),o=(e(143),r);t.exports=o},{130:130,143:143,144:144}],120:[function(t,n,r){"use strict";var o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;n.exports=o.ReactCurrentOwner},{}],121:[function(t,n,r){"use strict";n.exports=e},{}],122:[function(t,n,r){"use strict";var o=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;n.exports=o.getNextDebugID},{}],123:[function(e,t,n){"use strict";var r=e(130),o={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!0),{remove:function(){e.removeEventListener(t,n,!0)}}):{remove:r}},registerDefault:function(){}};t.exports=o},{130:130}],124:[function(e,t,n){"use strict";var r=!("undefined"==typeof window||!window.document||!window.document.createElement),o={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};t.exports=o},{}],125:[function(e,t,n){"use strict";function r(e){return e.replace(o,function(e,t){return t.toUpperCase()})}var o=/-(.)/g;t.exports=r},{}],126:[function(e,t,n){"use strict";function r(e){return o(e.replace(i,"ms-"))}var o=e(125),i=/^-ms-/;t.exports=r},{125:125}],127:[function(e,t,n){"use strict";function r(e,t){return!(!e||!t)&&(e===t||!o(e)&&(o(t)?r(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}var o=e(140);t.exports=r},{140:140}],128:[function(e,t,n){"use strict";function r(e){var t=e.length;if((Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e)&&a(!1),"number"!=typeof t&&a(!1),0===t||t-1 in e||a(!1),"function"==typeof e.callee&&a(!1),e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(e){}for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}function o(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function i(e){return o(e)?Array.isArray(e)?e.slice():r(e):[e]}var a=e(138);t.exports=i},{138:138}],129:[function(e,t,n){"use strict";function r(e){var t=e.match(c);return t&&t[1].toLowerCase()}function o(e,t){var n=l;l||u(!1);var o=r(e),i=o&&s(o);if(i){n.innerHTML=i[1]+e+i[2];for(var c=i[0];c--;)n=n.lastChild}else n.innerHTML=e;var p=n.getElementsByTagName("script");p.length&&(t||u(!1),a(p).forEach(t));for(var d=Array.from(n.childNodes);n.lastChild;)n.removeChild(n.lastChild);return d}var i=e(124),a=e(128),s=e(134),u=e(138),l=i.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;t.exports=o},{124:124,128:128,134:134,138:138}],130:[function(e,t,n){"use strict";function r(e){return function(){return e}}var o=function(){};o.thatReturns=r,o.thatReturnsFalse=r(!1),o.thatReturnsTrue=r(!0),o.thatReturnsNull=r(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},t.exports=o},{}],131:[function(e,t,n){"use strict";var r={};t.exports=r},{}],132:[function(e,t,n){"use strict";function r(e){try{e.focus()}catch(e){}}t.exports=r},{}],133:[function(e,t,n){"use strict";function r(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}t.exports=r},{}],134:[function(e,t,n){"use strict";function r(e){return a||i(!1),d.hasOwnProperty(e)||(e="*"),s.hasOwnProperty(e)||(a.innerHTML="*"===e?"<link />":"<"+e+"></"+e+">",s[e]=!a.firstChild),s[e]?d[e]:null}var o=e(124),i=e(138),a=o.canUseDOM?document.createElement("div"):null,s={},u=[1,'<select multiple="true">',"</select>"],l=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],p=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],d={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:u,option:u,caption:l,colgroup:l,tbody:l,tfoot:l,thead:l,td:c,th:c};["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"].forEach(function(e){d[e]=p,s[e]=!0}),t.exports=r},{124:124,138:138}],135:[function(e,t,n){"use strict";function r(e){return e.Window&&e instanceof e.Window?{x:e.pageXOffset||e.document.documentElement.scrollLeft,y:e.pageYOffset||e.document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}t.exports=r},{}],136:[function(e,t,n){"use strict";function r(e){return e.replace(o,"-$1").toLowerCase()}var o=/([A-Z])/g;t.exports=r},{}],137:[function(e,t,n){"use strict";function r(e){return o(e).replace(i,"-ms-")}var o=e(136),i=/^ms-/;t.exports=r},{136:136}],138:[function(e,t,n){"use strict";function r(e,t,n,r,i,a,s,u){if(o(t),!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,i,a,s,u],p=0;l=new Error(t.replace(/%s/g,function(){return c[p++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}}var o=function(e){};t.exports=r},{}],139:[function(e,t,n){"use strict";function r(e){var t=e?e.ownerDocument||e:document,n=t.defaultView||window;return!(!e||!("function"==typeof n.Node?e instanceof n.Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}t.exports=r},{}],140:[function(e,t,n){"use strict";function r(e){return o(e)&&3==e.nodeType}var o=e(139);t.exports=r},{139:139}],141:[function(e,t,n){"use strict";function r(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}t.exports=r},{}],142:[function(e,t,n){"use strict";function r(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!==e&&t!==t}function o(e,t){if(r(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(var a=0;a<n.length;a++)if(!i.call(t,n[a])||!r(e[n[a]],t[n[a]]))return!1;return!0}var i=Object.prototype.hasOwnProperty;t.exports=o},{}],143:[function(e,t,n){"use strict";var r=e(130),o=r;t.exports=o},{130:130}],144:[function(e,t,n){"use strict";function r(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(e){return t[e]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(e){r[e]=e}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,s,u=r(e),l=1;l<arguments.length;l++){n=Object(arguments[l]);for(var c in n)i.call(n,c)&&(u[c]=n[c]);if(o){s=o(n);for(var p=0;p<s.length;p++)a.call(n,s[p])&&(u[s[p]]=n[s[p]])}}return u}},{}],145:[function(e,t,n){"use strict";function r(e,t,n,r,o){}t.exports=r},{138:138,143:143,148:148}],146:[function(e,t,n){"use strict";var r=e(147);t.exports=function(e){return r(e,!1)}},{147:147}],147:[function(e,t,n){"use strict";var r=e(130),o=e(138),i=e(143),a=e(148),s=e(145);t.exports=function(e,t){function n(e){var t=e&&(w&&e[w]||e[T]);if("function"==typeof t)return t}function u(e,t){return e===t?0!==e||1/e==1/t:e!==e&&t!==t}function l(e){this.message=e,this.stack=""}function c(e){function n(n,r,i,s,u,c,p){if(s=s||k,c=c||i,p!==a)if(t)o(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use `PropTypes.checkPropTypes()` to call them. Read more at http://fb.me/use-check-prop-types");else;return null==r[i]?n?new l(null===r[i]?"The "+u+" `"+c+"` is marked as required in `"+s+"`, but its value is `null`.":"The "+u+" `"+c+"` is marked as required in `"+s+"`, but its value is `undefined`."):null:e(r,i,s,u,c)}var r=n.bind(null,!1);return r.isRequired=n.bind(null,!0),r}function p(e){function t(t,n,r,o,i,a){var s=t[n];if(C(s)!==e)return new l("Invalid "+o+" `"+i+"` of type `"+b(s)+"` supplied to `"+r+"`, expected `"+e+"`.");return null}return c(t)}function d(e){function t(t,n,r,o,i){if("function"!=typeof e)return new l("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside arrayOf.");var s=t[n];if(!Array.isArray(s)){return new l("Invalid "+o+" `"+i+"` of type `"+C(s)+"` supplied to `"+r+"`, expected an array.")}for(var u=0;u<s.length;u++){var c=e(s,u,r,o,i+"["+u+"]",a);if(c instanceof Error)return c}return null}return c(t)}function f(e){function t(t,n,r,o,i){if(!(t[n]instanceof e)){var a=e.name||k;return new l("Invalid "+o+" `"+i+"` of type `"+x(t[n])+"` supplied to `"+r+"`, expected instance of `"+a+"`.")}return null}return c(t)}function h(e){function t(t,n,r,o,i){for(var a=t[n],s=0;s<e.length;s++)if(u(a,e[s]))return null;return new l("Invalid "+o+" `"+i+"` of value `"+a+"` supplied to `"+r+"`, expected one of "+JSON.stringify(e)+".")}return Array.isArray(e)?c(t):r.thatReturnsNull}function m(e){function t(t,n,r,o,i){if("function"!=typeof e)return new l("Property `"+i+"` of component `"+r+"` has invalid PropType notation inside objectOf.");var s=t[n],u=C(s);if("object"!==u)return new l("Invalid "+o+" `"+i+"` of type `"+u+"` supplied to `"+r+"`, expected an object.");for(var c in s)if(s.hasOwnProperty(c)){var p=e(s,c,r,o,i+"."+c,a);if(p instanceof Error)return p}return null}return c(t)}function v(e){function t(t,n,r,o,i){for(var s=0;s<e.length;s++){if(null==(0,e[s])(t,n,r,o,i,a))return null}return new l("Invalid "+o+" `"+i+"` supplied to `"+r+"`.")}if(!Array.isArray(e))return r.thatReturnsNull;for(var n=0;n<e.length;n++){var o=e[n];if("function"!=typeof o)return i(!1,"Invalid argument supplid to oneOfType. Expected an array of check functions, but received %s at index %s.",E(o),n),r.thatReturnsNull}return c(t)}function g(e){function t(t,n,r,o,i){var s=t[n],u=C(s);if("object"!==u)return new l("Invalid "+o+" `"+i+"` of type `"+u+"` supplied to `"+r+"`, expected `object`.");for(var c in e){var p=e[c];if(p){var d=p(s,c,r,o,i+"."+c,a);if(d)return d}}return null}return c(t)}function y(t){switch(typeof t){case"number":case"string":case"undefined":return!0;case"boolean":return!t;case"object":if(Array.isArray(t))return t.every(y);if(null===t||e(t))return!0;var r=n(t);if(!r)return!1;var o,i=r.call(t);if(r!==t.entries){for(;!(o=i.next()).done;)if(!y(o.value))return!1}else for(;!(o=i.next()).done;){var a=o.value;if(a&&!y(a[1]))return!1}return!0;default:return!1}}function _(e,t){return"symbol"===e||("Symbol"===t["@@toStringTag"]||"function"==typeof Symbol&&t instanceof Symbol)}function C(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":_(t,e)?"symbol":t}function b(e){if(void 0===e||null===e)return""+e;var t=C(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function E(e){var t=b(e);switch(t){case"array":case"object":return"an "+t;case"boolean":case"date":case"regexp":return"a "+t;default:return t}}function x(e){return e.constructor&&e.constructor.name?e.constructor.name:k}var w="function"==typeof Symbol&&Symbol.iterator,T="@@iterator",k="<<anonymous>>",P={array:p("array"),bool:p("boolean"),func:p("function"),number:p("number"),object:p("object"),string:p("string"),symbol:p("symbol"),any:function(){return c(r.thatReturnsNull)}(),arrayOf:d,element:function(){function t(t,n,r,o,i){var a=t[n];if(!e(a)){return new l("Invalid "+o+" `"+i+"` of type `"+C(a)+"` supplied to `"+r+"`, expected a single ReactElement.")}return null}return c(t)}(),instanceOf:f,node:function(){function e(e,t,n,r,o){return y(e[t])?null:new l("Invalid "+r+" `"+o+"` supplied to `"+n+"`, expected a ReactNode.")}return c(e)}(),objectOf:m,oneOf:h,oneOfType:v,shape:g};return l.prototype=Error.prototype,P.checkPropTypes=s,P.PropTypes=P,P}},{130:130,138:138,143:143,145:145,148:148}],148:[function(e,t,n){"use strict";t.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},{}]},{},[45])(45)}()}()});__LiteMolReactDOM=__module__.exports})();var __LiteMolColorPicker={};(function(modules){var __self={};var parentHotUpdateCallback=__self["webpackHotUpdate"];__self["webpackHotUpdate"]=function webpackHotUpdateCallback(chunkId,moreModules){hotAddUpdateChunk(chunkId,moreModules);if(parentHotUpdateCallback)parentHotUpdateCallback(chunkId,moreModules)};function hotDownloadUpdateChunk(chunkId){var head=document.getElementsByTagName("head")[0];var script=document.createElement("script");script.type="text/javascript";script.charset="utf-8";script.src=__webpack_require__.p+""+chunkId+"."+hotCurrentHash+".hot-update.js";head.appendChild(script)}function hotDownloadManifest(callback){if(typeof XMLHttpRequest==="undefined")return callback(new Error("No browser support"));try{var request=new XMLHttpRequest;var requestPath=__webpack_require__.p+""+hotCurrentHash+".hot-update.json";request.open("GET",requestPath,true);request.timeout=1e4;request.send(null)}catch(err){return callback(err)}request.onreadystatechange=function(){if(request.readyState!==4)return;if(request.status===0){callback(new Error("Manifest request to "+requestPath+" timed out."))}else if(request.status===404){callback()}else if(request.status!==200&&request.status!==304){callback(new Error("Manifest request to "+requestPath+" failed."))}else{try{var update=JSON.parse(request.responseText)}catch(e){callback(e);return}callback(null,update)}}}var canDefineProperty=false;try{Object.defineProperty({},"x",{get:function(){}});canDefineProperty=true}catch(x){}var hotApplyOnUpdate=true;var hotCurrentHash="cac23860c44b0ba80f83";var hotCurrentModuleData={};var hotCurrentParents=[];function hotCreateRequire(moduleId){var me=installedModules[moduleId];if(!me)return __webpack_require__;var fn=function(request){if(me.hot.active){if(installedModules[request]){if(installedModules[request].parents.indexOf(moduleId)<0)installedModules[request].parents.push(moduleId);if(me.children.indexOf(request)<0)me.children.push(request)}else hotCurrentParents=[moduleId]}else{console.warn("[HMR] unexpected require("+request+") from disposed module "+moduleId);hotCurrentParents=[]}return __webpack_require__(request)};for(var name in __webpack_require__){if(Object.prototype.hasOwnProperty.call(__webpack_require__,name)){if(canDefineProperty){Object.defineProperty(fn,name,function(name){return{configurable:true,enumerable:true,get:function(){return __webpack_require__[name]},set:function(value){__webpack_require__[name]=value}}}(name))}else{fn[name]=__webpack_require__[name]}}}function ensure(chunkId,callback){if(hotStatus==="ready")hotSetStatus("prepare");hotChunksLoading++;__webpack_require__.e(chunkId,function(){try{callback.call(null,fn)}finally{finishChunkLoading()}function finishChunkLoading(){hotChunksLoading--;if(hotStatus==="prepare"){if(!hotWaitingFilesMap[chunkId]){hotEnsureUpdateChunk(chunkId)}if(hotChunksLoading===0&&hotWaitingFiles===0){hotUpdateDownloaded()}}}})}if(canDefineProperty){Object.defineProperty(fn,"e",{enumerable:true,value:ensure})}else{fn.e=ensure}return fn}function hotCreateModule(moduleId){var hot={_acceptedDependencies:{},_declinedDependencies:{},_selfAccepted:false,_selfDeclined:false,_disposeHandlers:[],active:true,accept:function(dep,callback){if(typeof dep==="undefined")hot._selfAccepted=true;else if(typeof dep==="function")hot._selfAccepted=dep;else if(typeof dep==="object")for(var i=0;i<dep.length;i++)hot._acceptedDependencies[dep[i]]=callback;else hot._acceptedDependencies[dep]=callback},decline:function(dep){if(typeof dep==="undefined")hot._selfDeclined=true;else if(typeof dep==="number")hot._declinedDependencies[dep]=true;else for(var i=0;i<dep.length;i++)hot._declinedDependencies[dep[i]]=true},dispose:function(callback){hot._disposeHandlers.push(callback)},addDisposeHandler:function(callback){hot._disposeHandlers.push(callback)},removeDisposeHandler:function(callback){var idx=hot._disposeHandlers.indexOf(callback);if(idx>=0)hot._disposeHandlers.splice(idx,1)},check:hotCheck,apply:hotApply,status:function(l){if(!l)return hotStatus;hotStatusHandlers.push(l)},addStatusHandler:function(l){hotStatusHandlers.push(l)},removeStatusHandler:function(l){var idx=hotStatusHandlers.indexOf(l);if(idx>=0)hotStatusHandlers.splice(idx,1)},data:hotCurrentModuleData[moduleId]};return hot}var hotStatusHandlers=[];var hotStatus="idle";function hotSetStatus(newStatus){hotStatus=newStatus;for(var i=0;i<hotStatusHandlers.length;i++)hotStatusHandlers[i].call(null,newStatus)}var hotWaitingFiles=0;var hotChunksLoading=0;var hotWaitingFilesMap={};var hotRequestedFilesMap={};var hotAvailibleFilesMap={};var hotCallback;var hotUpdate,hotUpdateNewHash;function toModuleId(id){var isNumber=+id+""===id;return isNumber?+id:id}function hotCheck(apply,callback){if(hotStatus!=="idle")throw new Error("check() is only allowed in idle status");if(typeof apply==="function"){hotApplyOnUpdate=false;callback=apply}else{hotApplyOnUpdate=apply;callback=callback||function(err){if(err)throw err}}hotSetStatus("check");hotDownloadManifest(function(err,update){if(err)return callback(err);if(!update){hotSetStatus("idle");callback(null,null);return}hotRequestedFilesMap={};hotAvailibleFilesMap={};hotWaitingFilesMap={};for(var i=0;i<update.c.length;i++)hotAvailibleFilesMap[update.c[i]]=true;hotUpdateNewHash=update.h;hotSetStatus("prepare");hotCallback=callback;hotUpdate={};var chunkId=0;{hotEnsureUpdateChunk(chunkId)}if(hotStatus==="prepare"&&hotChunksLoading===0&&hotWaitingFiles===0){hotUpdateDownloaded()}})}function hotAddUpdateChunk(chunkId,moreModules){if(!hotAvailibleFilesMap[chunkId]||!hotRequestedFilesMap[chunkId])return;hotRequestedFilesMap[chunkId]=false;for(var moduleId in moreModules){if(Object.prototype.hasOwnProperty.call(moreModules,moduleId)){hotUpdate[moduleId]=moreModules[moduleId]}}if(--hotWaitingFiles===0&&hotChunksLoading===0){hotUpdateDownloaded()}}function hotEnsureUpdateChunk(chunkId){if(!hotAvailibleFilesMap[chunkId]){hotWaitingFilesMap[chunkId]=true}else{hotRequestedFilesMap[chunkId]=true;hotWaitingFiles++;hotDownloadUpdateChunk(chunkId)}}function hotUpdateDownloaded(){hotSetStatus("ready");var callback=hotCallback;hotCallback=null;if(!callback)return;if(hotApplyOnUpdate){hotApply(hotApplyOnUpdate,callback)}else{var outdatedModules=[];for(var id in hotUpdate){if(Object.prototype.hasOwnProperty.call(hotUpdate,id)){outdatedModules.push(toModuleId(id))}}callback(null,outdatedModules)}}function hotApply(options,callback){if(hotStatus!=="ready")throw new Error("apply() is only allowed in ready status");if(typeof options==="function"){callback=options;options={}}else if(options&&typeof options==="object"){callback=callback||function(err){if(err)throw err}}else{options={};callback=callback||function(err){if(err)throw err}}function getAffectedStuff(module){var outdatedModules=[module];var outdatedDependencies={};var queue=outdatedModules.slice();while(queue.length>0){var moduleId=queue.pop();var module=installedModules[moduleId];if(!module||module.hot._selfAccepted)continue;if(module.hot._selfDeclined){return new Error("Aborted because of self decline: "+moduleId)}if(moduleId===0){return}for(var i=0;i<module.parents.length;i++){var parentId=module.parents[i];var parent=installedModules[parentId];if(parent.hot._declinedDependencies[moduleId]){return new Error("Aborted because of declined dependency: "+moduleId+" in "+parentId)}if(outdatedModules.indexOf(parentId)>=0)continue;if(parent.hot._acceptedDependencies[moduleId]){if(!outdatedDependencies[parentId])outdatedDependencies[parentId]=[];addAllToSet(outdatedDependencies[parentId],[moduleId]);continue}delete outdatedDependencies[parentId];outdatedModules.push(parentId);queue.push(parentId)}}return[outdatedModules,outdatedDependencies]}function addAllToSet(a,b){for(var i=0;i<b.length;i++){var item=b[i];if(a.indexOf(item)<0)a.push(item)}}var outdatedDependencies={};var outdatedModules=[];var appliedUpdate={};for(var id in hotUpdate){if(Object.prototype.hasOwnProperty.call(hotUpdate,id)){var moduleId=toModuleId(id);var result=getAffectedStuff(moduleId);if(!result){if(options.ignoreUnaccepted)continue;hotSetStatus("abort");return callback(new Error("Aborted because "+moduleId+" is not accepted"))}if(result instanceof Error){hotSetStatus("abort");return callback(result)}appliedUpdate[moduleId]=hotUpdate[moduleId];addAllToSet(outdatedModules,result[0]);for(var moduleId in result[1]){if(Object.prototype.hasOwnProperty.call(result[1],moduleId)){if(!outdatedDependencies[moduleId])outdatedDependencies[moduleId]=[];addAllToSet(outdatedDependencies[moduleId],result[1][moduleId])}}}}var outdatedSelfAcceptedModules=[];for(var i=0;i<outdatedModules.length;i++){var moduleId=outdatedModules[i];if(installedModules[moduleId]&&installedModules[moduleId].hot._selfAccepted)outdatedSelfAcceptedModules.push({module:moduleId,errorHandler:installedModules[moduleId].hot._selfAccepted})}hotSetStatus("dispose");var queue=outdatedModules.slice();while(queue.length>0){var moduleId=queue.pop();var module=installedModules[moduleId];if(!module)continue;var data={};var disposeHandlers=module.hot._disposeHandlers;for(var j=0;j<disposeHandlers.length;j++){var cb=disposeHandlers[j];cb(data)}hotCurrentModuleData[moduleId]=data;module.hot.active=false;delete installedModules[moduleId];for(var j=0;j<module.children.length;j++){var child=installedModules[module.children[j]];if(!child)continue;var idx=child.parents.indexOf(moduleId);if(idx>=0){child.parents.splice(idx,1)}}}for(var moduleId in outdatedDependencies){if(Object.prototype.hasOwnProperty.call(outdatedDependencies,moduleId)){var module=installedModules[moduleId];var moduleOutdatedDependencies=outdatedDependencies[moduleId];for(var j=0;j<moduleOutdatedDependencies.length;j++){var dependency=moduleOutdatedDependencies[j];var idx=module.children.indexOf(dependency);if(idx>=0)module.children.splice(idx,1)}}}hotSetStatus("apply");hotCurrentHash=hotUpdateNewHash;for(var moduleId in appliedUpdate){if(Object.prototype.hasOwnProperty.call(appliedUpdate,moduleId)){modules[moduleId]=appliedUpdate[moduleId]}}var error=null;for(var moduleId in outdatedDependencies){if(Object.prototype.hasOwnProperty.call(outdatedDependencies,moduleId)){var module=installedModules[moduleId];var moduleOutdatedDependencies=outdatedDependencies[moduleId];var callbacks=[];for(var i=0;i<moduleOutdatedDependencies.length;i++){var dependency=moduleOutdatedDependencies[i];var cb=module.hot._acceptedDependencies[dependency];if(callbacks.indexOf(cb)>=0)continue;callbacks.push(cb)}for(var i=0;i<callbacks.length;i++){var cb=callbacks[i];try{cb(outdatedDependencies)}catch(err){if(!error)error=err}}}}for(var i=0;i<outdatedSelfAcceptedModules.length;i++){var item=outdatedSelfAcceptedModules[i];var moduleId=item.module;hotCurrentParents=[moduleId];try{__webpack_require__(moduleId)}catch(err){if(typeof item.errorHandler==="function"){try{item.errorHandler(err)}catch(err){if(!error)error=err}}else if(!error)error=err}}if(error){hotSetStatus("fail");return callback(error)}hotSetStatus("idle");callback(null,outdatedModules)}var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false,hot:hotCreateModule(moduleId),parents:hotCurrentParents,children:[]};modules[moduleId].call(module.exports,module,module.exports,hotCreateRequire(moduleId));module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="build/";__webpack_require__.h=function(){return hotCurrentHash};return hotCreateRequire(0)(0)})([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)},function(module,exports,__webpack_require__){"use strict";var _Chrome=__webpack_require__(2);var _Chrome2=_interopRequireDefault(_Chrome);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}__LiteMolColorPicker.ChromePicker=_Chrome2.default},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Chrome=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _common=__webpack_require__(15);var _ChromePointer=__webpack_require__(29);var _ChromePointer2=_interopRequireDefault(_ChromePointer);var _ChromePointerCircle=__webpack_require__(30);var _ChromePointerCircle2=_interopRequireDefault(_ChromePointerCircle);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);var _CompactColor=__webpack_require__(31);var _CompactColor2=_interopRequireDefault(_CompactColor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Chrome=exports.Chrome=function(_ReactCSS$Component){_inherits(Chrome,_ReactCSS$Component);function Chrome(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Chrome);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=Chrome.__proto__||Object.getPrototypeOf(Chrome)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_this.handleChange=function(data){_this.props.onChange(data)},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(Chrome,[{key:"classes",value:function classes(){return{default:{picker:{width:"100%"},saturation:{width:"100%",height:"48px",position:"relative",borderRadius:"0px",overflow:"hidden"},Saturation:{radius:"0px"},body:{padding:"0"},controls:{marginTop:"1px",display:"block"},swatch:{marginTop:"0px",width:"16px",height:"16px",borderRadius:"8px",position:"relative",overflow:"hidden"},active:{Absolute:"0 0 0 0",zIndex:2,borderRadius:"8px",boxShadow:"inset 0 0 0 1px rgba(0,0,0,.1)",background:"rgba("+this.props.rgb.r+", "+this.props.rgb.g+", "+this.props.rgb.b+", "+this.props.rgb.a+")"},hue:{height:"16px",position:"relative",width:"100%"},Hue:{radius:"0"},colors:{marginTop:"1px",display:"flex",flexDirection:"row"}}}}},{key:"render",value:function render(){var colors=[];if(this.props.colors){for(var i=0;i<this.props.colors.length;i++){var color=this.props.colors[i];colors.push(_react2.default.createElement(_CompactColor2.default,{key:color,color:color,active:color.replace("#","").toLowerCase()==this.props.hex,onClick:this.handleChange}))}}return _react2.default.createElement("div",{style:this.styles().picker},_react2.default.createElement("div",{style:this.styles().saturation},_react2.default.createElement(_common.Saturation,_extends({},this.styles().Saturation,this.props,{pointer:_ChromePointerCircle2.default,onChange:this.handleChange}))),_react2.default.createElement("div",{style:this.styles().body},_react2.default.createElement("div",{style:this.styles().hue},_react2.default.createElement(_common.Hue,_extends({},this.styles().Hue,this.props,{pointer:_ChromePointer2.default,onChange:this.handleChange}))),_react2.default.createElement("div",{style:this.styles().colors},colors)))}}]);return Chrome}(_reactcss2.default.Component);Chrome.defaultProps={colors:["#000000","#808080","#FFFFFF","#D33115","#E27300","#FCC400","#B0BC00","#68BC00","#16A5A5","#009CE0","#7B64FF","#FA28FF","#E20F2E"]};exports.default=(0,_common.ColorWrap)(Chrome)},function(module,exports){"use strict";module.exports=__LiteMolReact},function(module,exports,__webpack_require__){"use strict";module.exports={Component:__webpack_require__(5),inline:__webpack_require__(6),mixin:{css:__webpack_require__(6)}}},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_get=function(e,t,r){for(var n=!0;n;){var o=e,i=t,c=r;n=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,i);if(void 0!==a){if("value"in a)return a.value;var u=a.get;if(void 0===u)return;return u.call(c)}var l=Object.getPrototypeOf(o);if(null===l)return;e=l,t=i,r=c,n=!0,a=l=void 0}},React=__webpack_require__(3),inline=__webpack_require__(6),ReactCSSComponent=function(e){function t(){_classCallCheck(this,t),_get(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return _inherits(t,e),_createClass(t,[{key:"css",value:function(e){return inline.call(this,e)}},{key:"styles",value:function(){return this.css()}}]),t}(React.Component);ReactCSSComponent.contextTypes={mixins:React.PropTypes.object},module.exports=ReactCSSComponent},function(module,exports,__webpack_require__){"use strict";var isObject=__webpack_require__(7),checkClassStructure=__webpack_require__(8),combine=__webpack_require__(9);module.exports=function(s){var e=this;combine=__webpack_require__(9);var r=[];if(!this.classes)throw console.warn("Define this.classes on `"+this.constructor.name+"`");checkClassStructure(this.classes());var t=function(s,t){e.classes()[s]?r.push(e.classes()[s]):s&&t&&t.warn===!0&&console.warn("The `"+s+"` css class does not exist on `"+e.constructor.name+"`")};t("default");for(var i in this.props){var c=this.props[i];isObject(c)||(c===!0?(t(i),t(i+"-true")):t(c?i+"-"+c:i+"-false"))}if(this.props&&this.props.activeBounds)for(var o=0;o<this.props.activeBounds.length;o++){var n=this.props.activeBounds[o];t(n)}for(var a in s){var u=s[a];u===!0&&t(a,{warn:!0})}var h={};return this.context&&this.context.mixins&&(h=this.context.mixins),combine(r,h)}},function(module,exports){function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}module.exports=isObject},function(module,exports,__webpack_require__){"use strict";var isObject=__webpack_require__(7);module.exports=function(e){for(var s in e){var o=e[s];if(isObject(o))for(var t in o){var a=o[t];isObject(a)||console.warn("Make sure the value of the element `"+s+"` is an object of css. You passed it `"+o+"`")}else console.warn("Make sure the value of `"+s+"` is an object of html elements. You passed it `"+o+"`")}}},function(module,exports,__webpack_require__){"use strict";var merge=__webpack_require__(10),mixins=__webpack_require__(14);module.exports=function(r,e){var i=merge(r);return mixins(i,e)}},function(module,exports,__webpack_require__){"use strict";var merge=__webpack_require__(11),isObject=__webpack_require__(7),isArray=__webpack_require__(13);module.exports=function(e){return isObject(e)&&!isArray(e)?e:1===e.length?e[0]:merge.recursive.apply(void 0,e)}},function(module,exports,__webpack_require__){(function(module){(function(isNode){var Public=function(clone){return merge(clone===true,false,arguments)},publicName="merge";Public.recursive=function(clone){return merge(clone===true,true,arguments)};Public.clone=function(input){var output=input,type=typeOf(input),index,size;if(type==="array"){output=[];size=input.length;for(index=0;index<size;++index)output[index]=Public.clone(input[index])}else if(type==="object"){output={};for(index in input)output[index]=Public.clone(input[index])}return output};function merge_recursive(base,extend){if(typeOf(base)!=="object")return extend;for(var key in extend){if(typeOf(base[key])==="object"&&typeOf(extend[key])==="object"){base[key]=merge_recursive(base[key],extend[key])}else{base[key]=extend[key]}}return base}function merge(clone,recursive,argv){var result=argv[0],size=argv.length;if(clone||typeOf(result)!=="object")result={};for(var index=0;index<size;++index){var item=argv[index],type=typeOf(item);if(type!=="object")continue;for(var key in item){var sitem=clone?Public.clone(item[key]):item[key];if(recursive){result[key]=merge_recursive(result[key],sitem)}else{result[key]=sitem}}}return result}function typeOf(input){return{}.toString.call(input).slice(8,-1).toLowerCase()}if(isNode){module.exports=Public}else{window[publicName]=Public}})(typeof module==="object"&&module&&typeof module.exports==="object"&&module.exports)}).call(exports,__webpack_require__(12)(module))},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];module.children=[];module.webpackPolyfill=1}return module}},function(module,exports){var isArray=Array.isArray;module.exports=isArray},function(module,exports,__webpack_require__){"use strict";var isObject=__webpack_require__(7),isArray=__webpack_require__(13),merge=__webpack_require__(11),localProps={borderRadius:function(r){return null!==r?{msBorderRadius:r,MozBorderRadius:r,OBorderRadius:r,WebkitBorderRadius:r,borderRadius:r}:void 0},boxShadow:function(r){return null!==r?{msBoxShadow:r,MozBoxShadow:r,OBoxShadow:r,WebkitBoxShadow:r,boxShadow:r}:void 0},userSelect:function(r){return null!==r?{WebkitTouchCallout:r,KhtmlUserSelect:r,MozUserSelect:r,msUserSelect:r,WebkitUserSelect:r,userSelect:r}:void 0},flex:function(r){return null!==r?{WebkitBoxFlex:r,MozBoxFlex:r,WebkitFlex:r,msFlex:r,flex:r}:void 0},flexBasis:function(r){return null!==r?{WebkitFlexBasis:r,flexBasis:r}:void 0},justifyContent:function(r){return null!==r?{WebkitJustifyContent:r,justifyContent:r}:void 0},transition:function(r){return null!==r?{msTransition:r,MozTransition:r,OTransition:r,WebkitTransition:r,transition:r}:void 0},transform:function(r){return null!==r?{msTransform:r,MozTransform:r,OTransform:r,WebkitTransform:r,transform:r}:void 0},Absolute:function(r){if(null!==r){var e=r.split(" ");return{position:"absolute",top:e[0],right:e[1],bottom:e[2],left:e[3]}}},Extend:function(r,e){var o=e[r];return o?o:void 0}},transform=function r(e,o,t){var n=merge(o,localProps),i={};for(var s in e){var u=e[s];if(isObject(u)&&!isArray(u))i[s]=r(u,o,e);else if(n[s]){var l=n[s](u,t);for(var a in l){var f=l[a];i[a]=f}}else i[s]=u}return i};module.exports=function(r,e,o){return transform(r,e,o)}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _Alpha=__webpack_require__(16);Object.defineProperty(exports,"Alpha",{enumerable:true,get:function get(){return _interopRequireDefault(_Alpha).default}});var _Checkboard=__webpack_require__(20);Object.defineProperty(exports,"Checkboard",{enumerable:true,get:function get(){return _interopRequireDefault(_Checkboard).default}});var _Hue=__webpack_require__(21);Object.defineProperty(exports,"Hue",{enumerable:true,get:function get(){return _interopRequireDefault(_Hue).default}});var _Saturation=__webpack_require__(22);Object.defineProperty(exports,"Saturation",{enumerable:true,get:function get(){return _interopRequireDefault(_Saturation).default}});var _ColorWrap=__webpack_require__(24);Object.defineProperty(exports,"ColorWrap",{enumerable:true,get:function get(){return _interopRequireDefault(_ColorWrap).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Alpha=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);var _Checkboard=__webpack_require__(20);var _Checkboard2=_interopRequireDefault(_Checkboard);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Alpha=exports.Alpha=function(_ReactCSS$Component){_inherits(Alpha,_ReactCSS$Component);function Alpha(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Alpha);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=Alpha.__proto__||Object.getPrototypeOf(Alpha)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_this.handleChange=function(e,skip){!skip&&e.preventDefault();var container=_this.refs.container;var containerWidth=container.clientWidth;var left=(e.pageX||e.touches[0].pageX)-(container.getBoundingClientRect().left+window.pageXOffset);var a;if(left<0){a=0}else if(left>containerWidth){a=1}else{a=Math.round(left*100/containerWidth)/100}if(_this.props.a!==a){_this.props.onChange({h:_this.props.hsl.h,s:_this.props.hsl.s,l:_this.props.hsl.l,a:a,source:"rgb"})}},_this.handleMouseDown=function(e){_this.handleChange(e,true);window.addEventListener("mousemove",_this.handleChange);window.addEventListener("mouseup",_this.handleMouseUp)},_this.handleMouseUp=function(){_this.unbindEventListeners()},_this.unbindEventListeners=function(){window.removeEventListener("mousemove",_this.handleChange);window.removeEventListener("mouseup",_this.handleMouseUp)},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(Alpha,[{key:"classes",value:function classes(){return{default:{alpha:{Absolute:"0 0 0 0",borderRadius:this.props.radius},checkboard:{Absolute:"0 0 0 0",overflow:"hidden"},gradient:{Absolute:"0 0 0 0",background:"linear-gradient(to right, rgba("+this.props.rgb.r+", "+this.props.rgb.g+", "+this.props.rgb.b+", 0) 0%, rgba("+this.props.rgb.r+", "+this.props.rgb.g+", "+this.props.rgb.b+", 1) 100%)",boxShadow:this.props.shadow,borderRadius:this.props.radius},container:{position:"relative",zIndex:"2",height:"100%",margin:"0 3px"},pointer:{zIndex:"2",position:"absolute",left:this.props.rgb.a*100+"%"},slider:{width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",marginTop:"1px",transform:"translateX(-2px)"}}}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.unbindEventListeners()}},{key:"render",value:function render(){var pointer=_react2.default.createElement("div",{style:this.styles().slider});if(this.props.pointer){pointer=_react2.default.createElement(this.props.pointer,this.props)}return _react2.default.createElement("div",{style:this.styles().alpha},_react2.default.createElement("div",{style:this.styles().checkboard},_react2.default.createElement(_Checkboard2.default,null)),_react2.default.createElement("div",{style:this.styles().gradient}),_react2.default.createElement("div",{style:this.styles().container,ref:"container",onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},_react2.default.createElement("div",{style:this.styles().pointer,ref:"pointer"},pointer)))}}]);return Alpha}(_reactcss2.default.Component);exports.default=Alpha},function(module,exports,__webpack_require__){module.exports=__webpack_require__(18)},function(module,exports,__webpack_require__){"use strict";var shallowEqual=__webpack_require__(19);function shallowCompare(instance,nextProps,nextState){return!shallowEqual(instance.props,nextProps)||!shallowEqual(instance.state,nextState)}module.exports=shallowCompare},function(module,exports){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function shallowEqual(objA,objB){if(objA===objB){return true}if(typeof objA!=="object"||objA===null||typeof objB!=="object"||objB===null){return false}var keysA=Object.keys(objA);var keysB=Object.keys(objB);if(keysA.length!==keysB.length){return false}var bHasOwnProperty=hasOwnProperty.bind(objB);for(var i=0;i<keysA.length;i++){if(!bHasOwnProperty(keysA[i])||objA[keysA[i]]!==objB[keysA[i]]){return false}}return true}module.exports=shallowEqual},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Checkboard=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _checkboardCache={};function renderCheckboard(c1,c2,size){if(typeof document=="undefined")return null;var canvas=document.createElement("canvas");canvas.width=canvas.height=size*2;var ctx=canvas.getContext("2d");if(!ctx)return null;ctx.fillStyle=c1;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle=c2;ctx.fillRect(0,0,size,size);ctx.translate(size,size);ctx.fillRect(0,0,size,size);return canvas.toDataURL()}function getCheckboard(c1,c2,size){var key=c1+","+c2+","+size;if(_checkboardCache[key]){return _checkboardCache[key]}else{var checkboard=renderCheckboard(c1,c2,size);_checkboardCache[key]=checkboard;return checkboard}}var Checkboard=exports.Checkboard=function(_ReactCSS$Component){_inherits(Checkboard,_ReactCSS$Component);function Checkboard(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Checkboard);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=Checkboard.__proto__||Object.getPrototypeOf(Checkboard)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(Checkboard,[{key:"classes",value:function classes(){var background=getCheckboard(this.props.white,this.props.grey,this.props.size);return{default:{grid:{Absolute:"0 0 0 0",background:"url("+background+") center left"}}}}},{key:"render",value:function render(){return _react2.default.createElement("div",{style:this.styles().grid,ref:"grid"})}}]);return Checkboard}(_reactcss2.default.Component);Checkboard.defaultProps={size:8,white:"#fff",grey:"#e6e6e6"};exports.default=Checkboard},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Hue=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Hue=exports.Hue=function(_ReactCSS$Component){_inherits(Hue,_ReactCSS$Component);function Hue(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,Hue);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=Hue.__proto__||Object.getPrototypeOf(Hue)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_this.handleChange=function(e,skip){!skip&&e.preventDefault();var container=_this.refs.container;var containerWidth=container.clientWidth;var containerHeight=container.clientHeight;var left=(e.pageX||e.touches&&e.touches[0].pageX||0)-(container.getBoundingClientRect().left+window.pageXOffset);var top=(e.pageY||e.touches&&e.touches[0].pageY||0)-(container.getBoundingClientRect().top+window.pageYOffset);if(_this.props.direction==="vertical"){var h;if(top<0){h=359}else if(top>containerHeight){h=0}else{var percent=-(top*100/containerHeight)+100;h=360*percent/100}if(_this.props.hsl.h!==h){_this.props.onChange({h:h,s:_this.props.hsl.s,l:_this.props.hsl.l,a:_this.props.hsl.a,source:"rgb"})}}else{var h;if(left<0){h=0}else if(left>containerWidth){h=359}else{var percent=left*100/containerWidth;h=360*percent/100}if(_this.props.hsl.h!==h){_this.props.onChange({h:h,s:_this.props.hsl.s,l:_this.props.hsl.l,a:_this.props.hsl.a,source:"rgb"})}}},_this.handleMouseDown=function(e){_this.handleChange(e,true);window.addEventListener("mousemove",_this.handleChange);window.addEventListener("mouseup",_this.handleMouseUp)},_this.handleMouseUp=function(){_this.unbindEventListeners()},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(Hue,[{key:"classes",value:function classes(){return{default:{hue:{Absolute:"0 0 0 0",background:"linear-gradient(to right, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)",borderRadius:this.props.radius,boxShadow:this.props.shadow},container:{margin:"0 2px",position:"relative",height:"100%"},pointer:{zIndex:"2",position:"absolute",left:this.props.hsl.h*100/360+"%"},slider:{marginTop:"1px",width:"4px",borderRadius:"1px",height:"8px",boxShadow:"0 0 2px rgba(0, 0, 0, .6)",background:"#fff",transform:"translateX(-2px)"}},"direction-vertical":{hue:{background:"linear-gradient(to top, #f00 0%, #ff0 17%, #0f0 33%, #0ff 50%, #00f 67%, #f0f 83%, #f00 100%)"},pointer:{left:"0",top:-(this.props.hsl.h*100/360)+100+"%"}}}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.unbindEventListeners()}},{key:"unbindEventListeners",value:function unbindEventListeners(){window.removeEventListener("mousemove",this.handleChange);window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function render(){var pointer=_react2.default.createElement("div",{style:this.styles().slider});if(this.props.pointer){pointer=_react2.default.createElement(this.props.pointer,this.props)}return _react2.default.createElement("div",{style:this.styles().hue},_react2.default.createElement("div",{style:this.styles().container,ref:"container",onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},_react2.default.createElement("div",{style:this.styles().pointer,ref:"pointer"},pointer)))}}]);return Hue}(_reactcss2.default.Component);exports.default=Hue},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Saturation=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _lodash=__webpack_require__(23);var _lodash2=_interopRequireDefault(_lodash);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var Saturation=exports.Saturation=function(_ReactCSS$Component){_inherits(Saturation,_ReactCSS$Component);function Saturation(props){_classCallCheck(this,Saturation);var _this=_possibleConstructorReturn(this,(Saturation.__proto__||Object.getPrototypeOf(Saturation)).call(this));_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]);_this.handleChange=function(e,skip){!skip&&e.preventDefault();var container=_this.refs.container;var containerWidth=container.clientWidth;var containerHeight=container.clientHeight;var left=(e.pageX||e.touches[0].pageX)-(container.getBoundingClientRect().left+window.pageXOffset);var top=(e.pageY||e.touches[0].pageY)-(container.getBoundingClientRect().top+window.pageYOffset);if(left<0){left=0}else if(left>containerWidth){left=containerWidth}else if(top<0){top=0}else if(top>containerHeight){top=containerHeight}var saturation=left*100/containerWidth;var bright=-(top*100/containerHeight)+100;_this.throttle(_this.props.onChange,{h:_this.props.hsl.h,s:saturation,v:bright,a:_this.props.hsl.a,source:"rgb"})};_this.handleMouseDown=function(e){_this.handleChange(e,true);window.addEventListener("mousemove",_this.handleChange);window.addEventListener("mouseup",_this.handleMouseUp)};_this.handleMouseUp=function(){_this.unbindEventListeners()};_this.throttle=(0,_lodash2.default)(function(fn,data){fn(data)},50);return _this}_createClass(Saturation,[{key:"classes",value:function classes(){return{default:{color:{Absolute:"0 0 0 0",background:"hsl("+this.props.hsl.h+",100%, 50%)",borderRadius:this.props.radius},white:{Absolute:"0 0 0 0",background:"linear-gradient(to right, #fff, rgba(255,255,255,0))"},black:{Absolute:"0 0 0 0",background:"linear-gradient(to top, #000, rgba(0,0,0,0))",boxShadow:this.props.shadow},pointer:{position:"absolute",top:-(this.props.hsv.v*100)+100+"%",left:this.props.hsv.s*100+"%",cursor:"default"},circle:{width:"4px",height:"4px",boxShadow:"0 0 0 1.5px #fff, inset 0 0 1px 1px rgba(0,0,0,.3), 0 0 1px 2px rgba(0,0,0,.4)",borderRadius:"50%",cursor:"hand",transform:"translate(-2px, -2px)"}}}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.unbindEventListeners()}},{key:"unbindEventListeners",value:function unbindEventListeners(){window.removeEventListener("mousemove",this.handleChange);window.removeEventListener("mouseup",this.handleMouseUp)}},{key:"render",value:function render(){var pointer=_react2.default.createElement("div",{style:this.styles().circle});if(this.props.pointer){pointer=_react2.default.createElement(this.props.pointer,this.props)}return _react2.default.createElement("div",{style:this.styles().color,ref:"container",onMouseDown:this.handleMouseDown,onTouchMove:this.handleChange,onTouchStart:this.handleChange},_react2.default.createElement("div",{style:this.styles().white},_react2.default.createElement("div",{style:this.styles().black}),_react2.default.createElement("div",{style:this.styles().pointer,ref:"pointer"},pointer)))}}]);return Saturation}(_reactcss2.default.Component);exports.default=Saturation},function(module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var NAN=0/0;var symbolTag="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeMax=Math.max,nativeMin=Math.min;var now=function(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}function throttle(func,wait,options){var leading=true,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}if(isObject(options)){leading="leading"in options?!!options.leading:leading;trailing="trailing"in options?!!options.trailing:trailing}return debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=throttle}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ColorWrap=undefined;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _merge=__webpack_require__(11);var _merge2=_interopRequireDefault(_merge);var _lodash=__webpack_require__(25);var _lodash2=_interopRequireDefault(_lodash);var _lodash3=__webpack_require__(26);var _lodash4=_interopRequireDefault(_lodash3);var _color=__webpack_require__(27);var _color2=_interopRequireDefault(_color);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ColorWrap=exports.ColorWrap=function ColorWrap(Picker){var ColorPicker=function(_React$Component){_inherits(ColorPicker,_React$Component);function ColorPicker(props){_classCallCheck(this,ColorPicker);var _this=_possibleConstructorReturn(this,(ColorPicker.__proto__||Object.getPrototypeOf(ColorPicker)).call(this));_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]);_this.handleChange=function(data){data=_color2.default.simpleCheckForValidColor(data);if(data){var colors=_color2.default.toState(data,data.h||_this.state.oldHue);_this.setState(colors);_this.props.onChangeComplete&&_this.debounce(_this.props.onChangeComplete,colors);_this.props.onChange&&_this.props.onChange(colors)}};_this.state=(0,_merge2.default)(_color2.default.toState(props.color,0),{visible:props.display});_this.debounce=(0,_lodash4.default)(function(fn,data){fn(data)},100);return _this}_createClass(ColorPicker,[{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){this.setState((0,_merge2.default)(_color2.default.toState(nextProps.color,this.state.oldHue),{visible:nextProps.display}))}},{key:"render",value:function render(){return _react2.default.createElement(Picker,_extends({},this.props,this.state,{onChange:this.handleChange}))}}]);return ColorPicker}(_react2.default.Component);ColorPicker.defaultProps={color:{h:250,s:.5,l:.2,a:1}};return ColorPicker};exports.default=ColorWrap},function(module,exports){var objectTag="[object Object]";function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}var funcProto=Function.prototype,objectProto=Object.prototype;var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectCtorString=funcToString.call(Object);var objectToString=objectProto.toString;var getPrototype=overArg(Object.getPrototypeOf,Object);function isObjectLike(value){return!!value&&typeof value=="object"}function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value)){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}module.exports=isPlainObject},function(module,exports){(function(global){var FUNC_ERROR_TEXT="Expected a function";var NAN=0/0;var symbolTag="[object Symbol]";var reTrim=/^\s+|\s+$/g;var reIsBadHex=/^[-+]0x[0-9a-f]+$/i;var reIsBinary=/^0b[01]+$/i;var reIsOctal=/^0o[0-7]+$/i;var freeParseInt=parseInt;var freeGlobal=typeof global=="object"&&global&&global.Object===Object&&global;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var objectProto=Object.prototype;var objectToString=objectProto.toString;var nativeMax=Math.max,nativeMin=Math.min;var now=function(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=false,maxing=false,trailing=true;if(typeof func!="function"){throw new TypeError(FUNC_ERROR_TEXT)}wait=toNumber(wait)||0;if(isObject(options)){leading=!!options.leading;maxing="maxWait"in options;maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait;trailing="trailing"in options?!!options.trailing:trailing}function invokeFunc(time){var args=lastArgs,thisArg=lastThis;lastArgs=lastThis=undefined;lastInvokeTime=time;result=func.apply(thisArg,args);return result}function leadingEdge(time){lastInvokeTime=time;timerId=setTimeout(timerExpired,wait);return leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return lastCallTime===undefined||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time)){return trailingEdge(time)}timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){timerId=undefined;if(trailing&&lastArgs){return invokeFunc(time)}lastArgs=lastThis=undefined;return result}function cancel(){if(timerId!==undefined){clearTimeout(timerId)}lastInvokeTime=0;lastArgs=lastCallTime=lastThis=timerId=undefined}function flush(){return timerId===undefined?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);lastArgs=arguments;lastThis=this;lastCallTime=time;if(isInvoking){if(timerId===undefined){return leadingEdge(lastCallTime)}if(maxing){timerId=setTimeout(timerExpired,wait);return invokeFunc(lastCallTime)}}if(timerId===undefined){timerId=setTimeout(timerExpired,wait)}return result}debounced.cancel=cancel;debounced.flush=flush;return debounced}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}function isSymbol(value){return typeof value=="symbol"||isObjectLike(value)&&objectToString.call(value)==symbolTag}function toNumber(value){if(typeof value=="number"){return value}if(isSymbol(value)){return NAN}if(isObject(value)){var other=typeof value.valueOf=="function"?value.valueOf():value;value=isObject(other)?other+"":other}if(typeof value!="string"){return value===0?value:+value}value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NAN:+value}module.exports=debounce}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _tinycolor=__webpack_require__(28);var _tinycolor2=_interopRequireDefault(_tinycolor);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default={simpleCheckForValidColor:function simpleCheckForValidColor(data){var keysToCheck=["r","g","b","a","h","s","a","v"];var checked=0;var passed=0;for(var i=0;i<keysToCheck.length;i++){var letter=keysToCheck[i];if(data[letter]){checked++;if(!isNaN(data[letter])){passed++}}}if(checked===passed){return data}},toState:function toState(data,oldHue){var color=data.hex?(0,_tinycolor2.default)(data.hex):(0,_tinycolor2.default)(data);var hsl=color.toHsl();var hsv=color.toHsv();if(hsl.s===0){hsl.h=oldHue||0;hsv.h=oldHue||0}return{hsl:hsl,hex:"#"+color.toHex(),rgb:color.toRgb(),hsv:hsv,oldHue:data.h||oldHue||hsl.h,source:data.source}},isValidHex:function isValidHex(hex){return(0,_tinycolor2.default)(hex).isValid()}}},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_RESULT__;(function(){var trimLeft=/^[\s,#]+/;var trimRight=/\s+$/;var tinyCounter=0;var math=Math;var mathRound=math.round;var mathMin=math.min;var mathMax=math.max;var mathRandom=math.random;function tinycolor(color,opts){color=color?color:"";opts=opts||{};if(color instanceof tinycolor){return color}if(!(this instanceof tinycolor)){return new tinycolor(color,opts)}var rgb=inputToRGB(color);this._originalInput=color,this._r=rgb.r,this._g=rgb.g,this._b=rgb.b,this._a=rgb.a,this._roundA=mathRound(100*this._a)/100,this._format=opts.format||rgb.format;this._gradientType=opts.gradientType;if(this._r<1){this._r=mathRound(this._r)}if(this._g<1){this._g=mathRound(this._g)}if(this._b<1){this._b=mathRound(this._b)}this._ok=rgb.ok;this._tc_id=tinyCounter++}tinycolor.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var rgb=this.toRgb();return(rgb.r*299+rgb.g*587+rgb.b*114)/1e3},getLuminance:function(){var rgb=this.toRgb();var RsRGB,GsRGB,BsRGB,R,G,B;RsRGB=rgb.r/255;GsRGB=rgb.g/255;BsRGB=rgb.b/255;if(RsRGB<=.03928){R=RsRGB/12.92}else{R=Math.pow((RsRGB+.055)/1.055,2.4)}if(GsRGB<=.03928){G=GsRGB/12.92}else{G=Math.pow((GsRGB+.055)/1.055,2.4)}if(BsRGB<=.03928){B=BsRGB/12.92}else{B=Math.pow((BsRGB+.055)/1.055,2.4)}return.2126*R+.7152*G+.0722*B},setAlpha:function(value){this._a=boundAlpha(value);this._roundA=mathRound(100*this._a)/100;return this},toHsv:function(){var hsv=rgbToHsv(this._r,this._g,this._b);return{h:hsv.h*360,s:hsv.s,v:hsv.v,a:this._a}},toHsvString:function(){var hsv=rgbToHsv(this._r,this._g,this._b);var h=mathRound(hsv.h*360),s=mathRound(hsv.s*100),v=mathRound(hsv.v*100);return this._a==1?"hsv("+h+", "+s+"%, "+v+"%)":"hsva("+h+", "+s+"%, "+v+"%, "+this._roundA+")"},toHsl:function(){var hsl=rgbToHsl(this._r,this._g,this._b);return{h:hsl.h*360,s:hsl.s,l:hsl.l,a:this._a}},toHslString:function(){var hsl=rgbToHsl(this._r,this._g,this._b);var h=mathRound(hsl.h*360),s=mathRound(hsl.s*100),l=mathRound(hsl.l*100);return this._a==1?"hsl("+h+", "+s+"%, "+l+"%)":"hsla("+h+", "+s+"%, "+l+"%, "+this._roundA+")"},toHex:function(allow3Char){return rgbToHex(this._r,this._g,this._b,allow3Char)},toHexString:function(allow3Char){return"#"+this.toHex(allow3Char)},toHex8:function(){return rgbaToHex(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:mathRound(this._r),g:mathRound(this._g),b:mathRound(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+")":"rgba("+mathRound(this._r)+", "+mathRound(this._g)+", "+mathRound(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:mathRound(bound01(this._r,255)*100)+"%",g:mathRound(bound01(this._g,255)*100)+"%",b:mathRound(bound01(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+mathRound(bound01(this._r,255)*100)+"%, "+mathRound(bound01(this._g,255)*100)+"%, "+mathRound(bound01(this._b,255)*100)+"%)":"rgba("+mathRound(bound01(this._r,255)*100)+"%, "+mathRound(bound01(this._g,255)*100)+"%, "+mathRound(bound01(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){if(this._a===0){return"transparent"}if(this._a<1){return false}return hexNames[rgbToHex(this._r,this._g,this._b,true)]||false},toFilter:function(secondColor){var hex8String="#"+rgbaToHex(this._r,this._g,this._b,this._a);var secondHex8String=hex8String;var gradientType=this._gradientType?"GradientType = 1, ":"";if(secondColor){var s=tinycolor(secondColor);secondHex8String=s.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+gradientType+"startColorstr="+hex8String+",endColorstr="+secondHex8String+")"},toString:function(format){var formatSet=!!format;format=format||this._format;var formattedString=false;var hasAlpha=this._a<1&&this._a>=0;var needsAlphaFormat=!formatSet&&hasAlpha&&(format==="hex"||format==="hex6"||format==="hex3"||format==="name");if(needsAlphaFormat){if(format==="name"&&this._a===0){return this.toName()}return this.toRgbString()}if(format==="rgb"){formattedString=this.toRgbString()}if(format==="prgb"){formattedString=this.toPercentageRgbString()}if(format==="hex"||format==="hex6"){formattedString=this.toHexString()}if(format==="hex3"){formattedString=this.toHexString(true)}if(format==="hex8"){formattedString=this.toHex8String()}if(format==="name"){formattedString=this.toName()}if(format==="hsl"){formattedString=this.toHslString()}if(format==="hsv"){formattedString=this.toHsvString()}return formattedString||this.toHexString()},_applyModification:function(fn,args){var color=fn.apply(null,[this].concat([].slice.call(args)));this._r=color._r;this._g=color._g;this._b=color._b;this.setAlpha(color._a);return this},lighten:function(){return this._applyModification(lighten,arguments)},brighten:function(){return this._applyModification(brighten,arguments)},darken:function(){return this._applyModification(darken,arguments)},desaturate:function(){return this._applyModification(desaturate,arguments)},saturate:function(){return this._applyModification(saturate,arguments)},greyscale:function(){return this._applyModification(greyscale,arguments)},spin:function(){return this._applyModification(spin,arguments)},_applyCombination:function(fn,args){return fn.apply(null,[this].concat([].slice.call(args)))},analogous:function(){return this._applyCombination(analogous,arguments)},complement:function(){return this._applyCombination(complement,arguments)},monochromatic:function(){return this._applyCombination(monochromatic,arguments)},splitcomplement:function(){return this._applyCombination(splitcomplement,arguments)},triad:function(){return this._applyCombination(triad,arguments)},tetrad:function(){return this._applyCombination(tetrad,arguments)}};tinycolor.fromRatio=function(color,opts){if(typeof color=="object"){var newColor={};for(var i in color){if(color.hasOwnProperty(i)){if(i==="a"){newColor[i]=color[i]}else{newColor[i]=convertToPercentage(color[i])}}}color=newColor}return tinycolor(color,opts)};function inputToRGB(color){var rgb={r:0,g:0,b:0};var a=1;var ok=false;var format=false;if(typeof color=="string"){color=stringInputToObject(color)}if(typeof color=="object"){if(color.hasOwnProperty("r")&&color.hasOwnProperty("g")&&color.hasOwnProperty("b")){rgb=rgbToRgb(color.r,color.g,color.b);ok=true;format=String(color.r).substr(-1)==="%"?"prgb":"rgb"}else if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("v")){color.s=convertToPercentage(color.s,1);color.v=convertToPercentage(color.v,1);rgb=hsvToRgb(color.h,color.s,color.v);ok=true;format="hsv"}else if(color.hasOwnProperty("h")&&color.hasOwnProperty("s")&&color.hasOwnProperty("l")){color.s=convertToPercentage(color.s);color.l=convertToPercentage(color.l);rgb=hslToRgb(color.h,color.s,color.l);ok=true;format="hsl"}if(color.hasOwnProperty("a")){a=color.a}}a=boundAlpha(a);return{ok:ok,format:color.format||format,r:mathMin(255,mathMax(rgb.r,0)),g:mathMin(255,mathMax(rgb.g,0)),b:mathMin(255,mathMax(rgb.b,0)),a:a}}function rgbToRgb(r,g,b){return{r:bound01(r,255)*255,g:bound01(g,255)*255,b:bound01(b,255)*255}}function rgbToHsl(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,l=(max+min)/2;if(max==min){h=s=0}else{var d=max-min;s=l>.5?d/(2-max-min):d/(max+min);switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return{h:h,s:s,l:l}}function hslToRgb(h,s,l){var r,g,b;h=bound01(h,360);s=bound01(s,100);l=bound01(l,100);function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}if(s===0){r=g=b=l}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return{r:r*255,g:g*255,b:b*255}}function rgbToHsv(r,g,b){r=bound01(r,255);g=bound01(g,255);b=bound01(b,255);var max=mathMax(r,g,b),min=mathMin(r,g,b);var h,s,v=max;var d=max-min;s=max===0?0:d/max;if(max==min){h=0}else{switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break}h/=6}return{h:h,s:s,v:v}}function hsvToRgb(h,s,v){h=bound01(h,360)*6;s=bound01(s,100);v=bound01(v,100);var i=math.floor(h),f=h-i,p=v*(1-s),q=v*(1-f*s),t=v*(1-(1-f)*s),mod=i%6,r=[v,q,p,p,t,v][mod],g=[t,v,v,q,p,p][mod],b=[p,p,t,v,v,q][mod];return{r:r*255,g:g*255,b:b*255}}function rgbToHex(r,g,b,allow3Char){var hex=[pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];if(allow3Char&&hex[0].charAt(0)==hex[0].charAt(1)&&hex[1].charAt(0)==hex[1].charAt(1)&&hex[2].charAt(0)==hex[2].charAt(1)){return hex[0].charAt(0)+hex[1].charAt(0)+hex[2].charAt(0)}return hex.join("")}function rgbaToHex(r,g,b,a){var hex=[pad2(convertDecimalToHex(a)),pad2(mathRound(r).toString(16)),pad2(mathRound(g).toString(16)),pad2(mathRound(b).toString(16))];return hex.join("")}tinycolor.equals=function(color1,color2){if(!color1||!color2){return false}return tinycolor(color1).toRgbString()==tinycolor(color2).toRgbString()};tinycolor.random=function(){return tinycolor.fromRatio({r:mathRandom(),g:mathRandom(),b:mathRandom()})};function desaturate(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.s-=amount/100;hsl.s=clamp01(hsl.s);return tinycolor(hsl)}function saturate(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.s+=amount/100;hsl.s=clamp01(hsl.s);return tinycolor(hsl)}function greyscale(color){return tinycolor(color).desaturate(100)}function lighten(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.l+=amount/100;hsl.l=clamp01(hsl.l);return tinycolor(hsl)}function brighten(color,amount){amount=amount===0?0:amount||10;var rgb=tinycolor(color).toRgb();rgb.r=mathMax(0,mathMin(255,rgb.r-mathRound(255*-(amount/100))));rgb.g=mathMax(0,mathMin(255,rgb.g-mathRound(255*-(amount/100))));rgb.b=mathMax(0,mathMin(255,rgb.b-mathRound(255*-(amount/100))));return tinycolor(rgb)}function darken(color,amount){amount=amount===0?0:amount||10;var hsl=tinycolor(color).toHsl();hsl.l-=amount/100;hsl.l=clamp01(hsl.l);return tinycolor(hsl)}function spin(color,amount){var hsl=tinycolor(color).toHsl();var hue=(mathRound(hsl.h)+amount)%360;hsl.h=hue<0?360+hue:hue;return tinycolor(hsl)}function complement(color){var hsl=tinycolor(color).toHsl();hsl.h=(hsl.h+180)%360;return tinycolor(hsl)}function triad(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+120)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+240)%360,s:hsl.s,l:hsl.l})]}function tetrad(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+90)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+180)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+270)%360,s:hsl.s,l:hsl.l})]}function splitcomplement(color){var hsl=tinycolor(color).toHsl();var h=hsl.h;return[tinycolor(color),tinycolor({h:(h+72)%360,s:hsl.s,l:hsl.l}),tinycolor({h:(h+216)%360,s:hsl.s,l:hsl.l})]}function analogous(color,results,slices){results=results||6;slices=slices||30;var hsl=tinycolor(color).toHsl();var part=360/slices;var ret=[tinycolor(color)];for(hsl.h=(hsl.h-(part*results>>1)+720)%360;--results;){hsl.h=(hsl.h+part)%360;ret.push(tinycolor(hsl))}return ret}function monochromatic(color,results){results=results||6;var hsv=tinycolor(color).toHsv();var h=hsv.h,s=hsv.s,v=hsv.v;var ret=[];var modification=1/results;while(results--){ret.push(tinycolor({h:h,s:s,v:v}));v=(v+modification)%1}return ret}tinycolor.mix=function(color1,color2,amount){amount=amount===0?0:amount||50;var rgb1=tinycolor(color1).toRgb();var rgb2=tinycolor(color2).toRgb();var p=amount/100;var w=p*2-1;var a=rgb2.a-rgb1.a;var w1;if(w*a==-1){w1=w}else{w1=(w+a)/(1+w*a)}w1=(w1+1)/2;var w2=1-w1;var rgba={r:rgb2.r*w1+rgb1.r*w2,g:rgb2.g*w1+rgb1.g*w2,b:rgb2.b*w1+rgb1.b*w2,a:rgb2.a*p+rgb1.a*(1-p)};return tinycolor(rgba)};tinycolor.readability=function(color1,color2){var c1=tinycolor(color1);var c2=tinycolor(color2);return(Math.max(c1.getLuminance(),c2.getLuminance())+.05)/(Math.min(c1.getLuminance(),c2.getLuminance())+.05)};tinycolor.isReadable=function(color1,color2,wcag2){var readability=tinycolor.readability(color1,color2);var wcag2Parms,out;out=false;wcag2Parms=validateWCAG2Parms(wcag2);switch(wcag2Parms.level+wcag2Parms.size){case"AAsmall":case"AAAlarge":out=readability>=4.5;break;case"AAlarge":out=readability>=3;break;case"AAAsmall":out=readability>=7;break}return out};tinycolor.mostReadable=function(baseColor,colorList,args){var bestColor=null;var bestScore=0;var readability;var includeFallbackColors,level,size;args=args||{};includeFallbackColors=args.includeFallbackColors;level=args.level;size=args.size;for(var i=0;i<colorList.length;i++){readability=tinycolor.readability(baseColor,colorList[i]);if(readability>bestScore){bestScore=readability;bestColor=tinycolor(colorList[i])}}if(tinycolor.isReadable(baseColor,bestColor,{level:level,size:size})||!includeFallbackColors){return bestColor}else{args.includeFallbackColors=false;return tinycolor.mostReadable(baseColor,["#fff","#000"],args)}};var names=tinycolor.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"};var hexNames=tinycolor.hexNames=flip(names);function flip(o){var flipped={};for(var i in o){if(o.hasOwnProperty(i)){flipped[o[i]]=i}}return flipped}function boundAlpha(a){a=parseFloat(a);if(isNaN(a)||a<0||a>1){a=1}return a}function bound01(n,max){if(isOnePointZero(n)){n="100%"}var processPercent=isPercentage(n);n=mathMin(max,mathMax(0,parseFloat(n)));if(processPercent){n=parseInt(n*max,10)/100}if(math.abs(n-max)<1e-6){return 1}return n%max/parseFloat(max)}function clamp01(val){return mathMin(1,mathMax(0,val))}function parseIntFromHex(val){return parseInt(val,16)}function isOnePointZero(n){return typeof n=="string"&&n.indexOf(".")!=-1&&parseFloat(n)===1}function isPercentage(n){return typeof n==="string"&&n.indexOf("%")!=-1}function pad2(c){return c.length==1?"0"+c:""+c}function convertToPercentage(n,multiplier){multiplier=multiplier||100;if(n<=1){n=n*multiplier+"%"}return n}function convertDecimalToHex(d){return Math.round(parseFloat(d)*255).toString(16)}function convertHexToDecimal(h){return parseIntFromHex(h)/255}var matchers=function(){var CSS_INTEGER="[-\\+]?\\d+%?";var CSS_NUMBER="[-\\+]?\\d*\\.\\d+%?";var CSS_UNIT="(?:"+CSS_NUMBER+")|(?:"+CSS_INTEGER+")";var PERMISSIVE_MATCH3="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";var PERMISSIVE_MATCH4="[\\s|\\(]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")[,|\\s]+("+CSS_UNIT+")\\s*\\)?";return{rgb:new RegExp("rgb"+PERMISSIVE_MATCH3),rgba:new RegExp("rgba"+PERMISSIVE_MATCH4),hsl:new RegExp("hsl"+PERMISSIVE_MATCH3),hsla:new RegExp("hsla"+PERMISSIVE_MATCH4),hsv:new RegExp("hsv"+PERMISSIVE_MATCH3),hsva:new RegExp("hsva"+PERMISSIVE_MATCH4),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function stringInputToObject(color){color=color.replace(trimLeft,"").replace(trimRight,"").toLowerCase();var named=false;if(names[color]){color=names[color];named=true}else if(color=="transparent"){return{r:0,g:0,b:0,a:0,format:"name"}}var match;if(match=matchers.rgb.exec(color)){return{r:match[1],g:match[2],b:match[3]}}if(match=matchers.rgba.exec(color)){return{r:match[1],g:match[2],b:match[3],a:match[4]}}if(match=matchers.hsl.exec(color)){return{h:match[1],s:match[2],l:match[3]}}if(match=matchers.hsla.exec(color)){return{h:match[1],s:match[2],l:match[3],a:match[4]}}if(match=matchers.hsv.exec(color)){return{h:match[1],s:match[2],v:match[3]}}if(match=matchers.hsva.exec(color)){return{h:match[1],s:match[2],v:match[3],a:match[4]}}if(match=matchers.hex8.exec(color)){return{a:convertHexToDecimal(match[1]),r:parseIntFromHex(match[2]),g:parseIntFromHex(match[3]),b:parseIntFromHex(match[4]),format:named?"name":"hex8"}}if(match=matchers.hex6.exec(color)){return{r:parseIntFromHex(match[1]),g:parseIntFromHex(match[2]),b:parseIntFromHex(match[3]),format:named?"name":"hex"}}if(match=matchers.hex3.exec(color)){return{r:parseIntFromHex(match[1]+""+match[1]),g:parseIntFromHex(match[2]+""+match[2]),b:parseIntFromHex(match[3]+""+match[3]),format:named?"name":"hex"}}return false}function validateWCAG2Parms(parms){var level,size;parms=parms||{level:"AA",size:"small"};level=(parms.level||"AA").toUpperCase();size=(parms.size||"small").toLowerCase();if(level!=="AA"&&level!=="AAA"){level="AA"}if(size!=="small"&&size!=="large"){size="small"}return{level:level,size:size}}if(typeof module!=="undefined"&&module.exports){module.exports=tinycolor}else if(true){!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return tinycolor}.call(exports,__webpack_require__,exports,module),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{window.tinycolor=tinycolor}})()},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ChromePointer=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ChromePointer=exports.ChromePointer=function(_ReactCSS$Component){_inherits(ChromePointer,_ReactCSS$Component);function ChromePointer(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,ChromePointer);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ChromePointer.__proto__||Object.getPrototypeOf(ChromePointer)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(ChromePointer,[{key:"classes",value:function classes(){return{default:{picker:{width:"10px",height:"16px",borderRadius:"5px",transform:"translate(-5px, 0px)",backgroundColor:"rgb(248, 248, 248)",boxShadow:"0 1px 4px 0 rgba(0, 0, 0, 0.37)"}}}}},{key:"render",value:function render(){return _react2.default.createElement("div",{style:this.styles().picker})}}]);return ChromePointer}(_reactcss2.default.Component);exports.default=ChromePointer},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ChromePointerCircle=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ChromePointerCircle=exports.ChromePointerCircle=function(_ReactCSS$Component){_inherits(ChromePointerCircle,_ReactCSS$Component);function ChromePointerCircle(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,ChromePointerCircle);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ChromePointerCircle.__proto__||Object.getPrototypeOf(ChromePointerCircle)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_temp),_possibleConstructorReturn(_this,_ret)}_createClass(ChromePointerCircle,[{key:"classes",value:function classes(){return{default:{picker:{width:"12px",height:"12px",borderRadius:"6px",boxShadow:"inset 0 0 0 1px #fff",transform:"translate(-6px, -6px)"}}}}},{key:"render",value:function render(){return _react2.default.createElement("div",{style:this.styles().picker})}}]);return ChromePointerCircle}(_reactcss2.default.Component);exports.default=ChromePointerCircle},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CompactColor=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(3);var _react2=_interopRequireDefault(_react);var _reactcss=__webpack_require__(4);var _reactcss2=_interopRequireDefault(_reactcss);var _reactAddonsShallowCompare=__webpack_require__(17);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var CompactColor=exports.CompactColor=function(_ReactCSS$Component){_inherits(CompactColor,_ReactCSS$Component);function CompactColor(){var _ref;var _temp,_this,_ret;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}_classCallCheck(this,CompactColor);return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=CompactColor.__proto__||Object.getPrototypeOf(CompactColor)).call.apply(_ref,[this].concat(args))),_this),_this.shouldComponentUpdate=_reactAddonsShallowCompare2.default.bind(_this,_this,arguments[0],arguments[1]),_this.handleClick=function(){_this.props.onClick({hex:_this.props.color})},_temp),_possibleConstructorReturn(_this,_ret)}_createClass(CompactColor,[{key:"classes",value:function classes(){return{default:{color:{background:this.props.color,height:"15px",cursor:"pointer",flexGrow:"1"}}}}},{key:"render",value:function render(){return _react2.default.createElement("div",{style:this.styles().color,ref:"color",onClick:this.handleClick})}}]);return CompactColor}(_reactcss2.default.Component);exports.default=CompactColor}]);"use strict";var LiteMol;(function(LiteMol){LiteMol.Promise=__LiteMolPromise})(LiteMol||(LiteMol={}));(function(LiteMol){var Core;(function(Core){"use strict";Core.Rx=__LiteMolRx;Core.Promise=LiteMol.Promise;var Formats;(function(Formats){Formats.CIF=LiteMolCIFTools})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){Core.VERSION={number:"3.2.1",date:"July 5 2017"}})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):new P(function(resolve){resolve(result.value)}).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __generator=this&&this.__generator||function(thisArg,body){var _={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},f,y,t,g;return g={next:verb(0),throw:verb(1),return:verb(2)},typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(_)try{if(f=1,y&&(t=y[op[0]&2?"return":op[0]?"throw":"next"])&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[0,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}};var LiteMol;(function(LiteMol){var Core;(function(Core){"use strict";function computation(c){return new Computation(c)}Core.computation=computation;var Computation=function(){function Computation(computation){this.computation=computation}Computation.prototype.run=function(ctx){return this.runWithContext(ctx).result};Computation.prototype.runWithContext=function(ctx){var _this=this;var context=ctx?ctx:new ContextImpl;return{progress:context.progressStream,result:new Core.Promise(function(resolve,reject){return __awaiter(_this,void 0,void 0,function(){var result,e_1;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,3,4]);context.started();return[4,this.computation(context)];case 1:result=_a.sent();resolve(result);return[3,4];case 2:e_1=_a.sent();if(Computation.PRINT_CONSOLE_ERROR)console.error(e_1);reject(e_1);return[3,4];case 3:context.finished();return[7];case 4:return[2]}})})})}};return Computation}();Core.Computation=Computation;(function(Computation){Computation.PRINT_CONSOLE_ERROR=false;function resolve(a){return computation(function(){return Core.Promise.resolve(a)})}Computation.resolve=resolve;function reject(reason){return computation(function(){return Core.Promise.reject(reason)})}Computation.reject=reject;function createContext(){return new ContextImpl}Computation.createContext=createContext;Computation.Aborted="Aborted";Computation.UpdateProgressDelta=100})(Computation=Core.Computation||(Core.Computation={}));var ContextImpl=function(){function ContextImpl(){var _this=this;this._abortRequested=false;this._abortRequester=function(){_this._abortRequested=true};this.progressTick=new Core.Rx.Subject;this._progress={message:"Working...",current:0,max:0,isIndeterminate:true,requestAbort:void 0};this.progressStream=new Core.Rx.BehaviorSubject(this._progress);this.startEndCounter=0;this.progressTick.throttle(1e3/15).subscribe(function(p){_this.progressStream.onNext({message:p.message,isIndeterminate:p.isIndeterminate,current:p.current,max:p.max,requestAbort:p.requestAbort})})}Object.defineProperty(ContextImpl.prototype,"isAbortRequested",{get:function(){return this._abortRequested},enumerable:true,configurable:true});ContextImpl.prototype.checkAborted=function(){if(this._abortRequested)throw Computation.Aborted};ContextImpl.prototype.requestAbort=function(){try{if(this._abortRequester){this._abortRequester.call(null)}}catch(e){}};Object.defineProperty(ContextImpl.prototype,"progress",{get:function(){return this.progressTick},enumerable:true,configurable:true});ContextImpl.prototype.updateProgress=function(msg,abort,current,max){if(current===void 0){current=NaN}if(max===void 0){max=NaN}this.checkAborted();this._progress.message=msg;if(typeof abort==="boolean"){this._progress.requestAbort=abort?this._abortRequester:void 0}else{if(abort)this._abortRequester=abort;this._progress.requestAbort=abort?this._abortRequester:void 0}if(isNaN(current)){this._progress.isIndeterminate=true}else{this._progress.isIndeterminate=false;this._progress.current=current;this._progress.max=max}this.progressTick.onNext(this._progress);return new Core.Promise(function(res){return setTimeout(res,0)})};ContextImpl.prototype.started=function(){this.startEndCounter++};ContextImpl.prototype.finished=function(){this.startEndCounter--;if(this.startEndCounter<=0){this.progressTick.onCompleted();this.progressStream.onCompleted()}if(this.startEndCounter<0){throw"Bug in code somewhere, Computation.resolve/reject called too many times."}};return ContextImpl}()})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Utils;(function(Utils){"use strict";function createMapObject(){var map=Object.create(null);map["__"]=void 0;delete map["__"];return map}var FastMap;(function(FastMap){function forEach(data,f,ctx){for(var _i=0,_a=Object.keys(data);_i<_a.length;_i++){var key=_a[_i];var v=data[key];if(v===void 0)continue;f(v,key,ctx)}}var fastMap={set:function(key,v){if(this.data[key]===void 0&&v!==void 0){this.size++}this.data[key]=v},get:function(key){return this.data[key]},delete:function(key){if(this.data[key]===void 0)return false;delete this.data[key];this.size--;return true},has:function(key){return this.data[key]!==void 0},clear:function(){this.data=createMapObject();this.size=0},forEach:function(f,ctx){forEach(this.data,f,ctx!==void 0?ctx:void 0)}};function create(){var ret=Object.create(fastMap);ret.data=createMapObject();ret.size=0;return ret}FastMap.create=create;function ofArray(data){var ret=create();for(var _i=0,data_1=data;_i<data_1.length;_i++){var xs=data_1[_i];ret.set(xs[0],xs[1])}return ret}FastMap.ofArray=ofArray;function ofObject(data){var ret=create();for(var _i=0,_a=Object.keys(data);_i<_a.length;_i++){var key=_a[_i];var v=data[key];ret.set(key,v)}return ret}FastMap.ofObject=ofObject})(FastMap=Utils.FastMap||(Utils.FastMap={}));var FastSet;(function(FastSet){function forEach(data,f,ctx){for(var _i=0,_a=Object.keys(data);_i<_a.length;_i++){var p=_a[_i];if(data[p]!==null)continue;f(p,ctx)}}var fastSet={add:function(key){if(this.data[key]===null)return false;this.data[key]=null;this.size++;return true},delete:function(key){if(this.data[key]!==null)return false;delete this.data[key];this.size--;return true},has:function(key){return this.data[key]===null},clear:function(){this.data=createMapObject();this.size=0},forEach:function(f,ctx){forEach(this.data,f,ctx!==void 0?ctx:void 0)}};function create(){var ret=Object.create(fastSet);ret.data=createMapObject();ret.size=0;return ret}FastSet.create=create;function ofArray(xs){var ret=create();for(var i=0,l=xs.length;i<l;i++){ret.add(xs[i])}return ret}FastSet.ofArray=ofArray})(FastSet=Utils.FastSet||(Utils.FastSet={}));var Mask;(function(Mask){var EmptyMask=function(){function EmptyMask(size){this.size=size}EmptyMask.prototype.has=function(i){return false};return EmptyMask}();var SingletonMask=function(){function SingletonMask(idx,size){this.idx=idx;this.size=size}SingletonMask.prototype.has=function(i){return i===this.idx};return SingletonMask}();var BitMask=function(){function BitMask(mask,size){this.mask=mask;this.size=size}BitMask.prototype.has=function(i){return this.mask[i]};return BitMask}();var AllMask=function(){function AllMask(size){this.size=size}AllMask.prototype.has=function(i){return true};return AllMask}();function ofStructure(structure){return new AllMask(structure.data.atoms.count)}Mask.ofStructure=ofStructure;function ofIndices(totalCount,indices){var len=indices.length;if(len===0)return new EmptyMask(totalCount);if(len===1)return new SingletonMask(indices[0],totalCount);var f=len/totalCount;if(f<1/12){var set=Utils.FastSet.create();for(var _i=0,indices_1=indices;_i<indices_1.length;_i++){var i=indices_1[_i];set.add(i)}return set}var mask=new Int8Array(totalCount);for(var _a=0,indices_2=indices;_a<indices_2.length;_a++){var i=indices_2[_a];mask[i]=1}return new BitMask(mask,len)}Mask.ofIndices=ofIndices;function ofFragments(seq){var sizeEstimate=0;for(var _i=0,_a=seq.fragments;_i<_a.length;_i++){var f=_a[_i];sizeEstimate+=f.atomCount}var count=seq.context.structure.data.atoms.count;if(sizeEstimate/count<1/12){var mask=Utils.FastSet.create();for(var _b=0,_c=seq.fragments;_b<_c.length;_b++){var f=_c[_b];for(var _d=0,_e=f.atomIndices;_d<_e.length;_d++){var i=_e[_d];mask.add(i)}}return mask}else{var mask=new Int8Array(count);for(var _f=0,_g=seq.fragments;_f<_g.length;_f++){var f=_g[_f];for(var _h=0,_j=f.atomIndices;_h<_j.length;_h++){var i=_j[_h];mask[i]=1}}var size=0;for(var i=0;i<count;i++){if(mask[i]!==0)size++}return new BitMask(mask,size)}}Mask.ofFragments=ofFragments})(Mask=Utils.Mask||(Utils.Mask={}))})(Utils=Core.Utils||(Core.Utils={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Utils;(function(Utils){"use strict";Utils.FastNumberParsers=Core.Formats.CIF.Utils.FastNumberParsers;function extend(object,source,guard){var v;var s=source;var o=object;var g=guard;for(var _i=0,_a=Object.keys(source);_i<_a.length;_i++){var k=_a[_i];v=s[k];if(v!==void 0)o[k]=v;else if(guard)o[k]=g[k]}if(guard){for(var _b=0,_c=Object.keys(guard);_b<_c.length;_b++){var k=_c[_b];v=o[k];if(v===void 0)o[k]=g[k]}}return object}Utils.extend=extend;function debounce(func,wait){var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=0,trailing=true,leading=false;wait=Math.max(0,wait)||0;var delayed=function(){var remaining=wait-(performance.now()-stamp);if(remaining<=0){if(maxTimeoutId){clearTimeout(maxTimeoutId)}var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=void 0;if(isCalled){lastCalled=performance.now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}}else{timeoutId=setTimeout(delayed,remaining)}};var maxDelayed=function(){if(timeoutId){clearTimeout(timeoutId)}maxTimeoutId=timeoutId=trailingCall=void 0;if(trailing||maxWait!==wait){lastCalled=performance.now();result=func.apply(thisArg,args);if(!timeoutId&&!maxTimeoutId){args=thisArg=null}}};return function(){args=arguments;stamp=performance.now();thisArg=this;trailingCall=trailing&&(timeoutId||!leading);var isCalled=false;var leadingCall=false;if(maxWait===0){leadingCall=leading&&!timeoutId}else{if(!maxTimeoutId&&!leading){lastCalled=stamp}var remaining=maxWait-(stamp-lastCalled),isCalled_1=remaining<=0;if(isCalled_1){if(maxTimeoutId){maxTimeoutId=clearTimeout(maxTimeoutId)}lastCalled=stamp;result=func.apply(thisArg,args)}else if(!maxTimeoutId){maxTimeoutId=setTimeout(maxDelayed,remaining)}}if(isCalled&&timeoutId){timeoutId=clearTimeout(timeoutId)}else if(!timeoutId&&wait!==maxWait){timeoutId=setTimeout(delayed,wait)}if(leadingCall){isCalled=true;result=func.apply(thisArg,args)}if(isCalled&&!timeoutId&&!maxTimeoutId){args=thisArg=null}return result}}Utils.debounce=debounce})(Utils=Core.Utils||(Core.Utils={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Utils;(function(Utils){"use strict";var DataTable;(function(DataTable){function typedColumn(t){return function(size){return new t(size)}}DataTable.typedColumn=typedColumn;function customColumn(){return function(size){return new Array(size)}}DataTable.customColumn=customColumn;DataTable.stringColumn=function(size){return new Array(size)};DataTable.stringNullColumn=function(size){return new Array(size)};function builder(count){return new BuilderImpl(count)}DataTable.builder=builder;function ofDefinition(definition,count){var builder=DataTable.builder(count);for(var _i=0,_a=Object.keys(definition);_i<_a.length;_i++){var k=_a[_i];if(!Object.prototype.hasOwnProperty.call(definition,k))continue;var col=definition[k];if(col){builder.addColumn(k,col)}}return builder.seal()}DataTable.ofDefinition=ofDefinition;function rowReader(table,indexer){var row=Object.create(null);for(var _i=0,_a=table.columns;_i<_a.length;_i++){var _c=_a[_i];(function(c,row,idx,data){Object.defineProperty(row,c.name,{enumerable:true,configurable:false,get:function(){return data[idx.index]}})})(_c,row,indexer,table[_c.name])}return row}var TableImpl=function(){function TableImpl(count,srcColumns,srcData){this.__rowIndexer={index:0};this.count=count;this.indices=new Int32Array(count);this.columns=[];for(var i=0;i<count;i++){this.indices[i]=i}for(var _i=0,srcColumns_1=srcColumns;_i<srcColumns_1.length;_i++){var col=srcColumns_1[_i];var data=srcData[col.name];if(Utils.ChunkedArray.is(data)){data=Utils.ChunkedArray.compact(data)}Object.defineProperty(this,col.name,{enumerable:true,configurable:false,writable:false,value:data});this.columns[this.columns.length]=col}this.__row=rowReader(this,this.__rowIndexer)}TableImpl.prototype.getBuilder=function(count){var b=new BuilderImpl(count);for(var _i=0,_a=this.columns;_i<_a.length;_i++){var c=_a[_i];b.addColumn(c.name,c.creator)}return b};TableImpl.prototype.getRawData=function(){var _this=this;return this.columns.map(function(c){return _this[c.name]})};TableImpl.prototype.getRow=function(i){this.__rowIndexer.index=i;return this.__row};return TableImpl}();var BuilderImpl=function(){function BuilderImpl(count){this.columns=[];this.count=count}BuilderImpl.prototype.addColumn=function(name,creator){var c=creator(this.count);Object.defineProperty(this,name,{enumerable:true,configurable:false,writable:false,value:c});this.columns[this.columns.length]={name:name,creator:creator};return c};BuilderImpl.prototype.addRawColumn=function(name,creator,data){var c=data;Object.defineProperty(this,name,{enumerable:true,configurable:false,writable:false,value:c});this.columns[this.columns.length]={name:name,creator:creator};return c};BuilderImpl.prototype.getRawData=function(){var _this=this;return this.columns.map(function(c){return _this[c.name]})};BuilderImpl.prototype.seal=function(){return new TableImpl(this.count,this.columns,this)};return BuilderImpl}()})(DataTable=Utils.DataTable||(Utils.DataTable={}))})(Utils=Core.Utils||(Core.Utils={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Utils;(function(Utils){"use strict";function integerSetToSortedTypedArray(set){var array=new Int32Array(set.size);set.forEach(function(v,ctx){ctx.array[ctx.index++]=v},{array:array,index:0});Array.prototype.sort.call(array,function(x,y){return x-y});return array}Utils.integerSetToSortedTypedArray=integerSetToSortedTypedArray;function makeNativeIntArray(size){var arr=[];for(var i=0;i<size;i++)arr[i]=0;return arr}Utils.makeNativeIntArray=makeNativeIntArray;function makeNativeFloatArray(size){var arr=[];if(!size)return arr;arr[0]=.1;for(var i=0;i<size;i++)arr[i]=0;return arr}Utils.makeNativeFloatArray=makeNativeFloatArray;var ChunkedArray;(function(ChunkedArray){function is(x){return x.creator&&x.chunkSize}ChunkedArray.is=is;function add4(array,x,y,z,w){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;array.current[array.currentIndex++]=z;array.current[array.currentIndex++]=w;return array.elementCount++}ChunkedArray.add4=add4;function add3(array,x,y,z){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;array.current[array.currentIndex++]=z;return array.elementCount++}ChunkedArray.add3=add3;function add2(array,x,y){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;return array.elementCount++}ChunkedArray.add2=add2;function add(array,x){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;return array.elementCount++}ChunkedArray.add=add;function compact(array){var ret=array.creator(array.elementSize*array.elementCount),offset=(array.parts.length-1)*array.chunkSize,offsetInner=0,part;if(array.parts.length===1&&array.chunkSize===array.elementCount){return array.parts[0]}if(array.parts.length>1){if(array.parts[0].buffer){for(var i=0;i<array.parts.length-1;i++){ret.set(array.parts[i],array.chunkSize*i)}}else{for(var i=0;i<array.parts.length-1;i++){offsetInner=array.chunkSize*i;part=array.parts[i];for(var j=0;j<array.chunkSize;j++){ret[offsetInner+j]=part[j]}}}}if(array.current.buffer&&array.currentIndex>=array.chunkSize){ret.set(array.current,array.chunkSize*(array.parts.length-1))}else{for(var i=0;i<array.currentIndex;i++){ret[offset+i]=array.current[i]}}return ret}ChunkedArray.compact=compact;function forVertex3D(chunkVertexCount){if(chunkVertexCount===void 0){chunkVertexCount=262144}return create(function(size){return new Float32Array(size)},chunkVertexCount,3)}ChunkedArray.forVertex3D=forVertex3D;function forIndexBuffer(chunkIndexCount){if(chunkIndexCount===void 0){chunkIndexCount=262144}return create(function(size){return new Uint32Array(size)},chunkIndexCount,3)}ChunkedArray.forIndexBuffer=forIndexBuffer;function forTokenIndices(chunkTokenCount){if(chunkTokenCount===void 0){chunkTokenCount=131072}return create(function(size){return new Int32Array(size)},chunkTokenCount,2)}ChunkedArray.forTokenIndices=forTokenIndices;function forIndices(chunkTokenCount){if(chunkTokenCount===void 0){chunkTokenCount=131072}return create(function(size){return new Int32Array(size)},chunkTokenCount,1)}ChunkedArray.forIndices=forIndices;function forInt32(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return new Int32Array(size)},chunkSize,1)}ChunkedArray.forInt32=forInt32;function forFloat32(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return new Float32Array(size)},chunkSize,1)}ChunkedArray.forFloat32=forFloat32;function forArray(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return[]},chunkSize,1)}ChunkedArray.forArray=forArray;function create(creator,chunkElementCount,elementSize){chunkElementCount=chunkElementCount|0;if(chunkElementCount<=0)chunkElementCount=1;var chunkSize=chunkElementCount*elementSize;var current=creator(chunkSize);return{elementSize:elementSize,chunkSize:chunkSize,creator:creator,current:current,parts:[current],currentIndex:0,elementCount:0}}ChunkedArray.create=create})(ChunkedArray=Utils.ChunkedArray||(Utils.ChunkedArray={}));var ArrayBuilder;(function(ArrayBuilder){function add3(array,x,y,z){var a=array.array;a[array.currentIndex++]=x;a[array.currentIndex++]=y;a[array.currentIndex++]=z;array.elementCount++}ArrayBuilder.add3=add3;function add2(array,x,y){var a=array.array;a[array.currentIndex++]=x;a[array.currentIndex++]=y;array.elementCount++}ArrayBuilder.add2=add2;function add(array,x){array.array[array.currentIndex++]=x;array.elementCount++}ArrayBuilder.add=add;function forVertex3D(count){return create(function(size){return new Float32Array(size)},count,3)}ArrayBuilder.forVertex3D=forVertex3D;function forIndexBuffer(count){return create(function(size){return new Int32Array(size)},count,3)}ArrayBuilder.forIndexBuffer=forIndexBuffer;function forTokenIndices(count){return create(function(size){return new Int32Array(size)},count,2)}ArrayBuilder.forTokenIndices=forTokenIndices;function forIndices(count){return create(function(size){return new Int32Array(size)},count,1)}ArrayBuilder.forIndices=forIndices;function forInt32(count){return create(function(size){return new Int32Array(size)},count,1)}ArrayBuilder.forInt32=forInt32;function forFloat32(count){return create(function(size){return new Float32Array(size)},count,1)}ArrayBuilder.forFloat32=forFloat32;function forArray(count){return create(function(size){return[]},count,1)}ArrayBuilder.forArray=forArray;function create(creator,chunkElementCount,elementSize){chunkElementCount=chunkElementCount|0;return{array:creator(chunkElementCount*elementSize),currentIndex:0,elementCount:0}}ArrayBuilder.create=create})(ArrayBuilder=Utils.ArrayBuilder||(Utils.ArrayBuilder={}));function UniqueArray(){return{_set:Utils.FastSet.create(),array:[]}}Utils.UniqueArray=UniqueArray;(function(UniqueArray){function add(_a,e){var _set=_a._set,array=_a.array;if(!_set.has(e)){_set.add(e);array[array.length]=e}}UniqueArray.add=add})(UniqueArray=Utils.UniqueArray||(Utils.UniqueArray={}))})(Utils=Core.Utils||(Core.Utils={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Utils;(function(Utils){"use strict";var PerformanceHelper;(function(PerformanceHelper){PerformanceHelper.perfGetTime=function(){if(typeof window!=="undefined"&&window.performance){return function(){return window.performance.now()}}else if(typeof process!=="undefined"&&process.hrtime!=="undefined"){return function(){var t=process.hrtime();return t[0]*1e3+t[1]/1e6}}else{return function(){return+new Date}}}()})(PerformanceHelper||(PerformanceHelper={}));var PerformanceMonitor=function(){function PerformanceMonitor(){this.starts=Utils.FastMap.create();this.ends=Utils.FastMap.create()}PerformanceMonitor.currentTime=function(){return PerformanceHelper.perfGetTime()};PerformanceMonitor.prototype.start=function(name){this.starts.set(name,PerformanceHelper.perfGetTime())};PerformanceMonitor.prototype.end=function(name){this.ends.set(name,PerformanceHelper.perfGetTime())};PerformanceMonitor.format=function(t){if(isNaN(t))return"n/a";var h=Math.floor(t/(60*60*1e3)),m=Math.floor(t/(60*1e3)%60),s=Math.floor(t/1e3%60),ms=Math.floor(t%1e3).toString();while(ms.length<3)ms="0"+ms;if(h>0)return h+"h"+m+"m"+s+"."+ms+"s";if(m>0)return m+"m"+s+"."+ms+"s";if(s>0)return s+"."+ms+"s";return t.toFixed(0)+"ms"};PerformanceMonitor.prototype.formatTime=function(name){return PerformanceMonitor.format(this.time(name))};PerformanceMonitor.prototype.formatTimeSum=function(){var names=[];for(var _i=0;_i<arguments.length;_i++){names[_i]=arguments[_i]}return PerformanceMonitor.format(this.timeSum.apply(this,names))};PerformanceMonitor.prototype.time=function(name){var start=this.starts.get(name),end=this.ends.get(name);this.starts.delete(name);this.ends.delete(name);return end-start};PerformanceMonitor.prototype.timeSum=function(){var _this=this;var names=[];for(var _i=0;_i<arguments.length;_i++){names[_i]=arguments[_i]}var t=0;for(var _a=0,_b=names.map(function(n){return _this.ends.get(n)-_this.starts.get(n)});_a<_b.length;_a++){var m=_b[_a];t+=m}return t};return PerformanceMonitor}();Utils.PerformanceMonitor=PerformanceMonitor})(Utils=Core.Utils||(Core.Utils={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){"use strict";var FormatInfo;(function(FormatInfo){function is(o){return o.name&&o.parse}FormatInfo.is=is;function fromShortcut(all,name){name=name.toLowerCase().trim();for(var _i=0,all_1=all;_i<all_1.length;_i++){var f=all_1[_i];for(var _a=0,_b=f.shortcuts;_a<_b.length;_a++){var s=_b[_a];if(s.toLowerCase()===name)return f}}return void 0}FormatInfo.fromShortcut=fromShortcut;function formatRegExp(info){return new RegExp(info.extensions.map(function(e){return"(\\"+e+")"}).join("|")+"(\\.gz){0,1}$","i")}FormatInfo.formatRegExp=formatRegExp;function formatFileFilters(all){return all.map(function(info){return info.extensions.map(function(e){return e+","+e+".gz"}).join(",")}).join(",")}FormatInfo.formatFileFilters=formatFileFilters;function getFormat(filename,all){for(var _i=0,all_2=all;_i<all_2.length;_i++){var f=all_2[_i];if(formatRegExp(f).test(filename))return f}return void 0}FormatInfo.getFormat=getFormat})(FormatInfo=Formats.FormatInfo||(Formats.FormatInfo={}));var ParserResult;(function(ParserResult){function error(message,line){if(line===void 0){line=-1}return new ParserError(message,line)}ParserResult.error=error;function success(result,warnings){if(warnings===void 0){warnings=[]}return new ParserSuccess(result,warnings)}ParserResult.success=success})(ParserResult=Formats.ParserResult||(Formats.ParserResult={}));var ParserError=function(){function ParserError(message,line){this.message=message;this.line=line;this.isError=true}ParserError.prototype.toString=function(){if(this.line>=0){return"[Line "+this.line+"] "+this.message}return this.message};return ParserError}();Formats.ParserError=ParserError;var ParserSuccess=function(){function ParserSuccess(result,warnings){this.result=result;this.warnings=warnings;this.isError=false}return ParserSuccess}();Formats.ParserSuccess=ParserSuccess;var TokenIndexBuilder;(function(TokenIndexBuilder){function resize(builder){var newBuffer=new Int32Array(Math.round(1.61*builder.tokens.length));newBuffer.set(builder.tokens);builder.tokens=newBuffer;builder.tokensLenMinus2=newBuffer.length-2}function addToken(builder,start,end){if(builder.count>=builder.tokensLenMinus2){resize(builder)}builder.tokens[builder.count++]=start;builder.tokens[builder.count++]=end}TokenIndexBuilder.addToken=addToken;function create(size){return{tokensLenMinus2:Math.round(size)-2,count:0,tokens:new Int32Array(size)}}TokenIndexBuilder.create=create})(TokenIndexBuilder=Formats.TokenIndexBuilder||(Formats.TokenIndexBuilder={}));var ShortStringPool;(function(ShortStringPool){function create(){return Object.create(null)}ShortStringPool.create=create;function get(pool,str){if(str.length>6)return str;var value=pool[str];if(value!==void 0)return value;pool[str]=str;return str}ShortStringPool.get=get})(ShortStringPool=Formats.ShortStringPool||(Formats.ShortStringPool={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Molecule;(function(Molecule){var mmCIF;(function(mmCIF){"use strict";var Defaults;(function(Defaults){Defaults.ElementSymbol="X";Defaults.ResidueName="UNK";Defaults.AsymId="";Defaults.EntityId="1";Defaults.ModelId="1"})(Defaults||(Defaults={}));function getTransform(category,matrixField,translationField,row){var ret=Core.Geometry.LinearAlgebra.Matrix4.identity(),i,j,c;for(i=1;i<=3;i++){for(j=1;j<=3;j++){c=matrixField+"["+i+"]["+j+"]";Core.Geometry.LinearAlgebra.Matrix4.setValue(ret,i-1,j-1,category.getColumn(matrixField+"["+i+"]["+j+"]").getFloat(row))}Core.Geometry.LinearAlgebra.Matrix4.setValue(ret,i-1,3,category.getColumn(translationField+"["+i+"]").getFloat(row))}return ret}function getModelEndRow(startRow,rowCount,modelNum){var i=0;if(!modelNum||!modelNum.isDefined)return rowCount;for(i=startRow+1;i<rowCount;i++){if(!modelNum.areValuesEqual(i-1,i))break}return i}var AtomSiteColumns=["id","Cartn_x","Cartn_y","Cartn_z","label_atom_id","type_symbol","occupancy","B_iso_or_equiv","auth_atom_id","label_alt_id","label_comp_id","label_seq_id","label_asym_id","auth_comp_id","auth_seq_id","auth_asym_id","group_PDB","label_entity_id","pdbx_PDB_ins_code","pdbx_PDB_model_num"];function getAtomSiteColumns(category){var ret=Core.Utils.FastMap.create();for(var _a=0,AtomSiteColumns_1=AtomSiteColumns;_a<AtomSiteColumns_1.length;_a++){var c=AtomSiteColumns_1[_a];ret.set(c,category.getColumn(c))}return ret}function buildModelAtomTable(startRow,rowCount,columns){var endRow=getModelEndRow(startRow,rowCount,columns.get("pdbx_PDB_model_num"));var atoms=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Atoms,endRow-startRow),positions=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Positions,endRow-startRow),pX=positions.x,pXCol=columns.get("Cartn_x"),pY=positions.y,pYCol=columns.get("Cartn_y"),pZ=positions.z,pZCol=columns.get("Cartn_z"),id=atoms.id,idCol=columns.get("id"),altLoc=atoms.altLoc,altLocCol=columns.get("label_alt_id"),rowIndex=atoms.rowIndex,residueIndex=atoms.residueIndex,chainIndex=atoms.chainIndex,entityIndex=atoms.entityIndex,name=atoms.name,nameCol=columns.get("label_atom_id"),elementSymbol=atoms.elementSymbol,elementSymbolCol=columns.get("type_symbol"),occupancy=atoms.occupancy,occupancyCol=columns.get("occupancy"),tempFactor=atoms.tempFactor,tempFactorCol=columns.get("B_iso_or_equiv"),authName=atoms.authName,authNameCol=columns.get("auth_atom_id");var asymIdCol=columns.get("label_asym_id"),entityIdCol=columns.get("label_entity_id"),insCodeCol=columns.get("pdbx_PDB_ins_code"),authResSeqNumberCol=columns.get("auth_seq_id"),modelNumCol=columns.get("pdbx_PDB_model_num"),numChains=0,numResidues=0,numEntities=0;var prev=startRow;for(var row=startRow;row<endRow;row++){var index=row-startRow;id[index]=idCol.getInteger(row);pX[index]=pXCol.getFloat(row);pY[index]=pYCol.getFloat(row);pZ[index]=pZCol.getFloat(row);elementSymbol[index]=elementSymbolCol.getString(row)||Defaults.ElementSymbol;name[index]=nameCol.getString(row)||elementSymbol[index];authName[index]=authNameCol.getString(row)||name[index];altLoc[index]=altLocCol.getString(row);occupancy[index]=occupancyCol.getFloat(row);tempFactor[index]=tempFactorCol.getFloat(row);var newChain=false;var newResidue=!authResSeqNumberCol.areValuesEqual(prev,row)||!insCodeCol.areValuesEqual(prev,row);if(!asymIdCol.areValuesEqual(prev,row)){newChain=true;newResidue=true}if(!entityIdCol.areValuesEqual(prev,row)){numEntities++;newChain=true;newResidue=true}if(newResidue)numResidues++;if(newChain)numChains++;rowIndex[index]=row;residueIndex[index]=numResidues;chainIndex[index]=numChains;entityIndex[index]=numEntities;prev=row}var modelId=!modelNumCol.isDefined?Defaults.ModelId:modelNumCol.getString(startRow)||Defaults.ModelId;return{atoms:atoms,positions:positions,modelId:modelId,endRow:endRow}}function buildStructure(columns,atoms){var count=atoms.count,residueIndexCol=atoms.residueIndex,chainIndexCol=atoms.chainIndex,entityIndexCol=atoms.entityIndex;var residues=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Residues,atoms.residueIndex[atoms.count-1]+1),chains=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Chains,atoms.chainIndex[atoms.count-1]+1),entities=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Entities,atoms.entityIndex[atoms.count-1]+1);var residueName=residues.name,residueSeqNumber=residues.seqNumber,residueAsymId=residues.asymId,residueAuthName=residues.authName,residueAuthSeqNumber=residues.authSeqNumber,residueAuthAsymId=residues.authAsymId,residueInsertionCode=residues.insCode,residueEntityId=residues.entityId,residueIsHet=residues.isHet,residueAtomStartIndex=residues.atomStartIndex,residueAtomEndIndex=residues.atomEndIndex,residueChainIndex=residues.chainIndex,residueEntityIndex=residues.entityIndex;var chainAsymId=chains.asymId,chainEntityId=chains.entityId,chainAuthAsymId=chains.authAsymId,chainAtomStartIndex=chains.atomStartIndex,chainAtomEndIndex=chains.atomEndIndex,chainResidueStartIndex=chains.residueStartIndex,chainResidueEndIndex=chains.residueEndIndex,chainEntityIndex=chains.entityIndex;var entityId=entities.entityId,entityType=entities.type,entityAtomStartIndex=entities.atomStartIndex,entityAtomEndIndex=entities.atomEndIndex,entityResidueStartIndex=entities.residueStartIndex,entityResidueEndIndex=entities.residueEndIndex,entityChainStartIndex=entities.chainStartIndex,entityChainEndIndex=entities.chainEndIndex;var resNameCol=columns.get("label_comp_id"),resSeqNumberCol=columns.get("label_seq_id"),asymIdCol=columns.get("label_asym_id"),authResNameCol=columns.get("auth_comp_id"),authResSeqNumberCol=columns.get("auth_seq_id"),authAsymIdCol=columns.get("auth_asym_id"),isHetCol=columns.get("group_PDB"),entityCol=columns.get("label_entity_id"),insCodeCol=columns.get("pdbx_PDB_ins_code");var residueStart=0,chainStart=0,entityStart=0,entityChainStart=0,entityResidueStart=0,chainResidueStart=0,currentResidue=0,currentChain=0,currentEntity=0;var i=0;for(i=0;i<count;i++){if(residueIndexCol[i]!==residueIndexCol[residueStart]){residueName[currentResidue]=resNameCol.getString(residueStart)||Defaults.ResidueName;residueSeqNumber[currentResidue]=resSeqNumberCol.getInteger(residueStart);residueAsymId[currentResidue]=asymIdCol.getString(residueStart)||Defaults.AsymId;residueAuthName[currentResidue]=authResNameCol.getString(residueStart)||residueName[currentResidue];residueAuthSeqNumber[currentResidue]=authResSeqNumberCol.getInteger(residueStart);residueAuthAsymId[currentResidue]=authAsymIdCol.getString(residueStart)||residueAsymId[currentResidue];residueInsertionCode[currentResidue]=insCodeCol.getString(residueStart);residueEntityId[currentResidue]=entityCol.getString(residueStart)||Defaults.EntityId;residueIsHet[currentResidue]=isHetCol.stringEquals(residueStart,"HETATM")?1:0;residueAtomStartIndex[currentResidue]=residueStart;residueAtomEndIndex[currentResidue]=i;residueChainIndex[currentResidue]=currentChain;residueEntityIndex[currentResidue]=currentEntity;currentResidue++;residueStart=i}if(chainIndexCol[i]!==chainIndexCol[chainStart]){chainAsymId[currentChain]=asymIdCol.getString(chainStart)||Defaults.AsymId;chainAuthAsymId[currentChain]=authAsymIdCol.getString(chainStart)||chainAsymId[currentChain];chainEntityId[currentChain]=entityCol.getString(chainStart)||Defaults.EntityId;chainResidueStartIndex[currentChain]=chainResidueStart;chainResidueEndIndex[currentChain]=currentResidue;chainAtomStartIndex[currentChain]=chainStart;chainAtomEndIndex[currentChain]=i;chainEntityIndex[currentChain]=currentEntity;currentChain++;chainStart=i;chainResidueStart=currentResidue}if(entityIndexCol[i]!==entityIndexCol[entityStart]){entityId[currentEntity]=entityCol.getString(entityStart)||Defaults.EntityId;entityType[currentEntity]="unknown";entityAtomStartIndex[currentEntity]=entityStart;entityAtomEndIndex[currentEntity]=i;entityResidueStartIndex[currentEntity]=entityResidueStart;entityResidueEndIndex[currentEntity]=currentResidue;entityChainStartIndex[currentEntity]=entityChainStart;entityChainEndIndex[currentEntity]=currentChain;currentEntity++;entityStart=i;entityChainStart=currentChain;entityResidueStart=currentResidue}}entityId[currentEntity]=entityCol.getString(entityStart)||Defaults.EntityId;entityType[currentEntity]="unknown";entityAtomStartIndex[currentEntity]=entityStart;entityAtomEndIndex[currentEntity]=i;entityResidueStartIndex[currentEntity]=entityResidueStart;entityResidueEndIndex[currentEntity]=currentResidue+1;entityChainStartIndex[currentEntity]=entityChainStart;entityChainEndIndex[currentEntity]=currentChain+1;chainAsymId[currentChain]=asymIdCol.getString(chainStart)||Defaults.AsymId;chainAuthAsymId[currentChain]=authAsymIdCol.getString(chainStart)||chainAsymId[currentChain];chainEntityId[currentChain]=entityCol.getString(chainStart)||Defaults.EntityId;chainResidueStartIndex[currentChain]=chainResidueStart;chainResidueEndIndex[currentChain]=currentResidue+1;chainAtomStartIndex[currentChain]=chainStart;chainAtomEndIndex[currentChain]=i;chainEntityIndex[currentChain]=currentEntity;residueName[currentResidue]=resNameCol.getString(residueStart)||Defaults.ResidueName;residueSeqNumber[currentResidue]=resSeqNumberCol.getInteger(residueStart);residueAsymId[currentResidue]=asymIdCol.getString(residueStart)||Defaults.AsymId;residueAuthName[currentResidue]=authResNameCol.getString(residueStart)||residueName[currentResidue];residueAuthSeqNumber[currentResidue]=authResSeqNumberCol.getInteger(residueStart);residueAuthAsymId[currentResidue]=authAsymIdCol.getString(residueStart)||residueAsymId[currentResidue];residueInsertionCode[currentResidue]=insCodeCol.getString(residueStart);residueAtomStartIndex[currentResidue]=residueStart;residueAtomEndIndex[currentResidue]=i;residueChainIndex[currentResidue]=currentChain;residueEntityIndex[currentResidue]=currentEntity;residueIsHet[currentResidue]=isHetCol.stringEquals(residueStart,"HETATM")?1:0;return{residues:residues,chains:chains,entities:entities}}function assignEntityTypes(category,entities){var i;if(!category){return}var data={},typeCol=category.getColumn("type"),idCol=category.getColumn("id");for(i=0;i<category.rowCount;i++){var t=(typeCol.getString(i)||"").toLowerCase();var eId=idCol.getString(i)||Defaults.EntityId;switch(t){case"polymer":case"non-polymer":case"water":data[eId]=t;break;default:data[eId]="unknown";break}}for(i=0;i<entities.count;i++){var et=data[entities.entityId[i]];if(et!==void 0){entities.type[i]=et}}}function residueIdfromColumns(row,asymId,seqNum,insCode){return new Core.Structure.PolyResidueIdentifier(asymId.getString(row)||Defaults.AsymId,seqNum.getInteger(row),insCode.getString(row))}var aminoAcidNames={ALA:true,ARG:true,ASP:true,CYS:true,GLN:true,GLU:true,GLY:true,HIS:true,ILE:true,LEU:true,LYS:true,MET:true,PHE:true,PRO:true,SER:true,THR:true,TRP:true,TYR:true,VAL:true,ASN:true,PYL:true,SEC:true};function isResidueAminoSeq(atoms,residues,entities,index){if(entities.type[residues.entityIndex[index]]!=="polymer")return false;var ca=false,o=false,names=atoms.name,assigned=0;for(var i=residues.atomStartIndex[index],max=residues.atomEndIndex[index];i<max;i++){var n=names[i];if(!ca&&n==="CA"){ca=true;assigned++}else if(!o&&n==="O"){o=true;assigned++}if(assigned===2)break}return ca&&o||ca&&!residues.isHet[index]}function isResidueNucleotide(atoms,residues,entities,index){if(aminoAcidNames[residues.name[index]]||entities.type[residues.entityIndex[index]]!=="polymer")return false;var names=atoms.name,assigned=0;var start=residues.atomStartIndex[index],end=residues.atomEndIndex[index];if(end-start===1&&!residues.isHet[start]&&names[start]==="P"){return true}for(var i=start;i<end;i++){var n=names[i];if(n==="O5'"||n==="C3'"||n==="N3"||n==="P"){assigned++}if(assigned>=3){return true}}return false}function analyzeSecondaryStructure(atoms,residues,entities,start,end,elements){var asymId=residues.asymId,entityIndex=residues.entityIndex,currentType=0,currentElementStartIndex=start,currentResidueIndex=start,residueCount=end;while(currentElementStartIndex<residueCount){if(isResidueNucleotide(atoms,residues,entities,currentElementStartIndex)){currentResidueIndex=currentElementStartIndex+1;while(currentResidueIndex<residueCount&&asymId[currentElementStartIndex]===asymId[currentResidueIndex]&&entityIndex[currentElementStartIndex]===entityIndex[currentResidueIndex]&&isResidueNucleotide(atoms,residues,entities,currentResidueIndex)){currentResidueIndex++}currentType=5}else if(isResidueAminoSeq(atoms,residues,entities,currentElementStartIndex)){currentResidueIndex=currentElementStartIndex+1;while(currentResidueIndex<residueCount&&asymId[currentElementStartIndex]===asymId[currentResidueIndex]&&entityIndex[currentElementStartIndex]===entityIndex[currentResidueIndex]&&isResidueAminoSeq(atoms,residues,entities,currentResidueIndex)){currentResidueIndex++}currentType=4}else{currentResidueIndex=currentElementStartIndex+1;while(currentResidueIndex<residueCount&&asymId[currentElementStartIndex]===asymId[currentResidueIndex]&&entityIndex[currentElementStartIndex]===entityIndex[currentResidueIndex]&&!isResidueNucleotide(atoms,residues,entities,currentResidueIndex)&&!isResidueAminoSeq(atoms,residues,entities,currentResidueIndex)){currentResidueIndex++}currentType=0}var e=new Core.Structure.SecondaryStructureElement(currentType,new Core.Structure.PolyResidueIdentifier(residues.asymId[currentElementStartIndex],residues.seqNumber[currentElementStartIndex],residues.insCode[currentElementStartIndex]),new Core.Structure.PolyResidueIdentifier(residues.asymId[currentResidueIndex-1],residues.seqNumber[currentResidueIndex-1],residues.insCode[currentResidueIndex-1]));e.startResidueIndex=currentElementStartIndex;e.endResidueIndex=currentResidueIndex;elements[elements.length]=e;currentElementStartIndex=currentResidueIndex}}function splitNonconsecutiveSecondaryStructure(residues,elements){var ret=[];var authSeqNumber=residues.authSeqNumber;for(var _a=0,elements_1=elements;_a<elements_1.length;_a++){var s=elements_1[_a];var partStart=s.startResidueIndex;var end=s.endResidueIndex-1;for(var i=s.startResidueIndex;i<end;i++){if(authSeqNumber[i+1]-authSeqNumber[i]===1)continue;var e=new Core.Structure.SecondaryStructureElement(s.type,s.startResidueId,s.endResidueId,s.info);e.startResidueIndex=partStart;e.endResidueIndex=i+1;ret[ret.length]=e;partStart=i+1}if(partStart===s.startResidueIndex){ret[ret.length]=s}else{var e=new Core.Structure.SecondaryStructureElement(s.type,s.startResidueId,s.endResidueId,s.info);e.startResidueIndex=partStart;e.endResidueIndex=s.endResidueIndex;ret[ret.length]=e}}return ret}function updateSSIndicesAndFilterEmpty(elements,structure){var residues=structure.residues,count=residues.count,asymId=residues.asymId,seqNumber=residues.seqNumber,insCode=residues.insCode,currentElement=void 0,key="",starts=Core.Utils.FastMap.create(),ends=Core.Utils.FastMap.create();for(var _a=0,elements_2=elements;_a<elements_2.length;_a++){var e=elements_2[_a];key=e.startResidueId.asymId+" "+e.startResidueId.seqNumber;if(e.startResidueId.insCode)key+=" "+e.startResidueId.insCode;starts.set(key,e);key=e.endResidueId.asymId+" "+e.endResidueId.seqNumber;if(e.endResidueId.insCode)key+=" "+e.endResidueId.insCode;ends.set(key,e)}for(var i=0;i<count;i++){key=asymId[i]+" "+seqNumber[i];if(insCode[i])key+=" "+insCode[i];currentElement=starts.get(key);if(currentElement){currentElement.startResidueIndex=i;currentElement.endResidueIndex=i+1}currentElement=ends.get(key);if(currentElement){if(currentElement.startResidueIndex<0)currentElement.startResidueIndex=i;currentElement.endResidueIndex=i+1}}if(currentElement){currentElement.endResidueIndex=count}var nonEmpty=[];for(var _b=0,elements_3=elements;_b<elements_3.length;_b++){var e=elements_3[_b];if(e.startResidueIndex<0||e.endResidueIndex<0)continue;if(e.type===3&&e.length<3)continue;if(e.endResidueIndex>=0&&e.startResidueIndex>=0)nonEmpty[nonEmpty.length]=e}nonEmpty.sort(function(a,b){return a.startResidueIndex-b.startResidueIndex});for(var i=0;i<nonEmpty.length-1;i++){if(nonEmpty[i+1].startResidueIndex-nonEmpty[i].endResidueIndex===-1){nonEmpty[i+1].startResidueIndex++}}if(!nonEmpty.length)return nonEmpty;var ret=[nonEmpty[0]];for(var i=1;i<nonEmpty.length;i++){var a=ret[ret.length-1],b=nonEmpty[i];if(b.startResidueIndex<a.endResidueIndex){handleSecondaryStructureCollision(a,b)}else{ret[ret.length]=b}}return ret}function handleSecondaryStructureCollision(a,b){if(b.endResidueIndex>a.endResidueIndex){a.endResidueIndex=b.endResidueIndex}}function getSecondaryStructureInfo(data,atoms,structure){var input=[],elements=[];var _struct_conf=data.getCategory("_struct_conf"),_struct_sheet_range=data.getCategory("_struct_sheet_range"),i;if(_struct_conf){var type_id_col=_struct_conf.getColumn("conf_type_id");if(type_id_col){var beg_label_asym_id=_struct_conf.getColumn("beg_label_asym_id");var beg_label_seq_id=_struct_conf.getColumn("beg_label_seq_id");var pdbx_beg_PDB_ins_code=_struct_conf.getColumn("pdbx_beg_PDB_ins_code");var end_label_asym_id=_struct_conf.getColumn("end_label_asym_id");var end_label_seq_id=_struct_conf.getColumn("end_label_seq_id");var pdbx_end_PDB_ins_code=_struct_conf.getColumn("pdbx_end_PDB_ins_code");var pdbx_PDB_helix_class=_struct_conf.getColumn("pdbx_PDB_helix_class");for(i=0;i<_struct_conf.rowCount;i++){var type=void 0;switch((type_id_col.getString(i)||"").toUpperCase()){case"HELX_P":type=1;break;case"TURN_P":type=2;break}if(!type)continue;input[input.length]=new Core.Structure.SecondaryStructureElement(type,residueIdfromColumns(i,beg_label_asym_id,beg_label_seq_id,pdbx_beg_PDB_ins_code),residueIdfromColumns(i,end_label_asym_id,end_label_seq_id,pdbx_end_PDB_ins_code),{helixClass:pdbx_PDB_helix_class.getString(i)})}}}if(_struct_sheet_range){var beg_label_asym_id=_struct_sheet_range.getColumn("beg_label_asym_id");var beg_label_seq_id=_struct_sheet_range.getColumn("beg_label_seq_id");var pdbx_beg_PDB_ins_code=_struct_sheet_range.getColumn("pdbx_beg_PDB_ins_code");var end_label_asym_id=_struct_sheet_range.getColumn("end_label_asym_id");var end_label_seq_id=_struct_sheet_range.getColumn("end_label_seq_id");var pdbx_end_PDB_ins_code=_struct_sheet_range.getColumn("pdbx_end_PDB_ins_code");var symmetry=_struct_sheet_range.getColumn("symmetry");var sheet_id=_struct_sheet_range.getColumn("sheet_id");var id=_struct_sheet_range.getColumn("id");for(i=0;i<_struct_sheet_range.rowCount;i++){input[input.length]=new Core.Structure.SecondaryStructureElement(3,residueIdfromColumns(i,beg_label_asym_id,beg_label_seq_id,pdbx_beg_PDB_ins_code),residueIdfromColumns(i,end_label_asym_id,end_label_seq_id,pdbx_end_PDB_ins_code),{symmetry:symmetry.getString(i),sheetId:sheet_id.getString(i),id:id.getString(i)})}}var secondary=input.length>0?updateSSIndicesAndFilterEmpty(input,structure):[];var residues=structure.residues,residueCount=residues.count;if(secondary.length===0){analyzeSecondaryStructure(atoms,residues,structure.entities,0,residueCount,elements);return splitNonconsecutiveSecondaryStructure(residues,elements)}var _max=secondary.length-1;if(secondary[0].startResidueIndex>0){analyzeSecondaryStructure(atoms,residues,structure.entities,0,secondary[0].startResidueIndex,elements)}for(i=0;i<_max;i++){elements[elements.length]=secondary[i];if(secondary[i+1].startResidueIndex-secondary[i].endResidueIndex>0){analyzeSecondaryStructure(atoms,residues,structure.entities,secondary[i].endResidueIndex,secondary[i+1].startResidueIndex,elements)}}elements[elements.length]=secondary[_max];if(secondary[_max].endResidueIndex<residueCount){analyzeSecondaryStructure(atoms,residues,structure.entities,secondary[_max].endResidueIndex,residueCount,elements)}return splitNonconsecutiveSecondaryStructure(residues,elements)}function assignSecondaryStructureIndex(residues,ss){var ssIndex=residues.secondaryStructureIndex;var index=0;for(var _a=0,ss_1=ss;_a<ss_1.length;_a++){var s=ss_1[_a];for(var i=s.startResidueIndex;i<s.endResidueIndex;i++){ssIndex[i]=index}index++}return ssIndex}function findResidueIndexByLabel(structure,asymId,seqNumber,insCode){var _a=structure.chains,_asymId=_a.asymId,residueStartIndex=_a.residueStartIndex,residueEndIndex=_a.residueEndIndex,cCount=_a.count;var _b=structure.residues,_seqNumber=_b.seqNumber,_insCode=_b.insCode;for(var cI=0;cI<cCount;cI++){if(_asymId[cI]!==asymId)continue;for(var rI=residueStartIndex[cI],_r=residueEndIndex[cI];rI<_r;rI++){if(_seqNumber[rI]===seqNumber&&_insCode[rI]===insCode)return rI}}return-1}function findAtomIndexByLabelName(atoms,structure,residueIndex,atomName,altLoc){var _a=structure.residues,atomStartIndex=_a.atomStartIndex,atomEndIndex=_a.atomEndIndex;var _atomName=atoms.name,_altLoc=atoms.altLoc;for(var i=atomStartIndex[residueIndex],_i=atomEndIndex[residueIndex];i<=_i;i++){if(_atomName[i]===atomName&&_altLoc[i]===altLoc)return i}return-1}function getModRes(data){var cat=data.getCategory("_pdbx_struct_mod_residue");if(!cat)return void 0;var table=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.ModifiedResidues,cat.rowCount);var label_asym_id=cat.getColumn("label_asym_id");var label_seq_id=cat.getColumn("label_seq_id");var PDB_ins_code=cat.getColumn("PDB_ins_code");var parent_comp_id=cat.getColumn("parent_comp_id");var _details=cat.getColumn("details");var asymId=table.asymId,seqNumber=table.seqNumber,insCode=table.insCode,parent=table.parent,details=table.details;for(var i=0,__i=cat.rowCount;i<__i;i++){asymId[i]=label_asym_id.getString(i);seqNumber[i]=label_seq_id.getInteger(i);insCode[i]=PDB_ins_code.getString(i);parent[i]=parent_comp_id.getString(i);details[i]=_details.getString(i)}return table}function getStructConn(data,atoms,structure){var cat=data.getCategory("_struct_conn");if(!cat)return void 0;var _idCols=function(i){return{label_asym_id:cat.getColumn("ptnr"+i+"_label_asym_id"),label_seq_id:cat.getColumn("ptnr"+i+"_label_seq_id"),label_atom_id:cat.getColumn("ptnr"+i+"_label_atom_id"),label_alt_id:cat.getColumn("pdbx_ptnr"+i+"_label_alt_id"),ins_code:cat.getColumn("pdbx_ptnr"+i+"_PDB_ins_code"),symmetry:cat.getColumn("ptnr"+i+"_symmetry")}};var conn_type_id=cat.getColumn("conn_type_id");var pdbx_dist_value=cat.getColumn("pdbx_dist_value");var pdbx_value_order=cat.getColumn("pdbx_value_order");var p1=_idCols(1);var p2=_idCols(2);var p3=_idCols(3);var _p=function(row,ps){if(ps.label_asym_id.getValuePresence(row)!==0)return void 0;var residueIndex=findResidueIndexByLabel(structure,ps.label_asym_id.getString(row),ps.label_seq_id.getInteger(row),ps.ins_code.getString(row));if(residueIndex<0)return void 0;var atomIndex=findAtomIndexByLabelName(atoms,structure,residueIndex,ps.label_atom_id.getString(row),ps.label_alt_id.getString(row));if(atomIndex<0)return void 0;return{residueIndex:residueIndex,atomIndex:atomIndex,symmetry:ps.symmetry.getString(row)||"1_555"}};var _ps=function(row){var ret=[];var p=_p(row,p1);if(p)ret.push(p);p=_p(row,p2);if(p)ret.push(p);p=_p(row,p3);if(p)ret.push(p);return ret};var entries=[];for(var i=0;i<cat.rowCount;i++){var partners=_ps(i);if(partners.length<2)continue;var type=conn_type_id.getString(i);var orderType=(pdbx_value_order.getString(i)||"").toLowerCase();var bondType=0;switch(orderType){case"sing":bondType=1;break;case"doub":bondType=2;break;case"trip":bondType=3;break;case"quad":bondType=4;break}switch(type){case"disulf":bondType=5;break;case"hydrog":bondType=8;break;case"metalc":bondType=6;break;case"saltbr":bondType=7;break}entries.push({bondType:bondType,distance:pdbx_dist_value.getFloat(i),partners:partners})}return new Core.Structure.StructConn(entries)}function parseOperatorList(value){var oeRegex=/\(?([^\(\)]+)\)?]*/g,g,groups=[],ret=[];while(g=oeRegex.exec(value))groups[groups.length]=g[1];groups.forEach(function(g){var group=[];g.split(",").forEach(function(e){var dashIndex=e.indexOf("-");if(dashIndex>0){var from=parseInt(e.substring(0,dashIndex)),to=parseInt(e.substr(dashIndex+1));for(var i=from;i<=to;i++)group[group.length]=i.toString()}else{group[group.length]=e.trim()}});ret[ret.length]=group});return ret}function getAssemblyInfo(data){var _info=data.getCategory("_pdbx_struct_assembly"),_gen=data.getCategory("_pdbx_struct_assembly_gen"),_opers=data.getCategory("_pdbx_struct_oper_list");if(!_info||!_gen||!_opers){return void 0}var i,opers={},gens=[],genMap=Core.Utils.FastMap.create();var assembly_id=_gen.getColumn("assembly_id");var oper_expression=_gen.getColumn("oper_expression");var asym_id_list=_gen.getColumn("asym_id_list");for(i=0;i<_gen.rowCount;i++){var id=assembly_id.getString(i);if(!id){return void 0}var entry=genMap.get(id);if(!entry){entry=new Core.Structure.AssemblyGen(id);genMap.set(id,entry);gens.push(entry)}entry.gens.push(new Core.Structure.AssemblyGenEntry(parseOperatorList(oper_expression.getString(i)),asym_id_list.getString(i).split(",")))}var _pdbx_struct_oper_list_id=_opers.getColumn("id");var _pdbx_struct_oper_list_name=_opers.getColumn("name");for(i=0;i<_opers.rowCount;i++){var oper=getTransform(_opers,"matrix","vector",i);if(!oper){return void 0}var op=new Core.Structure.AssemblyOperator(_pdbx_struct_oper_list_id.getString(i),_pdbx_struct_oper_list_name.getString(i),oper);opers[op.id]=op}return new Core.Structure.AssemblyInfo(opers,gens)}function getSymmetryInfo(data){var _cell=data.getCategory("_cell"),_symmetry=data.getCategory("_symmetry"),_atom_sites=data.getCategory("_atom_sites");var spacegroupName="",cellSize=[1,1,1],cellAngles=[90,90,90],toFracTransform=Core.Geometry.LinearAlgebra.Matrix4.identity(),isNonStandardCrytalFrame=false;if(!_cell||!_symmetry){return void 0}spacegroupName=_symmetry.getColumn("space_group_name_H-M").getString(0);cellSize=[_cell.getColumn("length_a").getFloat(0),_cell.getColumn("length_b").getFloat(0),_cell.getColumn("length_c").getFloat(0)];cellAngles=[_cell.getColumn("angle_alpha").getFloat(0),_cell.getColumn("angle_beta").getFloat(0),_cell.getColumn("angle_gamma").getFloat(0)];if(!spacegroupName||cellSize.every(function(s){return isNaN(s)||s===0})||cellSize.every(function(s){return isNaN(s)||s===0})){return void 0}var sq=function(x){return x*x};var toRadians=function(degs){return degs*Math.PI/180};var la=cellSize[0],lb=cellSize[1],lc=cellSize[2],aa=toRadians(cellAngles[0]),ab=toRadians(cellAngles[1]),ac=toRadians(cellAngles[2]),v=la*lb*lc*Math.sqrt(1-sq(Math.cos(aa))-sq(Math.cos(ab))-sq(Math.cos(ac))+2*Math.cos(aa)*Math.cos(ab)*Math.cos(ac));var fromFrac=Core.Geometry.LinearAlgebra.Matrix4.ofRows([[la,lb*Math.cos(ac),lc*Math.cos(ab),0],[0,lb*Math.sin(ac),lc*(Math.cos(aa)-Math.cos(ab)*Math.cos(ac))/Math.sin(ac),0],[0,0,v/(la*lb*Math.sin(ac)),0],[0,0,0,1]]);var toFracComputed=Core.Geometry.LinearAlgebra.Matrix4.identity();Core.Geometry.LinearAlgebra.Matrix4.invert(toFracComputed,fromFrac);if(_atom_sites){var transform=getTransform(_atom_sites,"fract_transf_matrix","fract_transf_vector",0);if(transform){toFracTransform=transform;if(!Core.Geometry.LinearAlgebra.Matrix4.areEqual(toFracComputed,transform,1e-4)){isNonStandardCrytalFrame=true}}}else{toFracTransform=toFracComputed}return new Core.Structure.SymmetryInfo(spacegroupName,cellSize,cellAngles,toFracTransform,isNonStandardCrytalFrame)}function getComponentBonds(category){if(!category||!category.rowCount)return void 0;var info=new Core.Structure.ComponentBondInfo;var idCol=category.getColumn("comp_id"),nameACol=category.getColumn("atom_id_1"),nameBCol=category.getColumn("atom_id_2"),orderCol=category.getColumn("value_order"),count=category.rowCount;var entry=info.newEntry(idCol.getString(0));for(var i=0;i<count;i++){var id=idCol.getString(i),nameA=nameACol.getString(i),nameB=nameBCol.getString(i),order=orderCol.getString(i);if(entry.id!==id){entry=info.newEntry(id)}var t=void 0;switch(order.toLowerCase()){case"sing":t=1;break;case"doub":case"delo":t=2;break;case"trip":t=3;break;case"quad":t=4;break;default:t=0;break}entry.add(nameA,nameB,t)}return info}function getModel(startRow,data,atomSiteColumns){var _a=buildModelAtomTable(startRow,data.getCategory("_atom_site").rowCount,atomSiteColumns),atoms=_a.atoms,positions=_a.positions,modelId=_a.modelId,endRow=_a.endRow,structure=buildStructure(atomSiteColumns,atoms),entry=data.getCategory("_entry"),id;if(entry&&entry.getColumn("id").isDefined)id=entry.getColumn("id").getString(0);else id=data.header;assignEntityTypes(data.getCategory("_entity"),structure.entities);var ss=getSecondaryStructureInfo(data,atoms,structure);assignSecondaryStructureIndex(structure.residues,ss);return{model:Core.Structure.Molecule.Model.create({id:id,modelId:modelId,data:{atoms:atoms,residues:structure.residues,chains:structure.chains,entities:structure.entities,bonds:{structConn:getStructConn(data,atoms,structure),component:getComponentBonds(data.getCategory("_chem_comp_bond"))},modifiedResidues:getModRes(data),secondaryStructure:ss,symmetryInfo:getSymmetryInfo(data),assemblyInfo:getAssemblyInfo(data)},positions:positions,source:Core.Structure.Molecule.Model.Source.File}),endRow:endRow}}function ofDataBlock(data){var models=[],atomSite=data.getCategory("_atom_site"),startRow=0;if(!atomSite){throw"'_atom_site' category is missing in the input."}var entry=data.getCategory("_entry"),atomColumns=getAtomSiteColumns(atomSite),id;if(entry&&entry.getColumn("id").isDefined)id=entry.getColumn("id").getString(0);else id=data.header;while(startRow<atomSite.rowCount){var _a=getModel(startRow,data,atomColumns),model=_a.model,endRow=_a.endRow;models.push(model);startRow=endRow}var experimentMethod=void 0;var _exptl=data.getCategory("_exptl");if(_exptl){experimentMethod=_exptl.getColumn("method").getString(0)||void 0}return Core.Structure.Molecule.create(id,models,{experimentMethod:experimentMethod})}mmCIF.ofDataBlock=ofDataBlock})(mmCIF=Molecule.mmCIF||(Molecule.mmCIF={}))})(Molecule=Formats.Molecule||(Formats.Molecule={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Molecule;(function(Molecule){var PDB;(function(PDB){"use strict";var MoleculeData=function(){function MoleculeData(header,crystInfo,models,data){this.header=header;this.crystInfo=crystInfo;this.models=models;this.data=data}MoleculeData.prototype.makeEntities=function(){var data=["data_ent","loop_","_entity.id","_entity.type","_entity.src_method","_entity.pdbx_description","_entity.formula_weight","_entity.pdbx_number_of_molecules","_entity.details","_entity.pdbx_mutation","_entity.pdbx_fragment","_entity.pdbx_ec","1 polymer man polymer 0.0 0 ? ? ? ?","2 non-polymer syn non-polymer 0.0 0 ? ? ? ?","3 water nat water 0.0 0 ? ? ? ?"].join("\n");var file=Formats.CIF.Text.parse(data);if(file.isError){throw file.toString()}return file.result.dataBlocks[0].getCategory("_entity")};MoleculeData.prototype.toCifFile=function(){var helpers={dot:PDB.Parser.getDotRange(this.data.length),question:PDB.Parser.getQuestionmarkRange(this.data.length),numberTokens:PDB.Parser.getNumberRanges(this.data.length),data:this.data};var file=new Formats.CIF.Text.File(this.data);var block=new Formats.CIF.Text.DataBlock(this.data,this.header.id);file.dataBlocks.push(block);block.addCategory(this.makeEntities());if(this.crystInfo){var _a=this.crystInfo.toCifCategory(this.header.id),cell=_a.cell,symm=_a.symm;block.addCategory(cell);block.addCategory(symm)}block.addCategory(this.models.toCifCategory(block,helpers));return file};return MoleculeData}();PDB.MoleculeData=MoleculeData;var Header=function(){function Header(id){this.id=id}return Header}();PDB.Header=Header;var CrystStructureInfo=function(){function CrystStructureInfo(record){this.record=record}CrystStructureInfo.prototype.getValue=function(start,len){var ret=this.record.substr(6,9).trim();if(!ret.length)return".";return ret};CrystStructureInfo.prototype.toCifCategory=function(id){var data=["_cell.entry_id           '"+id+"'","_cell.length_a           "+this.getValue(6,9),"_cell.length_b           "+this.getValue(15,9),"_cell.length_c           "+this.getValue(24,9),"_cell.angle_alpha        "+this.getValue(33,7),"_cell.angle_beta         "+this.getValue(40,7),"_cell.angle_gamma        "+this.getValue(48,7),"_cell.Z_PDB              "+this.getValue(66,4),"_cell.pdbx_unique_axis   ?","_symmetry.entry_id                         '"+id+"'","_symmetry.space_group_name_H-M             '"+this.getValue(55,11)+"'","_symmetry.pdbx_full_space_group_name_H-M   ?","_symmetry.cell_setting                     ?","_symmetry.Int_Tables_number                ?","_symmetry.space_group_name_Hall            ?"].join("\n");var cif=Formats.CIF.Text.parse(data);if(cif.isError){throw new Error(cif.toString())}return{cell:cif.result.dataBlocks[0].getCategory("_cell"),symm:cif.result.dataBlocks[0].getCategory("_symmetry")}};return CrystStructureInfo}();PDB.CrystStructureInfo=CrystStructureInfo;var SecondaryStructure=function(){function SecondaryStructure(helixTokens,sheetTokens){this.helixTokens=helixTokens;this.sheetTokens=sheetTokens}SecondaryStructure.prototype.toCifCategory=function(data){return void 0};return SecondaryStructure}();PDB.SecondaryStructure=SecondaryStructure;var ModelData=function(){function ModelData(idToken,atomTokens,atomCount){this.idToken=idToken;this.atomTokens=atomTokens;this.atomCount=atomCount}ModelData.prototype.writeToken=function(index,cifTokens){Core.Utils.ArrayBuilder.add2(cifTokens,this.atomTokens[2*index],this.atomTokens[2*index+1])};ModelData.prototype.writeTokenCond=function(index,cifTokens,dot){var s=this.atomTokens[2*index];var e=this.atomTokens[2*index+1];if(s===e)Core.Utils.ArrayBuilder.add2(cifTokens,dot.start,dot.end);else Core.Utils.ArrayBuilder.add2(cifTokens,s,e)};ModelData.prototype.writeRange=function(range,cifTokens){Core.Utils.ArrayBuilder.add2(cifTokens,range.start,range.end)};ModelData.prototype.tokenEquals=function(start,end,value,data){var len=value.length;if(len!==end-start)return false;for(var i=value.length-1;i>=0;i--){if(data.charCodeAt(i+start)!==value.charCodeAt(i)){return false}}return true};ModelData.prototype.getEntityType=function(row,data){var o=row*14;if(this.tokenEquals(this.atomTokens[2*o],this.atomTokens[2*o+1],"HETATM",data)){var s=this.atomTokens[2*(o+4)],e=this.atomTokens[2*(o+4)+1];if(this.tokenEquals(s,e,"HOH",data)||this.tokenEquals(s,e,"WTR",data)||this.tokenEquals(s,e,"SOL",data)){return 3}return 2}else{return 1}};ModelData.prototype.writeCifTokens=function(modelToken,cifTokens,helpers){var columnIndices={RECORD:0,SERIAL:1,ATOM_NAME:2,ALT_LOC:3,RES_NAME:4,CHAIN_ID:5,RES_SEQN:6,INS_CODE:7,X:8,Y:9,Z:10,OCCUPANCY:11,TEMP_FACTOR:12,ELEMENT:13};var columnCount=14;for(var i=0;i<this.atomCount;i++){var o=i*columnCount;this.writeToken(o+columnIndices.RECORD,cifTokens);this.writeToken(o+columnIndices.SERIAL,cifTokens);this.writeToken(o+columnIndices.ELEMENT,cifTokens);this.writeToken(o+columnIndices.ATOM_NAME,cifTokens);this.writeTokenCond(o+columnIndices.ALT_LOC,cifTokens,helpers.dot);this.writeToken(o+columnIndices.RES_NAME,cifTokens);this.writeToken(o+columnIndices.CHAIN_ID,cifTokens);this.writeRange(helpers.numberTokens.get(this.getEntityType(i,helpers.data)),cifTokens);this.writeToken(o+columnIndices.RES_SEQN,cifTokens);this.writeTokenCond(o+columnIndices.INS_CODE,cifTokens,helpers.dot);this.writeToken(o+columnIndices.X,cifTokens);this.writeToken(o+columnIndices.Y,cifTokens);this.writeToken(o+columnIndices.Z,cifTokens);this.writeToken(o+columnIndices.OCCUPANCY,cifTokens);this.writeToken(o+columnIndices.TEMP_FACTOR,cifTokens);this.writeRange(helpers.question,cifTokens);this.writeRange(helpers.question,cifTokens);this.writeRange(helpers.question,cifTokens);this.writeRange(helpers.question,cifTokens);this.writeRange(helpers.question,cifTokens);this.writeRange(helpers.question,cifTokens);this.writeToken(o+columnIndices.RES_SEQN,cifTokens);this.writeToken(o+columnIndices.RES_NAME,cifTokens);this.writeToken(o+columnIndices.CHAIN_ID,cifTokens);this.writeToken(o+columnIndices.ATOM_NAME,cifTokens);this.writeRange(modelToken,cifTokens)}};ModelData.COLUMNS=["_atom_site.group_PDB","_atom_site.id","_atom_site.type_symbol","_atom_site.label_atom_id","_atom_site.label_alt_id","_atom_site.label_comp_id","_atom_site.label_asym_id","_atom_site.label_entity_id","_atom_site.label_seq_id","_atom_site.pdbx_PDB_ins_code","_atom_site.Cartn_x","_atom_site.Cartn_y","_atom_site.Cartn_z","_atom_site.occupancy","_atom_site.B_iso_or_equiv","_atom_site.Cartn_x_esd","_atom_site.Cartn_y_esd","_atom_site.Cartn_z_esd","_atom_site.occupancy_esd","_atom_site.B_iso_or_equiv_esd","_atom_site.pdbx_formal_charge","_atom_site.auth_seq_id","_atom_site.auth_comp_id","_atom_site.auth_asym_id","_atom_site.auth_atom_id","_atom_site.pdbx_PDB_model_num"];return ModelData}();PDB.ModelData=ModelData;var ModelsData=function(){function ModelsData(models){this.models=models}ModelsData.prototype.toCifCategory=function(block,helpers){var atomCount=0;for(var _i=0,_a=this.models;_i<_a.length;_i++){var m=_a[_i];atomCount+=m.atomCount}var colCount=26;var tokens=Core.Utils.ArrayBuilder.forTokenIndices(atomCount*colCount);for(var _b=0,_c=this.models;_b<_c.length;_b++){var m=_c[_b];m.writeCifTokens(m.idToken,tokens,helpers)}return new Formats.CIF.Text.Category(block.data,"_atom_site",0,0,ModelData.COLUMNS,tokens.array,atomCount*colCount)};return ModelsData}();PDB.ModelsData=ModelsData})(PDB=Molecule.PDB||(Molecule.PDB={}))})(Molecule=Formats.Molecule||(Formats.Molecule={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Molecule;(function(Molecule){var PDB;(function(PDB){"use strict";var Tokenizer=function(){function Tokenizer(data){this.data=data;this.trimmedToken={start:0,end:0};this.line=0;this.position=0;this.length=data.length}Tokenizer.prototype.moveToNextLine=function(){while(this.position<this.length&&this.data.charCodeAt(this.position)!==10){this.position++}this.position++;this.line++;return this.position};Tokenizer.prototype.moveToEndOfLine=function(){while(this.position<this.length){var c=this.data.charCodeAt(this.position);if(c===10||c===13){return this.position}this.position++}return this.position};Tokenizer.prototype.startsWith=function(start,value){for(var i=value.length-1;i>=0;i--){if(this.data.charCodeAt(i+start)!==value.charCodeAt(i)){return false}}return true};Tokenizer.prototype.trim=function(start,end){while(start<end&&this.data.charCodeAt(start)===32)start++;while(end>start&&this.data.charCodeAt(end-1)===32)end--;this.trimmedToken.start=start;this.trimmedToken.end=end};Tokenizer.prototype.tokenizeAtomRecord=function(tokens){var startPos=this.position;var start=this.position;var end=this.moveToEndOfLine();var length=end-start;if(length<60)return false;this.trim(start,start+6);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);start=startPos+6;this.trim(start,start+5);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);start=startPos+12;this.trim(start,start+4);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);if(this.data.charCodeAt(startPos+16)===32){Formats.TokenIndexBuilder.addToken(tokens,0,0)}else{Formats.TokenIndexBuilder.addToken(tokens,startPos+16,startPos+17)}start=startPos+17;this.trim(start,start+3);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);Formats.TokenIndexBuilder.addToken(tokens,startPos+21,startPos+22);start=startPos+22;this.trim(start,start+4);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);if(this.data.charCodeAt(startPos+26)===32){Formats.TokenIndexBuilder.addToken(tokens,0,0)}else{Formats.TokenIndexBuilder.addToken(tokens,startPos+26,startPos+27)}start=startPos+30;this.trim(start,start+8);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);start=startPos+38;this.trim(start,start+8);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);start=startPos+46;this.trim(start,start+8);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);start=startPos+54;this.trim(start,start+6);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end);if(length>=66){start=startPos+60;this.trim(start,start+6);Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end)}else{Formats.TokenIndexBuilder.addToken(tokens,0,0)}if(length>=78){start=startPos+76;this.trim(start,start+2);if(this.trimmedToken.start<this.trimmedToken.end){Formats.TokenIndexBuilder.addToken(tokens,this.trimmedToken.start,this.trimmedToken.end)}else{Formats.TokenIndexBuilder.addToken(tokens,startPos+12,startPos+13)}}else{Formats.TokenIndexBuilder.addToken(tokens,startPos+12,startPos+13)}return true};return Tokenizer}();var Parser=function(){function Parser(){}Parser.tokenizeAtom=function(tokens,tokenizer){if(tokenizer.tokenizeAtomRecord(tokens)){return void 0}return new Formats.ParserError("Invalid ATOM/HETATM record.",tokenizer.line)};Parser.tokenize=function(id,data){var tokenizer=new Tokenizer(data);var length=data.length;var modelAtomTokens=Formats.TokenIndexBuilder.create(4096);var atomCount=0;var models=[];var cryst=void 0;var modelIdToken={start:0,end:0};while(tokenizer.position<length){var cont=true;switch(data.charCodeAt(tokenizer.position)){case 65:if(tokenizer.startsWith(tokenizer.position,"ATOM")){if(!modelAtomTokens){modelAtomTokens=Formats.TokenIndexBuilder.create(4096)}var err=Parser.tokenizeAtom(modelAtomTokens,tokenizer);atomCount++;if(err)return err}break;case 67:if(tokenizer.startsWith(tokenizer.position,"CRYST1")){var start=tokenizer.position;var end=tokenizer.moveToEndOfLine();cryst=new PDB.CrystStructureInfo(data.substring(start,end))}break;case 69:if(tokenizer.startsWith(tokenizer.position,"ENDMDL")&&atomCount>0){if(models.length===0){modelIdToken={start:data.length+3,end:data.length+4}}if(modelAtomTokens){models.push(new PDB.ModelData(modelIdToken,modelAtomTokens.tokens,atomCount))}atomCount=0;modelAtomTokens=null}else if(tokenizer.startsWith(tokenizer.position,"END")){var start=tokenizer.position;var end=tokenizer.moveToEndOfLine();tokenizer.trim(start,end);if(tokenizer.trimmedToken.end-tokenizer.trimmedToken.start===3){cont=false}}break;case 72:if(tokenizer.startsWith(tokenizer.position,"HETATM")){if(!modelAtomTokens){modelAtomTokens=Formats.TokenIndexBuilder.create(4096)}var err=Parser.tokenizeAtom(modelAtomTokens,tokenizer);atomCount++;if(err)return err}break;case 77:if(tokenizer.startsWith(tokenizer.position,"MODEL")){if(atomCount>0){if(models.length===0){modelIdToken={start:data.length+3,end:data.length+4}}if(modelAtomTokens){models.push(new PDB.ModelData(modelIdToken,modelAtomTokens.tokens,atomCount))}}var start=tokenizer.position+6;var end=tokenizer.moveToEndOfLine();tokenizer.trim(start,end);modelIdToken={start:tokenizer.trimmedToken.start,end:tokenizer.trimmedToken.end};if(atomCount>0||!modelAtomTokens){modelAtomTokens=Formats.TokenIndexBuilder.create(4096)}atomCount=0}break}tokenizer.moveToNextLine();if(!cont)break}var fakeCifData=data+".?0123";if(atomCount>0){if(models.length===0){modelIdToken={start:data.length+3,end:data.length+4}}if(modelAtomTokens){models.push(new PDB.ModelData(modelIdToken,modelAtomTokens.tokens,atomCount))}}return new PDB.MoleculeData(new PDB.Header(id),cryst,new PDB.ModelsData(models),fakeCifData)};Parser.getDotRange=function(length){return{start:length-6,end:length-5}};Parser.getNumberRanges=function(length){var ret=Core.Utils.FastMap.create();for(var i=0;i<4;i++){ret.set(i,{start:length-4+i,end:length-3+i})}return ret};Parser.getQuestionmarkRange=function(length){return{start:length-5,end:length-4}};Parser.parse=function(id,data){var ret=Parser.tokenize(id,data);if(ret instanceof Formats.ParserError){return Formats.ParserResult.error(ret.message,ret.line)}else{return Formats.ParserResult.success(ret.toCifFile())}};return Parser}();PDB.Parser=Parser;function toCifFile(id,data){return Parser.parse(id,data)}PDB.toCifFile=toCifFile})(PDB=Molecule.PDB||(Molecule.PDB={}))})(Molecule=Formats.Molecule||(Formats.Molecule={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Molecule;(function(Molecule){var SDF;(function(SDF){function initState(data,customId){var lines=data.split(/\r?\n/g);var id=lines[0].trim();if(!id.length)id="SDF";var cTabInfo=lines[3];var atomCount=+cTabInfo.substr(0,3);var bondCount=+cTabInfo.substr(3,3);return{id:customId?customId:id,atomCount:atomCount,bondCount:bondCount,atoms:Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Atoms,atomCount),positions:Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Positions,atomCount),bonds:Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Bonds,bondCount),lines:lines,currentLine:4,error:void 0,stringPool:Formats.ShortStringPool.create()}}function readAtom(i,state){var line=state.lines[state.currentLine];var atoms=state.atoms,positions=state.positions;var es=Formats.ShortStringPool.get(state.stringPool,line.substr(31,3).trim());atoms.id[i]=i;atoms.elementSymbol[i]=es;atoms.name[i]=es;atoms.authName[i]=es;atoms.occupancy[i]=1;atoms.rowIndex[i]=state.currentLine;positions.x[i]=Core.Utils.FastNumberParsers.parseFloatSkipTrailingWhitespace(line,0,10);positions.y[i]=Core.Utils.FastNumberParsers.parseFloatSkipTrailingWhitespace(line,10,20);positions.z[i]=Core.Utils.FastNumberParsers.parseFloatSkipTrailingWhitespace(line,20,30)}function readAtoms(state){for(var i=0;i<state.atomCount;i++){readAtom(i,state);state.currentLine++}}function readBond(i,state){var line=state.lines[state.currentLine];var bonds=state.bonds;bonds.atomAIndex[i]=Core.Utils.FastNumberParsers.parseIntSkipTrailingWhitespace(line,0,3)-1;bonds.atomBIndex[i]=Core.Utils.FastNumberParsers.parseIntSkipTrailingWhitespace(line,3,6)-1;switch(Core.Utils.FastNumberParsers.parseIntSkipTrailingWhitespace(line,6,9)){case 1:bonds.type[i]=1;break;case 2:bonds.type[i]=2;break;case 3:bonds.type[i]=3;break;case 4:bonds.type[i]=4;break;default:bonds.type[i]=0;break}}function readBonds(state){for(var i=0;i<state.bondCount;i++){readBond(i,state);state.currentLine++}}function buildModel(state){var residues=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Residues,1),chains=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Chains,1),entities=Core.Utils.DataTable.ofDefinition(Core.Structure.Tables.Entities,1);residues.isHet[0]=1;residues.insCode[0]=null;residues.name[0]=residues.authName[0]="UNK";residues.atomEndIndex[0]=chains.atomEndIndex[0]=entities.atomEndIndex[0]=state.atomCount;residues.asymId[0]=residues.authAsymId[0]=chains.asymId[0]=chains.authAsymId[0]="X";residues.entityId[0]=chains.entityId[0]=entities.entityId[0]="1";chains.residueEndIndex[0]=entities.residueEndIndex[0]=0;entities.chainEndIndex[0]=1;entities.type[0]="non-polymer";var ssR=new Core.Structure.PolyResidueIdentifier("X",0,null);var ss=[new Core.Structure.SecondaryStructureElement(0,ssR,ssR)];ss[0].startResidueIndex=0;ss[0].endResidueIndex=1;return Core.Structure.Molecule.Model.create({id:state.id,modelId:"1",data:{atoms:state.atoms,residues:residues,chains:chains,entities:entities,bonds:{input:state.bonds},secondaryStructure:ss,symmetryInfo:void 0,assemblyInfo:void 0},positions:state.positions,source:Core.Structure.Molecule.Model.Source.File})}function parse(data,id){try{var state=initState(data,id);readAtoms(state);readBonds(state);var model=buildModel(state);if(state.error){return Formats.ParserResult.error(state.error,state.currentLine+1)}var molecule=Core.Structure.Molecule.create(id?id:state.id,[model]);return Formats.ParserResult.success(molecule)}catch(e){return Formats.ParserResult.error(""+e)}}SDF.parse=parse})(SDF=Molecule.SDF||(Molecule.SDF={}))})(Molecule=Formats.Molecule||(Formats.Molecule={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Molecule;(function(Molecule){function parseCIF(type,parse){var _this=this;return function(data,params){return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var file,result,mol;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing...")];case 1:_a.sent();file=parse(data,params);if(file.isError){throw file.toString()}result=file.result;if(!result.dataBlocks.length){throw"The "+type+" data does not contain a data block."}return[4,ctx.updateProgress("Creating representation...")];case 2:_a.sent();mol=Molecule.mmCIF.ofDataBlock(result.dataBlocks[0]);return[2,Formats.ParserResult.success(mol,result.dataBlocks.length>1?["The input data contains multiple data blocks, only the first one was parsed. To parse all data blocks, use the function 'mmCIF.ofDataBlock' separately for each block."]:void 0)]}})})})}}var SupportedFormats;(function(SupportedFormats){var _this=this;SupportedFormats.mmCIF={name:"mmCIF",shortcuts:["mmcif","cif"],extensions:[".cif"],parse:parseCIF("CIF",Formats.CIF.Text.parse)};SupportedFormats.mmBCIF={name:"mmCIF (Binary)",shortcuts:["mmbcif","bcif","binarycif"],extensions:[".bcif"],isBinary:true,parse:parseCIF("BinaryCIF",Formats.CIF.Binary.parse)};SupportedFormats.PDB={name:"PDB",shortcuts:["pdb","ent"],extensions:[".pdb",".ent"],parse:parseCIF("PDB",function(d,p){return Molecule.PDB.toCifFile(p&&p.id||"PDB",d)})};SupportedFormats.SDF={name:"SDF",shortcuts:["sdf","mol"],extensions:[".sdf",".mol"],parse:function(data,options){return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var mol;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing...")];case 1:_a.sent();mol=Molecule.SDF.parse(data,options&&options.id||undefined);if(mol.isError)throw mol.toString();return[2,Formats.ParserResult.success(mol.result)]}})})})}};SupportedFormats.All=[SupportedFormats.mmCIF,SupportedFormats.mmBCIF,SupportedFormats.PDB,SupportedFormats.SDF]})(SupportedFormats=Molecule.SupportedFormats||(Molecule.SupportedFormats={}))})(Molecule=Formats.Molecule||(Formats.Molecule={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Density;(function(Density){"use strict";function fill(data,value){var len=data.length;for(var i=0;i<len;i++){data[i]=value}}var Field3DZYX=function(){function Field3DZYX(data,dimensions){this.data=data;this.dimensions=dimensions;this.len=this.dimensions[0]*this.dimensions[1]*this.dimensions[2];this.nX=this.dimensions[0];this.nY=this.dimensions[1]}Object.defineProperty(Field3DZYX.prototype,"length",{get:function(){return this.len},enumerable:true,configurable:true});Field3DZYX.prototype.getAt=function(idx){return this.data[idx]};Field3DZYX.prototype.setAt=function(idx,v){this.data[idx]=v};Field3DZYX.prototype.get=function(i,j,k){return this.data[this.nX*(k*this.nY+j)+i|0]};Field3DZYX.prototype.set=function(i,j,k,v){this.data[this.nX*(k*this.nY+j)+i|0]=v};Field3DZYX.prototype.fill=function(v){fill(this.data,v)};return Field3DZYX}();Density.Field3DZYX=Field3DZYX;function createSpacegroup(number,size,angles){var alpha=Math.PI/180*angles[0],beta=Math.PI/180*angles[1],gamma=Math.PI/180*angles[2];var xScale=size[0],yScale=size[1],zScale=size[2];var z1=Math.cos(beta),z2=(Math.cos(alpha)-Math.cos(beta)*Math.cos(gamma))/Math.sin(gamma),z3=Math.sqrt(1-z1*z1-z2*z2);var x=[xScale,0,0];var y=[Math.cos(gamma)*yScale,Math.sin(gamma)*yScale,0];var z=[z1*zScale,z2*zScale,z3*zScale];return{number:number,size:size,angles:angles,basis:{x:x,y:y,z:z}}}Density.createSpacegroup=createSpacegroup})(Density=Formats.Density||(Formats.Density={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Density;(function(Density){var CCP4;(function(CCP4){function parse(buffer){return Parser.parse(buffer)}CCP4.parse=parse;var Parser;(function(Parser){function getArray(r,offset,count){var ret=[];for(var i=0;i<count;i++){ret[i]=r(offset+i)}return ret}function parse(buffer){var headerSize=1024,headerView=new DataView(buffer,0,headerSize),warnings=[];var endian=false;var mode=headerView.getInt32(3*4,false);if(mode!==2){endian=true;mode=headerView.getInt32(3*4,true);if(mode!==2){return Formats.ParserResult.error("Only CCP4 mode 2 is supported.")}}var readInt=function(o){return headerView.getInt32(o*4,endian)},readFloat=function(o){return headerView.getFloat32(o*4,endian)};var header={extent:getArray(readInt,0,3),mode:mode,nxyzStart:getArray(readInt,4,3),grid:getArray(readInt,7,3),cellSize:getArray(readFloat,10,3),cellAngles:getArray(readFloat,13,3),crs2xyz:getArray(readInt,16,3),min:readFloat(19),max:readFloat(20),mean:readFloat(21),spacegroupNumber:readInt(22),symBytes:readInt(23),skewFlag:readInt(24),skewMatrix:getArray(readFloat,25,9),skewTranslation:getArray(readFloat,34,3),origin2k:getArray(readFloat,49,3)};var dataOffset=buffer.byteLength-4*header.extent[0]*header.extent[1]*header.extent[2];if(dataOffset!==headerSize+header.symBytes){if(dataOffset===headerSize){warnings.push("File contains bogus symmetry record.")}else if(dataOffset<headerSize){return Formats.ParserResult.error("File appears truncated and doesn't match header.")}else if(dataOffset>headerSize&&dataOffset<1024*1024){dataOffset=headerSize+header.symBytes;warnings.push("File is larger than expected and doesn't match header. Continuing file load, good luck!")}else{return Formats.ParserResult.error("File is MUCH larger than expected and doesn't match header.")}}if(header.grid[0]===0&&header.extent[0]>0){header.grid[0]=header.extent[0]-1;warnings.push("Fixed X interval count.")}if(header.grid[1]===0&&header.extent[1]>0){header.grid[1]=header.extent[1]-1;warnings.push("Fixed Y interval count.")}if(header.grid[2]===0&&header.extent[2]>0){header.grid[2]=header.extent[2]-1;warnings.push("Fixed Z interval count.")}if(header.crs2xyz[0]===0&&header.crs2xyz[1]===0&&header.crs2xyz[2]===0){warnings.push("All crs2xyz records are zero. Setting crs2xyz to 1, 2, 3.");header.crs2xyz=[1,2,3]}if(header.cellSize[0]===0&&header.cellSize[1]===0&&header.cellSize[2]===0){warnings.push("Cell dimensions are all zero. Setting to 1.0, 1.0, 1.0. Map file will not align with other structures.");header.cellSize[0]=1;header.cellSize[1]=1;header.cellSize[2]=1}var indices=[0,0,0];indices[header.crs2xyz[0]-1]=0;indices[header.crs2xyz[1]-1]=1;indices[header.crs2xyz[2]-1]=2;var originGrid;if(header.origin2k[0]===0&&header.origin2k[1]===0&&header.origin2k[2]===0){originGrid=[header.nxyzStart[indices[0]],header.nxyzStart[indices[1]],header.nxyzStart[indices[2]]]}else{originGrid=[header.origin2k[indices[0]],header.origin2k[indices[1]],header.origin2k[indices[2]]]}var extent=[header.extent[indices[0]],header.extent[indices[1]],header.extent[indices[2]]];var nativeEndian=new Uint16Array(new Uint8Array([18,52]).buffer)[0]===13330;var rawData=endian===nativeEndian?readRawData1(new Float32Array(buffer,headerSize+header.symBytes,extent[0]*extent[1]*extent[2]),endian,extent,header.extent,indices,header.mean):readRawData(new DataView(buffer,headerSize+header.symBytes),endian,extent,header.extent,indices,header.mean);var field=new Density.Field3DZYX(rawData.data,extent);var data={spacegroup:Density.createSpacegroup(header.spacegroupNumber,header.cellSize,header.cellAngles),box:{origin:[originGrid[0]/header.grid[0],originGrid[1]/header.grid[1],originGrid[2]/header.grid[2]],dimensions:[extent[0]/header.grid[0],extent[1]/header.grid[1],extent[2]/header.grid[2]],sampleCount:extent},data:field,valuesInfo:{min:header.min,max:header.max,mean:header.mean,sigma:rawData.sigma}};return Formats.ParserResult.success(data,warnings)}Parser.parse=parse;function readRawData1(view,endian,extent,headerExtent,indices,mean){var data=new Float32Array(extent[0]*extent[1]*extent[2]),coord=[0,0,0],mX,mY,mZ,cX,cY,cZ,xSize,xySize,offset=0,v=.1,sigma=0,t=.1,iX=indices[0],iY=indices[1],iZ=indices[2];mX=headerExtent[0];mY=headerExtent[1];mZ=headerExtent[2];xSize=extent[0];xySize=extent[0]*extent[1];for(cZ=0;cZ<mZ;cZ++){coord[2]=cZ;for(cY=0;cY<mY;cY++){coord[1]=cY;for(cX=0;cX<mX;cX++){coord[0]=cX;v=view[offset];t=v-mean;sigma+=t*t,data[coord[iX]+coord[iY]*xSize+coord[iZ]*xySize]=v;offset+=1}}}sigma/=mX*mY*mZ;sigma=Math.sqrt(sigma);return{data:data,sigma:sigma}}function readRawData(view,endian,extent,headerExtent,indices,mean){var data=new Float32Array(extent[0]*extent[1]*extent[2]),coord=[0,0,0],mX,mY,mZ,cX,cY,cZ,xSize,xySize,offset=0,v=.1,sigma=0,t=.1,iX=indices[0],iY=indices[1],iZ=indices[2];mX=headerExtent[0];mY=headerExtent[1];mZ=headerExtent[2];xSize=extent[0];xySize=extent[0]*extent[1];for(cZ=0;cZ<mZ;cZ++){coord[2]=cZ;for(cY=0;cY<mY;cY++){coord[1]=cY;for(cX=0;cX<mX;cX++){coord[0]=cX;v=view.getFloat32(offset,endian);t=v-mean;sigma+=t*t,data[coord[iX]+coord[iY]*xSize+coord[iZ]*xySize]=v;offset+=4}}}sigma/=mX*mY*mZ;sigma=Math.sqrt(sigma);return{data:data,sigma:sigma}}})(Parser||(Parser={}))})(CCP4=Density.CCP4||(Density.CCP4={}))})(Density=Formats.Density||(Formats.Density={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Density;(function(Density){var CIF;(function(CIF){function parse(block){if(block.getCategory("_density_info"))return Parser.parseLegacy(block);else if(block.getCategory("_volume_data_3d_info"))return Parser.parse(block);return Formats.ParserResult.error("Invalid data format.")}CIF.parse=parse;var Parser;(function(Parser){function parse(block){var info=block.getCategory("_volume_data_3d_info");if(!info)return Formats.ParserResult.error("_volume_data_3d_info category is missing.");if(!block.getCategory("_volume_data_3d"))return Formats.ParserResult.error("_volume_data_3d category is missing.");function getVector3(name){var ret=[0,0,0];for(var i=0;i<3;i++){ret[i]=info.getColumn(name+"["+i+"]").getFloat(0)}return ret}function getNum(name){return info.getColumn(name).getFloat(0)}var header={name:info.getColumn("name").getString(0),axisOrder:getVector3("axis_order"),origin:getVector3("origin"),dimensions:getVector3("dimensions"),sampleCount:getVector3("sample_count"),spacegroupNumber:getNum("spacegroup_number")|0,cellSize:getVector3("spacegroup_cell_size"),cellAngles:getVector3("spacegroup_cell_angles"),mean:getNum("mean_sampled"),sigma:getNum("sigma_sampled")};var indices=[0,0,0];indices[header.axisOrder[0]]=0;indices[header.axisOrder[1]]=1;indices[header.axisOrder[2]]=2;function normalizeOrder(xs){return[xs[indices[0]],xs[indices[1]],xs[indices[2]]]}var sampleCount=normalizeOrder(header.sampleCount);var rawData=readValues(block.getCategory("_volume_data_3d").getColumn("values"),sampleCount,header.sampleCount,indices);var field=new Density.Field3DZYX(rawData.data,sampleCount);var data={name:header.name,spacegroup:Density.createSpacegroup(header.spacegroupNumber,header.cellSize,header.cellAngles),box:{origin:normalizeOrder(header.origin),dimensions:normalizeOrder(header.dimensions),sampleCount:sampleCount},data:field,valuesInfo:{min:rawData.min,max:rawData.max,mean:header.mean,sigma:header.sigma}};return Formats.ParserResult.success(data)}Parser.parse=parse;function parseLegacy(block){var info=block.getCategory("_density_info");if(!info)return Formats.ParserResult.error("_density_info category is missing.");if(!block.getCategory("_density_data"))return Formats.ParserResult.error("_density_data category is missing.");function getArray(name){var ret=[];for(var i=0;i<3;i++){ret[i]=info.getColumn(name+"["+i+"]").getFloat(0)}return ret}function getNum(name){return info.getColumn(name).getFloat(0)}var header={name:info.getColumn("name").getString(0),grid:getArray("grid"),axisOrder:getArray("axis_order"),extent:getArray("extent"),origin:getArray("origin"),cellSize:getArray("cell_size"),cellAngles:getArray("cell_angles"),mean:getNum("mean"),sigma:getNum("sigma"),spacegroupNumber:getNum("spacegroup_number")|0};var indices=[0,0,0];indices[header.axisOrder[0]]=0;indices[header.axisOrder[1]]=1;indices[header.axisOrder[2]]=2;var originGrid=[header.origin[indices[0]],header.origin[indices[1]],header.origin[indices[2]]];var xyzSampleCount=[header.extent[indices[0]],header.extent[indices[1]],header.extent[indices[2]]];var rawData=readValues(block.getCategory("_density_data").getColumn("values"),xyzSampleCount,header.extent,indices);var field=new Density.Field3DZYX(rawData.data,xyzSampleCount);var data={name:header.name,spacegroup:Density.createSpacegroup(header.spacegroupNumber,header.cellSize,header.cellAngles),box:{origin:[originGrid[0]/header.grid[0],originGrid[1]/header.grid[1],originGrid[2]/header.grid[2]],dimensions:[xyzSampleCount[0]/header.grid[0],xyzSampleCount[1]/header.grid[1],xyzSampleCount[2]/header.grid[2]],sampleCount:xyzSampleCount},data:field,valuesInfo:{min:rawData.min,max:rawData.max,mean:header.mean,sigma:header.sigma}};return Formats.ParserResult.success(data)}Parser.parseLegacy=parseLegacy;function readValues(col,xyzSampleCount,sampleCount,axisIndices){var data=new Float32Array(xyzSampleCount[0]*xyzSampleCount[1]*xyzSampleCount[2]);var coord=[0,0,0];var iX=axisIndices[0],iY=axisIndices[1],iZ=axisIndices[2];var mX=sampleCount[0],mY=sampleCount[1],mZ=sampleCount[2];var xSize=xyzSampleCount[0];var xySize=xyzSampleCount[0]*xyzSampleCount[1];var offset=0;var min=col.getFloat(0),max=min;for(var cZ=0;cZ<mZ;cZ++){coord[2]=cZ;for(var cY=0;cY<mY;cY++){coord[1]=cY;for(var cX=0;cX<mX;cX++){coord[0]=cX;var v=col.getFloat(offset);offset+=1;data[coord[iX]+coord[iY]*xSize+coord[iZ]*xySize]=v;if(v<min)min=v;else if(v>max)max=v}}}return{data:data,min:min,max:max}}})(Parser||(Parser={}))})(CIF=Density.CIF||(Density.CIF={}))})(Density=Formats.Density||(Formats.Density={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Formats;(function(Formats){var Density;(function(Density){function parse(data,name,parser){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing "+name+"...")];case 1:_a.sent();return[2,parser(data)]}})})})}var SupportedFormats;(function(SupportedFormats){SupportedFormats.CCP4={name:"CCP4",shortcuts:["ccp4","map"],extensions:[".ccp4",".map"],isBinary:true,parse:function(data){return parse(data,"CCP4",function(d){return Density.CCP4.parse(d)})}};SupportedFormats.All=[SupportedFormats.CCP4]})(SupportedFormats=Density.SupportedFormats||(Density.SupportedFormats={}))})(Density=Formats.Density||(Formats.Density={}))})(Formats=Core.Formats||(Core.Formats={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var LinearAlgebra;(function(LinearAlgebra){function Matrix4(){return Matrix4.zero()}LinearAlgebra.Matrix4=Matrix4;(function(Matrix4){function zero(){var ret=[.1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];ret[0]=0;return ret}Matrix4.zero=zero;function identity(){var out=zero();out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}Matrix4.identity=identity;function fromIdentity(mat){mat[0]=1;mat[1]=0;mat[2]=0;mat[3]=0;mat[4]=0;mat[5]=1;mat[6]=0;mat[7]=0;mat[8]=0;mat[9]=0;mat[10]=1;mat[11]=0;mat[12]=0;mat[13]=0;mat[14]=0;mat[15]=1;return mat}Matrix4.fromIdentity=fromIdentity;function ofRows(rows){var out=zero(),i,j,r;for(i=0;i<4;i++){r=rows[i];for(j=0;j<4;j++){out[4*j+i]=r[j]}}return out}Matrix4.ofRows=ofRows;function areEqual(a,b,eps){for(var i=0;i<16;i++){if(Math.abs(a[i]-b[i])>eps){return false}}return true}Matrix4.areEqual=areEqual;function setValue(a,i,j,value){a[4*j+i]=value}Matrix4.setValue=setValue;function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}Matrix4.copy=copy;function clone(a){return Matrix4.copy(Matrix4.zero(),a)}Matrix4.clone=clone;function invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}Matrix4.invert=invert;function mul(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out}Matrix4.mul=mul;function mul3(out,a,b,c){return mul(out,mul(out,a,b),c)}Matrix4.mul3=mul3;function translate(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}Matrix4.translate=translate;function fromTranslation(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}Matrix4.fromTranslation=fromTranslation;function rotate(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<1e-6){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15]}return out}Matrix4.rotate=rotate;function fromRotation(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z),s,c,t;if(Math.abs(len)<1e-6){return fromIdentity(out)}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}Matrix4.fromRotation=fromRotation;function scale(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out}Matrix4.scale=scale;function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out}Matrix4.fromScaling=fromScaling;function makeTable(m){var ret="";for(var i=0;i<4;i++){for(var j=0;j<4;j++){ret+=m[4*j+i].toString();if(j<3)ret+=" "}if(i<3)ret+="\n"}return ret}Matrix4.makeTable=makeTable;function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06}Matrix4.determinant=determinant})(Matrix4=LinearAlgebra.Matrix4||(LinearAlgebra.Matrix4={}));function Vector3(x,y,z){return Vector3.fromValues(x||0,y||0,z||0)}LinearAlgebra.Vector3=Vector3;(function(Vector3){function zero(){var out=[.1,0,0];out[0]=0;return out}Vector3.zero=zero;function clone(a){var out=zero();out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}Vector3.clone=clone;function fromObj(v){return fromValues(v.x,v.y,v.z)}Vector3.fromObj=fromObj;function toObj(v){return{x:v[0],y:v[1],z:v[2]}}Vector3.toObj=toObj;function fromValues(x,y,z){var out=zero();out[0]=x;out[1]=y;out[2]=z;return out}Vector3.fromValues=fromValues;function set(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out}Vector3.set=set;function copy(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out}Vector3.copy=copy;function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out}Vector3.add=add;function sub(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out}Vector3.sub=sub;function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out}Vector3.scale=scale;function scaleAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out}Vector3.scaleAndAdd=scaleAndAdd;function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)}Vector3.distance=distance;function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z}Vector3.squaredDistance=squaredDistance;function magnitude(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)}Vector3.magnitude=magnitude;function squaredMagnitude(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z}Vector3.squaredMagnitude=squaredMagnitude;function normalize(out,a){var x=a[0],y=a[1],z=a[2];var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len}return out}Vector3.normalize=normalize;function dot(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Vector3.dot=dot;function cross(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out}Vector3.cross=cross;function lerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out}Vector3.lerp=lerp;function transformMat4(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out}Vector3.transformMat4=transformMat4;var angleTempA=zero(),angleTempB=zero();function angle(a,b){copy(angleTempA,a);copy(angleTempB,b);normalize(angleTempA,angleTempA);normalize(angleTempB,angleTempB);var cosine=dot(angleTempA,angleTempB);if(cosine>1){return 0}else if(cosine<-1){return Math.PI}else{return Math.acos(cosine)}}Vector3.angle=angle;var rotTemp=zero();function makeRotation(mat,a,b){var by=angle(a,b);if(Math.abs(by)<1e-4)return Matrix4.fromIdentity(mat);var axis=cross(rotTemp,a,b);return Matrix4.fromRotation(mat,by,axis)}Vector3.makeRotation=makeRotation})(Vector3=LinearAlgebra.Vector3||(LinearAlgebra.Vector3={}));function Vector4(x,y,z,w){return Vector4.fromValues(x||0,y||0,z||0,w||0)}LinearAlgebra.Vector4=Vector4;(function(Vector4){function zero(){var ret=[.1,0,0,0];ret[0]=0;return ret}Vector4.zero=zero;function clone(a){var out=zero();out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out}Vector4.clone=clone;function fromValues(x,y,z,w){var out=zero();out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}Vector4.fromValues=fromValues;function set(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out}Vector4.set=set;function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}Vector4.distance=distance;function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w}Vector4.squaredDistance=squaredDistance;function norm(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}Vector4.norm=norm;function squaredNorm(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w}Vector4.squaredNorm=squaredNorm;function transform(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out}Vector4.transform=transform})(Vector4=LinearAlgebra.Vector4||(LinearAlgebra.Vector4={}))})(LinearAlgebra=Geometry.LinearAlgebra||(Geometry.LinearAlgebra={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){"use strict";var Surface;(function(Surface){function computeNormalsImmediate(surface){if(surface.normals)return;var normals=new Float32Array(surface.vertices.length),v=surface.vertices,triangles=surface.triangleIndices;for(var i=0;i<triangles.length;i+=3){var a=3*triangles[i],b=3*triangles[i+1],c=3*triangles[i+2];var nx=v[a+2]*(v[b+1]-v[c+1])+v[b+2]*v[c+1]-v[b+1]*v[c+2]+v[a+1]*(-v[b+2]+v[c+2]),ny=-(v[b+2]*v[c])+v[a+2]*(-v[b]+v[c])+v[a]*(v[b+2]-v[c+2])+v[b]*v[c+2],nz=v[a+1]*(v[b]-v[c])+v[b+1]*v[c]-v[b]*v[c+1]+v[a]*(-v[b+1]+v[b+1]);normals[a]+=nx;normals[a+1]+=ny;normals[a+2]+=nz;normals[b]+=nx;normals[b+1]+=ny;normals[b+2]+=nz;normals[c]+=nx;normals[c+1]+=ny;normals[c+2]+=nz}for(var i=0;i<normals.length;i+=3){var nx=normals[i];var ny=normals[i+1];var nz=normals[i+2];var f=1/Math.sqrt(nx*nx+ny*ny+nz*nz);normals[i]*=f;normals[i+1]*=f;normals[i+2]*=f}surface.normals=normals}Surface.computeNormalsImmediate=computeNormalsImmediate;function computeNormals(surface){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:if(surface.normals){return[2,surface]};return[4,ctx.updateProgress("Computing normals...")];case 1:_a.sent();computeNormalsImmediate(surface);return[2,surface]}})})})}Surface.computeNormals=computeNormals;function addVertex(src,i,dst,j){dst[3*j]+=src[3*i];dst[3*j+1]+=src[3*i+1];dst[3*j+2]+=src[3*i+2]}function laplacianSmoothIter(surface,vertexCounts,vs,vertexWeight){var triCount=surface.triangleIndices.length,src=surface.vertices;var triangleIndices=surface.triangleIndices;for(var i=0;i<triCount;i+=3){var a=triangleIndices[i],b=triangleIndices[i+1],c=triangleIndices[i+2];addVertex(src,b,vs,a);addVertex(src,c,vs,a);addVertex(src,a,vs,b);addVertex(src,c,vs,b);addVertex(src,a,vs,c);addVertex(src,b,vs,c)}var vw=2*vertexWeight;for(var i=0,_b=surface.vertexCount;i<_b;i++){var n=vertexCounts[i]+vw;vs[3*i]=(vs[3*i]+vw*src[3*i])/n;vs[3*i+1]=(vs[3*i+1]+vw*src[3*i+1])/n;vs[3*i+2]=(vs[3*i+2]+vw*src[3*i+2])/n}}function laplacianSmoothComputation(ctx,surface,iterCount,vertexWeight){return __awaiter(this,void 0,void 0,function(){var vertexCounts,triCount,tris,i,vs,started,i,j,_b,t,time;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Smoothing surface...",true)];case 1:_a.sent();vertexCounts=new Int32Array(surface.vertexCount),triCount=surface.triangleIndices.length;tris=surface.triangleIndices;for(i=0;i<triCount;i++){vertexCounts[tris[i]]+=2}vs=new Float32Array(surface.vertices.length);started=Core.Utils.PerformanceMonitor.currentTime();return[4,ctx.updateProgress("Smoothing surface...",true)];case 2:_a.sent();i=0;_a.label=3;case 3:if(!(i<iterCount))return[3,6];if(i>0){for(j=0,_b=vs.length;j<_b;j++)vs[j]=0}surface.normals=void 0;laplacianSmoothIter(surface,vertexCounts,vs,vertexWeight);t=surface.vertices;surface.vertices=vs;vs=t;time=Core.Utils.PerformanceMonitor.currentTime();if(!(time-started>Core.Computation.UpdateProgressDelta))return[3,5];started=time;return[4,ctx.updateProgress("Smoothing surface...",true,i+1,iterCount)];case 4:_a.sent();_a.label=5;case 5:i++;return[3,3];case 6:return[2,surface]}})})}function laplacianSmooth(surface,iterCount,vertexWeight){var _this=this;if(iterCount===void 0){iterCount=1}if(vertexWeight===void 0){vertexWeight=1}if(iterCount<1)iterCount=0;if(iterCount===0)return Core.Computation.resolve(surface);return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,laplacianSmoothComputation(ctx,surface,iterCount,1.1*vertexWeight/1.1)];case 1:return[2,_a.sent()]}})})})}Surface.laplacianSmooth=laplacianSmooth;function computeBoundingSphere(surface){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var vertices,x,y,z,i,_c,r,i,_c,dx,dy,dz;return __generator(this,function(_a){switch(_a.label){case 0:if(surface.boundingSphere){return[2,surface]}return[4,ctx.updateProgress("Computing bounding sphere...")];case 1:_a.sent();vertices=surface.vertices;x=0,y=0,z=0;for(i=0,_c=surface.vertices.length;i<_c;i+=3){x+=vertices[i];y+=vertices[i+1];z+=vertices[i+2]}x/=surface.vertexCount;y/=surface.vertexCount;z/=surface.vertexCount;r=0;for(i=0,_c=vertices.length;i<_c;i+=3){dx=x-vertices[i];dy=y-vertices[i+1];dz=z-vertices[i+2];r=Math.max(r,dx*dx+dy*dy+dz*dz)}surface.boundingSphere={center:Geometry.LinearAlgebra.Vector3.fromValues(x,y,z),radius:Math.sqrt(r)};return[2,surface]}})})})}Surface.computeBoundingSphere=computeBoundingSphere;function transformImmediate(surface,t){var p=Geometry.LinearAlgebra.Vector3.zero();var m=Geometry.LinearAlgebra.Vector3.transformMat4;var vertices=surface.vertices;for(var i=0,_c=surface.vertices.length;i<_c;i+=3){p[0]=vertices[i];p[1]=vertices[i+1];p[2]=vertices[i+2];m(p,p,t);vertices[i]=p[0];vertices[i+1]=p[1];vertices[i+2]=p[2]}surface.normals=void 0;surface.boundingSphere=void 0}Surface.transformImmediate=transformImmediate;function transform(surface,t){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){return __generator(this,function(_a){ctx.updateProgress("Updating surface...");transformImmediate(surface,t);return[2,surface]})})})}Surface.transform=transform})(Surface=Geometry.Surface||(Geometry.Surface={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var Query3D;(function(Query3D){var Box3D;(function(Box3D){function createInfinite(){return{min:[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],max:[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]}}Box3D.createInfinite=createInfinite})(Box3D=Query3D.Box3D||(Query3D.Box3D={}));var QueryContext;(function(QueryContext){function add(ctx,distSq,index){var buffer=ctx.buffer;buffer.squaredDistances[buffer.count]=distSq;buffer.elements[buffer.count++]=buffer.sourceElements[index]}QueryContext.add=add;function resetBuffer(buffer){buffer.count=0}function createBuffer(sourceElements){return{sourceElements:sourceElements,elements:[],count:0,squaredDistances:[]}}function update(ctx,x,y,z,radius){ctx.pivot[0]=x;ctx.pivot[1]=y;ctx.pivot[2]=z;ctx.radius=radius;ctx.radiusSq=radius*radius;resetBuffer(ctx.buffer)}QueryContext.update=update;function create(structure,sourceElements){return{structure:structure,buffer:createBuffer(sourceElements),pivot:[.1,.1,.1],radius:1.1,radiusSq:1.1*1.1}}QueryContext.create=create})(QueryContext=Query3D.QueryContext||(Query3D.QueryContext={}));var PositionBuilder;(function(PositionBuilder){function add(builder,x,y,z){builder.data[builder._count++]=x;builder.data[builder._count++]=y;builder.data[builder._count++]=z;builder.boundsMin[0]=Math.min(x,builder.boundsMin[0]);builder.boundsMin[1]=Math.min(y,builder.boundsMin[1]);builder.boundsMin[2]=Math.min(z,builder.boundsMin[2]);builder.boundsMax[0]=Math.max(x,builder.boundsMax[0]);builder.boundsMax[1]=Math.max(y,builder.boundsMax[1]);builder.boundsMax[2]=Math.max(z,builder.boundsMax[2])}PositionBuilder.add=add;function create(size){var data=new Float32Array(size*3|0);var bounds=Box3D.createInfinite();var boundsMin=bounds.min;var boundsMax=bounds.max;return{_count:0,data:data,bounds:bounds,boundsMin:boundsMin,boundsMax:boundsMax}}PositionBuilder.create=create;function createAdder(builder){var add=PositionBuilder.add;return function(x,y,z){add(builder,x,y,z)}}PositionBuilder.createAdder=createAdder})(PositionBuilder||(PositionBuilder={}));function createInputData(elements,f){var positions=PositionBuilder.create(elements.length);var indices=new Int32Array(elements.length);var add=PositionBuilder.createAdder(positions);for(var i=0;i<elements.length;i++){indices[i]=i;f(elements[i],add)}return{elements:elements,positions:positions.data,bounds:positions.bounds,indices:indices}}Query3D.createInputData=createInputData})(Query3D=Geometry.Query3D||(Geometry.Query3D={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var Query3D;(function(Query3D){var SubdivisionTree3DNode;(function(SubdivisionTree3DNode){function nearestLeaf(node,ctx){var pivot=ctx.pivot,_a=ctx.structure,indices=_a.indices,positions=_a.positions,rSq=ctx.radiusSq,dx,dy,dz,o,m,i;for(i=node.startIndex;i<node.endIndex;i++){o=3*indices[i];dx=pivot[0]-positions[o];dy=pivot[1]-positions[o+1];dz=pivot[2]-positions[o+2];m=dx*dx+dy*dy+dz*dz;if(m<=rSq)Query3D.QueryContext.add(ctx,m,indices[i])}}function nearestNode(node,ctx,dim){var pivot=ctx.pivot[dim],left=pivot<node.splitValue;if(left?pivot+ctx.radius>node.splitValue:pivot-ctx.radius<node.splitValue){nearest(node.left,ctx,(dim+1)%3);nearest(node.right,ctx,(dim+1)%3)}else if(left){nearest(node.left,ctx,(dim+1)%3)}else{nearest(node.right,ctx,(dim+1)%3)}}function nearest(node,ctx,dim){if(node.startIndex===node.endIndex)return;if(isNaN(node.splitValue))nearestLeaf(node,ctx);else nearestNode(node,ctx,dim)}SubdivisionTree3DNode.nearest=nearest;function create(splitValue,startIndex,endIndex,left,right){return{splitValue:splitValue,startIndex:startIndex,endIndex:endIndex,left:left,right:right}}SubdivisionTree3DNode.create=create})(SubdivisionTree3DNode||(SubdivisionTree3DNode={}));var SubdivisionTree3DBuilder;(function(SubdivisionTree3DBuilder){function split(state,startIndex,endIndex,coord){var delta=endIndex-startIndex+1;if(delta<=0){return state.emptyNode}else if(delta<=state.leafSize){return SubdivisionTree3DNode.create(NaN,startIndex,endIndex+1,state.emptyNode,state.emptyNode)}var min=state.bounds.min[coord],max=state.bounds.max[coord],median=.5*(min+max),midIndex=0,l=startIndex,r=endIndex,t,left,right;while(l<r){t=state.indices[r];state.indices[r]=state.indices[l];state.indices[l]=t;while(l<=endIndex&&state.positions[3*state.indices[l]+coord]<=median)l++;while(r>=startIndex&&state.positions[3*state.indices[r]+coord]>median)r--}midIndex=l-1;state.bounds.max[coord]=median;left=split(state,startIndex,midIndex,(coord+1)%3);state.bounds.max[coord]=max;state.bounds.min[coord]=median;right=split(state,midIndex+1,endIndex,(coord+1)%3);state.bounds.min[coord]=min;return SubdivisionTree3DNode.create(median,startIndex,endIndex+1,left,right)}function build(_a,leafSize){var elements=_a.elements,positions=_a.positions,bounds=_a.bounds,indices=_a.indices;var state={bounds:bounds,positions:positions,leafSize:leafSize,indices:indices,emptyNode:SubdivisionTree3DNode.create(NaN,-1,-1,void 0,void 0)};var root=split(state,0,indices.length-1,0);return{root:root,indices:indices,positions:positions}}SubdivisionTree3DBuilder.build=build})(SubdivisionTree3DBuilder||(SubdivisionTree3DBuilder={}));function createSubdivisionTree(data,leafSize){if(leafSize===void 0){leafSize=32}var tree=SubdivisionTree3DBuilder.build(data,leafSize);return function(){var ctx=Query3D.QueryContext.create(tree,data.elements);return function(x,y,z,radius){Query3D.QueryContext.update(ctx,x,y,z,radius);SubdivisionTree3DNode.nearest(tree.root,ctx,0);return ctx.buffer}}}Query3D.createSubdivisionTree=createSubdivisionTree})(Query3D=Geometry.Query3D||(Geometry.Query3D={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var Query3D;(function(Query3D){function nearest(ctx){var _a=ctx.structure,_b=_a.min,minX=_b[0],minY=_b[1],minZ=_b[2],_c=_a.size,sX=_c[0],sY=_c[1],sZ=_c[2],bucketOffset=_a.bucketOffset,bucketCounts=_a.bucketCounts,bucketArray=_a.bucketArray,grid=_a.grid,positions=_a.positions;var r=ctx.radius,rSq=ctx.radiusSq,_d=ctx.pivot,x=_d[0],y=_d[1],z=_d[2];var loX=Math.max(0,x-r-minX>>3);var loY=Math.max(0,y-r-minY>>3);var loZ=Math.max(0,z-r-minZ>>3);var hiX=Math.min(sX,x+r-minX>>3);var hiY=Math.min(sY,y+r-minY>>3);var hiZ=Math.min(sZ,z+r-minZ>>3);for(var ix=loX;ix<=hiX;ix++){for(var iy=loY;iy<=hiY;iy++){for(var iz=loZ;iz<=hiZ;iz++){var idx=(ix*sY+iy)*sZ+iz;var bucketIdx=grid[idx];if(bucketIdx>0){var k=bucketIdx-1;var offset=bucketOffset[k];var count=bucketCounts[k];var end=offset+count;for(var i=offset;i<end;i++){var idx_1=bucketArray[i];var dx=positions[3*idx_1+0]-x;var dy=positions[3*idx_1+1]-y;var dz=positions[3*idx_1+2]-z;var distSq=dx*dx+dy*dy+dz*dz;if(distSq<=rSq){Query3D.QueryContext.add(ctx,distSq,idx_1)}}}}}}}function _build(state){var bounds=state.bounds,_a=state.size,sX=_a[0],sY=_a[1],sZ=_a[2],positions=state.positions,indices=state.indices;var n=sX*sY*sZ;var count=indices.length;var _b=bounds.min,minX=_b[0],minY=_b[1],minZ=_b[2];var bucketCount=0;var grid=new Uint32Array(n);var bucketIndex=new Int32Array(count);for(var i=0;i<count;i++){var x=positions[3*i+0]-minX>>3;var y=positions[3*i+1]-minY>>3;var z=positions[3*i+2]-minZ>>3;var idx=(x*sY+y)*sZ+z;if((grid[idx]+=1)===1){bucketCount+=1}bucketIndex[i]=idx}var bucketCounts=new Int32Array(bucketCount);for(var i=0,j=0;i<n;i++){var c=grid[i];if(c>0){grid[i]=j+1;bucketCounts[j]=c;j+=1}}var bucketOffset=new Uint32Array(count);for(var i=1;i<count;++i){bucketOffset[i]+=bucketOffset[i-1]+bucketCounts[i-1]}var bucketFill=new Int32Array(bucketCount);var bucketArray=new Int32Array(count);for(var i=0;i<count;i++){var bucketIdx=grid[bucketIndex[i]];if(bucketIdx>0){var k=bucketIdx-1;bucketArray[bucketOffset[k]+bucketFill[k]]=i;bucketFill[k]+=1}}return{size:state.size,bucketArray:bucketArray,bucketCounts:bucketCounts,bucketOffset:bucketOffset,grid:grid,min:state.bounds.min,positions:positions}}function build(_a){var elements=_a.elements,positions=_a.positions,bounds=_a.bounds,indices=_a.indices;var size=[(bounds.max[0]-bounds.min[0]>>3)+1,(bounds.max[1]-bounds.min[1]>>3)+1,(bounds.max[2]-bounds.min[2]>>3)+1];var state={size:size,positions:positions,indices:indices,bounds:bounds};return _build(state)}function createSpatialHash(data){var tree=build(data);return function(){var ctx=Query3D.QueryContext.create(tree,data.elements);return function(x,y,z,radius){Query3D.QueryContext.update(ctx,x,y,z,radius);nearest(ctx);return ctx.buffer}}}Query3D.createSpatialHash=createSpatialHash})(Query3D=Geometry.Query3D||(Geometry.Query3D={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var MarchingCubes;(function(MarchingCubes){"use strict";function compute(parameters){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var comp;return __generator(this,function(_a){switch(_a.label){case 0:comp=new MarchingCubesComputation(parameters,ctx);return[4,comp.run()];case 1:return[2,_a.sent()]}})})})}MarchingCubes.compute=compute;var MarchingCubesComputation=function(){function MarchingCubesComputation(parameters,ctx){this.ctx=ctx;this.minX=0;this.minY=0;this.minZ=0;this.maxX=0;this.maxY=0;this.maxZ=0;var params=Core.Utils.extend({},parameters);if(!params.bottomLeft)params.bottomLeft=[0,0,0];if(!params.topRight)params.topRight=params.scalarField.dimensions;this.state=new MarchingCubesState(params),this.minX=params.bottomLeft[0];this.minY=params.bottomLeft[1];this.minZ=params.bottomLeft[2];this.maxX=params.topRight[0]-1;this.maxY=params.topRight[1]-1;this.maxZ=params.topRight[2]-1;this.size=(this.maxX-this.minX)*(this.maxY-this.minY)*(this.maxZ-this.minZ);this.sliceSize=(this.maxX-this.minX)*(this.maxY-this.minY)}MarchingCubesComputation.prototype.doSlices=function(){return __awaiter(this,void 0,void 0,function(){var done,started,k,t;return __generator(this,function(_a){switch(_a.label){case 0:done=0;started=Core.Utils.PerformanceMonitor.currentTime();k=this.minZ;_a.label=1;case 1:if(!(k<this.maxZ))return[3,4];this.slice(k);done+=this.sliceSize;t=Core.Utils.PerformanceMonitor.currentTime();if(!(t-started>Core.Computation.UpdateProgressDelta))return[3,3];return[4,this.ctx.updateProgress("Computing surface...",true,done,this.size)];case 2:_a.sent();started=t;_a.label=3;case 3:k++;return[3,1];case 4:return[2]}})})};MarchingCubesComputation.prototype.slice=function(k){for(var j=this.minY;j<this.maxY;j++){for(var i=this.minX;i<this.maxX;i++){this.state.processCell(i,j,k)}}this.state.clearEdgeVertexIndexSlice(k)};MarchingCubesComputation.prototype.finish=function(){var vertices=Core.Utils.ChunkedArray.compact(this.state.vertexBuffer);var triangles=Core.Utils.ChunkedArray.compact(this.state.triangleBuffer);this.state.vertexBuffer=void 0;this.state.verticesOnEdges=void 0;var ret={vertexCount:vertices.length/3|0,triangleCount:triangles.length/3|0,vertices:vertices,triangleIndices:triangles,annotation:this.state.annotate?Core.Utils.ChunkedArray.compact(this.state.annotationBuffer):void 0};return ret};MarchingCubesComputation.prototype.run=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.ctx.updateProgress("Computing surface...",true,0,this.size)];case 1:_a.sent();return[4,this.doSlices()];case 2:_a.sent();return[4,this.ctx.updateProgress("Finalizing...")];case 3:_a.sent();return[2,this.finish()]}})})};return MarchingCubesComputation}();var MarchingCubesState=function(){function MarchingCubesState(params){this.vertList=[0,0,0,0,0,0,0,0,0,0,0,0];this.i=0;this.j=0;this.k=0;this.nX=params.scalarField.dimensions[0];this.nY=params.scalarField.dimensions[1];this.nZ=params.scalarField.dimensions[2];this.isoLevel=params.isoLevel;this.scalarField=params.scalarField;this.annotationField=params.annotationField;var dX=params.topRight[0]-params.bottomLeft[0],dY=params.topRight[1]-params.bottomLeft[1],dZ=params.topRight[2]-params.bottomLeft[2],vertexBufferSize=Math.min(262144,Math.max(dX*dY*dZ/16,1024)|0),triangleBufferSize=Math.min(1<<16,vertexBufferSize*4);this.vertexBuffer=Core.Utils.ChunkedArray.forVertex3D(vertexBufferSize);this.triangleBuffer=Core.Utils.ChunkedArray.create(function(size){return new Uint32Array(size)},triangleBufferSize,3);this.annotate=!!params.annotationField;if(this.annotate)this.annotationBuffer=Core.Utils.ChunkedArray.forInt32(vertexBufferSize);this.verticesOnEdges=new Int32Array(3*this.nX*this.nY*2)}MarchingCubesState.prototype.get3dOffsetFromEdgeInfo=function(index){return this.nX*((this.k+index.k)%2*this.nY+this.j+index.j)+this.i+index.i};MarchingCubesState.prototype.clearEdgeVertexIndexSlice=function(k){var start=k%2===0?0:3*this.nX*this.nY;var end=k%2===0?3*this.nX*this.nY:this.verticesOnEdges.length;for(var i=start;i<end;i++)this.verticesOnEdges[i]=0};MarchingCubesState.prototype.interpolate=function(edgeNum){var info=MarchingCubes.EdgeIdInfo[edgeNum],edgeId=3*this.get3dOffsetFromEdgeInfo(info)+info.e;var ret=this.verticesOnEdges[edgeId];if(ret>0)return ret-1|0;var edge=MarchingCubes.CubeEdges[edgeNum];var a=edge.a,b=edge.b;var li=a.i+this.i,lj=a.j+this.j,lk=a.k+this.k;var hi=b.i+this.i,hj=b.j+this.j,hk=b.k+this.k;var v0=this.scalarField.get(li,lj,lk),v1=this.scalarField.get(hi,hj,hk);var t=(this.isoLevel-v0)/(v0-v1);var id=Core.Utils.ChunkedArray.add3(this.vertexBuffer,li+t*(li-hi),lj+t*(lj-hj),lk+t*(lk-hk))|0;this.verticesOnEdges[edgeId]=id+1;if(this.annotate){var a_1=t<.5?this.annotationField.get(li,lj,lk):this.annotationField.get(hi,hj,hk);if(a_1<0)a_1=t<.5?this.annotationField.get(hi,hj,hk):this.annotationField.get(li,lj,lk);Core.Utils.ChunkedArray.add(this.annotationBuffer,a_1)}return id};MarchingCubesState.prototype.processCell=function(i,j,k){var tableIndex=0;if(this.scalarField.get(i,j,k)<this.isoLevel)tableIndex|=1;if(this.scalarField.get(i+1,j,k)<this.isoLevel)tableIndex|=2;if(this.scalarField.get(i+1,j+1,k)<this.isoLevel)tableIndex|=4;if(this.scalarField.get(i,j+1,k)<this.isoLevel)tableIndex|=8;if(this.scalarField.get(i,j,k+1)<this.isoLevel)tableIndex|=16;if(this.scalarField.get(i+1,j,k+1)<this.isoLevel)tableIndex|=32;if(this.scalarField.get(i+1,j+1,k+1)<this.isoLevel)tableIndex|=64;if(this.scalarField.get(i,j+1,k+1)<this.isoLevel)tableIndex|=128;if(tableIndex===0||tableIndex===255)return;this.i=i;this.j=j;this.k=k;var edgeInfo=MarchingCubes.EdgeTable[tableIndex];if((edgeInfo&1)>0)this.vertList[0]=this.interpolate(0);if((edgeInfo&2)>0)this.vertList[1]=this.interpolate(1);if((edgeInfo&4)>0)this.vertList[2]=this.interpolate(2);if((edgeInfo&8)>0)this.vertList[3]=this.interpolate(3);if((edgeInfo&16)>0)this.vertList[4]=this.interpolate(4);if((edgeInfo&32)>0)this.vertList[5]=this.interpolate(5);if((edgeInfo&64)>0)this.vertList[6]=this.interpolate(6);if((edgeInfo&128)>0)this.vertList[7]=this.interpolate(7);if((edgeInfo&256)>0)this.vertList[8]=this.interpolate(8);if((edgeInfo&512)>0)this.vertList[9]=this.interpolate(9);if((edgeInfo&1024)>0)this.vertList[10]=this.interpolate(10);if((edgeInfo&2048)>0)this.vertList[11]=this.interpolate(11);var triInfo=MarchingCubes.TriTable[tableIndex];for(var t=0;t<triInfo.length;t+=3){Core.Utils.ChunkedArray.add3(this.triangleBuffer,this.vertList[triInfo[t]],this.vertList[triInfo[t+1]],this.vertList[triInfo[t+2]])}};return MarchingCubesState}()})(MarchingCubes=Geometry.MarchingCubes||(Geometry.MarchingCubes={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var MarchingCubes;(function(MarchingCubes){var Index=function(){function Index(i,j,k){this.i=i|0;this.j=j|0;this.k=k|0}return Index}();MarchingCubes.Index=Index;var IndexPair=function(){function IndexPair(a,b){this.a=a;this.b=b}return IndexPair}();MarchingCubes.IndexPair=IndexPair;MarchingCubes.EdgesXY=[[],[0,3],[0,1],[1,3],[1,2],[0,1,1,2,2,3,0,3],[0,2],[2,3],[2,3],[0,2],[0,1,1,2,2,3,0,3],[1,2],[1,3],[0,1],[0,3],[]];MarchingCubes.EdgesXZ=[[],[0,8],[0,9],[9,8],[9,4],[0,9,9,4,4,8,0,8],[0,4],[4,8],[4,8],[0,4],[0,9,9,4,4,8,0,8],[9,4],[9,8],[0,9],[0,8],[]];MarchingCubes.EdgesYZ=[[],[3,8],[3,11],[11,8],[11,7],[3,11,11,7,7,8,3,8],[3,7],[7,8],[7,8],[3,7],[3,11,11,7,7,8,3,8],[11,7],[11,8],[3,11],[3,8],[]];MarchingCubes.CubeVertices=[new Index(0,0,0),new Index(1,0,0),new Index(1,1,0),new Index(0,1,0),new Index(0,0,1),new Index(1,0,1),new Index(1,1,1),new Index(0,1,1)];MarchingCubes.CubeEdges=[new IndexPair(MarchingCubes.CubeVertices[0],MarchingCubes.CubeVertices[1]),new IndexPair(MarchingCubes.CubeVertices[1],MarchingCubes.CubeVertices[2]),new IndexPair(MarchingCubes.CubeVertices[2],MarchingCubes.CubeVertices[3]),new IndexPair(MarchingCubes.CubeVertices[3],MarchingCubes.CubeVertices[0]),new IndexPair(MarchingCubes.CubeVertices[4],MarchingCubes.CubeVertices[5]),new IndexPair(MarchingCubes.CubeVertices[5],MarchingCubes.CubeVertices[6]),new IndexPair(MarchingCubes.CubeVertices[6],MarchingCubes.CubeVertices[7]),new IndexPair(MarchingCubes.CubeVertices[7],MarchingCubes.CubeVertices[4]),new IndexPair(MarchingCubes.CubeVertices[0],MarchingCubes.CubeVertices[4]),new IndexPair(MarchingCubes.CubeVertices[1],MarchingCubes.CubeVertices[5]),new IndexPair(MarchingCubes.CubeVertices[2],MarchingCubes.CubeVertices[6]),new IndexPair(MarchingCubes.CubeVertices[3],MarchingCubes.CubeVertices[7])];MarchingCubes.EdgeIdInfo=[{i:0,j:0,k:0,e:0},{i:1,j:0,k:0,e:1},{i:0,j:1,k:0,e:0},{i:0,j:0,k:0,e:1},{i:0,j:0,k:1,e:0},{i:1,j:0,k:1,e:1},{i:0,j:1,k:1,e:0},{i:0,j:0,k:1,e:1},{i:0,j:0,k:0,e:2},{i:1,j:0,k:0,e:2},{i:1,j:1,k:0,e:2},{i:0,j:1,k:0,e:2}];MarchingCubes.EdgeTable=[0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0];MarchingCubes.TriTable=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]]})(MarchingCubes=Geometry.MarchingCubes||(Geometry.MarchingCubes={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Geometry;(function(Geometry){var MolecularSurface;(function(MolecularSurface){"use strict";var MolecularIsoSurfaceParametersWrapper=function(){function MolecularIsoSurfaceParametersWrapper(params){Core.Utils.extend(this,params,{exactBoundary:false,boundaryDelta:{dx:1.5,dy:1.5,dz:1.5},probeRadius:1.4,atomRadii:function(){return 1},density:1.1,interactive:false,smoothingIterations:1});if(this.exactBoundary)this.boundaryDelta={dx:0,dy:0,dz:0};if(this.density<.05)this.density=.05}return MolecularIsoSurfaceParametersWrapper}();var MolecularIsoFieldComputation=function(){function MolecularIsoFieldComputation(inputParameters,ctx){this.inputParameters=inputParameters;this.ctx=ctx;this.minX=Number.MAX_VALUE;this.minY=Number.MAX_VALUE;this.minZ=Number.MAX_VALUE;this.maxX=-Number.MAX_VALUE;this.maxY=-Number.MAX_VALUE;this.maxZ=-Number.MAX_VALUE;this.nX=0;this.nY=0;this.nZ=0;this.dX=.1;this.dY=.1;this.dZ=.1;this.field=new Float32Array(0);this.distanceField=new Float32Array(0);this.proximityMap=new Int32Array(0);this.minIndex={i:0,j:0,k:0};this.maxIndex={i:0,j:0,k:0};this.parameters=new MolecularIsoSurfaceParametersWrapper(inputParameters.parameters);var positions=inputParameters.positions;this.x=positions.x;this.y=positions.y;this.z=positions.z;this.atomIndices=inputParameters.atomIndices;if(this.parameters.density>=.99){this.vdwScaleFactor=1.000000001}else{this.vdwScaleFactor=1+(1-this.parameters.density*this.parameters.density)}}MolecularIsoFieldComputation.prototype.findBounds=function(){for(var _i=0,_a=this.atomIndices;_i<_a.length;_i++){var aI=_a[_i];var r=this.parameters.exactBoundary?0:this.vdwScaleFactor*this.parameters.atomRadius(aI)+this.parameters.probeRadius,xx=this.x[aI],yy=this.y[aI],zz=this.z[aI];if(r<0)continue;this.minX=Math.min(this.minX,xx-r);this.minY=Math.min(this.minY,yy-r);this.minZ=Math.min(this.minZ,zz-r);this.maxX=Math.max(this.maxX,xx+r);this.maxY=Math.max(this.maxY,yy+r);this.maxZ=Math.max(this.maxZ,zz+r)}if(this.minX===Number.MAX_VALUE){this.minX=this.minY=this.minZ=-1;this.maxX=this.maxY=this.maxZ=1}this.minX-=this.parameters.boundaryDelta.dx;this.minY-=this.parameters.boundaryDelta.dy;this.minZ-=this.parameters.boundaryDelta.dz;this.maxX+=this.parameters.boundaryDelta.dx;this.maxY+=this.parameters.boundaryDelta.dy;this.maxZ+=this.parameters.boundaryDelta.dz;this.nX=Math.floor((this.maxX-this.minX)*this.parameters.density);this.nY=Math.floor((this.maxY-this.minY)*this.parameters.density);this.nZ=Math.floor((this.maxZ-this.minZ)*this.parameters.density);this.nX=Math.min(this.nX,333);this.nY=Math.min(this.nY,333);this.nZ=Math.min(this.nZ,333);this.dX=(this.maxX-this.minX)/(this.nX-1);this.dY=(this.maxY-this.minY)/(this.nY-1);this.dZ=(this.maxZ-this.minZ)/(this.nZ-1)};MolecularIsoFieldComputation.prototype.initData=function(){var len=this.nX*this.nY*this.nZ;this.field=new Float32Array(len);this.distanceField=new Float32Array(len);this.proximityMap=new Int32Array(len);var mv=Number.POSITIVE_INFINITY;for(var j=0,_b=this.proximityMap.length;j<_b;j++){this.distanceField[j]=mv;this.proximityMap[j]=-1}};MolecularIsoFieldComputation.prototype.updateMinIndex=function(x,y,z){this.minIndex.i=Math.max(Math.floor((x-this.minX)/this.dX)|0,0);this.minIndex.j=Math.max(Math.floor((y-this.minY)/this.dY)|0,0);this.minIndex.k=Math.max(Math.floor((z-this.minZ)/this.dZ)|0,0)};MolecularIsoFieldComputation.prototype.updateMaxIndex=function(x,y,z){this.maxIndex.i=Math.min(Math.ceil((x-this.minX)/this.dX)|0,this.nX);this.maxIndex.j=Math.min(Math.ceil((y-this.minY)/this.dY)|0,this.nY);this.maxIndex.k=Math.min(Math.ceil((z-this.minZ)/this.dZ)|0,this.nZ)};MolecularIsoFieldComputation.prototype.addBall=function(aI,strength){var strSq=strength*strength;var cx=this.x[aI],cy=this.y[aI],cz=this.z[aI];this.updateMinIndex(cx-strength,cy-strength,cz-strength);this.updateMaxIndex(cx+strength,cy+strength,cz+strength);var mini=this.minIndex.i,minj=this.minIndex.j,mink=this.minIndex.k;var maxi=this.maxIndex.i,maxj=this.maxIndex.j,maxk=this.maxIndex.k;cx=this.minX-cx;cy=this.minY-cy;cz=this.minZ-cz;for(var k=mink;k<maxk;k++){var tZ=cz+k*this.dZ,zz=tZ*tZ,oZ=k*this.nY;for(var j=minj;j<maxj;j++){var tY=cy+j*this.dY,yy=zz+tY*tY,oY=this.nX*(oZ+j);for(var i=mini;i<maxi;i++){var tX=cx+i*this.dX,xx=yy+tX*tX,offset=oY+i;var v=strSq/(1e-6+xx)-1;if(xx<this.distanceField[offset]){this.proximityMap[offset]=aI;this.distanceField[offset]=xx}if(v>0){this.field[offset]+=v}}}}};MolecularIsoFieldComputation.prototype.processChunks=function(){return __awaiter(this,void 0,void 0,function(){var chunkSize,started,currentAtom,_b,aI,r,t;return __generator(this,function(_a){switch(_a.label){case 0:chunkSize=1e4;started=Core.Utils.PerformanceMonitor.currentTime();return[4,this.ctx.updateProgress("Creating field...",true)];case 1:_a.sent();currentAtom=0,_b=this.atomIndices.length;_a.label=2;case 2:if(!(currentAtom<_b))return[3,5];aI=this.atomIndices[currentAtom];r=this.vdwScaleFactor*this.parameters.atomRadius(aI)+this.parameters.probeRadius;if(r>=0){this.addBall(aI,r)}if(!((currentAtom+1)%chunkSize===0))return[3,4];t=Core.Utils.PerformanceMonitor.currentTime();if(!(t-started>Core.Computation.UpdateProgressDelta))return[3,4];started=t;return[4,this.ctx.updateProgress("Creating field...",true,currentAtom,_b)];case 3:_a.sent();_a.label=4;case 4:currentAtom++;return[3,2];case 5:return[2]}})})};MolecularIsoFieldComputation.prototype.finish=function(){var t=Geometry.LinearAlgebra.Matrix4.zero();Geometry.LinearAlgebra.Matrix4.fromTranslation(t,[this.minX,this.minY,this.minZ]);t[0]=this.dX;t[5]=this.dY;t[10]=this.dZ;var ret={data:{scalarField:new Core.Formats.Density.Field3DZYX(this.field,[this.nX,this.nY,this.nZ]),annotationField:this.parameters.interactive?new Core.Formats.Density.Field3DZYX(this.proximityMap,[this.nX,this.nY,this.nZ]):void 0,isoLevel:.05},bottomLeft:Geometry.LinearAlgebra.Vector3.fromValues(this.minX,this.minY,this.minZ),topRight:Geometry.LinearAlgebra.Vector3.fromValues(this.maxX,this.maxY,this.maxZ),transform:t,inputParameters:this.inputParameters,parameters:this.parameters};this.distanceField=null;this.proximityMap=null;return ret};MolecularIsoFieldComputation.prototype.run=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,this.ctx.updateProgress("Initializing...")];case 1:_a.sent();this.findBounds();this.initData();return[4,this.processChunks()];case 2:_a.sent();return[4,this.ctx.updateProgress("Finalizing...",void 0,this.atomIndices.length,this.atomIndices.length)];case 3:_a.sent();return[2,this.finish()]}})})};return MolecularIsoFieldComputation}();function createMolecularIsoFieldAsync(parameters){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var field;return __generator(this,function(_a){switch(_a.label){case 0:field=new MolecularIsoFieldComputation(parameters,ctx);return[4,field.run()];case 1:return[2,_a.sent()]}})})})}MolecularSurface.createMolecularIsoFieldAsync=createMolecularIsoFieldAsync;function computeMolecularSurfaceAsync(parameters){var _this=this;return Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var field,surface,smoothing,smoothingVertexWeight;return __generator(this,function(_a){switch(_a.label){case 0:return[4,createMolecularIsoFieldAsync(parameters).run(ctx)];case 1:field=_a.sent();return[4,Geometry.MarchingCubes.compute(field.data).run(ctx)];case 2:surface=_a.sent();return[4,Geometry.Surface.transform(surface,field.transform).run(ctx)];case 3:surface=_a.sent();smoothing=parameters.parameters&&parameters.parameters.smoothingIterations||1;smoothingVertexWeight=1;if(parameters.parameters&&parameters.parameters.density<1){smoothingVertexWeight=2/parameters.parameters.density}return[4,Geometry.Surface.laplacianSmooth(surface,smoothing,smoothingVertexWeight).run(ctx)];case 4:surface=_a.sent();return[2,{surface:surface,usedParameters:field.parameters}]}})})})}MolecularSurface.computeMolecularSurfaceAsync=computeMolecularSurfaceAsync})(MolecularSurface=Geometry.MolecularSurface||(Geometry.MolecularSurface={}))})(Geometry=Core.Geometry||(Core.Geometry={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){"use strict";var DataTable=Core.Utils.DataTable;var ComponentBondInfoEntry=function(){function ComponentBondInfoEntry(id){this.id=id;this.map=Core.Utils.FastMap.create()}ComponentBondInfoEntry.prototype.add=function(a,b,order,swap){if(swap===void 0){swap=true}var e=this.map.get(a);if(e!==void 0){var f=e.get(b);if(f===void 0){e.set(b,order)}}else{var map=Core.Utils.FastMap.create();map.set(b,order);this.map.set(a,map)}if(swap)this.add(b,a,order,false)};return ComponentBondInfoEntry}();Structure.ComponentBondInfoEntry=ComponentBondInfoEntry;var ComponentBondInfo=function(){function ComponentBondInfo(){this.entries=Core.Utils.FastMap.create()}ComponentBondInfo.prototype.newEntry=function(id){var e=new ComponentBondInfoEntry(id);this.entries.set(id,e);return e};return ComponentBondInfo}();Structure.ComponentBondInfo=ComponentBondInfo;var PolyResidueIdentifier=function(){function PolyResidueIdentifier(asymId,seqNumber,insCode){this.asymId=asymId;this.seqNumber=seqNumber;this.insCode=insCode}PolyResidueIdentifier.areEqual=function(a,index,bAsymId,bSeqNumber,bInsCode){return a.asymId===bAsymId[index]&&a.seqNumber===bSeqNumber[index]&&a.insCode===bInsCode[index]};PolyResidueIdentifier.compare=function(a,b){if(a.asymId===b.asymId){if(a.seqNumber===b.seqNumber){if(a.insCode===b.insCode)return 0;if(a.insCode===void 0)return-1;if(b.insCode===void 0)return 1;return a.insCode<b.insCode?-1:1}return a.seqNumber<b.seqNumber?-1:1}return a.asymId<b.asymId?-1:1};PolyResidueIdentifier.compareResidue=function(a,index,bAsymId,bSeqNumber,bInsCode){if(a.asymId===bAsymId[index]){if(a.seqNumber===bSeqNumber[index]){if(a.insCode===bInsCode[index])return 0;if(a.insCode===void 0)return-1;if(bInsCode[index]===void 0)return 1;return a.insCode<bInsCode[index]?-1:1}return a.seqNumber<bSeqNumber[index]?-1:1}return a.asymId<bAsymId[index]?-1:1};return PolyResidueIdentifier}();Structure.PolyResidueIdentifier=PolyResidueIdentifier;var SecondaryStructureElement=function(){function SecondaryStructureElement(type,startResidueId,endResidueId,info){if(info===void 0){info={}}this.type=type;this.startResidueId=startResidueId;this.endResidueId=endResidueId;this.info=info;this.startResidueIndex=-1;this.endResidueIndex=-1}Object.defineProperty(SecondaryStructureElement.prototype,"length",{get:function(){return this.endResidueIndex-this.startResidueIndex},enumerable:true,configurable:true});return SecondaryStructureElement}();Structure.SecondaryStructureElement=SecondaryStructureElement;var SymmetryInfo=function(){function SymmetryInfo(spacegroupName,cellSize,cellAngles,toFracTransform,isNonStandardCrytalFrame){this.spacegroupName=spacegroupName;this.cellSize=cellSize;this.cellAngles=cellAngles;this.toFracTransform=toFracTransform;this.isNonStandardCrytalFrame=isNonStandardCrytalFrame}return SymmetryInfo}();Structure.SymmetryInfo=SymmetryInfo;var StructConn=function(){function StructConn(entries){this.entries=entries;this._residuePairIndex=void 0;this._atomIndex=void 0}StructConn._resKey=function(rA,rB){if(rA<rB)return rA+"-"+rB;return rB+"-"+rA};StructConn.prototype.getResiduePairIndex=function(){if(this._residuePairIndex)return this._residuePairIndex;this._residuePairIndex=Core.Utils.FastMap.create();for(var _i=0,_a=this.entries;_i<_a.length;_i++){var e=_a[_i];var ps=e.partners;var l=ps.length;for(var i=0;i<l-1;i++){for(var j=i+i;j<l;j++){var key=StructConn._resKey(ps[i].residueIndex,ps[j].residueIndex);if(this._residuePairIndex.has(key)){this._residuePairIndex.get(key).push(e)}else{this._residuePairIndex.set(key,[e])}}}}return this._residuePairIndex};StructConn.prototype.getAtomIndex=function(){if(this._atomIndex)return this._atomIndex;this._atomIndex=Core.Utils.FastMap.create();for(var _i=0,_a=this.entries;_i<_a.length;_i++){var e=_a[_i];for(var _c=0,_d=e.partners;_c<_d.length;_c++){var p=_d[_c];var key=p.atomIndex;if(this._atomIndex.has(key)){this._atomIndex.get(key).push(e)}else{this._atomIndex.set(key,[e])}}}return this._atomIndex};StructConn.prototype.getResidueEntries=function(residueAIndex,residueBIndex){return this.getResiduePairIndex().get(StructConn._resKey(residueAIndex,residueBIndex))||StructConn._emptyEntry};StructConn.prototype.getAtomEntries=function(atomIndex){return this.getAtomIndex().get(atomIndex)||StructConn._emptyEntry};StructConn._emptyEntry=[];return StructConn}();Structure.StructConn=StructConn;var AssemblyOperator=function(){function AssemblyOperator(id,name,operator){this.id=id;this.name=name;this.operator=operator}return AssemblyOperator}();Structure.AssemblyOperator=AssemblyOperator;var AssemblyGenEntry=function(){function AssemblyGenEntry(operators,asymIds){this.operators=operators;this.asymIds=asymIds}return AssemblyGenEntry}();Structure.AssemblyGenEntry=AssemblyGenEntry;var AssemblyGen=function(){function AssemblyGen(name){this.name=name;this.gens=[]}return AssemblyGen}();Structure.AssemblyGen=AssemblyGen;var AssemblyInfo=function(){function AssemblyInfo(operators,assemblies){this.operators=operators;this.assemblies=assemblies}return AssemblyInfo}();Structure.AssemblyInfo=AssemblyInfo;var Tables;(function(Tables){var int32=DataTable.typedColumn(Int32Array);var float32=DataTable.typedColumn(Float32Array);var str=DataTable.stringColumn;var nullStr=DataTable.stringNullColumn;Tables.Positions={x:float32,y:float32,z:float32};Tables.Atoms={id:int32,altLoc:str,residueIndex:int32,chainIndex:int32,entityIndex:int32,name:str,elementSymbol:str,occupancy:float32,tempFactor:float32,authName:str,rowIndex:int32};Tables.Residues={name:str,seqNumber:int32,asymId:str,authName:str,authSeqNumber:int32,authAsymId:str,insCode:nullStr,entityId:str,isHet:DataTable.typedColumn(Int8Array),atomStartIndex:int32,atomEndIndex:int32,chainIndex:int32,entityIndex:int32,secondaryStructureIndex:int32};Tables.Chains={asymId:str,entityId:str,authAsymId:str,atomStartIndex:int32,atomEndIndex:int32,residueStartIndex:int32,residueEndIndex:int32,entityIndex:int32,sourceChainIndex:void 0,operatorIndex:void 0};Tables.Entities={entityId:str,type:DataTable.customColumn(),atomStartIndex:int32,atomEndIndex:int32,residueStartIndex:int32,residueEndIndex:int32,chainStartIndex:int32,chainEndIndex:int32};Tables.Bonds={atomAIndex:int32,atomBIndex:int32,type:DataTable.typedColumn(Int8Array)};Tables.ModifiedResidues={asymId:str,seqNumber:int32,insCode:nullStr,parent:str,details:nullStr}})(Tables=Structure.Tables||(Structure.Tables={}));var Operator=function(){function Operator(matrix,id,isIdentity){this.matrix=matrix;this.id=id;this.isIdentity=isIdentity}Operator.prototype.apply=function(v){Core.Geometry.LinearAlgebra.Vector3.transformMat4(v,v,this.matrix)};Operator.applyToModelUnsafe=function(matrix,m){var v=Core.Geometry.LinearAlgebra.Vector3.zero();var _a=m.positions,x=_a.x,y=_a.y,z=_a.z;for(var i=0,_b=m.positions.count;i<_b;i++){v[0]=x[i];v[1]=y[i];v[2]=z[i];Core.Geometry.LinearAlgebra.Vector3.transformMat4(v,v,matrix);x[i]=v[0];y[i]=v[1];z[i]=v[2]}};return Operator}();Structure.Operator=Operator;var Molecule;(function(Molecule){function create(id,models,properties){if(properties===void 0){properties={}}return{id:id,models:models,properties:properties}}Molecule.create=create;var Model;(function(Model){function create(model){var ret=Core.Utils.extend({},model);var queryContext=void 0;Object.defineProperty(ret,"queryContext",{enumerable:true,configurable:false,get:function(){if(queryContext)return queryContext;queryContext=Structure.Query.Context.ofStructure(ret);return queryContext}});return ret}Model.create=create;var Source;(function(Source){Source[Source["File"]=0]="File";Source[Source["Computed"]=1]="Computed"})(Source=Model.Source||(Model.Source={}));function withTransformedXYZ(model,ctx,transform){var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;var tAtoms=model.positions.getBuilder(model.positions.count).seal();var tX=tAtoms.x,tY=tAtoms.y,tZ=tAtoms.z;var t=Core.Geometry.LinearAlgebra.Vector3.zero();for(var i=0,_l=model.positions.count;i<_l;i++){transform(ctx,x[i],y[i],z[i],t);tX[i]=t[0];tY[i]=t[1];tZ[i]=t[2]}return create({id:model.id,modelId:model.modelId,data:model.data,positions:tAtoms,parent:model.parent,source:model.source,operators:model.operators})}Model.withTransformedXYZ=withTransformedXYZ})(Model=Molecule.Model||(Molecule.Model={}))})(Molecule=Structure.Molecule||(Structure.Molecule={}))})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){"use strict";function isBondTypeCovalent(t){return t>=0&&t<=5}Structure.isBondTypeCovalent=isBondTypeCovalent;var __ElementIndex={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109};var __ElementBondThresholds={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:1.9,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88};var __ElementPairThresholds={0:.8,20:1.31,27:1.3,35:1.3,44:1.05,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.55,113:1.59,114:1.36,129:1.45,144:1.6,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81};var DefaultBondingRadius=2.001;var MetalsSet=function(){var metals=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"];var set=Core.Utils.FastSet.create();for(var _i=0,metals_1=metals;_i<metals_1.length;_i++){var m=metals_1[_i];set.add(__ElementIndex[m])}return set}();function pair(a,b){if(a<b)return(a+b)*(a+b+1)/2+b;else return(a+b)*(a+b+1)/2+a}function idx(e){var i=__ElementIndex[e];if(i===void 0)return-1;return i}function pairThreshold(i,j){if(i<0||j<0)return-1;var r=__ElementPairThresholds[pair(i,j)];if(r===void 0)return-1;return r}function threshold(i){if(i<0)return DefaultBondingRadius;var r=__ElementBondThresholds[i];if(r===void 0)return DefaultBondingRadius;return r}var H_ID=__ElementIndex["H"];function isHydrogen(i){return i===H_ID}function isMetal(e){var i=__ElementIndex[e];if(i===void 0)return false;return MetalsSet.has(i)}function bondsFromInput(model,atomIndices){var bonds=model.data.bonds.input;if(atomIndices.length===model.data.atoms.count)return bonds;var mask=Core.Utils.Mask.ofIndices(model.data.atoms.count,atomIndices);var a=bonds.atomAIndex,b=bonds.atomBIndex,t=bonds.type;var count=0;for(var i=0,__i=bonds.count;i<__i;i++){if(!mask.has(a[i])||!mask.has(b[i]))continue;count++}var ret=Core.Utils.DataTable.ofDefinition(Structure.Tables.Bonds,count);var atomAIndex=ret.atomAIndex,atomBIndex=ret.atomBIndex,type=ret.type;var elementSymbol=model.data.atoms.elementSymbol;var offset=0;for(var i=0,__i=bonds.count;i<__i;i++){var u=a[i],v=b[i];if(!mask.has(u)||!mask.has(v))continue;atomAIndex[offset]=u;atomBIndex[offset]=v;var metal=isMetal(elementSymbol[u])||isMetal(elementSymbol[v]);type[offset]=metal?6:t[i];offset++}return ret}var ChunkedAdd=Core.Utils.ChunkedArray.add;function addComponentBonds(_a,rI){var model=_a.model,mask=_a.mask,atomA=_a.atomA,atomB=_a.atomB,type=_a.type;var _b=model.data.residues,atomStartIndex=_b.atomStartIndex,atomEndIndex=_b.atomEndIndex,residueName=_b.name;var _c=model.data.atoms,atomName=_c.name,altLoc=_c.altLoc,elementSymbol=_c.elementSymbol;var map=model.data.bonds.component.entries.get(residueName[rI]).map;var start=atomStartIndex[rI],end=atomEndIndex[rI];for(var i=start;i<end-1;i++){if(!mask.has(i))continue;var pairs=map.get(atomName[i]);if(!pairs)continue;var altA=altLoc[i];var isMetalA=isMetal(elementSymbol[i]);for(var j=i+1;j<end;j++){if(!mask.has(j))continue;var altB=altLoc[j];if(altA&&altB&&altA!==altB)continue;var order=pairs.get(atomName[j]);if(order===void 0)continue;var metal=isMetalA||isMetal(elementSymbol[j]);ChunkedAdd(atomA,i);ChunkedAdd(atomB,j);ChunkedAdd(type,metal?6:order)}}}function _computeBonds(model,atomIndices,params){var MAX_RADIUS=3;var _a=model.data.bonds,structConn=_a.structConn,component=_a.component;var _b=model.positions,x=_b.x,y=_b.y,z=_b.z;var _c=model.data.atoms,elementSymbol=_c.elementSymbol,residueIndex=_c.residueIndex,altLoc=_c.altLoc;var residueName=model.data.residues.name;var query3d=model.queryContext.lookup3d();var atomA=Core.Utils.ChunkedArray.create(function(size){return new Int32Array(size)},atomIndices.length*1.33|0,1);var atomB=Core.Utils.ChunkedArray.create(function(size){return new Int32Array(size)},atomIndices.length*1.33|0,1);var type=Core.Utils.ChunkedArray.create(function(size){return new Uint8Array(size)},atomIndices.length*1.33|0,1);var mask=Core.Utils.Mask.ofIndices(model.data.atoms.count,atomIndices);var state={model:model,mask:mask,atomA:atomA,atomB:atomB,type:type};var lastResidue=-1;var hasComponent=false;for(var _i=0,atomIndices_1=atomIndices;_i<atomIndices_1.length;_i++){var aI=atomIndices_1[_i];var raI=residueIndex[aI];if(!params.forceCompute&&raI!==lastResidue){hasComponent=!!component&&component.entries.has(residueName[raI]);if(hasComponent){addComponentBonds(state,raI)}}lastResidue=raI;var aeI=idx(elementSymbol[aI]);var _d=query3d(x[aI],y[aI],z[aI],MAX_RADIUS),elements=_d.elements,count=_d.count,squaredDistances=_d.squaredDistances;var isHa=isHydrogen(aeI);var thresholdA=threshold(aeI);var altA=altLoc[aI];var metalA=MetalsSet.has(aeI);var structConnEntries=params.forceCompute?void 0:structConn&&structConn.getAtomEntries(aI);for(var ni=0;ni<count;ni++){var bI=elements[ni];if(bI<=aI||!mask.has(bI))continue;var altB=altLoc[bI];if(altA&&altB&&altA!==altB)continue;var rbI=residueIndex[bI];if(raI===rbI&&hasComponent)continue;var beI=idx(elementSymbol[bI]);var isHb=isHydrogen(beI);if(isHa&&isHb)continue;var dist=Math.sqrt(squaredDistances[ni]);if(dist===0)continue;if(structConnEntries){var added=false;for(var _e=0,structConnEntries_1=structConnEntries;_e<structConnEntries_1.length;_e++){var se=structConnEntries_1[_e];for(var _f=0,_g=se.partners;_f<_g.length;_f++){var p=_g[_f];if(p.atomIndex===bI){ChunkedAdd(atomA,aI);ChunkedAdd(atomB,bI);ChunkedAdd(type,se.bondType);added=true;break}}if(added)break}if(added)continue}if(isHa||isHb){if(dist<params.maxHbondLength){ChunkedAdd(atomA,aI);ChunkedAdd(atomB,bI);ChunkedAdd(type,1)}continue}var thresholdAB=pairThreshold(aeI,beI);var pairingThreshold=thresholdAB>0?thresholdAB:beI<0?thresholdA:Math.max(thresholdA,threshold(beI));var metalB=MetalsSet.has(beI);if(dist<=pairingThreshold){ChunkedAdd(atomA,aI);ChunkedAdd(atomB,bI);ChunkedAdd(type,metalA||metalB?6:1)}}}var ret=Core.Utils.DataTable.builder(atomA.elementCount);ret.addRawColumn("atomAIndex",function(s){return new Int32Array(s)},Core.Utils.ChunkedArray.compact(atomA));ret.addRawColumn("atomBIndex",function(s){return new Int32Array(s)},Core.Utils.ChunkedArray.compact(atomB));ret.addRawColumn("type",function(s){return new Uint8Array(s)},Core.Utils.ChunkedArray.compact(type));var dataTable=ret.seal();return dataTable}function computeBonds(model,atomIndices,params){if(model.data.bonds.input)return bondsFromInput(model,atomIndices);return _computeBonds(model,atomIndices,{maxHbondLength:params&&params.maxHbondLength||1.15,forceCompute:!!(params&&params.forceCompute)})}Structure.computeBonds=computeBonds})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){"use strict";var Mat4=Core.Geometry.LinearAlgebra.Matrix4;var Vec4=Core.Geometry.LinearAlgebra.Vector4;var Spacegroup=function(){function Spacegroup(info){this.info=info;this.temp=Mat4.zero();this.tempV=new Float64Array(4);if(SpacegroupTables.Spacegroup[info.spacegroupName]===void 0){throw"'"+info.spacegroupName+"' is not a spacegroup recognized by the library."}this.space=this.getSpace();this.operators=this.getOperators()}Object.defineProperty(Spacegroup.prototype,"operatorCount",{get:function(){return this.operators.length},enumerable:true,configurable:true});Spacegroup.prototype.getOperatorMatrix=function(index,i,j,k,target){this.tempV[0]=i;this.tempV[1]=j;this.tempV[2]=k;Mat4.fromTranslation(this.temp,this.tempV);Mat4.mul(target,Mat4.mul(target,Mat4.mul(target,this.space.fromFrac,this.temp),this.operators[index]),this.space.toFrac);return target};Spacegroup.prototype.getSpace=function(){var toFrac=this.info.toFracTransform,fromFrac=Mat4.zero();Mat4.invert(fromFrac,toFrac);return{toFrac:toFrac,fromFrac:fromFrac,baseX:Vec4.transform(Vec4.zero(),Vec4.fromValues(1,0,0,1),toFrac),baseY:Vec4.transform(Vec4.zero(),Vec4.fromValues(0,1,0,1),toFrac),baseZ:Vec4.transform(Vec4.zero(),Vec4.fromValues(0,0,1,1),toFrac)}};Spacegroup.getOperator=function(ids){var r1=SpacegroupTables.Transform[ids[0]],r2=SpacegroupTables.Transform[ids[1]],r3=SpacegroupTables.Transform[ids[2]];return Mat4.ofRows([r1,r2,r3,[0,0,0,1]])};Spacegroup.prototype.getOperators=function(){var group=SpacegroupTables.Group[SpacegroupTables.Spacegroup[this.info.spacegroupName]];return group.map(function(i){return Spacegroup.getOperator(SpacegroupTables.Operator[i])})};return Spacegroup}();Structure.Spacegroup=Spacegroup;var SpacegroupTables;(function(SpacegroupTables){SpacegroupTables.Transform=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[-1,0,0,0],[0,-1,0,0],[0,0,-1,0],[0,1,0,.5],[1,0,0,.5],[-1,0,0,.5],[0,0,1,.5],[0,-1,0,.5],[0,0,-1,.5],[1,0,0,.25],[0,-1,0,.25],[0,0,1,.25],[-1,0,0,.25],[0,1,0,.25],[0,-1,0,.75],[0,0,1,.75],[0,1,0,.75],[1,0,0,.75],[-1,0,0,.75],[0,0,-1,.25],[0,0,-1,.75],[1,-1,0,0],[-1,1,0,0],[0,0,1,.333333333333333],[0,0,1,.666666666666667],[1,0,0,.666666666666667],[0,1,0,.333333333333333],[0,-1,0,.666666666666667],[1,-1,0,.333333333333333],[-1,1,0,.666666666666667],[-1,0,0,.333333333333333],[1,0,0,.333333333333333],[0,1,0,.666666666666667],[0,-1,0,.333333333333333],[1,-1,0,.666666666666667],[-1,1,0,.333333333333333],[-1,0,0,.666666666666667],[0,0,-1,.333333333333333],[0,0,-1,.666666666666667],[0,0,1,.833333333333333],[0,0,1,.166666666666667],[0,0,-1,.833333333333333],[0,0,-1,.166666666666667]];SpacegroupTables.Operator=[[0,1,2],[3,4,5],[3,1,5],[3,6,5],[7,6,2],[8,6,5],[0,4,2],[0,4,9],[7,10,2],[7,10,9],[0,10,2],[8,10,5],[3,1,11],[3,6,11],[0,10,9],[8,6,11],[3,4,2],[0,4,5],[3,4,9],[7,10,5],[8,4,9],[8,10,9],[8,10,2],[0,6,9],[3,10,9],[0,10,11],[7,1,9],[8,1,11],[7,4,11],[7,6,9],[7,10,11],[3,10,2],[8,1,5],[0,4,11],[3,1,2],[3,1,9],[7,4,2],[8,1,2],[8,1,9],[3,6,9],[7,4,9],[8,6,2],[8,6,9],[3,6,2],[12,13,14],[15,16,14],[12,17,18],[15,19,18],[20,13,18],[21,16,18],[20,17,14],[21,19,14],[0,1,5],[8,10,11],[7,6,11],[7,6,5],[8,4,2],[7,4,5],[7,1,5],[7,1,11],[0,10,5],[0,1,11],[0,6,11],[0,6,5],[3,10,11],[8,4,11],[15,13,22],[12,16,22],[15,17,23],[12,19,23],[21,13,23],[20,16,23],[21,17,22],[20,19,22],[4,0,2],[1,3,2],[4,0,14],[1,3,18],[4,0,9],[1,3,9],[4,0,18],[1,3,14],[10,7,9],[6,8,9],[4,7,14],[6,3,18],[10,0,18],[1,8,14],[1,3,5],[4,0,5],[6,8,11],[10,7,11],[1,3,11],[4,0,11],[10,7,2],[6,8,2],[3,10,22],[7,1,23],[8,4,23],[0,6,22],[1,0,5],[4,3,5],[1,0,23],[4,3,22],[10,7,14],[6,8,18],[8,6,22],[7,10,23],[4,3,11],[1,0,11],[1,0,22],[4,3,23],[10,7,18],[6,8,14],[8,6,23],[7,10,22],[6,7,11],[10,8,11],[8,1,23],[0,10,22],[3,6,22],[7,4,23],[4,3,2],[1,0,2],[10,8,2],[6,7,2],[4,3,9],[1,0,9],[10,8,9],[6,7,9],[4,8,14],[6,0,18],[10,3,18],[1,7,14],[4,8,18],[6,0,14],[10,3,14],[1,7,18],[6,7,5],[10,8,5],[6,8,5],[10,7,5],[8,1,22],[0,10,23],[3,6,23],[7,4,22],[4,24,2],[25,3,2],[4,24,26],[25,3,27],[4,24,27],[25,3,26],[28,29,26],[30,31,26],[32,33,26],[34,35,27],[36,37,27],[38,39,27],[2,0,1],[1,2,0],[1,25,5],[24,0,5],[39,36,40],[35,38,40],[37,34,40],[33,30,41],[29,32,41],[31,28,41],[5,3,4],[4,5,3],[25,1,5],[0,24,5],[24,4,5],[3,25,5],[4,3,41],[25,1,40],[24,4,41],[3,25,40],[4,3,40],[25,1,41],[24,4,40],[3,25,41],[35,34,40],[37,36,40],[39,38,40],[29,28,41],[31,30,41],[33,32,41],[3,5,4],[5,4,3],[25,1,2],[0,24,2],[24,4,2],[3,25,2],[25,1,9],[0,24,9],[24,4,9],[3,25,9],[30,33,26],[32,29,26],[28,31,26],[36,39,27],[38,35,27],[34,37,27],[0,2,1],[2,1,0],[30,33,42],[32,29,42],[28,31,42],[36,39,43],[38,35,43],[34,37,43],[7,9,6],[9,6,7],[25,1,11],[0,24,11],[24,4,11],[3,25,11],[35,34,44],[37,36,44],[39,38,44],[29,28,45],[31,30,45],[33,32,45],[8,11,10],[11,10,8],[1,25,2],[24,0,2],[1,25,42],[24,0,43],[1,25,43],[24,0,42],[1,25,27],[24,0,26],[1,25,26],[24,0,27],[1,25,9],[24,0,9],[4,24,5],[25,3,5],[4,24,11],[25,3,11],[1,0,40],[4,3,44],[0,24,45],[1,0,41],[4,3,45],[0,24,44],[0,24,40],[0,24,41],[2,3,4],[5,3,1],[5,0,4],[4,2,3],[1,5,3],[4,5,0],[2,7,6],[2,8,10],[5,8,6],[5,7,10],[1,9,7],[4,9,8],[1,11,8],[4,11,7],[9,0,6],[9,3,10],[11,3,6],[11,0,10],[6,2,7],[10,2,8],[6,5,8],[10,5,7],[9,7,1],[9,8,4],[11,8,1],[11,7,4],[6,9,0],[10,9,3],[6,11,3],[10,11,0],[9,7,6],[9,8,10],[11,8,6],[11,7,10],[6,9,7],[10,9,8],[6,11,8],[10,11,7],[2,3,10],[5,8,1],[11,0,4],[10,2,3],[1,5,8],[4,11,0],[5,0,1],[2,0,4],[2,3,1],[1,5,0],[4,2,0],[1,2,3],[11,8,10],[11,7,6],[9,7,10],[9,8,6],[10,11,8],[6,11,7],[10,9,7],[6,9,8],[5,8,10],[5,7,6],[2,7,10],[2,8,6],[4,11,8],[1,11,7],[4,9,7],[1,9,8],[11,3,10],[11,0,6],[9,0,10],[9,3,6],[10,5,8],[6,5,7],[10,2,7],[6,2,8],[11,8,4],[11,7,1],[9,7,4],[9,8,1],[10,11,3],[6,11,0],[10,9,0],[6,9,3],[22,15,13],[22,12,16],[14,12,13],[14,15,16],[13,22,15],[16,22,12],[13,14,12],[16,14,15],[22,21,17],[22,20,19],[14,20,17],[14,21,19],[13,23,21],[16,23,20],[13,18,20],[16,18,21],[23,15,17],[23,12,19],[18,12,17],[18,15,19],[17,22,21],[19,22,20],[17,14,20],[19,14,21],[23,21,13],[23,20,16],[18,20,13],[18,21,16],[17,23,15],[19,23,12],[17,18,12],[19,18,15],[5,0,6],[2,7,4],[9,3,1],[6,5,0],[4,2,7],[1,9,3],[0,2,4],[3,2,1],[0,5,1],[2,1,3],[2,4,0],[5,1,0],[7,9,10],[8,9,6],[7,11,6],[9,6,8],[9,10,7],[11,6,7],[1,7,11],[4,8,11],[1,8,9],[4,7,9],[0,9,10],[3,9,6],[3,11,10],[0,11,6],[2,6,8],[2,10,7],[5,6,7],[5,10,8],[6,0,11],[10,3,11],[6,3,9],[10,0,9],[7,2,10],[8,2,6],[8,5,10],[7,5,6],[9,1,8],[9,4,7],[11,1,7],[11,4,8],[7,9,4],[8,9,1],[8,11,4],[7,11,1],[9,6,3],[9,10,0],[11,6,0],[11,10,3],[19,12,23],[13,15,22],[16,21,18],[17,20,14],[20,14,17],[21,18,16],[15,22,13],[12,23,19],[18,16,21],[14,17,20],[23,19,12],[22,13,15],[19,20,22],[13,21,23],[16,15,14],[17,12,18],[20,18,13],[21,14,19],[15,23,17],[12,22,16],[18,19,15],[14,13,12],[23,16,20],[22,17,21],[16,12,22],[17,15,23],[19,21,14],[13,20,18],[12,14,13],[15,18,19],[21,22,17],[20,23,16],[14,16,15],[18,17,12],[22,19,20],[23,13,21],[16,20,23],[17,21,22],[19,15,18],[13,12,14],[12,18,17],[15,14,16],[21,23,13],[20,22,19],[14,19,21],[18,13,20],[22,16,12],[23,17,15],[19,12,22],[17,21,23],[16,15,18],[13,20,14],[20,14,13],[15,18,16],[21,23,17],[12,22,19],[18,16,15],[14,13,20],[22,19,12],[23,17,21],[3,2,4],[3,5,1],[0,5,4],[2,4,3],[5,1,3],[5,4,0],[1,7,9],[4,8,9],[1,8,11],[4,7,11],[0,9,6],[3,9,10],[3,11,6],[0,11,10],[2,6,7],[2,10,8],[5,6,8],[5,10,7],[6,0,9],[10,3,9],[6,3,11],[10,0,11],[7,2,6],[8,2,10],[8,5,6],[7,5,10],[9,1,7],[9,4,8],[11,1,8],[11,4,7],[7,9,1],[8,9,4],[8,11,1],[7,11,4],[9,6,0],[9,10,3],[11,6,3],[11,10,0],[8,9,10],[8,11,6],[7,11,10],[9,10,8],[11,6,8],[11,10,7],[6,0,2],[10,3,2],[6,3,5],[10,0,5],[7,2,1],[8,2,4],[8,5,1],[7,5,4],[9,1,0],[9,4,3],[11,1,3],[11,4,0],[1,7,2],[4,8,2],[1,8,5],[4,7,5],[0,9,1],[3,9,4],[3,11,1],[0,11,4],[2,6,0],[2,10,3],[5,6,3],[5,10,0],[0,2,6],[3,2,10],[3,5,6],[0,5,10],[2,1,7],[2,4,8],[5,1,8],[5,4,7],[16,12,14],[13,21,18],[19,15,23],[17,20,22],[12,14,16],[21,18,13],[15,23,19],[20,22,17],[14,16,12],[18,13,21],[23,19,15],[22,17,20],[19,20,18],[17,15,14],[16,21,22],[13,12,23],[20,18,19],[15,14,17],[21,22,16],[12,23,13],[18,19,20],[14,17,15],[22,16,21],[23,13,12],[6,0,5],[10,3,5],[6,3,2],[10,0,2],[7,2,4],[8,2,1],[8,5,4],[7,5,1],[9,1,3],[9,4,0],[11,1,0],[11,4,3],[1,7,5],[4,8,5],[1,8,2],[4,7,2],[0,9,4],[3,9,1],[3,11,4],[0,11,1],[2,6,3],[2,10,0],[5,6,0],[5,10,3],[0,2,10],[3,2,6],[3,5,10],[0,5,6],[2,1,8],[2,4,7],[5,1,7],[5,4,8],[21,17,23],[20,16,22],[12,13,18],[15,19,14],[23,21,17],[22,20,16],[18,12,13],[14,15,19],[17,23,21],[16,22,20],[13,18,12],[19,14,15],[21,13,22],[20,19,23],[12,17,14],[15,16,18],[23,15,13],[22,12,19],[18,20,17],[14,21,16],[17,22,15],[16,23,12],[13,14,20],[19,18,21],[15,17,22],[12,16,23],[20,13,14],[21,19,18],[22,21,13],[23,20,19],[14,12,17],[18,15,16],[13,23,15],[19,22,12],[17,18,20],[16,14,21],[15,13,23],[12,19,22],[20,17,18],[21,16,14],[22,15,17],[23,12,16],[14,20,13],[18,21,19],[13,22,21],[19,23,20],[17,14,12],[16,18,15],[6,5,3],[4,9,3],[9,3,4],[5,7,4],[4,5,7],[5,3,6]];SpacegroupTables.Group=[[0],[0,1],[0,2],[0,3],[0,2,4,5],[0,6],[0,7],[0,6,4,8],[0,7,4,9],[0,6,2,1],[0,3,1,10],[0,6,2,1,4,8,5,11],[0,12,1,7],[0,1,13,14],[0,12,1,7,4,15,11,9],[0,16,2,17],[0,18,12,17],[0,16,5,19],[0,20,13,19],[0,18,12,17,4,21,15,19],[0,16,2,17,4,22,5,19],[0,16,2,17,23,24,13,25,26,20,27,28,4,22,5,19],[0,16,17,2,29,21,30,15],[0,20,13,19,29,31,32,33],[0,16,6,34],[0,18,7,34],[0,16,7,35],[0,16,36,37],[0,18,36,38],[0,16,14,39],[0,20,40,34],[0,16,8,41],[0,18,8,42],[0,16,9,42],[0,16,6,34,4,22,8,41],[0,18,7,34,4,21,9,41],[0,16,7,35,4,22,9,42],[0,16,6,34,23,24,14,39],[0,16,10,43,23,24,7,35],[0,16,36,37,23,24,9,42],[0,16,8,41,23,24,40,38],[0,16,6,34,23,24,14,39,26,20,40,38,4,22,8,41],[0,16,44,45,23,24,46,47,26,20,48,49,4,22,50,51],[0,16,6,34,29,21,9,42],[0,16,8,41,29,21,7,35],[0,16,36,37,29,21,14,39],[0,16,2,17,1,52,6,34],[0,16,2,17,53,54,9,42],[0,16,12,33,1,52,7,35],[0,16,2,17,11,55,8,41],[0,56,2,57,1,58,6,37],[0,56,15,25,1,58,9,39],[0,20,27,17,1,59,40,34],[0,56,12,28,1,58,7,38],[0,16,5,19,1,52,8,41],[0,22,13,28,1,55,14,38],[0,18,13,60,1,61,14,43],[0,16,15,30,1,52,9,42],[0,16,5,19,11,55,6,34],[0,21,12,19,1,54,7,41],[0,20,13,19,1,59,14,41],[0,20,3,30,1,59,10,42],[0,18,12,17,1,61,7,34,4,21,15,19,11,54,9,41],[0,24,13,17,1,62,14,34,4,20,27,19,11,59,40,41],[0,16,2,17,1,52,6,34,4,22,5,19,11,55,8,41],[0,16,12,33,1,52,7,35,4,22,15,30,11,55,9,42],[0,31,3,17,1,63,10,34,4,56,32,19,11,58,36,41],[0,22,2,19,64,59,14,38,4,16,5,17,65,62,40,39],[0,16,2,17,1,52,6,34,23,24,13,25,64,62,14,39,26,20,27,28,65,59,40,38,4,22,5,19,11,55,8,41],[0,16,2,17,66,67,44,45,23,24,13,25,68,69,46,47,26,20,27,28,70,71,48,49,4,22,5,19,72,73,50,51],[0,16,2,17,1,52,6,34,29,21,15,30,53,54,9,42],[0,16,5,19,1,52,8,41,29,21,12,33,53,54,7,35],[0,20,13,19,1,59,14,41,29,31,32,33,53,63,36,35],[0,31,3,17,1,63,10,34,29,20,27,30,53,59,40,42],[0,16,74,75],[0,18,76,77],[0,16,78,79],[0,18,80,81],[0,16,74,75,29,21,82,83],[0,21,84,85,29,16,86,87],[0,16,88,89],[0,16,88,89,29,21,90,91],[0,16,74,75,1,52,88,89],[0,16,78,79,1,52,92,93],[0,16,94,95,11,55,88,89],[0,16,82,83,53,54,88,89],[0,16,74,75,1,52,88,89,29,21,82,83,53,54,90,91],[0,21,84,85,96,97,88,91,29,16,86,87,98,99,90,89],[0,16,74,75,2,17,100,101],[0,16,94,95,5,19,100,101],[0,18,76,77,2,33,102,103],[0,18,104,105,106,107,100,108],[0,16,78,79,2,17,109,108],[0,16,82,83,15,30,100,101],[0,18,80,81,2,33,110,111],[0,18,112,113,114,115,100,108],[0,16,74,75,2,17,100,101,29,21,82,83,15,30,116,117],[0,21,84,85,118,119,116,101,29,16,86,87,120,121,100,117],[0,16,74,75,6,34,122,123],[0,16,74,75,8,41,124,125],[0,16,78,79,7,35,122,123],[0,16,82,83,9,42,122,123],[0,16,74,75,7,35,126,127],[0,16,74,75,9,42,128,129],[0,16,78,79,6,34,126,127],[0,16,78,79,8,41,128,129],[0,16,74,75,6,34,122,123,29,21,82,83,9,42,128,129],[0,16,74,75,7,35,126,127,29,21,82,83,8,41,124,125],[0,21,84,85,6,42,130,131,29,16,86,87,9,34,132,133],[0,21,84,85,7,41,134,135,29,16,86,87,8,35,136,137],[0,16,89,88,2,17,122,123],[0,16,89,88,12,33,126,127],[0,16,89,88,5,19,124,125],[0,16,89,88,15,30,128,129],[0,16,88,89,6,34,100,101],[0,16,89,88,7,35,109,108],[0,16,89,88,8,41,138,139],[0,16,89,88,9,42,116,117],[0,16,89,88,6,34,100,101,29,21,91,90,9,42,116,117],[0,16,89,88,7,35,109,108,29,21,91,90,8,41,138,139],[0,16,89,88,2,17,122,123,29,21,91,90,15,30,128,129],[0,16,89,88,118,121,132,131,29,21,91,90,120,119,130,133],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127],[0,16,74,75,2,17,100,101,11,55,140,141,8,41,124,125],[0,16,74,75,2,17,100,101,53,54,90,91,9,42,128,129],[0,16,74,75,5,19,138,139,1,52,88,89,8,41,124,125],[0,16,74,75,15,30,116,117,1,52,88,89,9,42,128,129],[0,16,94,95,5,19,100,101,11,55,88,89,6,34,124,125],[0,16,94,95,15,30,109,108,11,55,88,89,7,35,128,129],[0,16,78,79,2,17,109,108,1,52,92,93,6,34,126,127],[0,16,78,79,12,33,100,101,1,52,92,93,7,35,122,123],[0,16,82,83,12,33,138,139,53,54,88,89,8,41,126,127],[0,16,82,83,2,17,116,117,53,54,88,89,9,42,122,123],[0,16,78,79,5,19,116,117,1,52,92,93,8,41,128,129],[0,16,82,83,15,30,100,101,1,52,90,91,9,42,122,123],[0,16,82,83,15,30,100,101,53,54,88,89,6,34,128,129],[0,16,82,83,5,19,109,108,53,54,88,89,7,35,124,125],[0,16,74,75,2,17,100,101,1,52,88,89,6,34,122,123,29,21,82,83,15,30,116,117,53,54,90,91,9,42,128,129],[0,16,74,75,12,33,109,108,1,52,88,89,7,35,126,127,29,21,82,83,5,19,138,139,53,54,90,91,8,41,124,125],[0,21,84,85,118,119,116,101,96,97,88,91,9,34,132,133,29,16,86,87,120,121,100,117,98,99,90,89,6,42,130,131],[0,21,84,85,142,143,138,108,96,97,88,91,8,35,136,137,29,16,86,87,144,145,109,139,98,99,90,89,7,41,134,135],[0,146,147],[0,148,149],[0,150,151],[0,146,147,152,153,154,155,156,157],[0,158,159],[0,146,147,1,160,161],[0,146,147,1,160,161,152,153,154,162,163,164,155,156,157,165,166,167],[0,158,159,1,168,169],[0,146,147,101,170,171],[0,146,147,100,172,173],[0,148,149,174,175,171],[0,148,149,100,176,177],[0,150,151,178,179,171],[0,150,151,100,180,181],[0,146,147,100,172,173,152,153,154,182,183,184,155,156,157,185,186,187],[0,158,159,101,188,189],[0,146,147,122,190,191],[0,146,147,123,192,193],[0,146,147,126,194,195],[0,146,147,127,196,197],[0,146,147,122,190,191,152,153,154,198,199,200,155,156,157,201,202,203],[0,158,159,123,204,205],[0,146,147,126,194,195,152,153,154,206,207,208,155,156,157,209,210,211],[0,158,159,129,212,213],[0,146,147,101,170,171,1,160,161,123,192,193],[0,146,147,108,214,215,1,160,161,127,196,197],[0,146,147,100,172,173,1,160,161,122,190,191],[0,146,147,109,216,217,1,160,161,126,194,195],[0,146,147,100,172,173,1,160,161,122,190,191,152,153,154,182,183,184,162,163,164,198,199,200,155,156,157,185,186,187,165,166,167,201,202,203],[0,158,159,101,188,189,1,168,169,123,204,205],[0,146,147,109,216,217,1,160,161,126,194,195,152,153,154,218,219,220,162,163,164,206,207,208,155,156,157,221,222,223,165,166,167,209,210,211],[0,158,159,117,224,225,1,168,169,129,212,213],[0,146,147,16,226,227],[0,148,149,18,228,229],[0,150,151,18,230,231],[0,150,151,16,232,233],[0,148,149,16,234,235],[0,146,147,18,236,237],[0,146,147,52,238,239],[0,146,147,16,226,227,1,160,161,52,238,239],[0,146,147,18,236,237,1,160,161,61,240,241],[0,146,147,16,226,227,100,172,173,101,170,171],[0,148,149,18,228,229,242,172,181,243,214,244],[0,150,151,18,230,231,245,172,177,246,214,247],[0,150,151,16,232,233,245,172,177,174,170,248],[0,148,149,16,234,235,242,172,181,178,170,249],[0,146,147,18,236,237,100,172,173,108,214,215],[0,146,147,16,226,227,122,190,191,123,192,193],[0,146,147,16,226,227,126,194,195,127,196,197],[0,146,147,18,236,237,126,194,195,123,192,193],[0,146,147,18,236,237,122,190,191,127,196,197],[0,146,147,52,238,239,122,190,191,101,170,171],[0,146,147,61,240,241,126,194,195,101,170,171],[0,146,147,52,238,239,100,172,173,123,192,193],[0,146,147,61,240,241,100,172,173,127,196,197],[0,146,147,16,226,227,100,172,173,101,170,171,1,160,161,52,239,238,122,190,191,123,192,193],[0,146,147,16,226,227,109,216,217,108,214,215,1,160,161,52,239,238,126,194,195,127,196,197],[0,146,147,18,236,237,109,216,217,101,170,171,1,160,161,61,241,240,126,194,195,123,192,193],[0,146,147,18,236,237,100,172,173,108,214,215,1,160,161,61,241,240,122,190,191,127,196,197],[0,16,2,17,158,250,251,252,159,253,254,255],[0,16,2,17,158,250,251,252,159,253,254,255,23,24,13,25,256,257,258,259,260,261,262,263,26,20,27,28,264,265,266,267,268,269,270,271,4,22,5,19,272,273,274,275,276,277,278,279],[0,16,2,17,158,250,251,252,159,253,254,255,29,21,15,30,280,281,282,283,284,285,286,287],[0,20,13,19,158,273,266,259,159,261,278,271],[0,20,13,19,158,273,266,259,159,261,278,271,29,31,32,33,280,288,289,290,284,291,292,293],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299],[0,16,2,17,158,250,251,252,159,253,254,255,53,54,9,42,300,301,302,303,304,305,306,307],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,23,24,13,25,256,257,258,259,260,261,262,263,64,62,14,39,308,309,310,311,312,313,314,315,26,20,27,28,264,265,266,267,268,269,270,271,65,59,40,38,316,317,318,319,320,321,322,323,4,22,5,19,272,273,274,275,276,277,278,279,11,55,8,41,324,325,326,327,328,329,330,331],[0,16,2,17,158,250,251,252,159,253,254,255,66,67,44,45,332,333,334,335,336,337,338,339,23,24,13,25,256,257,258,259,260,261,262,263,68,69,46,47,340,341,342,343,344,345,346,347,26,20,27,28,264,265,266,267,268,269,270,271,70,71,48,49,348,349,350,351,352,353,354,355,4,22,5,19,272,273,274,275,276,277,278,279,72,73,50,51,356,357,358,359,360,361,362,363],[0,16,2,17,158,250,251,252,159,253,254,255,1,52,6,34,168,294,295,296,169,297,298,299,29,21,15,30,280,281,282,283,284,285,286,287,53,54,9,42,300,301,302,303,304,305,306,307],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323],[0,20,13,19,158,273,266,259,159,261,278,271,1,59,14,41,168,325,318,311,169,313,330,323,29,31,32,33,280,288,289,290,284,291,292,293,53,63,36,35,300,364,365,366,304,367,368,369],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225],[0,20,13,19,158,273,266,259,159,261,278,271,450,415,440,429,454,431,420,445,458,447,436,425],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,23,24,13,25,256,257,258,259,260,261,262,263,480,481,482,483,484,485,486,487,488,489,490,491,26,20,27,28,264,265,266,267,268,269,270,271,492,493,494,495,496,497,498,499,500,501,502,503,4,22,5,19,272,273,274,275,276,277,278,279,125,124,140,141,504,505,506,507,508,509,510,511],[0,16,2,17,158,250,251,252,159,253,254,255,123,122,88,89,204,474,475,476,205,477,478,479,29,21,15,30,280,281,282,283,284,285,286,287,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517],[0,16,2,17,158,250,251,252,159,253,254,255,129,128,90,91,212,512,513,514,213,515,516,517,23,24,13,25,256,257,258,259,260,261,262,263,518,519,520,521,522,523,524,525,526,527,528,529,26,20,27,28,264,265,266,267,268,269,270,271,530,531,532,533,534,535,536,537,538,539,540,541,4,22,5,19,272,273,274,275,276,277,278,279,127,126,92,93,542,543,544,545,546,547,548,549],[0,20,13,19,158,273,266,259,159,261,278,271,550,551,552,553,554,555,556,557,558,559,560,561,29,31,32,33,280,288,289,290,284,291,292,293,562,563,564,565,566,567,568,569,570,571,572,573],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,122,123,89,88,475,476,204,474,479,478,477,205],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,23,24,13,25,256,257,258,259,260,261,262,263,382,383,384,385,386,387,388,389,390,391,392,393,64,62,14,39,308,309,310,311,312,313,314,315,481,480,483,482,486,487,484,485,491,490,489,488,26,20,27,28,264,265,266,267,268,269,270,271,394,395,396,397,398,399,400,401,402,403,404,405,65,59,40,38,316,317,318,319,320,321,322,323,493,492,495,494,498,499,496,497,503,502,501,500,4,22,5,19,272,273,274,275,276,277,278,279,138,139,95,94,406,407,408,409,410,411,412,413,11,55,8,41,324,325,326,327,328,329,330,331,124,125,141,140,506,507,504,505,511,510,509,508],[0,16,2,17,158,250,251,252,159,253,254,255,116,117,83,82,376,377,224,378,379,380,381,225,1,52,6,34,168,294,295,296,169,297,298,299,128,129,91,90,513,514,212,512,517,516,515,213,23,24,13,25,256,257,258,259,260,261,262,263,574,575,576,577,578,579,580,581,582,583,584,585,64,62,14,39,308,309,310,311,312,313,314,315,519,518,521,520,524,525,522,523,529,528,527,526,26,20,27,28,264,265,266,267,268,269,270,271,586,587,588,589,590,591,592,593,594,595,596,597,65,59,40,38,316,317,318,319,320,321,322,323,531,530,533,532,536,537,534,535,541,540,539,538,4,22,5,19,272,273,274,275,276,277,278,279,109,108,79,78,598,599,600,601,602,603,604,605,11,55,8,41,324,325,326,327,328,329,330,331,126,127,93,92,544,545,542,543,549,548,547,546],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,66,69,50,49,332,349,342,359,336,361,354,347,493,123,483,140,498,507,204,485,503,490,509,205,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,68,67,48,51,340,357,334,351,344,353,362,339,124,480,89,494,506,499,484,474,511,478,501,488,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,70,73,46,45,348,333,358,343,352,345,338,363,122,492,141,482,475,487,496,505,479,510,489,500,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,72,71,44,47,356,341,350,335,360,337,346,355,481,125,495,88,486,476,504,497,491,502,477,508],[0,24,5,28,158,265,258,275,159,277,270,263,414,415,416,417,418,419,420,421,422,423,424,425,606,607,608,609,610,611,612,613,614,615,616,617,531,129,521,92,536,545,212,523,541,528,547,213,23,16,27,19,256,273,251,267,260,269,278,255,426,427,428,429,430,431,432,433,434,435,436,437,618,619,620,621,622,623,624,625,626,627,628,629,126,518,91,532,544,537,522,512,549,516,539,526,26,22,13,17,264,250,274,259,268,261,254,279,438,439,440,441,442,443,444,445,446,447,448,449,630,631,632,633,634,635,636,637,638,639,640,641,128,530,93,520,513,525,534,543,517,548,527,538,4,20,2,25,272,257,266,252,276,253,262,271,450,451,452,453,454,455,456,457,458,459,460,461,642,643,644,645,646,647,648,649,650,651,652,653,519,127,533,90,524,514,542,535,529,540,515,546],[0,16,2,17,158,250,251,252,159,253,254,255,100,101,75,74,370,371,188,372,373,374,375,189,1,52,6,34,168,294,295,296,169,297,298,299,122,123,89,88,475,476,204,474,479,478,477,205,29,21,15,30,280,281,282,283,284,285,286,287,116,117,83,82,376,377,224,378,379,380,381,225,53,54,9,42,300,301,302,303,304,305,306,307,128,129,91,90,513,514,212,512,517,516,515,213],[0,20,13,19,158,273,266,259,159,261,278,271,462,463,464,465,466,467,468,469,470,471,472,473,1,59,14,41,168,325,318,311,169,313,330,323,551,550,553,552,556,557,554,555,561,560,559,558,29,31,32,33,280,288,289,290,284,291,292,293,450,415,440,429,454,431,420,445,458,447,436,425,53,63,36,35,300,364,365,366,304,367,368,369,563,562,565,564,568,569,566,567,573,572,571,570],[0,16],[0,18],[0,16,26,20],[0,2,23,13],[0,3,4,32],[0,2,29,15],[0,3,29,27],[0,52],[0,63],[0,52,26,59],[0,63,26,54],[0,52,16,1],[0,18,1,61],[0,52,16,1,26,59,20,65],[0,31,1,63],[0,1,24,62],[0,31,1,63,26,21,65,54],[0,2,57,56],[0,60,3,16],[0,22,57,3],[0,2,28,20],[0,17,13,24],[0,20,19,13,4,24,17,27],[0,22,57,3,4,16,60,32],[0,22,57,3,23,20,30,12,26,24,33,15,4,16,60,32],[0,22,57,3,29,18,27,25],[0,22,3,57,1,55,10,37],[0,22,385,396,3,57,109,117],[0,22,57,3,159,279,654,655,158,274,656,657,29,18,25,27,284,658,262,269,280,659,257,267]];SpacegroupTables.Spacegroup={"P 1":0,"P -1":1,"P 1 2 1":2,"P 1 21 1":3,"C 1 2 1":4,"P 1 m 1":5,"P 1 c 1":6,"C 1 m 1":7,"C 1 c 1":8,"P 1 2/m 1":9,"P 1 21/m 1":10,"C 1 2/m 1":11,"P 1 2/c 1":12,"P 1 21/c 1":13,"C 1 2/c 1":14,"P 2 2 2":15,"P 2 2 21":16,"P 21 21 2":17,"P 21 21 21":18,"C 2 2 21":19,"C 2 2 2":20,"F 2 2 2":21,"I 2 2 2":22,"I 21 21 21":23,"P m m 2":24,"P m c 21":25,"P c c 2":26,"P m a 2":27,"P c a 21":28,"P n c 2":29,"P m n 21":30,"P b a 2":31,"P n a 21":32,"P n n 2":33,"C m m 2":34,"C m c 21":35,"C c c 2":36,"A m m 2":37,"A b m 2":38,"A m a 2":39,"A b a 2":40,"F m m 2":41,"F d d 2":42,"I m m 2":43,"I b a 2":44,"I m a 2":45,"P 2/m 2/m 2/m":46,"P m m m":46,"P 2/n 2/n 2/n":47,"P n n n":47,"P 2/c 2/c 2/m":48,"P c c m":48,"P 2/b 2/a 2/n":49,"P b a n":49,"P 21/m 2/m 2/a":50,"P m m a":50,"P 2/n 21/n 2/a":51,"P n n a":51,"P 2/m 2/n 21/a":52,"P m n a":52,"P 21/c 2/c 2/a":53,"P c c a":53,"P 21/b 21/a 2/m":54,"P b a m":54,"P 21/c 21/c 2/n":55,"P c c n":55,"P 2/b 21/c 21/m":56,"P b c m":56,"P 21/n 21/n 2/m":57,"P n n m":57,"P 21/m 21/m 2/n":58,"P m m n":58,"P 21/b 2/c 21/n":59,"P b c n":59,"P 21/b 21/c 21/a":60,"P b c a":60,"P 21/n 21/m 21/a":61,"P n m a":61,"C 2/m 2/c 21/m":62,"C m c m":62,"C 2/m 2/c 21/a":63,"C m c a":63,"C 2/m 2/m 2/m":64,"C m m m":64,"C 2/c 2/c 2/m":65,"C c c m":65,"C 2/m 2/m 2/a":66,"C m m a":66,"C 2/c 2/c 2/a":67,"C c c a":67,"F 2/m 2/m 2/m":68,"F m m m":68,"F 2/d 2/d 2/d":69,"F d d d":69,"I 2/m 2/m 2/m":70,"I m m m":70,"I 2/b 2/a 2/m":71,"I b a m":71,"I 21/b 21/c 21/a":72,"I b c a":72,"I 21/m 21/m 21/a":73,"I m m a":73,"P 4":74,"P 41":75,"P 42":76,"P 43":77,"I 4":78,"I 41":79,"P -4":80,"I -4":81,"P 4/m":82,"P 42/m":83,"P 4/n":84,"P 42/n":85,"I 4/m":86,"I 41/a":87,"P 4 2 2":88,"P 4 21 2":89,"P 41 2 2":90,"P 41 21 2":91,"P 42 2 2":92,"P 42 21 2":93,"P 43 2 2":94,"P 43 21 2":95,"I 4 2 2":96,"I 41 2 2":97,"P 4 m m":98,"P 4 b m":99,"P 42 c m":100,"P 42 n m":101,"P 4 c c":102,"P 4 n c":103,"P 42 m c":104,"P 42 b c":105,"I 4 m m":106,"I 4 c m":107,"I 41 m d":108,"I 41 c d":109,"P -4 2 m":110,"P -4 2 c":111,"P -4 21 m":112,"P -4 21 c":113,"P -4 m 2":114,"P -4 c 2":115,"P -4 b 2":116,"P -4 n 2":117,"I -4 m 2":118,"I -4 c 2":119,"I -4 2 m":120,"I -4 2 d":121,"P 4/m 2/m 2/m":122,"P4/m m m":122,"P 4/m 2/c 2/c":123,"P4/m c c":123,"P 4/n 2/b 2/m":124,"P4/n b m":124,"P 4/n 2/n 2/c":125,"P4/n n c":125,"P 4/m 21/b 2/m":126,"P4/m b m":126,"P 4/m 21/n 2/c":127,"P4/m n c":127,"P 4/n 21/m 2/m":128,"P4/n m m":128,"P 4/n 2/c 2/c":129,"P4/n c c":129,"P 42/m 2/m 2/c":130,"P42/m m c":130,"P 42/m 2/c 2/m":131,"P42/m c m":131,"P 42/n 2/b 2/c":132,"P42/n b c":132,"P 42/n 2/n 2/m":133,"P42/n n m":133,"P 42/m 21/b 2/c":134,"P42/m b c":134,"P 42/m 21/n 2/m":135,"P42/m n m":135,"P 42/n 21/m 2/c":136,"P42/n m c":136,"P 42/n 21/c 2/m":137,"P42/n c m":137,"I 4/m 2/m 2/m":138,"I4/m m m":138,"I 4/m 2/c 2/m":139,"I4/m c m":139,"I 41/a 2/m 2/d":140,"I41/a m d":140,"I 41/a 2/c 2/d":141,"I41/a c d":141,"P 3":142,"P 31":143,"P 32":144,"H 3":145,"R 3":146,"P -3":147,"H -3":148,"R -3":149,"P 3 1 2":150,"P 3 2 1":151,"P 31 1 2":152,"P 31 2 1":153,"P 32 1 2":154,"P 32 2 1":155,"H 3 2":156,"R 3 2":157,"P 3 m 1":158,"P 3 1 m":159,"P 3 c 1":160,"P 3 1 c":161,"H 3 m":162,"R 3 m":163,"H 3 c":164,"R 3 c":165,"P -3 1 2/m":166,"P -3 1 m":166,"P -3 1 2/c":167,"P -3 1 c":167,"P -3 2/m 1":168,"P -3 m 1":168,"P -3 2/c 1":169,"P -3 c 1":169,"H -3 2/m":170,"H -3 m":170,"R -3 2/m":171,"R -3 m":171,"H -3 2/c":172,"H -3 c":172,"R -3 2/c":173,"R -3 c":173,"P 6":174,"P 61":175,"P 65":176,"P 62":177,"P 64":178,"P 63":179,"P -6":180,"P 6/m":181,"P 63/m":182,"P 6 2 2":183,"P 61 2 2":184,"P 65 2 2":185,"P 62 2 2":186,"P 64 2 2":187,"P 63 2 2":188,"P 6 m m":189,"P 6 c c":190,"P 63 c m":191,"P 63 m c":192,"P -6 m 2":193,"P -6 c 2":194,"P -6 2 m":195,"P -6 2 c":196,"P 6/m 2/m 2/m":197,"P 6/m m m":197,"P 6/m 2/c 2/c":198,"P 6/m c c":198,"P 63/m 2/c 2/m":199,"P 63/m c m":199,"P 63/m 2/m 2/c":200,"P 63/m m c":200,"P 2 3":201,"F 2 3":202,"I 2 3":203,"P 21 3":204,"I 21 3":205,"P 2/m -3":206,"P m -3":206,"P 2/n -3":207,"P n -3":207,"F 2/m -3":208,"F m -3":208,"F 2/d -3":209,"F d -3":209,"I 2/m -3":210,"I m -3":210,"P 21/a -3":211,"P a -3":211,"I 21/a -3":212,"I a -3":212,"P 4 3 2":213,"P 42 3 2":214,"F 4 3 2":215,"F 41 3 2":216,"I 4 3 2":217,"P 43 3 2":218,"P 41 3 2":219,"I 41 3 2":220,"P -4 3 m":221,"F -4 3 m":222,"I -4 3 m":223,"P -4 3 n":224,"F -4 3 c":225,"I -4 3 d":226,"P 4/m -3 2/m":227,"P m -3 m":227,"P 4/n -3 2/n":228,"P n -3 n":228,"P 42/m -3 2/n":229,"P m -3 n":229,"P 42/n -3 2/m":230,"P n -3 m":230,"F 4/m -3 2/m":231,"F m -3 m":231,"F 4/m -3 2/c":232,"F m -3 c":232,"F 41/d -3 2/m":233,"F d -3 m":233,"F 41/d -3 2/c":234,"F d -3 c":234,"I 4/m -3 2/m":235,"I m -3 m":235,"I 41/a -3 2/d":236,"I a -3 d":236,"P 1 1 2":237,"P 1 1 21":238,"B 1 1 2":239,"B 2":239,"A 1 2 1":240,"C 1 21 1":241,"I 1 2 1":242,"I 2":242,"I 1 21 1":243,"P 1 1 m":244,"P 1 1 b":245,"B 1 1 m":246,"B 1 1 b":247,"P 1 1 2/m":248,"P 1 1 21/m":249,"B 1 1 2/m":250,"P 1 1 2/b":251,"P 1 1 21/b":252,"B 1 1 2/b":253,"P 21 2 2":254,"P 2 21 2":255,"P 21 21 2 (a)":256,"P 21 2 21":257,"P 2 21 21":258,"C 2 2 21a)":259,"C 2 2 2a":260,"F 2 2 2a":261,"I 2 2 2a":262,"P 21/m 21/m 2/n a":263,"P 42 21 2a":264,"I 2 3a":265}})(SpacegroupTables=Structure.SpacegroupTables||(Structure.SpacegroupTables={}))})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){"use strict";var DataTable=Core.Utils.DataTable;var SymmetryHelpers;(function(SymmetryHelpers){var Mat4=Core.Geometry.LinearAlgebra.Matrix4;var Vec3=Core.Geometry.LinearAlgebra.Vector3;function getBoudingSphere(arrays,indices){var x=arrays.x,y=arrays.y,z=arrays.z;var center=Vec3.zero();for(var _i=0,indices_3=indices;_i<indices_3.length;_i++){var aI=indices_3[_i];center[0]+=x[aI];center[1]+=y[aI];center[2]+=z[aI]}var count=indices.length>0?indices.length:1;center[0]/=count;center[1]/=count;center[2]/=count;var r=0;for(var _a=0,indices_4=indices;_a<indices_4.length;_a++){var aI=indices_4[_a];r=Math.max(indexedVectorDistSq(aI,center,arrays),r)}return{center:center,radius:Math.sqrt(r)}}function getSphereDist(c,r,q){return Vec3.distance(c,q.center)-(r+q.radius)}function isWithinRadius(bounds,i,data,t,r,v){v[0]=data.x[i];v[1]=data.y[i];v[2]=data.z[i];Vec3.transformMat4(v,v,t);return getSphereDist(v,data.r[i],bounds)<=r}function indexedDistSq(aI,cI,arrays){var dx=arrays.x[aI]-arrays.cX[cI],dy=arrays.y[aI]-arrays.cY[cI],dz=arrays.z[aI]-arrays.cZ[cI];return dx*dx+dy*dy+dz*dz}function indexedVectorDistSq(aI,v,arrays){var dx=arrays.x[aI]-v[0],dy=arrays.y[aI]-v[1],dz=arrays.z[aI]-v[2];return dx*dx+dy*dy+dz*dz}function createSymmetryContext(model,boundingInfo,spacegroup,radius){return{model:model,boundingInfo:boundingInfo,spacegroup:spacegroup,radius:radius,transform:Mat4.zero(),transformed:Vec3.zero(),i:0,j:0,k:0,op:0}}function symmetryContextMap(ctx,p){return Vec3.transformMat4(ctx.transformed,p,ctx.transform)}function symmetryContextGetTransform(ctx){return createSymmetryTransform(ctx.i,ctx.j,ctx.k,ctx.op,Mat4.clone(ctx.transform))}function createSymmetryTransform(i,j,k,opIndex,transform){return{isIdentity:!i&&!j&&!k&&!opIndex,id:opIndex+1+"_"+(5+i)+(5+j)+(5+k),transform:transform}}function createAssemblyTransform(i,transform){var isIdentity=true;for(var i_1=0;i_1<4;i_1++){for(var j=0;j<4;j++){var v=transform[4*j+i_1];if(i_1===j){if(Math.abs(v-1)>1e-7){isIdentity=false;break}}else if(Math.abs(v)>1e-7){isIdentity=false;break}}if(!isIdentity)break}return{isIdentity:isIdentity,id:i.toString(),transform:transform}}function getBoundingInfo(model,pivotIndices){var atoms=model.data.atoms,residues=model.data.residues,chains=model.data.chains,entities=model.data.entities,_a=model.positions,x=_a.x,y=_a.y,z=_a.z;var entityTable=DataTable.builder(entities.count),eX=entityTable.addColumn("x",function(s){return new Float64Array(s)}),eY=entityTable.addColumn("y",function(s){return new Float64Array(s)}),eZ=entityTable.addColumn("z",function(s){return new Float64Array(s)}),eR=entityTable.addColumn("r",function(s){return new Float64Array(s)}),chainTable=DataTable.builder(chains.count),cX=chainTable.addColumn("x",function(s){return new Float64Array(s)}),cY=chainTable.addColumn("y",function(s){return new Float64Array(s)}),cZ=chainTable.addColumn("z",function(s){return new Float64Array(s)}),cR=chainTable.addColumn("r",function(s){return new Float64Array(s)}),residueTable=DataTable.builder(residues.count),rX=residueTable.addColumn("x",function(s){return new Float64Array(s)}),rY=residueTable.addColumn("y",function(s){return new Float64Array(s)}),rZ=residueTable.addColumn("z",function(s){return new Float64Array(s)}),rR=residueTable.addColumn("r",function(s){return new Float64Array(s)});var allCenter=Vec3.zero(),allRadius=0,pivotCenter=Vec3.zero(),pivotRadius=0,n=0,eCenter=Vec3.zero(),eRadius=0,cCenter=Vec3.zero(),cRadius=0,rCenter=Vec3.zero(),rRadius=0;for(var eI=0,_eC=entities.count;eI<_eC;eI++){Vec3.set(eCenter,0,0,0);for(var cI=entities.chainStartIndex[eI],_cC=entities.chainEndIndex[eI];cI<_cC;cI++){Vec3.set(cCenter,0,0,0);for(var rI=chains.residueStartIndex[cI],_rC=chains.residueEndIndex[cI];rI<_rC;rI++){Vec3.set(rCenter,0,0,0);for(var aI=residues.atomStartIndex[rI],_aC=residues.atomEndIndex[rI];aI<_aC;aI++){rCenter[0]+=x[aI];rCenter[1]+=y[aI];rCenter[2]+=z[aI]}Vec3.add(allCenter,allCenter,rCenter);n=residues.atomEndIndex[rI]-residues.atomStartIndex[rI];Vec3.add(cCenter,cCenter,rCenter);rX[rI]=rCenter[0]/n;rY[rI]=rCenter[1]/n;rZ[rI]=rCenter[2]/n}Vec3.add(eCenter,eCenter,cCenter);n=chains.atomEndIndex[cI]-chains.atomStartIndex[cI];cX[cI]=cCenter[0]/n;cY[cI]=cCenter[1]/n;cZ[cI]=cCenter[2]/n}n=entities.atomEndIndex[eI]-entities.atomStartIndex[eI];eX[eI]=eCenter[0]/n;eY[eI]=eCenter[1]/n;eZ[eI]=eCenter[2]/n}allCenter[0]/=atoms.count;allCenter[1]/=atoms.count;allCenter[2]/=atoms.count;for(var _i=0,pivotIndices_1=pivotIndices;_i<pivotIndices_1.length;_i++){var aI=pivotIndices_1[_i];pivotCenter[0]+=x[aI];pivotCenter[1]+=y[aI];pivotCenter[2]+=z[aI]}var pivotCount=pivotIndices.length>0?pivotIndices.length:1;pivotCenter[0]/=pivotCount;pivotCenter[1]/=pivotCount;pivotCenter[2]/=pivotCount;var eDA={x:x,y:y,z:z,cX:eX,cY:eY,cZ:eZ},cDA={x:x,y:y,z:z,cX:cX,cY:cY,cZ:cZ},rDA={x:x,y:y,z:z,cX:rX,cY:rY,cZ:rZ};for(var eI=0,_eC=entities.count;eI<_eC;eI++){eRadius=0;for(var cI=entities.chainStartIndex[eI],_cC=entities.chainEndIndex[eI];cI<_cC;cI++){cRadius=0;for(var rI=chains.residueStartIndex[cI],_rC=chains.residueEndIndex[cI];rI<_rC;rI++){rRadius=0;for(var aI=residues.atomStartIndex[rI],_aC=residues.atomEndIndex[rI];aI<_aC;aI++){rRadius=Math.max(rRadius,indexedDistSq(aI,rI,rDA));cRadius=Math.max(cRadius,indexedDistSq(aI,cI,cDA));eRadius=Math.max(eRadius,indexedDistSq(aI,eI,eDA));allRadius=Math.max(allRadius,indexedVectorDistSq(aI,allCenter,rDA))}rRadius=Math.sqrt(rRadius);rR[rI]=rRadius}cRadius=Math.sqrt(cRadius);cR[cI]=cRadius}eRadius=Math.sqrt(eRadius);eR[eI]=eRadius}allRadius=Math.sqrt(allRadius);for(var _b=0,pivotIndices_2=pivotIndices;_b<pivotIndices_2.length;_b++){var aI=pivotIndices_2[_b];pivotRadius=Math.max(pivotRadius,indexedVectorDistSq(aI,pivotCenter,rDA))}pivotRadius=Math.sqrt(pivotRadius);return{entities:entityTable.seal(),chains:chainTable.seal(),residues:residueTable.seal(),allAtoms:{center:allCenter,radius:allRadius},target:{center:pivotCenter,radius:pivotRadius}}}function findSuitableTransforms(ctx){var bounds=ctx.boundingInfo,sg=ctx.spacegroup;var ret=[];ctx.transform=Mat4.identity();ret[0]=symmetryContextGetTransform(ctx);for(var i=-3;i<=3;i++){for(var j=-3;j<=3;j++){for(var k=-3;k<=3;k++){for(var l=i===0&&j===0&&k===0?1:0,lm=sg.operatorCount;l<lm;l++){sg.getOperatorMatrix(l,i,j,k,ctx.transform);ctx.i=i;ctx.k=k;ctx.j=j;ctx.op=l;var t=symmetryContextMap(ctx,bounds.allAtoms.center),d=getSphereDist(t,bounds.allAtoms.radius,bounds.target);if(d<ctx.radius){ret[ret.length]=symmetryContextGetTransform(ctx)}}}}}return ret}function getSymmetryResidues(ctx,transforms){var bounds=ctx.boundingInfo,radius=ctx.radius,targetBounds=bounds.target;var model=ctx.model,residues=model.data.residues,chains=model.data.chains,entities=model.data.entities;var residueIndices=Core.Utils.ChunkedArray.create(function(s){return new Int32Array(s)},residues.count,1),operatorIndices=Core.Utils.ChunkedArray.create(function(s){return new Int32Array(s)},residues.count,1);var v=Vec3.zero(),opIndex=0;var atomCount=0,chainCount=0,entityCount=0;for(var eI=0,_eC=entities.count;eI<_eC;eI++){opIndex=0;var chainAdded=false;for(var _i=0,transforms_1=transforms;_i<transforms_1.length;_i++){var t=transforms_1[_i];for(var cI=entities.chainStartIndex[eI],_cC=entities.chainEndIndex[eI];cI<_cC;cI++){if(!isWithinRadius(targetBounds,cI,bounds.chains,t.transform,radius,v))continue;var residueAdded=false;for(var rI=chains.residueStartIndex[cI],_rC=chains.residueEndIndex[cI];rI<_rC;rI++){if(!isWithinRadius(targetBounds,rI,bounds.residues,t.transform,radius,v))continue;Core.Utils.ChunkedArray.add(residueIndices,rI);Core.Utils.ChunkedArray.add(operatorIndices,opIndex);atomCount+=residues.atomEndIndex[rI]-residues.atomStartIndex[rI];residueAdded=true}if(residueAdded){chainCount+=1;chainAdded=true}}opIndex++}if(chainAdded){entityCount++}}return{residues:Core.Utils.ChunkedArray.compact(residueIndices),operators:Core.Utils.ChunkedArray.compact(operatorIndices),atomCount:atomCount,chainCount:chainCount,entityCount:entityCount}}function cloneRow(src,sI,target,tI,c){for(var i=0;i<c;i++){target[i][tI]=src[i][sI]}}function assemble(model,assemblyParts,transforms){var residues=model.data.residues,residueChainIndex=residues.chainIndex,residueEntityIndex=residues.entityIndex,residueAtomStartIndex=residues.atomStartIndex,residueAtomEndIndex=residues.atomEndIndex,atoms=model.data.atoms,_a=model.positions,x=_a.x,y=_a.y,z=_a.z;var atomTable=DataTable.builder(assemblyParts.atomCount),atomId,atomResidue,atomChain,atomEntity,cols=[];var positionTable=DataTable.ofDefinition(Structure.Tables.Positions,assemblyParts.atomCount),atomX=positionTable.x,atomY=positionTable.y,atomZ=positionTable.z;var entityTableBuilder=model.data.entities.getBuilder(assemblyParts.entityCount),entityTable=entityTableBuilder,srcEntityData=model.data.entities.getRawData(),entityData=entityTable.getRawData(),entityChainStart=entityTable.chainStartIndex,entityChainEnd=entityTable.chainEndIndex,entityResidueStart=entityTable.residueStartIndex,entityResidueEnd=entityTable.residueEndIndex,entityAtomStart=entityTable.atomStartIndex,entityAtomEnd=entityTable.atomEndIndex,entityOffset=0;var chainTableBuilder=model.data.chains.getBuilder(assemblyParts.chainCount),chainTable=chainTableBuilder,srcChainData=model.data.chains.getRawData(),chainData=chainTable.getRawData(),chainResidueStart=chainTable.residueStartIndex,chainResidueEnd=chainTable.residueEndIndex,chainAtomStart=chainTable.atomStartIndex,chainAtomEnd=chainTable.atomEndIndex,chainId=chainTable.asymId,chainAuthId=chainTable.authAsymId,chainEntity=chainTable.entityIndex,chainSourceChainIndex=chainTableBuilder.addColumn("sourceChainIndex",function(s){return new Int32Array(s)}),chainOperatorIndex=chainTableBuilder.addColumn("operatorIndex",function(s){return new Int32Array(s)}),chainOffset=0;var residueTableBuilder=model.data.residues.getBuilder(assemblyParts.residues.length),residueTable=residueTableBuilder,srcResidueData=model.data.residues.getRawData(),residueData=residueTable.getRawData(),residueAtomStart=residueTable.atomStartIndex,residueAtomEnd=residueTable.atomEndIndex,residueAsymId=residueTable.asymId,residueAuthAsymId=residueTable.authAsymId,residueChain=residueTable.chainIndex,residueEntity=residueTable.entityIndex;for(var _i=0,_b=model.data.atoms.columns;_i<_b.length;_i++){var col=_b[_i];var c=atomTable.addColumn(col.name,col.creator);if(col.name==="residueIndex")atomResidue=c;else if(col.name==="chainIndex")atomChain=c;else if(col.name==="entityIndex")atomEntity=c;else if(col.name==="id")atomId=c;else{cols[cols.length]={src:atoms[col.name],target:c}}}var assemblyResidueParts=assemblyParts.residues,assemblyOpParts=assemblyParts.operators,temp=Core.Geometry.LinearAlgebra.Vector3.zero(),atomOffset=0;var rI=assemblyResidueParts[0],currentChain=residueChainIndex[rI],currentEntity=residueEntityIndex[rI],currentOp=assemblyOpParts[0],currentAsymId,currentAuthAsymId;cloneRow(srcEntityData,residueEntityIndex[rI],entityData,0,srcEntityData.length);entityChainStart[0]=0;entityResidueStart[0]=0;entityAtomStart[0]=0;cloneRow(srcChainData,residueChainIndex[rI],chainData,0,srcChainData.length);chainEntity[0]=0;chainResidueStart[0]=0;chainAtomStart[0]=0;currentAsymId=model.data.chains.asymId[residueChainIndex[rI]];currentAuthAsymId=model.data.chains.authAsymId[residueChainIndex[rI]];var transform=transforms[assemblyOpParts[0]];if(transform&&!transform.isIdentity){chainId[chainOffset]=model.data.chains.asymId[residueChainIndex[rI]]+"-"+transform.id;chainAuthId[chainOffset]=model.data.chains.authAsymId[residueChainIndex[rI]]+"-"+transform.id;chainSourceChainIndex[chainOffset]=residueChainIndex[rI];chainOperatorIndex[chainOffset]=currentOp;currentAsymId=chainId[chainOffset];currentAuthAsymId=chainAuthId[chainOffset]}for(var residueOffset=0,_mi=assemblyResidueParts.length;residueOffset<_mi;residueOffset++){rI=assemblyResidueParts[residueOffset];var opI=assemblyOpParts[residueOffset];transform=transforms[opI];cloneRow(srcResidueData,rI,residueData,residueOffset,residueData.length);var cE=residueEntityIndex[rI],cC=residueChainIndex[rI];var chainChanged=false;if(cE!==currentEntity){chainResidueEnd[chainOffset]=residueOffset;chainAtomEnd[chainOffset]=atomOffset;chainOffset+=1;entityChainEnd[entityOffset]=chainOffset;entityResidueEnd[entityOffset]=residueOffset;entityAtomEnd[entityOffset]=atomOffset;entityOffset+=1;cloneRow(srcEntityData,cE,entityData,entityOffset,srcEntityData.length);entityChainStart[entityOffset]=chainOffset;entityResidueStart[entityOffset]=residueOffset;entityAtomStart[entityOffset]=atomOffset;chainChanged=true}else if(cC!==currentChain){chainResidueEnd[chainOffset]=residueOffset;chainAtomEnd[chainOffset]=atomOffset;chainOffset+=1;chainChanged=true}else if(opI!==currentOp){chainResidueEnd[chainOffset]=residueOffset;chainAtomEnd[chainOffset]=atomOffset;chainOffset+=1;chainChanged=true}if(chainChanged){cloneRow(srcChainData,cC,chainData,chainOffset,srcChainData.length);chainEntity[chainOffset]=entityOffset;chainResidueStart[chainOffset]=residueOffset;chainAtomStart[chainOffset]=atomOffset;if(!transform.isIdentity){chainId[chainOffset]=model.data.chains.asymId[cC]+"-"+transform.id;chainAuthId[chainOffset]=model.data.chains.authAsymId[cC]+"-"+transform.id}chainSourceChainIndex[chainOffset]=cC;chainOperatorIndex[chainOffset]=opI;currentAsymId=chainId[chainOffset];currentAuthAsymId=chainAuthId[chainOffset]}currentChain=cC;currentEntity=cE;currentOp=opI;residueChain[residueOffset]=chainOffset;residueEntity[residueOffset]=entityOffset;residueAtomStart[residueOffset]=atomOffset;residueAsymId[residueOffset]=currentAsymId;residueAuthAsymId[residueOffset]=currentAuthAsymId;for(var aI=residueAtomStartIndex[rI],_mAI=residueAtomEndIndex[rI];aI<_mAI;aI++){Vec3.set(temp,x[aI],y[aI],z[aI]);Vec3.transformMat4(temp,temp,transform.transform);atomX[atomOffset]=temp[0];atomY[atomOffset]=temp[1];atomZ[atomOffset]=temp[2];atomId[atomOffset]=atomOffset+1;atomResidue[atomOffset]=residueOffset;atomChain[atomOffset]=chainOffset;atomEntity[atomOffset]=entityOffset;for(var _c=0,cols_1=cols;_c<cols_1.length;_c++){var c=cols_1[_c];c.target[atomOffset]=c.src[aI]}atomOffset++}residueAtomEnd[residueOffset]=atomOffset}entityChainEnd[entityOffset]=chainOffset+1;entityResidueEnd[entityOffset]=assemblyResidueParts.length;entityAtomEnd[entityOffset]=atomOffset;chainResidueEnd[chainOffset]=assemblyResidueParts.length;chainAtomEnd[chainOffset]=atomOffset;var finalAtoms=atomTable.seal(),finalResidues=residueTableBuilder.seal(),finalChains=chainTableBuilder.seal(),finalEntities=entityTableBuilder.seal();var secondaryStructure=buildSS(model,assemblyParts,finalResidues);var structConn=model.data.bonds.structConn?buildStructConn(model.data.bonds.structConn,transforms,assemblyParts.residues,assemblyParts.operators,model.data.residues,finalResidues):void 0;return Structure.Molecule.Model.create({id:model.id,modelId:model.modelId,data:{atoms:finalAtoms,residues:finalResidues,chains:finalChains,entities:finalEntities,bonds:{structConn:structConn,component:model.data.bonds.component},secondaryStructure:secondaryStructure},positions:positionTable,parent:model,source:Structure.Molecule.Model.Source.Computed,operators:transforms.map(function(t){return new Structure.Operator(t.transform,t.id,t.isIdentity)})})}function buildStructConn(structConn,ops,residueParts,residueOpParts,oldResidues,newResidues){var entries=structConn.entries;var opsMap=Core.Utils.FastMap.create();for(var i=0,__i=ops.length;i<__i;i++){opsMap.set(ops[i].id,i)}var transformMap=Core.Utils.FastMap.create();for(var _i=0,entries_1=entries;_i<entries_1.length;_i++){var e=entries_1[_i];for(var _a=0,_b=e.partners;_a<_b.length;_a++){var p=_b[_a];if(!transformMap.has(p.residueIndex)){transformMap.set(p.residueIndex,Core.Utils.FastMap.create())}}}for(var i=0,__i=residueParts.length;i<__i;i++){var r=residueParts[i];if(!transformMap.has(r))continue;transformMap.get(r).set(residueOpParts[i],i)}var oldStart=oldResidues.atomStartIndex;var newStart=newResidues.atomStartIndex;var ret=[];for(var _c=0,entries_2=entries;_c<entries_2.length;_c++){var e=entries_2[_c];var allId=true;for(var _d=0,_e=e.partners;_d<_e.length;_d++){var p=_e[_d];if(p.symmetry!=="1_555"){allId=false;break}}if(allId){var _loop_1=function(opIndex,__oi){var allMapped=true;for(var _i=0,_a=e.partners;_i<_a.length;_i++){var p=_a[_i];if(!transformMap.get(p.residueIndex).has(opIndex)){allMapped=false;break}}if(!allMapped)return"continue";ret.push({bondType:e.bondType,distance:e.distance,partners:e.partners.map(function(p){var rI=transformMap.get(p.residueIndex).get(opIndex);return{residueIndex:rI,atomIndex:newStart[rI]+(p.atomIndex-oldStart[p.residueIndex]),symmetry:p.symmetry}})})};for(var opIndex=0,__oi=ops.length;opIndex<__oi;opIndex++){_loop_1(opIndex,__oi)}}else{var partners=[];for(var _f=0,_g=e.partners;_f<_g.length;_f++){var p=_g[_f];if(!opsMap.has(p.symmetry))break;var op=opsMap.get(p.symmetry);var m=transformMap.get(p.residueIndex);if(!m.has(op))break;var rI=m.get(op);partners.push({residueIndex:rI,atomIndex:newStart[rI]+(p.atomIndex-oldStart[p.residueIndex]),symmetry:p.symmetry})}if(partners.length===e.partners.length){ret.push({bondType:e.bondType,distance:e.distance,partners:partners})}}}return new Structure.StructConn(ret)}function buildSS(parent,assemblyParts,newResidues){var index=parent.data.residues.secondaryStructureIndex;var ss=parent.data.secondaryStructure;var asymId=newResidues.asymId,seqNumber=newResidues.seqNumber,insCode=newResidues.insCode,secondaryStructureIndex=newResidues.secondaryStructureIndex;var residues=assemblyParts.residues,operators=assemblyParts.operators;var count=residues.length;var ret=[];var start=0;while(start<count){var end=start;var ssI=index[residues[start]],op=operators[start];while(end<count&&operators[end]==op&&index[residues[end]]==ssI)end++;var s=ss[ssI];var e=new Structure.SecondaryStructureElement(s.type,new Structure.PolyResidueIdentifier(asymId[start],seqNumber[start],insCode[start]),new Structure.PolyResidueIdentifier(asymId[end-1],seqNumber[end-1],insCode[end-1]),s.info);e.startResidueIndex=start;e.endResidueIndex=end;var updatedSSI=ret.length;for(var i=start;i<end;i++){secondaryStructureIndex[i]=updatedSSI}ret[updatedSSI]=e;start=end}return ret}function buildPivotGroupSymmetry(model,radius,pivotsQuery){var info=model.data.symmetryInfo;if(!info||info.cellSize[0]<1.1&&info.cellSize[1]<1.1&&info.cellSize[2]<1.1){return model}var pivotIndices;if(!pivotsQuery)pivotIndices=model.data.atoms.indices;else pivotIndices=Structure.Query.apply(pivotsQuery,model).unionAtomIndices();var bounds=getBoundingInfo(model,pivotIndices),spacegroup=new Structure.Spacegroup(info),ctx=createSymmetryContext(model,bounds,spacegroup,radius);var transforms=findSuitableTransforms(ctx),residues=getSymmetryResidues(ctx,transforms);return assemble(model,residues,transforms)}SymmetryHelpers.buildPivotGroupSymmetry=buildPivotGroupSymmetry;function findMates(model,radius){var bounds=getBoudingSphere(model.positions,model.positions.indices);var spacegroup=new Structure.Spacegroup(model.data.symmetryInfo);var t=Mat4.zero();var v=Vec3.zero();var transforms=[];for(var i=-3;i<=3;i++){for(var j=-3;j<=3;j++){for(var k=-3;k<=3;k++){for(var op=0;op<spacegroup.operatorCount;op++){spacegroup.getOperatorMatrix(op,i,j,k,t);Vec3.transformMat4(v,bounds.center,t);if(getSphereDist(v,bounds.radius,bounds)>radius)continue;var copy=Mat4.zero();Mat4.copy(copy,t);transforms.push(createSymmetryTransform(i,j,k,op,copy))}}}}return transforms}function findMateParts(model,transforms){var _a=model.data,atoms=_a.atoms,chains=_a.chains,entities=_a.entities,residues=_a.residues;var residueIndices=Core.Utils.ArrayBuilder.create(function(s){return new Int32Array(s)},residues.count*transforms.length,1),operatorIndices=Core.Utils.ArrayBuilder.create(function(s){return new Int32Array(s)},residues.count*transforms.length,1);var atomCount=transforms.length*atoms.count;var chainCount=transforms.length*chains.count;var entityCount=entities.count;for(var eI=0,_eC=entities.count;eI<_eC;eI++){for(var opIndex=0;opIndex<transforms.length;opIndex++){for(var cI=entities.chainStartIndex[eI],_cC=entities.chainEndIndex[eI];cI<_cC;cI++){for(var rI=chains.residueStartIndex[cI],_rC=chains.residueEndIndex[cI];rI<_rC;rI++){Core.Utils.ArrayBuilder.add(residueIndices,rI);Core.Utils.ArrayBuilder.add(operatorIndices,opIndex)}}}}return{residues:residueIndices.array,operators:operatorIndices.array,atomCount:atomCount,chainCount:chainCount,entityCount:entityCount}}function buildMates(model,radius){var info=model.data.symmetryInfo;if(!info||info.cellSize[0]<1.1&&info.cellSize[1]<1.1&&info.cellSize[2]<1.1){return model}var transforms=findMates(model,radius);var parts=findMateParts(model,transforms);return assemble(model,parts,transforms)}SymmetryHelpers.buildMates=buildMates;function createOperators(operators,list,i,current){if(i<0){list[list.length]=current.slice(0);return}var ops=operators[i],len=ops.length;for(var j=0;j<len;j++){current[i]=ops[j];createOperators(operators,list,i-1,current)}}function getAssemblyTransforms(model,operators,offset){var info=model.data.assemblyInfo;var transforms=[];var index=offset;for(var _i=0,operators_1=operators;_i<operators_1.length;_i++){var op=operators_1[_i];var m=Mat4.identity();for(var i=0;i<op.length;i++){Mat4.mul(m,m,info.operators[op[i]].operator)}index++;transforms[transforms.length]=createAssemblyTransform(index,m)}return transforms}function getAssemblyParts(model,residueMask,currentTransforms,state,transformOffset){var _a=model.data,chains=_a.chains,entities=_a.entities,residues=_a.residues;var residueIndices=state.residueIndices,operatorIndices=state.operatorIndices;var atomCount=0,chainCount=0,entityCount=0;for(var eI=0,_eC=entities.count;eI<_eC;eI++){var opIndex=transformOffset;var chainAdded=false;for(var _i=0,currentTransforms_1=currentTransforms;_i<currentTransforms_1.length;_i++){var _=currentTransforms_1[_i];for(var cI=entities.chainStartIndex[eI],_cC=entities.chainEndIndex[eI];cI<_cC;cI++){var residueAdded=false;for(var rI=chains.residueStartIndex[cI],_rC=chains.residueEndIndex[cI];rI<_rC;rI++){if(!residueMask[rI])continue;Core.Utils.ChunkedArray.add(residueIndices,rI);Core.Utils.ChunkedArray.add(operatorIndices,opIndex);atomCount+=residues.atomEndIndex[rI]-residues.atomStartIndex[rI];residueAdded=true}if(residueAdded){chainCount+=1;chainAdded=true}}opIndex++}if(chainAdded){entityCount++}}state.atomCount+=atomCount;state.chainCount+=chainCount;state.entityCount+=entityCount}function buildAssemblyEntry(model,entry,state){var ops=[],currentOp=[];for(var i_2=0;i_2<entry.operators.length;i_2++)currentOp[i_2]="";createOperators(entry.operators,ops,entry.operators.length-1,currentOp);var transformOffset=state.transforms.length;var transforms=getAssemblyTransforms(model,ops,state.transforms.length);(_a=state.transforms).push.apply(_a,transforms);var asymIds=Core.Utils.FastSet.create();entry.asymIds.forEach(function(id){return asymIds.add(id)});var residueAsymIds=model.data.residues.asymId;var residueCount=model.data.residues.count;var mask=state.mask;for(var i=0;i<residueCount;i++){mask[i]=asymIds.has(residueAsymIds[i])}getAssemblyParts(model,mask,transforms,state,transformOffset);var _a}SymmetryHelpers.buildAssemblyEntry=buildAssemblyEntry;function buildAssembly(model,assembly){var state={atomCount:0,chainCount:0,entityCount:0,transforms:[],mask:new Int8Array(model.data.residues.count),residueIndices:Core.Utils.ChunkedArray.create(function(s){return new Int32Array(s)},model.data.residues.count,1),operatorIndices:Core.Utils.ChunkedArray.create(function(s){return new Int32Array(s)},model.data.residues.count,1)};for(var _i=0,_a=assembly.gens;_i<_a.length;_i++){var a=_a[_i];buildAssemblyEntry(model,a,state)}var parts={residues:Core.Utils.ChunkedArray.compact(state.residueIndices),operators:Core.Utils.ChunkedArray.compact(state.operatorIndices),atomCount:state.atomCount,chainCount:state.chainCount,entityCount:state.entityCount};return assemble(model,parts,state.transforms)}SymmetryHelpers.buildAssembly=buildAssembly})(SymmetryHelpers||(SymmetryHelpers={}));function buildPivotGroupSymmetry(model,radius,pivotsQuery){return SymmetryHelpers.buildPivotGroupSymmetry(model,radius,pivotsQuery)}Structure.buildPivotGroupSymmetry=buildPivotGroupSymmetry;function buildSymmetryMates(model,radius){return SymmetryHelpers.buildMates(model,radius)}Structure.buildSymmetryMates=buildSymmetryMates;function buildAssembly(model,assembly){return SymmetryHelpers.buildAssembly(model,assembly)}Structure.buildAssembly=buildAssembly})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){var Query;(function(Query){function apply(q,m){return Query.Builder.toQuery(q)(m.queryContext)}Query.apply=apply;var Context=function(){function Context(structure,mask){this.mask=mask;this.structure=structure}Object.defineProperty(Context.prototype,"atomCount",{get:function(){return this.mask.size},enumerable:true,configurable:true});Object.defineProperty(Context.prototype,"isComplete",{get:function(){return this.mask.size===this.structure.data.atoms.count},enumerable:true,configurable:true});Object.defineProperty(Context.prototype,"lookup3d",{get:function(){if(!this.lazyLoopup3d)this.makeLookup3d();return this.lazyLoopup3d},enumerable:true,configurable:true});Context.prototype.hasAtom=function(index){return!!this.mask.has(index)};Context.prototype.hasRange=function(start,end){for(var i=start;i<end;i++){if(this.mask.has(i))return true}return false};Context.ofStructure=function(structure){return new Context(structure,Core.Utils.Mask.ofStructure(structure))};Context.ofFragments=function(seq){return new Context(seq.context.structure,Core.Utils.Mask.ofFragments(seq))};Context.ofAtomIndices=function(structure,atomIndices){return new Context(structure,Core.Utils.Mask.ofIndices(structure.data.atoms.count,atomIndices))};Context.prototype.makeLookup3d=function(){var data=new Int32Array(this.mask.size),dataCount=0,_a=this.structure.positions,x=_a.x,y=_a.y,z=_a.z;for(var i=0,_b=this.structure.positions.count;i<_b;i++){if(this.mask.has(i))data[dataCount++]=i}var inputData=Core.Geometry.Query3D.createInputData(data,function(i,add){return add(x[i],y[i],z[i])});this.lazyLoopup3d=Core.Geometry.Query3D.createSpatialHash(inputData)};return Context}();Query.Context=Context;var Fragment=function(){function Fragment(context,tag,atomIndices){this._hashCode=0;this._hashComputed=false;this.context=context;this.tag=tag;this.atomIndices=atomIndices}Object.defineProperty(Fragment.prototype,"hashCode",{get:function(){if(this._hashComputed)return this._hashCode;var code=23;for(var _i=0,_a=this.atomIndices;_i<_a.length;_i++){var i=_a[_i];code=31*code+i|0}this._hashCode=code;this._hashComputed=true;return code},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"id",{get:function(){return this.context.structure.id+"_"+this.tag},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"atomCount",{get:function(){return this.atomIndices.length},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"isHet",{get:function(){var residue=this.context.structure.data.atoms.residueIndex[this.tag];return this.context.structure.data.residues.isHet[residue]},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"fingerprint",{get:function(){if(this._fingerprint)return this._fingerprint;var indexList=this.residueIndices,residues=this.context.structure.data.residues,cName=residues.name,cAsym=residues.asymId,cSeq=residues.seqNumber,insCode=residues.insCode,names=[];for(var _i=0,indexList_1=indexList;_i<indexList_1.length;_i++){var i=indexList_1[_i];var name_1=cName[i]+" "+cAsym[i]+" "+cSeq[i];if(insCode[i])name_1+=" i:"+insCode[i];names[names.length]=name_1}return names.join("-")},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"authFingerprint",{get:function(){if(this._authFingerprint)return this._authFingerprint;var indexList=this.residueIndices,residues=this.context.structure.data.residues,cName=residues.authName,cAsym=residues.authAsymId,cSeq=residues.authSeqNumber,insCode=residues.insCode,names=[];for(var _i=0,indexList_2=indexList;_i<indexList_2.length;_i++){var i=indexList_2[_i];var name_2=cName[i]+" "+cAsym[i]+" "+cSeq[i];if(insCode[i])name_2+=" i:"+insCode[i];names[names.length]=name_2}return names.join("-")},enumerable:true,configurable:true});Fragment.prototype.find=function(what){var ctx=Context.ofFragments(new FragmentSeq(this.context,[this]));return Query.Builder.toQuery(what)(ctx)};Fragment.prototype.computeIndices=function(){if(this._residueIndices)return;var residueIndices=Core.Utils.FastSet.create(),chainIndices=Core.Utils.FastSet.create(),entityIndices=Core.Utils.FastSet.create(),rIndices=this.context.structure.data.atoms.residueIndex,cIndices=this.context.structure.data.residues.chainIndex,eIndices=this.context.structure.data.chains.entityIndex;for(var _i=0,_a=this.atomIndices;_i<_a.length;_i++){var i=_a[_i];residueIndices.add(rIndices[i])}this._residueIndices=Core.Utils.integerSetToSortedTypedArray(residueIndices);for(var _c=0,_d=this._residueIndices;_c<_d.length;_c++){var i=_d[_c];chainIndices.add(cIndices[i])}this._chainIndices=Core.Utils.integerSetToSortedTypedArray(chainIndices);for(var _e=0,_f=this._chainIndices;_e<_f.length;_e++){var i=_f[_e];entityIndices.add(eIndices[i])}this._entityIndices=Core.Utils.integerSetToSortedTypedArray(entityIndices)};Object.defineProperty(Fragment.prototype,"residueIndices",{get:function(){this.computeIndices();return this._residueIndices},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"chainIndices",{get:function(){this.computeIndices();return this._chainIndices},enumerable:true,configurable:true});Object.defineProperty(Fragment.prototype,"entityIndices",{get:function(){this.computeIndices();return this._entityIndices},enumerable:true,configurable:true});Fragment.areEqual=function(a,b){if(a.atomCount!==b.atomCount)return false;var xs=a.atomIndices,ys=b.atomIndices;for(var i=0;i<xs.length;i++){if(xs[i]!==ys[i])return false}return a.tag===b.tag};Fragment.ofSet=function(context,atomIndices){var array=new Int32Array(atomIndices.size);atomIndices.forEach(function(i,ctx){ctx.array[ctx.index++]=i},{array:array,index:0});Array.prototype.sort.call(array,function(a,b){return a-b});return new Fragment(context,array[0],array)};Fragment.ofArray=function(context,tag,atomIndices){return new Fragment(context,tag,atomIndices)};Fragment.ofIndex=function(context,index){var indices=new Int32Array(1);indices[0]=index;return new Fragment(context,index,indices)};Fragment.ofIndexRange=function(context,start,endExclusive){var count=0;for(var i=start;i<endExclusive;i++){if(context.hasAtom(i))count++}var atoms=new Int32Array(count),offset=0;for(var i=start;i<endExclusive;i++){if(context.hasAtom(i))atoms[offset++]=i}return new Fragment(context,start,atoms)};return Fragment}();Query.Fragment=Fragment;var FragmentSeq=function(){function FragmentSeq(context,fragments){this.context=context;this.fragments=fragments}FragmentSeq.empty=function(ctx){return new FragmentSeq(ctx,[])};Object.defineProperty(FragmentSeq.prototype,"length",{get:function(){return this.fragments.length},enumerable:true,configurable:true});FragmentSeq.prototype.unionAtomIndices=function(){if(!this.length)return[];if(this.length===1)return this.fragments[0].atomIndices;var map=new Int8Array(this.context.structure.data.atoms.count),atomCount=0;for(var _i=0,_a=this.fragments;_i<_a.length;_i++){var f=_a[_i];for(var _c=0,_d=f.atomIndices;_c<_d.length;_c++){var i=_d[_c];map[i]=1}}for(var _e=0,map_1=map;_e<map_1.length;_e++){var i=map_1[_e];atomCount+=i}var ret=new Int32Array(atomCount),offset=0;for(var i=0,_l=map.length;i<_l;i++){if(map[i])ret[offset++]=i}return ret};FragmentSeq.prototype.unionFragment=function(){if(!this.length)return new Fragment(this.context,0,new Int32Array(0));if(this.length===1)return this.fragments[0];var union=this.unionAtomIndices();return new Fragment(this.context,union[0],union)};return FragmentSeq}();Query.FragmentSeq=FragmentSeq;var FragmentSeqBuilder=function(){function FragmentSeqBuilder(ctx){this.ctx=ctx;this.fragments=[]}FragmentSeqBuilder.prototype.add=function(f){this.fragments[this.fragments.length]=f};FragmentSeqBuilder.prototype.getSeq=function(){return new FragmentSeq(this.ctx,this.fragments)};return FragmentSeqBuilder}();Query.FragmentSeqBuilder=FragmentSeqBuilder;var HashFragmentSeqBuilder=function(){function HashFragmentSeqBuilder(ctx){this.ctx=ctx;this.fragments=[];this.byHash=Core.Utils.FastMap.create()}HashFragmentSeqBuilder.prototype.add=function(f){var hash=f.hashCode;if(this.byHash.has(hash)){var fs=this.byHash.get(hash);for(var _i=0,fs_1=fs;_i<fs_1.length;_i++){var q=fs_1[_i];if(Fragment.areEqual(f,q))return this}this.fragments[this.fragments.length]=f;fs[fs.length]=f}else{this.fragments[this.fragments.length]=f;this.byHash.set(hash,[f])}return this};HashFragmentSeqBuilder.prototype.getSeq=function(){return new FragmentSeq(this.ctx,this.fragments)};return HashFragmentSeqBuilder}();Query.HashFragmentSeqBuilder=HashFragmentSeqBuilder})(Query=Structure.Query||(Structure.Query={}))})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){var Query;(function(Query){var Builder;(function(Builder){Builder.BuilderPrototype={};function registerModifier(name,f){Builder.BuilderPrototype[name]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}return f.call.apply(f,[void 0,this].concat(args))}}Builder.registerModifier=registerModifier;function build(compile){return Object.create(Builder.BuilderPrototype,{compile:{writable:false,configurable:false,value:compile}})}Builder.build=build;function isBuilder(e){return!!e.compile}function parse(query){if(typeof window==="undefined")throw"parse can only be called from a browser.";((function(){})(),eval)("with (LiteMol.Core.Structure.Query) { window.__LiteMol_query = "+query+"; }");var q=window.__LiteMol_query;window.__LiteMol_query=void 0;return q.compile()}Builder.parse=parse;function toQuery(q){var ret;if(isBuilder(q))ret=q.compile();else if(typeof q==="string"||q instanceof String)ret=parse(q);else ret=q;return ret}Builder.toQuery=toQuery})(Builder=Query.Builder||(Query.Builder={}));function allAtoms(){return Builder.build(function(){return Compiler.compileAllAtoms()})}Query.allAtoms=allAtoms;function atomsByElement(){var elements=[];for(var _i=0;_i<arguments.length;_i++){elements[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtoms(elements,function(m){return m.data.atoms.elementSymbol})})}Query.atomsByElement=atomsByElement;function atomsByName(){var names=[];for(var _i=0;_i<arguments.length;_i++){names[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtoms(names,function(m){return m.data.atoms.name})})}Query.atomsByName=atomsByName;function atomsById(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtoms(ids,function(m){return m.data.atoms.id})})}Query.atomsById=atomsById;function residues(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtomRanges(false,ids,function(m){return m.data.residues})})}Query.residues=residues;function chains(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtomRanges(false,ids,function(m){return m.data.chains})})}Query.chains=chains;function entities(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtomRanges(false,ids,function(m){return m.data.entities})})}Query.entities=entities;function notEntities(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileAtomRanges(true,ids,function(m){return m.data.entities})})}Query.notEntities=notEntities;function everything(){return Builder.build(function(){return Compiler.compileEverything()})}Query.everything=everything;function entitiesFromIndices(indices){return Builder.build(function(){return Compiler.compileFromIndices(false,indices,function(m){return m.data.entities})})}Query.entitiesFromIndices=entitiesFromIndices;function chainsFromIndices(indices){return Builder.build(function(){return Compiler.compileFromIndices(false,indices,function(m){return m.data.chains})})}Query.chainsFromIndices=chainsFromIndices;function residuesFromIndices(indices){return Builder.build(function(){return Compiler.compileFromIndices(false,indices,function(m){return m.data.residues})})}Query.residuesFromIndices=residuesFromIndices;function atomsFromIndices(indices){return Builder.build(function(){return Compiler.compileAtomIndices(indices)})}Query.atomsFromIndices=atomsFromIndices;function sequence(entityId,asymId,startId,endId){return Builder.build(function(){return Compiler.compileSequence(entityId,asymId,startId,endId)})}Query.sequence=sequence;function hetGroups(){return Builder.build(function(){return Compiler.compileHetGroups()})}Query.hetGroups=hetGroups;function nonHetPolymer(){return Builder.build(function(){return Compiler.compileNonHetPolymer()})}Query.nonHetPolymer=nonHetPolymer;function polymerTrace(){var atomNames=[];for(var _i=0;_i<arguments.length;_i++){atomNames[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compilePolymerNames(atomNames,false)})}Query.polymerTrace=polymerTrace;function cartoons(){return or(Builder.build(function(){return Compiler.compilePolymerNames(["CA","O","O5'","C3'","N3"],false)}),hetGroups(),entities({type:"water"}))}Query.cartoons=cartoons;function backbone(){return Builder.build(function(){return Compiler.compilePolymerNames(["N","CA","C","O","P","OP1","OP2","O3'","O5'","C3'","C5'","C4"],false)})}Query.backbone=backbone;function sidechain(){return Builder.build(function(){return Compiler.compilePolymerNames(["N","CA","C","O","P","OP1","OP2","O3'","O5'","C3'","C5'","C4"],true)})}Query.sidechain=sidechain;function atomsInBox(min,max){return Builder.build(function(){return Compiler.compileAtomsInBox(min,max)})}Query.atomsInBox=atomsInBox;function or(){var elements=[];for(var _i=0;_i<arguments.length;_i++){elements[_i]=arguments[_i]}return Builder.build(function(){return Compiler.compileOr(elements)})}Query.or=or;Builder.registerModifier("complement",complement);function complement(q){return Builder.build(function(){return Compiler.compileComplement(q)})}Query.complement=complement;Builder.registerModifier("ambientResidues",ambientResidues);function ambientResidues(q,radius){return Builder.build(function(){return Compiler.compileAmbientResidues(q,radius)})}Query.ambientResidues=ambientResidues;Builder.registerModifier("wholeResidues",wholeResidues);function wholeResidues(q){return Builder.build(function(){return Compiler.compileWholeResidues(q)})}Query.wholeResidues=wholeResidues;Builder.registerModifier("union",union);function union(q){return Builder.build(function(){return Compiler.compileUnion(q)})}Query.union=union;Builder.registerModifier("inside",inside);function inside(q,where){return Builder.build(function(){return Compiler.compileInside(q,where)})}Query.inside=inside;Builder.registerModifier("intersectWith",intersectWith);function intersectWith(what,where){return Builder.build(function(){return Compiler.compileIntersectWith(what,where)})}Query.intersectWith=intersectWith;Builder.registerModifier("flatten",flatten);function flatten(what,selector){return Builder.build(function(){return Compiler.compileFlatten(what,selector)})}Query.flatten=flatten;Builder.registerModifier("except",except);function except(what,toRemove){return Builder.build(function(){return Compiler.compileExcept(what,toRemove)})}Query.except=except;function residuesByName(){var names=[];for(var _i=0;_i<arguments.length;_i++){names[_i]=arguments[_i]}return residues.apply(void 0,names.map(function(n){return{name:n}}))}Query.residuesByName=residuesByName;function residuesById(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return residues.apply(void 0,ids.map(function(id){return{authSeqNumber:id}}))}Query.residuesById=residuesById;function chainsById(){var ids=[];for(var _i=0;_i<arguments.length;_i++){ids[_i]=arguments[_i]}return chains.apply(void 0,ids.map(function(id){return{authAsymId:id}}))}Query.chainsById=chainsById;var Compiler;(function(Compiler){var OptimizedId=function(){function OptimizedId(id,arrays){this.columns=[];for(var _i=0,_a=Object.keys(id);_i<_a.length;_i++){var key=_a[_i];if(id[key]!==void 0&&!!arrays[key]){this.columns.push({value:id[key],array:arrays[key]})}}}OptimizedId.prototype.isSatisfied=function(i){for(var _i=0,_a=this.columns;_i<_a.length;_i++){var c=_a[_i];if(c.value!==c.array[i])return false}return true};return OptimizedId}();function compileEverything(){return function(ctx){if(ctx.isComplete){var atoms=ctx.structure.data.atoms.indices;return new Query.FragmentSeq(ctx,[new Query.Fragment(ctx,atoms[0],atoms)])}var indices=new Int32Array(ctx.atomCount);var offset=0;for(var _i=0,_a=ctx.structure.data.atoms.indices;_i<_a.length;_i++){var i=_a[_i];if(ctx.hasAtom(i))indices[offset++]=i}return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,indices[0],indices)])}}Compiler.compileEverything=compileEverything;function compileAllAtoms(){return function(ctx){var fragments=new Query.FragmentSeqBuilder(ctx);for(var i=0,_b=ctx.structure.data.atoms.count;i<_b;i++){if(ctx.hasAtom(i))fragments.add(Query.Fragment.ofIndex(ctx,i))}return fragments.getSeq()}}Compiler.compileAllAtoms=compileAllAtoms;function compileAtoms(elements,sel){return function(ctx){var set=Core.Utils.FastSet.ofArray(elements),data=sel(ctx.structure),fragments=new Query.FragmentSeqBuilder(ctx);for(var i=0,_b=data.length;i<_b;i++){if(ctx.hasAtom(i)&&set.has(data[i]))fragments.add(Query.Fragment.ofIndex(ctx,i))}return fragments.getSeq()}}Compiler.compileAtoms=compileAtoms;function compileAtomIndices(indices){return function(ctx){var count=0;for(var _i=0,indices_5=indices;_i<indices_5.length;_i++){var aI=indices_5[_i];if(ctx.hasAtom(aI))count++}if(!count)return Query.FragmentSeq.empty(ctx);if(count===indices.length)return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,indices[0],indices)]);var offset=0;var f=new Int32Array(count);for(var _a=0,indices_6=indices;_a<indices_6.length;_a++){var aI=indices_6[_a];if(ctx.hasAtom(aI))f[offset++]=aI}return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,f[0],f)])}}Compiler.compileAtomIndices=compileAtomIndices;function compileFromIndices(complement,indices,tableProvider){return function(ctx){var table=tableProvider(ctx.structure),atomStartIndex=table.atomStartIndex,atomEndIndex=table.atomEndIndex,fragments=new Query.FragmentSeqBuilder(ctx);if(complement){var exclude=Core.Utils.FastSet.ofArray(indices);var count=table.count;for(var i=0;i<count;i++){if(exclude.has(i))continue;if(!ctx.hasRange(atomStartIndex[i],atomEndIndex[i]))continue;fragments.add(Query.Fragment.ofIndexRange(ctx,atomStartIndex[i],atomEndIndex[i]))}}else{for(var _i=0,indices_7=indices;_i<indices_7.length;_i++){var i=indices_7[_i];if(!ctx.hasRange(atomStartIndex[i],atomEndIndex[i]))continue;fragments.add(Query.Fragment.ofIndexRange(ctx,atomStartIndex[i],atomEndIndex[i]))}}return fragments.getSeq()}}Compiler.compileFromIndices=compileFromIndices;function compileAtomRanges(complement,ids,tableProvider){return function(ctx){var table=tableProvider(ctx.structure),atomIndexStart=table.atomStartIndex,atomIndexEnd=table.atomEndIndex,fragments=new Query.FragmentSeqBuilder(ctx),count=table.count,include=false;var optimized=ids.map(function(id){return new OptimizedId(id,table)});var isEmptyIds=optimized.length===0;for(var i=0;i<count;i++){if(!ctx.hasRange(atomIndexStart[i],atomIndexEnd[i]))continue;include=isEmptyIds;for(var _i=0,optimized_1=optimized;_i<optimized_1.length;_i++){var id=optimized_1[_i];if(id.isSatisfied(i)){include=true;break}}if(complement)include=!include;if(include){fragments.add(Query.Fragment.ofIndexRange(ctx,atomIndexStart[i],atomIndexEnd[i]))}}return fragments.getSeq()}}Compiler.compileAtomRanges=compileAtomRanges;function compileSequence(seqEntityId,seqAsymId,start,end){return function(ctx){var _a=ctx.structure.data,residues=_a.residues,chains=_a.chains,seqNumber=residues.seqNumber,atomStartIndex=residues.atomStartIndex,atomEndIndex=residues.atomEndIndex,entityId=chains.entityId,count=chains.count,residueStartIndex=chains.residueStartIndex,residueEndIndex=chains.residueEndIndex,fragments=new Query.FragmentSeqBuilder(ctx);var parent=ctx.structure.parent,sourceChainIndex=chains.sourceChainIndex,isComputed=parent&&sourceChainIndex;var targetAsymId=typeof seqAsymId==="string"?{asymId:seqAsymId}:seqAsymId;var optTargetAsymId=new OptimizedId(targetAsymId,isComputed?parent.data.chains:chains);for(var cI=0;cI<count;cI++){if(entityId[cI]!==seqEntityId||!optTargetAsymId.isSatisfied(isComputed?sourceChainIndex[cI]:cI)){continue}var i=residueStartIndex[cI],last=residueEndIndex[cI],startIndex=-1,endIndex=-1;for(;i<last;i++){if(seqNumber[i]>=start.seqNumber){startIndex=i;break}}if(i===last)continue;for(i=startIndex;i<last;i++){if(seqNumber[i]>=end.seqNumber){break}}endIndex=i;if(ctx.hasRange(atomStartIndex[startIndex],atomEndIndex[endIndex])){fragments.add(Query.Fragment.ofIndexRange(ctx,atomStartIndex[startIndex],atomEndIndex[endIndex]))}}return fragments.getSeq()}}Compiler.compileSequence=compileSequence;function compileHetGroups(){return function(ctx){var _a=ctx.structure.data.residues,atomStartIndex=_a.atomStartIndex,atomEndIndex=_a.atomEndIndex,isHet=_a.isHet,entityIndex=_a.entityIndex,count=_a.count,entityType=ctx.structure.data.entities.type,water="water",fragments=new Query.FragmentSeqBuilder(ctx);for(var i=0;i<count;i++){if(!ctx.hasRange(atomStartIndex[i],atomEndIndex[i]))continue;if(entityType[entityIndex[i]]===water)continue;if(isHet[i]){fragments.add(Query.Fragment.ofIndexRange(ctx,atomStartIndex[i],atomEndIndex[i]))}}return fragments.getSeq()}}Compiler.compileHetGroups=compileHetGroups;function compileNonHetPolymer(){return function(ctx){var _a=ctx.structure.data.residues,atomStartIndex=_a.atomStartIndex,atomEndIndex=_a.atomEndIndex,_c=ctx.structure.data.entities,entityType=_c.type,entityCount=_c.count,eRS=_c.residueStartIndex,eRE=_c.residueEndIndex,polymer="polymer",size=0;for(var eI=0;eI<entityCount;eI++){if(entityType[eI]!==polymer)continue;for(var rI=eRS[eI],_bR=eRE[eI];rI<_bR;rI++){for(var aI=atomStartIndex[rI],_bA=atomEndIndex[rI];aI<_bA;aI++){if(ctx.hasAtom(aI))size++}}}if(!size)return Query.FragmentSeq.empty(ctx);var f=new Int32Array(size),offset=0;for(var eI=0;eI<entityCount;eI++){if(entityType[eI]!==polymer)continue;for(var rI=eRS[eI],_bR=eRE[eI];rI<_bR;rI++){for(var aI=atomStartIndex[rI],_bA=atomEndIndex[rI];aI<_bA;aI++){if(ctx.hasAtom(aI))f[offset++]=aI}}}return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,f[0],f)])}}Compiler.compileNonHetPolymer=compileNonHetPolymer;function compileAtomsInBox(min,max){return function(ctx){var positions=ctx.structure.positions,xs=positions.x,ys=positions.y,zs=positions.z,count=positions.count,fragment=[];for(var i=0;i<count;i++){if(!ctx.hasAtom(i))continue;var x=xs[i],y=ys[i],z=zs[i];if(x>=min.x&&x<=max.x&&y>=min.y&&y<=max.y&&z>=min.z&&z<=max.z){fragment[fragment.length]=i}}if(!fragment.length)return Query.FragmentSeq.empty(ctx);return new Query.FragmentSeq(ctx,[new Query.Fragment(ctx,fragment[0],fragment)])}}Compiler.compileAtomsInBox=compileAtomsInBox;function compileInside(what,where){var _what=Builder.toQuery(what);var _where=Builder.toQuery(where);return function(ctx){return new Query.FragmentSeq(ctx,_what(Query.Context.ofFragments(_where(ctx))).fragments)}}Compiler.compileInside=compileInside;function narrowFragment(ctx,f,m){var count=0;for(var _i=0,_a=f.atomIndices;_i<_a.length;_i++){var i=_a[_i];if(m.has(i))count++}if(!count)return void 0;var ret=new Int32Array(count);var offset=0;for(var _c=0,_d=f.atomIndices;_c<_d.length;_c++){var i=_d[_c];if(m.has(i))ret[offset++]=i}return Query.Fragment.ofArray(ctx,ret[0],ret)}function compileIntersectWith(what,where){var _what=Builder.toQuery(what);var _where=Builder.toQuery(where);return function(ctx){var fs=_what(ctx);var map=Core.Utils.Mask.ofFragments(_where(ctx));var ret=new Query.FragmentSeqBuilder(ctx);for(var _i=0,_a=fs.fragments;_i<_a.length;_i++){var f=_a[_i];var n=narrowFragment(ctx,f,map);if(n)ret.add(n)}return ret.getSeq()}}Compiler.compileIntersectWith=compileIntersectWith;function compileFilter(what,filter){var _what=Builder.toQuery(what);return function(ctx){var src=_what(ctx).fragments,result=new Query.FragmentSeqBuilder(ctx),f;for(var i=0;i<src.length;i++){f=src[i];if(filter(f))result.add(f)}return result.getSeq()}}Compiler.compileFilter=compileFilter;function compileComplement(what){var _what=Builder.toQuery(what);return function(ctx){var mask=Core.Utils.Mask.ofFragments(_what(ctx)),count=0,offset=0;for(var i=0,_b=ctx.structure.data.atoms.count;i<_b;i++){if(ctx.hasAtom(i)&&!mask.has(i))count++}if(!count)return Query.FragmentSeq.empty(ctx);var atoms=new Int32Array(count);for(var i=0,_b=ctx.structure.data.atoms.count;i<_b;i++){if(ctx.hasAtom(i)&&!mask.has(i))atoms[offset++]=i}return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,atoms[0],atoms)])}}Compiler.compileComplement=compileComplement;function compileOr(queries){var _qs=queries.map(function(q){return Builder.toQuery(q)});return function(ctx){var fragments=new Query.HashFragmentSeqBuilder(ctx);for(var _i=0,_qs_1=_qs;_i<_qs_1.length;_i++){var q=_qs_1[_i];var r=q(ctx);for(var _a=0,_c=r.fragments;_a<_c.length;_a++){var f=_c[_a];fragments.add(f)}}return fragments.getSeq()}}Compiler.compileOr=compileOr;function compileUnion(what){var _what=Builder.toQuery(what);return function(ctx){var src=_what(ctx).fragments,indices=Core.Utils.FastSet.create(),j=0,atoms;for(var i=0;i<src.length;i++){atoms=src[i].atomIndices;for(j=0;j<atoms.length;j++)indices.add(atoms[j])}if(indices.size===0)return Query.FragmentSeq.empty(ctx);return new Query.FragmentSeq(ctx,[Query.Fragment.ofSet(ctx,indices)])}}Compiler.compileUnion=compileUnion;function compilePolymerNames(names,complement){return function(ctx){var structure=ctx.structure,entities=structure.data.entities,atomNames=structure.data.atoms.name,indices=[],indexCount=0;var allowedNames=Core.Utils.FastSet.ofArray(names);if(complement){for(var ei=0;ei<structure.data.entities.count;ei++){if(entities.type[ei]!=="polymer")continue;var start=entities.atomStartIndex[ei],end=entities.atomEndIndex[ei];for(var i=start;i<end;i++){if(ctx.hasAtom(i)&&!allowedNames.has(atomNames[i]))indices[indexCount++]=i}}}else{for(var ei=0;ei<entities.count;ei++){if(entities.type[ei]!=="polymer")continue;var start=entities.atomStartIndex[ei],end=entities.atomEndIndex[ei];for(var i=start;i<end;i++){if(ctx.hasAtom(i)&&allowedNames.has(atomNames[i]))indices[indexCount++]=i}}}if(!indices.length)return Query.FragmentSeq.empty(ctx);return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,indices[0],new Int32Array(indices))])}}Compiler.compilePolymerNames=compilePolymerNames;function compileAmbientResidues(where,radius){var _where=Builder.toQuery(where);return function(ctx){var src=_where(ctx),nearest=ctx.lookup3d(),ret=new Query.HashFragmentSeqBuilder(ctx),_a=ctx.structure.positions,x=_a.x,y=_a.y,z=_a.z,residueIndex=ctx.structure.data.atoms.residueIndex,atomStart=ctx.structure.data.residues.atomStartIndex,atomEnd=ctx.structure.data.residues.atomEndIndex;for(var _i=0,_c=src.fragments;_i<_c.length;_i++){var f=_c[_i];var residues_1=Core.Utils.FastSet.create();for(var _d=0,_e=f.atomIndices;_d<_e.length;_d++){var i=_e[_d];residues_1.add(residueIndex[i]);var _f=nearest(x[i],y[i],z[i],radius),elements=_f.elements,count=_f.count;for(var j=0;j<count;j++){residues_1.add(residueIndex[elements[j]])}}var atomCount={count:0,start:atomStart,end:atomEnd};residues_1.forEach(function(r,ctx){ctx.count+=ctx.end[r]-ctx.start[r]},atomCount);var indices=new Int32Array(atomCount.count),atomIndices={indices:indices,offset:0,start:atomStart,end:atomEnd};residues_1.forEach(function(r,ctx){for(var i=ctx.start[r],_l=ctx.end[r];i<_l;i++){ctx.indices[ctx.offset++]=i}},atomIndices);Array.prototype.sort.call(indices,function(a,b){return a-b});ret.add(Query.Fragment.ofArray(ctx,indices[0],indices))}return ret.getSeq()}}Compiler.compileAmbientResidues=compileAmbientResidues;function compileWholeResidues(where){var _where=Builder.toQuery(where);return function(ctx){var src=_where(ctx),ret=new Query.HashFragmentSeqBuilder(ctx),residueIndex=ctx.structure.data.atoms.residueIndex,atomStart=ctx.structure.data.residues.atomStartIndex,atomEnd=ctx.structure.data.residues.atomEndIndex;for(var _i=0,_a=src.fragments;_i<_a.length;_i++){var f=_a[_i];var residues_2=Core.Utils.FastSet.create();for(var _c=0,_d=f.atomIndices;_c<_d.length;_c++){var i=_d[_c];residues_2.add(residueIndex[i])}var atomCount={count:0,start:atomStart,end:atomEnd};residues_2.forEach(function(r,ctx){ctx.count+=ctx.end[r]-ctx.start[r]},atomCount);var indices=new Int32Array(atomCount.count),atomIndices={indices:indices,offset:0,start:atomStart,end:atomEnd};residues_2.forEach(function(r,ctx){for(var i=ctx.start[r],_l=ctx.end[r];i<_l;i++){ctx.indices[ctx.offset++]=i}},atomIndices);Array.prototype.sort.call(indices,function(a,b){return a-b});ret.add(Query.Fragment.ofArray(ctx,indices[0],indices))}return ret.getSeq()}}Compiler.compileWholeResidues=compileWholeResidues;function compileFlatten(what,selector){var _what=Builder.toQuery(what);return function(ctx){var fs=_what(ctx);var ret=new Query.HashFragmentSeqBuilder(ctx);for(var _i=0,_a=fs.fragments;_i<_a.length;_i++){var f=_a[_i];var xs=selector(f);for(var _c=0,_d=xs.fragments;_c<_d.length;_c++){var x=_d[_c];ret.add(x)}}return ret.getSeq()}}Compiler.compileFlatten=compileFlatten;function compileExcept(what,toRemove){var _what=Builder.toQuery(what);var _toRemove=Builder.toQuery(toRemove);return function(ctx){var fs=_what(ctx);var mask=Core.Utils.Mask.ofFragments(_toRemove(ctx));var ret=new Query.HashFragmentSeqBuilder(ctx);for(var _i=0,_a=fs.fragments;_i<_a.length;_i++){var f=_a[_i];var size=0;for(var _c=0,_d=f.atomIndices;_c<_d.length;_c++){var i=_d[_c];if(!mask.has(i))size++}if(!size)continue;var indices=new Int32Array(size);var offset=0;for(var _e=0,_f=f.atomIndices;_e<_f.length;_e++){var i=_f[_e];if(!mask.has(i))indices[offset++]=i}ret.add(Query.Fragment.ofArray(ctx,indices[0],indices))}return ret.getSeq()}}Compiler.compileExcept=compileExcept})(Compiler=Query.Compiler||(Query.Compiler={}))})(Query=Structure.Query||(Structure.Query={}))})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Core;(function(Core){var Structure;(function(Structure){var Query;(function(Query){var Algebraic;(function(Algebraic){function unaryP(f){return function(a){return function(ctx,i){return f(a(ctx,i))}}}function binaryP(f){return function(a,b){return function(ctx,i){return f(a(ctx,i),b(ctx,i))}}}Algebraic.not=unaryP(function(a){return!a});Algebraic.and=binaryP(function(a,b){return a&&b});Algebraic.or=binaryP(function(a,b){return a||b});var backboneAtoms=Core.Utils.FastSet.ofArray(["N","CA","C","O","P","OP1","OP2","O3'","O5'","C3'","C5'","C4"]);Algebraic.backbone=function(ctx,i){return Algebraic.entityType(ctx,i)==="polymer"&&backboneAtoms.has(Algebraic.atomName(ctx,i))};Algebraic.sidechain=function(ctx,i){return Algebraic.entityType(ctx,i)==="polymer"&&!backboneAtoms.has(Algebraic.atomName(ctx,i))};function binaryR(f){return function(a,b){return function(ctx,i){return f(a(ctx,i),b(ctx,i))}}}Algebraic.equal=binaryR(function(a,b){return a===b});Algebraic.notEqual=binaryR(function(a,b){return a!==b});Algebraic.greater=binaryR(function(a,b){return a>b});Algebraic.lesser=binaryR(function(a,b){return a<b});Algebraic.greaterEqual=binaryR(function(a,b){return a>=b});Algebraic.lesserEqual=binaryR(function(a,b){return a<=b});function inRange(s,a,b){return function(ctx,i){var v=s(ctx,i);return v>=a&&v<=b}}Algebraic.inRange=inRange;function value(v){return function(){return v}}Algebraic.value=value;function atomProp(index,table,value){return function(ctx,i){var s=ctx.structure;return value(table(s))[index(s.data.atoms)[i]]}}Algebraic.residueSeqNumber=atomProp(function(m){return m.residueIndex},function(m){return m.data.residues},function(t){return t.seqNumber});Algebraic.residueName=atomProp(function(m){return m.residueIndex},function(m){return m.data.residues},function(t){return t.name});Algebraic.elementSymbol=atomProp(function(m){return m.indices},function(m){return m.data.atoms},function(t){return t.elementSymbol});Algebraic.atomName=atomProp(function(m){return m.indices},function(m){return m.data.atoms},function(t){return t.name});Algebraic.entityType=atomProp(function(m){return m.entityIndex},function(m){return m.data.entities},function(t){return t.type});function query(p){return Query.Builder.build(function(){return function(ctx){var result=[];for(var i=0,_b=ctx.structure.data.atoms.count;i<_b;i++){if(ctx.hasAtom(i)&&p(ctx,i))result[result.length]=i}if(!result.length)return Query.FragmentSeq.empty(ctx);return new Query.FragmentSeq(ctx,[Query.Fragment.ofArray(ctx,result[0],new Int32Array(result))])}})}Algebraic.query=query})(Algebraic=Query.Algebraic||(Query.Algebraic={}))})(Query=Structure.Query||(Structure.Query={}))})(Structure=Core.Structure||(Core.Structure={}))})(Core=LiteMol.Core||(LiteMol.Core={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){Visualization.VERSION={number:"1.7.3",date:"Aug 26 2017"}})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){Visualization.THREE=LiteMolTHREE})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Utils;(function(Utils){"use strict";var Palette=function(){function Palette(){}Palette.getRandomColor=function(amountOfGrey){if(amountOfGrey===void 0){amountOfGrey=0}var counter=0;while(true){counter++;var c=Palette.randomMix({r:166/255,g:0,b:100/255},{r:1,g:1,b:0},{r:0,g:100/255,b:1},amountOfGrey);var d=Math.abs(Palette.previous.r-c.r)+Math.abs(Palette.previous.g-c.g)+Math.abs(Palette.previous.b-c.b);if(d>100||counter===10){Palette.previous=c;return c}}};Palette.randomMix=function(color1,color2,color3,greyControl){var randomIndex=Math.floor(Math.random()*3)|0;var mixRatio1=randomIndex===0?Math.random()*greyControl:Math.random();var mixRatio2=randomIndex===1?Math.random()*greyControl:Math.random();var mixRatio3=randomIndex===2?Math.random()*greyControl:Math.random();var sum=mixRatio1+mixRatio2+mixRatio3;mixRatio1/=sum;mixRatio2/=sum;mixRatio3/=sum;return{r:mixRatio1*color1.r+mixRatio2*color2.r+mixRatio3*color3.r,g:mixRatio1*color1.g+mixRatio2*color2.g+mixRatio3*color3.g,b:mixRatio1*color1.b+mixRatio2*color2.b+mixRatio3*color3.b}};Palette.interpolate=function(min,minColor,max,maxColor,value,target){var ret=target!==void 0?target:{r:.1,g:.1,b:.1};var t=(value-min)/(max-min);ret.r=minColor.r+(maxColor.r-minColor.r)*t;ret.g=minColor.g+(maxColor.g-minColor.g)*t;ret.b=minColor.b+(maxColor.b-minColor.b)*t;return ret};Palette.previous=Palette.randomMix({r:.75,g:0,b:.25},{r:1,g:.5,b:0},{r:0,g:.35,b:1},.5);return Palette}();Utils.Palette=Palette})(Utils=Visualization.Utils||(Visualization.Utils={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){function checkWebGL(){var canvas=document.createElement("canvas");try{var ctx=canvas.getContext("webgl")||canvas.getContext("experimental-webgl");return!!ctx}catch(e){console.log(e);return false}}Visualization.checkWebGL=checkWebGL;var GeometryHelper=function(){function GeometryHelper(){}GeometryHelper.setPickBase=function(objectId,objectIdWidth,elementId,color){var width=24,value=objectId<<width-objectIdWidth|elementId,r=value>>16&255,g=value>>8&255,b=value&255;color.r=r/255;color.g=g/255;color.b=b/255};GeometryHelper.setPickColor=function(objectId,objectIdWidth,elementId,buffer,offset){var width=24,value=objectId<<width-objectIdWidth|elementId,r=value>>16&255,g=value>>8&255,b=value&255;buffer[offset]=r/255;buffer[offset+1]=g/255;buffer[offset+2]=b/255};GeometryHelper.toSurface=function(source){var bufferSize=source.vertices.length*3,vertexBuffer=new Float32Array(bufferSize),normalBuffer=new Float32Array(bufferSize),indexBuffer=new Uint32Array(source.faces.length*3),normals=Array(source.vertices.length);for(var i=0;i<source.faces.length;i++){var f=source.faces[i];normals[f.a]=f.vertexNormals[0];normals[f.b]=f.vertexNormals[1];normals[f.c]=f.vertexNormals[2];indexBuffer[3*i]=f.a;indexBuffer[3*i+1]=f.b;indexBuffer[3*i+2]=f.c}for(var i=0;i<source.vertices.length;i++){var v=source.vertices[i];vertexBuffer[3*i]=v.x;vertexBuffer[3*i+1]=v.y;vertexBuffer[3*i+2]=v.z;var n=normals[i];normalBuffer[3*i]=n.x;normalBuffer[3*i+1]=n.y;normalBuffer[3*i+2]=n.z}return{vertices:vertexBuffer,vertexCount:source.vertices.length,triangleIndices:indexBuffer,triangleCount:source.faces.length,normals:normalBuffer}};GeometryHelper.toRawGeometry=function(source){var _a=GeometryHelper.toSurface(source),vertices=_a.vertices,vertexCount=_a.vertexCount,indices=_a.triangleIndices,indexCount=_a.triangleCount,normals=_a.normals;return{vertices:vertices,vertexCount:vertexCount,indices:indices,indexCount:indexCount,normals:normals,elementSize:3}};GeometryHelper.getIndexedBufferGeometry=function(source){var bufferSize=source.vertices.length*3,vertexBuffer=new Float32Array(bufferSize),normalBuffer=new Float32Array(bufferSize),indexBuffer=new Uint32Array(source.faces.length*3),normals=Array(source.vertices.length);for(var i=0;i<source.faces.length;i++){var f=source.faces[i];normals[f.a]=f.vertexNormals[0];normals[f.b]=f.vertexNormals[1];normals[f.c]=f.vertexNormals[2];indexBuffer[3*i]=f.a;indexBuffer[3*i+1]=f.b;indexBuffer[3*i+2]=f.c}for(var i=0;i<source.vertices.length;i++){var v=source.vertices[i];vertexBuffer[3*i]=v.x;vertexBuffer[3*i+1]=v.y;vertexBuffer[3*i+2]=v.z;var n=normals[i];normalBuffer[3*i]=n.x;normalBuffer[3*i+1]=n.y;normalBuffer[3*i+2]=n.z}var geom=new Visualization.THREE.BufferGeometry;geom.addAttribute("position",new Visualization.THREE.BufferAttribute(vertexBuffer,3));geom.addAttribute("normal",new Visualization.THREE.BufferAttribute(normalBuffer,3));geom.addAttribute("index",new Visualization.THREE.BufferAttribute(indexBuffer,1));return geom};return GeometryHelper}();Visualization.GeometryHelper=GeometryHelper})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Color;(function(Color){function copy(from,to){to.r=from.r;to.g=from.g;to.b=from.b}Color.copy=copy;function clone(_a){var r=_a.r,g=_a.g,b=_a.b;return{r:r,g:g,b:b}}Color.clone=clone;function toVector(color){return new Visualization.THREE.Vector3(color.r,color.g,color.b)}Color.toVector=toVector;function fromVector(v){return{r:v.x,g:v.y,b:v.z}}Color.fromVector=fromVector;function fromRgb(r,g,b){return{r:r/255,g:g/255,b:b/255}}Color.fromRgb=fromRgb;function hue2rgb(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p}function fromHsl(h,s,l){var r,g,b;if(s==0){r=g=b=l}else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hue2rgb(p,q,h+1/3);g=hue2rgb(p,q,h);b=hue2rgb(p,q,h-1/3)}return{r:r,g:g,b:b}}Color.fromHsl=fromHsl;function fromHsv(h,s,v){var rgb,i,data=[];if(s===0){rgb=[v,v,v]}else{h=h/60;i=Math.floor(h);data=[v*(1-s),v*(1-s*(h-i)),v*(1-s*(1-(h-i)))];switch(i){case 0:rgb=[v,data[2],data[0]];break;case 1:rgb=[data[1],v,data[0]];break;case 2:rgb=[data[0],v,data[2]];break;case 3:rgb=[data[0],data[1],v];break;case 4:rgb=[data[2],data[0],v];break;default:rgb=[v,data[0],data[1]];break}}return{r:rgb[0],g:rgb[1],b:rgb[2]}}Color.fromHsv=fromHsv;function random(){return Visualization.Utils.Palette.getRandomColor()}Color.random=random;function fromHex(v){return{r:(v>>16&255)/255,g:(v>>8&255)/255,b:(v&255)/255}}Color.fromHex=fromHex;function fromHexString(s){if(s[0]!=="#")return fromHex(0);if(s.length===4){return fromHexString("#"+s[1]+s[1]+s[2]+s[2]+s[3]+s[3])}else if(s.length===7){return fromHex(parseInt(s.substr(1),16))}return fromHex(0)}Color.fromHexString=fromHexString;function interpolate(a,b,t,target){target.r=a.r+(b.r-a.r)*t;target.g=a.g+(b.g-a.g)*t;target.b=a.b+(b.b-a.b)*t}Color.interpolate=interpolate;function isColor(c){return c.r!==void 0&&c.g!==void 0&&c.b!==void 0}Color.isColor=isColor})(Color=Visualization.Color||(Visualization.Color={}));var Theme;(function(Theme){var Default;(function(Default){Default.HighlightColor={r:1,g:1,b:0};Default.SelectionColor={r:171/255,g:71/255,b:183/255};Default.UniformColor={r:68/255,g:130/255,b:255};Default.Transparency={alpha:1,writeDepth:false}})(Default=Theme.Default||(Theme.Default={}));function isTransparent(theme){var opacity=+theme.transparency.alpha;if(isNaN(opacity))opacity=1;return opacity<=.999}Theme.isTransparent=isTransparent;function getColor(theme,name,fallback){var c=theme.colors.get(name);if(!c)return fallback;return c}Theme.getColor=getColor;function createUniform(props){if(props===void 0){props={}}var colors=props.colors,_a=props.variables,variables=_a===void 0?LiteMol.Core.Utils.FastMap.create():_a,_b=props.transparency,transparency=_b===void 0?Default.Transparency:_b,_c=props.interactive,interactive=_c===void 0?true:_c,_d=props.disableFog,disableFog=_d===void 0?false:_d,_e=props.isSticky,isSticky=_e===void 0?false:_e;var finalColors=LiteMol.Core.Utils.FastMap.create();if(colors){colors.forEach(function(c,n){return finalColors.set(n,c)})}var uniform=finalColors.get("Uniform");if(!uniform){finalColors.set("Uniform",Default.UniformColor);uniform=Default.UniformColor}return{colors:finalColors,variables:variables,transparency:transparency,interactive:interactive,disableFog:disableFog,isSticky:isSticky,setElementColor:function(index,target){Color.copy(uniform,target)}}}Theme.createUniform=createUniform;function createMapping(mapping,props){if(props===void 0){props={}}var _a=props.colors,colors=_a===void 0?LiteMol.Core.Utils.FastMap.create():_a,_b=props.variables,variables=_b===void 0?LiteMol.Core.Utils.FastMap.create():_b,_c=props.transparency,transparency=_c===void 0?Default.Transparency:_c,_d=props.interactive,interactive=_d===void 0?true:_d,_e=props.disableFog,disableFog=_e===void 0?false:_e,_f=props.isSticky,isSticky=_f===void 0?false:_f;return{colors:colors,variables:variables,transparency:transparency?transparency:Default.Transparency,interactive:interactive,disableFog:disableFog,isSticky:isSticky,setElementColor:function(index,target){mapping.setColor(mapping.getProperty(index),target)}}}Theme.createMapping=createMapping;function createColorMapMapping(getProperty,map,fallbackColor){var mapper=new ColorMapMapper(map,fallbackColor);return{getProperty:getProperty,setColor:function(i,c){return mapper.setColor(i,c)}}}Theme.createColorMapMapping=createColorMapMapping;function createPalleteMapping(getProperty,pallete){var mapper=new PaletteMapper(pallete);return{getProperty:getProperty,setColor:function(i,c){return mapper.setColor(i,c)}}}Theme.createPalleteMapping=createPalleteMapping;function createPalleteIndexMapping(getProperty,pallete){var mapper=new PaletteIndexMapper(pallete);return{getProperty:getProperty,setColor:function(i,c){return mapper.setColor(i,c)}}}Theme.createPalleteIndexMapping=createPalleteIndexMapping;var PaletteIndexMapper=function(){function PaletteIndexMapper(pallete){this.pallete=pallete}PaletteIndexMapper.prototype.setColor=function(i,target){var color=this.pallete[i];Color.copy(color,target)};return PaletteIndexMapper}();var PaletteMapper=function(){function PaletteMapper(pallete){this.pallete=pallete;this.colorIndex=0;this.colorMap=LiteMol.Core.Utils.FastMap.create()}PaletteMapper.prototype.setColor=function(p,target){var color=this.colorMap.get(p);if(!color){this.colorIndex=(this.colorIndex+1)%this.pallete.length|0;color=this.pallete[this.colorIndex];this.colorMap.set(p,color)}Color.copy(color,target)};return PaletteMapper}();var ColorMapMapper=function(){function ColorMapMapper(map,fallbackColor){this.map=map;this.fallbackColor=fallbackColor}ColorMapMapper.prototype.setColor=function(p,target){var color=this.map.get(p);if(!color){color=this.fallbackColor}Color.copy(color,target)};return ColorMapMapper}()})(Theme=Visualization.Theme||(Visualization.Theme={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var MaterialsHelper=function(){function MaterialsHelper(){}MaterialsHelper.getPickMaterial=function(){return new Visualization.THREE.ShaderMaterial({attributes:{pColor:{type:"v4",value:[]}},vertexShader:MaterialsHelper.pickVertexShader,fragmentShader:MaterialsHelper.pickFragmentShader,blending:Visualization.THREE.NoBlending,shading:Visualization.THREE.FlatShading,side:Visualization.THREE.DoubleSide})};MaterialsHelper.getPickExcludeMaterial=function(){return new Visualization.THREE.MeshBasicMaterial({color:Visualization.THREE.ColorKeywords.white,side:Visualization.THREE.DoubleSide})};MaterialsHelper.compareVectorAndColor=function(v,c){return v.x===c.r&&v.y===c.g&&v.z===c.b};MaterialsHelper.updateMaterial=function(material,theme,object){var changed=false;if(MaterialsHelper.updateTransparencyAndFog(material,theme,object))changed=true;if(material instanceof Visualization.THREE.ShaderMaterial&&MaterialsHelper.updateHighlightColor(material,theme))changed=true;if(changed)material.needsUpdate=true};MaterialsHelper.updateHighlightColor=function(material,theme){var changed=false;var color=material.uniforms.selectionColor.value;var selectionColor=Visualization.Theme.getColor(theme,"Selection",Visualization.Theme.Default.SelectionColor);if(!MaterialsHelper.compareVectorAndColor(color,selectionColor)){material.uniforms.selectionColor.value=Visualization.Color.toVector(selectionColor);changed=true}color=material.uniforms.highlightColor.value;var highlightColor=Visualization.Theme.getColor(theme,"Highlight",Visualization.Theme.Default.HighlightColor);if(!MaterialsHelper.compareVectorAndColor(color,highlightColor)){material.uniforms.highlightColor.value=Visualization.Color.toVector(highlightColor);changed=true}return changed};MaterialsHelper.updateTransparencyAndFog=function(material,theme,object){var transparency=theme.transparency;var opacity=+transparency.alpha;if(isNaN(opacity))opacity=1;var isTransparent=opacity<=.999;var writeDepth=!!transparency.writeDepth;if(!isTransparent){opacity=1;writeDepth=true}if(object)object.renderOrder=isTransparent?1:0;var changed=false;if(material instanceof Visualization.THREE.MeshPhongMaterial||material instanceof Visualization.THREE.MeshBasicMaterial||material instanceof Visualization.THREE.ShaderMaterial){if(material.transparent!==isTransparent){material.transparent=isTransparent;changed=true}if(material.depthWrite!==writeDepth){material.depthWrite=writeDepth;changed=true}if(material.opacity!==opacity){material.opacity=opacity;changed=true}if(material.fog!==!theme.disableFog){material.fog=!theme.disableFog;changed=true}if(material instanceof Visualization.THREE.ShaderMaterial){if(material.uniforms.opacity){material.uniforms.opacity.value=opacity}}}return changed};MaterialsHelper.getMeshMaterial=function(shading,isWireframe){if(shading===void 0){shading=Visualization.THREE.SmoothShading}if(isWireframe===void 0){isWireframe=false}var shader=MaterialsHelper.shader;var ret=new Visualization.THREE.ShaderMaterial({uniforms:Visualization.THREE.UniformsUtils.clone(shader.uniforms),attributes:{vState:{type:"f",value:[]}},lights:true,fog:true,vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader,shading:shading,side:Visualization.THREE.DoubleSide,vertexColors:Visualization.THREE.VertexColors,blending:Visualization.THREE.NormalBlending,wireframe:isWireframe,linewidth:1});return ret};MaterialsHelper.getPhongVertexColorMaterial=function(){return new Visualization.THREE.MeshPhongMaterial({specular:11184810,shininess:2,shading:Visualization.THREE.SmoothShading,vertexColors:Visualization.THREE.VertexColors,side:Visualization.THREE.DoubleSide,metal:true})};MaterialsHelper.getDefaultHighlightMaterial=function(){return new Visualization.THREE.MeshPhongMaterial({color:16777215,specular:11184810,shininess:2,shading:Visualization.THREE.SmoothShading,side:Visualization.THREE.DoubleSide,metal:true})};MaterialsHelper.applyColorToBuffer=function(bufferAttribute,color){var buffer=bufferAttribute.array;for(var i=0,__i=buffer.length;i<__i;i+=3){buffer[i]=color.r;buffer[i+1]=color.g;buffer[i+2]=color.b}bufferAttribute.needsUpdate=true};MaterialsHelper.applyColorToMap=function(map,bufferAttribute,getter){var buffer=bufferAttribute.array,color={r:.45,g:.45,b:.45},vertexRanges=map.vertexRanges;for(var _i=0,_a=map.elementIndices;_i<_a.length;_i++){var elementIndex=_a[_i];var elementOffset=map.elementMap.get(elementIndex);var rangeStart=map.elementRanges[2*elementOffset],rangeEnd=map.elementRanges[2*elementOffset+1];if(rangeStart===rangeEnd)continue;getter(elementIndex,color);for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];for(var j=vStart;j<vEnd;j++){buffer[j*3]=color.r,buffer[j*3+1]=color.g,buffer[j*3+2]=color.b}}}bufferAttribute.needsUpdate=true};MaterialsHelper.pickVertexShader=["attribute vec4 pColor;","varying vec4 pC;","void main() {","pC = pColor;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n");MaterialsHelper.pickFragmentShader=["varying vec4 pC;","void main() {","gl_FragColor = pC;","}"].join("\n");MaterialsHelper.shader={uniforms:Visualization.THREE.UniformsUtils.merge([Visualization.THREE.UniformsLib["common"],Visualization.THREE.UniformsLib["bump"],Visualization.THREE.UniformsLib["normalmap"],Visualization.THREE.UniformsLib["fog"],Visualization.THREE.UniformsLib["lights"],Visualization.THREE.UniformsLib["shadowmap"],{emissive:{type:"c",value:new Visualization.THREE.Color(0)},specular:{type:"c",value:new Visualization.THREE.Color(1118481)},shininess:{type:"f",value:2},wrapRGB:{type:"v3",value:new Visualization.THREE.Vector3(1,1,1)},highlightColor:{type:"v3",value:new Visualization.THREE.Vector3(1,1,0)},selectionColor:{type:"v3",value:new Visualization.THREE.Vector3(1,0,0)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","#ifndef FLAT_SHADED","\tvarying vec3 vNormal;","#endif",Visualization.THREE.ShaderChunk["common"],Visualization.THREE.ShaderChunk["map_pars_vertex"],Visualization.THREE.ShaderChunk["lightmap_pars_vertex"],Visualization.THREE.ShaderChunk["envmap_pars_vertex"],Visualization.THREE.ShaderChunk["lights_phong_pars_vertex"],Visualization.THREE.ShaderChunk["color_pars_vertex"],Visualization.THREE.ShaderChunk["morphtarget_pars_vertex"],Visualization.THREE.ShaderChunk["skinning_pars_vertex"],Visualization.THREE.ShaderChunk["shadowmap_pars_vertex"],Visualization.THREE.ShaderChunk["logdepthbuf_pars_vertex"],"attribute float vState;","varying float vS;","void main() {","   vS = vState;",Visualization.THREE.ShaderChunk["map_vertex"],Visualization.THREE.ShaderChunk["lightmap_vertex"],Visualization.THREE.ShaderChunk["color_vertex"],Visualization.THREE.ShaderChunk["morphnormal_vertex"],Visualization.THREE.ShaderChunk["skinbase_vertex"],Visualization.THREE.ShaderChunk["skinnormal_vertex"],Visualization.THREE.ShaderChunk["defaultnormal_vertex"],"#ifndef FLAT_SHADED","\tvNormal = normalize( transformedNormal );","#endif",Visualization.THREE.ShaderChunk["morphtarget_vertex"],Visualization.THREE.ShaderChunk["skinning_vertex"],Visualization.THREE.ShaderChunk["default_vertex"],Visualization.THREE.ShaderChunk["logdepthbuf_vertex"],"\tvViewPosition = -mvPosition.xyz;",Visualization.THREE.ShaderChunk["worldpos_vertex"],Visualization.THREE.ShaderChunk["envmap_vertex"],Visualization.THREE.ShaderChunk["lights_phong_vertex"],Visualization.THREE.ShaderChunk["shadowmap_vertex"],"}"].join("\n"),fragmentShader:["#define PHONG","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;","uniform float opacity;","uniform vec3 highlightColor;","uniform vec3 selectionColor;",Visualization.THREE.ShaderChunk["common"],Visualization.THREE.ShaderChunk["color_pars_fragment"],Visualization.THREE.ShaderChunk["map_pars_fragment"],Visualization.THREE.ShaderChunk["alphamap_pars_fragment"],Visualization.THREE.ShaderChunk["lightmap_pars_fragment"],Visualization.THREE.ShaderChunk["envmap_pars_fragment"],Visualization.THREE.ShaderChunk["fog_pars_fragment"],Visualization.THREE.ShaderChunk["lights_phong_pars_fragment"],Visualization.THREE.ShaderChunk["shadowmap_pars_fragment"],Visualization.THREE.ShaderChunk["bumpmap_pars_fragment"],Visualization.THREE.ShaderChunk["normalmap_pars_fragment"],Visualization.THREE.ShaderChunk["specularmap_pars_fragment"],Visualization.THREE.ShaderChunk["logdepthbuf_pars_fragment"],"varying float vS;","void main() {","\tvec3 outgoingLight = vec3( 0.0 );","\tvec4 diffuseColor;","   if (vS < 0.33) { diffuseColor = vec4( vColor, opacity ); }","   else if (vS - floor(vS + 0.1) > 0.33) { diffuseColor = vec4(highlightColor, opacity); }","\telse { diffuseColor = vec4(selectionColor, opacity); }",Visualization.THREE.ShaderChunk["logdepthbuf_fragment"],Visualization.THREE.ShaderChunk["map_fragment"],Visualization.THREE.ShaderChunk["alphamap_fragment"],Visualization.THREE.ShaderChunk["alphatest_fragment"],Visualization.THREE.ShaderChunk["specularmap_fragment"],Visualization.THREE.ShaderChunk["lights_phong_fragment"],Visualization.THREE.ShaderChunk["lightmap_fragment"],Visualization.THREE.ShaderChunk["envmap_fragment"],Visualization.THREE.ShaderChunk["shadowmap_fragment"],Visualization.THREE.ShaderChunk["linear_to_gamma_fragment"],Visualization.THREE.ShaderChunk["fog_fragment"],"#ifdef USE_FOG","   if (diffuseColor.a > 0.99) { gl_FragColor = vec4( outgoingLight, diffuseColor.a ); }","   else { gl_FragColor = vec4( outgoingLight, (1.0 - fogFactor) * diffuseColor.a ); }","#else","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","#endif","}"].join("\n")};return MaterialsHelper}();Visualization.MaterialsHelper=MaterialsHelper})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var GeometryBase=function(){function GeometryBase(){}return GeometryBase}();Visualization.GeometryBase=GeometryBase;var Model=function(){function Model(){this.id=-1;this.entity=void 0;this.centroid=new Visualization.THREE.Vector3;this.radius=0;this.object=void 0;this.theme=void 0;this.disposeList=[];this.pickObject=void 0;this.pickBufferAttributes=[];this.dirty=false;this.props={};this.tag=void 0}Model.prototype.updateVisibility=function(visible){this.dirty=true;this.object.visible=visible;if(this.pickObject){this.pickObject.visible=this.getPickObjectVisibility(visible)}};Model.prototype.getVisibility=function(){return this.object.visible};Model.prototype.applyTheme=function(theme){this.dirty=true;this.theme=theme;if(!theme.interactive){if(this.pickObject)this.pickObject.visible=false}else{if(this.pickObject)this.pickObject.visible=this.object.visible}this.applyThemeInternal(theme)};Model.prototype.updateId=function(id,idWidth){this.id=id;for(var _i=0,_a=this.pickBufferAttributes;_i<_a.length;_i++){var attr=_a[_i];var buffer=attr.array;if(idWidth<=8){for(var i=0,_b=buffer.length;i<_b;i+=4){Visualization.Selection.Picking.applySceneIdFast(this.id,i,buffer)}}else{for(var i=0,_b=buffer.length;i<_b;i+=4){Visualization.Selection.Picking.applySceneIdSlow(idWidth-8,this.id,i,buffer)}}attr.needsUpdate=true}};Model.prototype.dispose=function(){for(var _i=0,_a=this.disposeList;_i<_a.length;_i++){var d=_a[_i];if(d)d.dispose()}this.disposeList=[]};Model.prototype.highlight=function(isOn){var changed=this.highlightInternal(isOn);this.dirty=this.dirty||changed;return changed};Model.prototype.applySelection=function(indices,action){var changed=this.applySelectionInternal(indices,action);this.dirty=this.dirty||changed;return changed};Model.prototype.getBoundingSphereOfSelection=function(indices){return undefined};Model.prototype.getPickObjectVisibility=function(visible){return visible&&this.theme.interactive};return Model}();Visualization.Model=Model})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var ModelStore=function(){function ModelStore(scene){this.scene=scene;this.availableIds=[];this.list=[];this.map=LiteMol.Core.Utils.FastMap.create();this.maxId=1;this._idWidth=8}Object.defineProperty(ModelStore.prototype,"idWidth",{get:function(){return this._idWidth},enumerable:true,configurable:true});Object.defineProperty(ModelStore.prototype,"all",{get:function(){return this.list},enumerable:true,configurable:true});Object.defineProperty(ModelStore.prototype,"count",{get:function(){return this.map.size},enumerable:true,configurable:true});ModelStore.prototype.getBySceneId=function(id){return this.map.get(id)};ModelStore.prototype.add=function(model,resetCamera){if(resetCamera===void 0){resetCamera=true}var id=-1;if(this.availableIds.length){id=this.availableIds.pop()}else{id=this.maxId++}this.map.set(id,model);this.list.push(model);model.updateId(id,8);if(model.object){this.scene.scene.add(model.object)}if(model.pickObject)this.scene.pickScene.add(model.pickObject);if(resetCamera){this.scene.camera.reset()}else{this.scene.forceRender()}};ModelStore.prototype.dispose=function(model){if(model.object){this.scene.scene.remove(model.object)}if(model.pickObject)this.scene.pickScene.remove(model.pickObject);model.dispose()};ModelStore.prototype.removeAndDispose=function(model){if(!this.map.get(model.id))return;this.availableIds.push(model.id);this.dispose(model);this.map.delete(model.id);var idx=this.list.indexOf(model);this.list[idx]=this.list[this.list.length-1];this.list.pop();if(model.id===this.maxId)this.maxId--;model.id=-1;this.scene.forceRender()};ModelStore.prototype.clear=function(){for(var _i=0,_a=this.list;_i<_a.length;_i++){var m=_a[_i];this.dispose(m)}this.list=[];this.maxId=0;this.availableIds=[];this.map.clear();this.scene.forceRender()};return ModelStore}();Visualization.ModelStore=ModelStore})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var CameraType;(function(CameraType){CameraType[CameraType["Perspective"]=0]="Perspective";CameraType[CameraType["Orthographic"]=1]="Orthographic"})(CameraType=Visualization.CameraType||(Visualization.CameraType={}));var LA=LiteMol.Core.Geometry.LinearAlgebra;var SlabControls=function(){function SlabControls(element){var _this=this;this.touchSlabOn=false;this.touchStartPosition={x:0,y:0};this.touchPosition={x:0,y:0};this.radius=0;this.slabWheelRate=1/15;this._planeDelta=new LiteMol.Core.Rx.Subject;this.subs=[];this.enableWheel=false;this.mouseMoveDelta=0;this.lastMousePosition=void 0;this.planeDelta=this._planeDelta;var events={wheel:function(e){return _this.handleMouseWheel(e)},touchStart:function(e){return _this.touchstart(e)},touchEnd:function(e){return _this.touchend(e)},touchMove:function(e){return _this.touchmove(e)},mouseMove:function(e){return _this.mousemove(e)},mouseOut:function(){return _this.mouseOut()}};element.addEventListener("mousewheel",events.wheel);element.addEventListener("DOMMouseScroll",events.wheel);element.addEventListener("mousemove",events.mouseMove);element.addEventListener("mouseout",events.mouseOut);element.addEventListener("touchstart",events.touchStart,false);element.addEventListener("touchend",events.touchEnd,false);element.addEventListener("touchmove",events.touchMove,false);this.subs.push(function(){return element.removeEventListener("mousewheel",events.wheel)});this.subs.push(function(){return element.removeEventListener("mousemove",events.mouseMove)});this.subs.push(function(){return element.removeEventListener("mouseout",events.mouseOut)});this.subs.push(function(){return element.removeEventListener("DOMMouseScroll",events.wheel)});this.subs.push(function(){return element.removeEventListener("touchstart",events.touchStart,false)});this.subs.push(function(){return element.removeEventListener("touchend",events.touchEnd,false)});this.subs.push(function(){return element.removeEventListener("touchmove",events.touchMove,false)})}SlabControls.prototype.updateSize=function(w,h){this.width=w;this.height=h};SlabControls.prototype.updateRadius=function(r){this.radius=r};SlabControls.prototype.destroy=function(){for(var _i=0,_a=this.subs;_i<_a.length;_i++){var s=_a[_i];s()}this.subs=[];this._planeDelta.onCompleted()};SlabControls.prototype.handleMouseWheel=function(event){if(!this.enableWheel)return;if(event.stopPropagation){event.stopPropagation()}if(event.preventDefault){event.preventDefault()}var delta=0;if(event.wheelDelta){delta=event.wheelDelta}else if(event.detail){delta=-event.detail}var sign=delta<0?1:-1;delta=this.radius*this.slabWheelRate*sign;this._planeDelta.onNext(delta)};SlabControls.prototype.touchstart=function(event){switch(event.touches.length){case 3:{this.touchStartPosition.x=0;this.touchStartPosition.y=0;for(var i=0;i<3;i++){this.touchStartPosition.x+=event.touches[i].clientX/3;this.touchStartPosition.y+=event.touches[i].clientY/3}this.touchSlabOn=true;break}default:this.touchSlabOn=false;break}};SlabControls.prototype.touchend=function(event){this.touchSlabOn=false};SlabControls.prototype.touchmove=function(event){if(!this.touchSlabOn)return;this.touchPosition.x=0;this.touchPosition.y=0;for(var i=0;i<3;i++){this.touchPosition.x+=event.touches[i].clientX/3;this.touchPosition.y+=event.touches[i].clientY/3}var delta=-5*this.radius*(this.touchPosition.y-this.touchStartPosition.y)/this.height;this.touchStartPosition.x=this.touchPosition.x;this.touchStartPosition.y=this.touchPosition.y;this._planeDelta.onNext(delta)};SlabControls.prototype.mousemove=function(e){if(!this.lastMousePosition){this.lastMousePosition=[e.clientX,e.clientY,0];return}var pos=[e.clientX,e.clientY,0];this.mouseMoveDelta+=LA.Vector3.distance(pos,this.lastMousePosition);this.lastMousePosition=pos;if(this.mouseMoveDelta>15)this.enableWheel=true};SlabControls.prototype.mouseOut=function(){this.mouseMoveDelta=0;this.lastMousePosition=void 0;this.enableWheel=false};return SlabControls}();Visualization.SlabControls=SlabControls;var Camera=function(){function Camera(scene,domElement){this.scene=scene;this.domElement=domElement;this.fog=new Visualization.THREE.Fog(0,0,500);this.focusPoint=new Visualization.THREE.Vector3(0,0,0);this.focusRadius=0;this.targetDistance=0;this.nearPlaneDistance=0;this.nearPlaneDelta=0;this.fogEnabled=true;this.fogDelta=0;this.observers=[];this.setup()}Camera.shouldInUpdateInclude=function(m){return!isNaN(m.centroid.x)&&m.getVisibility()};Camera.prototype.updateFocus=function(models){if(!models.length)return;var sorted=models.filter(function(m){return Camera.shouldInUpdateInclude(m)}).sort(function(a,b){return b.radius-a.radius});if(!sorted.length)return;var pivots=[sorted[0]];var t=new Visualization.THREE.Vector3;for(var i=1;i<sorted.length;i++){var a=sorted[i];var include=true;for(var _i=0,pivots_1=pivots;_i<pivots_1.length;_i++){var p=pivots_1[_i];var d=t.subVectors(a.centroid,p.centroid).length();if(d<p.radius){include=false;break}}if(include){pivots.push(a)}}var center=this.focusPoint;center.x=0;center.y=0;center.z=0;for(var _a=0,pivots_2=pivots;_a<pivots_2.length;_a++){var p=pivots_2[_a];center.add(p.centroid)}center.multiplyScalar(1/pivots.length);var radius=0;for(var _b=0,sorted_1=sorted;_b<sorted_1.length;_b++){var m=sorted_1[_b];radius=Math.max(radius,center.distanceTo(m.centroid)+m.radius)}this.focusRadius=radius;this.slabControls.updateRadius(this.focusRadius)};Camera.prototype.focus=function(){this.controls.reset();var target=this.focusPoint;this.camera.position.set(target.x,target.y,target.z-4*this.focusRadius);this.camera.lookAt(target);this.controls.target.set(target.x,target.y,target.z);this.cameraUpdated()};Camera.prototype.reset=function(){this.nearPlaneDelta=0;this.fogDelta=0;this.updateFocus(this.scene.models.all);this.focus()};Camera.prototype.snapshot=function(){return this.controls.getState()};Camera.prototype.restore=function(state){this.controls.setState(state);this.scene.forceRender()};Camera.prototype.focusOnModel=function(){var models=[];for(var _i=0;_i<arguments.length;_i++){models[_i]=arguments[_i]}this.updateFocus(models);this.nearPlaneDelta=0;this.fogDelta=0;this.controls.panAndMoveToDistance(this.focusPoint,this.focusRadius*4)};Camera.prototype.focusOnPoint=function(center,radius){this.focusPoint.x=center.x;this.focusPoint.y=center.y;this.focusPoint.z=center.z;this.focusRadius=Math.max(radius,1);this.slabControls.updateRadius(this.focusRadius);this.nearPlaneDelta=0;this.fogDelta=0;this.controls.panAndMoveToDistance(this.focusPoint,this.focusRadius*4)};Camera.prototype.move=function(target){this.controls.panTo(target)};Camera.prototype.updateSize=function(w,h){var camera=this.camera;if(camera instanceof Visualization.THREE.PerspectiveCamera){camera.aspect=w/h}this.slabControls.updateSize(w,h);this.camera.updateProjectionMatrix()};Object.defineProperty(Camera.prototype,"position",{get:function(){return this.camera.position},enumerable:true,configurable:true});Object.defineProperty(Camera.prototype,"object",{get:function(){return this.camera},enumerable:true,configurable:true});Camera.prototype.dispose=function(){if(this.slabControls){this.slabControls.destroy();this.slabControls=void 0}if(this.unbindCamera){this.unbindCamera();this.unbindCamera=void 0}if(this.controls){this.controls.destroy();this.controls=void 0}};Camera.prototype.planeDeltaUpdate=function(delta){var dist=this.computeNearDistance();var near=dist+this.nearPlaneDelta+delta;if(delta>0&&near>this.targetDistance)delta=0;if(delta<0&&near<.01)delta=0;this.nearPlaneDelta+=delta;this.fogDelta+=delta;this.cameraUpdated()};Camera.prototype.computeNearDistance=function(){var dist=this.controls.target.distanceTo(this.camera.position);if(dist>this.focusRadius)return dist-this.focusRadius;return 0};Camera.prototype.cameraUpdated=function(){var options=this.scene.options;this.fogEnabled=!!options.enableFog;var camera=this.camera;if(camera instanceof Visualization.THREE.PerspectiveCamera){camera.fov=options.cameraFOV}this.targetDistance=this.controls.target.distanceTo(this.camera.position);var near=this.computeNearDistance()+this.nearPlaneDelta;this.camera.near=Math.max(.01,Math.min(near,this.targetDistance-.5));if(options.enableFog){var fogNear=this.targetDistance-this.camera.near+1*this.focusRadius-this.nearPlaneDelta;var fogFar=this.targetDistance-this.camera.near+2*this.focusRadius-this.nearPlaneDelta;this.fog.near=Math.max(fogNear,.1);this.fog.far=Math.max(fogFar,.2)}else{this.fog.far=1000001;this.fog.near=1e6}this.camera.updateProjectionMatrix();this.scene.forceRender();for(var _i=0,_a=this.observers;_i<_a.length;_i++){var o=_a[_i];o.call(null,this)}};Camera.prototype.createCamera=function(){if(this.scene.options.cameraType===CameraType.Perspective){this.camera=new Visualization.THREE.PerspectiveCamera(this.scene.options.cameraFOV,this.scene.parentElement.clientWidth/this.scene.parentElement.clientHeight,.1,1e6)}else{var sw=this.scene.parentElement.clientWidth,sh=this.scene.parentElement.clientHeight;var w=100,h=sh/sw*w;this.camera=new Visualization.THREE.OrthographicCamera(.5*w/-2,.5*w/2,h/2,h/-2,.1,1e6)}if(this.controls){this.controls.camera=this.camera;this.reset()}};Camera.prototype.setup=function(){var _this=this;this.dispose();this.createCamera();this.controls=new Visualization.CameraControls(this.camera,this.domElement,this.scene);var cc=this.scene.options.clearColor;this.fog.color.setRGB(cc.r,cc.g,cc.b);this.scene.scene.fog=this.fog;var cameraUpdated=function(){return _this.cameraUpdated()};this.slabControls=new SlabControls(this.domElement);var deltaUpdate=this.slabControls.planeDelta.subscribe(function(delta){return _this.planeDeltaUpdate(delta)});this.controls.events.addEventListener("change",cameraUpdated);this.unbindCamera=function(){_this.controls.events.removeEventListener("change",cameraUpdated);deltaUpdate.dispose();_this.observers=[]};this.reset()};Camera.prototype.observe=function(callback){this.observers.push(callback)};Camera.prototype.stopObserving=function(callback){this.observers=this.observers.filter(function(o){return o!==callback})};return Camera}();Visualization.Camera=Camera})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){Visualization.DefaultSceneOptions={alpha:false,clearColor:{r:0,g:0,b:0},cameraSpeed:6,cameraFOV:30,cameraType:Visualization.CameraType.Perspective,enableFog:true};var MouseInfo=function(){function MouseInfo(renderState,domElement){this.renderState=renderState;this.domElement=domElement;this.position={x:0,y:0};this.lastPosition={x:0,y:0};this.isDirty=true;this.rect={left:0,top:0,right:0,bottom:0};this.exactPosition={x:0,y:0};this.isInside=false;this.isButtonDown=false}MouseInfo.prototype.updateRect=function(){var rect=this.domElement.getBoundingClientRect();this.rect.bottom=rect.bottom;this.rect.top=rect.top;this.rect.left=rect.left;this.rect.right=rect.right};MouseInfo.prototype.updatePosition=function(clientX,clientY){if(this.position.x===clientX&&this.position.y===clientY){return}this.isDirty=true;this.position.x=clientX;this.position.y=clientY};MouseInfo.prototype.update=function(){if(this.lastPosition.x===this.position.x&&this.lastPosition.y===this.position.y){return false}this.lastPosition.x=this.position.x;this.lastPosition.y=this.position.y;return true};MouseInfo.prototype.setExactPosition=function(){if(!this.isDirty){return}var x=Math.round((this.position.x-this.rect.left)/(this.rect.right-this.rect.left)*this.renderState.width)|0;var y=Math.round((this.position.y-this.rect.top)/(this.rect.bottom-this.rect.top)*this.renderState.height)|0;this.exactPosition.x=x;this.exactPosition.y=y;this.isDirty=false};return MouseInfo}();Visualization.MouseInfo=MouseInfo;var DefaultLighting=function(){function DefaultLighting(){this.lights=[]}DefaultLighting.prototype.setup=function(scene){var pointLight=new Visualization.THREE.PointLight(11184810,.75);scene.add(pointLight);this.lights=[pointLight];var ambient=new Visualization.THREE.AmbientLight(10066329);scene.add(ambient)};DefaultLighting.prototype.update=function(cameraPosition){for(var _i=0,_a=this.lights;_i<_a.length;_i++){var l=_a[_i];l.position.copy(cameraPosition)}};return DefaultLighting}();Visualization.DefaultLighting=DefaultLighting;var RenderState=function(){function RenderState(){this.width=0;this.height=0;this.resizing=false;this.rendered=false;this.lastRenderTime=0;this.pickDelta=0;this.animationFrame=0}return RenderState}();Visualization.RenderState=RenderState;var Scene=function(){function Scene(element,options){if(options===void 0){options={}}var _this=this;this.renderState=new RenderState;this.pickInfo=new Visualization.Selection.Pick;this.selectInfo=null;this.unbindEvents=[];this.models=new Visualization.ModelStore(this);this.events=new Visualization.THREE.EventDispatcher;this.initialResizeTimeout=void 0;this.clearHighlightsCall=function(){return _this.clearHighlights(true)};this.renderFunc=function(time){return _this.render(time)};this.pickBuffer=new Uint8Array(4);options=LiteMol.Core.Utils.extend({},options,Visualization.DefaultSceneOptions);this.options=options;this.parentElement=element;this.scene=new Visualization.THREE.Scene;this.pickScene=new Visualization.THREE.Scene;this.pickTarget=new Visualization.THREE.WebGLRenderTarget(1,1,{format:Visualization.THREE.RGBAFormat,minFilter:Visualization.THREE.LinearFilter});this.pickTarget.generateMipmaps=false;this.renderer=new Visualization.THREE.WebGLRenderer({antialias:true,alpha:options.alpha,preserveDrawingBuffer:true});this.renderer.setPixelRatio(window.devicePixelRatio||1);this.renderer.setClearColor(new Visualization.THREE.Color(options.clearColor.r,options.clearColor.g,options.clearColor.b));this.renderer.autoClear=true;this.renderer.sortObjects=false;this.mouseInfo=new MouseInfo(this.renderState,this.renderer.domElement);this.lighting=new DefaultLighting;this.lighting.setup(this.scene);this.parentElement.appendChild(this.renderer.domElement);var delayedResizeHandler=LiteMol.Core.Utils.debounce(function(){return _this.handleResize()},150),resizeHandler=function(){_this.renderState.resizing=true;delayedResizeHandler()};window.addEventListener("resize",resizeHandler);document.addEventListener("resize",resizeHandler);this.parentElement.addEventListener("resize",resizeHandler);this.unbindEvents.push(function(){return window.removeEventListener("resize",resizeHandler)});this.unbindEvents.push(function(){return document.removeEventListener("resize",resizeHandler)});this.unbindEvents.push(function(){return _this.parentElement.removeEventListener("resize",resizeHandler)});this.setupMouse();this.camera=new Visualization.Camera(this,this.renderer.domElement);this.handleResize();this.renderer.clear();this.needsRender();this.renderState.animationFrame=requestAnimationFrame(this.renderFunc);this.initialResizeTimeout=setTimeout(function(){_this.initialResizeTimeout=void 0;_this.handleResize()},1e3)}Scene.prototype.updateOptions=function(options){options=LiteMol.Core.Utils.extend({},options,this.options);var updateCamera=options.cameraType!==this.options.cameraType;var cc=options.clearColor;this.renderer.setClearColor(new Visualization.THREE.Color(cc.r,cc.g,cc.b));this.renderer.setClearAlpha(options.alpha?0:1);this.camera.fog.color.setRGB(cc.r,cc.g,cc.b);if(this.camera.controls){this.camera.controls.rotateSpeed=options.cameraSpeed;this.camera.controls.zoomSpeed=options.cameraSpeed}this.options=options;if(updateCamera)this.camera.createCamera();this.camera.cameraUpdated();this.forceRender()};Scene.prototype.setupMouse=function(){var _this=this;var handleMove=function(e){if(!_this.mouseInfo.isInside){_this.mouseInfo.updateRect()}_this.mouseInfo.updatePosition(e.clientX,e.clientY);_this.mouseInfo.isInside=true};var element=this.renderer.domElement;element.addEventListener("mousemove",handleMove);this.unbindEvents.push(function(){return element.removeEventListener("mousemove",handleMove)});var handleLeave=function(e){_this.mouseInfo.isInside=false;_this.clearHighlights()};element.addEventListener("mouseleave",handleLeave);this.unbindEvents.push(function(){return element.removeEventListener("mouseleave",handleLeave)});var handleDown=function(e){if(_this.mouseInfo.isInside){_this.mouseInfo.updateRect();_this.handleSelectStart(e.clientX,e.clientY)}else{_this.selectInfo=null}_this.mouseInfo.isButtonDown=true;_this.clearHighlights()};element.addEventListener("mousedown",handleDown);this.unbindEvents.push(function(){return element.removeEventListener("mousedown",handleDown)});var handleUp=function(e){_this.mouseInfo.isButtonDown=false;_this.needsRender();_this.handleSelectEnd(e.clientX,e.clientY);_this.clearHighlights(true)};window.addEventListener("mouseup",handleUp);this.unbindEvents.push(function(){return window.removeEventListener("mouseup",handleUp)});var handleRectUpdate=function(e){_this.mouseInfo.updateRect()};window.addEventListener("mousewheel",handleRectUpdate);window.addEventListener("DOMMouseScroll",handleRectUpdate);this.unbindEvents.push(function(){return window.removeEventListener("mousewheel",handleRectUpdate)});this.unbindEvents.push(function(){return window.removeEventListener("DOMMouseScroll",handleRectUpdate)});element.addEventListener("touchstart",handleRectUpdate,false);this.unbindEvents.push(function(){return element.removeEventListener("touchstart",handleRectUpdate,false)});var handleTouchEnd=function(e){var touches=e.touches;if(!touches.length){touches=e.changedTouches}if(touches.length===1){_this.handleSelectEnd(touches[0].clientX,touches[0].clientY)}setTimeout(_this.clearHighlightsCall,1e3/15)};element.addEventListener("touchend",handleTouchEnd,false);this.unbindEvents.push(function(){return element.removeEventListener("touchend",handleTouchEnd,false)});try{element.addEventListener("touchcancel",handleTouchEnd,false);this.unbindEvents.push(function(){return element.removeEventListener("touchcancel",handleTouchEnd,false)})}catch(e){}};Scene.prototype.handleSelectStart=function(x,y){this.pickInfo.selectStart(x,y);this.selectInfo=this.pickInfo.getPickInfo()};Scene.prototype.handleSelectEnd=function(x,y){if(this.pickInfo.selectEnd(x,y)){var info=this.handlePick(true);this.dispatchSelectEvent(info)}this.selectInfo=null};Scene.prototype.handleResize=function(){var w=this.parentElement.clientWidth,h=this.parentElement.clientHeight;this.camera.updateSize(w,h);if(this.renderState.height===h&&this.renderState.width===w){this.renderState.resizing=false;return}this.renderState.width=w;this.renderState.height=h;this.renderer.setSize(w,h);this.pickTarget=new Visualization.THREE.WebGLRenderTarget(w,h,{format:Visualization.THREE.RGBAFormat,minFilter:Visualization.THREE.LinearFilter});this.pickTarget.generateMipmaps=false;this.renderState.resizing=false;this.mouseInfo.updateRect();this.needsRender()};Scene.prototype.needsRender=function(){this.renderState.rendered=false};Scene.prototype.checkDirty=function(){var dirty=false;for(var _i=0,_a=this.models.all;_i<_a.length;_i++){var m=_a[_i];dirty=dirty||m.dirty;m.dirty=false}return dirty};Scene.prototype.render=function(time){if(this.renderState.resizing){this.renderState.animationFrame=requestAnimationFrame(this.renderFunc);return}var delta=time-this.renderState.lastRenderTime;this.renderState.pickDelta+=delta;this.renderState.lastRenderTime=time;if(this.renderState.pickDelta>33.3333333){this.renderState.pickDelta=this.renderState.pickDelta%33.3333333;this.handlePick(false)}var dirty=this.checkDirty();if(dirty)this.renderState.rendered=false;if(!this.renderState.rendered){this.lighting.update(this.camera.position);this.renderer.sortObjects=true;this.renderer.render(this.scene,this.camera.object);this.renderer.sortObjects=false;this.renderState.rendered=true;if(!this.mouseInfo.isButtonDown){this.renderer.setClearAlpha(1);this.renderer.render(this.pickScene,this.camera.object,this.pickTarget);this.renderer.setClearAlpha(this.options.alpha?0:1)}}this.renderState.animationFrame=requestAnimationFrame(this.renderFunc)};Scene.prototype.dispatchHoverEvent=function(){this.events.dispatchEvent({type:Scene.hoverEvent,target:null,data:this.pickInfo.getPickInfo()})};Scene.prototype.dispatchSelectEvent=function(info){if(info){this.events.dispatchEvent({type:Scene.selectEvent,target:null,data:info})}};Scene.prototype.clearHighlights=function(update){if(update===void 0){update=true}var info=this.pickInfo,model=this.models.getBySceneId(info.currentPickId),changed=false;if(model){changed=model.highlightElement(info.currentPickElementId,false)}if(changed&&update)this.needsRender();if(this.pickInfo.reset()){this.dispatchHoverEvent()}return changed};Scene.prototype.handlePick=function(isSelect){if(!isSelect&&(!this.mouseInfo.update()||this.mouseInfo.isButtonDown)||this.renderState.resizing){return}if(!this.mouseInfo.isInside){return void 0}this.mouseInfo.setExactPosition();var position=this.mouseInfo.exactPosition;var cY=this.pickTarget.height-position.y;if(this.pickTarget.width<position.x-1||position.x<.01||this.pickTarget.height<cY-1||cY<.01){return void 0}this.renderer.readRenderTargetPixels(this.pickTarget,position.x|0,cY|0,1,1,this.pickBuffer);var id=Visualization.Selection.Picking.getSceneId(this.models.idWidth,this.pickBuffer),pickId=Visualization.Selection.Picking.getElementId(this.models.idWidth,this.pickBuffer),info=this.pickInfo;if(isSelect){if(id===255)return void 0;var model=this.models.getBySceneId(id);if(!model)return void 0;return{model:model,elements:model.getPickElements(pickId)}}else{if(id===info.currentPickId&&pickId===info.currentPickElementId)return void 0;var changed=this.clearHighlights(false),model=this.models.getBySceneId(id);if(id===255||!model){if(changed)this.needsRender();return void 0}info.currentPickId=id;info.currentPickElementId=pickId;if(model.highlightElement(pickId,true)||changed){this.needsRender();info.current={model:model,elements:model.getPickElements(pickId)};this.dispatchHoverEvent()}return void 0}};Scene.prototype.resized=function(){this.handleResize()};Scene.prototype.forceRender=function(){this.needsRender()};Scene.prototype.clear=function(){this.models.clear()};Scene.prototype.downloadScreenshot=function(){var uri=this.renderer.domElement.toDataURL("image/png");var a=document.createElement("a");a.style.visibility="hidden";a.href=uri;a.target="_blank";a.download="litemol_screenshot.png";document.body.appendChild(a);a.click();setTimeout(function(){return a.remove()},2e4)};Scene.prototype.destroy=function(){this.clear();for(var _i=0,_a=this.unbindEvents;_i<_a.length;_i++){var e=_a[_i];try{e()}catch(_ex){}}if(this.initialResizeTimeout!==void 0){clearTimeout(this.initialResizeTimeout);this.initialResizeTimeout=void 0}this.unbindEvents=[];cancelAnimationFrame(this.renderState.animationFrame);this.scene=null;this.pickScene=null;this.camera.dispose();this.camera=null;if(this.renderer&&this.renderer.dispose)this.renderer.dispose();this.renderer=null;this.pickTarget.dispose();this.pickTarget=null;while(this.parentElement.lastChild)this.parentElement.removeChild(this.parentElement.lastChild)};Scene.hoverEvent="hover";Scene.selectEvent="select";return Scene}();Visualization.Scene=Scene})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var CameraControls=function(){function CameraControls(camera,domElement,scene){var _this=this;this.camera=camera;this.domElement=domElement;this.scene=scene;this.enabled=true;this.rotateSpeed=6;this.zoomSpeed=6;this.panSpeed=1;this.noRotate=false;this.noZoom=false;this.noPan=false;this.noRoll=true;this.staticMoving=true;this.dynamicDampingFactor=.2;this.minDistance=1.5;this.maxDistance=1e5;this.keys=[65,83,68];this.target=new Visualization.THREE.Vector3;this.EPS=1e-6;this.lastPosition=new Visualization.THREE.Vector3;this._state=-1;this._keyDownState=-1;this._prevState=-1;this._eye=new Visualization.THREE.Vector3;this._rotateStart=new Visualization.THREE.Vector3;this._rotateEnd=new Visualization.THREE.Vector3;this._zoomStart=new Visualization.THREE.Vector2;this._zoomEnd=new Visualization.THREE.Vector2;this._touchZoomDistanceStart=0;this._touchZoomDistanceEnd=0;this._panStart=new Visualization.THREE.Vector2;this._panEnd=new Visualization.THREE.Vector2;this.target0=this.target.clone();this.position0=this.camera.position.clone();this.up0=this.camera.up.clone();this.changeEvent={type:"change",target:void 0};this.startEvent={type:"start",target:void 0};this.endEvent={type:"end",target:void 0};this.events=new Visualization.THREE.EventDispatcher;this._mouseOnScreen=new Visualization.THREE.Vector2;this._mouseOnBallProjection=new Visualization.THREE.Vector3;this._objectUp=new Visualization.THREE.Vector3;this._mouseOnBall=new Visualization.THREE.Vector3;this._rotationAxis=new Visualization.THREE.Vector3;this._rotationQuaternion=new Visualization.THREE.Quaternion;this._panMouseChange=new Visualization.THREE.Vector2;this._panObjectUp=new Visualization.THREE.Vector3;this._panPan=new Visualization.THREE.Vector3;this._panToDelta=new Visualization.THREE.Vector3;this._panToVector=new Visualization.THREE.Vector3;this.eventHandlers={keydown:function(event){return _this.keydown(event)},keyup:function(event){return _this.keyup(event)},mousedown:function(event){return _this.mousedown(event)},mouseup:function(event){return _this.mouseup(event)},mousemove:function(event){return _this.mousemove(event)},touchstart:function(event){return _this.touchstart(event)},touchmove:function(event){return _this.touchmove(event)},touchend:function(event){return _this.touchend(event)}};this.init()}CameraControls.prototype.getMouseOnScreen=function(){this.scene.mouseInfo.setExactPosition();var rs=this.scene.renderState,pos=this.scene.mouseInfo.exactPosition;this._mouseOnScreen.set(pos.x/rs.width,pos.y/rs.height);return this._mouseOnScreen};CameraControls.prototype.getMouseProjectionOnBall=function(){this.scene.mouseInfo.setExactPosition();var rs=this.scene.renderState,pos=this.scene.mouseInfo.exactPosition;var cX=.5*rs.width,cY=.5*rs.height,u=(pos.x-cX)/(rs.width*.5),v=-(pos.y-cY)/(rs.height*.5);this._mouseOnBall.set(u,v,0);var length=this._mouseOnBall.length();if(this.noRoll){if(length<Math.SQRT1_2){this._mouseOnBall.z=Math.sqrt(1-length*length)}else{this._mouseOnBall.z=.5/length}}else if(length>1){this._mouseOnBall.normalize()}else{this._mouseOnBall.z=Math.sqrt(1-length*length)}this._eye.copy(this.camera.position).sub(this.target);this._mouseOnBallProjection.copy(this.camera.up).setLength(this._mouseOnBall.y);this._mouseOnBallProjection.add(this._objectUp.copy(this.camera.up).cross(this._eye).setLength(this._mouseOnBall.x));this._mouseOnBallProjection.add(this._eye.setLength(this._mouseOnBall.z));return this._mouseOnBallProjection};CameraControls.prototype.rotateCamera=function(){var angle=Math.acos(this._rotateStart.dot(this._rotateEnd)/this._rotateStart.length()/this._rotateEnd.length());if(angle){this._rotationAxis.crossVectors(this._rotateStart,this._rotateEnd).normalize();angle*=this.rotateSpeed;this._rotationQuaternion.setFromAxisAngle(this._rotationAxis,-angle);this._eye.applyQuaternion(this._rotationQuaternion);this.camera.up.applyQuaternion(this._rotationQuaternion);this._rotateEnd.applyQuaternion(this._rotationQuaternion);if(this.staticMoving){this._rotateStart.copy(this._rotateEnd)}else{this._rotationQuaternion.setFromAxisAngle(this._rotationAxis,angle*(this.dynamicDampingFactor-1));this._rotateStart.applyQuaternion(this._rotationQuaternion)}}};CameraControls.prototype.zoomCamera=function(){if(this._state===4){var factor=this._touchZoomDistanceStart/this._touchZoomDistanceEnd;this._touchZoomDistanceStart=this._touchZoomDistanceEnd;this._eye.multiplyScalar(factor)}else{var factor=1-(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed;if(factor!==1&&factor>0){this._eye.multiplyScalar(factor);if(this.staticMoving){this._zoomStart.copy(this._zoomEnd)}else{this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor}}}};CameraControls.prototype.panCamera=function(){this._panMouseChange.copy(this._panEnd).sub(this._panStart);if(this._panMouseChange.lengthSq()){this._panMouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this._panPan.copy(this._eye).cross(this.camera.up).setLength(this._panMouseChange.x);this._panPan.add(this._panObjectUp.copy(this.camera.up).setLength(this._panMouseChange.y));this.camera.position.add(this._panPan);this.target.add(this._panPan);if(this.staticMoving){this._panStart.copy(this._panEnd)}else{this._panStart.add(this._panMouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}};CameraControls.prototype.panTo=function(_a){var x=_a.x,y=_a.y,z=_a.z;this._panToVector.set(x,y,z);this._panToDelta.subVectors(this._panToVector,this.target);this.camera.position.add(this._panToDelta);this.camera.lookAt(this._panToVector);this.target.copy(this._panToVector);this._eye.subVectors(this.camera.position,this.target);this.lastPosition.copy(this.camera.position);if(this._panToDelta.lengthSq()>this.EPS){this.events.dispatchEvent(this.changeEvent)}};CameraControls.prototype.panAndMoveToDistance=function(_a,distance){var x=_a.x,y=_a.y,z=_a.z;this._panToVector.set(x,y,z);this._panToDelta.subVectors(this._panToVector,this.target);this.camera.position.add(this._panToDelta);this.camera.lookAt(this._panToVector);this.target.copy(this._panToVector);this._eye.subVectors(this.camera.position,this.target);this._eye.setLength(distance);this.camera.position.addVectors(this.target,this._eye);this.checkDistances();this.lastPosition.copy(this.camera.position);this.events.dispatchEvent(this.changeEvent)};CameraControls.prototype.checkDistances=function(){if(!this.noZoom||!this.noPan){if(this._eye.lengthSq()>this.maxDistance*this.maxDistance){this.camera.position.addVectors(this.target,this._eye.setLength(this.maxDistance))}if(this._eye.lengthSq()<this.minDistance*this.minDistance){this.camera.position.addVectors(this.target,this._eye.setLength(this.minDistance))}}};CameraControls.prototype.update=function(){this._eye.subVectors(this.camera.position,this.target);if(!this.noRotate){this.rotateCamera()}if(!this.noZoom){this.zoomCamera()}if(!this.noPan){this.panCamera()}this.camera.position.addVectors(this.target,this._eye);this.checkDistances();this.camera.lookAt(this.target);if(this.lastPosition.distanceToSquared(this.camera.position)>this.EPS){this.events.dispatchEvent(this.changeEvent);this.lastPosition.copy(this.camera.position)}};CameraControls.prototype.reset=function(){this._state=-1;this._prevState=-1;this.target.copy(this.target0);this.camera.position.copy(this.position0);this.camera.up.copy(this.up0);this._eye.subVectors(this.camera.position,this.target);this.camera.lookAt(this.target);this.events.dispatchEvent(this.changeEvent);this.lastPosition.copy(this.camera.position)};CameraControls.prototype.getState=function(){return{state:this._state,prevState:this._prevState,target:this.target.clone(),objPos:this.camera.position.clone(),objUp:this.camera.up.clone(),eye:this._eye.clone(),lastPosition:this.lastPosition.clone()}};CameraControls.prototype.setState=function(state){this._state=state.state;this._prevState=state.prevState;this.target.copy(state.target);this.camera.position.copy(state.objPos);this.camera.up.copy(state.objUp);this._eye.copy(state.eye);this.camera.lookAt(this.target);this.events.dispatchEvent(this.changeEvent);this.lastPosition.copy(state.lastPosition)};CameraControls.prototype.keydown=function(event){if(this.enabled===false)return;window.removeEventListener("keydown",this.eventHandlers.keydown,false);window.addEventListener("keyup",this.eventHandlers.keyup,false);this._prevState=this._state;if(this._state!==-1){return}else if(event.keyCode===this.keys[0]&&!this.noRotate){this._state=0}else if(event.keyCode===this.keys[2]&&!this.noZoom){this._state=2}else if(event.keyCode===this.keys[1]&&!this.noPan){this._state=1}this._keyDownState=this._state};CameraControls.prototype.keyup=function(event){if(this.enabled===false)return;this._state=this._prevState;this._keyDownState=-1;window.removeEventListener("keyup",this.eventHandlers.keyup,false);window.addEventListener("keydown",this.eventHandlers.keydown,false)};CameraControls.prototype.mousedown=function(event){if(this.enabled===false)return;event.preventDefault();this.scene.mouseInfo.updatePosition(event.clientX,event.clientY);if(this._keyDownState!==-1){this._state=this._keyDownState}if(this._state===-1){this._state=event.button}if(this._state===0&&!this.noRotate){this._rotateStart.copy(this.getMouseProjectionOnBall());this._rotateEnd.copy(this._rotateStart)}else if(this._state===2&&!this.noZoom){this._zoomStart.copy(this.getMouseOnScreen());this._zoomEnd.copy(this._zoomStart)}else if(this._state===1&&!this.noPan){this._panStart.copy(this.getMouseOnScreen());this._panEnd.copy(this._panStart)}window.addEventListener("mousemove",this.eventHandlers.mousemove,false);window.addEventListener("mouseup",this.eventHandlers.mouseup,false);this.events.dispatchEvent(this.startEvent)};CameraControls.prototype.mousemove=function(event){if(this.enabled===false)return;event.preventDefault();this.scene.mouseInfo.updatePosition(event.clientX,event.clientY);if(this._state===0&&!this.noRotate){this._rotateEnd.copy(this.getMouseProjectionOnBall())}else if(this._state===2&&!this.noZoom){this._zoomEnd.copy(this.getMouseOnScreen())}else if(this._state===1&&!this.noPan){this._panEnd.copy(this.getMouseOnScreen())}this.update()};CameraControls.prototype.mouseup=function(event){if(this.enabled===false)return;event.preventDefault();this._state=-1;window.removeEventListener("mousemove",this.eventHandlers.mousemove,false);window.removeEventListener("mouseup",this.eventHandlers.mouseup,false);this.events.dispatchEvent(this.endEvent)};CameraControls.prototype.touchstart=function(event){if(this.enabled===false)return;switch(event.touches.length){case 1:this._state=3;this.scene.mouseInfo.updatePosition(event.touches[0].clientX,event.touches[0].clientY);this._rotateStart.copy(this.getMouseProjectionOnBall());this._rotateEnd.copy(this._rotateStart);break;case 2:this._state=4;var dx=event.touches[0].clientX-event.touches[1].clientX;var dy=event.touches[0].clientY-event.touches[1].clientY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(dx*dx+dy*dy);var x=(event.touches[0].clientX+event.touches[1].clientX)/2;var y=(event.touches[0].clientY+event.touches[1].clientY)/2;this.scene.mouseInfo.updatePosition(x,y);this._panStart.copy(this.getMouseOnScreen());this._panEnd.copy(this._panStart);break;default:this._state=-1}this.events.dispatchEvent(this.startEvent)};CameraControls.prototype.touchmove=function(event){if(this.enabled===false)return;event.preventDefault();event.stopPropagation();switch(event.touches.length){case 1:this.scene.mouseInfo.updatePosition(event.touches[0].clientX,event.touches[0].clientY);this._rotateEnd.copy(this.getMouseProjectionOnBall());this.update();break;case 2:var dx=event.touches[0].clientX-event.touches[1].clientX;var dy=event.touches[0].clientY-event.touches[1].clientY;this._touchZoomDistanceEnd=Math.sqrt(dx*dx+dy*dy);var x=(event.touches[0].clientX+event.touches[1].clientX)/2;var y=(event.touches[0].clientY+event.touches[1].clientY)/2;this.scene.mouseInfo.updatePosition(x,y);this._panEnd.copy(this.getMouseOnScreen());this.update();break;default:this._state=-1}};CameraControls.prototype.touchend=function(event){if(this.enabled===false)return;var touches=event.touches;if(!touches.length){touches=event.changedTouches}switch(touches.length){case 1:this.scene.mouseInfo.updatePosition(touches[0].clientX,touches[0].clientY);this._rotateEnd.copy(this.getMouseProjectionOnBall());this._rotateStart.copy(this._rotateEnd);break;case 2:this._touchZoomDistanceStart=this._touchZoomDistanceEnd=0;var x=(touches[0].clientX+touches[1].clientX)/2;var y=(touches[0].clientY+touches[1].clientY)/2;this.scene.mouseInfo.updatePosition(x,y);this._panEnd.copy(this.getMouseOnScreen());this._panStart.copy(this._panEnd);break}this._state=-1;this.events.dispatchEvent(this.endEvent)};CameraControls.prototype.preventContextMenu=function(event){event.preventDefault()};CameraControls.prototype.init=function(){this.domElement.addEventListener("contextmenu",this.preventContextMenu,false);this.domElement.addEventListener("mousedown",this.eventHandlers.mousedown,false);this.domElement.addEventListener("touchstart",this.eventHandlers.touchstart,false);this.domElement.addEventListener("touchend",this.eventHandlers.touchend,false);this.domElement.addEventListener("touchmove",this.eventHandlers.touchmove,false);window.addEventListener("keydown",this.eventHandlers.keydown,false);this.update()};CameraControls.prototype.destroy=function(){this.domElement.removeEventListener("contextmenu",this.preventContextMenu,false);this.domElement.removeEventListener("mousedown",this.eventHandlers.mousedown,false);window.removeEventListener("keydown",this.eventHandlers.keydown,false);this.domElement.removeEventListener("touchstart",this.eventHandlers.touchstart,false);this.domElement.removeEventListener("touchend",this.eventHandlers.touchend,false);this.domElement.removeEventListener("touchmove",this.eventHandlers.touchmove,false);this.camera=void 0;this.domElement=void 0};return CameraControls}();Visualization.CameraControls=CameraControls})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Selection;(function(Selection){var Pick=function(){function Pick(){this.current=null;this.currentPickId=-1;this.currentPickElementId=-1;this.selectPos={x:0,y:0}}Pick.prototype.getPickInfo=function(){if(!this.current)return this.current;return{model:this.current.model,elements:this.current.elements}};Pick.prototype.reset=function(){var changed=this.current!==null;this.currentPickId=-1;this.currentPickElementId=-1;this.current=null;return changed};Pick.prototype.selectStart=function(x,y){this.selectPos.x=x;this.selectPos.y=y};Pick.prototype.selectEnd=function(x,y){var dx=x-this.selectPos.x,dy=y-this.selectPos.y;return dx*dx+dy*dy<4.5};return Pick}();Selection.Pick=Pick;var Picking;(function(Picking){function assignPickColor(elementId,color){var b=elementId>>16&255,g=elementId>>8&255,r=elementId&255;color.r=r/255;color.g=g/255;color.b=b/255}Picking.assignPickColor=assignPickColor;function applySceneIdFast(id,offset,data){data[offset+3]=id/255}Picking.applySceneIdFast=applySceneIdFast;function applySceneIdSlow(extraBits,id,offset,data){var low=(id&(1<<extraBits)-1)<<8-extraBits;var high=id>>extraBits;data[offset+3]=high/255;var v=data[offset+2]*255|0;data[offset+2]=(v|low)/255}Picking.applySceneIdSlow=applySceneIdSlow;function getElementId(idWidth,buffer){var mask=(1<<16-idWidth)-1;return buffer[0]|buffer[1]<<8|(buffer[2]&mask)<<16}Picking.getElementId=getElementId;function getSceneId(idWidth,buffer){var extraBits=idWidth-8;var low=buffer[2]&(1<<extraBits)-1<<8-extraBits>>8-extraBits;var high=buffer[3]<<extraBits;return low|high}Picking.getSceneId=getSceneId})(Picking=Selection.Picking||(Selection.Picking={}));var ChunkedArray=LiteMol.Core.Utils.ChunkedArray;var VertexMapBuilder=function(){function VertexMapBuilder(elementCount){this.elementMap=LiteMol.Core.Utils.FastMap.create();this.elementIndex=0;this.elementRangeIndex=0;this.rangeIndex=0;this.added=0;this.elementIndices=ChunkedArray.create(function(size){return new Int32Array(size)},elementCount,1);this.elementRanges=new Int32Array(2*elementCount);this.vertexRanges=ChunkedArray.create(function(size){return new Int32Array(size)},elementCount,2)}VertexMapBuilder.prototype.startElement=function(index){this.elementIndex=index;this.elementRangeIndex=this.elementMap.size;this.rangeIndex=this.vertexRanges.elementCount;this.added=0};VertexMapBuilder.prototype.addVertexRange=function(start,end){this.added++;ChunkedArray.add2(this.vertexRanges,start,end)};VertexMapBuilder.prototype.endElement=function(){ChunkedArray.add(this.elementIndices,this.elementIndex);this.elementMap.set(this.elementIndex,this.elementRangeIndex);this.elementRanges[2*this.elementRangeIndex]=2*this.rangeIndex;this.elementRanges[2*this.elementRangeIndex+1]=2*(this.rangeIndex+this.added)};VertexMapBuilder.prototype.getMap=function(){return new VertexMap(ChunkedArray.compact(this.elementIndices),this.elementMap,this.elementRanges,ChunkedArray.compact(this.vertexRanges))};return VertexMapBuilder}();Selection.VertexMapBuilder=VertexMapBuilder;var VertexMap=function(){function VertexMap(elementIndices,elementMap,elementRanges,vertexRanges){this.elementIndices=elementIndices;this.elementMap=elementMap;this.elementRanges=elementRanges;this.vertexRanges=vertexRanges}return VertexMap}();Selection.VertexMap=VertexMap;function applyActionToRange(array,start,end,action){var changed=false;if(action===3){for(var i=start;i<end;i++){var v=array[i];var c=v|0;if(v-c<.33){array[i]=c+.55;changed=true}}}else if(action===4){for(var i=start;i<end;i++){var v=array[i];var c=v|0;if(v-c>.33){array[i]=c;changed=true}}}else if(action===1){for(var i=start;i<end;i++){array[i]=array[i]+1;changed=true}}else if(action===2){for(var i=start;i<end;i++){if(array[i]>.75){var v=array[i]-1;if(v<0)v=0;array[i]=v;changed=true}}}else{for(var i=start;i<end;i++){var v=array[i];array[i]=0;changed=changed||v!==0}}return changed}Selection.applyActionToRange=applyActionToRange;function applyActionToBuffer(buffer,action){var array=buffer.array;var ret=applyActionToRange(array,0,array.length,action);if(ret)buffer.needsUpdate=true;return ret}Selection.applyActionToBuffer=applyActionToBuffer})(Selection=Visualization.Selection||(Visualization.Selection={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Geometry;(function(Geometry){"use strict";function toBufferGeometry(raw){var geometry=new Visualization.THREE.BufferGeometry;geometry.addAttribute("position",new Visualization.THREE.BufferAttribute(raw.vertices,3));if(raw.normals){geometry.addAttribute("normal",new Visualization.THREE.BufferAttribute(raw.normals,3))}geometry.addAttribute("index",new Visualization.THREE.BufferAttribute(raw.indices,1));return geometry}Geometry.toBufferGeometry=toBufferGeometry;function addAttribute(geom,name,a,elementSize){geom.addAttribute(name,new Visualization.THREE.BufferAttribute(a,elementSize))}Geometry.addAttribute=addAttribute;var CoreUtils=LiteMol.Core.Utils;var ChunkedArray=CoreUtils.ChunkedArray;var ArrayBuilder=CoreUtils.ArrayBuilder;var Builder;(function(Builder){function createStatic(vertexCount,indexCount,elementSize){if(elementSize===void 0){elementSize=3}return{type:"Static",vertices:ArrayBuilder.create(function(s){return new Float32Array(s)},vertexCount,3),indices:ArrayBuilder.create(function(s){return new Uint32Array(s)},indexCount,elementSize),normals:elementSize===3?ArrayBuilder.create(function(s){return new Float32Array(s)},vertexCount,3):void 0,elementSize:elementSize}}Builder.createStatic=createStatic;function createDynamic(vertexChunkSize,indexChunkSize,elementSize){if(elementSize===void 0){elementSize=3}return{type:"Dynamic",vertices:ChunkedArray.create(function(s){return new Float32Array(s)},vertexChunkSize,3),indices:ChunkedArray.create(function(s){return new Uint32Array(s)},indexChunkSize,elementSize),normals:elementSize===3?ChunkedArray.create(function(s){return new Float32Array(s)},vertexChunkSize,3):void 0,elementSize:elementSize}}Builder.createDynamic=createDynamic;var add2d=ChunkedArray.add2;var add3d=ChunkedArray.add3;var add2s=ArrayBuilder.add2;var add3s=ArrayBuilder.add3;var Geom=LiteMol.Core.Geometry;var Vec3=Geom.LinearAlgebra.Vector3;var Mat4=Geom.LinearAlgebra.Matrix4;function copy3o(offset,src,tar,add){for(var i=0,__i=src.length;i<__i;i+=3){add(tar,src[i]+offset,src[i+1]+offset,src[i+2]+offset)}}var temp=Vec3.zero();function copy3t(t,src,tar,add){var v=temp;for(var i=0,__i=src.length;i<__i;i+=3){v[0]=src[i],v[1]=src[i+1],v[2]=src[i+2];Vec3.transformMat4(v,v,t);add(tar,v[0],v[1],v[2])}}function copy2o(offset,src,tar,add){for(var i=0,__i=src.length;i<__i;i+=2){add(tar,src[i]+offset,src[i+1]+offset)}}function error(msg){throw new Error(msg)}var scaleTransform=Mat4.zero(),translateTransform=Mat4.zero(),rotateTransform=Mat4.zero(),vTransform=Mat4.zero(),nTransform=Mat4.zero();var defaulScale=Vec3.fromValues(1,1,1),defaultTranslation=Vec3.zero();function addRawTransformed(builder,geom,scale,translation,rotation){Mat4.fromScaling(scaleTransform,scale||defaulScale);Mat4.fromTranslation(translateTransform,translation||defaultTranslation);if(rotation)Mat4.copy(rotateTransform,rotation);else Mat4.fromIdentity(rotateTransform);Mat4.mul3(vTransform,translateTransform,rotateTransform,scaleTransform);var offset=builder.vertices.elementCount;var addV=builder.type==="Static"?add3s:add3d;copy3t(vTransform,geom.vertices,builder.vertices,addV);if(builder.normals){if(!geom.normals)error("geom is missing normals.");Mat4.mul(nTransform,rotateTransform,scaleTransform);copy3t(nTransform,geom.normals,builder.normals,addV)}if(builder.elementSize===2){copy2o(offset,geom.indices,builder.indices,builder.type==="Static"?add2s:add2d)}else{copy3o(offset,geom.indices,builder.indices,builder.type==="Static"?add3s:add3d)}}Builder.addRawTransformed=addRawTransformed;function addVertex3s(builder,x,y,z){add3s(builder.vertices,x,y,z)}Builder.addVertex3s=addVertex3s;function addNormal3s(builder,x,y,z){add3s(builder.normals,x,y,z)}Builder.addNormal3s=addNormal3s;function addIndex3s(builder,i,j,k){add3s(builder.indices,i,j,k)}Builder.addIndex3s=addIndex3s;function addVertex3d(builder,x,y,z){add3d(builder.vertices,x,y,z)}Builder.addVertex3d=addVertex3d;function addNormal3d(builder,x,y,z){add3d(builder.normals,x,y,z)}Builder.addNormal3d=addNormal3d;function addIndex3d(builder,i,j,k){add3d(builder.indices,i,j,k)}Builder.addIndex3d=addIndex3d;var dashTemplate=void 0;function getDashTemplate(){if(dashTemplate)return dashTemplate;dashTemplate=Visualization.GeometryHelper.toRawGeometry(new Visualization.THREE.BoxGeometry(1,1,1));for(var i=0;i<dashTemplate.vertices.length;i+=3){dashTemplate.vertices[i]+=.5}return dashTemplate}Builder.getDashTemplate=getDashTemplate;var dashScale=Vec3.zero(),dashOffset=Vec3.zero(),dashDir=Vec3.zero(),dashUp=Vec3.fromValues(1,0,0),dashRotation=Mat4.zero();function addDashedLine(builder,a,b,size,gap,r){var dir=Vec3.sub(dashDir,b,a);var length=Vec3.magnitude(dir);var scale=Vec3.set(dashScale,size,r,r);var rotation=Vec3.makeRotation(dashRotation,dashUp,dir);var templ=getDashTemplate();var offset=dashOffset;Vec3.copy(offset,a);Vec3.normalize(dir,dir);var delta=size+gap;Vec3.scale(dir,dir,delta);for(var t=0;t<length;t+=delta){if(t+size>length)scale[0]=length-t;addRawTransformed(builder,templ,scale,offset,rotation);Vec3.add(offset,offset,dir)}}Builder.addDashedLine=addDashedLine;function compactS(tar){return tar.array}function compactD(tar){return ChunkedArray.compact(tar)}function toBufferGeometry(builder){var compact=builder.type==="Static"?compactS:compactD;return Geometry.toBufferGeometry({vertices:compact(builder.vertices),vertexCount:builder.vertices.elementCount,normals:builder.normals&&compact(builder.normals),indices:compact(builder.indices),indexCount:builder.indices.elementCount,elementSize:builder.elementSize})}Builder.toBufferGeometry=toBufferGeometry})(Builder=Geometry.Builder||(Geometry.Builder={}))})(Geometry=Visualization.Geometry||(Visualization.Geometry={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Surface;(function(Surface){"use strict";var ChunkedArray=LiteMol.Core.Utils.ChunkedArray;function sortAnnotation(ctx){var indices=new Int32Array(ctx.data.annotation.length);var annotation=ctx.data.annotation;for(var i=0,_b=indices.length;i<_b;i++)indices[i]=i;Array.prototype.sort.call(indices,function(a,b){var ret=annotation[a]-annotation[b];if(!ret)return a-b;return ret});return indices}function splice(start,end,indices,map){var currentStart=start;var currentEnd=start+1;while(currentStart<end){while(currentEnd<end&&indices[currentEnd]-indices[currentEnd-1]<1.1)currentEnd++;map.addVertexRange(indices[currentStart],indices[currentEnd-1]+1);currentStart=currentEnd;currentEnd=currentEnd+1}}function createVertexMap(ctx){var indices=sortAnnotation(ctx);var annotation=ctx.data.annotation;var count=1;for(var i=0,_b=indices.length-1;i<_b;i++){if(annotation[indices[i]]!==annotation[indices[i+1]])count++}var map=new Visualization.Selection.VertexMapBuilder(count);var xs=new Int32Array(indices.length);for(var i=0,_b=indices.length;i<_b;i++){xs[i]=annotation[indices[i]]}var currentAnnotation=annotation[indices[0]];map.startElement(currentAnnotation);for(var i=0,_b=indices.length;i<_b;i++){var an=annotation[indices[i]];if(an!==currentAnnotation){map.endElement();map.startElement(an);currentAnnotation=an}var start=i;i++;while(an===annotation[indices[i]])i++;var end=i;i--;splice(start,end,indices,map)}map.endElement();return map.getMap()}function createFullMap(ctx){var map=new Visualization.Selection.VertexMapBuilder(1);map.startElement(0);map.addVertexRange(0,ctx.vertexCount);map.endElement();return map.getMap()}function computeVertexMap(ctx){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.computation.updateProgress("Computing selection map...")];case 1:_a.sent();if(ctx.data.annotation){ctx.geom.elementToVertexMap=createVertexMap(ctx)}else{ctx.geom.elementToVertexMap=createFullMap(ctx)}return[2]}})})}var chunkSize=1e5;function computePickPlatesChunk(start,ctx){return __awaiter(this,void 0,void 0,function(){var tri,ids,pickPlatesVertices,pickPlatesTris,pickPlatesColors,vs,color,pickTris,platesVertexCount,i,_b,a,b,c,aI,bI,cI,s;return __generator(this,function(_a){tri=ctx.data.triangleIndices;ids=ctx.data.annotation;pickPlatesVertices=ctx.pickPlatesVertices;pickPlatesTris=ctx.pickPlatesTris;pickPlatesColors=ctx.pickPlatesColors;vs=ctx.data.vertices;color={r:.45,g:.45,b:.45};pickTris=ctx.pickTris;platesVertexCount=0;for(i=start,_b=Math.min(start+chunkSize,ctx.triCount);i<_b;i++){a=tri[3*i],b=tri[3*i+1],c=tri[3*i+2];aI=ids[a],bI=ids[b],cI=ids[c];if(aI===bI&&bI===cI){ChunkedArray.add3(pickTris,a,b,c);continue}s=-1;if(aI===bI||aI===cI)s=aI;else if(bI===cI)s=bI;ChunkedArray.add3(pickPlatesVertices,vs[3*a],vs[3*a+1],vs[3*a+2]);ChunkedArray.add3(pickPlatesVertices,vs[3*b],vs[3*b+1],vs[3*b+2]);ChunkedArray.add3(pickPlatesVertices,vs[3*c],vs[3*c+1],vs[3*c+2]);ChunkedArray.add3(pickPlatesTris,platesVertexCount++,platesVertexCount++,platesVertexCount++);if(s<0){color.r=0;color.g=0;color.b=0}else{Visualization.Selection.Picking.assignPickColor(s,color)}ChunkedArray.add4(pickPlatesColors,color.r,color.g,color.b,0);ChunkedArray.add4(pickPlatesColors,color.r,color.g,color.b,0);ChunkedArray.add4(pickPlatesColors,color.r,color.g,color.b,0)}ctx.platesVertexCount=ctx.platesVertexCount+platesVertexCount;return[2]})})}function computePickPlatesChunks(ctx){return __awaiter(this,void 0,void 0,function(){var started,start,time;return __generator(this,function(_a){switch(_a.label){case 0:started=LiteMol.Core.Utils.PerformanceMonitor.currentTime();start=0;_a.label=1;case 1:if(!(start<ctx.triCount))return[3,5];time=LiteMol.Core.Utils.PerformanceMonitor.currentTime();if(!(time-started>LiteMol.Core.Computation.UpdateProgressDelta))return[3,3];started=time;return[4,ctx.computation.updateProgress("Creating selection geometry...",true,start,ctx.triCount)];case 2:_a.sent();_a.label=3;case 3:computePickPlatesChunk(start,ctx);_a.label=4;case 4:start+=chunkSize;return[3,1];case 5:return[2]}})})}function assignPickColors(ctx){var color={r:.45,g:.45,b:.45},ids=ctx.data.annotation;ctx.pickTris=ChunkedArray.forIndexBuffer(ctx.triCount);var pickColorBuffer=ctx.pickColorBuffer;for(var i=0,_b=ctx.vertexCount;i<_b;i++){var id=ids[i];if(id>=0){Visualization.Selection.Picking.assignPickColor(id+1,color);pickColorBuffer[i*4]=color.r;pickColorBuffer[i*4+1]=color.g;pickColorBuffer[i*4+2]=color.b}}}function createFullPickGeometry(attr,ctx){var pickGeometry=new Visualization.THREE.BufferGeometry;pickGeometry.addAttribute("position",attr.position);pickGeometry.addAttribute("index",attr.index);pickGeometry.addAttribute("pColor",new Visualization.THREE.BufferAttribute(ctx.pickColorBuffer,4));ctx.geom.pickGeometry=pickGeometry;pickGeometry=new Visualization.THREE.BufferGeometry;pickGeometry.addAttribute("position",new Visualization.THREE.BufferAttribute(new Float32Array(0),3));pickGeometry.addAttribute("index",new Visualization.THREE.BufferAttribute(new Uint32Array(0),1));pickGeometry.addAttribute("pColor",new Visualization.THREE.BufferAttribute(new Float32Array(0),4));ctx.geom.pickPlatesGeometry=pickGeometry}function createPickGeometry(attr,ctx){var pickGeometry=new Visualization.THREE.BufferGeometry;pickGeometry.addAttribute("position",attr.position);pickGeometry.addAttribute("index",attr.index);pickGeometry.addAttribute("pColor",new Visualization.THREE.BufferAttribute(ctx.pickColorBuffer,4));ctx.geom.pickGeometry=pickGeometry;pickGeometry=new Visualization.THREE.BufferGeometry;pickGeometry.addAttribute("position",new Visualization.THREE.BufferAttribute(ChunkedArray.compact(ctx.pickPlatesVertices),3));pickGeometry.addAttribute("index",new Visualization.THREE.BufferAttribute(ChunkedArray.compact(ctx.pickPlatesTris),1));pickGeometry.addAttribute("pColor",new Visualization.THREE.BufferAttribute(ChunkedArray.compact(ctx.pickPlatesColors),4));ctx.geom.pickPlatesGeometry=pickGeometry}function addWireframeEdge(edges,included,a,b){if(a>b){var t=a;a=b;b=t}if(included.add((a+b)*(a+b+1)/2+b)){ChunkedArray.add2(edges,a,b)}}function buildWireframeIndices(ctx){var tris=ctx.data.triangleIndices;var edges=ChunkedArray.create(function(size){return new Uint32Array(size)},1.5*ctx.triCount|0,2);var includedEdges=LiteMol.Core.Utils.FastSet.create();for(var i=0,_b=tris.length;i<_b;i+=3){var a=tris[i],b=tris[i+1],c=tris[i+2];addWireframeEdge(edges,includedEdges,a,b);addWireframeEdge(edges,includedEdges,a,c);addWireframeEdge(edges,includedEdges,b,c)}return new Visualization.THREE.BufferAttribute(ChunkedArray.compact(edges),1)}function makeBasicAttributes(ctx){return{position:new Visualization.THREE.BufferAttribute(ctx.data.vertices,3),index:new Visualization.THREE.BufferAttribute(ctx.data.triangleIndices,1)}}function createGeometry(attr,isWireframe,ctx){var geometry=new Visualization.THREE.BufferGeometry;geometry.addAttribute("position",attr.position);geometry.addAttribute("normal",new Visualization.THREE.BufferAttribute(ctx.data.normals,3));geometry.addAttribute("color",new Visualization.THREE.BufferAttribute(new Float32Array(ctx.data.vertices.length),3));if(isWireframe){geometry.addAttribute("index",buildWireframeIndices(ctx))}else{geometry.addAttribute("index",attr.index)}ctx.geom.geometry=geometry;ctx.geom.vertexStateBuffer=new Visualization.THREE.BufferAttribute(new Float32Array(ctx.data.vertices.length),1);geometry.addAttribute("vState",ctx.geom.vertexStateBuffer)}function computePickGeometry(attr,ctx){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.computation.updateProgress("Creating selection geometry...")];case 1:_a.sent();ctx.pickColorBuffer=new Float32Array(ctx.vertexCount*4);if(!!ctx.data.annotation)return[3,2];createFullPickGeometry(attr,ctx);return[2];case 2:assignPickColors(ctx);ctx.pickPlatesVertices=ChunkedArray.forVertex3D(Math.max(ctx.vertexCount/10,10));ctx.pickPlatesTris=ChunkedArray.forIndexBuffer(Math.max(ctx.triCount/10,10));ctx.pickPlatesColors=ChunkedArray.create(function(s){return new Float32Array(s)},Math.max(ctx.vertexCount/10,10),4);ctx.platesVertexCount=0;return[4,computePickPlatesChunks(ctx)];case 3:_a.sent();createPickGeometry(attr,ctx);_a.label=4;case 4:return[2]}})})}function buildGeometry(data,computation,isWireframe){return __awaiter(this,void 0,void 0,function(){var ctx,attr;return __generator(this,function(_a){switch(_a.label){case 0:ctx={data:data,computation:computation,geom:new Geometry,vertexCount:data.vertices.length/3|0,triCount:data.triangleIndices.length/3|0};return[4,computation.updateProgress("Creating geometry...")];case 1:_a.sent();return[4,LiteMol.Core.Geometry.Surface.computeNormals(data).run(computation)];case 2:_a.sent();return[4,LiteMol.Core.Geometry.Surface.computeBoundingSphere(data).run(computation)];case 3:_a.sent();attr=makeBasicAttributes(ctx);return[4,computeVertexMap(ctx)];case 4:_a.sent();return[4,computePickGeometry(attr,ctx)];case 5:_a.sent();createGeometry(attr,isWireframe,ctx);ctx.geom.vertexToElementMap=ctx.data.annotation;return[2,ctx.geom]}})})}Surface.buildGeometry=buildGeometry;var Geometry=function(_super){__extends(Geometry,_super);function Geometry(){var _this=_super.call(this)||this;_this.geometry=void 0;_this.vertexToElementMap=void 0;_this.elementToVertexMap=void 0;_this.pickGeometry=void 0;_this.pickPlatesGeometry=void 0;_this.vertexStateBuffer=void 0;return _this}Geometry.prototype.dispose=function(){this.geometry.dispose();if(this.pickGeometry){this.pickGeometry.dispose();this.pickPlatesGeometry.dispose()}};return Geometry}(Visualization.GeometryBase);Surface.Geometry=Geometry})(Surface=Visualization.Surface||(Visualization.Surface={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Surface;(function(Surface){"use strict";Surface.DefaultSurfaceModelParameters={isWireframe:false};var Model=function(_super){__extends(Model,_super);function Model(){return _super!==null&&_super.apply(this,arguments)||this}Model.prototype.applySelectionInternal=function(indices,action){var buffer=this.geometry.vertexStateBuffer,array=buffer.array,map=this.geometry.elementToVertexMap,vertexRanges=map.vertexRanges,changed=false;for(var _i=0,indices_8=indices;_i<indices_8.length;_i++){var index=indices_8[_i];if(!map.elementMap.has(index))continue;var indexOffset=map.elementMap.get(index),rangeStart=map.elementRanges[2*indexOffset],rangeEnd=map.elementRanges[2*indexOffset+1];if(rangeStart===rangeEnd)continue;for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];changed=Visualization.Selection.applyActionToRange(array,vStart,vEnd,action)||changed}}if(!changed)return false;buffer.needsUpdate=true;return true};Model.prototype.highlightElement=function(pickId,highlight){if(this.surface.annotation){return this.applySelection(this.getPickElements(pickId),highlight?3:4)}else{return this.highlightInternal(highlight)}};Model.prototype.highlightInternal=function(isOn){return Visualization.Selection.applyActionToBuffer(this.geometry.vertexStateBuffer,isOn?3:4)};Model.prototype.getPickElements=function(pickId){if(!pickId)return[];return[pickId-1]};Model.prototype.getBoundingSphereOfSelection=function(indices){if(!this.geometry.vertexToElementMap)return{radius:this.radius,center:LiteMol.Core.Geometry.LinearAlgebra.Vector3.fromObj(this.centroid)};var vs=this.geometry.geometry.attributes.position.array;var center=new Visualization.THREE.Vector3,count=0;var map=this.geometry.elementToVertexMap,vertexRanges=map.vertexRanges;for(var _i=0,indices_9=indices;_i<indices_9.length;_i++){var index=indices_9[_i];if(!map.elementMap.has(index))continue;var indexOffset=map.elementMap.get(index),rangeStart=map.elementRanges[2*indexOffset],rangeEnd=map.elementRanges[2*indexOffset+1];if(rangeStart===rangeEnd)continue;for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];for(var j=vStart;j<vEnd;j++){center.x+=vs[3*j];center.y+=vs[3*j+1];center.z+=vs[3*j+2];count++}}}if(!count)return void 0;center.x=center.x/count;center.y=center.y/count;center.z=center.z/count;var t=new Visualization.THREE.Vector3;var radius=0;for(var _a=0,indices_10=indices;_a<indices_10.length;_a++){var index=indices_10[_a];if(!map.elementMap.has(index))continue;var indexOffset=map.elementMap.get(index),rangeStart=map.elementRanges[2*indexOffset],rangeEnd=map.elementRanges[2*indexOffset+1];if(rangeStart===rangeEnd)continue;for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];for(var j=vStart;j<vEnd;j++){t.x=vs[3*j];t.y=vs[3*j+1];t.z=vs[3*j+2];radius=Math.max(radius,t.distanceToSquared(center))}}}radius=Math.sqrt(radius);return{radius:radius,center:LiteMol.Core.Geometry.LinearAlgebra.Vector3.fromObj(center)}};Model.prototype.applyThemeInternal=function(theme){var color={r:0,g:0,b:0};Visualization.MaterialsHelper.updateMaterial(this.material,theme,this.object);var colors=this.geometry.geometry.attributes.color.array,ids=this.geometry.vertexToElementMap;if(ids){for(var i=0,_b=colors.length/3|0;i<_b;i++){var id=ids[i];if(id<0){color.r=0;color.g=0;color.b=0}else{theme.setElementColor(id,color)}colors[3*i]=color.r;colors[3*i+1]=color.g;colors[3*i+2]=color.b}}else{theme.setElementColor(0,color);for(var i=0,_b=colors.length/3|0;i<_b;i++){colors[3*i]=color.r;colors[3*i+1]=color.g;colors[3*i+2]=color.b}}if(this.pickObject)this.pickObject.visible=this.getPickObjectVisibility(this.object.visible);this.geometry.geometry.getAttribute("color").needsUpdate=true};Model.prototype.getPickObjectVisibility=function(visible){if(Visualization.Theme.isTransparent(this.theme)||!this.theme.interactive){return false}else{return visible}};Model.prototype.createObjects=function(){var mesh=new Visualization.THREE.Mesh(this.geometry.geometry,this.material);var pickObj=void 0;if(this.geometry.pickGeometry){pickObj=new Visualization.THREE.Object3D;var pick=new Visualization.THREE.Mesh(this.geometry.pickGeometry,this.pickMaterial);pickObj.add(pick);pick=new Visualization.THREE.Mesh(this.geometry.pickPlatesGeometry,this.pickMaterial);pickObj.add(pick)}return{main:mesh,pick:pickObj}};Model.create=function(entity,_a){var _this=this;var surface=_a.surface,theme=_a.theme,_c=_a.parameters,parameters=_c===void 0?Surface.DefaultSurfaceModelParameters:_c,props=_a.props;return LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var geometry,ret,center,obj;return __generator(this,function(_a){switch(_a.label){case 0:return[4,Surface.buildGeometry(surface,ctx,!!parameters.isWireframe)];case 1:geometry=_a.sent();ret=new Model;ret.surface=surface;ret.material=Visualization.MaterialsHelper.getMeshMaterial(Visualization.THREE.FlatShading,!!parameters.isWireframe);ret.geometry=geometry;ret.pickMaterial=Visualization.MaterialsHelper.getPickMaterial();ret.entity=entity;center=surface.boundingSphere.center;ret.centroid=new Visualization.THREE.Vector3(center[0],center[1],center[2]);ret.radius=surface.boundingSphere.radius;if(props)ret.props=props;ret.disposeList.push(ret.geometry,ret.material,ret.pickMaterial);obj=ret.createObjects();ret.object=obj.main;ret.pickObject=obj.pick;ret.applyTheme(theme);ret.pickBufferAttributes=[ret.geometry.pickGeometry.attributes.pColor,ret.geometry.pickPlatesGeometry.attributes.pColor];return[2,ret]}})})})};return Model}(Visualization.Model);Surface.Model=Model})(Surface=Visualization.Surface||(Visualization.Surface={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Lines;(function(Lines){"use strict";var Geometry=function(_super){__extends(Geometry,_super);function Geometry(){var _this=_super.call(this)||this;_this.geometry=void 0;_this.center=new Visualization.THREE.Vector3(0,0,0);_this.radius=0;return _this}Geometry.prototype.dispose=function(){this.geometry.dispose()};Geometry.create=function(vertices,indices){var ret=new Geometry;var center=new Visualization.THREE.Vector3(0,0,0);for(var i=0,_b=vertices.length;i<_b;i+=3){center.x+=vertices[i];center.y+=vertices[i+1];center.z+=vertices[i+2]}center.multiplyScalar(1/(vertices.length/3));var radius=0;for(var i=0,_b=vertices.length;i<_b;i+=3){var dx=center.x-vertices[i];var dy=center.y-vertices[i+1];var dz=center.z-vertices[i+2];var d=dx*dx+dy*dy+dz*dz;if(d>radius)radius=d}radius=Math.sqrt(radius);var geometry=new Visualization.THREE.BufferGeometry;geometry.addAttribute("position",new Visualization.THREE.BufferAttribute(vertices,3));geometry.addAttribute("index",new Visualization.THREE.BufferAttribute(indices,1));ret.geometry=geometry;ret.center=center;ret.radius=radius;return ret};return Geometry}(Visualization.GeometryBase);Lines.Geometry=Geometry})(Lines=Visualization.Lines||(Visualization.Lines={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Lines;(function(Lines){"use strict";var Model=function(_super){__extends(Model,_super);function Model(){return _super!==null&&_super.apply(this,arguments)||this}Model.prototype.applySelectionInternal=function(indices,action){return false};Model.prototype.highlightElement=function(pickId,highlight){return this.applySelection([pickId],highlight?3:4)};Model.prototype.highlightInternal=function(isOn){return false};Model.prototype.getPickElements=function(pickId){return[pickId]};Model.prototype.applyThemeInternal=function(theme){var color=theme.colors.get("Uniform");this.material.color=new Visualization.THREE.Color(color.r,color.g,color.b);this.material.needsUpdate=true};Model.prototype.getPickObjectVisibility=function(visible){return false};Model.prototype.createObjects=function(){return{main:new Visualization.THREE.Mesh(this.geometry.geometry,this.material),pick:void 0}};Model.create=function(entity,_a){var _this=this;var geometry=_a.geometry,theme=_a.theme,props=_a.props;return LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var ret,obj;return __generator(this,function(_a){ret=new Model;ret.material=new Visualization.THREE.MeshBasicMaterial({wireframe:true});ret.geometry=geometry;ret.entity=entity;ret.centroid=geometry.center;ret.radius=geometry.radius;if(props)ret.props=props;ret.disposeList.push(ret.geometry,ret.material);obj=ret.createObjects();ret.object=obj.main;ret.pickObject=void 0;ret.applyTheme(theme);ret.pickBufferAttributes=[];return[2,ret]})})})};return Model}(Visualization.Model);Lines.Model=Model})(Lines=Visualization.Lines||(Visualization.Lines={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Labels;(function(Labels){"use strict";Labels.DefaultTextAtlasParams={font:["sans-serif"],size:36,style:"normal",variant:"normal",weight:"normal",outline:0,width:2048,height:2048};var TextAtlasCache=LiteMol.Core.Utils.FastMap.create();function getTextAtlas(params){var hash=JSON.stringify(params);if(TextAtlasCache.has(hash))return TextAtlasCache.get(hash);var atlas=new TextAtlas(params);TextAtlasCache.set(hash,atlas);return atlas}Labels.getTextAtlas=getTextAtlas;var TextAtlas=function(){function TextAtlas(params){this.gamma=1;this.mapped=LiteMol.Core.Utils.FastMap.create();this.state={scratchW:0,scratchH:0,currentX:0,currentY:0};this.lineHeight=0;this.params=LiteMol.Core.Utils.extend({},params,Labels.DefaultTextAtlasParams);if(typeof navigator!=="undefined"){var ua=navigator.userAgent;if(ua.match(/Chrome/)&&ua.match(/OS X/)){this.gamma=.5}}this.build();this.populate();this.texture=new Visualization.THREE.Texture(this.canvas.canvas2);this.texture.flipY=false;this.texture.needsUpdate=true;this.canvas=void 0}TextAtlas.prototype.build=function(){var params=this.params;var lineHeight=params.size+2*params.outline+Math.round(params.size/4);var maxWidth=params.width/4;var canvas=document.createElement("canvas");canvas.width=maxWidth;canvas.height=lineHeight;var ctx=canvas.getContext("2d");ctx.font=params.style+" "+params.variant+" "+params.weight+" "+params.size+"px "+params.font;ctx.fillStyle="#FF0000";ctx.textAlign="left";ctx.textBaseline="bottom";ctx.lineJoin="round";var colors=[];var dilate=params.outline*3;for(var i=0;i<dilate;++i){var val=Math.max(0,-i*8+128-+!i*8);var hex=("00"+val.toString(16)).slice(-2);colors.push("#"+hex+hex+hex)}var scratch=new Uint8Array(maxWidth*lineHeight*2);var data=new Uint8Array(params.width*params.height*4);var canvas2=document.createElement("canvas");canvas2.width=params.width;canvas2.height=params.height;var ctx2=canvas2.getContext("2d");this.canvas={canvas:canvas,ctx:ctx,canvas2:canvas2,ctx2:ctx2,maxWidth:maxWidth,colors:colors,scratch:scratch,data:data};this.lineHeight=lineHeight};TextAtlas.prototype.map=function(text){if(this.mapped.has(text))return this.mapped.get(text);this.draw(text);var state=this.state;if(state.currentX+state.scratchW>this.params.width){state.currentX=0;state.currentY+=state.scratchH}if(state.currentY+state.scratchH>this.params.height){console.warn("TextAtlas canvas to small")}var metrics={x:state.currentX,y:state.currentY,w:state.scratchW,h:state.scratchH};this.mapped.set(text,metrics);this.canvas.ctx2.drawImage(this.canvas.canvas,0,0,state.scratchW,state.scratchH,state.currentX,state.currentY,state.scratchW,state.scratchH);state.currentX+=state.scratchW;return metrics};TextAtlas.prototype.getTextMetrics=function(text){return this.mapped.has(text)?this.mapped.get(text):this.placeholder};TextAtlas.prototype.draw=function(text){var _a=this,params=_a.params,canvas=_a.canvas;var h=this.lineHeight;var o=params.outline;var ctx=canvas.ctx;var dst=canvas.scratch;var max=canvas.maxWidth;var colors=canvas.colors;var x=o;var y=h-params.outline;var m=ctx.measureText(text);var w=Math.min(max,Math.ceil(m.width+2*x+1));ctx.clearRect(0,0,w,h);var i,il,j,imageData,data;if(params.outline===0){ctx.fillText(text,x,y);imageData=ctx.getImageData(0,0,w,h);data=imageData.data;j=3;for(i=0,il=data.length/4;i<il;++i){dst[i]=data[j];j+=4}}else{ctx.globalCompositeOperation="source-over";for(i=o+1;i>0;--i){j=i>1?i*2-2:i;ctx.strokeStyle=colors[j-1];ctx.lineWidth=j;ctx.strokeText(text,x,y)}ctx.globalCompositeOperation="multiply";ctx.fillStyle="#FF00FF";ctx.fillText(text,x,y);imageData=ctx.getImageData(0,0,w,h);data=imageData.data;j=0;var gamma=this.gamma;for(i=0,il=data.length/4;i<il;++i){var a=data[j];var mask=a?data[j+1]/a:1;if(gamma===.5){mask=Math.sqrt(mask)}mask=Math.min(1,Math.max(0,mask));var b=256-a;var c=b+(a-b)*mask;dst[i]=Math.max(0,Math.min(255,c+2));data[j+3]=dst[i];j+=4}}ctx.putImageData(imageData,0,0);this.state.scratchW=w;this.state.scratchH=h};TextAtlas.prototype.populate=function(){this.placeholder=this.map(String.fromCharCode(65533));for(var i=0;i<127;++i){this.map(String.fromCharCode(i))}for(var i=128;i<255;++i){this.map(String.fromCharCode(i))}for(var i=880;i<1023;++i){this.map(String.fromCharCode(i))}for(var i=1024;i<1279;++i){this.map(String.fromCharCode(i))}this.map(String.fromCharCode(8491))};return TextAtlas}();Labels.TextAtlas=TextAtlas})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Labels;(function(Labels){var Geometry;(function(Geometry){"use strict";function create(params){var state=initState(params);calcVertices(state);makeMapping(state);var idx=makeIndexBuffer(state);var geometry=new Visualization.THREE.BufferGeometry;geometry.addAttribute("position",new Visualization.THREE.BufferAttribute(state.vertices,3));geometry.addAttribute("index",new Visualization.THREE.BufferAttribute(idx,1));geometry.addAttribute("color",new Visualization.THREE.BufferAttribute(new Float32Array(state.quadCount*4*3),3));geometry.addAttribute("mapping",new Visualization.THREE.BufferAttribute(state.mapping,2));geometry.addAttribute("inputTexCoord",new Visualization.THREE.BufferAttribute(state.texCoords,2));geometry.addAttribute("inputSize",new Visualization.THREE.BufferAttribute(state.size,1));return{geometry:geometry,texture:state.textAtlas.texture,options:state.options}}Geometry.create=create;function initState(params){var options=LiteMol.Core.Utils.extend({},params.options,Labels.DefaultLabelsOptions);var charCount=0;for(var _i=0,_a=params.labels;_i<_a.length;_i++){var t=_a[_i];charCount+=t.length}var textAtlas=Labels.getTextAtlas({font:[options.fontFamily],style:options.fontStyle,weight:options.fontWeight,size:options.fontSize,outline:options.useSDF?5:0});var quadCount=charCount+params.labels.length;return{positions:params.positions,inputSizes:params.sizes,labels:params.labels,options:options,textAtlas:textAtlas,charCount:charCount,quadCount:quadCount,vertices:new Float32Array(quadCount*4*3),size:new Float32Array(quadCount*4),texCoords:new Float32Array(quadCount*4*2),mapping:new Float32Array(quadCount*4*2)}}function calcVertices(state){var text=state.labels;var _a=state.positions,x=_a.x,y=_a.y,z=_a.z;var vertices=state.vertices,size=state.size,inputSizes=state.inputSizes;var iCharAll=0;for(var v=0;v<text.length;++v){var txt=text[v];var nChar=txt.length+1;for(var iChar=0;iChar<nChar;++iChar,++iCharAll){for(var m=0;m<4;m++){var j=iCharAll*4*3+3*m;vertices[j]=x[v];vertices[j+1]=y[v];vertices[j+2]=z[v];size[iCharAll*4+m]=inputSizes[v]}}}}function makeMapping(state){var ta=state.textAtlas;var text=state.labels;var attachment=state.options.attachment;var outline=ta.params.outline,lineHeight=ta.lineHeight;var margin=ta.lineHeight*state.options.backgroundMargin*.1-10;var inputTexCoord=state.texCoords;var inputMapping=state.mapping;var iCharAll=0;var c,i,txt,xadvance,iChar,nChar,xShift,yShift;for(var v=0;v<text.length;++v){txt=text[v];xadvance=0;nChar=txt.length;for(iChar=0;iChar<nChar;++iChar){c=ta.getTextMetrics(txt[iChar]);xadvance+=c.w-2*outline}if(attachment.indexOf("top")===0){yShift=ta.lineHeight/1.25}else if(attachment.indexOf("middle")===0){yShift=ta.lineHeight/2.5}else{yShift=0}if(attachment.indexOf("right")>0){xShift=xadvance}else if(attachment.indexOf("center")>0){xShift=xadvance/2}else{xShift=0}xShift+=outline;yShift+=outline;i=iCharAll*2*4;inputMapping[i+0]=-lineHeight/6-xShift-margin;inputMapping[i+1]=lineHeight-yShift+margin;inputMapping[i+2]=-lineHeight/6-xShift-margin;inputMapping[i+3]=0-1.2*yShift-margin;inputMapping[i+4]=xadvance+lineHeight/6-xShift+2*outline+margin;inputMapping[i+5]=lineHeight-yShift+margin;inputMapping[i+6]=xadvance+lineHeight/6-xShift+2*outline+margin;inputMapping[i+7]=0-1.2*yShift-margin;inputTexCoord[i+0]=10;inputTexCoord[i+2]=10;inputTexCoord[i+4]=10;inputTexCoord[i+6]=10;iCharAll+=1;xadvance=0;for(iChar=0;iChar<nChar;++iChar,++iCharAll){c=ta.getTextMetrics(txt[iChar]);i=iCharAll*2*4;inputMapping[i+0]=xadvance-xShift;inputMapping[i+1]=c.h-yShift;inputMapping[i+2]=xadvance-xShift;inputMapping[i+3]=0-yShift;inputMapping[i+4]=xadvance+c.w-xShift;inputMapping[i+5]=c.h-yShift;inputMapping[i+6]=xadvance+c.w-xShift;inputMapping[i+7]=0-yShift;var texWidth=ta.params.width;var texHeight=ta.params.height;inputTexCoord[i+0]=c.x/texWidth;inputTexCoord[i+1]=c.y/texHeight;inputTexCoord[i+2]=c.x/texWidth;inputTexCoord[i+3]=(c.y+c.h)/texHeight;inputTexCoord[i+4]=(c.x+c.w)/texWidth;inputTexCoord[i+5]=c.y/texHeight;inputTexCoord[i+6]=(c.x+c.w)/texWidth;inputTexCoord[i+7]=(c.y+c.h)/texHeight;xadvance+=c.w-2*outline}}}function makeIndexBuffer(state){var buffer=new Uint32Array(state.quadCount*2*3);var o=0;for(var i=0;i<state.quadCount;i++){buffer[o++]=4*i;buffer[o++]=4*i+1;buffer[o++]=4*i+2;buffer[o++]=4*i+1;buffer[o++]=4*i+3;buffer[o++]=4*i+2}return buffer}})(Geometry=Labels.Geometry||(Labels.Geometry={}))})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Labels;(function(Labels){var Material;(function(Material){Material.VERTEX_SHADER="\nuniform float xOffset;\nuniform float yOffset;\nuniform float zOffset;\nuniform float sizeFactor;\n\nvarying vec2 texCoord;\n\nattribute vec2 mapping;\nattribute vec2 inputTexCoord;\nattribute float inputSize;\n\n"+Visualization.THREE.ShaderChunk["color_pars_vertex"]+"\n"+Visualization.THREE.ShaderChunk["common"]+"\n\nfloat matrixScale( in mat4 m ){\n    vec4 r = m[ 0 ];\n    return sqrt( r[ 0 ] * r[ 0 ] + r[ 1 ] * r[ 1 ] + r[ 2 ] * r[ 2 ] );\n}\n\nvoid main(void){\n\n    "+Visualization.THREE.ShaderChunk["color_vertex"]+"\n\n    texCoord = inputTexCoord;\n\n    float scale = matrixScale( modelViewMatrix );\n\n    float _zOffset = zOffset * scale;\n    if( texCoord.x == 10.0 ){\n         _zOffset -= 0.001;\n    }\n\n    vec3 pos = position;\n    vec4 cameraPos = modelViewMatrix * vec4( pos, 1.0 );\n    vec4 cameraCornerPos = vec4( cameraPos.xyz, 1.0 );\n    cameraCornerPos.xy += mapping * inputSize * sizeFactor * 0.01 * scale;\n    cameraCornerPos.x += xOffset * scale;\n    cameraCornerPos.y += yOffset * scale;\n    cameraCornerPos.xyz += normalize( -cameraCornerPos.xyz ) * _zOffset;\n\n    gl_Position = projectionMatrix * cameraCornerPos;\n    //gl_Position.xyz = position.xyz;\n}\n";Material.FRAGMENT_SHADER="\n#extension GL_OES_standard_derivatives : enable\n\nuniform sampler2D fontTexture;\nuniform vec3 outlineColor;\nuniform float outlineWidth;\nuniform vec3 backgroundColor;\nuniform float backgroundOpacity;\n\nvarying vec2 texCoord;\n\n"+Visualization.THREE.ShaderChunk["common"]+"\n"+Visualization.THREE.ShaderChunk["color_pars_fragment"]+"\n"+Visualization.THREE.ShaderChunk["fog_pars_fragment"]+"\n\nconst float smoothness = 16.0;\nconst float gamma = 2.2;\n\nvoid main(){\n    vec4 finalColor;\n\n    if( texCoord.x > 1.0 ){\n        if (backgroundOpacity < 0.05) discard;\n        finalColor = vec4( backgroundColor, backgroundOpacity );\n    }else{\n        // retrieve signed distance\n        float sdf = texture2D( fontTexture, texCoord ).a + outlineWidth;\n\n        // perform adaptive anti-aliasing of the edges\n        float w = clamp(\n            smoothness * ( abs( dFdx( texCoord.x ) ) + abs( dFdy( texCoord.y ) ) ),\n            0.0,\n            0.5\n        );\n        float a = smoothstep( 0.5 - w, 0.5 + w, sdf );\n\n        // gamma correction for linear attenuation\n        a = pow( a, 1.0 / gamma );\n        if( a < 0.2 ) discard;\n        //a *= opacity;\n\n        vec3 outgoingLight = vColor;\n        if( outlineWidth > 0.0 && sdf < ( 0.5 + outlineWidth ) ){\n            outgoingLight = outlineColor;\n        }\n\n        finalColor = vec4( outgoingLight, a );    \n    }\n\n    //gl_FragColor = finalColor;\n    vec3 outgoingLight = finalColor.rgb;\n\n    "+Visualization.THREE.ShaderChunk["fog_fragment"]+"\n    \n    #ifdef USE_FOG\n       float alpha = (1.0 - fogFactor) * finalColor.a;\n       if (alpha < 0.05) discard;\n       gl_FragColor = vec4( outgoingLight.rgb, alpha );\n    #else\n      gl_FragColor = finalColor;\n    #endif\n}\n"})(Material=Labels.Material||(Labels.Material={}))})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Labels;(function(Labels){var Material;(function(Material){"use strict";function create(texture){var uniforms=Visualization.THREE.UniformsUtils.merge([Visualization.THREE.UniformsLib["common"],Visualization.THREE.UniformsLib["fog"],{fontTexture:{type:"t",value:texture},xOffset:{type:"f",value:0},yOffset:{type:"f",value:0},zOffset:{type:"f",value:0},sizeFactor:{type:"f",value:1},outlineWidth:{type:"f",value:0},outlineColor:{type:"v3",value:new Visualization.THREE.Vector3(0,0,0)},backgroundColor:{type:"v3",value:new Visualization.THREE.Vector3(0,0,0)},backgroundOpacity:{type:"f",value:.5}}]);uniforms.fontTexture.value=texture;var ret=new Visualization.THREE.ShaderMaterial({uniforms:uniforms,attributes:{mapping:{type:"v2",value:null},inputTexCoord:{type:"v2",value:null},inputSize:{type:"f",value:null}},lights:false,fog:true,vertexShader:Material.VERTEX_SHADER,fragmentShader:Material.FRAGMENT_SHADER,shading:Visualization.THREE.NoShading,side:Visualization.THREE.DoubleSide,vertexColors:Visualization.THREE.VertexColors,blending:Visualization.THREE.NormalBlending,transparent:false,wireframe:false,linewidth:1});return ret}Material.create=create})(Material=Labels.Material||(Labels.Material={}))})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Labels;(function(Labels){"use strict";Labels.DefaultLabelsOptions={fontFamily:"sans-serif",fontSize:32,fontStyle:"normal",fontWeight:"normal",useSDF:true,attachment:"middle-center",backgroundMargin:1};var Model=function(_super){__extends(Model,_super);function Model(){return _super!==null&&_super.apply(this,arguments)||this}Model.prototype.applySelectionInternal=function(indices,action){return false};Model.prototype.getPickElements=function(pickId){return[]};Model.prototype.highlightElement=function(pickId,highlight){return false};Model.prototype.highlightInternal=function(isOn){return false};Model.prototype.applyColoring=function(theme){var color=this.geometry.attributes.color.array;var o=0,t={r:.1,g:.1,b:.1};var i=0;for(var _i=0,_a=this.labels;_i<_a.length;_i++){var l=_a[_i];var count=l.length*4+4;theme.setElementColor(i,t);for(var j=0;j<count;j++){color[o++]=t.r;color[o++]=t.g;color[o++]=t.b}i++}this.geometry.attributes.color.needsUpdate=true};Model.prototype.applyThemeInternal=function(theme){this.applyColoring(theme);var backgroundColor=theme.colors.get("Background")||Visualization.Color.fromHexString("#333333");var backgroundOpacity=theme.variables.get("backgroundOpacity")!==void 0?theme.variables.get("backgroundOpacity"):.5;var outlineColor=theme.colors.get("Outline")||Visualization.Color.fromHexString("#222222");var outlineWidth=theme.variables.get("outlineWidth")?+theme.variables.get("outlineWidth"):0;var sizeFactor=theme.variables.get("sizeFactor")?+theme.variables.get("sizeFactor"):1;var uniforms=this.material.uniforms;uniforms.xOffset.value=theme.variables.get("xOffset")||0;uniforms.yOffset.value=theme.variables.get("yOffset")||0;uniforms.zOffset.value=theme.variables.get("zOffset")||0;uniforms.backgroundColor.value=new Visualization.THREE.Vector3(backgroundColor.r,backgroundColor.g,backgroundColor.b);uniforms.backgroundOpacity.value=backgroundOpacity;uniforms.outlineColor.value=new Visualization.THREE.Vector3(outlineColor.r,outlineColor.g,outlineColor.b);uniforms.outlineWidth.value=outlineWidth;uniforms.sizeFactor.value=sizeFactor;this.material.transparent=backgroundOpacity<1,this.material.fog=!theme.disableFog;this.material.needsUpdate=true};Model.create=function(entity,params){var _this=this;return LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var _a,geometry,texture,options,model;return __generator(this,function(_b){switch(_b.label){case 0:return[4,ctx.updateProgress("Creating labels geometry...")];case 1:_b.sent();_a=Labels.Geometry.create(params),geometry=_a.geometry,texture=_a.texture,options=_a.options;return[4,ctx.updateProgress("Creating labels model...")];case 2:_b.sent();model=new Model;model.options=options;model.labels=params.labels;model.geometry=geometry;model.material=Labels.Material.create(texture);model.entity=entity;model.object=new Visualization.THREE.Mesh(geometry,model.material);model.object.renderOrder=1;geometry.computeBoundingSphere();model.centroid=geometry.boundingSphere.center;model.radius=geometry.boundingSphere.radius+4;model.applyTheme(params.theme);model.disposeList=[geometry,model.material];return[2,model]}})})})};return Model}(Visualization.Model);Labels.Model=Model})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var BallsAndSticks;(function(BallsAndSticks){"use strict";BallsAndSticks.DefaultBallsAndSticksModelParameters={tessalation:3,atomRadius:function(){return.4},hideBonds:false,hideHydrogens:false,bondRadius:.15,customMaxBondLengths:void 0};var Model=function(_super){__extends(Model,_super);function Model(){return _super!==null&&_super.apply(this,arguments)||this}Model.prototype.applySelectionInternal=function(indices,action){var buffer=this.ballsAndSticks.vertexStateBuffer,array=buffer.array,map=this.ballsAndSticks.atomVertexMap,vertexRanges=map.vertexRanges,changed=false;for(var _i=0,indices_11=indices;_i<indices_11.length;_i++){var index=indices_11[_i];if(!map.elementMap.has(index))continue;var indexOffset=map.elementMap.get(index),rangeStart=map.elementRanges[2*indexOffset],rangeEnd=map.elementRanges[2*indexOffset+1];if(rangeStart===rangeEnd)continue;for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];changed=Visualization.Selection.applyActionToRange(array,vStart,vEnd,action)||changed}}if(!changed)return false;buffer.needsUpdate=true;return true};Model.prototype.getPickElements=function(pickId){return[pickId]};Model.prototype.highlightElement=function(pickId,highlight){return this.applySelection([pickId],highlight?3:4)};Model.prototype.highlightInternal=function(isOn){return Visualization.Selection.applyActionToBuffer(this.ballsAndSticks.vertexStateBuffer,isOn?3:4)};Model.prototype.applyThemeInternal=function(theme){var _this=this;var map=this.ballsAndSticks.atomVertexMap;Visualization.MaterialsHelper.applyColorToMap(map,this.ballsAndSticks.atomsGeometry.attributes.color,function(i,c){return _this.theme.setElementColor(i,c)});var bondColor=Visualization.Theme.getColor(theme,"Bond",Molecule.Colors.DefaultBondColor);Visualization.MaterialsHelper.applyColorToBuffer(this.ballsAndSticks.bondsGeometry.attributes.color,bondColor);Visualization.MaterialsHelper.updateMaterial(this.material,theme,this.object);Visualization.MaterialsHelper.updateMaterial(this.bondsMaterial,theme,this.object)};Model.prototype.createObjects=function(){var main=new Visualization.THREE.Object3D;main.add(new Visualization.THREE.Mesh(this.ballsAndSticks.atomsGeometry,this.material));main.add(new Visualization.THREE.Mesh(this.ballsAndSticks.bondsGeometry,this.bondsMaterial));var pick=new Visualization.THREE.Mesh(this.ballsAndSticks.pickGeometry,this.pickMaterial);return{main:main,pick:pick}};Model.create=function(entity,_a){var _this=this;var model=_a.model,atomIndices=_a.atomIndices,theme=_a.theme,params=_a.params,props=_a.props;return LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var geom,ret,obj;return __generator(this,function(_a){switch(_a.label){case 0:return[4,BallsAndSticks.buildGeometry(model,params,atomIndices,ctx)];case 1:geom=_a.sent();ret=new Model;ret.molecule=model;ret.ballsAndSticks=geom;ret.material=Visualization.MaterialsHelper.getMeshMaterial();ret.bondsMaterial=new Visualization.THREE.MeshPhongMaterial({specular:11184810,shininess:1,shading:Visualization.THREE.SmoothShading,side:Visualization.THREE.FrontSide,vertexColors:Visualization.THREE.VertexColors});ret.pickMaterial=Visualization.MaterialsHelper.getPickMaterial();ret.entity=entity;ret.ballsAndSticks.atomsGeometry.computeBoundingSphere();ret.centroid=ret.ballsAndSticks.atomsGeometry.boundingSphere.center;ret.radius=ret.ballsAndSticks.atomsGeometry.boundingSphere.radius;if(props)ret.props=props;obj=ret.createObjects();ret.object=obj.main;ret.applyTheme(theme);ret.disposeList.push(ret.ballsAndSticks,ret.material,ret.bondsMaterial,ret.pickMaterial);ret.pickObject=obj.pick;ret.pickBufferAttributes=[ret.ballsAndSticks.pickGeometry.attributes.pColor];return[2,ret]}})})})};return Model}(Visualization.Model);BallsAndSticks.Model=Model})(BallsAndSticks=Molecule.BallsAndSticks||(Molecule.BallsAndSticks={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var BallsAndSticks;(function(BallsAndSticks){"use strict";var Geom=LiteMol.Core.Geometry;var Vec3=Geom.LinearAlgebra.Vector3;var Mat4=Geom.LinearAlgebra.Matrix4;var GB=Visualization.Geometry.Builder;function isHydrogen(n){return n==="H"||n==="D"||n==="T"}function getAtomCount(model,atomIndices,params){var es=model.data.atoms.elementSymbol;var hideHydrogens=params.hideHydrogens;var atomCount=0;if(hideHydrogens){for(var _i=0,atomIndices_2=atomIndices;_i<atomIndices_2.length;_i++){var aI=atomIndices_2[_i];if(!isHydrogen(es[aI])){atomCount++}}}else{atomCount=atomIndices.length}return atomCount}function getBondsInfo(model,atomIndices,params){var bonds=LiteMol.Core.Structure.computeBonds(model,atomIndices,{maxHbondLength:params.customMaxBondLengths&&params.customMaxBondLengths.has("H")?params.customMaxBondLengths.get("H"):1.15});var metalDashFactor=1/(2*.15);var es=model.data.atoms.elementSymbol;var hideHydrogens=params.hideHydrogens;var covalentStickCount=0,dashPartCount=0;var type=bonds.type,count=bonds.count,atomAIndex=bonds.atomAIndex,atomBIndex=bonds.atomBIndex;var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;for(var i=0;i<count;i++){var t=type[i];var a=atomAIndex[i],b=atomBIndex[i];if(hideHydrogens&&(isHydrogen(es[a])||isHydrogen(es[b]))){continue}if(t===0||t===5)covalentStickCount+=1;else if(t>=1&&t<=4)covalentStickCount+=t;else if(t===6||t===7||t===8){var dx=x[a]-x[b],dy=y[a]-y[b],dz=z[a]-z[b];var len=Math.sqrt(dx*dx+dy*dy+dz*dz);dashPartCount+=Math.ceil(metalDashFactor*len)}}return{bonds:bonds,covalentStickCount:covalentStickCount,dashPartCount:dashPartCount}}var BondModelState=function(){function BondModelState(bondTemplate,builder){this.bondTemplate=bondTemplate;this.builder=builder;this.rotationAxis=Vec3.zero();this.bondUpVector=Vec3.fromValues(1,0,0);this.dir=Vec3.zero();this.scale=Vec3.zero();this.translation=Vec3.zero();this.rotation=Mat4.zero();this.offset=Vec3.zero();this.a=Vec3.zero();this.b=Vec3.zero()}return BondModelState}();var Templates;(function(Templates){var bondCache={};function getBond(tessalation){if(bondCache[tessalation])return bondCache[tessalation];var detail;switch(tessalation){case 0:detail=2;break;case 1:detail=4;break;case 2:detail=6;break;case 3:detail=8;break;case 4:detail=10;break;case 5:detail=12;break;default:detail=14;break}var geom=new Visualization.THREE.TubeGeometry(new Visualization.THREE.LineCurve3(new Visualization.THREE.Vector3(0,0,0),new Visualization.THREE.Vector3(1,0,0)),2,1,detail);var ret=Visualization.GeometryHelper.toRawGeometry(geom);bondCache[tessalation]=ret;return ret}Templates.getBond=getBond;var atomCache={};function getAtom(tessalation){if(atomCache[tessalation])return atomCache[tessalation];var base,radius=1;switch(tessalation){case 0:base=new Visualization.THREE.OctahedronGeometry(radius,0);break;case 1:base=new Visualization.THREE.OctahedronGeometry(radius,1);break;case 2:base=new Visualization.THREE.IcosahedronGeometry(radius,0);break;case 3:base=new Visualization.THREE.IcosahedronGeometry(radius,1);break;case 4:base=new Visualization.THREE.IcosahedronGeometry(radius,2);break;case 5:base=new Visualization.THREE.OctahedronGeometry(radius,3);break;default:base=new Visualization.THREE.IcosahedronGeometry(radius,3);break}var ret=Visualization.GeometryHelper.toRawGeometry(base);atomCache[tessalation]=ret;return ret}Templates.getAtom=getAtom})(Templates||(Templates={}));var BuildState=function(){function BuildState(model,atomIndices,params){this.model=model;this.atomIndices=atomIndices;this.params=params;this.tessalation=this.params.tessalation;this.atomRadius=this.params.atomRadius;this.bondRadius=this.params.bondRadius;this.hideBonds=this.params.hideBonds;this.bondTemplate=Templates.getBond(this.tessalation);this.atomTemplate=Templates.getAtom(this.tessalation);this.dashTemplate=GB.getDashTemplate();this.atomCount=getAtomCount(this.model,this.atomIndices,this.params);this.atomVertexCount=this.atomTemplate.vertexCount*this.atomCount;this.atomBuilder=GB.createStatic(this.atomVertexCount,this.atomTemplate.indexCount*this.atomCount);this.atomColors=new Float32Array(this.atomVertexCount*3);this.atomPickColors=new Float32Array(this.atomVertexCount*4);this.atoms=this.model.data.atoms;this.positions=this.model.positions;this.cX=this.positions.x;this.cY=this.positions.y;this.cZ=this.positions.z;this.atomSymbols=this.atoms.elementSymbol;this.residueIndex=this.atoms.residueIndex;this.scale=Vec3.zero();this.translation=Vec3.zero();this.pickColor={r:.1,g:.1,b:.1};this.pickOffset=0;this.atomMapBuilder=new Visualization.Selection.VertexMapBuilder(this.atomIndices.length);this.bs=void 0}return BuildState}();var BondsBuildState=function(){function BondsBuildState(state){this.state=state;this.info=getBondsInfo(this.state.model,this.state.atomIndices,this.state.params);this.bondVertexCount=this.state.bondTemplate.vertexCount*this.info.covalentStickCount+this.state.dashTemplate.vertexCount*this.info.dashPartCount;this.bondBuilder=GB.createStatic(this.bondVertexCount,this.state.bondTemplate.indexCount*this.info.covalentStickCount+this.state.dashTemplate.indexCount*this.info.dashPartCount);this.bondColors=new Float32Array(this.bondVertexCount*3);this.bondRadius=this.state.params.bondRadius;this.bondState=new BondModelState(this.state.bondTemplate,this.bondBuilder);this.bondCount=this.info.bonds.count}return BondsBuildState}();var BallsAndSticksGeometryBuilder=function(){function BallsAndSticksGeometryBuilder(){}BallsAndSticksGeometryBuilder.prototype.dispose=function(){this.atomsGeometry.dispose();this.bondsGeometry.dispose();this.pickGeometry.dispose()};BallsAndSticksGeometryBuilder.addAtom=function(a,state){state.atomMapBuilder.startElement(a);var r=state.atomRadius(a);Vec3.set(state.scale,r,r,r);Vec3.set(state.translation,state.cX[a],state.cY[a],state.cZ[a]);var startVertexOffset=state.atomBuilder.vertices.elementCount;GB.addRawTransformed(state.atomBuilder,state.atomTemplate,state.scale,state.translation,void 0);Visualization.Selection.Picking.assignPickColor(a,state.pickColor);for(var i=0,_b=state.atomTemplate.vertexCount;i<_b;i++){state.atomPickColors[state.pickOffset++]=state.pickColor.r;state.atomPickColors[state.pickOffset++]=state.pickColor.g;state.atomPickColors[state.pickOffset++]=state.pickColor.b;state.pickOffset++}state.atomMapBuilder.addVertexRange(startVertexOffset,state.atomBuilder.vertices.elementCount);state.atomMapBuilder.endElement()};BallsAndSticksGeometryBuilder.addBond=function(b,state,bs){var aI=bs.info.bonds.atomAIndex[b],bI=bs.info.bonds.atomBIndex[b],type=bs.info.bonds.type[b];if(state.params.hideHydrogens){var es=state.model.data.atoms.elementSymbol;if(isHydrogen(es[aI])||isHydrogen(es[bI])){return}}Vec3.set(bs.bondState.a,state.cX[aI],state.cY[aI],state.cZ[aI]);Vec3.set(bs.bondState.b,state.cX[bI],state.cY[bI],state.cZ[bI]);var r=+bs.bondRadius,o=2*r/3,h=r/2;var bondState=bs.bondState;switch(type){case 0:case 1:case 5:BallsAndSticksGeometryBuilder.addBondPart(r,0,0,bondState);break;case 2:BallsAndSticksGeometryBuilder.addBondPart(h,o,o,bondState);BallsAndSticksGeometryBuilder.addBondPart(h,-o,-o,bondState);break;case 3:BallsAndSticksGeometryBuilder.addBondPart(h,0,o,bondState);var c=Math.cos(Math.PI/3)*o,s=Math.sin(Math.PI/3)*o;BallsAndSticksGeometryBuilder.addBondPart(h,-c,-s,bondState);BallsAndSticksGeometryBuilder.addBondPart(h,-c,s,bondState);break;case 4:BallsAndSticksGeometryBuilder.addBondPart(h/2,o,o,bondState);BallsAndSticksGeometryBuilder.addBondPart(h/2,-o,-o,bondState);BallsAndSticksGeometryBuilder.addBondPart(h/2,-o,o,bondState);BallsAndSticksGeometryBuilder.addBondPart(h/2,o,-o,bondState);break;case 6:case 7:case 8:BallsAndSticksGeometryBuilder.addDashedBond(h,bondState);break}};BallsAndSticksGeometryBuilder.addBondPart=function(r,oX,oY,state){var dir=Vec3.sub(state.dir,state.b,state.a);var length=Vec3.magnitude(state.dir);Vec3.set(state.scale,length,r,r);Vec3.makeRotation(state.rotation,state.bondUpVector,dir);state.offset[0]=0;state.offset[1]=oX;state.offset[2]=oY;Vec3.transformMat4(state.offset,state.offset,state.rotation);Vec3.add(state.offset,state.offset,state.a);GB.addRawTransformed(state.builder,state.bondTemplate,state.scale,state.offset,state.rotation)};BallsAndSticksGeometryBuilder.addDashedBond=function(r,state){GB.addDashedLine(state.builder,state.a,state.b,.15,.15,r)};BallsAndSticksGeometryBuilder.getEmptyBondsGeometry=function(){var bondsGeometry=new Visualization.THREE.BufferGeometry;bondsGeometry.addAttribute("position",new Visualization.THREE.BufferAttribute(new Float32Array(0),3));bondsGeometry.addAttribute("normal",new Visualization.THREE.BufferAttribute(new Float32Array(0),3));bondsGeometry.addAttribute("index",new Visualization.THREE.BufferAttribute(new Uint32Array(0),1));bondsGeometry.addAttribute("color",new Visualization.THREE.BufferAttribute(new Float32Array(0),3));return bondsGeometry};BallsAndSticksGeometryBuilder.getBondsGeometry=function(state){var geom=GB.toBufferGeometry(state.bondBuilder);Visualization.Geometry.addAttribute(geom,"color",state.bondColors,3);return geom};BallsAndSticksGeometryBuilder.getAtomsGeometry=function(state){var atomsGeometry=GB.toBufferGeometry(state.atomBuilder);Visualization.Geometry.addAttribute(atomsGeometry,"color",state.atomColors,3);var stateBuffer=new Float32Array(state.atomVertexCount);var vertexStateBuffer=new Visualization.THREE.BufferAttribute(stateBuffer,1);atomsGeometry.addAttribute("vState",vertexStateBuffer);var atomsPickGeometry=new Visualization.THREE.BufferGeometry;atomsPickGeometry.addAttribute("position",atomsGeometry.getAttribute("position"));atomsPickGeometry.addAttribute("index",atomsGeometry.getAttribute("index"));atomsPickGeometry.addAttribute("pColor",new Visualization.THREE.BufferAttribute(state.atomPickColors,4));return{vertexStateBuffer:vertexStateBuffer,atomsGeometry:atomsGeometry,atomsPickGeometry:atomsPickGeometry,atomVertexMap:state.atomMapBuilder.getMap()}};BallsAndSticksGeometryBuilder.addAtoms=function(state,ctx){return __awaiter(this,void 0,void 0,function(){var chunkSize,started,elementSymbol,hideHydrogens,start,_l,i,_b,aI,t;return __generator(this,function(_a){switch(_a.label){case 0:chunkSize=2500;started=LiteMol.Core.Utils.PerformanceMonitor.currentTime();elementSymbol=state.model.data.atoms.elementSymbol;hideHydrogens=state.params.hideHydrogens;start=0,_l=state.atomIndices.length;_a.label=1;case 1:if(!(start<_l))return[3,4];for(i=start,_b=Math.min(start+chunkSize,state.atomIndices.length);i<_b;i++){aI=state.atomIndices[i];if(hideHydrogens&&isHydrogen(elementSymbol[aI])){continue}BallsAndSticksGeometryBuilder.addAtom(aI,state)}t=LiteMol.Core.Utils.PerformanceMonitor.currentTime();if(!(t-started>LiteMol.Core.Computation.UpdateProgressDelta))return[3,3];started=t;return[4,ctx.updateProgress("Adding atoms...",true,start,_l)];case 2:_a.sent();_a.label=3;case 3:start+=chunkSize;return[3,1];case 4:return[2]}})})};BallsAndSticksGeometryBuilder.addBondsChunks=function(state,bs,ctx){return __awaiter(this,void 0,void 0,function(){var chunkSize,started,start,i,_b,t;return __generator(this,function(_a){switch(_a.label){case 0:chunkSize=2500;started=LiteMol.Core.Utils.PerformanceMonitor.currentTime();start=0;_a.label=1;case 1:if(!(start<bs.bondCount))return[3,4];for(i=start,_b=Math.min(start+chunkSize,bs.bondCount);i<_b;i++){BallsAndSticksGeometryBuilder.addBond(i,state,bs)}t=LiteMol.Core.Utils.PerformanceMonitor.currentTime();if(!(t-started>LiteMol.Core.Computation.UpdateProgressDelta))return[3,3];started=t;return[4,ctx.updateProgress("Adding bonds...",true,start,bs.bondCount)];case 2:_a.sent();_a.label=3;case 3:start+=chunkSize;return[3,1];case 4:return[2]}})})};BallsAndSticksGeometryBuilder.addBonds=function(state,ctx){return __awaiter(this,void 0,void 0,function(){var bs;return __generator(this,function(_a){switch(_a.label){case 0:if(state.params.hideBonds){return[2]}return[4,ctx.updateProgress("Computing bonds...",true)];case 1:_a.sent();bs=new BondsBuildState(state);state.bs=bs;return[4,BallsAndSticksGeometryBuilder.addBondsChunks(state,bs,ctx)];case 2:_a.sent();return[2]}})})};BallsAndSticksGeometryBuilder.build=function(model,parameters,atomIndices,ctx){return __awaiter(this,void 0,void 0,function(){var state,ret,atomGeometry;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Creating atoms...")];case 1:_a.sent();state=new BuildState(model,atomIndices,LiteMol.Core.Utils.extend({},parameters,BallsAndSticks.DefaultBallsAndSticksModelParameters));return[4,BallsAndSticksGeometryBuilder.addAtoms(state,ctx)];case 2:_a.sent();return[4,BallsAndSticksGeometryBuilder.addBonds(state,ctx)];case 3:_a.sent();return[4,ctx.updateProgress("Finalizing...")];case 4:_a.sent();ret=new BallsAndSticksGeometry;if(state.bs){ret.bondsGeometry=BallsAndSticksGeometryBuilder.getBondsGeometry(state.bs)}else{ret.bondsGeometry=BallsAndSticksGeometryBuilder.getEmptyBondsGeometry()}atomGeometry=BallsAndSticksGeometryBuilder.getAtomsGeometry(state);ret.vertexStateBuffer=atomGeometry.vertexStateBuffer;ret.atomsGeometry=atomGeometry.atomsGeometry;ret.pickGeometry=atomGeometry.atomsPickGeometry;ret.atomVertexMap=atomGeometry.atomVertexMap;return[2,ret]}})})};return BallsAndSticksGeometryBuilder}();function buildGeometry(model,parameters,atomIndices,ctx){return BallsAndSticksGeometryBuilder.build(model,parameters,atomIndices,ctx)}BallsAndSticks.buildGeometry=buildGeometry;var BallsAndSticksGeometry=function(_super){__extends(BallsAndSticksGeometry,_super);function BallsAndSticksGeometry(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.atomsGeometry=void 0;_this.bondsGeometry=void 0;_this.pickGeometry=void 0;_this.atomVertexMap=void 0;_this.vertexStateBuffer=void 0;return _this}BallsAndSticksGeometry.prototype.dispose=function(){this.atomsGeometry.dispose();this.bondsGeometry.dispose();this.pickGeometry.dispose()};return BallsAndSticksGeometry}(Visualization.GeometryBase);BallsAndSticks.BallsAndSticksGeometry=BallsAndSticksGeometry})(BallsAndSticks=Molecule.BallsAndSticks||(Molecule.BallsAndSticks={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var Cartoons;(function(Cartoons){var Geometry;(function(Geometry){var Data=function(_super){__extends(Data,_super);function Data(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.geometry=void 0;_this.pickGeometry=void 0;_this.gapsGeometry=void 0;_this.vertexMap=void 0;_this.vertexStateBuffer=void 0;return _this}Data.prototype.dispose=function(){this.geometry.dispose();this.pickGeometry.dispose();if(this.gapsGeometry){this.gapsGeometry.dispose()}};return Data}(Visualization.GeometryBase);Geometry.Data=Data;function create(model,atomIndices,linearSegments,parameters,isTrace,computation){return __awaiter(this,void 0,void 0,function(){var params,ctx,ret,_i,_a,k;return __generator(this,function(_b){switch(_b.label){case 0:params=LiteMol.Core.Utils.extend({},parameters,Geometry.CartoonsGeometryParams.Default);ctx={computation:computation,model:model,atomIndices:atomIndices,linearSegments:linearSegments,parameters:parameters,isTrace:isTrace,params:params,state:new Geometry.CartoonsGeometryState(params,model.data.residues.count),units:void 0,strandArrays:void 0,strandTemplate:void 0,builder:new Geometry.Builder,geom:new Data};return[4,ctx.computation.updateProgress("Building units...")];case 1:_b.sent();ctx.units=Geometry.CartoonAsymUnit.buildUnits(ctx.model,ctx.atomIndices,ctx.linearSegments);return[4,Geometry.buildUnitsAsync(ctx)];case 2:_b.sent();if(ctx.strandTemplate)ctx.strandTemplate.geometry.dispose();ctx.geom.vertexMap=ctx.state.vertexMap.getMap();return[4,ctx.computation.updateProgress("Creating geometry...")];case 3:_b.sent();Geometry.createGeometry(ctx);ret=ctx.geom;for(_i=0,_a=Object.keys(ctx);_i<_a.length;_i++){k=_a[_i];if(!Object.prototype.hasOwnProperty.call(ctx,k))continue;ctx[k]=void 0}return[2,ret]}})})}Geometry.create=create})(Geometry=Cartoons.Geometry||(Cartoons.Geometry={}))})(Cartoons=Molecule.Cartoons||(Molecule.Cartoons={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var Cartoons;(function(Cartoons){var Geometry;(function(Geometry){var ArrayBuilder=LiteMol.Core.Utils.ArrayBuilder;var CartoonAsymUnit=function(){function CartoonAsymUnit(model,elements,linearSegmentCount){this.model=model;this.elements=elements;this.linearSegmentCount=linearSegmentCount;this.tempA=new Visualization.THREE.Vector3;this.tempB=new Visualization.THREE.Vector3;this.tempC=new Visualization.THREE.Vector3;this.controlPoints=new Float32Array(0);this.torsionVectors=new Float32Array(0);this.normalVectors=new Float32Array(0);this.residueCount=0;this.structureStarts=LiteMol.Core.Utils.FastSet.create();this.structureEnds=LiteMol.Core.Utils.FastSet.create();this.residueType=[];this.residueIndex=new Int32Array(0);this.backboneOnly=false;this.startResidueIndex=-1;this.endResidueIndex=-1;for(var _i=0,_a=this.elements;_i<_a.length;_i++){var e=_a[_i];this.residueCount+=e.endResidueIndex-e.startResidueIndex}this.startResidueIndex=this.elements[0].startResidueIndex;this.endResidueIndex=this.elements[this.elements.length-1].endResidueIndex-1;var builder=new ContolPointsBuilder(this.residueCount);this.controlPointsBuilder=ArrayBuilder.forVertex3D(this.residueCount*this.linearSegmentCount+1);this.torsionVectorsBuilder=ArrayBuilder.forVertex3D(this.residueCount*this.linearSegmentCount+1);this.normalVectorsBuilder=ArrayBuilder.forVertex3D(this.residueCount*this.linearSegmentCount+1);this.createControlPoints(builder)}CartoonAsymUnit.prototype.createControlPoints=function(builder){this.initPositions(builder);this.initControlsPoints(builder);this.computeSplines(builder);this.controlPoints=this.controlPointsBuilder.array;this.torsionVectors=this.torsionVectorsBuilder.array;this.normalVectors=this.normalVectorsBuilder.array;this.controlPointsBuilder=null;this.torsionVectorsBuilder=null;this.normalVectorsBuilder=null};CartoonAsymUnit.prototype.initPositions=function(builder){var residues=this.model.data.residues,atoms=this.model.data.atoms,positions=this.model.positions,arrays={atomStartIndex:residues.atomStartIndex,atomEndIndex:residues.atomEndIndex,name:atoms.name,x:positions.x,y:positions.y,z:positions.z},residueType=[],offset=0,i=0;for(var _i=0,_a=this.elements;_i<_a.length;_i++){var e=_a[_i];this.structureStarts.add(e.startResidueIndex);this.structureEnds.add(e.endResidueIndex-1);for(i=e.startResidueIndex;i<e.endResidueIndex;i++){this.backboneOnly=builder.addResidue(i,arrays,e.type);residueType[residueType.length]=e.type}}this.residueIndex=new Int32Array(this.residueCount);for(var _d=0,_e=this.elements;_d<_e.length;_d++){var e=_e[_d];for(i=e.startResidueIndex;i<e.endResidueIndex;i++){this.residueIndex[offset++]=i}}this.residueType=residueType;builder.finishResidues();var len=this.residueCount;builder.residueType[0]=builder.residueType[2];builder.residueType[1]=builder.residueType[3];builder.residueType[builder.residueType.length-2]=builder.residueType[builder.residueType.length-4];builder.residueType[builder.residueType.length-1]=builder.residueType[builder.residueType.length-3];if(len>2){var a=2,b=3,c=4;if(builder.residueType[0]!==5){this.reflectPositions(builder.uPositions,0,1,a,b,b,c,.4,.6);this.reflectPositions(builder.vPositions,0,1,a,b,b,c,.4,.6)}else{this.reflectPositions(builder.uPositions,1,0,a,b,b,c,.5,.5);this.reflectPositions(builder.vPositions,1,0,a,b,b,c,.5,.5)}a=len+1;b=len;c=len-1;if(builder.residueType[len-1]!==5){this.reflectPositions(builder.uPositions,len+2,len+3,a,b,b,c,.4,.6);this.reflectPositions(builder.vPositions,len+2,len+3,a,b,b,c,.4,.6)}else{this.reflectPositions(builder.uPositions,len+2,len+3,a,b,b,c,.5,.5);this.reflectPositions(builder.vPositions,len+2,len+3,a,b,b,c,.5,.5)}}else if(len===2){for(i=0;i<2;i++){builder.uPositions[3*i]=builder.uPositions[6];builder.uPositions[3*i+1]=builder.uPositions[7];builder.uPositions[3*i+2]=builder.uPositions[8];builder.vPositions[3*i]=builder.vPositions[6];builder.vPositions[3*i+1]=builder.vPositions[7];builder.vPositions[3*i+2]=builder.vPositions[8];builder.uPositions[(len+2)*3+3*i]=builder.uPositions[(len+1)*3];builder.uPositions[(len+2)*3+3*i+1]=builder.uPositions[(len+1)*3+1];builder.uPositions[(len+2)*3+3*i+2]=builder.uPositions[(len+1)*3+2];builder.vPositions[(len+2)*3+3*i]=builder.vPositions[(len+1)*3];builder.vPositions[(len+2)*3+3*i+1]=builder.vPositions[(len+1)*3+1];builder.vPositions[(len+2)*3+3*i+2]=builder.vPositions[(len+1)*3+2]}}else{var d=[builder.uPositions[6]-builder.vPositions[6],builder.uPositions[7]-builder.vPositions[7],builder.uPositions[8]-builder.vPositions[8]];for(var i_3=0;i_3<2;i_3++){for(var j=0;j<3;j++){builder.uPositions[3*i_3+j]=builder.uPositions[6+j]-.5*(i_3+1)*d[j];builder.uPositions[9+3*i_3+j]=builder.uPositions[6+j]+.5*(i_3+1)*d[j];builder.vPositions[3*i_3+j]=builder.vPositions[6+j]+.5*(i_3+1)*d[j];builder.vPositions[9+3*i_3+j]=builder.vPositions[6+j]-.5*(i_3+1)*d[j]}}}};CartoonAsymUnit.prototype.initControlsPoints=function(builder){var previousD=new Visualization.THREE.Vector3,len=builder.uvLength-1,a=new Visualization.THREE.Vector3,b=new Visualization.THREE.Vector3,c=new Visualization.THREE.Vector3,d=new Visualization.THREE.Vector3,ca1=new Visualization.THREE.Vector3,o1=new Visualization.THREE.Vector3,ca2=new Visualization.THREE.Vector3,p=new Visualization.THREE.Vector3,helixType=1;for(var i=0;i<len;i++){ca1.set(builder.uPositions[3*i],builder.uPositions[3*i+1],builder.uPositions[3*i+2]);o1.set(builder.vPositions[3*i],builder.vPositions[3*i+1],builder.vPositions[3*i+2]);i++;ca2.set(builder.uPositions[3*i],builder.uPositions[3*i+1],builder.uPositions[3*i+2]);i--;p.set((ca1.x+ca2.x)/2,(ca1.y+ca2.y)/2,(ca1.z+ca2.z)/2);a.subVectors(ca2,ca1);b.subVectors(o1,ca1);c.crossVectors(a,b);d.crossVectors(c,a);c.normalize();d.normalize();if(builder.residueType[i]===helixType&&builder.residueType[i+1]===helixType){p.set(p.x+1.5*c.x,p.y+1.5*c.y,p.z+1.5*c.z)}if(i>0&&d.angleTo(previousD)>Math.PI/2){d.negate()}previousD.copy(d);a.addVectors(p,d);builder.addControlPoint(p,a)}builder.finishContols()};CartoonAsymUnit.prototype.computeSplines=function(builder){var previousControlPoint=new Visualization.THREE.Vector3,controlPoint=new Visualization.THREE.Vector3,torsionPoint=new Visualization.THREE.Vector3,len=builder.residueCount,pPositions=builder.pPositions,dPositions=builder.dPositions,p1=new Visualization.THREE.Vector3,p2=new Visualization.THREE.Vector3,p3=new Visualization.THREE.Vector3,p4=new Visualization.THREE.Vector3,d1=new Visualization.THREE.Vector3,d2=new Visualization.THREE.Vector3,d3=new Visualization.THREE.Vector3,d4=new Visualization.THREE.Vector3,previousTorsionPoint=new Visualization.THREE.Vector3,extrapolatedControlPoint=new Visualization.THREE.Vector3;for(var i=0;i<len;i++){p1.set(pPositions[3*i],pPositions[3*i+1],pPositions[3*i+2]);i++;p2.set(pPositions[3*i],pPositions[3*i+1],pPositions[3*i+2]);i++;p3.set(pPositions[3*i],pPositions[3*i+1],pPositions[3*i+2]);i++;p4.set(pPositions[3*i],pPositions[3*i+1],pPositions[3*i+2]);i=i-3;d1.set(dPositions[3*i],dPositions[3*i+1],dPositions[3*i+2]);i++;d2.set(dPositions[3*i],dPositions[3*i+1],dPositions[3*i+2]);i++;d3.set(dPositions[3*i],dPositions[3*i+1],dPositions[3*i+2]);i++;d4.set(dPositions[3*i],dPositions[3*i+1],dPositions[3*i+2]);i=i-3;for(var j=1;j<=this.linearSegmentCount;j++){var t=j*1/this.linearSegmentCount;if(t<.5){CartoonAsymUnit.spline(controlPoint,p1,p2,p3,t+.5);CartoonAsymUnit.spline(torsionPoint,d1,d2,d3,t+.5)}else{CartoonAsymUnit.spline(controlPoint,p2,p3,p4,t-.5);CartoonAsymUnit.spline(torsionPoint,d2,d3,d4,t-.5)}if(i===0&&j===1){CartoonAsymUnit.spline(previousControlPoint,p1,p2,p3,.5);CartoonAsymUnit.spline(previousTorsionPoint,d1,d2,d3,.5);CartoonAsymUnit.reflect(extrapolatedControlPoint,previousControlPoint,controlPoint,1);this.addSplineNode(extrapolatedControlPoint,previousControlPoint,previousTorsionPoint)}this.addSplineNode(previousControlPoint,controlPoint,torsionPoint);previousControlPoint.copy(controlPoint)}}};CartoonAsymUnit.prototype.addSplineNode=function(previousControlPoint,controlPoint,torsionPoint){ArrayBuilder.add3(this.controlPointsBuilder,controlPoint.x,controlPoint.y,controlPoint.z);var torsionVector=this.tempA.subVectors(torsionPoint,controlPoint);torsionVector.normalize();ArrayBuilder.add3(this.torsionVectorsBuilder,torsionVector.x,torsionVector.y,torsionVector.z);var controlVector=this.tempB.subVectors(controlPoint,previousControlPoint);var normalVector=this.tempC.crossVectors(torsionVector,controlVector);normalVector.normalize();ArrayBuilder.add3(this.normalVectorsBuilder,normalVector.x,normalVector.y,normalVector.z)};CartoonAsymUnit.prototype.reflectPositions=function(xs,u,v,a,b,c,d,r1,r2){this.tempA.set(xs[3*a],xs[3*a+1],xs[3*a+2]);this.tempB.set(xs[3*b],xs[3*b+1],xs[3*b+2]);CartoonAsymUnit.reflect(this.tempC,this.tempA,this.tempB,r1);xs[3*u]=this.tempC.x;xs[3*u+1]=this.tempC.y;xs[3*u+2]=this.tempC.z;this.tempA.set(xs[3*c],xs[3*c+1],xs[3*c+2]);this.tempB.set(xs[3*d],xs[3*d+1],xs[3*d+2]);CartoonAsymUnit.reflect(this.tempC,this.tempA,this.tempB,r2);xs[3*v]=this.tempC.x;xs[3*v+1]=this.tempC.y;xs[3*v+2]=this.tempC.z};return CartoonAsymUnit}();Geometry.CartoonAsymUnit=CartoonAsymUnit;(function(CartoonAsymUnit){function reflect(target,p1,p2,amount){target.set(p1.x-amount*(p2.x-p1.x),p1.y-amount*(p2.y-p1.y),p1.z-amount*(p2.z-p1.z))}CartoonAsymUnit.reflect=reflect;function spline(target,p1,p2,p3,t){var a=Math.pow(1-t,2)/2;var c=Math.pow(t,2)/2;var b=1-a-c;var x=a*p1.x+b*p2.x+c*p3.x;var y=a*p1.y+b*p2.y+c*p3.y;var z=a*p1.z+b*p2.z+c*p3.z;target.set(x,y,z)}CartoonAsymUnit.spline=spline;function maskSplit(element,mask,target){var current=element,start=element.startResidueIndex,end=element.endResidueIndex;for(var i=start;i<end;i++){if(!mask[i])continue;if(current.startResidueIndex!==i){current=new LiteMol.Core.Structure.SecondaryStructureElement(element.type,element.startResidueId,element.endResidueId);current.startResidueIndex=i}while(i<end&&mask[i]){i++}current.endResidueIndex=i;target[target.length]=current}}CartoonAsymUnit.maskSplit=maskSplit;function isCartoonLike(atomIndices,start,end,name,a,b,isAmk){var aU=false,aV=false,hasP=false;for(var i=start;i<end;i++){var n=name[atomIndices[i]];if(!aU&&n===a){aU=true}else if(!aV&&n===b){aV=true}if(aU&&aV)return true;if(n==="P"){hasP=true}}if(isAmk)return aU;return hasP}CartoonAsymUnit.isCartoonLike=isCartoonLike;function createMask(model,atomIndices){var ret=new Uint8Array(model.data.residues.count);var _a=model.data.atoms,residueIndex=_a.residueIndex,name=_a.name;var ssIndex=model.data.residues.secondaryStructureIndex;var ss=model.data.secondaryStructure;for(var i=0,_b=atomIndices.length-1;i<_b;i++){var aI=atomIndices[i];var rStart=i;var residue=residueIndex[aI];i++;while(residue===residueIndex[atomIndices[i]])i++;var s=ss[ssIndex[residue]].type;if(s===0)continue;if(s===5){ret[residue]=+CartoonAsymUnit.isCartoonLike(atomIndices,rStart,i,name,"O5'","C3'",false)}else{ret[residue]=+CartoonAsymUnit.isCartoonLike(atomIndices,rStart,i,name,"CA","O",true)}i--}return ret}CartoonAsymUnit.createMask=createMask;function isUnknownSecondaryStructure(model){var hasSeq=false;for(var _i=0,_a=model.data.secondaryStructure;_i<_a.length;_i++){var e=_a[_i];if(e.type===1||e.type===3||e.type===2){return false}if(e.type===4){hasSeq=true}}return hasSeq}function approximateSecondaryStructure(model,parent){if(parent.type!==4)return[parent];var elements=[];var name=model.data.atoms.name;var _a=model.data.residues,atomStartIndex=_a.atomStartIndex,atomEndIndex=_a.atomEndIndex;var trace=new Int32Array(parent.endResidueIndex-parent.startResidueIndex),offset=0;var isOk=true;for(var i=parent.startResidueIndex,_b=parent.endResidueIndex;i<_b;i++){var foundCA=false,foundO=false;for(var j=atomStartIndex[i],_c=atomEndIndex[i];j<_c;j++){if(name[j]==="CA"){if(!foundCA)trace[offset++]=j;foundCA=true}else if(name[j]==="O"){foundO=true}if(foundO&&foundCA)break}if(!foundCA||!foundO){isOk=false;break}}if(!isOk)return[parent];zhangSkolnickSStrace(model,trace,parent,elements);return elements}var ZhangHelixDistance=[5.45,5.18,6.37];var ZhangHelixDelta=2.1;var ZhangSheetDistance=[6.1,10.4,13];var ZhangSheetDelta=1.42;var ZhangP1=new Visualization.THREE.Vector3(0,0,0);var ZhangP2=new Visualization.THREE.Vector3(0,0,0);function zhangSkolnickSStrace(model,trace,parent,elements){var mask=new Int32Array(trace.length);var hasSS=false;var residueIndex=model.data.atoms.residueIndex;for(var i=0,_l=trace.length;i<_l;i++){if(zhangSkolnickSSresidue(model,trace,i,ZhangHelixDistance,ZhangHelixDelta)){mask[i]=1;hasSS=true}else if(zhangSkolnickSSresidue(model,trace,i,ZhangSheetDistance,ZhangSheetDelta)){mask[i]=3;hasSS=true}else{mask[i]=parent.type}}if(!hasSS){elements.push(parent);return}for(var i=0,_l=mask.length;i<_l;i++){var m=mask[i];if(m===parent.type)continue;var j=i+1;while(j<_l&&m===mask[j]){j++}if(j-i>1){i=j-1;continue}for(var k=i;k<j;k++)mask[k]=parent.type;i=j-1}for(var i=0,_l=mask.length;i<_l;i++){var m=mask[i];var j=i+1;while(j<_l&&m===mask[j]){j++}var e=new LiteMol.Core.Structure.SecondaryStructureElement(m,new LiteMol.Core.Structure.PolyResidueIdentifier("",i,null),new LiteMol.Core.Structure.PolyResidueIdentifier("",j,null));e.startResidueIndex=residueIndex[trace[i]];e.endResidueIndex=residueIndex[trace[j-1]]+1;elements.push(e);i=j-1}}function zhangSkolnickSSresidue(model,trace,i,distances,delta){var len=trace.length;var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;var u=ZhangP1,v=ZhangP2;for(var j=Math.max(0,i-2);j<=i;j++){for(var k=2;k<5;k++){if(j+k>=len){continue}var a=trace[j],b=trace[j+k];u.set(x[a],y[a],z[a]);v.set(x[b],y[b],z[b]);if(Math.abs(u.distanceTo(v)-distances[k-2])>delta){return false}}}return true}function throwIfEmpty(ss){if(ss.length===0){throw"Cartoons cannot be constructred from this model/selection."}}function buildUnits(model,atomIndices,linearSegmentCount){var mask=createMask(model,atomIndices);var ss=[];var isUnknownSS=isUnknownSecondaryStructure(model);for(var _i=0,_a=model.data.secondaryStructure;_i<_a.length;_i++){var e=_a[_i];if(isUnknownSS){var approx=approximateSecondaryStructure(model,e);for(var _d=0,approx_1=approx;_d<approx_1.length;_d++){var f=approx_1[_d];CartoonAsymUnit.maskSplit(f,mask,ss)}}else{CartoonAsymUnit.maskSplit(e,mask,ss)}}throwIfEmpty(ss);var previous=ss[0],asymId=model.data.residues.asymId,authSeqNumber=model.data.residues.authSeqNumber,currentElements=[],units=[],none=0;if(previous.type===none){previous=null}for(var _e=0,ss_2=ss;_e<ss_2.length;_e++){var e=ss_2[_e];if(e.type===none){if(currentElements.length>0){units.push(new CartoonAsymUnit(model,currentElements,linearSegmentCount))}previous=null;currentElements=[]}else{if(previous===null)previous=e;if(asymId[previous.endResidueIndex-1]!==asymId[e.startResidueIndex]||previous!==e&&authSeqNumber[e.startResidueIndex]-authSeqNumber[previous.endResidueIndex-1]>1||previous.startResidueIndex!==e.startResidueIndex&&e.startResidueIndex-previous.endResidueIndex>0){if(currentElements.length>0){units.push(new CartoonAsymUnit(model,currentElements,linearSegmentCount))}else if(previous!==null){units.push(new CartoonAsymUnit(model,[previous],linearSegmentCount))}previous=null;currentElements=[e]}else{currentElements[currentElements.length]=e}}previous=e}if(currentElements.length>0){units.push(new CartoonAsymUnit(model,currentElements,linearSegmentCount))}return units}CartoonAsymUnit.buildUnits=buildUnits})(CartoonAsymUnit=Geometry.CartoonAsymUnit||(Geometry.CartoonAsymUnit={}));var ContolPointsBuilder=function(){function ContolPointsBuilder(residueCount){this.typeBuilder=ArrayBuilder.forArray(1e4);this.residueType=[];this.uPositions=new Float32Array(0);this.vPositions=new Float32Array(0);this.pPositions=new Float32Array(0);this.dPositions=new Float32Array(0);this.uvLength=0;this.residueCount=0;this.typeBuilder=ArrayBuilder.forArray(residueCount+4);this.uPositionsBuilder=ArrayBuilder.forVertex3D(residueCount+4);this.vPositionsBuilder=ArrayBuilder.forVertex3D(residueCount+4);this.pPositionsBuilder=ArrayBuilder.forVertex3D(residueCount+4);this.dPositionsBuilder=ArrayBuilder.forVertex3D(residueCount+4);ArrayBuilder.add(this.typeBuilder,0);ArrayBuilder.add(this.typeBuilder,0);ArrayBuilder.add3(this.uPositionsBuilder,0,0,0);ArrayBuilder.add3(this.uPositionsBuilder,0,0,0);ArrayBuilder.add3(this.vPositionsBuilder,0,0,0);ArrayBuilder.add3(this.vPositionsBuilder,0,0,0)}ContolPointsBuilder.prototype.addResidue=function(rIndex,arrays,sType){var start=arrays.atomStartIndex[rIndex],end=arrays.atomEndIndex[rIndex],aU=false,aV=false;var name=arrays.name;if(sType!==5){for(var i=start;i<end;i++){if(!aU&&name[i]==="CA"){ArrayBuilder.add3(this.uPositionsBuilder,arrays.x[i],arrays.y[i],arrays.z[i]);aU=true}else if(!aV&&name[i]==="O"){ArrayBuilder.add3(this.vPositionsBuilder,arrays.x[i],arrays.y[i],arrays.z[i]);aV=true}if(aU&&aV)break}}else{if(end-start===1){ArrayBuilder.add3(this.uPositionsBuilder,arrays.x[start],arrays.y[start],arrays.z[start]);aU=true}else{var pIndex=-1;for(var i=start;i<end;i++){if(!aU&&name[i]==="O5'"){ArrayBuilder.add3(this.uPositionsBuilder,arrays.x[i],arrays.y[i],arrays.z[i]);aU=true}else if(!aV&&name[i]==="C3'"){ArrayBuilder.add3(this.vPositionsBuilder,arrays.x[i],arrays.y[i],arrays.z[i]);aV=true}if(name[i]==="P"){pIndex=i}if(aU&&aV)break}if(!aU&&!aV&&pIndex>=0){ArrayBuilder.add3(this.uPositionsBuilder,arrays.x[pIndex],arrays.y[pIndex],arrays.z[pIndex]);aU=true}}}var backboneOnly=false;if(!aV){var arr=this.uPositionsBuilder.array,len=arr.length;ArrayBuilder.add3(this.vPositionsBuilder,arr[len-3],arr[len-2],arr[len-1]);backboneOnly=true}else if(!aU){var arr=this.vPositionsBuilder.array,len=arr.length;ArrayBuilder.add3(this.uPositionsBuilder,arr[len-3],arr[len-2],arr[len-1]);backboneOnly=true}ArrayBuilder.add(this.typeBuilder,sType);return backboneOnly};ContolPointsBuilder.prototype.finishResidues=function(){ArrayBuilder.add(this.typeBuilder,0);ArrayBuilder.add(this.typeBuilder,0);ArrayBuilder.add3(this.uPositionsBuilder,0,0,0);ArrayBuilder.add3(this.uPositionsBuilder,0,0,0);ArrayBuilder.add3(this.vPositionsBuilder,0,0,0);ArrayBuilder.add3(this.vPositionsBuilder,0,0,0);this.residueType=this.typeBuilder.array;this.uPositions=this.uPositionsBuilder.array;this.vPositions=this.vPositionsBuilder.array;this.typeBuilder=null;this.uPositionsBuilder=null;this.vPositionsBuilder=null;this.uvLength=this.residueType.length;this.residueCount=this.uvLength-4};ContolPointsBuilder.prototype.addControlPoint=function(p,d){ArrayBuilder.add3(this.pPositionsBuilder,p.x,p.y,p.z);ArrayBuilder.add3(this.dPositionsBuilder,d.x,d.y,d.z)};ContolPointsBuilder.prototype.finishContols=function(){this.pPositions=this.pPositionsBuilder.array;this.dPositions=this.dPositionsBuilder.array;this.pPositionsBuilder=null;this.dPositionsBuilder=null};return ContolPointsBuilder}()})(Geometry=Cartoons.Geometry||(Cartoons.Geometry={}))})(Cartoons=Molecule.Cartoons||(Molecule.Cartoons={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var Cartoons;(function(Cartoons){var Geometry;(function(Geometry){var CartoonsGeometryParams=function(){function CartoonsGeometryParams(){this.radialSegmentCount=10;this.turnWidth=.1;this.strandWidth=.15;this.strandLineWidth=.1;this.helixWidth=1.1;this.helixHeight=.1;this.sheetWidth=1.1;this.sheetHeight=.1;this.arrowWidth=1.7;this.tessalation=2}CartoonsGeometryParams.Default=new CartoonsGeometryParams;return CartoonsGeometryParams}();Geometry.CartoonsGeometryParams=CartoonsGeometryParams;var GB=Visualization.Geometry.Builder;var CartoonsGeometryState=function(){function CartoonsGeometryState(params,residueCount){this.params=params;this.residueCount=residueCount;this.residueIndex=0;this.builder=GB.createDynamic(this.residueCount*8,this.residueCount*16);this.vs=this.builder.vertices;this.is=this.builder.indices;this.gapsBuilder=GB.createDynamic(256,512);this.translationMatrix=new Visualization.THREE.Matrix4;this.scaleMatrix=new Visualization.THREE.Matrix4;this.rotationMatrix=new Visualization.THREE.Matrix4;this.invMatrix=new Visualization.THREE.Matrix4;this.vertexMap=new Visualization.Selection.VertexMapBuilder(residueCount)}Object.defineProperty(CartoonsGeometryState.prototype,"verticesDone",{get:function(){return this.vs.elementCount},enumerable:true,configurable:true});Object.defineProperty(CartoonsGeometryState.prototype,"trianglesDone",{get:function(){return this.is.elementCount},enumerable:true,configurable:true});CartoonsGeometryState.prototype.addVertex=function(v,n){GB.addVertex3d(this.builder,v.x,v.y,v.z);GB.addNormal3d(this.builder,n.x,n.y,n.z)};CartoonsGeometryState.prototype.addTriangle=function(i,j,k){GB.addIndex3d(this.builder,i,j,k)};CartoonsGeometryState.prototype.addTriangles=function(i,j,k,u,v,w){GB.addIndex3d(this.builder,i,j,k);GB.addIndex3d(this.builder,u,v,w)};return CartoonsGeometryState}();Geometry.CartoonsGeometryState=CartoonsGeometryState;function makeStrandLineTemplate(ctx){var radius=ctx.params.strandLineWidth,tessalation=ctx.params.tessalation;var capPoints=0,radiusPoints=0,geom;switch(tessalation){case 0:radiusPoints=2;capPoints=1;break;case 1:radiusPoints=3;capPoints=2;break;case 2:radiusPoints=4;capPoints=2;break;case 3:radiusPoints=8;capPoints=4;break;case 4:radiusPoints=10;capPoints=6;break;case 5:radiusPoints=14;capPoints=6;break;default:radiusPoints=16;capPoints=8;break}var arc=[],delta=Math.PI/2/capPoints;for(var i=0;i<=capPoints;i++){arc[i]=new Visualization.THREE.Vector3(0,radius*Math.cos(i*delta),.1*Math.sin(i*delta));arc[i].z+=.9}geom=new Visualization.THREE.LatheGeometry([new Visualization.THREE.Vector3(0,radius,0)].concat(arc),radiusPoints,Math.PI);var templ=Visualization.GeometryHelper.getIndexedBufferGeometry(geom);ctx.strandTemplate={vertex:templ.attributes.position.array,normal:templ.attributes.normal.array,index:templ.attributes.index.array,geometry:templ};var atoms=ctx.model.data.atoms,residues=ctx.model.data.residues;var positions=ctx.model.positions;ctx.strandArrays={startIndex:residues.atomStartIndex,endIndex:residues.atomEndIndex,x:positions.x,y:positions.y,z:positions.z,name:atoms.name}}function buildUnit(unit,ctx){var state=ctx.state,params=ctx.params;var builder=ctx.builder;for(var index=0,_max=unit.residueCount;index<_max;index++){state.vertexMap.startElement(unit.residueIndex[index]);var numVertices=state.verticesDone;state.residueIndex=index;var start=unit.structureStarts.has(unit.residueIndex[index]);var end=unit.structureEnds.has(unit.residueIndex[index]);if(ctx.isTrace||unit.backboneOnly){switch(unit.residueType[index]){case 5:builder.addTube(unit,state,params.strandWidth,params.strandWidth);if(start||end){builder.addTubeCap(unit,state,params.strandWidth,params.strandWidth,start,end)}if(!ctx.strandTemplate){makeStrandLineTemplate(ctx)}builder.addStrandLine(unit,state,ctx.strandTemplate,ctx.strandArrays,unit.residueIndex[index]);break;default:builder.addTube(unit,state,params.turnWidth,params.turnWidth);if(start||end){builder.addTubeCap(unit,state,params.turnWidth,params.turnWidth,start,end)}break}}else{switch(unit.residueType[index]){case 1:builder.addTube(unit,state,params.helixWidth,params.helixHeight);if(start){builder.addTubeCap(unit,state,params.helixWidth,params.helixHeight,true,false)}else if(end){builder.addTubeCap(unit,state,params.helixWidth,params.helixHeight,false,true)}break;case 3:builder.addSheet(unit,state,start,end);if(start||end){builder.addSheetCap(unit,state,start,end)}break;case 5:builder.addTube(unit,state,params.strandWidth,params.strandWidth);if(start||end){builder.addTubeCap(unit,state,params.strandWidth,params.strandWidth,start,end)}if(!ctx.strandTemplate){makeStrandLineTemplate(ctx)}builder.addStrandLine(unit,state,ctx.strandTemplate,ctx.strandArrays,unit.residueIndex[index]);break;default:builder.addTube(unit,state,params.turnWidth,params.turnWidth);if(start||end){builder.addTubeCap(unit,state,params.turnWidth,params.turnWidth,start,end)}break}}state.vertexMap.addVertexRange(numVertices,state.verticesDone);state.vertexMap.endElement()}}Geometry.buildUnit=buildUnit;function isGap(ctx,a,b){var chainIndex=ctx.model.data.residues.chainIndex;return chainIndex[a.endResidueIndex]===chainIndex[b.endResidueIndex]}var Vec3=LiteMol.Core.Geometry.LinearAlgebra.Vector3;function renderGap(ctx,unitA,unitB){var aL=unitA.controlPoints.length;var cpA=unitA.controlPoints,cpB=unitB.controlPoints;var a=Vec3.fromValues(cpA[aL-3],cpA[aL-2],cpA[aL-1]),b=Vec3.fromValues(cpB[0],cpB[1],cpB[2]);var r=ctx.state.params.turnWidth/2;GB.addDashedLine(ctx.state.gapsBuilder,a,b,.5,.5,r)}function buildUnitsAsync(ctx){return __awaiter(this,void 0,void 0,function(){var chunkSize,started,unitIndex,residuesDone,t,i;return __generator(this,function(_a){switch(_a.label){case 0:chunkSize=1e4;started=LiteMol.Core.Utils.PerformanceMonitor.currentTime();unitIndex=0;_a.label=1;case 1:if(!(unitIndex<ctx.units.length))return[3,4];residuesDone=0;while(residuesDone<chunkSize&&unitIndex<ctx.units.length){buildUnit(ctx.units[unitIndex],ctx);residuesDone+=ctx.units[unitIndex].residueCount;unitIndex++}t=LiteMol.Core.Utils.PerformanceMonitor.currentTime();if(!(t-started>LiteMol.Core.Computation.UpdateProgressDelta))return[3,3];started=t;return[4,ctx.computation.updateProgress("Building units...",true,unitIndex,ctx.units.length)];case 2:_a.sent();_a.label=3;case 3:return[3,1];case 4:for(i=0;i<ctx.units.length-1;i++){if(isGap(ctx,ctx.units[i],ctx.units[i+1])){renderGap(ctx,ctx.units[i],ctx.units[i+1])}}return[2]}})})}Geometry.buildUnitsAsync=buildUnitsAsync;function createGeometry(ctx){var state=ctx.state;var colorBuffer=new Float32Array(state.verticesDone*3),pickColorBuffer=new Float32Array(state.verticesDone*4),stateBuffer=new Float32Array(state.verticesDone);var geometry=GB.toBufferGeometry(state.builder);geometry.addAttribute("color",new Visualization.THREE.BufferAttribute(colorBuffer,3));ctx.geom.vertexStateBuffer=new Visualization.THREE.BufferAttribute(stateBuffer,1);geometry.addAttribute("vState",ctx.geom.vertexStateBuffer);ctx.geom.geometry=geometry;if(state.gapsBuilder.vertices.elementCount){ctx.geom.gapsGeometry=GB.toBufferGeometry(state.gapsBuilder)}var map=ctx.geom.vertexMap,color={r:.45,g:.45,b:.45},vertexRanges=map.vertexRanges;for(var _i=0,_a=map.elementIndices;_i<_a.length;_i++){var elementIndex=_a[_i];var elementOffset=map.elementMap.get(elementIndex);var rangeStart=map.elementRanges[2*elementOffset],rangeEnd=map.elementRanges[2*elementOffset+1];if(rangeStart===rangeEnd)continue;Visualization.Selection.Picking.assignPickColor(elementIndex,color);for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];for(var j=vStart;j<vEnd;j++){pickColorBuffer[j*4]=color.r;pickColorBuffer[j*4+1]=color.g;pickColorBuffer[j*4+2]=color.b}}}var pickGeometry=new Visualization.THREE.BufferGeometry;pickGeometry.addAttribute("position",geometry.getAttribute("position"));pickGeometry.addAttribute("index",geometry.getAttribute("index"));pickGeometry.addAttribute("pColor",new Visualization.THREE.BufferAttribute(pickColorBuffer,4));ctx.geom.pickGeometry=pickGeometry}Geometry.createGeometry=createGeometry;var Builder=function(){function Builder(){this.tempVectors=[new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3,new Visualization.THREE.Vector3]}Builder.prototype.setVector=function(data,i,v){v.set(data[3*i],data[3*i+1],data[3*i+2]);return v};Builder.prototype.addTube=function(element,state,width,height){var verticesDone=state.verticesDone,i=0,j=0,radialVector=this.tempVectors[0],normalVector=this.tempVectors[1],tempPos=this.tempVectors[2],a=this.tempVectors[3],b=this.tempVectors[4],u=this.tempVectors[5],v=this.tempVectors[6],elementOffsetStart=state.residueIndex*element.linearSegmentCount,elementOffsetEnd=elementOffsetStart+element.linearSegmentCount,elementPoints=element.controlPoints,elementPointsCount=element.linearSegmentCount+1,torsionVectors=element.torsionVectors,normalVectors=element.normalVectors,radialSegmentCount=state.params.radialSegmentCount;for(i=elementOffsetStart;i<=elementOffsetEnd;i++){this.setVector(torsionVectors,i,u);this.setVector(normalVectors,i,v);for(j=0;j<radialSegmentCount;j++){var t=2*Math.PI*j/radialSegmentCount;a.copy(u);b.copy(v);radialVector.addVectors(a.multiplyScalar(width*Math.cos(t)),b.multiplyScalar(height*Math.sin(t)));a.copy(u);b.copy(v);normalVector.addVectors(a.multiplyScalar(height*Math.cos(t)),b.multiplyScalar(width*Math.sin(t)));normalVector.normalize();this.setVector(elementPoints,i,tempPos);tempPos.add(radialVector);state.addVertex(tempPos,normalVector)}}for(i=0;i<elementPointsCount-1;i++){for(j=0;j<radialSegmentCount;j++){state.addTriangles(verticesDone+i*radialSegmentCount+j,verticesDone+(i+1)*radialSegmentCount+(j+1)%radialSegmentCount,verticesDone+i*radialSegmentCount+(j+1)%radialSegmentCount,verticesDone+i*radialSegmentCount+j,verticesDone+(i+1)*radialSegmentCount+j,verticesDone+(i+1)*radialSegmentCount+(j+1)%radialSegmentCount)}}};Builder.prototype.addTubeCap=function(element,state,width,height,isStart,isEnd){var verticesDone=state.verticesDone,t,radialVector=this.tempVectors[0],normalVector=this.tempVectors[1],a=this.tempVectors[2],b=this.tempVectors[3],u=this.tempVectors[4],v=this.tempVectors[5],tA=this.tempVectors[6],tB=this.tempVectors[7],elementOffsetStart=state.residueIndex*element.linearSegmentCount,elementPoints=element.controlPoints,elementPointsCount=element.linearSegmentCount+1,torsionVectors=element.torsionVectors,normalVectors=element.normalVectors,radialSegmentCount=state.params.radialSegmentCount;this.setVector(torsionVectors,elementOffsetStart,tA);this.setVector(normalVectors,elementOffsetStart,tB);normalVector.crossVectors(tA,tB);if(isEnd){normalVector.negate()}var offset=elementOffsetStart+(isStart?0:elementPointsCount-1);this.setVector(elementPoints,offset,radialVector);state.addVertex(radialVector,normalVector);this.setVector(torsionVectors,offset,u);this.setVector(normalVectors,offset,v);for(var i=0;i<radialSegmentCount;i++){t=2*Math.PI*i/radialSegmentCount;a.copy(u);b.copy(v);radialVector.addVectors(a.multiplyScalar(Math.cos(t)*width),b.multiplyScalar(Math.sin(t)*height));this.setVector(elementPoints,offset,tA);radialVector.add(tA);state.addVertex(radialVector,normalVector);if(isStart){state.addTriangle(verticesDone,verticesDone+i+1,verticesDone+(i+1)%radialSegmentCount+1)}else{state.addTriangle(verticesDone,verticesDone+(i+1)%radialSegmentCount+1,verticesDone+i+1)}}};Builder.prototype.addSheet=function(element,state,isStart,isEnd){var verticesDone=state.verticesDone,params=state.params,i=0,j=0,horizontalVector=this.tempVectors[0],verticalVector=this.tempVectors[1],positionVector=this.tempVectors[2],normalOffset=this.tempVectors[3],normalVector=this.tempVectors[4],temp=this.tempVectors[5],tA=this.tempVectors[7],tB=this.tempVectors[8],torsionVector=this.tempVectors[9],elementOffsetStart=state.residueIndex*element.linearSegmentCount,elementOffsetEnd=elementOffsetStart+element.linearSegmentCount,elementPoints=element.controlPoints,torsionVectors=element.torsionVectors,normalVectors=element.normalVectors,offsetLength=0,actualWidth=0;normalOffset.set(0,0,0);if(isEnd){this.setVector(elementPoints,elementOffsetEnd,tA);this.setVector(elementPoints,elementOffsetStart,tB);offsetLength=params.arrowWidth/temp.subVectors(tA,tB).length()}for(i=elementOffsetStart;i<=elementOffsetEnd;i++){actualWidth=!isEnd?params.sheetWidth:params.arrowWidth*(1-(i-elementOffsetStart)/element.linearSegmentCount);this.setVector(torsionVectors,i,horizontalVector);horizontalVector.multiplyScalar(actualWidth);this.setVector(normalVectors,i,verticalVector);verticalVector.multiplyScalar(params.sheetHeight);if(isEnd){this.setVector(normalVectors,i,tA);this.setVector(torsionVectors,i,tB);normalOffset.crossVectors(tA,tB).multiplyScalar(offsetLength)}this.setVector(elementPoints,i,positionVector);this.setVector(normalVectors,i,normalVector);this.setVector(torsionVectors,i,torsionVector);tA.copy(positionVector).add(horizontalVector).add(verticalVector);tB.copy(normalVector);state.addVertex(tA,tB);tA.copy(positionVector).sub(horizontalVector).add(verticalVector);state.addVertex(tA,tB);tA.copy(positionVector).sub(horizontalVector).add(verticalVector);tB.copy(torsionVector).negate().add(normalOffset);state.addVertex(tA,tB);tA.copy(positionVector).sub(horizontalVector).sub(verticalVector);state.addVertex(tA,tB);tA.copy(positionVector).sub(horizontalVector).sub(verticalVector);tB.copy(normalVector).negate();state.addVertex(tA,tB);tA.copy(positionVector).add(horizontalVector).sub(verticalVector);state.addVertex(tA,tB);tA.copy(positionVector).add(horizontalVector).sub(verticalVector);tB.copy(torsionVector).add(normalOffset);state.addVertex(tA,tB);tA.copy(positionVector).add(horizontalVector).add(verticalVector);state.addVertex(tA,tB)}for(i=0;i<element.linearSegmentCount;i++){for(j=0;j<4;j++){state.addTriangles(verticesDone+i*8+2*j,verticesDone+(i+1)*8+2*j+1,verticesDone+i*8+2*j+1,verticesDone+i*8+2*j,verticesDone+(i+1)*8+2*j,verticesDone+(i+1)*8+2*j+1)}}};Builder.prototype.addSheetCap=function(element,state,isStart,isEnd){var params=state.params,elementOffsetStart=state.residueIndex*element.linearSegmentCount,elementPoint=this.setVector(element.controlPoints,elementOffsetStart,this.tempVectors[0]);var horizontalVector=this.setVector(element.torsionVectors,elementOffsetStart,this.tempVectors[1]).multiplyScalar(params.sheetWidth);var verticalVector=this.setVector(element.normalVectors,elementOffsetStart,this.tempVectors[2]).multiplyScalar(params.sheetHeight);var p1=this.tempVectors[3].addVectors(elementPoint,horizontalVector).add(verticalVector),p2=this.tempVectors[4].subVectors(elementPoint,horizontalVector).add(verticalVector),p3=this.tempVectors[5].subVectors(elementPoint,horizontalVector).sub(verticalVector),p4=this.tempVectors[6].addVectors(elementPoint,horizontalVector).sub(verticalVector);if(isStart){this.addSheepCapSection(state,p1,p2,p3,p4)}else{var arrowHorizontalVector=this.setVector(element.torsionVectors,elementOffsetStart,this.tempVectors[7]).multiplyScalar(params.arrowWidth);var p5=this.tempVectors[8].addVectors(elementPoint,arrowHorizontalVector).add(verticalVector),p6=this.tempVectors[9].subVectors(elementPoint,arrowHorizontalVector).add(verticalVector),p7=this.tempVectors[10].subVectors(elementPoint,arrowHorizontalVector).sub(verticalVector),p8=this.tempVectors[11].addVectors(elementPoint,arrowHorizontalVector).sub(verticalVector);this.addSheepCapSection(state,p5,p1,p4,p8);this.addSheepCapSection(state,p2,p6,p7,p3)}};Builder.prototype.addSheepCapSection=function(state,p1,p2,p3,p4){var addedVerticesCount=state.verticesDone,normal=this.tempVectors[12].crossVectors(this.tempVectors[13].subVectors(p2,p1),this.tempVectors[14].subVectors(p4,p1)).normalize();state.addVertex(p1,normal);state.addVertex(p2,normal);state.addVertex(p3,normal);state.addVertex(p4,normal);state.addTriangles(addedVerticesCount,addedVerticesCount+1,addedVerticesCount+2,addedVerticesCount+2,addedVerticesCount+3,addedVerticesCount)};Builder.prototype.findN3=function(index,arrays,target){var start=arrays.startIndex[index],end=arrays.endIndex[index];var found=false;for(var i=start;i<end;i++){if(arrays.name[i]==="N3"){target.set(arrays.x[i],arrays.y[i],arrays.z[i]);found=true;break}}return found};Builder.prototype.addStrandLine=function(element,state,template,arrays,residueIndex){if(!this.findN3(residueIndex,arrays,this.tempVectors[3]))return;var p=this.tempVectors[0],n=this.tempVectors[1],i,vb=template.vertex,nb=template.normal,ib=template.index,vertexStart=state.verticesDone,vertexCount=vb.length,triangleCount=ib.length,elementOffset=state.residueIndex*element.linearSegmentCount+(.5*element.linearSegmentCount+1|0),elementPoint=this.setVector(element.controlPoints,elementOffset,this.tempVectors[2]),nDir=this.tempVectors[3].sub(elementPoint),length=nDir.length();nDir.normalize();state.translationMatrix.makeTranslation(elementPoint.x,elementPoint.y,elementPoint.z);state.scaleMatrix.makeScale(1,1,length);state.rotationMatrix.makeRotationAxis(new Visualization.THREE.Vector3(-nDir.y,nDir.x,0),Math.acos(nDir.z));state.translationMatrix.multiply(state.rotationMatrix).multiply(state.scaleMatrix);template.geometry.applyMatrix(state.translationMatrix);for(i=0;i<vertexCount;i+=3){p.set(vb[i],vb[i+1],vb[i+2]);n.set(nb[i],nb[i+1],nb[i+2]);state.addVertex(p,n)}for(i=0;i<triangleCount;i+=3){state.addTriangle(vertexStart+ib[i],vertexStart+ib[i+1],vertexStart+ib[i+2])}state.invMatrix.getInverse(state.translationMatrix);template.geometry.applyMatrix(state.invMatrix)};return Builder}();Geometry.Builder=Builder})(Geometry=Cartoons.Geometry||(Cartoons.Geometry={}))})(Cartoons=Molecule.Cartoons||(Molecule.Cartoons={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var Cartoons;(function(Cartoons){"use strict";var CartoonsModelType;(function(CartoonsModelType){CartoonsModelType[CartoonsModelType["Default"]=0]="Default";CartoonsModelType[CartoonsModelType["AlphaTrace"]=1]="AlphaTrace"})(CartoonsModelType=Cartoons.CartoonsModelType||(Cartoons.CartoonsModelType={}));Cartoons.DefaultCartoonsModelParameters={tessalation:3,drawingType:CartoonsModelType.Default};var Model=function(_super){__extends(Model,_super);function Model(){return _super!==null&&_super.apply(this,arguments)||this}Model.prototype.applySelectionInternal=function(indices,action){var buffer=this.cartoons.vertexStateBuffer,array=buffer.array,map=this.cartoons.vertexMap,vertexRanges=map.vertexRanges,changed=false,residueIndex=this.model.data.atoms.residueIndex;for(var a=0,_a=indices.length;a<_a;a++){var index=residueIndex[indices[a]];a++;while(residueIndex[indices[a]]===index){a++}a--;if(!map.elementMap.has(index))continue;var indexOffset=map.elementMap.get(index),rangeStart=map.elementRanges[2*indexOffset],rangeEnd=map.elementRanges[2*indexOffset+1];if(rangeStart===rangeEnd)continue;for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];changed=Visualization.Selection.applyActionToRange(array,vStart,vEnd,action)||changed}}if(!changed)return false;buffer.needsUpdate=true;return true};Model.prototype.getPickElements=function(pickId){var _c=this.model.data.residues,atomStartIndex=_c.atomStartIndex,atomEndIndex=_c.atomEndIndex;var elements=[];for(var i=atomStartIndex[pickId],_b=atomEndIndex[pickId];i<_b;i++){if(this.queryContext.hasAtom(i))elements.push(i)}return elements};Model.prototype.highlightElement=function(pickId,highlight){return this.applySelection([this.model.data.residues.atomStartIndex[pickId]],highlight?3:4)};Model.prototype.highlightInternal=function(isOn){return Visualization.Selection.applyActionToBuffer(this.cartoons.vertexStateBuffer,isOn?3:4)};Model.prototype.applyColoring=function(theme){var _c=this.model.data.residues,atomStartIndex=_c.atomStartIndex,atomEndIndex=_c.atomEndIndex;var color={r:.1,g:.1,b:.1};var avgColor={r:.1,g:.1,b:.1};var map=this.cartoons.vertexMap;var bufferAttribute=this.cartoons.geometry.attributes.color;var buffer=bufferAttribute.array;var vertexRanges=map.vertexRanges;for(var rI=0,_bRi=this.model.data.residues.count;rI<_bRi;rI++){avgColor.r=0;avgColor.g=0;avgColor.b=0;var count=0;for(var aI=atomStartIndex[rI],_bAi=atomEndIndex[rI];aI<_bAi;aI++){if(!this.queryContext.hasAtom(aI))continue;theme.setElementColor(aI,color);avgColor.r+=color.r;avgColor.g+=color.g;avgColor.b+=color.b;count++}if(!count)continue;color.r=avgColor.r/count;color.g=avgColor.g/count;color.b=avgColor.b/count;var elementOffset=map.elementMap.get(rI);var rangeStart=map.elementRanges[2*elementOffset],rangeEnd=map.elementRanges[2*elementOffset+1];if(rangeStart===rangeEnd)continue;for(var i=rangeStart;i<rangeEnd;i+=2){var vStart=vertexRanges[i],vEnd=vertexRanges[i+1];for(var j=vStart;j<vEnd;j++){buffer[j*3]=color.r,buffer[j*3+1]=color.g,buffer[j*3+2]=color.b}}}bufferAttribute.needsUpdate=true};Model.prototype.applyThemeInternal=function(theme){this.applyColoring(theme);Visualization.MaterialsHelper.updateMaterial(this.material,theme,this.object);Visualization.MaterialsHelper.updateMaterial(this.gapMaterial,theme,this.object)};Model.prototype.createObjects=function(){var main;if(this.cartoons.gapsGeometry){main=new Visualization.THREE.Object3D;main.add(new Visualization.THREE.Mesh(this.cartoons.geometry,this.material));main.add(new Visualization.THREE.Mesh(this.cartoons.gapsGeometry,this.gapMaterial))}else{main=new Visualization.THREE.Mesh(this.cartoons.geometry,this.material)}return{main:main,pick:new Visualization.THREE.Mesh(this.cartoons.pickGeometry,this.pickMaterial)}};Model.create=function(entity,_c){var _this=this;var model=_c.model,queryContext=_c.queryContext,atomIndices=_c.atomIndices,theme=_c.theme,params=_c.params,props=_c.props;return LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var linearSegments,radialSements,cartoons,ret,obj;return __generator(this,function(_c){switch(_c.label){case 0:linearSegments=0,radialSements=0;return[4,ctx.updateProgress("Computing cartoons...")];case 1:_c.sent();params=LiteMol.Core.Utils.extend({},params,Cartoons.DefaultCartoonsModelParameters);switch(params.tessalation){case 0:linearSegments=1;radialSements=2;break;case 1:linearSegments=4;radialSements=3;break;case 2:linearSegments=6;radialSements=5;break;case 3:linearSegments=10;radialSements=8;break;case 4:linearSegments=12;radialSements=10;break;case 5:linearSegments=16;radialSements=14;break;default:linearSegments=18;radialSements=16;break}return[4,Cartoons.Geometry.create(model,atomIndices,linearSegments,{radialSegmentCount:radialSements,tessalation:params.tessalation},params.drawingType===CartoonsModelType.AlphaTrace,ctx)];case 2:cartoons=_c.sent();ret=new Model;ret.cartoons=cartoons;ret.queryContext=queryContext;ret.material=Visualization.MaterialsHelper.getMeshMaterial();ret.gapMaterial=new Visualization.THREE.MeshPhongMaterial({color:7829367,shading:Visualization.THREE.FlatShading});ret.pickMaterial=Visualization.MaterialsHelper.getPickMaterial();if(props)ret.props=props;ret.entity=entity;ret.cartoons.geometry.computeBoundingSphere();ret.centroid=ret.cartoons.geometry.boundingSphere.center;ret.radius=ret.cartoons.geometry.boundingSphere.radius;obj=ret.createObjects();ret.object=obj.main;ret.pickObject=obj.pick;ret.pickBufferAttributes=[ret.cartoons.pickGeometry.attributes.pColor];ret.model=model;ret.applyTheme(theme);ret.disposeList.push(ret.cartoons,ret.material,ret.pickMaterial,ret.gapMaterial);return[2,ret]}})})})};return Model}(Visualization.Model);Cartoons.Model=Model})(Cartoons=Molecule.Cartoons||(Molecule.Cartoons={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Molecule;(function(Molecule){var Colors;(function(Colors){Colors.DefaultBondColor={r:.6,g:.6,b:.6};Colors.DefaultElementColor={r:.6,g:.6,b:.6};Colors.DefaultElementColorMap=LiteMol.Core.Utils.FastMap.create();Colors.DefaultPallete=[];(function(){var colors=[["Ac",.43921,.67058,.98039],["Al",.74901,.65098,.65098],["Am",.32941,.36078,.94901],["Sb",.6196,.38823,.7098],["Ar",.50196,.8196,.89019],["As",.74117,.50196,.89019],["At",.45882,.3098,.27058],["Ba",0,.78823,0],["Bk",.54117,.3098,.89019],["Be",.76078,1,0],["Bi",.6196,.3098,.7098],["Bh",.87843,0,.2196],["B",1,.7098,.7098],["Br",.65098,.16078,.16078],["Cd",1,.85098,.56078],["Ca",.23921,1,0],["Cf",.63137,.21176,.83137],["C",.45,.45,.45],["Ce",1,1,.78039],["Cs",.34117,.09019,.56078],["Cl",.12156,.94117,.12156],["Cr",.54117,.6,.78039],["Co",.94117,.5647,.62745],["Cu",.78431,.50196,.2],["Cm",.47058,.36078,.89019],["D",.9,.9,.9],["Db",.8196,0,.3098],["Dy",.12156,1,.78039],["Es",.70196,.12156,.83137],["Er",0,.90196,.45882],["Eu",.38039,1,.78039],["Fm",.70196,.12156,.72941],["F",.70196,1,1],["Fr",.25882,0,.4],["Gd",.27058,1,.78039],["Ga",.76078,.56078,.56078],["Ge",.4,.56078,.56078],["Au",1,.8196,.13725],["Hf",.30196,.76078,1],["Hs",.90196,0,.18039],["He",.85098,1,1],["Ho",0,1,.61176],["H",.9,.9,.9],["In",.65098,.45882,.45098],["I",.58039,0,.58039],["Ir",.09019,.32941,.52941],["Fe",.698,.13,.13],["Kr",.36078,.72156,.8196],["La",.43921,.83137,1],["Lr",.78039,0,.4],["Pb",.34117,.34901,.38039],["Li",.8,.50196,1],["Lu",0,.67058,.14117],["Mg",.54117,1,0],["Mn",.61176,.47843,.78039],["Mt",.92156,0,.14901],["Md",.70196,.05098,.65098],["Hg",.72156,.72156,.81568],["Mo",.32941,.7098,.7098],["Nd",.78039,1,.78039],["Ne",.70196,.89019,.96078],["Np",0,.50196,1],["Ni",.31372,.81568,.31372],["Nb",.45098,.76078,.78823],["N",0,.5,1],["No",.74117,.05098,.52941],["Os",.14901,.4,.58823],["O",1,.3,.3],["Pd",0,.41176,.52156],["P",1,.50196,0],["Pt",.81568,.81568,.87843],["Pu",0,.4196,1],["Po",.67058,.36078,0],["K",.56078,.25098,.83137],["Pr",.85098,1,.78039],["Pm",.63921,1,.78039],["Pa",0,.63137,1],["Ra",0,.49019,0],["Rn",.25882,.5098,.58823],["Re",.14901,.49019,.67058],["Rh",.03921,.49019,.54901],["Rb",.43921,.18039,.69019],["Ru",.14117,.56078,.56078],["Rf",.8,0,.34901],["Sm",.56078,1,.78039],["Sc",.90196,.90196,.90196],["Sg",.85098,0,.27058],["Se",1,.63137,0],["Si",.94117,.78431,.62745],["Ag",.75294,.75294,.75294],["Na",.67058,.36078,.94901],["Sr",0,1,0],["S",.9,.775,.25],["Ta",.30196,.65098,1],["Tc",.23137,.6196,.6196],["Te",.83137,.47843,0],["Tb",.18823,1,.78039],["Tl",.65098,.32941,.30196],["Th",0,.72941,1],["Tm",0,.83137,.32156],["Sn",.4,.50196,.50196],["Ti",.74901,.76078,.78039],["W",.12941,.58039,.83921],["U",0,.56078,1],["V",.65098,.65098,.67058],["Xe",.25882,.6196,.69019],["Yb",0,.74901,.2196],["Y",.58039,1,1],["Zn",.49019,.50196,.69019],["Zr",.58039,.87843,.87843]];for(var _i=0,colors_1=colors;_i<colors_1.length;_i++){var c=colors_1[_i];var n=c[0];var clr={r:c[1],g:c[2],b:c[3]};Colors.DefaultElementColorMap.set(n,clr);Colors.DefaultElementColorMap.set(n.toUpperCase(),clr);Colors.DefaultElementColorMap.set(n.toLowerCase(),clr);Colors.DefaultPallete.push(clr)}})()})(Colors=Molecule.Colors||(Molecule.Colors={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Primitive;(function(Primitive){"use strict";var LA=LiteMol.Core.Geometry.LinearAlgebra;function createSphereSurface(sphere){var _a=sphere.tessalation,tessalation=_a===void 0?0:_a;var geom=new Visualization.THREE.IcosahedronGeometry(1,tessalation);var surf=Visualization.GeometryHelper.toSurface(geom);geom.dispose();return surf}Primitive.createSphereSurface=createSphereSurface;function createTubeSurface(tube){var a=tube.a,b=tube.b,_a=tube.slices,slices=_a===void 0?12:_a;var geom=new Visualization.THREE.TubeGeometry(new Visualization.THREE.LineCurve3(new Visualization.THREE.Vector3(a[0],a[1],a[2]),new Visualization.THREE.Vector3(b[0],b[1],b[2])),2,tube.radius,slices);var surf=Visualization.GeometryHelper.toSurface(geom);geom.dispose();return surf}Primitive.createTubeSurface=createTubeSurface;var coneAxis=[0,1,0],coneTransformRotation=LA.Matrix4.zero(),coneTransformTranslation=LA.Matrix4.zero(),coneTransformTranslation1=LA.Matrix4.zero();function createCone(cone){var a=cone.a,b=cone.b,radius=cone.radius,_a=cone.slices,slices=_a===void 0?12:_a;var height=LA.Vector3.distance(a,b);var geom=new Visualization.THREE.CylinderGeometry(0,radius,height,slices,1);var surf=Visualization.GeometryHelper.toSurface(geom);geom.dispose();var dir=LA.Vector3.sub(b,b,a);LA.Vector3.makeRotation(coneTransformRotation,coneAxis,dir);LA.Matrix4.fromTranslation(coneTransformTranslation1,[0,height/2,0]);LA.Matrix4.fromTranslation(coneTransformTranslation,a);LiteMol.Core.Geometry.Surface.transformImmediate(surf,LA.Matrix4.mul3(coneTransformTranslation,coneTransformTranslation,coneTransformRotation,coneTransformTranslation1));LiteMol.Core.Geometry.Surface.computeNormalsImmediate(surf);return surf}Primitive.createCone=createCone;function createArrow(arrow){var id=arrow.id,a=arrow.a,b=arrow.b,radius=arrow.radius,_a=arrow.slices,slices=_a===void 0?12:_a,coneHeight=arrow.coneHeight,coneRadius=arrow.coneRadius;var len=LA.Vector3.distance(a,b);var t=len-coneHeight;var dir=LA.Vector3.normalize(b,LA.Vector3.sub(b,b,a));var pivot=[a[0]+t*dir[0],a[1]+t*dir[1],a[2]+t*dir[2]];return[{type:"Cone",a:pivot,b:b,id:id,radius:coneRadius,slices:slices},{type:"Tube",a:a,b:pivot,id:id,radius:radius,slices:slices}]}Primitive.createArrow=createArrow;var dashSurface=function(){var dash=Visualization.GeometryHelper.toSurface(new Visualization.THREE.BoxGeometry(1,1,1));for(var i=0;i<dash.vertices.length;i+=3){dash.vertices[i+2]+=.5}return dash}();function createDashes(line){var id=line.id,a=line.a,b=line.b,width=line.width,dashSize=line.dashSize,spaceSize=line.spaceSize;var length=LA.Vector3.distance(a,b);if(length===0)return[];var delta=dashSize+(spaceSize!==void 0?spaceSize:dashSize);var dir=LA.Vector3.sub(LA.Vector3(),b,a);LA.Vector3.normalize(dir,dir);var scale=LA.Vector3.fromValues(width,width,dashSize);var up=LA.Vector3.fromValues(0,0,1);var rotation=LA.Vector3.makeRotation(LA.Matrix4(),up,dir);var surfaces=[];LA.Vector3.scale(dir,dir,delta);var axis=LA.Vector3.copy(LA.Vector3(),a);for(var t=0;t<length;t+=delta){if(t+dashSize>length)scale=LA.Vector3.fromValues(width,width,length-t);surfaces.push({type:"Surface",id:id,surface:dashSurface,rotation:rotation,scale:scale,translation:LA.Vector3.clone(axis)});LA.Vector3.add(axis,axis,dir)}return surfaces}Primitive.createDashes=createDashes})(Primitive=Visualization.Primitive||(Visualization.Primitive={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Visualization;(function(Visualization){var Primitive;(function(Primitive){"use strict";var LA=LiteMol.Core.Geometry.LinearAlgebra;var Surface=LiteMol.Core.Geometry.Surface;function buildSurface(shapes){var _this=this;return LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var uniqueSpheres,shapeSurfaces,_i,shapes_1,s,sphere,tube,size,_a,shapeSurfaces_1,s,vertices,normals,triangles,annotation,vOffset,nOffset,tOffset,aOffset,v,scaleTransform,translateTransform,rotateTransform,transform,vs,shapeIndex,_c,shapes_2,s,surface,startVOffset,i,_b,ns,i,_b,i,_b,ns,i,_b,i,_b,ns,i,_b,i,_b,ns,i,_b,ts,i,_b,i,_b,ret;return __generator(this,function(_d){switch(_d.label){case 0:return[4,ctx.updateProgress("Building surface...")];case 1:_d.sent();uniqueSpheres=LiteMol.Core.Utils.FastMap.create();shapeSurfaces=[];for(_i=0,shapes_1=shapes;_i<shapes_1.length;_i++){s=shapes_1[_i];switch(s.type){case"Sphere":if(uniqueSpheres.has(s.tessalation||0))shapeSurfaces.push(uniqueSpheres.get(s.tessalation||0));else{sphere=Primitive.createSphereSurface(s);uniqueSpheres.set(s.tessalation||0,sphere);shapeSurfaces.push(sphere)}break;case"Tube":{tube=Primitive.createTubeSurface(s);shapeSurfaces.push(tube);break}case"Cone":{shapeSurfaces.push(Primitive.createCone(s));break}case"Surface":{shapeSurfaces.push(s.surface);break}}}size={vertexCount:0,triangleCount:0};for(_a=0,shapeSurfaces_1=shapeSurfaces;_a<shapeSurfaces_1.length;_a++){s=shapeSurfaces_1[_a];size.vertexCount+=s.vertexCount;size.triangleCount+=s.triangleCount}vertices=new Float32Array(size.vertexCount*3);normals=new Float32Array(size.vertexCount*3);triangles=new Uint32Array(size.triangleCount*3);annotation=new Int32Array(size.vertexCount);vOffset=0,nOffset=0,tOffset=0,aOffset=0;v=LA.Vector3.zero();scaleTransform=LA.Matrix4.zero(),translateTransform=LA.Matrix4.zero(),rotateTransform=LA.Matrix4.zero(),transform=LA.Matrix4.zero();shapeIndex=0;for(_c=0,shapes_2=shapes;_c<shapes_2.length;_c++){s=shapes_2[_c];surface=shapeSurfaces[shapeIndex++];startVOffset=vOffset/3|0;switch(s.type){case"Sphere":{vs=surface.vertices;LA.Matrix4.fromScaling(scaleTransform,[s.radius,s.radius,s.radius]);LA.Matrix4.fromTranslation(translateTransform,s.center);LA.Matrix4.mul(transform,translateTransform,scaleTransform);for(i=0,_b=surface.vertexCount*3;i<_b;i+=3){v[0]=vs[i],v[1]=vs[i+1],v[2]=vs[i+2];LA.Vector3.transformMat4(v,v,transform);vertices[vOffset++]=v[0];vertices[vOffset++]=v[1];vertices[vOffset++]=v[2]}ns=surface.normals;for(i=0,_b=ns.length;i<_b;i++){normals[nOffset++]=ns[i]}break}case"Tube":case"Cone":{vs=surface.vertices;for(i=0,_b=vs.length;i<_b;i++){vertices[vOffset++]=vs[i]}ns=surface.normals;for(i=0,_b=ns.length;i<_b;i++){normals[nOffset++]=ns[i]}break}case"Surface":{if(!surface.normals)Surface.computeNormalsImmediate(surface);vs=surface.vertices;if(s.rotation||s.scale||s.translation){LA.Matrix4.fromScaling(scaleTransform,s.scale||[1,1,1]);LA.Matrix4.fromTranslation(translateTransform,s.translation||[0,0,0]);if(s.rotation)LA.Matrix4.copy(rotateTransform,s.rotation);else LA.Matrix4.fromIdentity(rotateTransform);LA.Matrix4.mul3(transform,translateTransform,rotateTransform,scaleTransform);for(i=0,_b=vs.length;i<_b;i+=3){v[0]=vs[i],v[1]=vs[i+1],v[2]=vs[i+2];LA.Vector3.transformMat4(v,v,transform);vertices[vOffset++]=v[0];vertices[vOffset++]=v[1];vertices[vOffset++]=v[2]}LA.Matrix4.mul(transform,rotateTransform,scaleTransform);ns=surface.normals;for(i=0,_b=ns.length;i<_b;i+=3){v[0]=ns[i],v[1]=ns[i+1],v[2]=ns[i+2];LA.Vector3.transformMat4(v,v,transform);LA.Vector3.normalize(v,v);normals[nOffset++]=v[0];normals[nOffset++]=v[1];normals[nOffset++]=v[2]}}else{for(i=0,_b=vs.length;i<_b;i++){vertices[vOffset++]=vs[i]}ns=surface.normals;for(i=0,_b=ns.length;i<_b;i++){normals[nOffset++]=ns[i]}}break}}ts=surface.triangleIndices;for(i=0,_b=ts.length;i<_b;i++){triangles[tOffset++]=startVOffset+ts[i]}for(i=0,_b=surface.vertexCount;i<_b;i++){annotation[aOffset++]=s.id}}ret={vertices:vertices,vertexCount:size.vertexCount,triangleIndices:triangles,triangleCount:size.triangleCount,normals:normals,annotation:annotation};return[2,ret]}})})})}var Builder=function(){function Builder(){this.shapes=[]}Builder.prototype.add=function(shape){this.shapes.push(shape);return this};Builder.prototype.buildSurface=function(){var normalize=false;for(var _i=0,_a=this.shapes;_i<_a.length;_i++){var s=_a[_i];if(s.type==="DashedLine"||s.type==="Arrow"){normalize=true;break}}if(normalize){var normalized=[];for(var _c=0,_d=this.shapes;_c<_d.length;_c++){var s=_d[_c];if(s.type==="DashedLine"){for(var _e=0,_f=Primitive.createDashes(s);_e<_f.length;_e++){var d=_f[_e];normalized[normalized.length]=d}}else if(s.type==="Arrow"){for(var _g=0,_h=Primitive.createArrow(s);_g<_h.length;_g++){var a=_h[_g];normalized[normalized.length]=a}}else{normalized[normalized.length]=s}}return buildSurface(normalized)}return buildSurface(this.shapes)};Builder.create=function(){return new Builder};return Builder}();Primitive.Builder=Builder})(Primitive=Visualization.Primitive||(Visualization.Primitive={}))})(Visualization=LiteMol.Visualization||(LiteMol.Visualization={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){Bootstrap.VERSION={number:"1.4.1",date:"June 22 2017"}})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";Bootstrap.Immutable=__LiteMolImmutable;Bootstrap.Rx=LiteMol.Core.Rx;Bootstrap.Zlib=LiteMolZlib})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){"use strict";var LRUCache;(function(LRUCache){function entry(key,data){return{previous:null,next:null,inList:false,key:key,data:data}}LRUCache.entry=entry;function create(capacity){return{entries:new Utils.LinkedList,capacity:Math.max(1,capacity)}}LRUCache.create=create;function get(cache,key){for(var e=cache.entries.first;e;e=e.next){if(e.key===key){cache.entries.remove(e);cache.entries.addLast(e);return e.data}}return void 0}LRUCache.get=get;function set(cache,key,data){if(cache.entries.count>=cache.capacity){cache.entries.remove(cache.entries.first)}cache.entries.addLast(entry(key,data));return data}LRUCache.set=set})(LRUCache=Utils.LRUCache||(Utils.LRUCache={}))})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){"use strict";var DataCompressionMethod;(function(DataCompressionMethod){DataCompressionMethod[DataCompressionMethod["None"]=0]="None";DataCompressionMethod[DataCompressionMethod["Gzip"]=1]="Gzip"})(DataCompressionMethod=Utils.DataCompressionMethod||(Utils.DataCompressionMethod={}));function readStringFromFile(file){return readFromFileInternal(file,false)}Utils.readStringFromFile=readStringFromFile;function readArrayBufferFromFile(file){return readFromFileInternal(file,true)}Utils.readArrayBufferFromFile=readArrayBufferFromFile;function readFromFile(file,type){return readFromFileInternal(file,type==="Binary")}Utils.readFromFile=readFromFile;function ajaxGetString(url,title){return ajaxGetInternal(title,url,false,false)}Utils.ajaxGetString=ajaxGetString;function ajaxGetArrayBuffer(url,title){return ajaxGetInternal(title,url,true,false)}Utils.ajaxGetArrayBuffer=ajaxGetArrayBuffer;function ajaxGet(params){return ajaxGetInternal(params.title,params.url,params.type==="Binary",params.compression===DataCompressionMethod.Gzip)}Utils.ajaxGet=ajaxGet;function decompress(buffer){var gzip=new LiteMolZlib.Gunzip(new Uint8Array(buffer));return gzip.decompress()}function processFile(ctx,asArrayBuffer,compressed,e){return __awaiter(this,void 0,void 0,function(){var data,decompressed;return __generator(this,function(_a){switch(_a.label){case 0:data=e.target.result;if(!compressed)return[3,2];return[4,ctx.updateProgress("Decompressing...")];case 1:_a.sent();decompressed=decompress(data);if(asArrayBuffer){return[2,decompressed.buffer]}else{return[2,LiteMol.Core.Formats.CIF.Binary.MessagePack.utf8Read(decompressed,0,decompressed.length)]}return[3,3];case 2:return[2,data];case 3:return[2]}})})}function readData(ctx,action,data,asArrayBuffer){return new LiteMol.Promise(function(resolve,reject){data.onerror=function(e){var error=e.target.error;reject(error?error:"Failed.")};data.onabort=function(){return reject(LiteMol.Core.Computation.Aborted)};data.onprogress=function(e){if(e.lengthComputable){ctx.updateProgress(action,true,e.loaded,e.total)}else{ctx.updateProgress(action+" "+(e.loaded/1024/1024).toFixed(2)+" MB",true)}};data.onload=function(e){return resolve(e)}})}function readFromFileInternal(file,asArrayBuffer){var _this=this;return Bootstrap.Task.fromComputation("Open File","Background",LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var reader,isCompressed,e,result;return __generator(this,function(_a){switch(_a.label){case 0:reader=new FileReader;isCompressed=/\.gz$/i.test(file.name);if(isCompressed||asArrayBuffer)reader.readAsArrayBuffer(file);else reader.readAsBinaryString(file);ctx.updateProgress("Opening file...",function(){return reader.abort()});return[4,readData(ctx,"Reading...",reader,asArrayBuffer)];case 1:e=_a.sent();result=processFile(ctx,asArrayBuffer,isCompressed,e);return[2,result]}})})}))}var RequestPool=function(){function RequestPool(){}RequestPool.get=function(){if(this.pool.length){return this.pool.pop()}return new XMLHttpRequest};RequestPool.emptyFunc=function(){};RequestPool.deposit=function(req){if(this.pool.length<this.poolSize){req.onabort=RequestPool.emptyFunc;req.onerror=RequestPool.emptyFunc;req.onload=RequestPool.emptyFunc;req.onprogress=RequestPool.emptyFunc;this.pool.push(req)}};RequestPool.pool=[];RequestPool.poolSize=15;return RequestPool}();function processAjax(ctx,asArrayBuffer,decompressGzip,e){return __awaiter(this,void 0,void 0,function(){var req,buff,gzip,data,text,status_1;return __generator(this,function(_a){switch(_a.label){case 0:req=e.target;if(!(req.status>=200&&req.status<400))return[3,6];if(!asArrayBuffer)return[3,4];buff=e.target.response;RequestPool.deposit(e.target);if(!decompressGzip)return[3,2];return[4,ctx.updateProgress("Decompressing...")];case 1:_a.sent();gzip=new LiteMolZlib.Gunzip(new Uint8Array(buff));data=gzip.decompress();return[2,data.buffer];case 2:return[2,buff];case 3:return[3,5];case 4:text=e.target.responseText;RequestPool.deposit(e.target);return[2,text];case 5:return[3,7];case 6:status_1=req.statusText;RequestPool.deposit(e.target);throw status_1;case 7:return[2]}})})}function ajaxGetInternal(title,url,asArrayBuffer,decompressGzip){var _this=this;return Bootstrap.Task.fromComputation(title?title:"Download","Background",LiteMol.Core.computation(function(ctx){return __awaiter(_this,void 0,void 0,function(){var xhttp,e,result;return __generator(this,function(_a){switch(_a.label){case 0:if(!asArrayBuffer&&decompressGzip){throw"Decompress is only available when downloading binary data."}xhttp=RequestPool.get();xhttp.open("get",url,true);xhttp.responseType=asArrayBuffer?"arraybuffer":"text";xhttp.send();ctx.updateProgress("Waiting for server...",function(){return xhttp.abort()});return[4,readData(ctx,"Downloading...",xhttp,asArrayBuffer)];case 1:e=_a.sent();return[4,processAjax(ctx,asArrayBuffer,decompressGzip,e)];case 2:result=_a.sent();return[2,result]}})})}))}})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){var Query;(function(Query){"use strict";var residueIdRegex=/^\s*([1-9][0-9]*)\s+([_.;:""&<>()/\{}'`~!@#$%A-Za-z0-9*|+-]+)(?:\s+i[:]([.]|[a-zA-Z0-9]))?(?:\s+e[:]([.]|[a-zA-Z0-9]+))?/;function normalizeId(id){if(!id||id==="."||id==="?")return null;return id}function getAuthResidueIdParams(id){var match=id.match(residueIdRegex);if(!match)return void 0;var authSeqNumber=+match[1]|0;var authAsymId=normalizeId(match[2]);var insCode=normalizeId(match[3]);var entityId=normalizeId(match[4]);return{entityId:entityId,authSeqNumber:authSeqNumber,authAsymId:authAsymId,insCode:insCode}}function parseAuthResidueId(ids,separator){if(separator===void 0){separator=","}var parts=ids.split(separator).map(function(p){return getAuthResidueIdParams(p)}).filter(function(p){return!!p});return LiteMol.Core.Structure.Query.Builder.toQuery((_a=LiteMol.Core.Structure.Query).residues.apply(_a,parts));var _a}Query.parseAuthResidueId=parseAuthResidueId})(Query=Utils.Query||(Utils.Query={}))})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){var Query;(function(Query){"use strict";var ValueOrError=function(){function ValueOrError(isError,value,error){this.isError=isError;this.value=value;this.error=error}ValueOrError.prototype.bind=function(f){if(this.isError)return this;return f(this.value)};return ValueOrError}();Query.ValueOrError=ValueOrError;(function(ValueOrError){function error(err){return new ValueOrError(true,void 0,err)}ValueOrError.error=error;function value(v){return new ValueOrError(true,v)}ValueOrError.value=value})(ValueOrError=Query.ValueOrError||(Query.ValueOrError={}))})(Query=Utils.Query||(Utils.Query={}))})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){"use strict";var LinkedList=function(){function LinkedList(){this.count=0;this.first=null;this.last=null}LinkedList.prototype.addFirst=function(item){item.inList=true;if(this.first)this.first.previous=item;item.next=this.first;this.first=item;this.count++};LinkedList.prototype.addLast=function(item){if(this.last!=null){this.last.next=item}item.previous=this.last;this.last=item;if(this.first==null){this.first=item}item.inList=true;this.count++};LinkedList.prototype.remove=function(item){if(!item.inList)return;item.inList=false;if(item.previous!==null){item.previous.next=item.next}else if(item.previous===null){this.first=item.next}if(item.next!==null){item.next.previous=item.previous}else if(item.next===null){this.last=item.previous}item.next=null;item.previous=null;this.count--};return LinkedList}();Utils.LinkedList=LinkedList})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){"use strict";function padTime(n){return(n<10?"0":"")+n}function formatTime(d){var h=d.getHours(),m=d.getMinutes(),s=d.getSeconds();return h+":"+padTime(m)+":"+padTime(s)}Utils.formatTime=formatTime;function round(n,d){var f=Math.pow(10,d);return Math.round(f*n)/f}Utils.round=round;function formatProgress(p){if(p.isIndeterminate)return p.message;var x=(100*p.current/p.max).toFixed(2);return p.message+" "+x+"%"}Utils.formatProgress=formatProgress;function generateUUID(){var d=(new Date).getTime();if(window.performance&&typeof window.performance.now==="function"){d+=performance.now()}var uuid="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);return(c=="x"?r:r&3|8).toString(16)});return uuid}Utils.generateUUID=generateUUID})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){"use strict";var VDWRadii=void 0;function vdwRadiusFromElementSymbol(model){if(!VDWRadii)VDWRadii=createVdwRadii();return function(names,radii){return function(i){var r=radii.get(names[i]);if(r!==void 0)return r;return 1}}(model.data.atoms.elementSymbol,VDWRadii)}Utils.vdwRadiusFromElementSymbol=vdwRadiusFromElementSymbol;function createVdwRadii(){var vdwRadii={H:1.1,He:1.4,Li:1.81,Be:1.53,B:1.92,C:1.7,N:1.55,O:1.52,F:1.47,Ne:1.54,Na:2.27,Mg:1.73,Al:1.84,Si:2.1,P:1.8,S:1.8,Cl:1.75,Ar:1.88,K:2.75,Ca:2.31,Sc:2.16,Ti:1.87,V:1.79,Cr:1.89,Mn:1.97,Fe:1.94,Co:1.92,Ni:1.84,Cu:1.86,Zn:2.1,Ga:1.87,Ge:2.11,As:1.85,Se:1.9,Br:1.83,Kr:2.02,Rb:3.03,Sr:2.49,Y:2.19,Zr:1.86,Nb:2.07,Mo:2.09,Tc:2.09,Ru:2.07,Rh:1.95,Pd:2.02,Ag:2.03,Cd:2.3,In:1.93,Sn:2.17,Sb:2.06,Te:2.06,I:1.98,Xe:2.16,Cs:3.43,Ba:2.68,La:2.4,Ce:2.35,Pr:2.39,Nd:2.29,Pm:2.36,Sm:2.29,Eu:2.33,Gd:2.37,Tb:2.21,Dy:2.29,Ho:2.16,Er:2.35,Tm:2.27,Yb:2.42,Lu:2.21,Hf:2.12,Ta:2.17,W:2.1,Re:2.17,Os:2.16,Ir:2.02,Pt:2.09,Au:2.17,Hg:2.09,Tl:1.96,Pb:2.02,Bi:2.07,Po:1.97,At:2.02,Rn:2.2,Fr:3.48,Ra:2.83,Ac:2.6,Th:2.37,Pa:2.43,U:2.4,Np:2.21,Pu:2.43,Am:2.44,Cm:2.45,Bk:2.44,Cf:2.45,Es:2.45,Fm:2.45,Md:2.46,No:2.46,Lr:2.46};var ret=LiteMol.Core.Utils.FastMap.create();for(var e in vdwRadii){ret.set(e,vdwRadii[e]);ret.set(e.toUpperCase(),vdwRadii[e]);ret.set(e.toLowerCase(),vdwRadii[e])}return ret}})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){"use strict";var hasOwnProperty=Object.prototype.hasOwnProperty;function shallowClone(o){return LiteMol.Core.Utils.extend({},o)}Utils.shallowClone=shallowClone;function shallowEqual(a,b){if(!a){if(!b)return true;return false}if(!b)return false;var keys=Object.keys(a);if(Object.keys(b).length!==keys.length)return false;for(var _i=0,keys_1=keys;_i<keys_1.length;_i++){var k=keys_1[_i];if(!hasOwnProperty.call(a,k)||a[k]!==b[k])return false}return true}Utils.shallowEqual=shallowEqual;function deepEqual(a,b){if(!a){if(!b)return true;return false}if(!b)return false;var keys=Object.keys(a);if(Object.keys(b).length!==keys.length)return false;for(var _i=0,keys_2=keys;_i<keys_2.length;_i++){var k=keys_2[_i];if(!hasOwnProperty.call(a,k))return false;var u=a[k];var v=b[k];if(typeof u==="object"&&typeof v==="object"){if(!deepEqual(u,v))return false}else if(u!==v)return false}return true}Utils.deepEqual=deepEqual;function _assign(target){for(var s=1;s<arguments.length;s++){var from=arguments[s];for(var _i=0,_a=Object.keys(from);_i<_a.length;_i++){var key=_a[_i];if(hasOwnProperty.call(from,key)){target[key]=from[key]}}}return target}Utils.assign=Object.assign||_assign;function _shallowMerge1(source,update){var changed=false;for(var _i=0,_a=Object.keys(update);_i<_a.length;_i++){var k=_a[_i];if(!hasOwnProperty.call(update,k))continue;if(update[k]!==source[k]){changed=true;break}}if(!changed)return source;return Utils.assign(shallowClone(source),update)}function _shallowMerge(source){var ret=source;for(var s=1;s<arguments.length;s++){if(!arguments[s])continue;ret=_shallowMerge1(source,arguments[s]);if(ret!==source){for(var i=s+1;i<arguments.length;i++){ret=Utils.assign(ret,arguments[i])}break}}return ret}Utils.merge=_shallowMerge})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Service;(function(Service){"use strict";var Dispatcher=function(){function Dispatcher(){this.LOG_DISPATCH_STREAM=false;this.lanes=[];for(var i=0;i<=Dispatcher.Lane.Task;i++){this.lanes.push(new Bootstrap.Rx.Subject)}}Dispatcher.prototype.dispatch=function(event){if(this.LOG_DISPATCH_STREAM)console.log(event.type.name,Dispatcher.Lane[event.type.lane],event.data);this.lanes[event.type.lane].onNext(event)};Dispatcher.prototype.schedule=function(action,onError,timeout){if(timeout===void 0){timeout=1e3/31}return setTimeout(function(){if(onError){try{action.call(null)}catch(e){onError.call(null,""+e)}}else{action.call(null)}},timeout)};Dispatcher.prototype.getStream=function(type){return this.lanes[type.lane].filter(function(e){return e.type===type})};Dispatcher.prototype.finished=function(){this.lanes.forEach(function(l){return l.onCompleted()})};return Dispatcher}();Service.Dispatcher=Dispatcher;(function(Dispatcher){var Lane;(function(Lane){Lane[Lane["Slow"]=0]="Slow";Lane[Lane["Fast"]=1]="Fast";Lane[Lane["Log"]=2]="Log";Lane[Lane["Busy"]=3]="Busy";Lane[Lane["Transformer"]=4]="Transformer";Lane[Lane["Task"]=5]="Task"})(Lane=Dispatcher.Lane||(Dispatcher.Lane={}))})(Dispatcher=Service.Dispatcher||(Service.Dispatcher={}))})(Service=Bootstrap.Service||(Bootstrap.Service={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Service;(function(Service){"use strict";var Logger=function(){function Logger(context){this.context=context}Logger.prototype.log=function(e){Bootstrap.Event.Log.dispatch(this.context,e)};Logger.prototype.message=function(m){this.log({type:Logger.EntryType.Message,timestamp:new Date,message:m})};Logger.prototype.error=function(m){this.log({type:Logger.EntryType.Error,timestamp:new Date,message:m})};Logger.prototype.warning=function(m){this.log({type:Logger.EntryType.Warning,timestamp:new Date,message:m})};Logger.prototype.info=function(m){this.log({type:Logger.EntryType.Info,timestamp:new Date,message:m})};return Logger}();Service.Logger=Logger;(function(Logger){var EntryType;(function(EntryType){EntryType[EntryType["Message"]=0]="Message";EntryType[EntryType["Error"]=1]="Error";EntryType[EntryType["Warning"]=2]="Warning";EntryType[EntryType["Info"]=3]="Info"})(EntryType=Logger.EntryType||(Logger.EntryType={}))})(Logger=Service.Logger||(Service.Logger={}))})(Service=Bootstrap.Service||(Bootstrap.Service={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Service;(function(Service){"use strict"})(Service=Bootstrap.Service||(Bootstrap.Service={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";var Computation=LiteMol.Core.Computation;var Task=function(){function Task(name,type,computation){this.name=name;this.type=type;this.computation=computation;this.info={id:serialTaskId++,name:name,type:type,reportTime:false}}Object.defineProperty(Task.prototype,"id",{get:function(){return this.info.id},enumerable:true,configurable:true});Object.defineProperty(Task.prototype,"reportTime",{get:function(){return this.info.reportTime},enumerable:true,configurable:true});Task.prototype.run=function(context){return this.runWithContext(context).result};Task.prototype.runWithContext=function(context){return new Task.Running(context,this.computation,this.info)};Task.prototype.setReportTime=function(report){this.info.reportTime=report;return this};return Task}();Bootstrap.Task=Task;var serialTaskId=0;(function(Task){Task.__DEBUG_MODE__=false;var Running=function(){function Running(context,computation,info){this.context=context;this.computation=computation;this.info=info;this.run()}Running.prototype.tryAbort=function(){this.computationCtx.requestAbort()};Running.prototype.progressUpdated=function(progress){Bootstrap.Event.Task.StateUpdated.dispatch(this.context,{taskId:this.info.id,type:this.info.type,name:this.info.name,message:Bootstrap.Utils.formatProgress(progress),abort:progress.requestAbort})};Running.prototype.resolved=function(){try{this.context.performance.end("task"+this.info.id);if(this.info.reportTime){var time=this.context.performance.time("task"+this.info.id);if(this.info.type!=="Silent")this.context.logger.info(this.info.name+" finished in "+LiteMol.Core.Utils.PerformanceMonitor.format(time)+".")}}finally{Bootstrap.Event.Task.Completed.dispatch(this.context,this.info.id)}};Running.prototype.rejected=function(err){this.context.performance.end("task"+this.info.id);this.context.performance.formatTime("task"+this.info.id);if(Task.__DEBUG_MODE__){console.error(err)}try{if(this.info.type==="Silent"){if(err.warn)this.context.logger.warning("Warning ("+this.info.name+"): "+err.message);else console.error("Error ("+this.info.name+")",err)}else{if(err.warn){this.context.logger.warning("Warning ("+this.info.name+"): "+err.message)}else{var e=""+err;if(e.indexOf("Aborted")>=0)this.context.logger.info(this.info.name+": Aborted.");else this.context.logger.error("Error ("+this.info.name+"): "+err)}}}catch(e){console.error(e)}finally{Bootstrap.Event.Task.Completed.dispatch(this.context,this.info.id)}};Running.prototype.run=function(){var _this=this;this.computationCtx=Computation.createContext();this.computationCtx.progress.subscribe(function(p){return _this.progressUpdated(p)});Bootstrap.Event.Task.Started.dispatch(this.context,this.info);this.context.performance.start("task"+this.info.id);this.result=this.computation.run(this.computationCtx);this.result.then(function(){return _this.resolved()}).catch(function(e){return _this.rejected(e)})};return Running}();Task.Running=Running;function create(name,type,computation){return new Task(name,type,LiteMol.Core.computation(computation))}Task.create=create;function resolve(name,type,value){return new Task(name,type,Computation.resolve(value))}Task.resolve=resolve;function reject(name,type,reason){return new Task(name,type,Computation.reject(reason))}Task.reject=reject;function fromComputation(name,type,computation){return new Task(name,type,computation)}Task.fromComputation=fromComputation;function isPromise(t){return t.then&&t.catch}Task.isPromise=isPromise})(Task=Bootstrap.Task||(Bootstrap.Task={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";var Event;(function(Event){var EventPrototype={dispatch:function(context,data){context.dispatcher.dispatch({type:this,data:data})},getStream:function(context){return context.dispatcher.getStream(this)}};function create(name,lane){return Object.create(EventPrototype,{name:{writable:false,configurable:false,value:name},lane:{writable:false,configurable:false,value:lane}})}Event.create=create})(Event=Bootstrap.Event||(Bootstrap.Event={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Event;(function(Event){"use strict";var Lane=Bootstrap.Service.Dispatcher.Lane;Event.Log=Event.create("bs.Log",Lane.Log);var Common;(function(Common){Common.LayoutChanged=Event.create("bs.Common.LayoutChanged",Lane.Slow)})(Common=Event.Common||(Event.Common={}));var Task;(function(Task){Task.Started=Event.create("bs.Tasks.Started",Lane.Task);Task.Completed=Event.create("bs.Tasks.Completed",Lane.Task);Task.StateUpdated=Event.create("bs.Tasks.StateUpdated",Lane.Busy)})(Task=Event.Task||(Event.Task={}));var Tree;(function(Tree){Tree.NodeUpdated=Event.create("bs.Tree.NodeUpdated",Lane.Slow);Tree.NodeAdded=Event.create("bs.Tree.NodeAdded",Lane.Slow);Tree.NodeRemoved=Event.create("bs.Tree.NodeRemoved",Lane.Slow);Tree.TransformStarted=Event.create("bs.Tree.TransformStarted",Lane.Slow);Tree.TransformFinished=Event.create("bs.Tree.TransformFinished",Lane.Slow);Tree.TransformerApply=Event.create("bs.Tree.TransformerApplied",Lane.Transformer)})(Tree=Event.Tree||(Event.Tree={}));var Entity;(function(Entity_1){Entity_1.CurrentChanged=Event.create("bs.Entity.CurrentChanged",Lane.Slow)})(Entity=Event.Entity||(Event.Entity={}));var Interactivity;(function(Interactivity){Interactivity.Highlight=Event.create("bs.Visuals.HoverElement",Lane.Fast)})(Interactivity=Event.Interactivity||(Event.Interactivity={}));var Visual;(function(Visual){Visual.VisualHoverElement=Event.create("bs.Visual.HoverElement",Lane.Fast);Visual.VisualSelectElement=Event.create("bs.Visual.SelectElement",Lane.Fast);Visual.CameraChanged=Event.create("bs.Visual.CameraChanged",Lane.Fast)})(Visual=Event.Visual||(Event.Visual={}));var Molecule;(function(Molecule){Molecule.ModelHighlight=Event.create("bs.Molecule.ModelHighlight",Lane.Fast);Molecule.ModelSelect=Event.create("bs.Molecule.ModelSelect",Lane.Fast)})(Molecule=Event.Molecule||(Event.Molecule={}))})(Event=Bootstrap.Event||(Bootstrap.Event={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Command;(function(Command){"use strict";var Lane=Bootstrap.Service.Dispatcher.Lane;var create=Bootstrap.Event.create;var Tree;(function(Tree){Tree.RemoveNode=create("bs.cmd.Tree.RemoveNode",Lane.Slow);Tree.ApplyTransform=create("bs.cmd.Tree.ApplyTransform",Lane.Slow)})(Tree=Command.Tree||(Command.Tree={}));var Entity;(function(Entity){Entity.SetCurrent=create("bs.cmd.Entity.SetCurrentNode",Lane.Slow);Entity.ToggleExpanded=create("bs.cmd.Entity.ToggleExpanded",Lane.Slow);Entity.SetVisibility=create("bs.cmd.Entity.SetVisibility",Lane.Slow);Entity.Focus=create("bs.cmd.Entity.Focus",Lane.Slow);Entity.Highlight=create("bs.cmd.Entity.Highlight",Lane.Slow)})(Entity=Command.Entity||(Command.Entity={}));var Layout;(function(Layout){Layout.SetState=LiteMol.Bootstrap.Event.create("lm.cmd.Layout.SetState",Lane.Slow);Layout.SetViewportOptions=create("bs.cmd.Layout.SetViewportOptions",Lane.Slow)})(Layout=Command.Layout||(Command.Layout={}));var Molecule;(function(Molecule){Molecule.FocusQuery=create("bs.cmd.Molecule.FocusQuery",Lane.Slow);Molecule.Highlight=create("bs.cmd.Molecule.Highlight",Lane.Slow);Molecule.CreateSelectInteraction=create("bs.cmd.Molecule.CreateSelectInteraction",Lane.Slow)})(Molecule=Command.Molecule||(Command.Molecule={}));var Visual;(function(Visual){Visual.ResetScene=create("bs.cmd.Visual.ResetScene",Lane.Slow);Visual.ResetTheme=create("bs.cmd.Visual.ResetTheme",Lane.Slow);Visual.UpdateBasicTheme=create("bs.cmd.Visual.UpdateBasicTheme",Lane.Slow)})(Visual=Command.Visual||(Command.Visual={}));var Toast;(function(Toast){Toast.Show=create("bs.cmd.Toast.Show",Lane.Slow);Toast.Hide=create("bs.cmd.Toast.Hide",Lane.Slow)})(Toast=Command.Toast||(Command.Toast={}))})(Command=Bootstrap.Command||(Bootstrap.Command={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";var Tree;(function(Tree){function create(context,root){var tree={version:0,refs:LiteMol.Core.Utils.FastMap.create(),nodes:LiteMol.Core.Utils.FastSet.create(),root:root,context:context};root.parent=root;root.tree=tree;return tree}Tree.create=create;function _addRef(entity){if(!entity.tree)return;var refs=entity.tree.refs.get(entity.ref);if(!refs){entity.tree.refs.set(entity.ref,[entity])}else{refs.push(entity)}}function addRef(entity){Tree.Node.forEach(entity,function(e){return _addRef(e)})}function _removeRef(tree,entity){var refs=tree.refs.get(entity.ref);if(!refs)return;var i=refs.indexOf(entity);if(i<0)return;refs[i]=refs[refs.length-1];refs.pop();if(!refs.length)tree.refs.delete(entity.ref)}function add(node){if(!node.parent)throw"Cannot add a node without a parent.";var tree=node.parent.tree;Tree.Node.forEach(node,function(e){return e.tree=tree});Tree.Node.addChild(node.parent,node);addRef(node);Bootstrap.Entity.nodeUpdated(node.parent);notifyAdded(node)}Tree.add=add;function notifyAdded(node){var ctx=node.tree.context;Tree.Node.forEachPreorder(node,function(n){Bootstrap.Event.Tree.NodeAdded.dispatch(ctx,n)})}function update(tree,old,e){Tree.Node.replaceChild(old.parent,old,e);notifyRemoved(tree.context,old);Tree.Node.forEach(e,function(n){return n.tree=tree});addRef(e);for(var _i=0,_a=e.children;_i<_a.length;_i++){var c=_a[_i];notifyAdded(c)}Bootstrap.Entity.nodeUpdated(e.parent);Bootstrap.Event.Tree.NodeAdded.dispatch(tree.context,e);if(tree.context.currentEntity===old){Bootstrap.Entity.setCurrent(e)}}Tree.update=update;function updatePath(node){if(!node)return;var top=void 0;while(node!==node.parent){top=node;Tree.Node.update(node);node=node.parent}if(top)Bootstrap.Event.Tree.NodeUpdated.dispatch(node.tree.context,top)}Tree.updatePath=updatePath;function clearRoot(tree){var children=tree.root.children;tree.root.children=[];Tree.Node.update(tree.root);Bootstrap.Entity.nodeUpdated(tree.root);tree.refs.clear();for(var _i=0,children_1=children;_i<children_1.length;_i++){var c=children_1[_i];notifyRemoved(tree.context,c)}Bootstrap.Command.Entity.SetCurrent.dispatch(tree.context,tree.root)}function notifyRemoved(ctx,node){var current=ctx.currentEntity;var hasCurrent=false;Tree.Node.forEach(node,function(n){_removeRef(ctx.tree,n);Bootstrap.Event.Tree.NodeRemoved.dispatch(ctx,n);n.tree=void 0;if(n===current)hasCurrent=true});return hasCurrent}function remove(node){if(!node||!node.tree)return;if(node.parent===node){clearRoot(node.tree);return}var isHidden=Tree.Node.isHidden(node);var index=node.index;var parent=node.parent;var ctx=node.tree.context;Tree.Node.removeChild(parent,node);Bootstrap.Entity.nodeUpdated(parent);var hasCurrent=notifyRemoved(ctx,node);if(hasCurrent&&!isHidden){var foundSibling=false;for(var i=index;i>=0;i--){if(parent.children[i]&&!Tree.Node.isHidden(parent.children[i])){Bootstrap.Command.Entity.SetCurrent.dispatch(ctx,parent.children[i]);foundSibling=true;break}}if(!foundSibling){Bootstrap.Command.Entity.SetCurrent.dispatch(ctx,parent)}}if(node.transform.props.isBinding&&!parent.children.length){remove(node.parent)}}Tree.remove=remove})(Tree=Bootstrap.Tree||(Bootstrap.Tree={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Tree;(function(Tree){"use strict";var Node;(function(Node){Node.Null={};function is(e,t){return e&&e.type===t}Node.is=is;function hasAncestor(e,a){if(!a)return false;while(true){if(e===a)return true;e=e.parent;if(!e||e===e.parent)return false}}Node.hasAncestor=hasAncestor;function findAncestor(e,t){if(!e)return void 0;var n=e.parent;while(true){if(is(n,t))return n;n=n.parent;if(n.parent===n)return void 0}}Node.findAncestor=findAncestor;function findClosestNodeOfType(e,t){if(!e)return void 0;var n=e;while(true){if(t.indexOf(n.type)>=0)return n;n=n.parent;if(n.parent===n){return t.indexOf(n.type)>=0?n:void 0}}}Node.findClosestNodeOfType=findClosestNodeOfType;var serialId=0;function createId(){return serialId++}Node.createId=createId;function update(e){e.version++;return e}Node.update=update;function withProps(n,props){var newProps=Bootstrap.Utils.merge(n.props,props);if(newProps===n.props)return n;return update(n)}Node.withProps=withProps;function withState(n,state){var ns=Bootstrap.Utils.merge(n.state,state);if(ns===n.state)return n;n.state=ns;return update(n)}Node.withState=withState;function addChild(n,c){c.index=n.children.length;n.children.push(c);return update(n)}Node.addChild=addChild;function removeChild(n,child){var children=n.children;for(var i=child.index,_b=children.length-1;i<_b;i++){var c=children[i+1];c.index--;children[i]=c}children.pop();return update(n)}Node.removeChild=removeChild;function replaceChild(n,oldChild,newChild){if(!newChild)return removeChild(n,oldChild);newChild.index=oldChild.index;n.children[newChild.index]=newChild;return update(n)}Node.replaceChild=replaceChild;function forEach(n,f){for(var _i=0,_a=n.children;_i<_a.length;_i++){var c=_a[_i];forEach(c,f)}f(n)}Node.forEach=forEach;function forEachPreorder(n,f){f(n);for(var _i=0,_a=n.children;_i<_a.length;_i++){var c=_a[_i];forEach(c,f)}}Node.forEachPreorder=forEachPreorder;function collect(n){var nodes=[];forEach(n,function(c){return nodes.push(c)});return nodes}Node.collect=collect;function isHidden(e){if(e.isHidden)return true;var n=e.parent;if(!n)return e.isHidden;while(n.parent!==n){if(n.isHidden){return true}n=n.parent;if(!n)return false}return false}Node.isHidden=isHidden})(Node=Tree.Node||(Tree.Node={}))})(Tree=Bootstrap.Tree||(Bootstrap.Tree={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Tree;(function(Tree){"use strict";var Selection;(function(Selection){function select(s,tree){return compile(s)(tree)}Selection.select=select;function compile(s){var selector=s?s:Selection.root();var query;if(isBuilder(selector))query=selector.compile();else if(isEntity(selector))query=Selection.byValue(selector).compile();else if(isQuery(selector))query=selector;else query=Selection.byRef(selector).compile();return query}Selection.compile=compile;function isEntity(arg){return arg.ref!==void 0}function isBuilder(arg){return arg.compile!==void 0}function isQuery(arg){return typeof arg==="function"}var Helpers;(function(Helpers){Helpers.BuilderPrototype={};function registerModifier(name,f){Helpers.BuilderPrototype[name]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}return f.call.apply(f,[void 0,this].concat(args))}}Helpers.registerModifier=registerModifier})(Helpers=Selection.Helpers||(Selection.Helpers={}));function build(compile){return Object.create(Helpers.BuilderPrototype,{compile:{writable:false,configurable:false,value:compile}})}function root(){return build(function(){return function(tree){return[tree.root]}})}Selection.root=root;function byRef(){var refs=[];for(var _i=0;_i<arguments.length;_i++){refs[_i]=arguments[_i]}return build(function(){return function(tree){var ret=[];for(var _i=0,refs_1=refs;_i<refs_1.length;_i++){var ref=refs_1[_i];var xs=tree.refs.get(ref);if(!xs)continue;for(var _a=0,xs_1=xs;_a<xs_1.length;_a++){var x=xs_1[_a];ret.push(x)}}return ret}})}Selection.byRef=byRef;function byValue(){var entities=[];for(var _i=0;_i<arguments.length;_i++){entities[_i]=arguments[_i]}return build(function(){return function(tree){return entities}})}Selection.byValue=byValue;Helpers.registerModifier("flatMap",flatMap);function flatMap(b,f){var q=compile(b);return build(function(){return function(tree){var ret=[];for(var _i=0,_a=q(tree);_i<_a.length;_i++){var n=_a[_i];for(var _b=0,_c=f(n);_b<_c.length;_b++){var m=_c[_b];ret.push(m)}}return ret}})}Selection.flatMap=flatMap;Helpers.registerModifier("mapEntity",mapEntity);function mapEntity(b,f){var q=compile(b);return build(function(){return function(tree){var ret=[];for(var _i=0,_a=q(tree);_i<_a.length;_i++){var n=_a[_i];var x=f(n);if(x)ret.push(x)}return ret}})}Selection.mapEntity=mapEntity;Helpers.registerModifier("unique",unique);function unique(b){var q=compile(b);return build(function(){return function(tree){var set=LiteMol.Core.Utils.FastSet.create();var ret=[];for(var _i=0,_a=q(tree);_i<_a.length;_i++){var n=_a[_i];if(!set.has(n.id)){set.add(n.id);ret.push(n)}}return ret}})}Selection.unique=unique;Helpers.registerModifier("first",first);function first(b){var q=compile(b);return build(function(){return function(tree){return[q(tree)[0]]}})}Selection.first=first;Helpers.registerModifier("filter",filter);function filter(b,p){return flatMap(b,function(n){return p(n)?[n]:[]})}Selection.filter=filter;Helpers.registerModifier("subtree",subtree);function subtree(b){return flatMap(b,function(n){return Tree.Node.collect(n)})}Selection.subtree=subtree;Helpers.registerModifier("children",children);function children(b){return flatMap(b,function(n){return n.children})}Selection.children=children;Helpers.registerModifier("ofType",ofType);function ofType(b,t){return filter(b,function(n){return n.type===t})}Selection.ofType=ofType;Helpers.registerModifier("ancestorOfType",ancestorOfType);function ancestorOfType(b,t){return unique(mapEntity(b,function(n){return Tree.Node.findAncestor(n,t)}))}Selection.ancestorOfType=ancestorOfType;Helpers.registerModifier("parent",parent);function parent(b){return unique(mapEntity(b,function(n){return n.parent}))}Selection.parent=parent})(Selection=Tree.Selection||(Tree.Selection={}))})(Tree=Bootstrap.Tree||(Bootstrap.Tree={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Tree;(function(Tree){"use strict";var Transformer;(function(Transformer){var TransformerImpl=function(){function TransformerImpl(info,transform,updater){this.info=info;this.transform=transform;this.updater=updater}TransformerImpl.prototype.getTarget=function(node){var info=this.info;return!info.from.length?node:Tree.Node.findClosestNodeOfType(node,info.from)};TransformerImpl.prototype.checkTypes=function(a,t){if(t.transformer!==this){return"The transform is calling an invalid transformer (got "+t.transformer.info.name+", expected "+this.info.name+")"}var info=this.info;if(info.from.length&&info.from.indexOf(a.type)<0){return"Transform ("+info.name+"): type error, expected '"+info.from.map(function(t){return t.info.name}).join("/")+"', got '"+a.type.info.name+"'."}return void 0};TransformerImpl.prototype.validateParams=function(t){var info=this.info;if(info.validateParams){var issues=info.validateParams(t.params);if(issues&&issues.length>0){return"Invalid params: "+issues.join(", ")+"."}}return void 0};TransformerImpl.prototype.validate=function(a,t){var info=this.info;if(!a)return Bootstrap.Task.reject(info.name,"Normal","Could not find a suitable node to apply the transformer to.");var typeCheck=this.checkTypes(a,t);if(typeCheck)return Bootstrap.Task.reject(info.name,"Normal",typeCheck);var paramValidation=this.validateParams(t);if(paramValidation)return Bootstrap.Task.reject(info.name,"Normal",paramValidation);return void 0};TransformerImpl.prototype.apply=function(context,node,t){if(this.info.isComposed)return this.transform(context,node,t);var a=this.getTarget(node);var validationFailed=this.validate(a,t);if(validationFailed)return validationFailed;Bootstrap.Event.Tree.TransformerApply.dispatch(context,{a:a,t:t});return this.transform(context,a,t)};TransformerImpl.prototype.update=function(context,b,t){var node=b.parent;if(this.info.isComposed&&!this.updater)return this.transform(context,node,t);if(this.updater){var paramValidation=this.validateParams(t);if(paramValidation)return Bootstrap.Task.reject(this.info.name,"Normal",paramValidation);var updated=this.updater(context,b,t);if(updated)return updated}Bootstrap.Event.Tree.TransformerApply.dispatch(context,{a:b.parent,t:t});return this.transform(context,node,t)};TransformerImpl.prototype.create=function(params,props){return Tree.Transform.create(params,props?props:{},this)};return TransformerImpl}();function create(info,transform,updater){return new TransformerImpl(info,transform,updater)}Transformer.create=create;function internal(id,from,to,transform){return create({id:id,name:id,description:"",from:from,to:to,validateParams:function(){return void 0},defaultParams:function(){return{}}},transform)}Transformer.internal=internal;function rejectAction(actionContext,error,context,reject,onError){try{reject(error)}finally{if(onError){if(typeof onError==="string"){context.logger.error(onError)}else{setTimeout(function(){return onError.call(null,context,actionContext,error)},0)}}}}function resolveAction(src,context,resolve,reject,onDone,onError){return __awaiter(this,void 0,void 0,function(){var e_2;return __generator(this,function(_a){switch(_a.label){case 0:_a.trys.push([0,2,,3]);return[4,Tree.Transform.apply(context,src.action).run()];case 1:_a.sent();try{resolve(Tree.Node.Null)}finally{if(onDone){if(typeof onDone==="string"){context.logger.message(onDone)}else{setTimeout(function(){return onDone.call(null,context,src.context)},0)}}}return[3,3];case 2:e_2=_a.sent();try{reject(e_2)}finally{if(onError){if(typeof onError==="string"){context.logger.error(onError)}else{setTimeout(function(){return onError.call(null,context,src.context,e_2)},0)}}}return[3,3];case 3:return[2]}})})}function action(info,builder,onDone,onError){return create(info,function(context,a,t){return Bootstrap.Task.create(info.name,"Background",function(ctx){return new LiteMol.Promise(function(res,rej){try{var src=builder(context,a,t);resolveAction({action:src,context:void 0},context,res,rej,onDone,onError)}catch(e){rej(e)}})})})}Transformer.action=action;function actionWithContext(info,builder,onDone,onError){return create(info,function(context,a,t){return Bootstrap.Task.create(info.name,"Background",function(ctx){return new LiteMol.Promise(function(res,rej){try{var src=builder(context,a,t);if(Bootstrap.Task.isPromise(src)){src.then(function(s){return resolveAction(s,context,res,rej,onDone,onError)}).catch(function(e){return rejectAction(void 0,e,context,rej,onError)})}else{resolveAction(src,context,res,rej,onDone,onError)}}catch(e){rej(e)}})})})}Transformer.actionWithContext=actionWithContext})(Transformer=Tree.Transformer||(Tree.Transformer={}))})(Tree=Bootstrap.Tree||(Bootstrap.Tree={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Tree;(function(Tree){"use strict";var Transform;(function(Transform){var TransformImpl=function(){function TransformImpl(params,props,transformer){this.params=params;this.props=props;this.transformer=transformer;this.isUpdate=false}TransformImpl.prototype.resolveAdd=function(a,b){if(b===Tree.Node.Null){return b}b.ref=this.props.ref;if(this.props.isHidden)b.isHidden=true;if(!b.tree){b.parent=a;Tree.add(b)}return b};TransformImpl.prototype.resolveUpdate=function(context,b,newB){if(newB===Tree.Node.Null){return newB}var a=b.parent;newB.ref=this.props.ref;newB.parent=a;newB.tag=b.tag;newB.state=b.state;if(this.props.isHidden)newB.isHidden=true;Tree.update(context.tree,b,newB);return newB};TransformImpl.prototype.apply=function(context,a){var _this=this;return LiteMol.Core.computation(function(ctx){return new LiteMol.Promise(function(res,rej){return __awaiter(_this,void 0,void 0,function(){var _this=this;return __generator(this,function(_a){Bootstrap.Event.Tree.TransformStarted.dispatch(context,this);this.transformer.apply(context,a,this).run(context).then(function(b){res(_this.resolveAdd(a,b));Bootstrap.Event.Tree.TransformFinished.dispatch(context,{transform:_this})}).catch(function(e){rej(e);Bootstrap.Event.Tree.TransformFinished.dispatch(context,{transform:_this,error:e})});return[2]})})})})};TransformImpl.prototype.update=function(context,b){var _this=this;return LiteMol.Core.computation(function(ctx){return new LiteMol.Promise(function(res,rej){_this.isUpdate=true;_this.props.ref=b.transform.props.ref;Bootstrap.Event.Tree.TransformStarted.dispatch(context,_this);if(b.transform.props.isBinding)_this.props.isBinding=true;_this.transformer.update(context,b,_this).run(context).then(function(newB){res(_this.resolveUpdate(context,b,newB));Bootstrap.Event.Tree.TransformFinished.dispatch(context,{transform:_this})}).catch(function(e){rej(e);Bootstrap.Event.Tree.TransformFinished.dispatch(context,{transform:_this,error:e})})})})};return TransformImpl}();function create(params,props,transformer){var p=Bootstrap.Utils.shallowClone(props);if(!p.ref)p.ref=Bootstrap.Utils.generateUUID();return new TransformImpl(params,p,transformer)}Transform.create=create;function isInstance(arg){return!!arg.selector}function isBuilder(arg){return!!arg.compile}function execute(ctx,source,isUpdate){var _this=this;var instances;try{if(isInstance(source))instances=[source];else if(isBuilder(source))instances=source.compile();else instances=source}catch(e){return LiteMol.Core.Computation.reject(e)}return LiteMol.Core.computation(function(){return __awaiter(_this,void 0,void 0,function(){var _i,instances_1,i,xs,_a,xs_2,x,e_3;return __generator(this,function(_b){switch(_b.label){case 0:_i=0,instances_1=instances;_b.label=1;case 1:if(!(_i<instances_1.length))return[3,8];i=instances_1[_i];xs=ctx.select(i.selector);_a=0,xs_2=xs;_b.label=2;case 2:if(!(_a<xs_2.length))return[3,7];x=xs_2[_a];_b.label=3;case 3:_b.trys.push([3,5,,6]);return[4,(isUpdate?i.transform.update(ctx,x):i.transform.apply(ctx,x)).run()];case 4:_b.sent();return[3,6];case 5:e_3=_b.sent();return[3,6];case 6:_a++;return[3,2];case 7:_i++;return[3,1];case 8:return[2]}})})})}Transform.execute=execute;function apply(ctx,source){return execute(ctx,source,false)}Transform.apply=apply;function update(ctx,source){return execute(ctx,source,true)}Transform.update=update})(Transform=Tree.Transform||(Tree.Transform={}))})(Tree=Bootstrap.Tree||(Bootstrap.Tree={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Tree;(function(Tree){var Transform;(function(Transform){"use strict";function build(){return new Builder.Impl(void 0,[])}Transform.build=build;var Builder;(function(Builder){var Impl=function(){function Impl(last,transforms){this.last=last;this.transforms=transforms}Impl.prototype.add=function(s,t,params,props){var i={selector:s,transform:t.create(params,props)};this.transforms.push(i);this.last=i;return new Impl(i,this.transforms)};Impl.prototype.then=function(t,params,props){if(!this.last)throw"Cannot 'then' on an empty builder";var transform=t.create(params,props);var i={selector:this.last.transform.props.ref,transform:transform};this.transforms.push(i);return new Impl(i,this.transforms)};Impl.prototype.compile=function(){return this.transforms};return Impl}();Builder.Impl=Impl})(Builder=Transform.Builder||(Transform.Builder={}))})(Transform=Tree.Transform||(Tree.Transform={}))})(Tree=Bootstrap.Tree||(Bootstrap.Tree={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Interactivity;(function(Interactivity){"use strict";var Info;(function(Info){Info.empty={kind:0};function selection(source,elements){return{kind:1,source:source,elements:elements}}Info.selection=selection})(Info=Interactivity.Info||(Interactivity.Info={}));function isEmpty(info){return info.kind===0||!info.source.tree}Interactivity.isEmpty=isEmpty;function isSelection(info){return info.kind===1&&!!info.source.tree}Interactivity.isSelection=isSelection;function interactivityInfoEqual(a,b){if(!a&&!b)return true;if(!a||!b)return false;if(a.kind!==b.kind)return false;if(a.kind===0)return true;if(a.source!==b.source)return false;var x=a.elements,y=b.elements;if(x.length!==y.length)return false;for(var i=0,_l=x.length;i<_l;i++){if(x[i]!==y[i])return false}return true}Interactivity.interactivityInfoEqual=interactivityInfoEqual;function interactivitySelectionElementsEqual(a,b){var x=a.elements,y=b.elements;if(x.length!==y.length)return false;for(var i=0,_l=x.length;i<_l;i++){if(x[i]!==y[i])return false}return true}Interactivity.interactivitySelectionElementsEqual=interactivitySelectionElementsEqual})(Interactivity=Bootstrap.Interactivity||(Bootstrap.Interactivity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Interactivity;(function(Interactivity){"use strict";var HighlightManager=function(){function HighlightManager(context){var _this=this;this.context=context;this.providers=[];this.empty=[];Bootstrap.Event.Visual.VisualHoverElement.getStream(context).subscribe(function(ev){return Bootstrap.Event.Interactivity.Highlight.dispatch(context,_this.getInfo(ev.data))})}HighlightManager.prototype.addProvider=function(provider){this.providers.push(provider)};HighlightManager.prototype.removeProvider=function(provider){this.providers=this.providers.filter(function(p){return p!==provider});Bootstrap.Event.Interactivity.Highlight.dispatch(this.context,[])};HighlightManager.prototype.getInfo=function(i){if(!i)return this.empty;var info=[];for(var _i=0,_a=this.providers;_i<_a.length;_i++){var p=_a[_i];var e=p.call(null,i);if(e)info.push(e)}return info};return HighlightManager}();Interactivity.HighlightManager=HighlightManager})(Interactivity=Bootstrap.Interactivity||(Bootstrap.Interactivity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Interactivity;(function(Interactivity){var Molecule;(function(Molecule){"use strict";function transformMoleculeAtomIndices(model,context,indices){var m=context.structure;var _a=m.data.atoms,residueIndex=_a.residueIndex,chainIndex=_a.chainIndex,entityIndex=_a.entityIndex,name=_a.name,authName=_a.authName,id=_a.id,occupancy=_a.occupancy,tempFactor=_a.tempFactor,elementSymbol=_a.elementSymbol,altLoc=_a.altLoc;var _b=m.positions,x=_b.x,y=_b.y,z=_b.z;var _c=m.data.residues,resName=_c.name,resAuthName=_c.authName,seqNumber=_c.seqNumber,authSeqNumber=_c.authSeqNumber,insCode=_c.insCode,isHet=_c.isHet;var _d=m.data.chains,asymId=_d.asymId,authAsymId=_d.authAsymId;var entityId=m.data.entities.entityId;var aI=-1,eI=-1,cI=-1,rI=-1;var e,c,r,a;var eP=function(){return e={index:eI,entityId:entityId[eI]}};var cP=function(){return c={index:cI,asymId:asymId[cI],authAsymId:authAsymId[cI],entity:e}};var rP=function(){return r={index:rI,name:resName[rI],authName:resAuthName[rI],seqNumber:seqNumber[rI],authSeqNumber:authSeqNumber[rI],insCode:insCode[rI],isHet:isHet[rI],chain:c}};var aP=function(){return a={index:aI,id:id[aI],name:name[aI],authName:authName[aI],elementSymbol:elementSymbol[aI],occupancy:occupancy[aI],tempFactor:tempFactor[aI],x:x[aI],y:y[aI],z:z[aI],altLoc:altLoc[aI],residue:r}};var entities=[];var chains=[];var residues=[];var atoms=[];for(var i=0;i<indices.length;i++){aI=indices[i];if(!context.hasAtom(aI))continue;if(eI!==entityIndex[aI]){eI=entityIndex[aI];entities.push(eP())}if(cI!==chainIndex[aI]){cI=chainIndex[aI];chains.push(cP())}if(rI!==residueIndex[aI]){rI=residueIndex[aI];residues.push(rP())}atoms.push(aP())}return{modelRef:model.ref,moleculeId:m.id,modelId:m.modelId,atoms:atoms,residues:residues,chains:chains,entities:entities}}Molecule.transformMoleculeAtomIndices=transformMoleculeAtomIndices;function transformInteraction(info){if(Interactivity.isEmpty(info))return void 0;var modelOrSelection=Bootstrap.Utils.Molecule.findModelOrSelection(info.source);if(!modelOrSelection)return void 0;var context=Bootstrap.Utils.Molecule.findQueryContext(modelOrSelection);var model=Bootstrap.Utils.Molecule.findModel(modelOrSelection);if(!context||!model)return void 0;return transformMoleculeAtomIndices(model,context,info.elements)}Molecule.transformInteraction=transformInteraction;function formatAtomExtra(a){var extras=[];if(a.occupancy!==1){extras.push("occupancy "+Bootstrap.Utils.round(a.occupancy,2))}if(a.altLoc){extras.push("alt. loc "+a.altLoc)}if(!extras.length)return"";return" <small>["+extras.join(", ")+"]</small>"}function formatAtom(a){return"<span><b>"+a.name+" "+a.elementSymbol+" "+a.id+"</b>"+formatAtomExtra(a)+" at ("+Bootstrap.Utils.round(a.x,1)+", "+Bootstrap.Utils.round(a.y,1)+", "+Bootstrap.Utils.round(a.z,1)+")</span>"}function formatAtomShort(a){return"<span>"+a.name+" "+a.elementSymbol+" "+a.id+formatAtomExtra(a)+"</span>"}function formatResidue(r){return"<span>"+r.authName+" "+r.chain.authAsymId+" "+r.authSeqNumber+(r.insCode!==null?" i: "+r.insCode:"")+"</span>"}function formatMolecule(info){if(info.modelId==="1"){return"<span><small>["+info.moleculeId+"]</small></span>"}return"<span><small>["+info.moleculeId+":"+info.modelId+"]</small></span>"}function formatInfo(info){if(!info||!info.atoms.length)return"";if(info.atoms.length===1){return"<span>"+formatAtom(info.atoms[0])+" on <b><small>"+formatResidue(info.residues[0])+"</small></b> "+formatMolecule(info)+"</span>"}else if(info.residues.length===1){return"<span><b>"+formatResidue(info.residues[0])+"</b> "+formatMolecule(info)+"</span>"}else{return"<span><small>"+info.atoms.length+" atoms on</small> <b>"+info.residues.length+" residues</b> "+formatMolecule(info)+"</span>"}}Molecule.formatInfo=formatInfo;function formatInfoShort(info){if(!info||!info.atoms.length)return"";if(info.atoms.length===1){return"<span><b>"+formatAtomShort(info.atoms[0])+"</b> "+formatMolecule(info)+"</span>"}else if(info.residues.length===1){return"<span><b>"+formatResidue(info.residues[0])+"</b> "+formatMolecule(info)+"</span>"}else{return"<span><b>"+info.residues.length+" residues</b> "+formatMolecule(info)+"</span>"}}Molecule.formatInfoShort=formatInfoShort;function isMoleculeModelInteractivity(info){if(Interactivity.isEmpty(info))return false;if(info.source.type.info.typeClass===Bootstrap.Entity.VisualClass&&info.source.type!==Bootstrap.Entity.Molecule.Visual)return false;var modelOrSelection=Bootstrap.Utils.Molecule.findModelOrSelection(info.source);if(!modelOrSelection)return false;return true}Molecule.isMoleculeModelInteractivity=isMoleculeModelInteractivity})(Molecule=Interactivity.Molecule||(Interactivity.Molecule={}))})(Interactivity=Bootstrap.Interactivity||(Bootstrap.Interactivity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){"use strict";var DisplayList=function(){function DisplayList(context,scene){var _this=this;this.context=context;this.scene=scene;this.entries=new Map;this.originalThemes=new Map;Bootstrap.Event.Tree.NodeAdded.getStream(context).subscribe(function(e){if(!Bootstrap.Entity.isClass(e.data,Bootstrap.Entity.VisualClass))return;_this.add(e.data)});Bootstrap.Event.Tree.NodeRemoved.getStream(context).subscribe(function(e){if(!Bootstrap.Entity.isClass(e.data,Bootstrap.Entity.VisualClass))return;_this.remove(e.data)});Bootstrap.Event.Tree.NodeUpdated.getStream(context).subscribe(function(e){if(!Bootstrap.Entity.isVisual(e.data))return;var m=_this.entries.get(e.data.id);if(!m)return;var vis=m.state.visibility!==2;if(m.props.model.getVisibility()!==vis){m.props.model.updateVisibility(vis)}});Bootstrap.Command.Visual.UpdateBasicTheme.getStream(context).subscribe(function(e){if(!_this.entries.get(e.data.visual.id)||!Bootstrap.Entity.isVisual(e.data.visual))return;var v=e.data.visual;if(e.data.theme.isSticky){_this.originalThemes.set(v.id,e.data.theme)}else if(!_this.originalThemes.get(v.id)){_this.originalThemes.set(v.id,v.props.model.theme)}v.props.model.applyTheme(e.data.theme)});Bootstrap.Command.Molecule.Highlight.getStream(context).subscribe(function(e){return _this.highlightMoleculeModel(e.data)});Bootstrap.Command.Visual.ResetTheme.getStream(context).subscribe(function(e){return _this.resetThemesAndHighlight(e.data&&e.data.selection)})}DisplayList.prototype.isEmpty=function(){return!this.entries.size};DisplayList.prototype.add=function(v){if(this.entries.has(v.id)||!v.props.model)return false;this.entries.set(v.id,v);this.scene.scene.models.add(v.props.model,this.entries.size===1);var vis=v.state.visibility!==2;if(v.props.model.getVisibility()!==vis){v.props.model.updateVisibility(vis)}v.props.model.tag=v;return true};DisplayList.prototype.remove=function(v){if(!this.entries.has(v.id))return false;this.entries.delete(v.id);this.originalThemes.delete(v.id);this.scene.scene.models.removeAndDispose(v.props.model);v.props.model.tag=void 0;v.props.model=void 0;return true};DisplayList.prototype.get=function(id){return this.entries.get(id)};DisplayList.prototype.resetThemesAndHighlight=function(sel){var _this=this;if(!sel){this.originalThemes.forEach(function(t,id){var model=_this.entries.get(id).props.model;if(!model.theme.isSticky){model.applyTheme(t);_this.originalThemes.delete(id)}else{_this.originalThemes.set(id,model.theme)}});this.entries.forEach(function(v){return v.props.model.highlight(false)});this.scene.scene.forceRender();return}var es=this.context.select(sel);for(var _i=0,es_1=es;_i<es_1.length;_i++){var e=es_1[_i];if(!Bootstrap.Entity.isVisual(e)||!this.originalThemes.has(e.id))continue;var v=e;var t=this.originalThemes.get(v.id);var model=v.props.model;if(!model.theme.isSticky){model.applyTheme(t);this.originalThemes.delete(v.id)}else{this.originalThemes.set(v.id,model.theme)}model.highlight(false)}this.scene.scene.forceRender()};DisplayList.prototype.highlightMoleculeModel=function(what){var _this=this;var model=Bootstrap.Utils.Molecule.findModel(what.model);if(!model){console.warn("Highlight: Trying to highlight a non-molecule model entity, ignoring...");return}var targets=[];this.context.select(Bootstrap.Tree.Selection.byValue(what.model).subtree()).forEach(function(n){if(Bootstrap.Entity.isVisual(n)&&_this.entries.get(n.id))targets.push(n)});if(!targets.length)return;var q=Bootstrap.Utils.Molecule.getModelAndIndicesFromQuery(model,what.query);if(!q||!q.indices.length)return;var action=what.isOn?3:4;for(var _i=0,targets_1=targets;_i<targets_1.length;_i++){var t=targets_1[_i];t.props.model.applySelection(q.indices,action)}};return DisplayList}();Visualization.DisplayList=DisplayList;var SceneWrapper=function(){function SceneWrapper(element,context,options){var _this=this;this.context=context;this._destroyed=false;this.cameraChanged=new Bootstrap.Rx.Subject;this.cameraObserver=function(c){return _this.cameraChanged.onNext(c)};this.models=new DisplayList(context,this);this.scene=new LiteMol.Visualization.Scene(element,options);this.scene.camera.observe(this.cameraObserver);this.scene.events.addEventListener("hover",function(e){return _this.handleEvent(e,Bootstrap.Event.Visual.VisualHoverElement)});this.scene.events.addEventListener("select",function(e){return _this.handleEvent(e,Bootstrap.Event.Visual.VisualSelectElement)});this.cameraChanged.throttle(1e3/30).subscribe(function(c){Bootstrap.Event.Visual.CameraChanged.dispatch(_this.context,c)});Bootstrap.Command.Entity.Focus.getStream(context).subscribe(function(e){if(e.data.length===1){var t=e.data[0];if(Bootstrap.Entity.isMoleculeSelection(t)){_this.focusMoleculeModelSelection(t)}else if(Bootstrap.Entity.isClass(t,Bootstrap.Entity.VisualClass)){_this.scene.camera.focusOnModel(t.props.model)}}else{(_a=_this.scene.camera).focusOnModel.apply(_a,e.data.filter(function(e){return Bootstrap.Entity.isClass(e,Bootstrap.Entity.VisualClass)}).map(function(e){return e.props.model}))}var _a});Bootstrap.Command.Entity.Highlight.getStream(context).subscribe(function(e){for(var _i=0,_a=e.data.entities;_i<_a.length;_i++){var v=_a[_i];if(!Bootstrap.Entity.isClass(v,Bootstrap.Entity.VisualClass)||!v.props.model)continue;v.props.model.highlight(e.data.isOn)}});Bootstrap.Command.Visual.ResetScene.getStream(context).subscribe(function(e){return _this.resetScene()});Bootstrap.Command.Molecule.FocusQuery.getStream(context).subscribe(function(e){return _this.focusMoleculeModelOnQuery(e.data)})}SceneWrapper.prototype.resetScene=function(){if(this._destroyed)return;Bootstrap.Event.Visual.VisualSelectElement.dispatch(this.context,Bootstrap.Interactivity.Info.empty);this.models.resetThemesAndHighlight();this.scene.camera.reset()};Object.defineProperty(SceneWrapper.prototype,"camera",{get:function(){return this.scene.camera},enumerable:true,configurable:true});SceneWrapper.prototype.destroy=function(){if(this._destroyed)return;this.scene.camera.stopObserving(this.cameraObserver);this.scene.destroy();this.scene=void 0;this._destroyed=true};SceneWrapper.prototype.handleEvent=function(e,event){var data=e.data;if(data&&data.model&&data.elements){event.dispatch(this.context,Bootstrap.Interactivity.Info.selection(data.model.tag,data.elements))}else{event.dispatch(this.context,Bootstrap.Interactivity.Info.empty)}};SceneWrapper.prototype.focusMoleculeModelSelection=function(sel){if(!Bootstrap.Tree.Node.is(sel,Bootstrap.Entity.Molecule.Selection)){console.warn("Focus: Trying to focus on non-molecule selection, ignoring...");return}var model=Bootstrap.Utils.Molecule.findModel(sel);if(!model){console.warn("Focus: Molecule model for selection not found, ignoring...");return}var center=LiteMol.Core.Geometry.LinearAlgebra.Vector3.zero();var r=Bootstrap.Utils.Molecule.getCentroidAndRadius(model.props.model,sel.props.indices,center);this.scene.camera.focusOnPoint(LiteMol.Core.Geometry.LinearAlgebra.Vector3.toObj(center),r)};SceneWrapper.prototype.focusMoleculeModelOnQuery=function(what){var q=Bootstrap.Utils.Molecule.getModelAndIndicesFromQuery(what.model,what.query);if(!q||!q.indices.length)return;var center=LiteMol.Core.Geometry.LinearAlgebra.Vector3.zero();var r=Bootstrap.Utils.Molecule.getCentroidAndRadius(q.model.props.model,q.indices,center);this.scene.camera.focusOnPoint(LiteMol.Core.Geometry.LinearAlgebra.Vector3.toObj(center),r)};return SceneWrapper}();Visualization.SceneWrapper=SceneWrapper})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){"use strict";var Style;(function(Style){function getTaskType(style){return!style.taskType?"Normal":style.taskType}Style.getTaskType=getTaskType;function create(style){return style}Style.create=create})(Style=Visualization.Style||(Visualization.Style={}));var Theme;(function(Theme){function getProps(theme){var colors=LiteMol.Core.Utils.FastMap.create();if(theme.colors)theme.colors.forEach(function(c,n){return colors.set(n,c)});var variables=LiteMol.Core.Utils.FastMap.create();if(theme.variables)theme.variables.forEach(function(c,n){return variables.set(n,c)});return{colors:colors,variables:variables,transparency:theme.transparency,interactive:theme.interactive,disableFog:theme.disableFog,isSticky:true}}Theme.getProps=getProps})(Theme=Visualization.Theme||(Visualization.Theme={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Molecule;(function(Molecule){"use strict";var Vis=LiteMol.Visualization;Molecule.UniformBaseColors=Bootstrap.Immutable.Map({Uniform:Vis.Theme.Default.UniformColor,Highlight:Vis.Theme.Default.HighlightColor,Selection:Vis.Theme.Default.SelectionColor});Molecule.ModelVisualBaseColors=Bootstrap.Immutable.Map({Bond:Vis.Molecule.Colors.DefaultBondColor,Highlight:Vis.Theme.Default.HighlightColor,Selection:Vis.Theme.Default.SelectionColor});function mappingClosure(index,property){return function(i){return property[index[i]]}}function createPaletteThemeProvider(provider,pallete){return function(e,props){var model=Bootstrap.Utils.Molecule.findModel(e).props.model;var map=provider(model);var mapping=Vis.Theme.createPalleteMapping(mappingClosure(map.index,map.property),pallete);return Vis.Theme.createMapping(mapping,props)}}Molecule.createPaletteThemeProvider=createPaletteThemeProvider;function createCachedPaletteThemeProvider(name,provider,pallete){return function(e,props){var modelE=Bootstrap.Utils.Molecule.findModel(e);var ctx=modelE.tree&&modelE.tree.context;if(ctx){var mapping_1=ctx.entityCache.get(modelE,"theme-mapping-"+name);if(mapping_1){return Vis.Theme.createMapping(mapping_1,props)}}var model=modelE.props.model;var map=provider(model);var mapping=Vis.Theme.createPalleteMapping(mappingClosure(map.index,map.property),pallete);if(ctx)ctx.entityCache.set(e,"theme-mapping-"+name,mapping);return Vis.Theme.createMapping(mapping,props)}}Molecule.createCachedPaletteThemeProvider=createCachedPaletteThemeProvider;function uniformThemeProvider(e,props){if(props&&props.colors){if(!props.colors.get("Bond")&&props.colors.get("Uniform")){var oldColors=props.colors;props=Bootstrap.Utils.assign({},props);var newColors_1=LiteMol.Core.Utils.FastMap.create();props.colors=newColors_1;oldColors.forEach(function(color,key){return newColors_1.set(key,color)});newColors_1.set("Bond",props.colors.get("Uniform"))}}return Vis.Theme.createUniform(props)}Molecule.uniformThemeProvider=uniformThemeProvider;function createColorMapThemeProvider(provider,colorMap,fallbackColor){return function(e,props){var modelE=Bootstrap.Utils.Molecule.findModel(e);var model=modelE.props.model;var map=provider(model);var mapping=Vis.Theme.createColorMapMapping(mappingClosure(map.index,map.property),colorMap,fallbackColor);return Vis.Theme.createMapping(mapping,props)}}Molecule.createColorMapThemeProvider=createColorMapThemeProvider;function createCachedColorMapThemeProvider(name,provider,colorMap,fallbackColor){return function(e,props){var modelE=Bootstrap.Utils.Molecule.findModel(e);var ctx=modelE.tree&&modelE.tree.context;if(ctx){var mapping_2=ctx.entityCache.get(modelE,"theme-mapping-map-"+name);if(mapping_2){return Vis.Theme.createMapping(mapping_2,props)}}var model=modelE.props.model;var map=provider(model);var mapping=Vis.Theme.createColorMapMapping(mappingClosure(map.index,map.property),colorMap,fallbackColor);if(ctx)ctx.entityCache.set(e,"theme-mapping-map-"+name,mapping);return Vis.Theme.createMapping(mapping,props)}}Molecule.createCachedColorMapThemeProvider=createCachedColorMapThemeProvider;var RainbowMapping=function(){function RainbowMapping(model,_a){var r=_a.r,g=_a.g,b=_a.b;this.residueIndex=model.data.atoms.residueIndex;this.r=r;this.g=g;this.b=b}RainbowMapping.prototype.getProperty=function(index){return this.residueIndex[index]};RainbowMapping.prototype.setColor=function(i,color){color.r=this.r[i];color.g=this.g[i];color.b=this.b[i]};return RainbowMapping}();Molecule.RainbowPalette=[Vis.Color.fromHex(13378048),Vis.Color.fromHex(13399808),Vis.Color.fromHex(13412864),Vis.Color.fromHex(52224),Vis.Color.fromHex(43724),Vis.Color.fromHex(204),Vis.Color.fromHex(8989394),Vis.Color.fromHex(12025059)];var RainbowBaseColors=Bootstrap.Immutable.Map({Bond:Vis.Molecule.Colors.DefaultBondColor,Highlight:Vis.Color.fromHex(16777215),Selection:Vis.Color.fromHex(9863168)});function makeRainbow(model,groupsSource,groupId){var rC=model.data.residues.count;var _a={r:new Float32Array(rC),g:new Float32Array(rC),b:new Float32Array(rC)},r=_a.r,g=_a.g,b=_a.b;var groups=groupsSource(model);var count=groups.count,residueStartIndex=groups.residueStartIndex,residueEndIndex=groups.residueEndIndex;var cC=Molecule.RainbowPalette.length-1;var color=Vis.Color.fromHex(0);var strips=LiteMol.Core.Utils.FastMap.create();for(var cI=0;cI<count;cI++){var id=groupId(groups,cI);var l=residueEndIndex[cI]-residueStartIndex[cI];if(strips.has(id)){strips.get(id).count+=l}else{strips.set(id,{index:0,count:l})}}strips.forEach(function(s){return s.count=Math.max(s.count-1,1)});for(var cI=0;cI<count;cI++){var s=residueStartIndex[cI],l=residueEndIndex[cI]-s;var strip=strips.get(groupId(groups,cI));var max=strip.count;for(var i=0;i<l;i++){var t=cC*strip.index/max;var low=Math.floor(t),high=Math.ceil(t);Vis.Color.interpolate(Molecule.RainbowPalette[low],Molecule.RainbowPalette[high],t-low,color);r[s+i]=color.r;g[s+i]=color.g;b[s+i]=color.b;strip.index++}}return{r:r,g:g,b:b}}function createRainbowProvider(groups,groupId){return function(e,props){var model=Bootstrap.Utils.Molecule.findModel(e).props.model;var colors=makeRainbow(model,groups,groupId);var mapping=new RainbowMapping(model,colors);return Vis.Theme.createMapping(mapping,props)}}var Default;(function(Default){Default.Themes=[{name:"Chain ID",description:"Color the surface by Chain ID.",colors:Molecule.ModelVisualBaseColors,provider:createCachedPaletteThemeProvider("chain-id",function(m){return{index:m.data.atoms.residueIndex,property:m.data.residues.asymId}},Vis.Molecule.Colors.DefaultPallete)},{name:"Entity ID",description:"Color the surface by Entity ID.",colors:Molecule.ModelVisualBaseColors,provider:createPaletteThemeProvider(function(m){return{index:m.data.atoms.residueIndex,property:m.data.residues.entityId}},Vis.Molecule.Colors.DefaultPallete)},{name:"Entity Type",description:"Color the surface by Entity Type.",colors:Molecule.ModelVisualBaseColors,provider:createPaletteThemeProvider(function(m){return{index:m.data.atoms.entityIndex,property:m.data.entities.type}},Vis.Molecule.Colors.DefaultPallete)},{name:"Residue Name",description:"Color the surface by residue name.",colors:Molecule.ModelVisualBaseColors,provider:createPaletteThemeProvider(function(m){return{index:m.data.atoms.residueIndex,property:m.data.residues.name}},Vis.Molecule.Colors.DefaultPallete)},{name:"Element Symbol",description:"Color the surface by atom elemnt symbol.",colors:Molecule.ModelVisualBaseColors,provider:createColorMapThemeProvider(function(m){return{index:m.data.atoms.indices,property:m.data.atoms.elementSymbol}},Vis.Molecule.Colors.DefaultElementColorMap,Vis.Molecule.Colors.DefaultElementColor)},{name:"Rainbow (Chain)",description:"Color each chain using rainbow palette.",colors:RainbowBaseColors,provider:createRainbowProvider(function(m){return m.data.chains},function(t,i){return t.asymId[i]+" "+t.entityId[i]})},{name:"Rainbow (Entity)",description:"Color each entity using rainbow palette.",colors:RainbowBaseColors,provider:createRainbowProvider(function(m){return m.data.entities},function(t,i){return t.entityId[i]})},{name:"Uniform Color",description:"Same color everywhere.",colors:Molecule.UniformBaseColors,provider:uniformThemeProvider}];Default.CartoonThemeTemplate=Default.Themes.filter(function(t){return t.name==="Chain ID"})[0];Default.ElementSymbolThemeTemplate=Default.Themes.filter(function(t){return t.name==="Element Symbol"})[0];Default.SurfaceThemeTemplate=Default.Themes.filter(function(t){return t.name==="Uniform Color"})[0];Default.UniformThemeTemplate=Default.Themes.filter(function(t){return t.name==="Uniform Color"})[0];Default.RainbowEntityThemeTemplate=Default.Themes.filter(function(t){return t.name==="Rainbow (Entity)"})[0]})(Default=Molecule.Default||(Molecule.Default={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Molecule;(function(Molecule){"use strict";Molecule.TypeDescriptions={Cartoons:{label:"Cartoon",shortLabel:"Cartoon"},Calpha:{label:"C-α Trace",shortLabel:"C-α"},BallsAndSticks:{label:"Balls and Sticks",shortLabel:"B'n'S"},VDWBalls:{label:"VDW Balls",shortLabel:"VDW"},Surface:{label:"Surface",shortLabel:"Surface"}};Molecule.Types=["Cartoons","Calpha","BallsAndSticks","VDWBalls","Surface"];Molecule.DetailTypes=["Automatic","Very Low","Low","Medium","High","Very High"];var Default;(function(Default){Default.DetailParams={detail:"Automatic"};Default.BallsAndSticksParams={useVDW:true,vdwScaling:.22,atomRadius:.35,bondRadius:.09,hideHydrogens:false,customMaxBondLengths:void 0,detail:"Automatic"};Default.SurfaceParams={probeRadius:.4,automaticDensity:true,density:1.1,smoothing:10,isWireframe:false};Default.Transparency={alpha:1,writeDepth:false};Default.ForType=function(){var types={Cartoons:{type:"Cartoons",params:{detail:"Automatic"},theme:{template:Default.CartoonThemeTemplate,colors:Default.CartoonThemeTemplate.colors,transparency:Default.Transparency,interactive:true}},Calpha:{type:"Calpha",params:{detail:"Automatic"},theme:{template:Default.CartoonThemeTemplate,colors:Default.CartoonThemeTemplate.colors,transparency:Default.Transparency,interactive:true}},BallsAndSticks:{type:"BallsAndSticks",params:Default.BallsAndSticksParams,theme:{template:Default.ElementSymbolThemeTemplate,colors:Default.ElementSymbolThemeTemplate.colors,transparency:Default.Transparency,interactive:true}},VDWBalls:{type:"VDWBalls",params:{detail:"Automatic"},theme:{template:Default.ElementSymbolThemeTemplate,colors:Default.ElementSymbolThemeTemplate.colors,transparency:Default.Transparency,interactive:true}},Surface:{type:"Surface",params:Default.SurfaceParams,theme:{template:Default.SurfaceThemeTemplate,colors:Default.SurfaceThemeTemplate.colors,transparency:{alpha:.33,writeDepth:false},interactive:true}}};var map=new Map;for(var _i=0,_a=Object.keys(types);_i<_a.length;_i++){var k=_a[_i];map.set(k,types[k])}return map}()})(Default=Molecule.Default||(Molecule.Default={}))})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Molecule;(function(Molecule){"use strict";var Vis=LiteMol.Visualization;var MolVis=LiteMol.Visualization.Molecule;function getTessalation(type,count){if(type==="Automatic"){if(count<250)return 5;if(count<1e3)return 4;if(count<75e3)return 3;if(count<25e4)return 2;if(count<6e5)return 1;return 0}var d=Molecule.DetailTypes.indexOf(type)-1;return Math.max(d,0)}function getSurfaceDensity(params,model,indices){if(!!params.automaticDensity){var _a=Bootstrap.Utils.Molecule.getBox(model,indices,0),bottomLeft=_a.bottomLeft,topRight=_a.topRight;var box=LiteMol.Core.Geometry.LinearAlgebra.Vector3.sub(topRight,topRight,bottomLeft);var density=Math.pow(Math.pow(99,3)/(box[0]*box[1]*box[2]),1/3);if(density>1.2)return 1.2;if(density<.1)return.1;return density}if(params.density!==void 0)return+params.density;return 1}function createCartoonParams(tessalation,isAlphaTrace){return{tessalation:tessalation,drawingType:isAlphaTrace?MolVis.Cartoons.CartoonsModelType.AlphaTrace:MolVis.Cartoons.CartoonsModelType.Default}}function makeRadiusFunc(model,parameters){if(!parameters.useVDW){return function(r){return function(){return r}}(parameters.atomRadius)}var vdw=Bootstrap.Utils.vdwRadiusFromElementSymbol(model);return function(s,vdw){return function(i){return s*vdw(i)}}(parameters.vdwScaling,vdw)}function createBallsAndSticksParams(tessalation,model,parameters){var customMaxBondLengths=void 0;if(parameters.customMaxBondLengths){var keys=Object.getOwnPropertyNames(parameters.customMaxBondLengths);if(keys.length>0)customMaxBondLengths=LiteMol.Core.Utils.FastMap.create();for(var _i=0,keys_3=keys;_i<keys_3.length;_i++){var key=keys_3[_i];customMaxBondLengths.set(key,parameters.customMaxBondLengths[key])}}return{tessalation:tessalation,bondRadius:parameters.bondRadius,hideBonds:false,hideHydrogens:!!parameters.hideHydrogens,atomRadius:makeRadiusFunc(model,parameters),customMaxBondLengths:customMaxBondLengths}}function createVDWBallsParams(tessalation,model){return{tessalation:tessalation,bondRadius:0,hideBonds:true,atomRadius:Bootstrap.Utils.vdwRadiusFromElementSymbol(model)}}function createModel(source,style,theme){var model=Bootstrap.Utils.Molecule.findModel(source).props.model;var atomIndices=Bootstrap.Entity.isMoleculeModel(source)?source.props.model.data.atoms.indices:source.props.indices;if(!atomIndices.length)return void 0;var tessalation=getTessalation(style.params.detail,atomIndices.length);switch(style.type){case"Cartoons":return MolVis.Cartoons.Model.create(source,{model:model,atomIndices:atomIndices,theme:theme,queryContext:Bootstrap.Utils.Molecule.findQueryContext(source),params:createCartoonParams(tessalation,false)});case"Calpha":return MolVis.Cartoons.Model.create(source,{model:model,atomIndices:atomIndices,theme:theme,queryContext:Bootstrap.Utils.Molecule.findQueryContext(source),params:createCartoonParams(tessalation,true)});case"BallsAndSticks":return Vis.Molecule.BallsAndSticks.Model.create(source,{model:model,atomIndices:atomIndices,theme:theme,params:createBallsAndSticksParams(tessalation,model,style.params)});case"VDWBalls":return Vis.Molecule.BallsAndSticks.Model.create(source,{model:model,atomIndices:atomIndices,theme:theme,params:createVDWBallsParams(tessalation,model)});default:return void 0}}function createStandardVisual(source,transform,style){var _this=this;return Bootstrap.Task.create("Visual ("+source.props.label+")",Visualization.Style.getTaskType(style),function(ctx){return __awaiter(_this,void 0,void 0,function(){var label,theme,mc,model;return __generator(this,function(_a){switch(_a.label){case 0:label=Molecule.TypeDescriptions[style.type].label;return[4,ctx.updateProgress("Creating "+label+"...")];case 1:_a.sent();theme=style.theme.template.provider(Bootstrap.Utils.Molecule.findModel(source),Visualization.Theme.getProps(style.theme));mc=createModel(source,style,theme);if(!mc){throw"Invalid input parameters."}return[4,mc.run(ctx)];case 2:model=_a.sent();return[2,Bootstrap.Entity.Molecule.Visual.create(transform,{label:label,model:model,style:style,isSelectable:!style.isNotSelectable})]}})})})}function createSurface(source,transform,style){var _this=this;return Bootstrap.Task.create("Molecular Surface ("+source.props.label+")",Visualization.Style.getTaskType(style),function(ctx){return __awaiter(_this,void 0,void 0,function(){var model,atomIndices,params,data,theme,surfaceModel,eLabel;return __generator(this,function(_a){switch(_a.label){case 0:model=Bootstrap.Utils.Molecule.findModel(source).props.model;atomIndices=Bootstrap.Entity.isMoleculeModel(source)?source.props.model.data.atoms.indices:source.props.indices;params=style.params;return[4,LiteMol.Core.Geometry.MolecularSurface.computeMolecularSurfaceAsync({positions:model.positions,atomIndices:atomIndices,parameters:{atomRadius:Bootstrap.Utils.vdwRadiusFromElementSymbol(model),density:getSurfaceDensity(params,model,atomIndices),probeRadius:params.probeRadius,smoothingIterations:params.smoothing,interactive:true}}).run(ctx)];case 1:data=_a.sent();theme=style.theme.template.provider(Bootstrap.Utils.Molecule.findModel(source),Visualization.Theme.getProps(style.theme));return[4,ctx.updateProgress("Creating visual...")];case 2:_a.sent();return[4,LiteMol.Visualization.Surface.Model.create(source,{surface:data.surface,theme:theme,parameters:{isWireframe:style.params.isWireframe}}).run(ctx)];case 3:surfaceModel=_a.sent();eLabel="Surface, "+Bootstrap.Utils.round(params.probeRadius,2)+" Å probe";return[2,Bootstrap.Entity.Molecule.Visual.create(transform,{label:eLabel,model:surfaceModel,style:style,isSelectable:!style.isNotSelectable})]}})})})}function create(source,transform,style){if(style.type==="Surface")return createSurface(source,transform,style);return createStandardVisual(source,transform,style)}Molecule.create=create})(Molecule=Visualization.Molecule||(Visualization.Molecule={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Labels;(function(Labels){"use strict";function createMoleculeLabels(parent,transform,style){var _this=this;return Bootstrap.Task.create("Labels","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var params,theme,labelsParams,model;return __generator(this,function(_a){switch(_a.label){case 0:params=style.params;theme=style.theme.template.provider(parent,Visualization.Theme.getProps(style.theme));labelsParams=Bootstrap.Utils.Molecule.create3DLabelsParams(parent,params,theme);return[4,ctx.updateProgress("Creating labels...")];case 1:_a.sent();return[4,LiteMol.Visualization.Labels.Model.create(parent,labelsParams).run(ctx)];case 2:model=_a.sent();return[2,Bootstrap.Entity.Visual.Labels.create(transform,{label:"Labels",model:model,style:style,isSelectable:false})]}})})})}Labels.createMoleculeLabels=createMoleculeLabels;function createGenericLabels(parent,transform,params){var _this=this;return Bootstrap.Task.create("Labels","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var theme,labelsParams,model;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Creating labels...")];case 1:_a.sent();theme=params.style.theme.template.provider(parent,Visualization.Theme.getProps(params.style.theme));labelsParams={positions:params.positions,sizes:params.sizes,labels:params.labels,options:params.options,theme:theme};return[4,LiteMol.Visualization.Labels.Model.create(parent,labelsParams).run(ctx)];case 2:model=_a.sent();return[2,Bootstrap.Entity.Visual.Labels.create(transform,{label:"Labels",model:model,style:params.style,isSelectable:false})]}})})})}Labels.createGenericLabels=createGenericLabels})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Labels;(function(Labels){"use strict";var Style;(function(Style){function moleculeHasOnlyThemeChanged(oldS,newS){return Bootstrap.Utils.deepEqual(oldS.params,newS.params)}Style.moleculeHasOnlyThemeChanged=moleculeHasOnlyThemeChanged;function createMoleculeStyle(params){return{type:"Labels",params:{kind:params.kind,labelsOptions:params.labelsOptions?params.labelsOptions:Default.MoleculeLabels.params.labelsOptions},theme:params.theme?params.theme:Default.MoleculeLabels.theme}}Style.createMoleculeStyle=createMoleculeStyle})(Style=Labels.Style||(Labels.Style={}));var Default;(function(Default){var Vis=LiteMol.Visualization;var uniformColors=Bootstrap.Immutable.Map({Uniform:Vis.Color.fromHexString("#eaeaea"),Background:Vis.Color.fromHexString("#777777"),Outline:Vis.Color.fromHexString("#333333")});var uniformVariables=Bootstrap.Immutable.Map({xOffset:0,yOffset:0,zOffset:.6,sizeFactor:1.5,backgroundOpacity:0,outlineWidth:.1});function uniformThemeProvider(e,props){return Vis.Theme.createUniform(props)}var Themes=[{name:"Uniform Color",description:"Same color everywhere.",colors:uniformColors,variables:uniformVariables,provider:uniformThemeProvider}];var Transparency={alpha:1,writeDepth:false};Default.Theme=Themes[0];Default.MoleculeLabels={type:"Labels",params:{kind:"Residue-Full-Id",labelsOptions:Vis.Labels.DefaultLabelsOptions},theme:{template:Default.Theme,colors:Default.Theme.colors,variables:Default.Theme.variables,transparency:Transparency,interactive:false,disableFog:false}};Default.GenericLabels={type:"Labels",params:Vis.Labels.DefaultLabelsOptions,theme:{template:Default.Theme,colors:Default.Theme.colors,variables:Default.Theme.variables,transparency:Transparency,interactive:false,disableFog:false}}})(Default=Labels.Default||(Labels.Default={}))})(Labels=Visualization.Labels||(Visualization.Labels={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Density;(function(Density){"use strict";var Geom=LiteMol.Core.Geometry;function getOffsets(data,min,max,toFrac){var dx=max[0]-min[0],dy=max[1]-min[1],dz=max[2]-min[2];var corners=[min,[min[0]+dx,min[1],min[2]],[min[0],min[1]+dy,min[2]],[min[0],min[1],min[2]+dz],[min[0]+dx,min[1]+dy,min[2]],[min[0]+dx,min[1],min[2]+dz],[min[0],min[1]+dy,min[2]+dz],[min[0]+dx,min[1]+dy,min[2]+dz]].map(function(c){var f=(new LiteMol.Visualization.THREE.Vector3).fromArray(c).applyMatrix4(toFrac);return[f.x,f.y,f.z]});var bottomLeftFrac=corners[0].slice(),topRightFrac=corners[0].slice();for(var _i=0,corners_1=corners;_i<corners_1.length;_i++){var c=corners_1[_i];for(var i=0;i<3;i++){bottomLeftFrac[i]=Math.min(bottomLeftFrac[i],c[i]);topRightFrac[i]=Math.max(topRightFrac[i],c[i])}}var _a=data.box,origin=_a.origin,dimensions=_a.dimensions,sampleCount=_a.sampleCount;var bottomLeft=[0,0,0],topRight=[0,0,0];for(var i=0;i<3;i++){var c=Math.floor(sampleCount[i]*(bottomLeftFrac[i]-origin[i])/dimensions[i]);bottomLeft[i]=Math.min(Math.max(c,0),sampleCount[i]);c=Math.ceil(sampleCount[i]*(topRightFrac[i]-origin[i])/dimensions[i]);topRight[i]=Math.min(Math.max(c,0),sampleCount[i])}return{bottomLeft:bottomLeft,topRight:topRight}}function create(parent,transform,style){var _this=this;var name=style.taskType==="Background"?parent.props.label:"Density Surface ("+parent.props.label+")";return Bootstrap.Task.create(name,Visualization.Style.getTaskType(style),function(ctx){return __awaiter(_this,void 0,void 0,function(){var params,source,data,basis,_a,sampleCount,origin,dimensions,scale,translate,fromFrac,toFrac,dataTransform,min,max,offsets,isSigma,isoValue,surface,theme,model,label;return __generator(this,function(_b){switch(_b.label){case 0:params=style.params;source=Bootstrap.Tree.Node.findClosestNodeOfType(parent,[Bootstrap.Entity.Density.Data]);if(!source){throw"Cannot create density visual on "+parent.props.label}data=source.props.data;basis=data.spacegroup.basis;_a=data.box,sampleCount=_a.sampleCount,origin=_a.origin,dimensions=_a.dimensions;scale=(new LiteMol.Visualization.THREE.Matrix4).makeScale(dimensions[0]/sampleCount[0],dimensions[1]/sampleCount[1],dimensions[2]/sampleCount[2]);translate=(new LiteMol.Visualization.THREE.Matrix4).makeTranslation(origin[0],origin[1],origin[2]);fromFrac=(new LiteMol.Visualization.THREE.Matrix4).set(basis.x[0],basis.y[0],basis.z[0],0,0,basis.y[1],basis.z[1],0,0,0,basis.z[2],0,0,0,0,1);toFrac=(new LiteMol.Visualization.THREE.Matrix4).getInverse(fromFrac);dataTransform=fromFrac.multiply(translate).multiply(scale);if(params.bottomLeft&&params.topRight){offsets=getOffsets(data,params.bottomLeft,params.topRight,toFrac);min=offsets.bottomLeft;max=offsets.topRight}else{min=[0,0,0];max=data.box.sampleCount}if(!(min[0]-max[0])||!(min[1]-max[1])||!(min[2]-max[2])){throw{warn:true,message:"Empty box."}}isSigma=params.isoValueType===void 0||params.isoValueType===Density.IsoValueType.Sigma;isoValue=isSigma?data.valuesInfo.mean+data.valuesInfo.sigma*params.isoValue:params.isoValue;return[4,Geom.MarchingCubes.compute({isoLevel:isoValue,scalarField:data.data,bottomLeft:min,topRight:max}).run(ctx)];case 1:surface=_b.sent();return[4,Geom.Surface.transform(surface,dataTransform.elements).run(ctx)];case 2:surface=_b.sent();return[4,Geom.Surface.laplacianSmooth(surface,params.smoothing,8).run(ctx)];case 3:surface=_b.sent();theme=style.theme.template.provider(source,Visualization.Theme.getProps(style.theme));return[4,ctx.updateProgress("Creating visual...")];case 4:_b.sent();return[4,LiteMol.Visualization.Surface.Model.create(source,{surface:surface,theme:theme,parameters:{isWireframe:style.params.isWireframe}}).run(ctx)];case 5:model=_b.sent();label="Surface, "+Bootstrap.Utils.round(params.isoValue,2)+(isSigma?" σ":"");return[2,Bootstrap.Entity.Density.Visual.create(transform,{label:label,model:model,style:style,isSelectable:!style.isNotSelectable})]}})})})}Density.create=create})(Density=Visualization.Density||(Visualization.Density={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Visualization;(function(Visualization){var Density;(function(Density){"use strict";var IsoValueType;(function(IsoValueType){IsoValueType[IsoValueType["Sigma"]=0]="Sigma";IsoValueType[IsoValueType["Absolute"]=1]="Absolute"})(IsoValueType=Density.IsoValueType||(Density.IsoValueType={}));function areNonIsoParamsSame(a,b){return a.bottomLeft===b.bottomLeft&&b.topRight===b.topRight&&a.smoothing===b.smoothing&&a.isWireframe===b.isWireframe}Density.areNonIsoParamsSame=areNonIsoParamsSame;var Style;(function(Style){function create(params){var colors=Default.Theme.colors.set("Uniform",params.color);return{type:"Density",taskType:params.taskType,params:{isoValue:params.isoValue,isoValueType:params.isoValueType,smoothing:1,isWireframe:!!params.isWireframe},theme:{template:Default.Theme,colors:colors,transparency:params.transparency?params.transparency:Default.Transparency,interactive:false,disableFog:!!params.disableFog}}}Style.create=create})(Style=Density.Style||(Density.Style={}));var Default;(function(Default){Default.Params={isoValue:0,isoValueType:IsoValueType.Sigma,smoothing:1,isWireframe:false};var Vis=LiteMol.Visualization;var uniformBaseColor=Bootstrap.Immutable.Map({Uniform:Vis.Theme.Default.UniformColor,Highlight:Vis.Theme.Default.HighlightColor,Selection:Vis.Theme.Default.SelectionColor});function uniformThemeProvider(e,props){return Vis.Theme.createUniform(props)}Default.Themes=[{name:"Uniform Color",description:"Same color everywhere.",colors:uniformBaseColor,provider:uniformThemeProvider}];Default.Transparency={alpha:1,writeDepth:false};Default.Theme=Default.Themes[0];Default.Style={type:"Density",params:Default.Params,theme:{template:Default.Theme,colors:Default.Theme.colors,transparency:Default.Transparency,interactive:false,disableFog:false}}})(Default=Density.Default||(Density.Default={}))})(Density=Visualization.Density||(Visualization.Density={}))})(Visualization=Bootstrap.Visualization||(Bootstrap.Visualization={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";var Entity;(function(Entity){function isClass(e,cls){return e.type.info.typeClass===cls}Entity.isClass=isClass;function isTypeClass(e,cls){return e.info.typeClass===cls}Entity.isTypeClass=isTypeClass;Entity.RootClass="Root";Entity.GroupClass="Group";Entity.DataClass="Data";Entity.ObjectClass="Object";Entity.VisualClass="Visual";Entity.SelectionClass="Selection";Entity.ActionClass="Action";Entity.BehaviourClass="Behaviour";var TypeImpl=function(){function TypeImpl(id,infoBase,traits){this.id=id;this.info=Bootstrap.Utils.assign({},infoBase,{traits:traits})}TypeImpl.prototype.create=function(transform,props){var ret={id:Bootstrap.Tree.Node.createId(),version:0,index:0,ref:"undefined",tag:void 0,tree:void 0,props:props,state:{isCollapsed:false,visibility:0},isHidden:false,transform:transform,parent:void 0,children:[],type:this};return Bootstrap.Tree.Node.update(ret)};return TypeImpl}();function create(info,traits){return new TypeImpl(Bootstrap.Utils.generateUUID(),info,traits?traits:{})}Entity.create=create})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){"use strict";function nodeUpdated(e){if(!e.tree)return;Bootstrap.Event.Tree.NodeUpdated.dispatch(e.tree.context,e);if(e.tree.context.currentEntity===e){Bootstrap.Event.Entity.CurrentChanged.dispatch(e.tree.context,e)}}Entity.nodeUpdated=nodeUpdated;function toggleExpanded(e){var s={isCollapsed:!e.state.isCollapsed};Bootstrap.Tree.Node.withState(e,s);nodeUpdated(e)}Entity.toggleExpanded=toggleExpanded;function setCurrent(e){var old=e.tree.context.currentEntity;if(old===e||e&&e.isHidden){return}var n=e.parent;while(n.parent!==n){if(n.isHidden){return}n=n.parent}e.tree.context.currentEntity=e;if(old){Bootstrap.Tree.Node.update(old);nodeUpdated(old)}if(e){Bootstrap.Tree.Node.update(e);nodeUpdated(e)}Bootstrap.Event.Entity.CurrentChanged.dispatch(e.tree.context,e);if(old)Bootstrap.Tree.updatePath(old);Bootstrap.Tree.updatePath(e.parent)}Entity.setCurrent=setCurrent;function updateVisibilityState(entity){if(!entity)return;var fullCount=0;var noneCount=0;for(var _i=0,_a=entity.children;_i<_a.length;_i++){var n=_a[_i];var s=n.state.visibility;if(s===0)fullCount++;else if(s===2)noneCount++}var visibility;if(fullCount===entity.children.length)visibility=0;else if(noneCount===entity.children.length)visibility=2;else visibility=1;if(visibility!==entity.state.visibility){var s={visibility:visibility};Bootstrap.Tree.Node.withState(entity,s);nodeUpdated(entity)}if(entity.parent!==entity)updateVisibilityState(entity.parent)}Entity.updateVisibilityState=updateVisibilityState;function setVisibility(entity,visible){if(!entity)return;var newState=visible?0:2;Bootstrap.Tree.Node.forEach(entity,function(n){var v=n.state.visibility;if(v!==newState){var s={visibility:newState};Bootstrap.Tree.Node.withState(n,s);nodeUpdated(n)}});updateVisibilityState(entity.parent)}Entity.setVisibility=setVisibility})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){"use strict";function isMolecule(e){return e&&e.type===Molecule.Molecule}Entity.isMolecule=isMolecule;function isMoleculeModel(e){return e&&e.type===Molecule.Model}Entity.isMoleculeModel=isMoleculeModel;function isMoleculeSelection(e){return e&&e.type===Molecule.Selection}Entity.isMoleculeSelection=isMoleculeSelection;function isVisual(e){return e&&e.type.info.typeClass===Entity.VisualClass}Entity.isVisual=isVisual;Entity.RootTransform=Bootstrap.Tree.Transform.create({},{},void 0);Entity.Root=Entity.create({name:"Root",typeClass:"Root",shortName:"R",description:"Where everything begins."});Entity.Group=Entity.create({name:"Group",typeClass:"Group",shortName:"G",description:"A group on entities."});Entity.Action=Entity.create({name:"Action",typeClass:"Action",shortName:"A",description:"Represents an action performed on the entity tree."});var Data;(function(Data){Data.Types=["String","Binary"];Data.String=Entity.create({name:"String Data",typeClass:"Data",shortName:"S_D",description:"A string."});Data.Binary=Entity.create({name:"Binary Data",typeClass:"Data",shortName:"B_D",description:"A binary blob."});Data.CifDictionary=Entity.create({name:"Cif Dictionary",typeClass:"Data",shortName:"CD",description:"Represents parsed CIF data."});Data.Json=Entity.create({name:"JSON Data",typeClass:"Data",shortName:"JS_D",description:"Represents JSON data."})})(Data=Entity.Data||(Entity.Data={}));var Visual;(function(Visual){Visual.Surface=Entity.create({name:"Surface Visual",typeClass:"Visual",shortName:"V_S",description:"A surface visual."},{isFocusable:true});Visual.Labels=Entity.create({name:"Labels Visual",typeClass:"Visual",shortName:"V_L",description:"3D labels."},{isFocusable:false})})(Visual=Entity.Visual||(Entity.Visual={}));var Molecule;(function(Molecule_1){Molecule_1.Molecule=Entity.create({name:"Molecule",typeClass:"Object",shortName:"M",description:"A molecule that might contain one or more models."});Molecule_1.Model=Entity.create({name:"Molecule Model",typeClass:"Object",shortName:"M_M",description:"A model of a molecule."});Molecule_1.Selection=Entity.create({name:"Molecule Model Selection",typeClass:"Selection",shortName:"S_M",description:"A selection of atoms."},{isFocusable:true});Molecule_1.Visual=Entity.create({name:"Molecule Visual",typeClass:"Visual",shortName:"V_M",description:"A visual of a molecule."},{isFocusable:true});var CoordinateStreaming;(function(CoordinateStreaming){CoordinateStreaming.Behaviour=Entity.create({name:"Coordinate Streaming",typeClass:"Behaviour",shortName:"CS",description:"Behaviour that downloads surrounding residues when an atom or residue is selected."})})(CoordinateStreaming=Molecule_1.CoordinateStreaming||(Molecule_1.CoordinateStreaming={}))})(Molecule=Entity.Molecule||(Entity.Molecule={}));var Density;(function(Density){Density.Data=Entity.create({name:"Density Data",typeClass:"Object",shortName:"DD",description:"Density data."});Density.Visual=Entity.create({name:"Density Visual",typeClass:"Visual",shortName:"V_DD",description:"A visual of density data."},{isFocusable:true});Density.InteractiveSurface=Entity.create({name:"Interactive Surface",typeClass:"Behaviour",shortName:"B_IS",description:"Behaviour that creates an interactive surface when an atom or residue is selected."})})(Density=Entity.Density||(Entity.Density={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){"use strict";var Cache=function(){function Cache(context){var _this=this;this.data=LiteMol.Core.Utils.FastMap.create();Bootstrap.Event.Tree.NodeRemoved.getStream(context).subscribe(function(e){return _this.data.delete(e.data.id)})}Cache.prototype.get=function(e,prop){var c=this.data.get(e.id);if(c)return c[prop];return void 0};Cache.prototype.set=function(e,prop,value){var c=this.data.get(e.id);if(c){c[prop]=value}else{this.data.set(e.id,(_a={},_a[prop]=value,_a))}return value;var _a};return Cache}();Entity.Cache=Cache;(function(Cache){var Keys;(function(Keys){Keys.QueryContext="queryContext"})(Keys=Cache.Keys||(Cache.Keys={}))})(Cache=Entity.Cache||(Entity.Cache={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){var Transformer;(function(Transformer_1){var Basic;(function(Basic){"use strict";var _this=this;var Transformer=Bootstrap.Tree.Transformer;Basic.Root=Transformer.create({id:"root",name:"Root",description:"A transformer that always returns itself.",from:[Entity.Root],to:[Entity.Root],validateParams:function(){return void 0},defaultParams:function(){return{}}},function(ctx,a,t){return Bootstrap.Task.resolve("Root","Silent",a)});Basic.Fail=Transformer.create({id:"fail",name:"Fail",description:"A transform that always fails.",from:[],to:[],validateParams:function(){return void 0},defaultParams:function(){return{title:"Error",message:"Unknown error."}}},function(ctx,a,t){return Bootstrap.Task.reject(t.params.title,"Background",t.params.message)});Basic.CreateGroup=Transformer.create({id:"create-group",name:"Create Group",description:"A transformer that always returns itself.",from:[],to:[Entity.Group],validateParams:function(){return void 0},defaultParams:function(){return{}}},function(ctx,a,t){var group=Entity.Group.create(t,{label:t.params.label?t.params.label:"Group",description:t.params.description});if(t.params.isCollapsed){var s={isCollapsed:true};group=Bootstrap.Tree.Node.withState(group,s)}return Bootstrap.Task.resolve("Group","Silent",group)});Basic.Delay=Transformer.create({id:"basic-delay",name:"Delay",description:"A transformer that delays by the specified timeout and does nothing.",from:[],to:[Entity.Action],validateParams:function(){return void 0},defaultParams:function(){return{timeoutMs:1e3}}},function(ctx,a,t){return Bootstrap.Task.create("Delay","Silent",function(ctx){return new LiteMol.Promise(function(res){setTimeout(function(){return res(Bootstrap.Tree.Node.Null)},t.params.timeoutMs)})})});Basic.CreateSurfaceVisual=Bootstrap.Tree.Transformer.create({id:"basic-create-surface-visual",name:"Create Surface Visual",description:"Create generic surface visual.",from:[],to:[Bootstrap.Entity.Visual.Surface],defaultParams:function(){return void 0},isUpdatable:false},function(context,a,t){var theme=t.params.theme;var style={type:"Surface",taskType:t.params.taskType||"Silent",isNotSelectable:!!t.params.isNotInteractive,params:{},theme:void 0};return Bootstrap.Task.create("Create Surface Visual",t.params.taskType||"Silent",function(ctx){return __awaiter(_this,void 0,void 0,function(){var model;return __generator(this,function(_a){switch(_a.label){case 0:return[4,LiteMol.Visualization.Surface.Model.create(a,{surface:t.params.surface,theme:theme,parameters:{isWireframe:t.params.isWireframe}}).run(ctx)];case 1:model=_a.sent();return[2,Bootstrap.Entity.Visual.Surface.create(t,{label:t.params.label||"Surface",model:model,style:style,isSelectable:!t.params.isNotInteractive,tag:t.params.tag})]}})})})})})(Basic=Transformer_1.Basic||(Transformer_1.Basic={}))})(Transformer=Entity.Transformer||(Entity.Transformer={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){var Transformer;(function(Transformer){var Molecule;(function(Molecule){"use strict";var _this=this;function downloadMoleculeSource(params){return Bootstrap.Tree.Transformer.action({id:"molecule-download-molecule-"+params.sourceId,name:"Molecule from "+params.name,description:params.description,from:[Entity.Root],to:[Entity.Action],defaultParams:function(ctx){return{id:params.defaultId,format:LiteMol.Core.Formats.Molecule.SupportedFormats.mmCIF}},validateParams:function(p){return!p.id||!p.id.trim().length?["Enter "+(params.isFullUrl?"URL":"Id")]:void 0}},function(context,a,t){var format=params.specificFormat?params.specificFormat:t.params.format;return Bootstrap.Tree.Transform.build().add(a,Transformer.Data.Download,{url:params.urlTemplate(t.params.id.trim()),type:format.isBinary?"Binary":"String",id:t.params.id,description:params.name,title:"Molecule"}).then(Molecule.CreateFromData,{format:params.specificFormat?params.specificFormat:t.params.format},{isBinding:true}).then(Molecule.CreateModel,{modelIndex:0},{isBinding:false})})}Molecule.downloadMoleculeSource=downloadMoleculeSource;Molecule.OpenMoleculeFromFile=Bootstrap.Tree.Transformer.action({id:"molecule-open-from-file",name:"Molecule from File",description:"Open a molecule from a file ("+LiteMol.Core.Formats.Molecule.SupportedFormats.All.map(function(f){return f.name}).join(", ")+").",from:[Entity.Root],to:[Entity.Action],defaultParams:function(ctx){return{file:void 0}},validateParams:function(p){return!p.file?["Select a file"]:!LiteMol.Core.Formats.FormatInfo.getFormat(p.file.name,LiteMol.Core.Formats.Molecule.SupportedFormats.All)?["Select a supported file format ("+[].concat(LiteMol.Core.Formats.Molecule.SupportedFormats.All.map(function(f){return f.extensions})).join(", ")+")."]:void 0}},function(context,a,t){var format=LiteMol.Core.Formats.FormatInfo.getFormat(t.params.file.name,LiteMol.Core.Formats.Molecule.SupportedFormats.All);return Bootstrap.Tree.Transform.build().add(a,Transformer.Data.OpenFile,{file:t.params.file,type:format.isBinary?"Binary":"String"}).then(Molecule.CreateFromData,{format:format},{isBinding:true}).then(Molecule.CreateModel,{modelIndex:0},{isBinding:false})});Molecule.CreateFromData=Bootstrap.Tree.Transformer.create({id:"molecule-create-from-data",name:"Molecule",description:"Create a molecule from string or binary data.",from:[Entity.Data.String,Entity.Data.Binary],to:[Entity.Molecule.Molecule],defaultParams:function(ctx){return{format:LiteMol.Core.Formats.Molecule.SupportedFormats.mmCIF}}},function(ctx,a,t){return Bootstrap.Task.create("Create Molecule ("+a.props.label+")","Silent",function(){return __awaiter(_this,void 0,void 0,function(){var r,_i,_a,w;return __generator(this,function(_b){switch(_b.label){case 0:return[4,Bootstrap.Task.fromComputation("Create Molecule ("+a.props.label+")","Normal",t.params.format.parse(a.props.data,{id:t.params.customId})).setReportTime(true).run(ctx)];case 1:r=_b.sent();if(r.isError)throw r.toString();if(r.warnings&&r.warnings.length>0){for(_i=0,_a=r.warnings;_i<_a.length;_i++){w=_a[_i];ctx.logger.warning(w)}}return[2,Entity.Molecule.Molecule.create(t,{label:r.result.id,molecule:r.result})]}})})})});Molecule.CreateFromMmCif=Bootstrap.Tree.Transformer.create({id:"molecule-create-from-mmcif",name:"Molecule",description:"Create a molecule from a mmCIF data block.",from:[Entity.Data.CifDictionary],to:[Entity.Molecule.Molecule],defaultParams:function(ctx){return{blockIndex:0}}},function(ctx,a,t){return Bootstrap.Task.create("Create Molecule ("+a.props.label+")","Normal",function(ctx){return __awaiter(_this,void 0,void 0,function(){var index,b,molecule;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Creating...")];case 1:_a.sent();index=t.params.blockIndex|0;b=a.props.dictionary.dataBlocks[index];if(!b){throw"The source contains only "+a.props.dictionary.dataBlocks.length+" data block(s), tried to access the "+(index+1)+"-th."}molecule=LiteMol.Core.Formats.Molecule.mmCIF.ofDataBlock(b);return[2,Entity.Molecule.Molecule.create(t,{label:molecule.id,molecule:molecule})]}})})}).setReportTime(true)});Molecule.CreateModel=Bootstrap.Tree.Transformer.create({id:"molecule-create-model",name:"Model",description:"Create a model of a molecule.",from:[Entity.Molecule.Molecule],to:[Entity.Molecule.Model],isUpdatable:true,defaultParams:function(ctx){return{modelIndex:0}}},function(ctx,a,t){return Bootstrap.Task.create("Create Model ("+a.props.label+")","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var params,index,model;return __generator(this,function(_a){params=t.params;index=params.modelIndex|0;model=a.props.molecule.models[index];if(!model){throw"The molecule contains only "+a.props.molecule.models.length+" model(s), tried to access the "+(index+1)+"-th."}return[2,Entity.Molecule.Model.create(t,{label:"Model "+model.modelId,description:model.data.atoms.count+" atom"+(model.data.atoms.count!==1?"s":""),model:model})]})})})});Molecule.CreateSelection=Bootstrap.Tree.Transformer.create({id:"molecule-create-selection",name:"Selection",description:"Create an atom selection.",from:[Entity.Molecule.Model,Entity.Molecule.Visual],to:[Entity.Molecule.Selection],isUpdatable:true,defaultParams:function(ctx){return{queryString:ctx.settings.get("molecule.model.defaultQuery")||""}},validateParams:function(p){if(!(p.queryString||"").trim().length)return["Enter query"];try{return LiteMol.Core.Structure.Query.Builder.toQuery(p.queryString)&&void 0||void 0}catch(e){return[""+e]}}},function(ctx,a,t){return Bootstrap.Task.create("Create Selection ("+a.props.label+")","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var params,query,queryCtx,indices;return __generator(this,function(_a){params=t.params;query=LiteMol.Core.Structure.Query.Builder.toQuery(params.queryString);queryCtx=t.params.inFullContext?Bootstrap.Utils.Molecule.findModel(a).props.model.queryContext:Bootstrap.Utils.Molecule.findQueryContext(a);indices=query(queryCtx).unionAtomIndices();if(!indices.length){throw{warn:true,message:"Empty selection"+(t.params.name?" ("+t.params.name+")":"")+"."}}return[2,Entity.Molecule.Selection.create(t,{label:params.name?params.name:"Selection",description:indices.length+" atom"+(indices.length!==1?"s":""),indices:indices})]})})}).setReportTime(!t.params.silent)});Molecule.CreateSelectionFromQuery=Bootstrap.Tree.Transformer.create({id:"molecule-create-selection",name:"Selection",description:"Create an atom selection.",from:[Entity.Molecule.Selection,Entity.Molecule.Model,Entity.Molecule.Visual],to:[Entity.Molecule.Selection],defaultParams:function(ctx){return void 0}},function(ctx,a,t){return Bootstrap.Task.create("Create Selection ("+a.props.label+")","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var params,query,queryCtx,indices;return __generator(this,function(_a){params=t.params;query=LiteMol.Core.Structure.Query.Builder.toQuery(params.query);queryCtx=t.params.inFullContext?Bootstrap.Utils.Molecule.findModel(a).props.model.queryContext:Bootstrap.Utils.Molecule.findQueryContext(a);indices=query(queryCtx).unionAtomIndices();if(!indices.length){throw{warn:true,message:"Empty selection"+(t.params.name?" ("+t.params.name+")":"")+"."}}return[2,Entity.Molecule.Selection.create(t,{label:params.name?params.name:"Selection",description:indices.length+" atom"+(indices.length!==1?"s":""),indices:indices})]})})}).setReportTime(!t.params.silent)});Molecule.CreateAssembly=Bootstrap.Tree.Transformer.create({id:"molecule-create-assemly",name:"Assembly",description:"Create an assembly of a molecule.",from:[Entity.Molecule.Model],to:[Entity.Molecule.Model],defaultParams:function(ctx,e){var m=Bootstrap.Utils.Molecule.findModel(e);var ret={name:ctx.settings.get("molecule.model.defaultAssemblyName")||"1"};var asm=m.props.model.data.assemblyInfo;if(!asm||!asm.assemblies.length)return ret;if(asm.assemblies.filter(function(a){return a.name===ret.name}))return ret;ret.name=asm.assemblies[0].name;return ret},isUpdatable:true,isApplicable:function(m){return!!(m&&m.props.model.data.assemblyInfo&&m.props.model.data.assemblyInfo.assemblies.length)}},function(ctx,a,t){return Bootstrap.Task.create("Create Model ("+a.props.label+")","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var i,gen,asm;return __generator(this,function(_a){switch(_a.label){case 0:i=a.props.model.data.assemblyInfo;if(!i||!i.assemblies.length){throw"Assembly info not available."}gen=i.assemblies.filter(function(a){return a.name===t.params.name})[0];if(!gen){throw"No assembly called '"+t.params.name+"' found."}return[4,ctx.updateProgress("Creating...")];case 1:_a.sent();asm=LiteMol.Core.Structure.buildAssembly(a.props.model,gen);return[2,Entity.Molecule.Model.create(t,{label:"Assembly "+gen.name,description:asm.data.atoms.count+" atom"+(asm.data.atoms.count!==1?"s":""),model:asm})]}})})})});Molecule.CreateSymmetryMates=Bootstrap.Tree.Transformer.create({id:"molecule-create-symmetry-mates",name:"Crystal Symmetry",description:"Find crystal symmetry mates or interaction partners.",from:[Entity.Molecule.Model],to:[Entity.Molecule.Model],defaultParams:function(ctx){return{type:"Interaction",radius:5}},isUpdatable:true,isApplicable:function(m){if(!m||!m.props.model.data.symmetryInfo)return false;var info=m.props.model.data.symmetryInfo;if(info.cellSize[0]===1&&info.cellSize[1]===1&&info.cellSize[2]===1)return false;return true}},function(ctx,a,t){return Bootstrap.Task.create("Create Model ("+a.props.label+")","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var i,radius,symm;return __generator(this,function(_a){switch(_a.label){case 0:i=a.props.model.data.symmetryInfo;if(!i){throw"Spacegroup info info not available."}radius=Math.max(t.params.radius,0);return[4,ctx.updateProgress("Creating...")];case 1:_a.sent();symm=t.params.type==="Mates"?LiteMol.Core.Structure.buildSymmetryMates(a.props.model,radius):LiteMol.Core.Structure.buildPivotGroupSymmetry(a.props.model,radius);return[2,Entity.Molecule.Model.create(t,{label:"Symmetry",model:symm,description:symm.data.atoms.count+" atom"+(symm.data.atoms.count!==1?"s":"")+", "+t.params.type+" "+Bootstrap.Utils.round(radius,1)+" Å"})]}})})})});Molecule.ModelTransform3D=Bootstrap.Tree.Transformer.create({id:"molecule-model-transform3d",name:"Transform 3D",description:"Transform 3D coordinates of a model using a 4x4 matrix.",from:[Entity.Molecule.Model],to:[Entity.Molecule.Model],validateParams:function(p){return!p||!p.transform||p.transform.length!==16?["Specify a 4x4 transform matrix."]:void 0},defaultParams:function(ctx,e){return{transform:LiteMol.Core.Geometry.LinearAlgebra.Matrix4.identity()}},isUpdatable:false},function(ctx,a,t){return Bootstrap.Task.create("Transform 3D ("+a.props.label+")","Normal",function(ctx){return __awaiter(_this,void 0,void 0,function(){var m,tCtx,transformed;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Transforming...")];case 1:_a.sent();m=a.props.model;tCtx={t:t.params.transform,v:LiteMol.Core.Geometry.LinearAlgebra.Vector3.zero()};transformed=LiteMol.Core.Structure.Molecule.Model.withTransformedXYZ(m,tCtx,function(ctx,x,y,z,out){var v=ctx.v;LiteMol.Core.Geometry.LinearAlgebra.Vector3.set(v,x,y,z);LiteMol.Core.Geometry.LinearAlgebra.Vector3.transformMat4(out,v,ctx.t)});return[2,Entity.Molecule.Model.create(t,{label:a.props.label,description:t.params.description?t.params.description:"Transformed",model:transformed})]}})})})});Molecule.CreateVisual=Bootstrap.Tree.Transformer.create({id:"molecule-create-visual",name:"Visual",description:"Create a visual of a molecule or a selection.",from:[Entity.Molecule.Model,Entity.Molecule.Selection],to:[Entity.Molecule.Visual],isUpdatable:true,defaultParams:function(ctx){return{style:Bootstrap.Visualization.Molecule.Default.ForType.get("Cartoons")}},validateParams:function(p){return!p.style?["Specify Style"]:void 0},customController:function(ctx,t,e){return new Bootstrap.Components.Transform.MoleculeVisual(ctx,t,e)}},function(ctx,a,t){var params=t.params;return Bootstrap.Visualization.Molecule.create(a,t,params.style).setReportTime(Bootstrap.Visualization.Style.getTaskType(t.params.style)==="Normal")},function(ctx,b,t){var oldParams=b.transform.params;if(oldParams.style.type!==t.params.style.type||!Bootstrap.Utils.deepEqual(oldParams.style.params,t.params.style.params))return void 0;var model=b.props.model;if(!model)return void 0;var a=Bootstrap.Utils.Molecule.findModel(b.parent);if(!a)return void 0;var ti=t.params.style.theme;var theme=ti.template.provider(a,Bootstrap.Visualization.Theme.getProps(ti));model.applyTheme(theme);b.props.style=t.params.style;Entity.nodeUpdated(b);return Bootstrap.Task.resolve(t.transformer.info.name,"Background",Bootstrap.Tree.Node.Null)});Molecule.CreateMacromoleculeVisual=Bootstrap.Tree.Transformer.action({id:"molecule-create-macromolecule-visual",name:"Macromolecule Visual",description:"Create a visual of a molecule that is split into polymer, HET, and water parts.",from:[Entity.Molecule.Selection,Entity.Molecule.Model],to:[Entity.Action],validateParams:function(p){return!p.polymer&&!p.het&&!p.water?["Select at least one component"]:void 0},defaultParams:function(ctx){return{polymer:true,het:true,water:true}}},function(context,a,t){var g=Bootstrap.Tree.Transform.build().add(a,Transformer.Basic.CreateGroup,{label:"Group",description:"Macromolecule"},{ref:t.params.groupRef});if(t.params.polymer){g.then(Molecule.CreateSelectionFromQuery,{query:LiteMol.Core.Structure.Query.nonHetPolymer(),name:"Polymer",silent:true},{isBinding:true}).then(Molecule.CreateVisual,{style:Bootstrap.Visualization.Molecule.Default.ForType.get("Cartoons")},{ref:t.params.polymerRef})}if(t.params.het){g.then(Molecule.CreateSelectionFromQuery,{query:LiteMol.Core.Structure.Query.hetGroups(),name:"HET",silent:true},{isBinding:true}).then(Molecule.CreateVisual,{style:Bootstrap.Visualization.Molecule.Default.ForType.get("BallsAndSticks")},{ref:t.params.hetRef})}if(t.params.water){var style={type:"BallsAndSticks",params:{useVDW:false,atomRadius:.23,bondRadius:.09,detail:"Automatic"},theme:{template:Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate,colors:Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate.colors,transparency:{alpha:.25}}};g.then(Molecule.CreateSelectionFromQuery,{query:LiteMol.Core.Structure.Query.entities({type:"water"}),name:"Water",silent:true},{isBinding:true}).then(Molecule.CreateVisual,{style:style},{ref:t.params.waterRef})}return g});Molecule.CreateLabels=Bootstrap.Tree.Transformer.create({id:"molecule-create-labels",name:"Labels",description:"Create a labels for a molecule or a selection.",from:[Entity.Molecule.Model,Entity.Molecule.Selection,Entity.Molecule.Visual],to:[Entity.Visual.Labels],isUpdatable:true,defaultParams:function(ctx){return{style:Bootstrap.Visualization.Labels.Default.MoleculeLabels}},validateParams:function(p){return!p.style?["Specify Style"]:void 0},customController:function(ctx,t,e){return new Bootstrap.Components.Transform.MoleculeLabels(ctx,t,e)}},function(ctx,a,t){var params=t.params;return Bootstrap.Visualization.Labels.createMoleculeLabels(a,t,params.style).setReportTime(false)},function(ctx,b,t){var oldParams=b.transform.params;var newParams=t.params;if(!Bootstrap.Visualization.Labels.Style.moleculeHasOnlyThemeChanged(oldParams.style,newParams.style))return void 0;var model=b.props.model;var a=Bootstrap.Tree.Node.findClosestNodeOfType(b,[Entity.Molecule.Model,Entity.Molecule.Selection,Entity.Molecule.Visual]);if(!a)return void 0;var theme=newParams.style.theme.template.provider(a,Bootstrap.Visualization.Theme.getProps(newParams.style.theme));model.applyTheme(theme);Entity.nodeUpdated(b);return Bootstrap.Task.resolve(t.transformer.info.name,"Background",Bootstrap.Tree.Node.Null)})})(Molecule=Transformer.Molecule||(Transformer.Molecule={}))})(Transformer=Entity.Transformer||(Entity.Transformer={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){var Transformer;(function(Transformer){var Labels;(function(Labels){Labels.Create=Bootstrap.Tree.Transformer.create({id:"labels-create",name:"Labels",description:"Create a labels for a molecule or a selection.",from:[],to:[Entity.Visual.Labels],isUpdatable:false,defaultParams:function(ctx){return{}},customController:function(ctx,t,e){return new Bootstrap.Components.Transform.MoleculeLabels(ctx,t,e)}},function(ctx,a,t){return Bootstrap.Visualization.Labels.createGenericLabels(a,t,t.params).setReportTime(false)},function(ctx,b,t){var oldParams=b.transform.params;var newParams=t.params;if(oldParams.positions!==newParams.positions||oldParams.sizes!==newParams.sizes||oldParams.labels!==newParams.labels||oldParams.options!==newParams.options){return void 0}var model=b.props.model;var a=Bootstrap.Tree.Node.findClosestNodeOfType(b,[Entity.Root]);if(!a)return void 0;var theme=newParams.style.theme.template.provider(a,Bootstrap.Visualization.Theme.getProps(newParams.style.theme));model.applyTheme(theme);Entity.nodeUpdated(b);return Bootstrap.Task.resolve(t.transformer.info.name,"Background",Bootstrap.Tree.Node.Null)})})(Labels=Transformer.Labels||(Transformer.Labels={}))})(Transformer=Entity.Transformer||(Entity.Transformer={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){var Transformer;(function(Transformer){var Data;(function(Data){"use strict";var _this=this;function getDataType(type){if(type===void 0||type===null)return"String";if(type.toLowerCase()==="binary")return"Binary";return"String"}function hasResponseCompression(responseCompression){var c=responseCompression===void 0?Bootstrap.Utils.DataCompressionMethod.None:responseCompression;return c!==Bootstrap.Utils.DataCompressionMethod.None}Data.Download=Bootstrap.Tree.Transformer.create({id:"data-download",name:"Download Data",description:"Downloads a string or binary data from the given URL (if the host server supports cross domain requests).",from:[Entity.Root],to:[Entity.Data.String,Entity.Data.Binary],validateParams:function(p){return!p.url||!p.url.trim().length?["Enter URL"]:!p.type?["Specify type"]:p.type==="String"&&hasResponseCompression(p.responseCompression)?["Decompression is only available for Binary data."]:void 0},defaultParams:function(){return{id:"",description:"",type:"String",url:"",responseCompression:Bootstrap.Utils.DataCompressionMethod.None}}},function(ctx,a,t){var params=t.params;return Bootstrap.Task.create("Download","Silent",function(){return __awaiter(_this,void 0,void 0,function(){var data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,Bootstrap.Utils.ajaxGet({url:params.url,type:getDataType(params.type),compression:params.responseCompression,title:params.title}).setReportTime(true).run(ctx)];case 1:data=_a.sent();if(params.type==="String")return[2,Entity.Data.String.create(t,{label:params.id?params.id:params.url,description:params.description,data:data})];else return[2,Entity.Data.Binary.create(t,{label:params.id?params.id:params.url,description:params.description,data:data})];return[2]}})})})});Data.OpenFile=Bootstrap.Tree.Transformer.create({id:"data-open-file",name:"Open Data File",description:"Read a string or binary data from the selected file.",from:[Entity.Root],to:[Entity.Data.String,Entity.Data.Binary],validateParams:function(p){return!p.file?["Select a file"]:void 0},defaultParams:function(){return{type:"String",file:void 0}}},function(ctx,a,t){return Bootstrap.Task.create("Download","Silent",function(taskCtx){return __awaiter(_this,void 0,void 0,function(){var params,data;return __generator(this,function(_a){switch(_a.label){case 0:params=t.params;return[4,Bootstrap.Utils.readFromFile(params.file,getDataType(params.type)).setReportTime(true).run(ctx)];case 1:data=_a.sent();if(params.type==="String")return[2,Entity.Data.String.create(t,{label:params.id?params.id:params.file.name,description:params.description,data:data})];else return[2,Entity.Data.Binary.create(t,{label:params.id?params.id:params.file.name,description:params.description,data:data})];return[2]}})})})});Data.ParseCif=Bootstrap.Tree.Transformer.create({id:"data-parse-cif",name:"CIF Dictionary",description:"Parse CIF dictionary from a string.",from:[Entity.Data.String],to:[Entity.Data.CifDictionary],defaultParams:function(){return{}}},function(bigCtx,a,t){return Bootstrap.Task.create("CIF Parse ("+a.props.label+")","Normal",function(ctx){return __awaiter(_this,void 0,void 0,function(){var d;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing...")];case 1:_a.sent();d=LiteMol.Core.Formats.CIF.Text.parse(a.props.data);if(d.isError){throw d.toString()}return[2,Entity.Data.CifDictionary.create(t,{label:t.params.id?t.params.id:"CIF Dictionary",description:t.params.description,dictionary:d.result})]}})})}).setReportTime(true)});Data.ParseBinaryCif=Bootstrap.Tree.Transformer.create({id:"data-parse-binary-cif",name:"CIF Dictionary",description:"Parse CIF dictionary from BinaryCIF data.",from:[Entity.Data.Binary],to:[Entity.Data.CifDictionary],defaultParams:function(){return{}}},function(bigCtx,a,t){return Bootstrap.Task.create("BinaryCIF Parse ("+a.props.label+")","Normal",function(ctx){return __awaiter(_this,void 0,void 0,function(){var d;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing...")];case 1:_a.sent();d=LiteMol.Core.Formats.CIF.Binary.parse(a.props.data);if(d.isError){throw d.toString()}return[2,Entity.Data.CifDictionary.create(t,{label:t.params.id?t.params.id:"CIF Dictionary",description:t.params.description,dictionary:d.result})]}})})}).setReportTime(true)});Data.ParseJson=Bootstrap.Tree.Transformer.create({id:"data-parse-json",name:"JSON",description:"Parse a string to JSON object.",from:[Entity.Data.String],to:[Entity.Data.Json],defaultParams:function(){return{}}},function(bigCtx,a,t){return Bootstrap.Task.create("JSON Parse ("+a.props.label+")","Normal",function(ctx){return __awaiter(_this,void 0,void 0,function(){var data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing...")];case 1:_a.sent();data=JSON.parse(a.props.data);return[2,Entity.Data.Json.create(t,{label:t.params.id?t.params.id:"JSON Data",description:t.params.description,data:data})]}})})}).setReportTime(true)});Data.FromData=Bootstrap.Tree.Transformer.create({id:"data-from-data",name:"From Data",description:"Creates a data entity from string or binary data",from:[Entity.Root],to:[Entity.Data.String,Entity.Data.Binary],defaultParams:function(){return void 0}},function(ctx,a,t){var data=t.params.data;var e=data instanceof ArrayBuffer?Entity.Data.Binary.create(t,{label:t.params.id?t.params.id:"Binary Data",description:t.params.description,data:data}):Entity.Data.String.create(t,{label:t.params.id?t.params.id:"String Data",description:t.params.description,data:data});return Bootstrap.Task.resolve("From Data","Silent",e)})})(Data=Transformer.Data||(Transformer.Data={}))})(Transformer=Entity.Transformer||(Entity.Transformer={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){var Transformer;(function(Transformer){var Density;(function(Density){"use strict";var _this=this;Density.ParseData=Bootstrap.Tree.Transformer.create({id:"density-parse-binary",name:"Density Data",description:"Parse density from binary data.",from:[Entity.Data.String,Entity.Data.Binary],to:[Entity.Density.Data],isUpdatable:true,defaultParams:function(){return{format:LiteMol.Core.Formats.Density.SupportedFormats.CCP4}}},function(bigCtx,a,t){return Bootstrap.Task.create("Create Density ("+a.props.label+")","Background",function(ctx){return __awaiter(_this,void 0,void 0,function(){var data,e;return __generator(this,function(_a){switch(_a.label){case 0:return[4,Bootstrap.Task.fromComputation("Parse Density ("+a.props.label+")","Normal",t.params.format.parse(a.props.data)).setReportTime(true).run(bigCtx)];case 1:data=_a.sent();if(data.isError){throw data.toString()}e=Entity.Density.Data.create(t,{label:t.params.id?t.params.id:"Density Data",data:data.result});return[2,e]}})})})});Density.CreateFromCif=Bootstrap.Tree.Transformer.create({id:"density-create-from-cif",name:"Density Data",description:"Parse density from CIF data.",from:[Entity.Data.CifDictionary],to:[Entity.Density.Data],isUpdatable:false,defaultParams:function(){return{blockIndex:0}}},function(bigCtx,a,t){return Bootstrap.Task.create("Create Density","Normal",function(ctx){return __awaiter(_this,void 0,void 0,function(){var data;return __generator(this,function(_a){switch(_a.label){case 0:return[4,ctx.updateProgress("Parsing...")];case 1:_a.sent();data=LiteMol.Core.Formats.Density.CIF.parse(a.props.dictionary.dataBlocks[t.params.blockIndex]);if(data.isError){throw data.toString()}return[2,Entity.Density.Data.create(t,{label:t.params.id?t.params.id:"Density Data",data:data.result,description:data.result.name})]}})})}).setReportTime(true)});Density.CreateFromData=Bootstrap.Tree.Transformer.create({id:"density-create-from-data",name:"Density Data",description:"Create density from data.",from:[],to:[Entity.Density.Data],isUpdatable:false,defaultParams:function(){return{}}},function(ctx,a,t){var e=Entity.Density.Data.create(t,{label:t.params.id?t.params.id:"Density Data",data:t.params.data,description:t.params.data.name});return Bootstrap.Task.resolve("Create Density","Background",e)});Density.CreateVisual=Bootstrap.Tree.Transformer.create({id:"density-create-visual",name:"Surface",description:"Create a surface from the density data.",from:[Entity.Density.Data],to:[Entity.Density.Visual],isUpdatable:true,defaultParams:function(){return{style:Bootstrap.Visualization.Density.Default.Style}},validateParams:function(p){return!p.style?["Specify Style"]:void 0},customController:function(ctx,t,e){return new Bootstrap.Components.Transform.DensityVisual(ctx,t,e)}},function(ctx,a,t){var params=t.params;return Bootstrap.Visualization.Density.create(a,t,params.style).setReportTime(Bootstrap.Visualization.Style.getTaskType(t.params.style)==="Normal")},function(ctx,b,t){var oldStyle=b.transform.params.style;var newStyle=t.params.style;if(oldStyle.type!==t.params.style.type)return void 0;var parent=Bootstrap.Tree.Node.findClosestNodeOfType(b,[Entity.Density.Data]);if(!parent)return void 0;var model=b.props.model;if(!model)return void 0;if(!compareVisualParams(parent.props.data,oldStyle.params,newStyle.params))return void 0;if(!Bootstrap.Utils.deepEqual(oldStyle.theme,t.params.style.theme)){var ti=newStyle.theme;var theme=ti.template.provider(parent,Bootstrap.Visualization.Theme.getProps(ti));model.applyTheme(theme);b.props.style.theme=ti;Entity.nodeUpdated(b)}return Bootstrap.Task.resolve(t.transformer.info.name,"Background",Bootstrap.Tree.Node.Null)});Density.CreateVisualBehaviour=Bootstrap.Tree.Transformer.create({id:"density-create-visual-behaviour",name:"Interactive Surface",description:"Create a surface from the density data when a residue or atom is selected.",from:[Entity.Density.Data],to:[Entity.Density.InteractiveSurface],isUpdatable:true,defaultParams:function(ctx){return{style:Bootstrap.Visualization.Density.Default.Style,radius:ctx.settings.get("density.defaultVisualBehaviourRadius")||0,isoSigmaMin:-5,isoSigmaMax:5,minRadius:0,maxRadius:10,showFull:false}},customController:function(ctx,t,e){return new Bootstrap.Components.Transform.DensityVisual(ctx,t,e)}},function(ctx,a,t){var params=t.params;var b=new Bootstrap.Behaviour.Density.ShowDynamicDensity(ctx,{style:params.style,radius:params.radius,showFull:params.showFull});var isSigma=params.style.params.isoValueType===void 0||params.style.params.isoValueType===Bootstrap.Visualization.Density.IsoValueType.Sigma;return Bootstrap.Task.resolve("Behaviour","Background",Entity.Density.InteractiveSurface.create(t,{label:(params.id?t.params.id:"Interactive")+", "+Bootstrap.Utils.round(params.style.params.isoValue,2)+(isSigma?" σ":""),behaviour:b}))},function(ctx,b,t){var oldParams=b.transform.params;var newParams=t.params;if(oldParams.style.type!==newParams.style.type)return void 0;if(oldParams.isoSigmaMin!==newParams.isoSigmaMin||oldParams.isoSigmaMax!==newParams.isoSigmaMax||oldParams.minRadius!==newParams.minRadius||oldParams.maxRadius!==newParams.maxRadius||oldParams.radius!==newParams.radius||oldParams.showFull!==newParams.showFull){return void 0}var parent=Bootstrap.Tree.Node.findClosestNodeOfType(b,[Entity.Density.Data]);if(!parent)return void 0;if(!compareVisualParams(parent.props.data,oldParams.style.params,newParams.style.params))return void 0;var ti=newParams.style.theme;b.props.behaviour.updateTheme(ti);Entity.nodeUpdated(b);return Bootstrap.Task.resolve(t.transformer.info.name,"Background",Bootstrap.Tree.Node.Null)});function compareVisualParams(data,a,b){if(!Bootstrap.Visualization.Density.areNonIsoParamsSame(a,b))return false;var valuesInfo=data.valuesInfo;var oldIso=a.isoValueType===Bootstrap.Visualization.Density.IsoValueType.Absolute?a.isoValue:valuesInfo.mean+valuesInfo.sigma*a.isoValue;var newIso=b.isoValueType===Bootstrap.Visualization.Density.IsoValueType.Absolute?b.isoValue:valuesInfo.mean+valuesInfo.sigma*b.isoValue;return Math.abs(oldIso-newIso)<1e-6}})(Density=Transformer.Density||(Transformer.Density={}))})(Transformer=Entity.Transformer||(Entity.Transformer={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Entity;(function(Entity){var Transformer;(function(Transformer){var Molecule;(function(Molecule){var CoordinateStreaming;(function(CoordinateStreaming){"use strict";var _this=this;CoordinateStreaming.CreateBehaviour=Bootstrap.Tree.Transformer.create({id:"streaming-create-behaviour",name:"Coordinate Streaming",description:"Enable coordinate data streaming for this molecule.",from:[Entity.Molecule.Model],to:[Entity.Molecule.CoordinateStreaming.Behaviour],defaultParams:function(ctx){return{server:ctx.settings.get("molecule.coordinateStreaming.defaultServer")||"",radius:ctx.settings.get("molecule.coordinateStreaming.defaultRadius")||0}}},function(ctx,a,t){return Bootstrap.Task.resolve("Behaviour","Background",Entity.Molecule.CoordinateStreaming.Behaviour.create(t,{label:"Coordinate Streaming",behaviour:new Bootstrap.Behaviour.Molecule.CoordinateStreaming(ctx,t.params.server,t.params.radius)}))});CoordinateStreaming.CreateModel=Bootstrap.Tree.Transformer.create({id:"streaming-create-model",name:"Streaming Model",description:"",from:[Entity.Molecule.CoordinateStreaming.Behaviour],to:[Entity.Molecule.Model],defaultParams:function(){return void 0}},function(ctx,a,t){return Bootstrap.Task.create("Load","Silent",function(ctx){return __awaiter(_this,void 0,void 0,function(){var cif,model;return __generator(this,function(_a){cif=LiteMol.Core.Formats.CIF.Binary.parse(t.params.data);if(cif.isError)throw new Error("Invalid CIF.");model=LiteMol.Core.Formats.Molecule.mmCIF.ofDataBlock(cif.result.dataBlocks[0]).models[0];if(t.params.transform)LiteMol.Core.Structure.Operator.applyToModelUnsafe(t.params.transform,model);return[2,Entity.Molecule.Model.create(t,{label:"part",model:model})]})})})});CoordinateStreaming.InitStreaming=Bootstrap.Tree.Transformer.action({id:"streaming-init",name:"Coordinate Streaming",description:"Download a smaller version of the molecule required to display cartoon representation and stream the rest of the coordinates as required.",from:[Entity.Root],to:[Entity.Action],validateParams:function(p){return!(p.id||"").trim().length?["Enter id"]:!(p.server||"").trim().length?["Specify server"]:void 0},defaultParams:function(ctx){return{id:ctx.settings.get("molecule.coordinateStreaming.defaultId")||"",server:ctx.settings.get("molecule.coordinateStreaming.defaultServer")||"",radius:ctx.settings.get("molecule.coordinateStreaming.defaultRadius")||0}}},function(context,a,t){return Bootstrap.Tree.Transform.build().add(a,Transformer.Data.Download,{url:Bootstrap.Behaviour.Molecule.CoordinateStreaming.getBaseUrl(t.params.id,t.params.server),type:"Binary",id:t.params.id}).then(Transformer.Data.ParseBinaryCif,{id:t.params.id},{isBinding:true}).then(Molecule.CreateFromMmCif,{blockIndex:0},{isBinding:true}).then(Molecule.CreateModel,{modelIndex:0},{isBinding:false}).then(CoordinateStreaming.CreateBehaviour,{server:t.params.server,radius:t.params.radius})})})(CoordinateStreaming=Molecule.CoordinateStreaming||(Molecule.CoordinateStreaming={}))})(Molecule=Transformer.Molecule||(Transformer.Molecule={}))})(Transformer=Entity.Transformer||(Entity.Transformer={}))})(Entity=Bootstrap.Entity||(Bootstrap.Entity={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Utils;(function(Utils){var Molecule;(function(Molecule){"use strict";var Geometry=LiteMol.Core.Geometry;var LA=Geometry.LinearAlgebra;var __model=[Bootstrap.Entity.Molecule.Model];function findModel(entity){return Bootstrap.Tree.Node.findClosestNodeOfType(entity,__model)}Molecule.findModel=findModel;var __modelOrSelection=[Bootstrap.Entity.Molecule.Model,Bootstrap.Entity.Molecule.Selection];function findModelOrSelection(entity){return Bootstrap.Tree.Node.findClosestNodeOfType(entity,__modelOrSelection)}Molecule.findModelOrSelection=findModelOrSelection;var __molecule=[Bootstrap.Entity.Molecule.Molecule];function findMolecule(entity){return Bootstrap.Tree.Node.findClosestNodeOfType(entity,__molecule)}Molecule.findMolecule=findMolecule;function findQueryContext(entity){var source=Bootstrap.Tree.Node.findClosestNodeOfType(entity,__modelOrSelection);if(Bootstrap.Entity.isMoleculeModel(source)){return source.props.model.queryContext}else{var cache=source.tree.context.entityCache;var ctx=cache.get(source,Bootstrap.Entity.Cache.Keys.QueryContext);if(ctx)return ctx;ctx=LiteMol.Core.Structure.Query.Context.ofAtomIndices(findModel(source).props.model,source.props.indices);return cache.set(source,Bootstrap.Entity.Cache.Keys.QueryContext,ctx)}}Molecule.findQueryContext=findQueryContext;function getDistance(mA,startAtomIndexA,endAtomIndexA,mB,startAtomIndexB,endAtomIndexB){var _a=mA.positions,x=_a.x,y=_a.y,z=_a.z;var _c=mB.positions,bX=_c.x,bY=_c.y,bZ=_c.z;var d=Number.POSITIVE_INFINITY;for(var i=startAtomIndexA;i<endAtomIndexA;i++){for(var j=startAtomIndexB;j<endAtomIndexB;j++){var dx=x[i]-bX[j],dy=y[i]-bY[j],dz=z[i]-bZ[j];d=Math.min(d,dx*dx+dy*dy+dz*dz)}}return Math.sqrt(d)}Molecule.getDistance=getDistance;function getDistanceSet(mA,setA,mB,setB){var _a=mA.positions,x=_a.x,y=_a.y,z=_a.z;var _c=mB.positions,bX=_c.x,bY=_c.y,bZ=_c.z;var d=Number.POSITIVE_INFINITY;for(var _i=0,setA_1=setA;_i<setA_1.length;_i++){var i=setA_1[_i];for(var _d=0,setB_1=setB;_d<setB_1.length;_d++){var j=setB_1[_d];var dx=x[i]-bX[j],dy=y[i]-bY[j],dz=z[i]-bZ[j];d=Math.min(d,dx*dx+dy*dy+dz*dz)}}return Math.sqrt(d)}Molecule.getDistanceSet=getDistanceSet;function getModelAndIndicesFromQuery(m,query){var model=findModel(m);if(!model){console.warn("Could not find a model for query selection.");return void 0}var queryContext=findQueryContext(m);try{var q=LiteMol.Core.Structure.Query.Builder.toQuery(query);return{model:model,indices:q(queryContext).unionAtomIndices(),queryContext:queryContext}}catch(e){console.error("Query Execution",e);return void 0}}Molecule.getModelAndIndicesFromQuery=getModelAndIndicesFromQuery;function getResidueIndices(m,atom){var rI=m.data.atoms.residueIndex;var idx=[];for(var i=m.data.residues.atomStartIndex[rI[atom]],_b=m.data.residues.atomEndIndex[rI[atom]];i<_b;i++){idx.push(i)}return idx}Molecule.getResidueIndices=getResidueIndices;function getBox(molecule,atomIndices,delta){var _a=molecule.positions,x=_a.x,y=_a.y,z=_a.z,min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE];for(var _i=0,atomIndices_3=atomIndices;_i<atomIndices_3.length;_i++){var i=atomIndices_3[_i];min[0]=Math.min(x[i],min[0]);min[1]=Math.min(y[i],min[1]);min[2]=Math.min(z[i],min[2]);max[0]=Math.max(x[i],max[0]);max[1]=Math.max(y[i],max[1]);max[2]=Math.max(z[i],max[2])}min[0]=min[0]-delta;min[1]=min[1]-delta;min[2]=min[2]-delta;max[0]=max[0]+delta;max[1]=max[1]+delta;max[2]=max[2]+delta;return{bottomLeft:min,topRight:max}}Molecule.getBox=getBox;var CentroidHelper=function(){function CentroidHelper(model){this.center={x:0,y:0,z:0};this.radiusSquared=0;this.count=0;this.x=model.positions.x;this.y=model.positions.y;this.z=model.positions.z}CentroidHelper.prototype.addAtom=function(i){this.count++;this.center.x+=this.x[i];this.center.y+=this.y[i];this.center.z+=this.z[i]};CentroidHelper.prototype.finishedAdding=function(){this.center.x/=this.count;this.center.y/=this.count;this.center.z/=this.count};CentroidHelper.prototype.radiusVisit=function(i){var dx=this.center.x-this.x[i],dy=this.center.y-this.y[i],dz=this.center.z-this.z[i];this.radiusSquared=Math.max(this.radiusSquared,dx*dx+dy*dy+dz*dz)};return CentroidHelper}();Molecule.CentroidHelper=CentroidHelper;function getCentroidAndRadius(m,indices,into){LA.Vector3.set(into,0,0,0);var _a=m.positions,x=_a.x,y=_a.y,z=_a.z;if(indices.length===0)return 0;if(indices.length===1){LA.Vector3.set(into,x[indices[0]],y[indices[0]],z[indices[0]]);return 0}for(var _i=0,indices_12=indices;_i<indices_12.length;_i++){var i=indices_12[_i];into[0]+=x[i];into[1]+=y[i];into[2]+=z[i]}var c=indices.length;into[0]/=c;into[1]/=c;into[2]/=c;var radius=0;for(var _c=0,indices_13=indices;_c<indices_13.length;_c++){var i=indices_13[_c];var dx=into[0]-x[i],dy=into[1]-y[i],dz=into[2]-z[i];radius=Math.max(radius,dx*dx+dy*dy+dz*dz)}return Math.sqrt(radius)}Molecule.getCentroidAndRadius=getCentroidAndRadius;Molecule.Labels3DKinds=["Residue-Name","Residue-Full-Id","Atom-Name","Atom-Element"];Molecule.Labels3DKindLabels={"Residue-Name":"Residue Name","Residue-Full-Id":"Residue Full Id","Atom-Name":"Atom Name","Atom-Element":"Atom Element"};function labelProvider(options,model){var _a=model.data.atoms,residueIndex=_a.residueIndex,chainIndex=_a.chainIndex,name=_a.name,elementSymbol=_a.elementSymbol;var _c=model.data.residues,residueName=_c.name,seqNumber=_c.seqNumber;var authAsymId=model.data.chains.authAsymId;switch(options.kind){case"Residue-Name":return function(i){return residueName[residueIndex[i]]};case"Residue-Full-Id":return function(i){var r=residueIndex[i],c=chainIndex[i];return residueName[r]+" "+authAsymId[c]+" "+seqNumber[r]};case"Atom-Name":return function(i){return name[i]};case"Atom-Element":return function(i){return elementSymbol[i]};default:return function(i){return""+i}}}function create3DLabelsParams(entity,options,theme){var ctx=findQueryContext(entity);var query=options.kind.indexOf("Residue")>=0?LiteMol.Core.Structure.Query.residues():LiteMol.Core.Structure.Query.allAtoms();var fs=query.compile()(ctx);var label=labelProvider(options,ctx.structure);var positions=LiteMol.Core.Utils.DataTable.ofDefinition(LiteMol.Core.Structure.Tables.Positions,fs.length);var x=positions.x,y=positions.y,z=positions.z;var labels=[];var sizes=new Float32Array(fs.length);var center=LA.Vector3.zero();var i=0;for(var _i=0,_a=fs.fragments;_i<_a.length;_i++){var f=_a[_i];var l=label(f.atomIndices[0]);getCentroidAndRadius(ctx.structure,f.atomIndices,center);x[i]=center[0];y[i]=center[1];z[i]=center[2];labels[labels.length]=l;sizes[i]=1;i++}return{labels:labels,options:options.labelsOptions,positions:positions,sizes:sizes,theme:theme}}Molecule.create3DLabelsParams=create3DLabelsParams})(Molecule=Utils.Molecule||(Utils.Molecule={}))})(Utils=Bootstrap.Utils||(Bootstrap.Utils={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Behaviour;(function(Behaviour){"use strict";var Streams=function(){function Streams(context){this.context=context;this.subjects={select:new Bootstrap.Rx.BehaviorSubject(Bootstrap.Interactivity.Info.empty),click:new Bootstrap.Rx.BehaviorSubject(Bootstrap.Interactivity.Info.empty),currentEntity:new Bootstrap.Rx.BehaviorSubject(void 0)};this.select=this.subjects.select.distinctUntilChanged(function(i){return i},Bootstrap.Interactivity.interactivityInfoEqual);this.click=this.subjects.click.distinctUntilChanged(function(i){return i},Bootstrap.Interactivity.interactivityInfoEqual);this.currentEntity=this.subjects.currentEntity;this.init()}Streams.prototype.init=function(){var _this=this;var latestClick=Bootstrap.Interactivity.Info.empty;Bootstrap.Event.Tree.NodeRemoved.getStream(this.context).subscribe(function(e){if(Bootstrap.Interactivity.isSelection(latestClick)&&latestClick.source===e.data){latestClick=Bootstrap.Interactivity.Info.empty;Bootstrap.Event.Visual.VisualSelectElement.dispatch(_this.context,latestClick)}});Bootstrap.Event.Visual.VisualSelectElement.getStream(this.context).subscribe(function(e){latestClick=e.data;_this.subjects.click.onNext(latestClick);if(Bootstrap.Interactivity.isSelection(latestClick)&&Bootstrap.Entity.isVisual(latestClick.source)&&!latestClick.source.props.isSelectable)return;_this.subjects.select.onNext(latestClick)});Bootstrap.Event.Entity.CurrentChanged.getStream(this.context).subscribe(function(e){return _this.subjects.currentEntity.onNext(e.data)})};return Streams}();Behaviour.Streams=Streams})(Behaviour=Bootstrap.Behaviour||(Bootstrap.Behaviour={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Behaviour;(function(Behaviour){"use strict";function SetEntityToCurrentWhenAdded(context){Bootstrap.Event.Tree.NodeAdded.getStream(context).subscribe(function(ev){var e=ev.data;if(e&&(e.transform.isUpdate||e.type.info.traits.isSilent))return;Bootstrap.Command.Entity.SetCurrent.dispatch(context,e)})}Behaviour.SetEntityToCurrentWhenAdded=SetEntityToCurrentWhenAdded;Behaviour.SuppressCreateVisualWhenModelIsAdded=false;function CreateVisualWhenModelIsAdded(context){Bootstrap.Event.Tree.NodeAdded.getStream(context).subscribe(function(e){if(Behaviour.SuppressCreateVisualWhenModelIsAdded||!Bootstrap.Tree.Node.is(e.data,Bootstrap.Entity.Molecule.Model)||e.data.isHidden){return}var prms=Bootstrap.Entity.Transformer.Molecule.CreateMacromoleculeVisual.info.defaultParams(context,e.data);Bootstrap.Command.Tree.ApplyTransform.dispatch(context,{node:e.data,transform:Bootstrap.Entity.Transformer.Molecule.CreateMacromoleculeVisual.create(prms)})})}Behaviour.CreateVisualWhenModelIsAdded=CreateVisualWhenModelIsAdded;function ApplySelectionToVisual(context){Bootstrap.Event.Tree.NodeAdded.getStream(context).subscribe(function(ev){var e=ev.data;if(Bootstrap.Entity.isMoleculeSelection(e)&&Bootstrap.Entity.isVisual(e.parent)){var s=e;var v=e.parent;v.props.model.applySelection(s.props.indices,1)}});Bootstrap.Event.Tree.NodeRemoved.getStream(context).subscribe(function(ev){var e=ev.data;if(Bootstrap.Entity.isMoleculeSelection(e)&&Bootstrap.Entity.isVisual(e.parent)){var s=e;var v=e.parent;v.props.model.applySelection(s.props.indices,2)}})}Behaviour.ApplySelectionToVisual=ApplySelectionToVisual;function ApplyInteractivitySelection(context){var latestIndices=void 0;var latestModel=void 0;context.behaviours.click.subscribe(function(info){if(latestModel){latestModel.applySelection(latestIndices,2);latestModel=void 0;latestIndices=void 0}if(Bootstrap.Interactivity.isEmpty(info)||!Bootstrap.Entity.isVisual(info.source))return;latestModel=info.source.props.model;latestIndices=info.elements;latestModel.applySelection(latestIndices,1)})}Behaviour.ApplyInteractivitySelection=ApplyInteractivitySelection;function UnselectElementOnRepeatedClick(context){var latest=Bootstrap.Interactivity.Info.empty;Bootstrap.Event.Visual.VisualSelectElement.getStream(context).subscribe(function(e){if(Bootstrap.Interactivity.isEmpty(e.data)||Bootstrap.Interactivity.isEmpty(latest)){latest=e.data;return}if((Bootstrap.Tree.Node.hasAncestor(latest.source,e.data.source)||Bootstrap.Tree.Node.hasAncestor(e.data.source,latest.source))&&Bootstrap.Interactivity.interactivitySelectionElementsEqual(e.data,latest)){latest=Bootstrap.Interactivity.Info.empty;setTimeout(function(){return Bootstrap.Event.Visual.VisualSelectElement.dispatch(context,Bootstrap.Interactivity.Info.empty)},0)}else{latest=e.data}})}Behaviour.UnselectElementOnRepeatedClick=UnselectElementOnRepeatedClick;var center=LiteMol.Core.Geometry.LinearAlgebra.Vector3.zero();function updateCameraModel(context,info){var model=Bootstrap.Utils.Molecule.findModel(info.source).props.model;if(!model)return;var elems=info.elements;if(info.elements.length===1){elems=Bootstrap.Utils.Molecule.getResidueIndices(model,info.elements[0])}var radius=Bootstrap.Utils.Molecule.getCentroidAndRadius(model,elems,center);if(info.elements.length===1){var a=info.elements[0];center[0]=model.positions.x[a];center[1]=model.positions.y[a];center[2]=model.positions.z[a]}context.scene.camera.focusOnPoint(LiteMol.Core.Geometry.LinearAlgebra.Vector3.toObj(center),Math.max(radius,7))}function updateCameraVisual(context,info){if(Bootstrap.Interactivity.isEmpty(info)||info.source.type.info.typeClass!=="Visual")return;var v=info.source;var m=v.props.model;if(!m)return;var bs=m.getBoundingSphereOfSelection(info.elements);if(bs){context.scene.camera.focusOnPoint(LiteMol.Core.Geometry.LinearAlgebra.Vector3.toObj(bs.center),Math.max(bs.radius,7))}else{context.scene.camera.focusOnModel(m)}}function FocusCameraOnSelect(context){context.behaviours.click.subscribe(function(e){if(Bootstrap.Interactivity.Molecule.isMoleculeModelInteractivity(e))updateCameraModel(context,e);else updateCameraVisual(context,e)})}Behaviour.FocusCameraOnSelect=FocusCameraOnSelect})(Behaviour=Bootstrap.Behaviour||(Bootstrap.Behaviour={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Behaviour;(function(Behaviour){var Molecule;(function(Molecule){"use strict";var Query=LiteMol.Core.Structure.Query;var Transforms=Bootstrap.Entity.Transformer;Molecule.SuppressShowInteractionOnSelect=false;function ShowInteractionOnSelect(radius){return function(context){var lastRef=void 0;var ambRef=void 0;var ligandStyle={type:"BallsAndSticks",taskType:"Silent",params:{useVDW:true,vdwScaling:.25,bondRadius:.13,detail:"Automatic"},theme:{template:Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate,colors:Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate.colors.set("Bond",LiteMol.Visualization.Theme.Default.SelectionColor),transparency:{alpha:.4}},isNotSelectable:true};var ambStyle={type:"BallsAndSticks",taskType:"Silent",params:{useVDW:false,atomRadius:.15,bondRadius:.07,detail:"Automatic"},theme:{template:Bootstrap.Visualization.Molecule.Default.UniformThemeTemplate,colors:Bootstrap.Visualization.Molecule.Default.UniformThemeTemplate.colors.set("Uniform",{r:.4,g:.4,b:.4}),transparency:{alpha:.75}},isNotSelectable:true};function clean(){if(lastRef){Bootstrap.Command.Tree.RemoveNode.dispatch(context,lastRef);lastRef=void 0;ambRef=void 0}}context.behaviours.click.subscribe(function(info){if(Molecule.SuppressShowInteractionOnSelect||Bootstrap.Interactivity.isEmpty(info)){clean();return}if(info.source.ref===ambRef){var model=Bootstrap.Utils.Molecule.findModel(info.source);if(!model)return;var query=Query.atomsFromIndices(info.elements);setTimeout(Bootstrap.Command.Molecule.CreateSelectInteraction.dispatch(context,{entity:model,query:query}),0);return}var isSelectable=Bootstrap.Entity.isVisual(info.source)?info.source.props.isSelectable:true;if(!isSelectable)return;clean();if(Bootstrap.Interactivity.isEmpty(info)||!Bootstrap.Utils.Molecule.findModelOrSelection(info.source))return;var ligandQ=Query.atomsFromIndices(info.elements).wholeResidues();var ambQ=Query.atomsFromIndices(info.elements).wholeResidues().ambientResidues(radius);var ref=Bootstrap.Utils.generateUUID();var action=Bootstrap.Tree.Transform.build().add(info.source,Transforms.Basic.CreateGroup,{label:"Interaction"},{ref:ref,isHidden:true});lastRef=ref;ambRef=Bootstrap.Utils.generateUUID();action.then(Transforms.Molecule.CreateSelectionFromQuery,{query:ambQ,name:"Ambience",silent:true,inFullContext:true},{isBinding:true}).then(Transforms.Molecule.CreateVisual,{style:ambStyle},{ref:ambRef});action.then(Transforms.Molecule.CreateSelectionFromQuery,{query:ligandQ,name:"Ligand",silent:true,inFullContext:true},{isBinding:true}).then(Transforms.Molecule.CreateVisual,{style:ligandStyle});Bootstrap.Tree.Transform.apply(context,action).run()})}}Molecule.ShowInteractionOnSelect=ShowInteractionOnSelect;function HighlightElementInfo(context){context.highlight.addProvider(function(info){if(!Bootstrap.Interactivity.Molecule.isMoleculeModelInteractivity(info))return void 0;var data=Bootstrap.Interactivity.Molecule.transformInteraction(info);return Bootstrap.Interactivity.Molecule.formatInfo(data)})}Molecule.HighlightElementInfo=HighlightElementInfo;function DistanceToLastClickedElement(context){var lastInfo=Bootstrap.Interactivity.Info.empty;var lastSel=void 0;var lastModel=void 0;context.behaviours.click.subscribe(function(info){if(!Bootstrap.Interactivity.Molecule.isMoleculeModelInteractivity(info)){lastInfo=Bootstrap.Interactivity.Info.empty;lastModel=void 0;lastSel=void 0}else{lastInfo=info;var m=Bootstrap.Utils.Molecule.findModel(info.source);if(!m){lastInfo=Bootstrap.Interactivity.Info.empty;lastModel=void 0;lastSel=void 0}else{lastModel=m.props.model;lastSel=Bootstrap.Interactivity.Molecule.formatInfoShort(Bootstrap.Interactivity.Molecule.transformInteraction(info))}}});context.highlight.addProvider(function(info){if(!Bootstrap.Interactivity.Molecule.isMoleculeModelInteractivity(info))return void 0;if(Bootstrap.Interactivity.isEmpty(lastInfo))return void 0;var m=Bootstrap.Utils.Molecule.findModel(info.source);if(!m)return void 0;var dist=Bootstrap.Utils.Molecule.getDistanceSet(lastModel,lastInfo.elements,m.props.model,info.elements);if(dist<1e-4)return void 0;return"<span><b>"+Bootstrap.Utils.round(dist,2)+" Å</b> from <b>"+lastSel+"</b></span>"})}Molecule.DistanceToLastClickedElement=DistanceToLastClickedElement})(Molecule=Behaviour.Molecule||(Behaviour.Molecule={}))})(Behaviour=Bootstrap.Behaviour||(Bootstrap.Behaviour={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Behaviour;(function(Behaviour){var Density;(function(Density){"use strict";var ToastKey="__ShowDynamicDensity-toast";var ShowDynamicDensity=function(){function ShowDynamicDensity(context,params){this.context=context;this.params=params;this.obs=[];this.ref=Bootstrap.Utils.generateUUID()}ShowDynamicDensity.prototype.remove=function(){var v=this.getVisual();if(v){Bootstrap.Tree.remove(v)}};ShowDynamicDensity.prototype.getVisual=function(){return this.context.select(this.ref)[0]};ShowDynamicDensity.prototype.update=function(info){if(!this.params.showFull&&!Bootstrap.Interactivity.Molecule.isMoleculeModelInteractivity(info)){this.remove();return}Bootstrap.Command.Toast.Hide.dispatch(this.context,{key:ToastKey});var style=Bootstrap.Utils.shallowClone(this.params.style);style.params=Bootstrap.Utils.shallowClone(style.params);if(this.params.showFull){style.params.bottomLeft=void 0;style.params.topRight=void 0;style.taskType="Normal"}else{var i=info;var model=Bootstrap.Utils.Molecule.findModel(i.source);var elems=i.elements;var m=model.props.model;if(i.elements.length===1){elems=Bootstrap.Utils.Molecule.getResidueIndices(m,i.elements[0])}var box=Bootstrap.Utils.Molecule.getBox(m,elems,this.params.radius);style.params.bottomLeft=box.bottomLeft;style.params.topRight=box.topRight;style.taskType="Silent"}var task;var visual=this.getVisual();if(!visual){var t=Bootstrap.Entity.Transformer.Density.CreateVisual.create({style:style},{ref:this.ref,isHidden:true});t.isUpdate=true;task=t.apply(this.context,this.behaviour)}else task=Bootstrap.Entity.Transformer.Density.CreateVisual.create({style:style},{ref:this.ref,isHidden:true}).update(this.context,visual);task.run()};ShowDynamicDensity.prototype.updateTheme=function(ti){this.params.style.theme=ti;if(!this.behaviour)return;var v=this.getVisual();if(!v)return;var source=Bootstrap.Tree.Node.findClosestNodeOfType(this.behaviour,[Bootstrap.Entity.Density.Data]);var theme=ti.template.provider(source,Bootstrap.Visualization.Theme.getProps(ti));v.props.model.applyTheme(theme)};ShowDynamicDensity.prototype.dispose=function(){this.remove();Bootstrap.Command.Toast.Hide.dispatch(this.context,{key:ToastKey});for(var _i=0,_a=this.obs;_i<_a.length;_i++){var o=_a[_i];o.dispose()}this.obs=[]};ShowDynamicDensity.prototype.register=function(behaviour){var _this=this;this.behaviour=behaviour;if(!this.params.showFull){Bootstrap.Command.Toast.Show.dispatch(this.context,{key:ToastKey,title:"Density",message:"Click on a residue or an atom to view the data.",timeoutMs:30*1e3})}this.obs.push(this.context.behaviours.select.subscribe(function(e){_this.update(e)}))};return ShowDynamicDensity}();Density.ShowDynamicDensity=ShowDynamicDensity})(Density=Behaviour.Density||(Behaviour.Density={}))})(Behaviour=Bootstrap.Behaviour||(Bootstrap.Behaviour={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Behaviour;(function(Behaviour){var Molecule;(function(Molecule){"use strict";var Transforms=Bootstrap.Entity.Transformer;var CoordinateStreaming=function(){function CoordinateStreaming(context,server,radius){if(radius===void 0){radius=5}this.context=context;this.radius=radius;this.obs=[];this.target=void 0;this.behaviour=void 0;this.ref=Bootstrap.Utils.generateUUID();this.download=void 0;this.cache=Bootstrap.Utils.LRUCache.create(100);this.style={type:"BallsAndSticks",taskType:"Silent",params:{useVDW:true,vdwScaling:.17,bondRadius:.07,detail:"Automatic"},theme:{template:Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate,colors:Bootstrap.Visualization.Molecule.Default.ElementSymbolThemeTemplate.colors,transparency:{alpha:1}},isNotSelectable:true};this.server=CoordinateStreaming.normalizeServerName(server)}CoordinateStreaming.prototype.remove=function(){if(this.download){this.download.tryAbort();this.download=void 0}Bootstrap.Command.Tree.RemoveNode.dispatch(this.context,this.ref)};CoordinateStreaming.prototype.isApplicable=function(info){if(!Bootstrap.Interactivity.Molecule.isMoleculeModelInteractivity(info))return false;return Bootstrap.Tree.Node.hasAncestor(info.source,this.target)};CoordinateStreaming.prototype.update=function(info){var _this=this;this.remove();if(!this.isApplicable(info)){return}var model=Bootstrap.Utils.Molecule.findModel(info.source).props.model;var i=model.data.atoms.residueIndex[info.elements[0]];var rs=model.data.residues;var authAsymId=rs.authAsymId[i];var transform=void 0;if(model.source===LiteMol.Core.Structure.Molecule.Model.Source.Computed){var p=model.parent;var cI=rs.chainIndex[i];var chain=model.data.chains.sourceChainIndex[cI];authAsymId=p.data.chains.authAsymId[chain];transform=model.operators[model.data.chains.operatorIndex[cI]].matrix}var url=this.server+"/"+(model.id.toLocaleLowerCase()+"/ambientResidues?")+("modelId="+encodeURIComponent(model.modelId)+"&")+("entityId="+encodeURIComponent(rs.entityId[i])+"&")+("authAsymId="+encodeURIComponent(authAsymId)+"&")+("authSeqNumber="+encodeURIComponent(""+rs.authSeqNumber[i])+"&")+("insCode="+encodeURIComponent(rs.insCode[i]!==null?rs.insCode[i]:"")+"&")+("radius="+encodeURIComponent(""+this.radius)+"&")+"atomSitesOnly=1&"+"encoding=bcif&"+"lowPrecisionCoords=1";this.download=Bootstrap.Utils.ajaxGetArrayBuffer(url).runWithContext(this.context);var cached=Bootstrap.Utils.LRUCache.get(this.cache,url);if(cached){this.create(cached,transform)}else{this.context.performance.start(this.ref);this.download.result.then(function(data){Bootstrap.Utils.LRUCache.set(_this.cache,url,data);_this.context.performance.end(_this.ref);_this.context.logger.info("Streaming done in "+_this.context.performance.formatTime(_this.ref));_this.create(data,transform)}).catch(function(){_this.context.performance.end(_this.ref)})}};CoordinateStreaming.prototype.create=function(data,transform){var action=Bootstrap.Tree.Transform.build().add(this.behaviour,Bootstrap.Entity.Transformer.Molecule.CoordinateStreaming.CreateModel,{data:data,transform:transform},{ref:this.ref,isHidden:true}).then(Transforms.Molecule.CreateVisual,{style:this.style});Bootstrap.Tree.Transform.apply(this.context,action).run()};CoordinateStreaming.prototype.dispose=function(){this.remove();for(var _i=0,_a=this.obs;_i<_a.length;_i++){var o=_a[_i];o.dispose()}this.obs=[]};CoordinateStreaming.prototype.register=function(behaviour){var _this=this;this.behaviour=behaviour;this.target=behaviour.parent;this.obs.push(this.context.behaviours.select.subscribe(function(e){return _this.update(e)}))};return CoordinateStreaming}();Molecule.CoordinateStreaming=CoordinateStreaming;(function(CoordinateStreaming){function normalizeServerName(s){if(s[s.length-1]!=="/")return s;if(s.length>0)return s.substr(0,s.length-1);return s}CoordinateStreaming.normalizeServerName=normalizeServerName;function getBaseUrl(id,server){return normalizeServerName(server)+"/"+id.trim().toLocaleLowerCase()+"/cartoon?encoding=bcif&lowPrecisionCoords=1"}CoordinateStreaming.getBaseUrl=getBaseUrl})(CoordinateStreaming=Molecule.CoordinateStreaming||(Molecule.CoordinateStreaming={}))})(Molecule=Behaviour.Molecule||(Behaviour.Molecule={}))})(Behaviour=Bootstrap.Behaviour||(Bootstrap.Behaviour={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Behaviour;(function(Behaviour){"use strict";function trackTransform(ctx,name,transformer,a,transform,selector,gaId){if(transform.transformer!==transformer)return;try{var ga=window[gaId];var p=selector(transform.params,a);if(ga&&typeof p!=="undefined"){ga("send","event",name,p,ctx.id)}}catch(e){}}function selectedMoleculeCreateFromData(p,a){return p.format.name}function selectDownload(p){return p.url}function selectQuery(p){return p.queryString}function selectAssembly(p,a){if(Bootstrap.Tree.Node.isHidden(a))return void 0;var m=Bootstrap.Utils.Molecule.findModel(a);if(!m)return void 0;return m.props.model.id+" $(name)$ "+p.name}function selectCrystalSymmetry(p,a){if(Bootstrap.Tree.Node.isHidden(a))return void 0;var m=Bootstrap.Utils.Molecule.findModel(a);if(!m)return void 0;return m.props.model.id+" $(type)$ "+p.type+" $(radius)$ "+p.radius}function selectStreaming(p,a){var m=Bootstrap.Utils.Molecule.findModel(a);if(!m)return void 0;return m.props.model.id+" $(server)$ "+p.server}function selectVisual(p,a){if(Bootstrap.Tree.Node.isHidden(a))return void 0;return p.style.type}function selectDensity(p){return"$(format)$ "+p.format}function selectSelection(p,a){return p.queryString}function GoogleAnalytics(id,key){if(key===void 0){key="default"}return function(context){var gaId="ga-"+context.id+"-"+key;try{(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*+new Date;a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js",gaId);window[gaId]("create",id,"auto");setTimeout(function(){try{var ga=window[gaId];if(ga)ga("send","event","Loaded","contextId",context.id)}catch(e){}},1e3)}catch(e){}Bootstrap.Event.Tree.TransformerApply.getStream(context).subscribe(function(e){trackTransform(context,"Download",Bootstrap.Entity.Transformer.Data.Download,e.data.a,e.data.t,selectDownload,gaId);trackTransform(context,"Create Molecule From Data",Bootstrap.Entity.Transformer.Molecule.CreateFromData,e.data.a,e.data.t,selectedMoleculeCreateFromData,gaId);trackTransform(context,"Create Model Selecion",Bootstrap.Entity.Transformer.Molecule.CreateSelection,e.data.a,e.data.t,selectQuery,gaId);trackTransform(context,"Create Assembly",Bootstrap.Entity.Transformer.Molecule.CreateAssembly,e.data.a,e.data.t,selectAssembly,gaId);trackTransform(context,"Create Symmetry",Bootstrap.Entity.Transformer.Molecule.CreateSymmetryMates,e.data.a,e.data.t,selectCrystalSymmetry,gaId);trackTransform(context,"Create Visual",Bootstrap.Entity.Transformer.Molecule.CreateVisual,e.data.a,e.data.t,selectVisual,gaId);trackTransform(context,"Coordinate Streaming",Bootstrap.Entity.Transformer.Molecule.CoordinateStreaming.CreateBehaviour,e.data.a,e.data.t,selectStreaming,gaId);trackTransform(context,"Parse Density",Bootstrap.Entity.Transformer.Density.ParseData,e.data.a,e.data.t,selectDensity,gaId);trackTransform(context,"Create Model Selection",Bootstrap.Entity.Transformer.Molecule.CreateSelection,e.data.a,e.data.t,selectSelection,gaId)})}}Behaviour.GoogleAnalytics=GoogleAnalytics})(Behaviour=Bootstrap.Behaviour||(Bootstrap.Behaviour={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){"use strict";var Component=function(){function Component(context,initialState){this.context=context;this._state=new Bootstrap.Rx.Subject;this._latestState=void 0;this._latestState=initialState}Object.defineProperty(Component.prototype,"dispatcher",{get:function(){return this.context.dispatcher},enumerable:true,configurable:true});Component.prototype.setState=function(){var states=[];for(var _i=0;_i<arguments.length;_i++){states[_i]=arguments[_i]}var s=Bootstrap.Utils.merge.apply(Bootstrap.Utils,[this._latestState].concat(states));if(s!==this._latestState){this._latestState=s;this._state.onNext(s)}};Object.defineProperty(Component.prototype,"state",{get:function(){return this._state},enumerable:true,configurable:true});Object.defineProperty(Component.prototype,"latestState",{get:function(){return this._latestState},enumerable:true,configurable:true});return Component}();Components.Component=Component})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){"use strict";var LayoutRegion;(function(LayoutRegion){LayoutRegion[LayoutRegion["Main"]=0]="Main";LayoutRegion[LayoutRegion["Top"]=1]="Top";LayoutRegion[LayoutRegion["Right"]=2]="Right";LayoutRegion[LayoutRegion["Bottom"]=3]="Bottom";LayoutRegion[LayoutRegion["Left"]=4]="Left";LayoutRegion[LayoutRegion["Root"]=5]="Root"})(LayoutRegion=Components.LayoutRegion||(Components.LayoutRegion={}));var CollapsedControlsLayout;(function(CollapsedControlsLayout){CollapsedControlsLayout[CollapsedControlsLayout["Outside"]=0]="Outside";CollapsedControlsLayout[CollapsedControlsLayout["Landscape"]=1]="Landscape";CollapsedControlsLayout[CollapsedControlsLayout["Portrait"]=2]="Portrait"})(CollapsedControlsLayout=Components.CollapsedControlsLayout||(Components.CollapsedControlsLayout={}));var LayoutTarget=function(){function LayoutTarget(cssClass){this.cssClass=cssClass;this.components=[]}return LayoutTarget}();Components.LayoutTarget=LayoutTarget;function makeEmptyTargets(){var ret=[];for(var i=0;i<=LayoutRegion.Root;i++){ret.push(new LayoutTarget(LayoutRegion[i].toLowerCase()))}return ret}Components.makeEmptyTargets=makeEmptyTargets;var Layout=function(_super){__extends(Layout,_super);function Layout(context,targets,root){var _this=_super.call(this,context,{isExpanded:false,hideControls:false,collapsedControlsLayout:CollapsedControlsLayout.Outside,regionStates:{}})||this;_this.targets=targets;_this.root=root;_this.rootState=void 0;Bootstrap.Command.Layout.SetState.getStream(_this.context).subscribe(function(e){return _this.update(e.data)});_this.expandedViewport=document.createElement("meta");_this.expandedViewport.name="viewport";_this.expandedViewport.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0";return _this}Layout.prototype.update=function(state){var _this=this;var prevExpanded=!!this.latestState.isExpanded;this.setState(state);if(typeof state.isExpanded==="boolean"&&state.isExpanded!==prevExpanded)this.handleExpand();this.dispatcher.schedule(function(){return Bootstrap.Event.Common.LayoutChanged.dispatch(_this.context,{})})};Layout.prototype.getScrollElement=function(){if(document.scrollingElement)return document.scrollingElement;if(document.documentElement)return document.documentElement;return document.body};Layout.prototype.handleExpand=function(){try{var body=document.getElementsByTagName("body")[0];var head=document.getElementsByTagName("head")[0];if(!body||!head)return;if(this.latestState.isExpanded){var children=head.children;var hasExp=false;var viewports=[];for(var i=0;i<children.length;i++){if(children[i]===this.expandedViewport){hasExp=true}else if((children[i].name||"").toLowerCase()==="viewport"){viewports.push(children[i])}}for(var _i=0,viewports_1=viewports;_i<viewports_1.length;_i++){var v=viewports_1[_i];head.removeChild(v)}if(!hasExp)head.appendChild(this.expandedViewport);var s=body.style;var doc=this.getScrollElement();var scrollLeft=doc.scrollLeft;var scrollTop=doc.scrollTop;this.rootState={top:s.top,bottom:s.bottom,right:s.right,left:s.left,scrollTop:scrollTop,scrollLeft:scrollLeft,position:s.position,overflow:s.overflow,viewports:viewports,zindex:this.root.style.zIndex,width:s.width,height:s.height,maxWidth:s.maxWidth,maxHeight:s.maxHeight,margin:s.margin,marginLeft:s.marginLeft,marginRight:s.marginRight,marginTop:s.marginTop,marginBottom:s.marginBottom};s.overflow="hidden";s.position="fixed";s.top="0";s.bottom="0";s.right="0";s.left="0";s.width="100%";s.height="100%";s.maxWidth="100%";s.maxHeight="100%";s.margin="0";s.marginLeft="0";s.marginRight="0";s.marginTop="0";s.marginBottom="0";this.root.style.zIndex="100000"}else{var children=head.children;for(var i=0;i<children.length;i++){if(children[i]===this.expandedViewport){head.removeChild(this.expandedViewport);break}}if(this.rootState){var s=body.style,t=this.rootState;for(var _a=0,_b=t.viewports;_a<_b.length;_a++){var v=_b[_a];head.appendChild(v)}s.top=t.top;s.bottom=t.bottom;s.left=t.left;s.right=t.right;s.width=t.width;s.height=t.height;s.maxWidth=t.maxWidth;s.maxHeight=t.maxHeight;s.margin=t.margin;s.marginLeft=t.marginLeft;s.marginRight=t.marginRight;s.marginTop=t.marginTop;s.marginBottom=t.marginBottom;s.position=t.position;s.overflow=t.overflow;var doc=this.getScrollElement();doc.scrollTop=t.scrollTop;doc.scrollLeft=t.scrollLeft;this.rootState=void 0;this.root.style.zIndex=t.zindex}}}catch(e){this.context.logger.error("Layout change error, you might have to reload the page.");console.log("Layout change error, you might have to reload the page.",e)}};return Layout}(Components.Component);Components.Layout=Layout})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Transform;(function(Transform){"use strict";var Controller=function(_super){__extends(Controller,_super);function Controller(context,transformer,entity){var _this=_super.call(this,context,{params:transformer.info.defaultParams(context,entity),canApply:false,isBusy:false,issues:void 0,parametersAutoUpdating:false,isDirty:false})||this;_this.transformer=transformer;_this.entity=entity;_this.updateTimeout=new Bootstrap.Rx.Subject;_this.timeout=Bootstrap.Rx.Observable.timer(50);_this.never=Bootstrap.Rx.Observable.never();_this.anchorParams=_this.latestState.params;_this.updateParams(_this.anchorParams);_this.updateTimeout.flatMapLatest(function(t){return t}).forEach(function(){return _this.apply()});return _this}Controller.prototype._update=function(){if(this.isUpdate&&!this.latestState.isBusy){if(this.updateTimeout){this.updateTimeout.onNext(this.timeout);this.setState({parametersAutoUpdating:true})}}};Controller.prototype._reset=function(){this.setState({parametersAutoUpdating:false});if(this.updateTimeout)this.updateTimeout.onNext(this.never)};Controller.prototype._updateParams=function(params){var updated=Bootstrap.Utils.merge(this.latestState.params,params);if(this.transformer.info.validateParams){var isInvalid=this.transformer.info.validateParams(updated);if(isInvalid&&isInvalid.length>0){this.setState({params:updated,issues:isInvalid,canApply:false});return}}var isDirty=!Bootstrap.Utils.deepEqual(this.anchorParams,updated);this.setState({params:updated,isDirty:isDirty,issues:void 0,canApply:true})};Controller.prototype.updateParams=function(params){this._reset();this._updateParams(params)};Controller.prototype.autoUpdateParams=function(params){this._update();this._updateParams(params)};Object.defineProperty(Controller.prototype,"isUpdate",{get:function(){return this.transformer===this.entity.transform.transformer},enumerable:true,configurable:true});Controller.prototype.apply=function(){var _this=this;this._reset();if(this.latestState.isBusy)return;var transform=this.transformer.create(this.latestState.params);this.anchorParams=this.latestState.params;this.setState({isDirty:false,isBusy:true});try{var task=this.isUpdate?transform.update(this.context,this.entity):transform.apply(this.context,this.entity);var ret=task.run();ret.then(function(){return _this.setState({isBusy:false})}).catch(function(){return _this.setState({isBusy:false})});return ret}catch(e){this.setState({isBusy:false});return LiteMol.Core.Computation.reject(e)}};Controller.prototype.setParams=function(params){this._reset();this.anchorParams=params;this.updateParams(params)};return Controller}(Components.Component);Transform.Controller=Controller})(Transform=Components.Transform||(Components.Transform={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Transform;(function(Transform){"use strict";var View=function(_super){__extends(View,_super);function View(context){var _this=_super.call(this,context,{update:void 0,transforms:[]})||this;_this.update();Bootstrap.Event.Entity.CurrentChanged.getStream(context).subscribe(function(){return _this.update()});return _this}View.prototype.update=function(){if(!this.context.currentEntity){this.setState({transforms:[]});return}var e=this.context.currentEntity;var manager=this.context.transforms;var update=void 0;if(e.transform.transformer&&e.transform.transformer.info.isUpdatable){update=manager.getController(e.transform.transformer,e)}var transforms=[];for(var _i=0,_a=this.context.transforms.getBySourceType(e.type);_i<_a.length;_i++){var t=_a[_i];if(t.info.isApplicable&&!t.info.isApplicable(e)){continue}var c=manager.getController(t,e);if(c)transforms.push(c)}this.setState({update:update,transforms:transforms})};return View}(Components.Component);Transform.View=View})(Transform=Components.Transform||(Components.Transform={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Transform;(function(Transform){"use strict";var VisualStyle=function(_super){__extends(VisualStyle,_super);function VisualStyle(){return _super!==null&&_super.apply(this,arguments)||this}VisualStyle.prototype.updateTemplate=function(key,all){var s=all.get(key);var latestTheme=this.latestState&&this.latestState.params.style.theme;var params=s.params;var theme=latestTheme||this.getThemeInstance(s.theme.template);var style={type:s.type,params:params,theme:theme};this.autoUpdateParams({style:style})};VisualStyle.prototype.updateStyleParams=function(params){var s=Bootstrap.Utils.shallowClone(this.latestState.params.style);s.params=Bootstrap.Utils.merge(s.params,params);this.autoUpdateParams({style:s})};VisualStyle.prototype.updateStyleTheme=function(theme){var s=Bootstrap.Utils.shallowClone(this.latestState.params.style);s.theme=Bootstrap.Utils.merge(s.theme,theme);this.autoUpdateParams({style:s})};VisualStyle.prototype.updateThemeColor=function(name,value){var oldTheme=this.latestState.params.style.theme;if(!oldTheme)return;var colors=oldTheme.colors;if(!colors)colors=Bootstrap.Immutable.Map();colors=colors.set(name,value);this.updateStyleTheme({colors:colors})};VisualStyle.prototype.updateThemeVariable=function(name,value){var oldTheme=this.latestState.params.style.theme;if(!oldTheme)return;var variables=oldTheme.variables;if(!variables)variables=Bootstrap.Immutable.Map();variables=variables.set(name,value);this.updateStyleTheme({variables:variables})};VisualStyle.prototype.updateThemeTransparency=function(transparency){var oldTheme=this.latestState.params.style.theme;if(!oldTheme)return;this.updateStyleTheme({transparency:transparency})};VisualStyle.prototype.getThemeInstance=function(template){var oldTheme=this.latestState.params.style.theme;var defaultTransparency=Bootstrap.Visualization.Molecule.Default.ForType.get(this.latestState.params.style.type).theme.transparency;if(!oldTheme)return{template:template,colors:template.colors,transparency:defaultTransparency};var colors=template.colors;if(oldTheme.colors&&colors){colors=colors.withMutations(function(map){oldTheme.colors.forEach(function(c,n){if(map.has(n))map.set(n,c)})})}var variables=template.variables;if(oldTheme.variables&&variables){variables=variables.withMutations(function(map){oldTheme.variables.forEach(function(c,n){if(map.has(n))map.set(n,c)})})}var transparency=oldTheme.transparency?oldTheme.transparency:defaultTransparency;return{template:template,colors:colors,variables:variables,transparency:transparency}};VisualStyle.prototype.updateThemeDefinition=function(definition){this.updateStyleTheme(this.getThemeInstance(definition))};return VisualStyle}(Transform.Controller);Transform.VisualStyle=VisualStyle;var MoleculeVisual=function(_super){__extends(MoleculeVisual,_super);function MoleculeVisual(){return _super!==null&&_super.apply(this,arguments)||this}return MoleculeVisual}(VisualStyle);Transform.MoleculeVisual=MoleculeVisual;var MoleculeLabels=function(_super){__extends(MoleculeLabels,_super);function MoleculeLabels(){return _super!==null&&_super.apply(this,arguments)||this}return MoleculeLabels}(VisualStyle);Transform.MoleculeLabels=MoleculeLabels;var GenericLabels=function(_super){__extends(GenericLabels,_super);function GenericLabels(){return _super!==null&&_super.apply(this,arguments)||this}return GenericLabels}(VisualStyle);Transform.GenericLabels=GenericLabels;var DensityVisual=function(_super){__extends(DensityVisual,_super);function DensityVisual(){return _super!==null&&_super.apply(this,arguments)||this}DensityVisual.prototype.cloneStyle=function(prop){return Bootstrap.Utils.shallowClone(this.latestState.params[prop||"style"])};DensityVisual.prototype.getStyle=function(prop){return this.latestState.params[prop||"style"]};DensityVisual.prototype.setStyle=function(style,prop){this.autoUpdateParams((_a={},_a[prop||"style"]=style,_a));var _a};DensityVisual.prototype.updateStyleParams=function(params,styleProp){var s=this.cloneStyle(styleProp);s.params=Bootstrap.Utils.merge(s.params,params);this.setStyle(s,styleProp)};DensityVisual.prototype.updateStyleTheme=function(theme,styleProp){var s=this.cloneStyle(styleProp);s.theme=Bootstrap.Utils.merge(s.theme,theme);this.setStyle(s,styleProp)};DensityVisual.prototype.updateThemeColor=function(name,value,styleProp){var oldTheme=this.getStyle(styleProp).theme;if(!oldTheme)return;var colors=oldTheme.colors;if(!colors)colors=Bootstrap.Immutable.Map();colors=colors.set(name,value);this.updateStyleTheme({colors:colors},styleProp)};DensityVisual.prototype.updateThemeTransparency=function(transparency,styleProp){var oldTheme=this.getStyle(styleProp).theme;if(!oldTheme)return;this.updateStyleTheme({transparency:transparency},styleProp)};DensityVisual.prototype.getThemeInstance=function(template,styleProp){var oldTheme=this.getStyle(styleProp).theme;var defaultTransparency=Bootstrap.Visualization.Density.Default.Transparency;if(!oldTheme)return{template:template,colors:template.colors,transparency:defaultTransparency};var colors=template.colors;if(oldTheme.colors&&colors){colors=colors.withMutations(function(map){oldTheme.colors.forEach(function(c,n){if(map.has(n))map.set(n,c)})})}var transparency=oldTheme.transparency?oldTheme.transparency:defaultTransparency;return{template:template,colors:colors,transparency:transparency}};DensityVisual.prototype.updateThemeDefinition=function(definition,styleProp){this.updateStyleTheme(this.getThemeInstance(definition,styleProp),styleProp)};return DensityVisual}(Transform.Controller);Transform.DensityVisual=DensityVisual})(Transform=Components.Transform||(Components.Transform={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Transform;(function(Transform){"use strict";var Updater=function(_super){__extends(Updater,_super);function Updater(ctx,selector,header){var _this=_super.call(this,ctx,{controller:void 0})||this;_this.selector=selector;_this.header=header;Bootstrap.Event.Tree.NodeAdded.getStream(ctx).subscribe(function(){return _this.added()});Bootstrap.Event.Tree.NodeRemoved.getStream(ctx).subscribe(function(e){return _this.removed(e.data)});return _this}Updater.prototype.removed=function(e){if(!this.latestState.controller)return;var l=this.latestState.controller.entity;if(l===e){this.setState({controller:void 0})}};Updater.prototype.added=function(){var sel=this.context.select(this.selector);var e=sel[0];if(!e||!e.transform)return;var c=this.context.transforms.getController(e.transform.transformer,e);if(!c)return;this.setState({controller:c})};return Updater}(Components.Component);Transform.Updater=Updater})(Transform=Components.Transform||(Components.Transform={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Transform;(function(Transform){"use strict";var Action=function(_super){__extends(Action,_super);function Action(ctx,selector,transformer,header){var _this=_super.call(this,ctx,{controller:void 0})||this;_this.selector=selector;_this.transformer=transformer;_this.header=header;Bootstrap.Event.Tree.NodeAdded.getStream(ctx).subscribe(function(){return _this.added()});Bootstrap.Event.Tree.NodeRemoved.getStream(ctx).subscribe(function(e){return _this.removed(e.data)});return _this}Action.prototype.removed=function(e){if(!this.latestState.controller)return;var l=this.latestState.controller.entity;if(l===e){this.setState({controller:void 0})}};Action.prototype.added=function(){var sel=this.context.select(this.selector);var e=sel[0];if(!e)return;var c=this.context.transforms.getController(this.transformer,e);if(!c)return;this.setState({controller:c})};return Action}(Components.Component);Transform.Action=Action})(Transform=Components.Transform||(Components.Transform={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Context;(function(Context){"use strict";var Log=function(_super){__extends(Log,_super);function Log(context){var _this=_super.call(this,context,{entries:Bootstrap.Immutable.List()})||this;Bootstrap.Event.Log.getStream(_this.context).subscribe(function(e){return _this.setState({entries:_this.latestState.entries.push(e.data)})});return _this}return Log}(Components.Component);Context.Log=Log})(Context=Components.Context||(Components.Context={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Context;(function(Context){"use strict";var Toast=function(_super){__extends(Toast,_super);function Toast(context){var _this=_super.call(this,context,{entries:Bootstrap.Immutable.Map()})||this;_this.serialNumber=0;_this.serialId=0;Bootstrap.Command.Toast.Show.getStream(_this.context).subscribe(function(e){return _this.show(e.data)});Bootstrap.Command.Toast.Hide.getStream(_this.context).subscribe(function(e){return _this.hide(_this.findByKey(e.data.key))});return _this}Toast.prototype.findByKey=function(key){return this.latestState.entries.find(function(e){return!!e&&e.key===key})};Toast.prototype.show=function(toast){var _this=this;var entries=this.latestState.entries;var e=void 0;var id=++this.serialId;var serialNumber;if(toast.key&&(e=this.findByKey(toast.key))){if(e.timeout!==void 0)clearTimeout(e.timeout);serialNumber=e.serialNumber;entries=entries.remove(e.id)}else{serialNumber=++this.serialNumber}e={id:id,serialNumber:serialNumber,key:toast.key,title:toast.title,message:toast.message,timeout:this.timeout(id,toast.timeoutMs),hide:function(){return _this.hideId(id)}};entries=entries.set(id,e);this.setState({entries:entries})};Toast.prototype.timeout=function(id,delay){var _this=this;if(delay===void 0)return void 0;if(delay<0)delay=500;return setTimeout(function(){var e=_this.latestState.entries.get(id);e.timeout=void 0;_this.hide(e)},delay)};Toast.prototype.hideId=function(id){this.hide(this.latestState.entries.get(id))};Toast.prototype.hide=function(e){if(!e)return;if(e.timeout!==void 0)clearTimeout(e.timeout);e.hide=void 0;var entries=this.latestState.entries;entries=entries.delete(e.id);this.setState({entries:entries})};return Toast}(Components.Component);Context.Toast=Toast})(Context=Components.Context||(Components.Context={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Context;(function(Context){"use strict";var TaskWatcher=function(_super){__extends(TaskWatcher,_super);function TaskWatcher(context,type){var _this=_super.call(this,context,{tasks:Bootstrap.Immutable.Map()})||this;_this.type=type;Bootstrap.Event.Task.StateUpdated.getStream(_this.context).subscribe(function(e){return _this.updated(e.data)});Bootstrap.Event.Task.Started.getStream(_this.context).filter(function(e){return e.data.type===type}).subscribe(function(e){return _this.started(e.data)});Bootstrap.Event.Task.Completed.getStream(_this.context).subscribe(function(e){return _this.completed(e.data)});return _this}TaskWatcher.prototype.updated=function(state){var isWatched=state.type===this.type;var tasks=this.latestState.tasks;if(!isWatched){if(tasks.has(state.taskId)){tasks=tasks.delete(state.taskId);this.setState({tasks:tasks})}return}tasks=tasks.set(state.taskId,{name:state.name,message:state.message,abort:state.abort});this.setState({tasks:tasks})};TaskWatcher.prototype.started=function(task){this.setState({tasks:this.latestState.tasks.set(task.id,{name:task.name,message:"Running..."})})};TaskWatcher.prototype.completed=function(taskId){if(!this.latestState.tasks.has(taskId))return;this.setState({tasks:this.latestState.tasks.delete(taskId)})};return TaskWatcher}(Components.Component);Context.TaskWatcher=TaskWatcher})(Context=Components.Context||(Components.Context={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Visualization;(function(Visualization){"use strict";var HighlightInfo=function(_super){__extends(HighlightInfo,_super);function HighlightInfo(context){var _this=_super.call(this,context,{info:[]})||this;Bootstrap.Event.Interactivity.Highlight.getStream(_this.context).subscribe(function(e){return _this.setState({info:e.data})});return _this}return HighlightInfo}(Components.Component);Visualization.HighlightInfo=HighlightInfo})(Visualization=Components.Visualization||(Components.Visualization={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Components;(function(Components){var Visualization;(function(Visualization){"use strict";var Vis=LiteMol.Visualization;var Viewport=function(_super){__extends(Viewport,_super);function Viewport(context){var _this=_super.call(this,context,Bootstrap.Utils.shallowClone(Vis.DefaultSceneOptions))||this;Bootstrap.Event.Common.LayoutChanged.getStream(_this.context).subscribe(function(e){if(_this._scene)_this._scene.scene.resized()});Bootstrap.Command.Layout.SetViewportOptions.getStream(_this.context).subscribe(function(e){return _this.setState(e.data)});_this.state.throttle(1e3/30).subscribe(function(s){_this.scene.scene.updateOptions(s)});return _this}Object.defineProperty(Viewport.prototype,"scene",{get:function(){return this._scene},enumerable:true,configurable:true});Viewport.prototype.init=function(element){if(!LiteMol.Visualization.checkWebGL())return false;try{this._scene=new Bootstrap.Visualization.SceneWrapper(element,this.context,this.latestState);this.context.scene=this._scene;return true}catch(e){return false}};Viewport.prototype.destroy=function(){if(this._scene){this._scene.destroy();this._scene=null}};return Viewport}(Components.Component);Visualization.Viewport=Viewport})(Visualization=Components.Visualization||(Components.Visualization={}))})(Components=Bootstrap.Components||(Bootstrap.Components={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";var Settings=function(){function Settings(){this.settings=LiteMol.Core.Utils.FastMap.create()}Settings.prototype.set=function(key,value){this.settings.set(key,value)};Settings.prototype.get=function(key){return this.settings.get(key)};return Settings}();Bootstrap.Settings=Settings;var Context=function(){function Context(plugin){this.plugin=plugin;this.id=Bootstrap.Utils.generateUUID();this.dispatcher=new Bootstrap.Service.Dispatcher;this.logger=new Bootstrap.Service.Logger(this);this.performance=new LiteMol.Core.Utils.PerformanceMonitor;this.scene=void 0;this.tree=Bootstrap.Tree.create(this,Bootstrap.Entity.Root.create(Bootstrap.Entity.RootTransform,{label:"Root Entity"}));this.currentEntity=void 0;this.transforms=new Bootstrap.TransformManager(this);this.entityCache=new Bootstrap.Entity.Cache(this);this.viewport=new Bootstrap.Components.Visualization.Viewport(this);this.highlight=new Bootstrap.Interactivity.HighlightManager(this);this.behaviours=new Bootstrap.Behaviour.Streams(this);this.settings=new Settings;Bootstrap.initEventsAndCommands(this)}Context.prototype.createLayout=function(targets,target){this.layout=new Bootstrap.Components.Layout(this,targets,target)};Context.prototype.select=function(selector){return Bootstrap.Tree.Selection.select(selector,this.tree)};return Context}();Bootstrap.Context=Context})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){var Plugin;(function(Plugin){"use strict"})(Plugin=Bootstrap.Plugin||(Bootstrap.Plugin={}))})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";function createMoleculeModelSelectInteraction(context,what){if(!Bootstrap.Utils.Molecule.findModelOrSelection(what.entity)){console.warn("Select: Trying to create a selection event on a non-molecule related entity, ignoring...");return}var q=Bootstrap.Utils.Molecule.getModelAndIndicesFromQuery(what.entity,what.query);if(!q||!q.indices.length)return;Bootstrap.Event.Visual.VisualSelectElement.dispatch(context,Bootstrap.Interactivity.Info.selection(what.entity,q.indices))}function initEventsAndCommands(context){Bootstrap.Command.Entity.SetCurrent.getStream(context).subscribe(function(e){return Bootstrap.Entity.setCurrent(e.data)});Bootstrap.Command.Entity.SetVisibility.getStream(context).subscribe(function(e){return Bootstrap.Entity.setVisibility(e.data.entity,e.data.visible)});Bootstrap.Command.Entity.ToggleExpanded.getStream(context).subscribe(function(e){return Bootstrap.Entity.toggleExpanded(e.data)});Bootstrap.Command.Tree.RemoveNode.getStream(context).subscribe(function(e){return context.select(e.data).forEach(function(n){return Bootstrap.Tree.remove(n)})});Bootstrap.Command.Tree.ApplyTransform.getStream(context).subscribe(function(e){(e.data.isUpdate?e.data.transform.update(context,e.data.node):e.data.transform.apply(context,e.data.node)).run()});Bootstrap.Event.Tree.NodeAdded.getStream(context).subscribe(function(e){var vis=e.data.parent.state.visibility;var visible=vis!==2;Bootstrap.Entity.setVisibility(e.data,visible);if(Bootstrap.Entity.isClass(e.data,Bootstrap.Entity.BehaviourClass)){var b=e.data;b.props.behaviour.register(b)}});Bootstrap.Event.Tree.NodeRemoved.getStream(context).subscribe(function(e){Bootstrap.Entity.updateVisibilityState(e.data.parent);if(Bootstrap.Entity.isClass(e.data,Bootstrap.Entity.BehaviourClass)){var b=e.data;b.props.behaviour.dispose()}});Bootstrap.Event.Visual.VisualHoverElement.getStream(context).distinctUntilChanged(function(e){return e.data},Bootstrap.Interactivity.interactivityInfoEqual).map(function(e){return Bootstrap.Interactivity.Molecule.transformInteraction(e.data)}).distinctUntilChanged(function(e){return e},function(x,y){return x===y}).subscribe(function(info){return Bootstrap.Event.Molecule.ModelHighlight.dispatch(context,info)});Bootstrap.Event.Visual.VisualSelectElement.getStream(context).distinctUntilChanged(function(e){return e.data},Bootstrap.Interactivity.interactivityInfoEqual).map(function(e){return Bootstrap.Interactivity.Molecule.transformInteraction(e.data)}).distinctUntilChanged(function(e){return e},function(x,y){return x===y}).subscribe(function(info){return Bootstrap.Event.Molecule.ModelSelect.dispatch(context,info)});Bootstrap.Command.Molecule.CreateSelectInteraction.getStream(context).subscribe(function(e){return createMoleculeModelSelectInteraction(context,e.data)})}Bootstrap.initEventsAndCommands=initEventsAndCommands})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Bootstrap;(function(Bootstrap){"use strict";var TransformManager=function(){function TransformManager(context){var _this=this;this.context=context;this.controllerCache=LiteMol.Core.Utils.FastMap.create();this.state=LiteMol.Core.Utils.FastMap.create();this.byId=LiteMol.Core.Utils.FastMap.create();this.bySourceType=LiteMol.Core.Utils.FastMap.create();this.byTargetType=LiteMol.Core.Utils.FastMap.create();Bootstrap.Event.Tree.NodeRemoved.getStream(context).subscribe(function(e){_this.controllerCache.delete(e.data.id);_this.state.delete(e.data.id)})}TransformManager.prototype.addType=function(e,t,to){var xs=to.get(e.id);if(!xs)to.set(e.id,[t]);else xs.push(t)};TransformManager.prototype.getController=function(t,e){if(!e){console.warn("Trying to get controller for undefined entity.");return void 0}if(!this.byId.get(t.info.id)){console.warn("Trying to get controller for unregistered transform ("+t.info.id+").");return void 0}var cs=this.controllerCache.get(e.id);if(!cs){cs=LiteMol.Core.Utils.FastMap.create();this.controllerCache.set(e.id,cs)}var c=cs.get(t.info.id);if(c)return c;var p=t.info.customController;if(p)c=p(this.context,t,e);else c=new Bootstrap.Components.Transform.Controller(this.context,t,e);var info=this.context.plugin&&this.context.plugin.getTransformerInfo(t);if(info&&info.initiallyCollapsed){if(!this.hasPersistentState(t,e,"isExpanded"))this.setPersistentState(t,e,"isExpanded",false)}else{if(!this.hasPersistentState(t,e,"isExpanded"))this.setPersistentState(t,e,"isExpanded",true)}if(e.transform.transformer===t){c.setParams(e.transform.params)}cs.set(t.info.id,c);return c};TransformManager.prototype.getBySourceType=function(t){return this.bySourceType.get(t.id)||[]};TransformManager.prototype.getByTargetType=function(t){return this.byTargetType.get(t.id)||[]};TransformManager.prototype.add=function(t){if(this.byId.has(t.info.id)){throw"Transformer with id '"+t.info.id+"' is has already been added. Pick another id."}this.byId.set(t.info.id,t);for(var _i=0,_a=t.info.from;_i<_a.length;_i++){var x=_a[_i];this.addType(x,t,this.bySourceType)}for(var _b=0,_c=t.info.to;_b<_c.length;_b++){var x=_c[_b];this.addType(x,t,this.byTargetType)}};TransformManager.prototype.hasPersistentState=function(t,e,prop){var se=this.state.get(e.id);if(!se)return false;var ps=se.get(t.info.id);if(!ps||!ps.has(prop))return false;return true};TransformManager.prototype.getPersistentState=function(t,e,prop,defaultValue){var se=this.state.get(e.id);if(!se)return defaultValue;var ps=se.get(t.info.id);if(!ps||!ps.has(prop))return defaultValue;return ps.get(prop)};TransformManager.prototype.setPersistentState=function(t,e,prop,value){var se=this.state.get(e.id);if(!se){se=LiteMol.Core.Utils.FastMap.create();this.state.set(e.id,se)}var ps=se.get(t.info.id);if(!ps){ps=LiteMol.Core.Utils.FastMap.create();se.set(t.info.id,ps)}var old=ps.get(prop);ps.set(prop,value);return old!==value};return TransformManager}();Bootstrap.TransformManager=TransformManager})(Bootstrap=LiteMol.Bootstrap||(LiteMol.Bootstrap={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){Plugin.VERSION={number:"1.3.3",date:"June 18 2017"}})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){"use strict";Plugin.React=__LiteMolReact;Plugin.ReactDOM=__LiteMolReactDOM;var Controls;(function(Controls){})(Controls=Plugin.Controls||(Plugin.Controls={}));Controls.ChromePickerHelper=__LiteMolColorPicker.ChromePicker})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Controls;(function(Controls){"use strict";var shallowEqual=LiteMol.Bootstrap.Utils.shallowEqual;var Pure=function(_super){__extends(Pure,_super);function Pure(){return _super!==null&&_super.apply(this,arguments)||this}Pure.prototype.shouldComponentUpdate=function(nextProps,nextState){return!shallowEqual(this.props,nextProps)||!shallowEqual(this.state,nextState)};return Pure}(Plugin.React.Component);Controls.Pure=Pure;var Button=function(_super){__extends(Button,_super);function Button(){return _super!==null&&_super.apply(this,arguments)||this}Button.prototype.render=function(){var props=this.props;var className="lm-btn";if(props.size&&props.size!=="normal")className+=" lm-btn-"+props.size;if(props.asBlock)className+=" lm-btn-block";if(props.disabled)className+=" lm-btn-"+(props.disabledStyle||props.style||"default");else if(props.active)className+=" lm-btn-"+(props.activeStyle||props.style||"default");else className+=" lm-btn-"+(props.style||"default");if(props.customClass)className+=" "+props.customClass;var icon=void 0;if(props.icon){if(props.active&&props.activeIcon)icon=Plugin.React.createElement("span",{className:"lm-icon lm-icon-"+props.activeIcon});else icon=Plugin.React.createElement("span",{className:"lm-icon lm-icon-"+props.icon})}return Plugin.React.createElement("button",{title:props.title,className:className,style:props.customStyle,disabled:props.disabled,onClick:function(e){props.onClick.call(null,e);e.target.blur()}},icon,props.children)};return Button}(Pure);Controls.Button=Button;Controls.TextBox=function(props){return Plugin.React.createElement("input",{type:"text",className:"lm-form-control",placeholder:props.placeholder,value:props.value,defaultValue:props.defaultValue,onBlur:function(e){if(props.onBlur)props.onBlur.call(null,e)},onChange:function(e){return props.onChange.call(null,e.target.value)},onKeyPress:props.onKeyPress})};function isEnter(e){if(e.keyCode===13||e.charCode===13){return true}return false}Controls.isEnter=isEnter;function TextBoxGroup(props){return Plugin.React.createElement("div",{className:"lm-control-row lm-options-group",title:props.title},Plugin.React.createElement("span",null,props.label),Plugin.React.createElement("div",null,Plugin.React.createElement(Controls.TextBox,{placeholder:props.placeholder,onChange:props.onChange,value:props.value,onKeyPress:function(e){if(isEnter(e)&&props.onEnter)props.onEnter.call(null,e)}})))}Controls.TextBoxGroup=TextBoxGroup;Controls.CommitButton=function(props){return Plugin.React.createElement("div",{style:{marginTop:"1px"}},Plugin.React.createElement("button",{onClick:function(e){props.action();e.target.blur()},className:"lm-btn lm-btn-block lm-btn-commit lm-btn-commit-"+(props.isOn?"on":"off"),disabled:!props.isOn,title:props.title},Plugin.React.createElement("span",{className:"lm-icon lm-icon-"+(props.isOn?"ok":"cross")}),props.isOn?Plugin.React.createElement("b",null,props.on):props.off?props.off:props.on))};Controls.Toggle=function(props){return Plugin.React.createElement("div",{className:"lm-control-row lm-toggle-button",title:props.title},Plugin.React.createElement("span",null,props.label),Plugin.React.createElement("div",null,Plugin.React.createElement("button",{onClick:function(e){props.onChange.call(null,!props.value);e.target.blur()}},Plugin.React.createElement("span",{className:"lm-icon lm-icon-"+(props.value?"ok":"off")})," ",props.value?"On":"Off")))};Controls.ControlGroupExpander=function(props){return Plugin.React.createElement(Controls.Button,{style:"link",title:(props.isExpanded?"Less":"More")+" options",onClick:function(){return props.onChange.call(null,!props.isExpanded)},icon:props.isExpanded?"minus":"plus",customClass:"lm-conrol-group-expander"})};Controls.RowText=function(props){return Plugin.React.createElement("div",{className:"lm-control-row lm-row-text",title:props.title},Plugin.React.createElement("span",null,props.label),Plugin.React.createElement("div",null,props.value))};Controls.HelpBox=function(props){return Plugin.React.createElement("div",{className:"lm-help-row"},Plugin.React.createElement("span",null,props.title),Plugin.React.createElement("div",null,props.content))}})(Controls=Plugin.Controls||(Plugin.Controls={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Controls;(function(Controls){"use strict";var OptionsBox=function(_super){__extends(OptionsBox,_super);function OptionsBox(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.current=void 0;return _this}OptionsBox.prototype.get=function(i){var opts=this.props.options;if(typeof opts.get!=="undefined")return opts.get(i);return opts[i]};OptionsBox.prototype.render=function(){var _this=this;var cap=this.props.caption;var idx=this.props.options.indexOf(this.props.current);if(idx<0)idx=0;return Plugin.React.createElement("select",{title:this.props.title,value:idx.toString(),className:"lm-form-control",onChange:function(e){_this.current=_this.get(+e.target.value);_this.props.onChange(_this.current)}},this.props.options.map(function(o,i){return Plugin.React.createElement("option",{key:i,value:""+i},cap(o))}))};return OptionsBox}(Plugin.React.Component);Controls.OptionsBox=OptionsBox;function OptionsGroup(props){var caption=props.caption?props.caption:function(o){return o};return Plugin.React.createElement("div",{className:"lm-control-row lm-options-group",title:props.title},Plugin.React.createElement("span",null,props.label),Plugin.React.createElement("div",null,Plugin.React.createElement(Controls.OptionsBox,{options:props.options,caption:caption,current:props.current,onChange:props.onChange})))}Controls.OptionsGroup=OptionsGroup})(Controls=Plugin.Controls||(Plugin.Controls={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Controls;(function(Controls){"use strict";var Panel=function(_super){__extends(Panel,_super);function Panel(){return _super!==null&&_super.apply(this,arguments)||this}Panel.prototype.header=function(){var _this=this;var exp=this.props.isExpanded;var title=this.props.title?this.props.title:this.props.header;var icon=exp?"collapse":"expand";var desc=Plugin.React.createElement("div",{className:"lm-panel-description lm-panel-description-"+(this.props.topRightAction?"with-action":"standalone"),onClick:function(){return _this.props.onExpand.call(null,!_this.props.isExpanded)}},Plugin.React.createElement("span",{className:"lm-icon lm-icon-info"}),Plugin.React.createElement("div",{className:"lm-panel-description-content"},Plugin.React.createElement("span",{className:"lm-icon lm-icon-info"}),this.props.description));return Plugin.React.createElement("div",{className:"lm-panel-header"},desc,this.props.topRightAction,Plugin.React.createElement("div",{className:"lm-panel-expander-wrapper"},Plugin.React.createElement(Controls.Button,{title:title,onClick:function(){return _this.props.onExpand.call(null,!_this.props.isExpanded)},icon:icon,customClass:"lm-panel-expander",style:"link"},this.props.badge,this.props.header)))};Panel.prototype.render=function(){var cls="lm-panel"+(this.props.className?" "+this.props.className:"")+(this.props.isExpanded?" lm-panel-expanded":" lm-panel-collapsed");return Plugin.React.createElement("div",{className:cls},this.header(),Plugin.React.createElement("div",{className:"lm-panel-body",style:{display:this.props.isExpanded?"block":"none"}},this.props.children))};return Panel}(Plugin.React.Component);Controls.Panel=Panel;Controls.ExpandableGroup=function(props){return Plugin.React.createElement("div",{className:"lm-control-group"},props.select,props.colorStripe?Plugin.React.createElement("div",{className:"lm-expandable-group-color-stripe",style:{backgroundColor:"rgb("+(255*props.colorStripe.r|0)+", "+(255*props.colorStripe.g|0)+", "+(255*props.colorStripe.b|0)+")"}}):void 0,props.options.length>0?props.expander:void 0,props.options.length>0?Plugin.React.createElement("div",{style:{display:props.isExpanded?"block":"none"},className:"lm-control-subgroup"},props.options):void 0)}})(Controls=Plugin.Controls||(Plugin.Controls={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Controls;(function(Controls){"use strict";var Slider=function(_super){__extends(Slider,_super);function Slider(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={value:"0"};_this.firedValue=NaN;return _this}Slider.prototype.componentWillMount=function(){this.setState({value:""+this.props.value})};Slider.prototype.componentWillReceiveProps=function(nextProps){this.setState({value:""+nextProps.value})};Slider.prototype.updateValue=function(s){var v=+s;if(v<this.props.min){v=this.props.min;s=""+v}else if(v>this.props.max){v=this.props.max;s=""+v}this.setState({value:s})};Slider.prototype.fire=function(){var v=+this.state.value;if(isNaN(v)){v=this.props.value}if(v!==this.props.value){if(this.firedValue!==v){this.firedValue=v;this.props.onChange.call(null,v)}}};Slider.prototype.render=function(){var _this=this;var step=this.props.step;if(step===void 0)step=1;return Plugin.React.createElement("div",{className:"lm-control-row lm-slider",title:this.props.title},Plugin.React.createElement("span",null,this.props.label),Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,Plugin.React.createElement(SliderBase,{min:this.props.min,max:this.props.max,step:step,value:+this.state.value,onChange:function(v){return _this.setState({value:""+v})},onAfterChange:function(v){return _this.fire()}}))),Plugin.React.createElement("div",null,Plugin.React.createElement(Controls.TextBox,{value:this.state.value,onChange:function(v){return _this.updateValue(v)},onBlur:function(){return _this.fire()},onKeyPress:function(e){if(Controls.isEnter(e))_this.fire()}}))))};return Slider}(Plugin.React.Component);Controls.Slider=Slider;function classNames(_classes){var classes=[];var hasOwn={}.hasOwnProperty;for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==="string"||argType==="number"){classes.push(arg)}else if(Array.isArray(arg)){classes.push(classNames.apply(null,arg))}else if(argType==="object"){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key)}}}}return classes.join(" ")}function noop(){}function isNotTouchEvent(e){return e.touches.length>1||e.type.toLowerCase()==="touchend"&&e.touches.length>0}function getTouchPosition(vertical,e){return vertical?e.touches[0].clientY:e.touches[0].pageX}function getMousePosition(vertical,e){return vertical?e.clientY:e.pageX}function getHandleCenterPosition(vertical,handle){var coords=handle.getBoundingClientRect();return vertical?coords.top+coords.height*.5:coords.left+coords.width*.5}function pauseEvent(e){e.stopPropagation();e.preventDefault()}var Handle=function(_super){__extends(Handle,_super);function Handle(){return _super!==null&&_super.apply(this,arguments)||this}Handle.prototype.render=function(){var _a=this.props,className=_a.className,tipFormatter=_a.tipFormatter,vertical=_a.vertical,offset=_a.offset,value=_a.value,index=_a.index;var style=vertical?{bottom:offset+"%"}:{left:offset+"%"};return Plugin.React.createElement("div",{className:className,style:style,title:tipFormatter(value,index)})};return Handle}(Plugin.React.Component);Controls.Handle=Handle;var SliderBase=function(_super){__extends(SliderBase,_super);function SliderBase(props){var _this=_super.call(this,props)||this;_this.sliderElement=void 0;_this.handleElements=[];_this.dragOffset=0;_this.startPosition=0;_this.startValue=0;_this._getPointsCache=void 0;_this.eventHandlers={touchmove:function(e){return _this.onTouchMove(e)},touchend:function(e){return _this.end("touch")},mousemove:function(e){return _this.onMouseMove(e)},mouseup:function(e){return _this.end("mouse")}};var range=props.range,min=props.min,max=props.max;var initialValue=range?Array.apply(null,Array(+range+1)).map(function(){return min}):min;var defaultValue="defaultValue"in props?props.defaultValue:initialValue;var value=props.value!==undefined?props.value:defaultValue;var bounds=(range?value:[min,value]).map(function(v){return _this.trimAlignValue(v)});var recent;if(range&&bounds[0]===bounds[bounds.length-1]&&bounds[0]===max){recent=0}else{recent=bounds.length-1}_this.state={handle:null,recent:recent,bounds:bounds};return _this}SliderBase.prototype.componentWillReceiveProps=function(nextProps){var _this=this;if(!("value"in nextProps||"min"in nextProps||"max"in nextProps))return;var bounds=this.state.bounds;if(nextProps.range){var value=nextProps.value||bounds;var nextBounds=value.map(function(v){return _this.trimAlignValue(v,nextProps)});if(nextBounds.every(function(v,i){return v===bounds[i]}))return;this.setState({bounds:nextBounds});if(bounds.some(function(v){return _this.isValueOutOfBounds(v,nextProps)})){this.props.onChange(nextBounds)}}else{var value=nextProps.value!==undefined?nextProps.value:bounds[1];var nextValue=this.trimAlignValue(value,nextProps);if(nextValue===bounds[1]&&bounds[0]===nextProps.min)return;this.setState({bounds:[nextProps.min,nextValue]});if(this.isValueOutOfBounds(bounds[1],nextProps)){this.props.onChange(nextValue)}}};SliderBase.prototype.onChange=function(state){var props=this.props;var isNotControlled=!("value"in props);if(isNotControlled){this.setState(state)}else if(state.handle!==undefined){this.setState({handle:state.handle})}var data=__assign({},this.state,state);var changedValue=props.range?data.bounds:data.bounds[1];props.onChange(changedValue)};SliderBase.prototype.onMouseDown=function(e){if(e.button!==0){return}var position=getMousePosition(this.props.vertical,e);if(!this.isEventFromHandle(e)){this.dragOffset=0}else{var handlePosition=getHandleCenterPosition(this.props.vertical,e.target);this.dragOffset=position-handlePosition;position=handlePosition}this.onStart(position);this.addDocumentEvents("mouse");pauseEvent(e)};SliderBase.prototype.onMouseMove=function(e){var position=getMousePosition(this.props.vertical,e);this.onMove(e,position-this.dragOffset)};SliderBase.prototype.onMove=function(e,position){pauseEvent(e);var props=this.props;var state=this.state;var diffPosition=position-this.startPosition;diffPosition=this.props.vertical?-diffPosition:diffPosition;var diffValue=diffPosition/this.getSliderLength()*(props.max-props.min);var value=this.trimAlignValue(this.startValue+diffValue);var oldValue=state.bounds[state.handle];if(value===oldValue)return;var nextBounds=state.bounds.slice();nextBounds[state.handle]=value;var nextHandle=state.handle;if(props.pushable!==false){var originalValue=state.bounds[nextHandle];this.pushSurroundingHandles(nextBounds,nextHandle,originalValue)}else if(props.allowCross){nextBounds.sort(function(a,b){return a-b});nextHandle=nextBounds.indexOf(value)}this.onChange({handle:nextHandle,bounds:nextBounds})};SliderBase.prototype.onStart=function(position){var props=this.props;props.onBeforeChange(this.getValue());var value=this.calcValueByPos(position);this.startValue=value;this.startPosition=position;var state=this.state;var bounds=state.bounds;var valueNeedChanging=1;if(this.props.range){var closestBound=0;for(var i=1;i<bounds.length-1;++i){if(value>bounds[i]){closestBound=i}}if(Math.abs(bounds[closestBound+1]-value)<Math.abs(bounds[closestBound]-value)){closestBound=closestBound+1}valueNeedChanging=closestBound;var isAtTheSamePoint=bounds[closestBound+1]===bounds[closestBound];if(isAtTheSamePoint){valueNeedChanging=state.recent}if(isAtTheSamePoint&&value!==bounds[closestBound+1]){valueNeedChanging=value<bounds[closestBound+1]?closestBound:closestBound+1}}this.setState({handle:valueNeedChanging,recent:valueNeedChanging});var oldValue=state.bounds[valueNeedChanging];if(value===oldValue)return;var nextBounds=state.bounds.slice();nextBounds[valueNeedChanging]=value;this.onChange({bounds:nextBounds})};SliderBase.prototype.onTouchMove=function(e){if(isNotTouchEvent(e)){this.end("touch");return}var position=getTouchPosition(this.props.vertical,e);this.onMove(e,position-this.dragOffset)};SliderBase.prototype.onTouchStart=function(e){if(isNotTouchEvent(e))return;var position=getTouchPosition(this.props.vertical,e);if(!this.isEventFromHandle(e)){this.dragOffset=0}else{var handlePosition=getHandleCenterPosition(this.props.vertical,e.target);this.dragOffset=position-handlePosition;position=handlePosition}this.onStart(position);this.addDocumentEvents("touch");pauseEvent(e)};SliderBase.prototype.getPoints=function(){var _a=this.props,marks=_a.marks,step=_a.step,min=_a.min,max=_a.max;var cache=this._getPointsCache;if(!cache||cache.marks!==marks||cache.step!==step){var pointsObject=__assign({},marks);if(step!==null){for(var point=min;point<=max;point+=step){pointsObject[point]=point}}var points=Object.keys(pointsObject).map(parseFloat);points.sort(function(a,b){return a-b});this._getPointsCache={marks:marks,step:step,points:points}}return this._getPointsCache.points};SliderBase.prototype.getPrecision=function(step){var stepString=step.toString();var precision=0;if(stepString.indexOf(".")>=0){precision=stepString.length-stepString.indexOf(".")-1}return precision};SliderBase.prototype.getSliderLength=function(){var slider=this.sliderElement;if(!slider){return 0}return this.props.vertical?slider.clientHeight:slider.clientWidth};SliderBase.prototype.getSliderStart=function(){var slider=this.sliderElement;var rect=slider.getBoundingClientRect();return this.props.vertical?rect.top:rect.left};SliderBase.prototype.getValue=function(){var bounds=this.state.bounds;return this.props.range?bounds:bounds[1]};SliderBase.prototype.addDocumentEvents=function(type){if(type==="touch"){document.addEventListener("touchmove",this.eventHandlers.touchmove);document.addEventListener("touchend",this.eventHandlers.touchend)}else if(type==="mouse"){document.addEventListener("mousemove",this.eventHandlers.mousemove);document.addEventListener("mouseup",this.eventHandlers.mouseup)}};SliderBase.prototype.calcOffset=function(value){var _a=this.props,min=_a.min,max=_a.max;var ratio=(value-min)/(max-min);return ratio*100};SliderBase.prototype.calcValue=function(offset){var _a=this.props,vertical=_a.vertical,min=_a.min,max=_a.max;var ratio=Math.abs(offset/this.getSliderLength());var value=vertical?(1-ratio)*(max-min)+min:ratio*(max-min)+min;return value};SliderBase.prototype.calcValueByPos=function(position){var pixelOffset=position-this.getSliderStart();var nextValue=this.trimAlignValue(this.calcValue(pixelOffset));return nextValue};SliderBase.prototype.end=function(type){this.removeEvents(type);this.props.onAfterChange(this.getValue());this.setState({handle:null})};SliderBase.prototype.isEventFromHandle=function(e){for(var _i=0,_a=this.handleElements;_i<_a.length;_i++){var h=_a[_i];if(h===e.target)return true}return false};SliderBase.prototype.isValueOutOfBounds=function(value,props){return value<props.min||value>props.max};SliderBase.prototype.pushHandle=function(bounds,handle,direction,amount){var originalValue=bounds[handle];var currentValue=bounds[handle];while(direction*(currentValue-originalValue)<amount){if(!this.pushHandleOnePoint(bounds,handle,direction)){bounds[handle]=originalValue;return false}currentValue=bounds[handle]}return true};SliderBase.prototype.pushHandleOnePoint=function(bounds,handle,direction){var points=this.getPoints();var pointIndex=points.indexOf(bounds[handle]);var nextPointIndex=pointIndex+direction;if(nextPointIndex>=points.length||nextPointIndex<0){return false}var nextHandle=handle+direction;var nextValue=points[nextPointIndex];var threshold=this.props.pushable;var diffToNext=direction*(bounds[nextHandle]-nextValue);if(!this.pushHandle(bounds,nextHandle,direction,+threshold-diffToNext)){return false}bounds[handle]=nextValue;return true};SliderBase.prototype.pushSurroundingHandles=function(bounds,handle,originalValue){var threshold=this.props.pushable;var value=bounds[handle];var direction=0;if(bounds[handle+1]-value<threshold){direction=+1}else if(value-bounds[handle-1]<threshold){direction=-1}if(direction===0){return}var nextHandle=handle+direction;var diffToNext=direction*(bounds[nextHandle]-value);if(!this.pushHandle(bounds,nextHandle,direction,+threshold-diffToNext)){bounds[handle]=originalValue}};SliderBase.prototype.removeEvents=function(type){if(type==="touch"){document.removeEventListener("touchmove",this.eventHandlers.touchmove);document.removeEventListener("touchend",this.eventHandlers.touchend)}else if(type==="mouse"){document.removeEventListener("mousemove",this.eventHandlers.mousemove);document.removeEventListener("mouseup",this.eventHandlers.mouseup)}};SliderBase.prototype.trimAlignValue=function(v,nextProps){var _a=this.state||{},handle=_a.handle,bounds=_a.bounds;var _b=__assign({},this.props,nextProps||{}),marks=_b.marks,step=_b.step,min=_b.min,max=_b.max,allowCross=_b.allowCross;var val=v;if(val<=min){val=min}if(val>=max){val=max}if(!allowCross&&handle!=null&&handle>0&&val<=bounds[handle-1]){val=bounds[handle-1]}if(!allowCross&&handle!=null&&handle<bounds.length-1&&val>=bounds[handle+1]){val=bounds[handle+1]}var points=Object.keys(marks).map(parseFloat);if(step!==null){var closestStep=Math.round((val-min)/step)*step+min;points.push(closestStep)}var diffs=points.map(function(point){return Math.abs(val-point)});var closestPoint=points[diffs.indexOf(Math.min.apply(Math,diffs))];return step!==null?parseFloat(closestPoint.toFixed(this.getPrecision(step))):closestPoint};SliderBase.prototype.render=function(){var _this=this;var _a=this.state,handle=_a.handle,bounds=_a.bounds;var _b=this.props,className=_b.className,prefixCls=_b.prefixCls,disabled=_b.disabled,vertical=_b.vertical,dots=_b.dots,included=_b.included,range=_b.range,step=_b.step,marks=_b.marks,max=_b.max,min=_b.min,tipFormatter=_b.tipFormatter,children=_b.children;var customHandle=this.props.handle;var offsets=bounds.map(function(v){return _this.calcOffset(v)});var handleClassName=prefixCls+"-handle";var handlesClassNames=bounds.map(function(v,i){return classNames((_a={},_a[handleClassName]=true,_a[handleClassName+"-"+(i+1)]=true,_a[handleClassName+"-lower"]=i===0,_a[handleClassName+"-upper"]=i===bounds.length-1,_a));var _a});var isNoTip=step===null||tipFormatter===null;var commonHandleProps={prefixCls:prefixCls,noTip:isNoTip,tipFormatter:tipFormatter,vertical:vertical};this.handleElements=[];var handles=bounds.map(function(v,i){return Plugin.React.cloneElement(customHandle,__assign({},commonHandleProps,{className:handlesClassNames[i],value:v,offset:offsets[i],dragging:handle===i,index:i,key:i,ref:function(h){return _this.handleElements.push(h)}}))});if(!range){handles.shift()}var isIncluded=included||range;var tracks=[];var sliderClassName=classNames((_c={},_c[prefixCls]=true,_c[prefixCls+"-with-marks"]=Object.keys(marks).length,_c[prefixCls+"-disabled"]=disabled,_c[prefixCls+"-vertical"]=this.props.vertical,_c[className]=!!className,_c));return Plugin.React.createElement("div",{ref:function(e){return _this.sliderElement=e},className:sliderClassName,onTouchStart:disabled?noop:this.onTouchStart.bind(this),onMouseDown:disabled?noop:this.onMouseDown.bind(this)},Plugin.React.createElement("div",{className:prefixCls+"-rail"}),tracks,Plugin.React.createElement(Steps,{prefixCls:prefixCls,vertical:vertical,marks:marks,dots:dots,step:step,included:isIncluded,lowerBound:bounds[0],upperBound:bounds[bounds.length-1],max:max,min:min}),handles,Plugin.React.createElement(Marks,{className:prefixCls+"-mark",vertical:vertical,marks:marks,included:isIncluded,lowerBound:bounds[0],upperBound:bounds[bounds.length-1],max:max,min:min}),children);var _c};SliderBase.defaultProps={prefixCls:"lm-slider-base",className:"",min:0,max:100,step:1,marks:{},handle:Plugin.React.createElement(Handle,{className:"",vertical:false,offset:0,tipFormatter:function(v){return v},value:0,index:0}),onBeforeChange:noop,onChange:noop,onAfterChange:noop,tipFormatter:function(value,index){return value},included:true,disabled:false,dots:false,range:false,vertical:false,allowCross:true,pushable:false};return SliderBase}(Plugin.React.Component);Controls.SliderBase=SliderBase;var Marks=function(_a){var className=_a.className,vertical=_a.vertical,marks=_a.marks,included=_a.included,upperBound=_a.upperBound,lowerBound=_a.lowerBound,max=_a.max,min=_a.min;var marksKeys=Object.keys(marks);var marksCount=marksKeys.length;var unit=100/(marksCount-1);var markWidth=unit*.9;var range=max-min;var elements=marksKeys.map(parseFloat).sort(function(a,b){return a-b}).map(function(point){var isActived=!included&&point===upperBound||included&&point<=upperBound&&point>=lowerBound;var markClassName=classNames((_a={},_a[className+"-text"]=true,_a[className+"-text-active"]=isActived,_a));var bottomStyle={marginBottom:"-50%",bottom:(point-min)/range*100+"%"};var leftStyle={width:markWidth+"%",marginLeft:-markWidth/2+"%",left:(point-min)/range*100+"%"};var style=vertical?bottomStyle:leftStyle;var markPoint=marks[point];var markPointIsObject=typeof markPoint==="object"&&!Plugin.React.isValidElement(markPoint);var markLabel=markPointIsObject?markPoint.label:markPoint;var markStyle=markPointIsObject?__assign({},style,markPoint.style):style;return Plugin.React.createElement("span",{className:markClassName,style:markStyle,key:point},markLabel);var _a});return Plugin.React.createElement("div",{className:className},elements)};function calcPoints(vertical,marks,dots,step,min,max){var points=Object.keys(marks).map(parseFloat);if(dots){for(var i=min;i<=max;i=i+step){if(points.indexOf(i)>=0)continue;points.push(i)}}return points}var Steps=function(_a){var prefixCls=_a.prefixCls,vertical=_a.vertical,marks=_a.marks,dots=_a.dots,step=_a.step,included=_a.included,lowerBound=_a.lowerBound,upperBound=_a.upperBound,max=_a.max,min=_a.min;var range=max-min;var elements=calcPoints(vertical,marks,dots,step,min,max).map(function(point){var offset=Math.abs(point-min)/range*100+"%";var style=vertical?{bottom:offset}:{left:offset};var isActived=!included&&point===upperBound||included&&point<=upperBound&&point>=lowerBound;var pointClassName=classNames((_a={},_a[prefixCls+"-dot"]=true,_a[prefixCls+"-dot-active"]=isActived,_a));return Plugin.React.createElement("span",{className:pointClassName,style:style,key:point});var _a});return Plugin.React.createElement("div",{className:prefixCls+"-step"},elements)}})(Controls=Plugin.Controls||(Plugin.Controls={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Controls;(function(Controls){"use strict";var shallowEqual=LiteMol.Bootstrap.Utils.shallowEqual;var ColorPicker=function(_super){__extends(ColorPicker,_super);function ColorPicker(){return _super!==null&&_super.apply(this,arguments)||this}ColorPicker.prototype.shouldComponentUpdate=function(nextProps,nextState,nextContext){return!shallowEqual(this.props,nextProps)};ColorPicker.prototype.render=function(){var _this=this;var _a=this.props.color,_b=_a.r,r=_b===void 0?1:_b,_c=_a.g,g=_c===void 0?1:_c,_d=_a.b,b=_d===void 0?1:_d;var color={a:1,r:255*r,g:255*g,b:255*b};var onChange=function(e){return _this.props.onChange({r:e.rgb.r/255,g:e.rgb.g/255,b:e.rgb.b/255})};var picker=Plugin.React.createElement(Controls.ChromePickerHelper,{color:color,onChangeComplete:onChange});return Plugin.React.createElement("div",{className:"lm-color-picker"},picker)};return ColorPicker}(Plugin.React.Component);Controls.ColorPicker=ColorPicker;var ToggleColorPicker=function(_super){__extends(ToggleColorPicker,_super);function ToggleColorPicker(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={isExpanded:false};return _this}ToggleColorPicker.prototype.render=function(){var _this=this;var picker=this.state.isExpanded?Plugin.React.createElement(ColorPicker,__assign({},this.props)):void 0;var clr=this.props.color;var pos=this.props.position?this.props.position:"above";return Plugin.React.createElement("div",{className:"lm-control-row lm-toggle-color-picker lm-toggle-color-picker-"+pos,onMouseLeave:function(){return _this.setState({isExpanded:false})}},Plugin.React.createElement("span",null,this.props.label),Plugin.React.createElement("div",null,Plugin.React.createElement(Controls.Button,{onClick:function(){_this.setState({isExpanded:!_this.state.isExpanded})},asBlock:true,customStyle:{backgroundColor:"rgb("+(255*clr.r|0)+", "+(255*clr.g|0)+", "+(255*clr.b|0)+")",color:"rgb("+(255*(1-clr.r)|0)+","+(255*(1-clr.g)|0)+","+(255*(1-clr.b)|0)+")"}})),picker)};return ToggleColorPicker}(Plugin.React.Component);Controls.ToggleColorPicker=ToggleColorPicker})(Controls=Plugin.Controls||(Plugin.Controls={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Controls;(function(Controls){"use strict";function QueryEditor(props){return Plugin.React.createElement("div",{className:"lm-control-row"},Plugin.React.createElement(Controls.TextBox,{placeholder:"Enter query...",onChange:props.onChange,value:props.value,onKeyPress:function(e){if(Controls.isEnter(e)&&props.onEnter)props.onEnter.call(null,e)}}))}Controls.QueryEditor=QueryEditor})(Controls=Plugin.Controls||(Plugin.Controls={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){"use strict";var shallowEqual=LiteMol.Bootstrap.Utils.shallowEqual;var PureView=function(_super){__extends(PureView,_super);function PureView(){return _super!==null&&_super.apply(this,arguments)||this}PureView.prototype.update=function(s){var ns=LiteMol.Bootstrap.Utils.merge(this.props.state,s);if(ns!==this.props.state)this.props.onChange(ns)};PureView.prototype.shouldComponentUpdate=function(nextProps,nextState){return!shallowEqual(this.props,nextProps)||!shallowEqual(this.state,nextState)};return PureView}(Plugin.React.Component);Views.PureView=PureView;var Component=function(_super){__extends(Component,_super);function Component(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.subs=[];return _this}Component.prototype.subscribe=function(stream,obs){var sub=stream.subscribe(obs);this.subs.push(sub);return sub};Component.prototype.unsubscribe=function(sub){var idx=this.subs.indexOf(sub);for(var i=idx;i<this.subs.length-1;i++){this.subs[i]=this.subs[i+1]}sub.dispose();this.subs.pop()};Component.prototype.componentWillUnmount=function(){for(var _i=0,_a=this.subs;_i<_a.length;_i++){var s=_a[_i];s.dispose()}this.subs=[]};return Component}(Plugin.React.Component);Views.Component=Component;var ObserverView=function(_super){__extends(ObserverView,_super);function ObserverView(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.subs=[];return _this}ObserverView.prototype.subscribe=function(stream,obs){var sub=stream.subscribe(obs);this.subs.push(sub);return sub};ObserverView.prototype.unsubscribe=function(sub){var idx=this.subs.indexOf(sub);for(var i=idx;i<this.subs.length-1;i++){this.subs[i]=this.subs[i+1]}sub.dispose();this.subs.pop()};ObserverView.prototype.componentWillUnmount=function(){for(var _i=0,_a=this.subs;_i<_a.length;_i++){var s=_a[_i];s.dispose()}this.subs=[]};return ObserverView}(Plugin.React.Component);Views.ObserverView=ObserverView;var View=function(_super){__extends(View,_super);function View(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(View.prototype,"controller",{get:function(){return this.props.controller},enumerable:true,configurable:true});View.prototype.componentWillMount=function(){var _this=this;this.subscribe(this.controller.state,function(s){_this.forceUpdate()})};return View}(ObserverView);Views.View=View})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){"use strict";var LayoutRegion=LiteMol.Bootstrap.Components.LayoutRegion;var Layout=function(_super){__extends(Layout,_super);function Layout(){return _super!==null&&_super.apply(this,arguments)||this}Layout.prototype.renderTarget=function(name,target){var statics=[];var scrollable=[];for(var _i=0,_a=target.components;_i<_a.length;_i++){var c=_a[_i];if(c.isStatic)statics.push(Plugin.React.createElement(c.view,{key:c.key,controller:c.controller}));else scrollable.push(Plugin.React.createElement(c.view,{key:c.key,controller:c.controller}))}return Plugin.React.createElement("div",{key:"layout-target-"+name,className:"lm-layout-region lm-layout-"+target.cssClass},statics.length?Plugin.React.createElement("div",{className:"lm-layout-static"},statics):void 0,scrollable.length?Plugin.React.createElement("div",{className:"lm-layout-scrollable"},scrollable):void 0)};Layout.prototype.updateTarget=function(name,regionType,layout){var state=this.controller.latestState;var regionStates=state.regionStates;var region=this.controller.targets[regionType];var show;if(state.hideControls){show=regionStates!==void 0&&regionStates[regionType]==="Sticky"&&region.components.length>0}else if(regionStates&&regionStates[regionType]==="Hidden"){show=false}else{show=region.components.length>0}if(show){layout.regions.push(this.renderTarget(name,region))}else{layout.layoutClass+=" lm-layout-hide-"+name}};Layout.prototype.render=function(){var layoutClass="";var state=this.controller.latestState;var layoutType;if(state.isExpanded){layoutType="lm-layout-expanded"}else{layoutType="lm-layout-standard ";switch(state.collapsedControlsLayout){case LiteMol.Bootstrap.Components.CollapsedControlsLayout.Outside:layoutType+="lm-layout-standard-outside";break;case LiteMol.Bootstrap.Components.CollapsedControlsLayout.Landscape:layoutType+="lm-layout-standard-landscape";break;case LiteMol.Bootstrap.Components.CollapsedControlsLayout.Portrait:layoutType+="lm-layout-standard-portrait";break;default:layoutType+="lm-layout-standard-outside";break}}var targets=this.controller.targets;var regions=[this.renderTarget("main",targets[LayoutRegion.Main])];var layout={regions:regions,layoutClass:layoutClass};this.updateTarget("top",LayoutRegion.Top,layout);this.updateTarget("right",LayoutRegion.Right,layout);this.updateTarget("bottom",LayoutRegion.Bottom,layout);this.updateTarget("left",LayoutRegion.Left,layout);layoutClass=layout.layoutClass;var root=targets[LayoutRegion.Root].components.map(function(c){return Plugin.React.createElement(c.view,{key:c.key,controller:c.controller})});return Plugin.React.createElement("div",{className:"lm-plugin"},Plugin.React.createElement("div",{className:"lm-plugin-content "+layoutType},Plugin.React.createElement("div",{className:layoutClass},regions,root)))};return Layout}(Views.View);Views.Layout=Layout})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Transform;(function(Transform){"use strict";var ControllerBase=function(_super){__extends(ControllerBase,_super);function ControllerBase(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(ControllerBase.prototype,"params",{get:function(){return this.controller.latestState.params},enumerable:true,configurable:true});ControllerBase.prototype.updateParams=function(p){this.controller.updateParams(p)};ControllerBase.prototype.autoUpdateParams=function(p){this.controller.autoUpdateParams(p)};ControllerBase.prototype.getPersistentState=function(prop,defaultValue){return this.controller.context.transforms.getPersistentState(this.controller.transformer,this.transformSourceEntity,prop,defaultValue)};ControllerBase.prototype.setPersistentState=function(prop,value){if(this.controller.context.transforms.setPersistentState(this.controller.transformer,this.transformSourceEntity,prop,value)){this.forceUpdate()}};Object.defineProperty(ControllerBase.prototype,"transformSourceEntity",{get:function(){return this.isUpdate?this.controller.entity.parent:this.controller.entity},enumerable:true,configurable:true});Object.defineProperty(ControllerBase.prototype,"isUpdate",{get:function(){return this.controller.isUpdate},enumerable:true,configurable:true});Object.defineProperty(ControllerBase.prototype,"canApply",{get:function(){var state=this.controller.latestState;var base=state.canApply&&(!this.isUpdate||state.isDirty)&&!state.isBusy;if(base&&this.isUpdate&&state.parametersAutoUpdating)return false;return base},enumerable:true,configurable:true});ControllerBase.prototype.applyEnter=function(e){if(!this.canApply)return;e.target.blur();this.controller.apply()};ControllerBase.prototype.render=function(){var _this=this;var isUpdate=this.isUpdate;var state=this.controller.latestState;var issues=state.issues;var hasError=issues&&issues.length;var isBusy=state.isBusy;var offMsg=isBusy?"Working...":isUpdate&&!hasError?"Nothing to update":issues?issues[0]:void 0;var t=this.controller.transformer.info;var commit=Plugin.React.createElement(Plugin.Controls.CommitButton,{action:function(){return _this.controller.apply()},isOn:this.canApply,title:issues&&issues.length?issues[0]:this.canApply?isUpdate?"An update will remove all child nodes.":void 0:void 0,on:isUpdate?"Update":this.props.isAction?"Apply":"Add",off:offMsg});var showCommit=this.canApply||hasError;var header=this.props.customHeader?this.props.customHeader:(isUpdate?"Update ":"")+t.name;var isExpanded=this.getPersistentState("isExpanded",true);return Plugin.React.createElement("div",{className:"lm-transformer-wrapper"},Plugin.React.createElement(Plugin.Controls.Panel,{header:header,badge:this.props.hideBadge?void 0:Plugin.React.createElement(Views.Entity.Badge,{type:t.to[0].info}),className:"lm-control lm-transformer lm-panel-"+t.to[0].info.typeClass,key:t.id,title:t.description,isExpanded:isExpanded,onExpand:function(e){_this.setPersistentState("isExpanded",e)},description:this.controller.transformer.info.description,topRightAction:this.props.showVisibilityIcon?Plugin.React.createElement(Views.Entity.VisibilityControl,{entity:this.controller.entity}):void 0},this.renderControls(),showCommit?commit:void 0))};return ControllerBase}(Views.View);Transform.ControllerBase=ControllerBase;var Empty=function(_super){__extends(Empty,_super);function Empty(){return _super!==null&&_super.apply(this,arguments)||this}Empty.prototype.renderControls=function(){return Plugin.React.createElement("div",null)};return Empty}(Transform.ControllerBase);Transform.Empty=Empty;var View=function(_super){__extends(View,_super);function View(){return _super!==null&&_super.apply(this,arguments)||this}View.prototype.render=function(){var ctx=this.controller.context;var plugin=ctx.plugin;var state=this.controller.latestState;var transforms=state.transforms;var views=transforms.map(function(t){var v=plugin.getTransformerInfo(t.transformer).view;return Plugin.React.createElement(v,{controller:t,key:t.transformer.info.id+"-"+t.entity.id})});if(state.update){var v=plugin.getTransformerInfo(state.update.transformer).view;views.push(Plugin.React.createElement(v,{controller:state.update,key:state.update.transformer.info.id+"-"+state.update.entity.id}))}return Plugin.React.createElement("div",{className:"lm-transform-view"},views)};return View}(Views.View);Transform.View=View;Transform.TransparencyControl=function(props){var d=props.definition.alpha;return Plugin.React.createElement(Plugin.Controls.Slider,{label:"Opacity",onChange:function(v){return props.onChange({alpha:v,writeDepth:props.definition.writeDepth})},min:0,max:1,step:.01,value:d})};var Updater=function(_super){__extends(Updater,_super);function Updater(){return _super!==null&&_super.apply(this,arguments)||this}Updater.prototype.componentWillMount=function(){var _this=this;_super.prototype.componentWillMount.call(this);this.subscribe(LiteMol.Bootstrap.Event.Tree.NodeUpdated.getStream(this.controller.context),function(s){var c=_this.controller.latestState.controller;var e=c&&c.entity;if(s.data===e)_this.forceUpdate()})};Updater.prototype.render=function(){var c=this.controller.latestState.controller;if(!c)return Plugin.React.createElement("div",{className:"lm-empty-control"});var ctx=this.controller.context;var plugin=ctx.plugin;var v=plugin.getTransformerInfo(c.transformer).view;if(!v){console.warn("Count not find view for updater ("+c.transformer.info.id+"), please register it.");return Plugin.React.createElement("div",{className:"lm-empty-control"})}return Plugin.React.createElement(v,{controller:c,key:c.transformer.info.id+"-"+c.entity.id,customHeader:this.controller.header,hideBadge:true,showVisibilityIcon:true})};return Updater}(Views.View);Transform.Updater=Updater;var Action=function(_super){__extends(Action,_super);function Action(){return _super!==null&&_super.apply(this,arguments)||this}Action.prototype.render=function(){var c=this.controller.latestState.controller;if(!c)return Plugin.React.createElement("div",{className:"lm-empty-control"});var ctx=this.controller.context;var plugin=ctx.plugin;var v=plugin.getTransformerInfo(c.transformer).view;if(!v){console.warn("Count not find view for updater ("+c.transformer.info.id+"), please register it.");return Plugin.React.createElement("div",{className:"lm-empty-control"})}return Plugin.React.createElement(v,{controller:c,key:c.transformer.info.id+"-"+c.entity.id,customHeader:this.controller.header,hideBadge:true,isAction:true})};return Action}(Views.View);Transform.Action=Action})(Transform=Views.Transform||(Views.Transform={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Transform;(function(Transform){var Data;(function(Data){"use strict";var Download=function(_super){__extends(Download,_super);function Download(){return _super!==null&&_super.apply(this,arguments)||this}Download.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Bootstrap.Entity.Data.Types,caption:function(s){return s},current:params.type,onChange:function(o){return _this.updateParams({type:o,responseCompression:LiteMol.Bootstrap.Utils.DataCompressionMethod.None})},label:"Type"}),params.type==="Binary"?Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:["None","Gzip"],caption:function(s){return s},current:params.responseCompression===LiteMol.Bootstrap.Utils.DataCompressionMethod.Gzip?"Gzip":"None",onChange:function(o){return _this.updateParams({responseCompression:o==="None"?LiteMol.Bootstrap.Utils.DataCompressionMethod.None:LiteMol.Bootstrap.Utils.DataCompressionMethod.Gzip})},label:"Compression",title:'Specify the compression of the data. Usually only appliable if you downloading "raw" files.'}):void 0,Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.url,onChange:function(v){return _this.updateParams({url:v})},label:"URL",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Enter URL..."}))};return Download}(Transform.ControllerBase);Data.Download=Download;var OpenFile=function(_super){__extends(OpenFile,_super);function OpenFile(){return _super!==null&&_super.apply(this,arguments)||this}OpenFile.prototype.renderControls=function(){var _this=this;var params=this.params;var state=this.controller.latestState;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Bootstrap.Entity.Data.Types,caption:function(s){return s},current:params.type,onChange:function(o){return _this.updateParams({type:o})},label:"Type"}),Plugin.React.createElement("div",{className:"lm-btn lm-btn-block lm-btn-action lm-loader-lm-btn-file",style:{marginTop:"1px"}},params.file?params.file.name:"Select a file..."," ",Plugin.React.createElement("input",{disabled:state.isBusy,type:"file",onChange:function(evt){return _this.updateParams({file:evt.target.files[0]})},multiple:false})))};return OpenFile}(Transform.ControllerBase);Data.OpenFile=OpenFile;var WithIdField=function(_super){__extends(WithIdField,_super);function WithIdField(){return _super!==null&&_super.apply(this,arguments)||this}WithIdField.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.id,onChange:function(v){return _this.updateParams({id:v})},label:"Id",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Enter PDB id..."}))};return WithIdField}(Transform.ControllerBase);Data.WithIdField=WithIdField;var WithUrlIdField=function(_super){__extends(WithUrlIdField,_super);function WithUrlIdField(){return _super!==null&&_super.apply(this,arguments)||this}WithUrlIdField.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.id,onChange:function(v){return _this.updateParams({id:v})},label:"URL",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Enter URL..."}))};return WithUrlIdField}(Transform.ControllerBase);Data.WithUrlIdField=WithUrlIdField})(Data=Transform.Data||(Transform.Data={}))})(Transform=Views.Transform||(Views.Transform={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Transform;(function(Transform){var Molecule;(function(Molecule){"use strict";var CreateFromData=function(_super){__extends(CreateFromData,_super);function CreateFromData(){return _super!==null&&_super.apply(this,arguments)||this}CreateFromData.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Core.Formats.Molecule.SupportedFormats.All,caption:function(s){return s.name},current:params.format,onChange:function(o){return _this.updateParams({format:o})},label:"Format"}))};return CreateFromData}(Transform.ControllerBase);Molecule.CreateFromData=CreateFromData;var DownloadFromUrl=function(_super){__extends(DownloadFromUrl,_super);function DownloadFromUrl(){return _super!==null&&_super.apply(this,arguments)||this}DownloadFromUrl.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Core.Formats.Molecule.SupportedFormats.All,caption:function(s){return s.name},current:params.format,onChange:function(o){return _this.updateParams({format:o})},label:"Format"}),Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.id,onChange:function(v){return _this.updateParams({id:v})},label:"URL",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Enter url..."}))};return DownloadFromUrl}(Transform.ControllerBase);Molecule.DownloadFromUrl=DownloadFromUrl;var OpenFile=function(_super){__extends(OpenFile,_super);function OpenFile(){return _super!==null&&_super.apply(this,arguments)||this}OpenFile.prototype.renderControls=function(){var _this=this;var params=this.params;var state=this.controller.latestState;var extensions=LiteMol.Core.Formats.FormatInfo.formatFileFilters(LiteMol.Core.Formats.Molecule.SupportedFormats.All);return Plugin.React.createElement("div",null,Plugin.React.createElement("div",{className:"lm-btn lm-btn-block lm-btn-action lm-loader-lm-btn-file",style:{marginTop:"1px"}},params.file?params.file.name:"Select a file..."," ",Plugin.React.createElement("input",{disabled:state.isBusy,type:"file",accept:extensions,onChange:function(evt){return _this.updateParams({file:evt.target.files[0]})},multiple:false})))};return OpenFile}(Transform.ControllerBase);Molecule.OpenFile=OpenFile;var InitCoordinateStreaming=function(_super){__extends(InitCoordinateStreaming,_super);function InitCoordinateStreaming(){return _super!==null&&_super.apply(this,arguments)||this}InitCoordinateStreaming.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.id,onChange:function(v){return _this.updateParams({id:v})},label:"Id",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Enter pdb id..."}),Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.server,onChange:function(v){return _this.updateParams({server:v})},label:"Server",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Server url..."}))};return InitCoordinateStreaming}(Transform.ControllerBase);Molecule.InitCoordinateStreaming=InitCoordinateStreaming;var CreateFromMmCif=function(_super){__extends(CreateFromMmCif,_super);function CreateFromMmCif(){return _super!==null&&_super.apply(this,arguments)||this}CreateFromMmCif.prototype.renderControls=function(){var _this=this;var cif=this.transformSourceEntity;var options=cif.props.dictionary.dataBlocks.map(function(b,i){return{b:b.header,i:i}});return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:options,caption:function(s){return s.b},current:options[this.params.blockIndex],onChange:function(o){return _this.updateParams({blockIndex:o.i})},label:"Source"}))};return CreateFromMmCif}(Transform.ControllerBase);Molecule.CreateFromMmCif=CreateFromMmCif;var CreateModel=function(_super){__extends(CreateModel,_super);function CreateModel(){return _super!==null&&_super.apply(this,arguments)||this}CreateModel.prototype.renderControls=function(){var _this=this;var modelCount=this.transformSourceEntity.props.molecule.models.length;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.Slider,{label:"Index",onChange:function(v){return _this.updateParams({modelIndex:v-1})},min:1,max:modelCount,step:1,value:(this.params.modelIndex|0)+1,title:"Index of the model."}))};return CreateModel}(Transform.ControllerBase);Molecule.CreateModel=CreateModel;var CreateAssembly=function(_super){__extends(CreateAssembly,_super);function CreateAssembly(){return _super!==null&&_super.apply(this,arguments)||this}CreateAssembly.prototype.renderControls=function(){var _this=this;var params=this.params;var model=LiteMol.Bootstrap.Utils.Molecule.findModel(this.transformSourceEntity);var asm=model.props.model.data.assemblyInfo;if(!asm)return void 0;var names=asm.assemblies.map(function(a){return a.name});return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:names,current:params.name,onChange:function(o){return _this.updateParams({name:o})},label:"Name"}))};return CreateAssembly}(Transform.ControllerBase);Molecule.CreateAssembly=CreateAssembly;var CreateSymmetryMates=function(_super){__extends(CreateSymmetryMates,_super);function CreateSymmetryMates(){return _super!==null&&_super.apply(this,arguments)||this}CreateSymmetryMates.prototype.renderControls=function(){var _this=this;var params=this.params;var options=["Mates","Interaction"];return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:options,current:params.type,onChange:function(o){return _this.updateParams({type:o})},label:"Type",title:"Mates: copies whole asymetric unit. Interaction: Includes only residues that are no more than `radius` from the asymetric unit."}),Plugin.React.createElement(Plugin.Controls.Slider,{label:"Radius",onChange:function(v){return _this.updateParams({radius:v})},min:0,max:25,step:.1,value:params.radius,title:"Interaction radius."}))};return CreateSymmetryMates}(Transform.ControllerBase);Molecule.CreateSymmetryMates=CreateSymmetryMates;var CreateSelection=function(_super){__extends(CreateSelection,_super);function CreateSelection(){return _super!==null&&_super.apply(this,arguments)||this}CreateSelection.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.TextBoxGroup,{value:params.name,onChange:function(v){return _this.updateParams({name:v})},label:"Name",onEnter:function(e){return _this.applyEnter(e)},placeholder:"Optional name..."}),Plugin.React.createElement(Plugin.Controls.QueryEditor,{value:params.queryString,onChange:function(v){return _this.updateParams({queryString:v})},onEnter:function(e){return _this.applyEnter(e)}}))};return CreateSelection}(Transform.ControllerBase);Molecule.CreateSelection=CreateSelection;var CreateMacromoleculeVisual=function(_super){__extends(CreateMacromoleculeVisual,_super);function CreateMacromoleculeVisual(){return _super!==null&&_super.apply(this,arguments)||this}CreateMacromoleculeVisual.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return _this.updateParams({polymer:v})},value:params.polymer,label:"Polymer"}),Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return _this.updateParams({het:v})},value:params.het,label:"HET"}),Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return _this.updateParams({water:v})},value:params.water,label:"Water"}))};return CreateMacromoleculeVisual}(Transform.ControllerBase);Molecule.CreateMacromoleculeVisual=CreateMacromoleculeVisual;var CreateVisual=function(_super){__extends(CreateVisual,_super);function CreateVisual(){return _super!==null&&_super.apply(this,arguments)||this}CreateVisual.prototype.detail=function(){var _this=this;var p=this.params.style.params;return[Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Bootstrap.Visualization.Molecule.DetailTypes,caption:function(s){return s},current:p.detail,onChange:function(o){return _this.controller.updateStyleParams({detail:o})},label:"Detail"})]};CreateVisual.prototype.ballsAndSticks=function(){var _this=this;var p=this.params.style.params;var controls=[];var key=0;controls.push(Plugin.React.createElement(Plugin.Controls.Toggle,{title:"Scale atoms using their VDW radius.",onChange:function(v){return _this.controller.updateStyleParams({useVDW:v})},value:p.useVDW,label:"VDW"}));if(p.useVDW){controls.push(Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"Scale",onChange:function(v){return _this.controller.updateStyleParams({vdwScaling:v})},min:.1,max:1,step:.01,value:p.vdwScaling,title:"VDW scale factor."}))}else{controls.push(Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"Atom Rds",onChange:function(v){return _this.controller.updateStyleParams({atomRadius:v})},min:.05,max:2,step:.01,value:p.atomRadius,title:"Atom Radius"}))}controls.push(Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"Bond Rds",onChange:function(v){return _this.controller.updateStyleParams({bondRadius:v})},min:.05,max:1,step:.01,value:p.bondRadius,title:"Bond Radius"}));var maxHbondLength=p.customMaxBondLengths&&p.customMaxBondLengths["H"]?p.customMaxBondLengths["H"]:1.15;controls.push(Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"H Bond Len",onChange:function(v){return _this.controller.updateStyleParams({customMaxBondLengths:__assign({},p.customMaxBondLengths,{H:v})})},min:.9,max:1.5,step:.01,value:maxHbondLength,title:"Maximum H bond length"}));controls.push(Plugin.React.createElement(Plugin.Controls.Toggle,{key:key++,onChange:function(v){return _this.controller.updateStyleParams({hideHydrogens:v})},value:p.hideHydrogens,label:"Hide H"}));controls.push(Plugin.React.createElement(Plugin.Controls.OptionsGroup,{key:key++,options:LiteMol.Bootstrap.Visualization.Molecule.DetailTypes,caption:function(s){return s},current:p.detail,onChange:function(o){return _this.controller.updateStyleParams({detail:o})},label:"Detail"}));return controls};CreateVisual.prototype.surface=function(){var _this=this;var params=this.params.style.params;var key=0;return[Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"Probe Radius",onChange:function(v){return _this.controller.updateStyleParams({probeRadius:v})},min:0,max:6,step:.1,value:params.probeRadius}),Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"Smoothing",onChange:function(v){return _this.controller.updateStyleParams({smoothing:v})},min:0,max:20,step:1,value:params.smoothing,title:"Number of laplacian smoothing itrations."}),Plugin.React.createElement(Plugin.Controls.Toggle,{key:key++,onChange:function(v){return _this.controller.updateStyleParams({automaticDensity:v})},value:params.automaticDensity,label:"Auto Detail"}),params.automaticDensity?void 0:Plugin.React.createElement(Plugin.Controls.Slider,{key:key++,label:"Detail",onChange:function(v){return _this.controller.updateStyleParams({density:v})},min:.1,max:3,step:.1,value:params.density,title:"Determines the size of a grid cell (size = 1/detail)."}),Plugin.React.createElement(Plugin.Controls.Toggle,{key:key++,onChange:function(v){return _this.controller.updateStyleParams({isWireframe:v})},value:params.isWireframe,label:"Wireframe"})]};CreateVisual.prototype.createColors=function(){var _this=this;var theme=this.params.style.theme;var isBallsAndSticks=this.params.style.type==="BallsAndSticks";var controls=theme.colors.filter(function(c,n){return!isBallsAndSticks?n!=="Bond":true}).map(function(c,n){return Plugin.React.createElement(Plugin.Controls.ToggleColorPicker,{key:n,label:n,color:c,onChange:function(c){return _this.controller.updateThemeColor(n,c)}})}).toArray();controls.push(Plugin.React.createElement(Transform.TransparencyControl,{definition:theme.transparency,onChange:function(d){return _this.controller.updateThemeTransparency(d)}}));return controls};CreateVisual.prototype.renderControls=function(){var _this=this;var params=this.params;var controls;switch(params.style.type){case"Surface":controls=this.surface();break;case"BallsAndSticks":controls=this.ballsAndSticks();break;default:controls=this.detail();break}var desc=function(key){return LiteMol.Bootstrap.Visualization.Molecule.TypeDescriptions[key]};var showTypeOptions=this.getPersistentState("showTypeOptions",false);var showThemeOptions=this.getPersistentState("showThemeOptions",false);return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.ExpandableGroup,{select:Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Bootstrap.Visualization.Molecule.Types,caption:function(k){return desc(k).label},current:params.style.type,onChange:function(o){return _this.controller.updateTemplate(o,LiteMol.Bootstrap.Visualization.Molecule.Default.ForType)},label:"Type"}),expander:Plugin.React.createElement(Plugin.Controls.ControlGroupExpander,{isExpanded:showTypeOptions,onChange:function(e){return _this.setPersistentState("showTypeOptions",e)}}),options:controls,isExpanded:showTypeOptions}),Plugin.React.createElement(Plugin.Controls.ExpandableGroup,{select:Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Bootstrap.Visualization.Molecule.Default.Themes,caption:function(k){return k.name},current:params.style.theme.template,onChange:function(o){return _this.controller.updateThemeDefinition(o)},label:"Coloring"}),expander:Plugin.React.createElement(Plugin.Controls.ControlGroupExpander,{isExpanded:showThemeOptions,onChange:function(e){return _this.setPersistentState("showThemeOptions",e)}}),options:this.createColors(),isExpanded:showThemeOptions}))};return CreateVisual}(Transform.ControllerBase);Molecule.CreateVisual=CreateVisual;var CreateLabels=function(_super){__extends(CreateLabels,_super);function CreateLabels(){return _super!==null&&_super.apply(this,arguments)||this}CreateLabels.prototype.renderControls=function(){var _this=this;var style=this.controller.latestState.params.style;var select=Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Bootstrap.Utils.Molecule.Labels3DKinds,caption:function(k){return LiteMol.Bootstrap.Utils.Molecule.Labels3DKindLabels[k]},current:style.params.kind,onChange:function(o){return _this.controller.updateStyleParams({kind:o})},label:"Kind"});var showOptions=this.getPersistentState("showOptions",false);return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.ExpandableGroup,{select:select,expander:Plugin.React.createElement(Plugin.Controls.ControlGroupExpander,{isExpanded:showOptions,onChange:function(e){return _this.setPersistentState("showOptions",e)}}),options:Transform.Labels.optionsControls(this.controller),isExpanded:showOptions}))};return CreateLabels}(Transform.ControllerBase);Molecule.CreateLabels=CreateLabels})(Molecule=Transform.Molecule||(Transform.Molecule={}))})(Transform=Views.Transform||(Views.Transform={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Transform;(function(Transform){var Density;(function(Density){"use strict";var IsoValue=function(props){return Plugin.React.createElement(Plugin.Controls.ExpandableGroup,{select:Plugin.React.createElement(Plugin.Controls.Slider,{label:props.isSigma?"Iso Value (σ)":"Iso Value",onChange:props.onChangeValue,min:props.min,max:props.max,value:props.value,step:.001}),expander:Plugin.React.createElement(Plugin.Controls.ControlGroupExpander,{isExpanded:props.view.getPersistentState("showIsoValueType",false),onChange:function(e){return props.view.setPersistentState("showIsoValueType",e)}}),options:[Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return props.onChangeType(v?LiteMol.Bootstrap.Visualization.Density.IsoValueType.Sigma:LiteMol.Bootstrap.Visualization.Density.IsoValueType.Absolute)},value:props.isSigma,label:"Relative (σ)"})],isExpanded:props.view.getPersistentState("showIsoValueType",false)})};function isoValueAbsoluteToSigma(data,value,min,max){var ret=(value-data.valuesInfo.mean)/data.valuesInfo.sigma;if(ret>max)return max;if(ret<min)return min;return ret}function isoValueSigmaToAbsolute(data,value){var ret=data.valuesInfo.mean+value*data.valuesInfo.sigma;if(ret>data.valuesInfo.max)return data.valuesInfo.max;if(ret<data.valuesInfo.min)return data.valuesInfo.min;return ret}var ParseData=function(_super){__extends(ParseData,_super);function ParseData(){return _super!==null&&_super.apply(this,arguments)||this}ParseData.prototype.renderControls=function(){var _this=this;var params=this.params;var round=LiteMol.Bootstrap.Utils.round;if(this.isUpdate){var data=this.controller.entity.props.data;return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.RowText,{label:"Format",value:params.format.name}),Plugin.React.createElement(Plugin.Controls.RowText,{label:"Sigma",value:round(data.valuesInfo.sigma,3)}),Plugin.React.createElement(Plugin.Controls.RowText,{label:"Mean",value:round(data.valuesInfo.mean,3)}),Plugin.React.createElement(Plugin.Controls.RowText,{label:"Value Range",value:"["+round(data.valuesInfo.min,3)+", "+round(data.valuesInfo.max,3)+"]"}))}return Plugin.React.createElement("div",null,Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:LiteMol.Core.Formats.Density.SupportedFormats.All,caption:function(s){return s.name},current:params.format,onChange:function(o){return _this.updateParams({format:o})},label:"Format"}))};return ParseData}(Transform.ControllerBase);Density.ParseData=ParseData;var CreateVisual=function(_super){__extends(CreateVisual,_super);function CreateVisual(){return _super!==null&&_super.apply(this,arguments)||this}CreateVisual.prototype.surface=function(){var _this=this;var data=LiteMol.Bootstrap.Tree.Node.findClosestNodeOfType(this.transformSourceEntity,[LiteMol.Bootstrap.Entity.Density.Data]);var params=this.params.style.params;var isSigma=params.isoValueType!==LiteMol.Bootstrap.Visualization.Density.IsoValueType.Absolute;var values=data.props.data.valuesInfo;var min=isSigma?(values.min-values.mean)/values.sigma:values.min;var max=isSigma?(values.max-values.mean)/values.sigma:values.max;return Plugin.React.createElement(IsoValue,{view:this,onChangeValue:function(v){return _this.controller.updateStyleParams({isoValue:v})},onChangeType:function(v){if(v===params.isoValueType)return;if(v===LiteMol.Bootstrap.Visualization.Density.IsoValueType.Absolute){_this.controller.updateStyleParams({isoValue:isoValueSigmaToAbsolute(data.props.data,params.isoValue),isoValueType:v})}else{_this.controller.updateStyleParams({isoValue:isoValueAbsoluteToSigma(data.props.data,params.isoValue,-5,5),isoValueType:v})}},min:min,max:max,isSigma:isSigma,value:params.isoValue})};CreateVisual.prototype.colors=function(){var _this=this;var params=this.params.style.params;var theme=this.params.style.theme;var uc=theme.colors.get("Uniform");var uniform=Plugin.React.createElement(Plugin.Controls.ToggleColorPicker,{key:"Uniform",label:"Color",color:uc,onChange:function(c){return _this.controller.updateThemeColor("Uniform",c)}});var controls=[];controls.push(Plugin.React.createElement(Transform.TransparencyControl,{definition:theme.transparency,onChange:function(d){return _this.controller.updateThemeTransparency(d)}}));controls.push(Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return _this.controller.updateStyleParams({isWireframe:v})},value:params.isWireframe,label:"Wireframe"}));var showThemeOptions=this.getPersistentState("showThemeOptions",false);return Plugin.React.createElement(Plugin.Controls.ExpandableGroup,{select:uniform,expander:Plugin.React.createElement(Plugin.Controls.ControlGroupExpander,{isExpanded:showThemeOptions,onChange:function(e){return _this.setPersistentState("showThemeOptions",e)}}),options:controls,isExpanded:showThemeOptions})};CreateVisual.prototype.renderControls=function(){return Plugin.React.createElement("div",null,this.surface(),this.colors())};return CreateVisual}(Transform.ControllerBase);Density.CreateVisual=CreateVisual;var CreateVisualBehaviour=function(_super){__extends(CreateVisualBehaviour,_super);function CreateVisualBehaviour(){return _super!==null&&_super.apply(this,arguments)||this}CreateVisualBehaviour.prototype.surface=function(){var _this=this;var data=LiteMol.Bootstrap.Tree.Node.findClosestNodeOfType(this.transformSourceEntity,[LiteMol.Bootstrap.Entity.Density.Data]);var params=this.params;var visualParams=params.style.params;var isSigma=visualParams.isoValueType!==LiteMol.Bootstrap.Visualization.Density.IsoValueType.Absolute;return Plugin.React.createElement(IsoValue,{view:this,onChangeValue:function(v){return _this.controller.updateStyleParams({isoValue:v})},onChangeType:function(v){if(v===visualParams.isoValueType)return;if(v===LiteMol.Bootstrap.Visualization.Density.IsoValueType.Absolute){_this.controller.updateStyleParams({isoValue:isoValueSigmaToAbsolute(data.props.data,visualParams.isoValue),isoValueType:v})}else{_this.controller.updateStyleParams({isoValue:isoValueAbsoluteToSigma(data.props.data,visualParams.isoValue,params.isoSigmaMin,params.isoSigmaMax),isoValueType:v})}},min:isSigma?params.isoSigmaMin:data.props.data.valuesInfo.min,max:isSigma?params.isoSigmaMax:data.props.data.valuesInfo.max,isSigma:isSigma,value:visualParams.isoValue})};CreateVisualBehaviour.prototype.colors=function(){var _this=this;var params=this.params.style.params;var theme=this.params.style.theme;var uc=theme.colors.get("Uniform");var uniform=Plugin.React.createElement(Plugin.Controls.ToggleColorPicker,{key:"Uniform",label:"Color",color:uc,onChange:function(c){return _this.controller.updateThemeColor("Uniform",c)}});var controls=[];controls.push(Plugin.React.createElement(Transform.TransparencyControl,{definition:theme.transparency,onChange:function(d){return _this.controller.updateThemeTransparency(d)}}));controls.push(Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return _this.controller.updateStyleParams({isWireframe:v})},value:params.isWireframe,label:"Wireframe"}));var showThemeOptions=this.getPersistentState("showThemeOptions",false);return Plugin.React.createElement(Plugin.Controls.ExpandableGroup,{select:uniform,expander:Plugin.React.createElement(Plugin.Controls.ControlGroupExpander,{isExpanded:showThemeOptions,onChange:function(e){return _this.setPersistentState("showThemeOptions",e)}}),options:controls,isExpanded:showThemeOptions})};CreateVisualBehaviour.prototype.show=function(){var _this=this;var selLabel="Around Selection";var allLabel="Everything";var params=this.params;return Plugin.React.createElement(Plugin.Controls.OptionsGroup,{options:[selLabel,allLabel],caption:function(s){return s},current:params.showFull?allLabel:selLabel,onChange:function(o){return _this.autoUpdateParams({showFull:o===allLabel})},label:"Show"})};CreateVisualBehaviour.prototype.renderControls=function(){var _this=this;var params=this.params;return Plugin.React.createElement("div",null,this.surface(),this.colors(),this.show(),!params.showFull?Plugin.React.createElement(Plugin.Controls.Slider,{label:"Radius",onChange:function(v){return _this.autoUpdateParams({radius:v})},min:params.minRadius!==void 0?params.minRadius:0,max:params.maxRadius!==void 0?params.maxRadius:10,step:.005,value:params.radius}):void 0)};return CreateVisualBehaviour}(Transform.ControllerBase);Density.CreateVisualBehaviour=CreateVisualBehaviour})(Density=Transform.Density||(Transform.Density={}))})(Transform=Views.Transform||(Views.Transform={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Transform;(function(Transform){var Labels;(function(Labels){"use strict";function optionsControls(controller){var style=controller.latestState.params.style;var colors=style.theme.colors.map(function(c,n){return Plugin.React.createElement(Plugin.Controls.ToggleColorPicker,{key:n,label:n==="Uniform"?"Font":n,color:c,onChange:function(c){return controller.updateThemeColor(n,c)}})}).toArray();return[Plugin.React.createElement(Plugin.Controls.Slider,{label:"Size",onChange:function(v){return controller.updateThemeVariable("sizeFactor",v)},min:.1,max:10,step:.1,value:style.theme.variables&&style.theme.variables.get("sizeFactor")||1,title:"Font size."}),Plugin.React.createElement(Plugin.Controls.Slider,{label:"Outline",onChange:function(v){return controller.updateThemeVariable("outlineWidth",v)},min:0,max:.3,step:.001,value:style.theme.variables&&style.theme.variables.get("outlineWidth")||0,title:"Font outline."}),Plugin.React.createElement(Plugin.Controls.Slider,{label:"Offset",onChange:function(v){return controller.updateThemeVariable("zOffset",v)},min:0,max:5,step:.1,value:style.theme.variables&&style.theme.variables.get("zOffset")||0,title:"Label offset."}),Plugin.React.createElement(Plugin.Controls.Slider,{label:"Bg. Opacity",onChange:function(v){return controller.updateThemeVariable("backgroundOpacity",v)},min:0,max:1,step:.01,value:style.theme.variables&&style.theme.variables.get("backgroundOpacity")||0,title:"Background opacity."})].concat(colors)}Labels.optionsControls=optionsControls})(Labels=Transform.Labels||(Transform.Labels={}))})(Transform=Views.Transform||(Views.Transform={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Context;(function(Context){"use strict";var EntryType=LiteMol.Bootstrap.Service.Logger.EntryType;var Log=function(_super){__extends(Log,_super);function Log(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.wrapper=void 0;return _this}Log.prototype.componentWillMount=function(){var _this=this;_super.prototype.componentWillMount.call(this);this.subscribe(LiteMol.Bootstrap.Event.Common.LayoutChanged.getStream(this.controller.context),function(){return _this.scrollToBottom()})};Log.prototype.componentDidUpdate=function(){this.scrollToBottom()};Log.prototype.scrollToBottom=function(){var log=this.wrapper;if(log)log.scrollTop=log.scrollHeight-log.clientHeight-1};Log.prototype.render=function(){var _this=this;var entries=this.controller.latestState.entries;return Plugin.React.createElement("div",{className:"lm-log-wrap"},Plugin.React.createElement("div",{className:"lm-log",ref:function(log){return _this.wrapper=log}},Plugin.React.createElement("ul",{className:"lm-list-unstyled"},entries.map(function(entry,i,arr){var msg;var e=entry;switch(e.type){case EntryType.Message:msg=Plugin.React.createElement("div",{className:"lm-log-entry"},e.message);break;case EntryType.Error:msg=Plugin.React.createElement("div",{className:"lm-log-entry"},Plugin.React.createElement("span",{className:"label label-danger"},"Error")," ",e.message);break;case EntryType.Warning:msg=Plugin.React.createElement("div",{className:"lm-log-entry"},Plugin.React.createElement("span",{className:"label label-warning"},"Warning")," ",e.message);break;case EntryType.Info:msg=Plugin.React.createElement("div",{className:"lm-log-entry"},Plugin.React.createElement("span",{className:"label label-info"},"Info")," ",e.message);break}var t=LiteMol.Bootstrap.Utils.formatTime(e.timestamp);return Plugin.React.createElement("li",{key:i},Plugin.React.createElement("div",{className:"lm-log-entry-badge lm-log-entry-"+EntryType[e.type].toLowerCase()}),Plugin.React.createElement("div",{className:"lm-log-timestamp"},t),Plugin.React.createElement("div",{className:"lm-log-entry"},e.message))}))))};return Log}(Views.View);Context.Log=Log})(Context=Views.Context||(Views.Context={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Context;(function(Context){"use strict";var TaskState=function(_super){__extends(TaskState,_super);function TaskState(){return _super!==null&&_super.apply(this,arguments)||this}TaskState.prototype.render=function(){var info=this.props.info;return Plugin.React.createElement("div",{className:"lm-task-state"},Plugin.React.createElement("div",null,info.abort?Plugin.React.createElement(Plugin.Controls.Button,{onClick:function(){return info.abort.call(null)},style:"remove",icon:"abort",title:"Abort",customClass:"lm-btn-icon"}):void 0,Plugin.React.createElement("div",null,info.name,": ",info.message)))};return TaskState}(Plugin.React.Component);var Overlay=function(_super){__extends(Overlay,_super);function Overlay(){return _super!==null&&_super.apply(this,arguments)||this}Overlay.prototype.render=function(){var state=this.controller.latestState;if(!state.tasks.count())return Plugin.React.createElement("div",{className:"lm-empty-control"});var tasks=[];state.tasks.forEach(function(t,k){return tasks.push(Plugin.React.createElement(TaskState,{key:k,info:t}))});return Plugin.React.createElement("div",{className:"lm-overlay"},Plugin.React.createElement("div",{className:"lm-overlay-background"}),Plugin.React.createElement("div",{className:"lm-overlay-content-wrap"},Plugin.React.createElement("div",{className:"lm-overlay-content"},Plugin.React.createElement("div",null,tasks))))};return Overlay}(Views.View);Context.Overlay=Overlay;var BackgroundTasks=function(_super){__extends(BackgroundTasks,_super);function BackgroundTasks(){return _super!==null&&_super.apply(this,arguments)||this}BackgroundTasks.prototype.render=function(){var state=this.controller.latestState;if(!state.tasks.count())return Plugin.React.createElement("div",{className:"lm-empty-control"});var tasks=[];state.tasks.forEach(function(t,k){return tasks.push(Plugin.React.createElement(TaskState,{key:k,info:t,isSmall:true}))});return Plugin.React.createElement("div",{className:"lm-background-tasks"},tasks)};return BackgroundTasks}(Views.View);Context.BackgroundTasks=BackgroundTasks})(Context=Views.Context||(Views.Context={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Context;(function(Context){"use strict";var ToastEntry=function(_super){__extends(ToastEntry,_super);function ToastEntry(){return _super!==null&&_super.apply(this,arguments)||this}ToastEntry.prototype.hide=function(){var entry=this.props.entry;(entry.hide||function(){}).call(null)};ToastEntry.prototype.render=function(){var _this=this;var entry=this.props.entry;var message=typeof entry.message==="string"?Plugin.React.createElement("div",{dangerouslySetInnerHTML:{__html:entry.message}}):Plugin.React.createElement("div",null,entry.message);return Plugin.React.createElement("div",{className:"lm-toast-entry"},Plugin.React.createElement("div",{className:"lm-toast-title",onClick:function(){return _this.hide()}},entry.title),Plugin.React.createElement("div",{className:"lm-toast-message"},message),Plugin.React.createElement("div",{className:"lm-toast-clear"}),Plugin.React.createElement("div",{className:"lm-toast-hide"},Plugin.React.createElement(Plugin.Controls.Button,{onClick:function(){return _this.hide()},style:"link",icon:"abort",title:"Hide",customClass:"lm-btn-icon"})))};return ToastEntry}(Plugin.React.Component);var Toast=function(_super){__extends(Toast,_super);function Toast(){return _super!==null&&_super.apply(this,arguments)||this}Toast.prototype.render=function(){var state=this.controller.latestState;if(!state.entries.count())return Plugin.React.createElement("div",{className:"lm-empty-control"});var entries=[];state.entries.forEach(function(t,k){return entries.push(t)});entries.sort(function(x,y){return x.serialNumber-y.serialNumber});var toasts=entries.map(function(e){return Plugin.React.createElement(ToastEntry,{key:e.serialNumber,entry:e})});return Plugin.React.createElement("div",{className:"lm-toast-container"},Plugin.React.createElement("div",null,toasts))};return Toast}(Views.View);Context.Toast=Toast})(Context=Views.Context||(Views.Context={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Entity;(function(Entity_2){"use strict";var BEntity=LiteMol.Bootstrap.Entity;Entity_2.VisibilityControl=function(props){var e=props.entity;var command=function(){LiteMol.Bootstrap.Command.Entity.SetVisibility.dispatch(e.tree.context,{entity:e,visible:e.state.visibility===0?false:true})};var state=e.state.visibility;var cls,title;if(state===0){cls="full";title="Hide"}else if(state===2){cls="none";title="Show"}else{cls="partial";title="Show"}return Plugin.React.createElement(Plugin.Controls.Button,{title:title,onClick:command,icon:"visual-visibility",style:"link",customClass:"lm-entity-tree-entry-toggle-visible lm-entity-tree-entry-toggle-visible-"+cls})};var Entity=function(_super){__extends(Entity,_super);function Entity(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.renderedVersion=-1;_this.root=void 0;return _this}Entity.prototype.ensureVisible=function(){if(this.ctx.currentEntity===this.props.node){if(this.root)this.props.tree.scrollIntoView(this.root)}};Entity.prototype.componentDidMount=function(){this.ensureVisible()};Entity.prototype.componentDidUpdate=function(){this.ensureVisible()};Object.defineProperty(Entity.prototype,"node",{get:function(){return this.props.node},enumerable:true,configurable:true});Entity.prototype.shouldComponentUpdate=function(nextProps,nextState,nextContext){return this.node.version!==this.renderedVersion};Entity.prototype.componentWillMount=function(){var _this=this;this.ctx=this.props.node.tree.context;var node=this.node;this.subscribe(LiteMol.Bootstrap.Event.Tree.NodeUpdated.getStream(this.ctx),function(e){if(e.data===node){if(node.version!==_this.renderedVersion)_this.forceUpdate();if(_this.ctx.currentEntity===node&&_this.isFullyBound()){setTimeout(LiteMol.Bootstrap.Command.Entity.SetCurrent.dispatch(_this.ctx,node.children[0]),0)}}})};Entity.prototype.highlight=function(isOn){var node=this.node;LiteMol.Bootstrap.Command.Entity.Highlight.dispatch(this.ctx,{entities:this.ctx.select(LiteMol.Bootstrap.Tree.Selection.byValue(node).subtree()),isOn:isOn})};Entity.prototype.row=function(childCount){var _this=this;var entity=this.props.node;var props=entity.props;var isRoot=entity.parent===entity;var title=props.label;if(props.description)title+=" ("+props.description+")";return Plugin.React.createElement("div",{className:"lm-entity-tree-entry-body"+(this.ctx.currentEntity===entity?" lm-entity-tree-entry-current":"")+(this.isOnCurrentPath()?" lm-entity-tree-entry-current-path":""),ref:function(root){return _this.root=root}},Plugin.React.createElement(Entity_2.Badge,{type:entity.type.info}),Plugin.React.createElement("div",{className:"lm-entity-tree-entry-label-wrap"},Plugin.React.createElement(Plugin.Controls.Button,{onClick:function(){return LiteMol.Bootstrap.Command.Entity.SetCurrent.dispatch(_this.ctx,entity)},customClass:"lm-entity-tree-entry-label",style:"link",title:title},Plugin.React.createElement("span",null,props.label,Plugin.React.createElement("span",{className:"lm-entity-tree-entry-label-tag"},props.description?" "+props.description:void 0)))),!isRoot||childCount?Plugin.React.createElement(Plugin.Controls.Button,{title:"Remove",onClick:function(){return LiteMol.Bootstrap.Command.Tree.RemoveNode.dispatch(entity.tree.context,entity)},icon:"remove",style:"link",customClass:"lm-entity-tree-entry-remove"}):void 0,isRoot&&!childCount?void 0:Plugin.React.createElement(Entity_2.VisibilityControl,{entity:entity}))};Entity.prototype.renderFlat=function(){var node=this.node;var children=[];for(var _i=0,_a=node.children;_i<_a.length;_i++){var c=_a[_i];children.push(Plugin.React.createElement(Entity,{key:c.id,node:c,tree:this.props.tree}))}return Plugin.React.createElement("div",{key:node.id},children)};Entity.prototype.isFullyBound=function(){var isFullyBound=true;for(var _i=0,_a=this.node.children;_i<_a.length;_i++){var c=_a[_i];if(!c.transform.props.isBinding){isFullyBound=false;break}}return isFullyBound&&this.node.children.length===1};Entity.prototype.isOnCurrentPath=function(){if(!this.ctx.currentEntity)return false;var n=this.ctx.currentEntity.parent;var node=this.node;while(n.parent!==n){if(n===node)return true;n=n.parent}return false};Entity.prototype.render=function(){var _this=this;var node=this.node;this.renderedVersion=node.version;var isRoot=node.parent===node;if(this.isFullyBound())return this.renderFlat();var state=node.state;var childCount=0;var children=[];for(var _i=0,_a=node.children;_i<_a.length;_i++){var c=_a[_i];if(c.isHidden)continue;if(!isRoot)children.push(Plugin.React.createElement(Entity,{key:c.id,node:c,tree:this.props.tree}));childCount++}var expander;if(children.length){expander=state.isCollapsed?Plugin.React.createElement(Plugin.Controls.Button,{style:"link",title:"Expand",onClick:function(){return LiteMol.Bootstrap.Command.Entity.ToggleExpanded.dispatch(_this.ctx,node)},icon:"expand",customClass:"lm-entity-tree-entry-toggle-group"}):Plugin.React.createElement(Plugin.Controls.Button,{style:"link",title:"Collapse",onClick:function(){return LiteMol.Bootstrap.Command.Entity.ToggleExpanded.dispatch(_this.ctx,node)},icon:"collapse",customClass:"lm-entity-tree-entry-toggle-group"})}else{if(node.state.visibility===0&&node.type.info.traits.isFocusable){expander=Plugin.React.createElement(Plugin.Controls.Button,{style:"link",icon:"focus-on-visual",title:"Focus",onClick:function(){return LiteMol.Bootstrap.Command.Entity.Focus.dispatch(_this.ctx,_this.ctx.select(node))},customClass:"lm-entity-tree-entry-toggle-group"})}}var main=Plugin.React.createElement("div",{className:"lm-entity-tree-entry",onMouseEnter:function(){return _this.highlight(true)},onMouseLeave:function(){return _this.highlight(false)},onTouchStart:function(){return setTimeout(function(){return _this.highlight(true)},1e3/30)},onTouchCancel:function(){return setTimeout(function(){return _this.highlight(false)},1e3/30)},onTouchEnd:function(){return setTimeout(function(){return _this.highlight(false)},1e3/30)}},expander,this.row(childCount));return Plugin.React.createElement("div",{key:node.id,className:isRoot?"lm-entity-tree-root":""},main,Plugin.React.createElement("div",{className:"lm-entity-tree-children-wrap",style:{display:state.isCollapsed?"none":"block"}},children))};return Entity}(Views.ObserverView);var Tree=function(_super){__extends(Tree,_super);function Tree(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.renderedVersion=-1;_this.root=void 0;_this.splash=Entity_2.SplashInfo.Info();return _this}Tree.prototype.scrollIntoView=function(element){var node=this.root;if(!node||!element)return;try{var parent_1=node.getBoundingClientRect();var rect=element.getBoundingClientRect();var scrollTop=node.scrollTop;if(rect.top<parent_1.top){var d=parent_1.top-rect.top;node.scrollTop=scrollTop-d}else if(rect.bottom>parent_1.bottom){var d=rect.bottom-parent_1.bottom;node.scrollTop=scrollTop+d}}catch(e){}};Tree.prototype.componentWillMount=function(){var _this=this;var node=this.controller.context.tree.root;var ctx=node.tree.context;this.subscribe(LiteMol.Bootstrap.Event.Tree.NodeUpdated.getStream(ctx),function(e){if(e.data===node){if(node.version!==_this.renderedVersion)_this.forceUpdate()}})};Tree.prototype.render=function(){var _this=this;var root=this.controller.context.tree.root;this.renderedVersion=root.version;var children=[];for(var _i=0,_a=root.children;_i<_a.length;_i++){var c=_a[_i];if(c.isHidden)continue;children.push(Plugin.React.createElement(Entity,{key:c.id,node:c,tree:this}))}return Plugin.React.createElement("div",{className:"lm-entity-tree",ref:function(root){return _this.root=root}},Plugin.React.createElement(Entity,{key:root.id,node:root,tree:this}),Plugin.React.createElement("div",{className:"lm-entity-tree-children"},children.length?children:this.splash))};return Tree}(Views.View);Entity_2.Tree=Tree})(Entity=Views.Entity||(Views.Entity={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Entity;(function(Entity){"use strict";Entity.Remove=function(props){return Plugin.React.createElement(Plugin.Controls.Button,{onClick:function(){LiteMol.Bootstrap.Command.Tree.RemoveNode.dispatch(props.entity.tree.context,props.entity);props.onRemove.call(null)},style:"link",icon:"remove",customClass:"lm-remove-entity lm-btn-icon"})};var Badge=function(_super){__extends(Badge,_super);function Badge(){return _super!==null&&_super.apply(this,arguments)||this}Badge.prototype.shouldComponentUpdate=function(nextProps,nextState,nextContext){return this.props.type!==nextProps.type};Badge.prototype.createBadge=function(name){if(!name.length)return;for(var i=0;i<name.length;i++){if(name[i]==="_"){return Plugin.React.createElement("span",null,name.substr(0,i),Plugin.React.createElement("sub",null,this.createBadge(name.substr(i+1))))}else if(name[i]==="^"){return Plugin.React.createElement("span",null,name.substr(0,i),Plugin.React.createElement("sup",null,this.createBadge(name.substr(i+1))))}}return name};Badge.prototype.render=function(){var type=this.props.type;return Plugin.React.createElement("div",{className:"lm-entity-badge lm-entity-badge-"+this.props.type.typeClass,title:type.name},Plugin.React.createElement("div",null,type===LiteMol.Bootstrap.Entity.Root.info?void 0:this.createBadge(type.shortName)))};return Badge}(Plugin.React.Component);Entity.Badge=Badge;var CurrentEntityControl=function(_super){__extends(CurrentEntityControl,_super);function CurrentEntityControl(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={current:void 0};return _this}CurrentEntityControl.prototype.componentWillMount=function(){var _this=this;_super.prototype.componentWillMount.call(this);this.state.current=this.controller.context.currentEntity;this.subscribe(LiteMol.Bootstrap.Event.Entity.CurrentChanged.getStream(this.controller.context),function(e){_this.setState({current:e.data})})};CurrentEntityControl.prototype.render=function(){var _this=this;if(!this.state.current){return Plugin.React.createElement("div",{className:"lm-entity-info"},Plugin.React.createElement("div",null,Plugin.React.createElement("span",null,this.controller.appName)))}var entity=this.state.current;return Plugin.React.createElement("div",{className:"lm-entity-info",title:entity.props.label+" "+(entity.props.description?entity.props.description:"")},Plugin.React.createElement("div",null,Plugin.React.createElement(Badge,{type:entity.type.info}),Plugin.React.createElement("span",null,entity.props.label,Plugin.React.createElement("span",null,entity.props.description)),entity.parent===entity&&!entity.children.length?void 0:Plugin.React.createElement(Entity.Remove,{entity:entity,onRemove:function(){return _this.forceUpdate()}})))};return CurrentEntityControl}(Views.View);Entity.CurrentEntityControl=CurrentEntityControl;var SplashInfo;(function(SplashInfo){SplashInfo.General=function(){return Plugin.React.createElement("div",{className:"lm-entity-splash-general"},Plugin.React.createElement("div",null),Plugin.React.createElement("span",{className:"lm-icon lm-icon-info"}),"The application operates on an entity tree structure that can be manipulated using the controls on the panel to the right.")};var ClassInfo=function(_super){__extends(ClassInfo,_super);function ClassInfo(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={isExpanded:false};return _this}ClassInfo.prototype.render=function(){var _this=this;return Plugin.React.createElement("div",{className:"lm-entity-splash-class lm-entity-splash-class-"+(this.state.isExpanded?"expanded":"collapsed")},Plugin.React.createElement("div",{onClick:function(){return _this.setState({isExpanded:!_this.state.isExpanded})}},Plugin.React.createElement("div",null),Plugin.React.createElement("div",{className:"lm-entity-badge-"+this.props.cls})," ",Plugin.React.createElement("span",null,this.props.cls)),Plugin.React.createElement("div",null,this.props.desc))};return ClassInfo}(Plugin.React.Component);SplashInfo.Info=function(){return Plugin.React.createElement("div",{className:"lm-entity-splash"},Plugin.React.createElement(SplashInfo.General,null),Plugin.React.createElement(ClassInfo,{cls:"Root",desc:"The root entity represents the starting point of all actions."}),Plugin.React.createElement(ClassInfo,{cls:"Action",desc:"Represents a composition of one of more changes to the entity tree."}),Plugin.React.createElement(ClassInfo,{cls:"Data",desc:"Low level data, for example a string or a CIF dictionary."}),Plugin.React.createElement(ClassInfo,{cls:"Object",desc:"A more complex structure obtained from low level data. For example a molecule."}),Plugin.React.createElement(ClassInfo,{cls:"Visual",desc:"A visual representation of an object."}),Plugin.React.createElement(ClassInfo,{cls:"Selection",desc:"A description of a substructure of an object or a visual."}),Plugin.React.createElement(ClassInfo,{cls:"Behaviour",desc:"Represents a dynamic behavior of the program. For example creating electron density surface when the selection changes."}),Plugin.React.createElement(ClassInfo,{cls:"Group",desc:"A collection of related entities."}))}})(SplashInfo=Entity.SplashInfo||(Entity.SplashInfo={}))})(Entity=Views.Entity||(Views.Entity={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Views;(function(Views){var Visualization;(function(Visualization){"use strict";var ViewportControls=function(_super){__extends(ViewportControls,_super);function ViewportControls(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={showSceneOptions:false,showHelp:false};return _this}ViewportControls.prototype.help=function(){return Plugin.React.createElement("div",{className:"lm-viewport-controls-scene-options lm-control"},Plugin.React.createElement(Plugin.Controls.HelpBox,{title:"Rotate",content:Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,"Left button"),Plugin.React.createElement("div",null,"One finger touch"))}),Plugin.React.createElement(Plugin.Controls.HelpBox,{title:"Zoom",content:Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,"Right button"),Plugin.React.createElement("div",null,"Pinch"))}),Plugin.React.createElement(Plugin.Controls.HelpBox,{title:"Move",content:Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,"Middle button"),Plugin.React.createElement("div",null,"Two finger touch"))}),Plugin.React.createElement(Plugin.Controls.HelpBox,{title:"Slab",content:Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,"Mouse wheel"),Plugin.React.createElement("div",null,"Three finger touch"))}))};ViewportControls.prototype.render=function(){var _this=this;var state=this.controller.latestState;var options;var layoutController=this.controller.context.layout;var layoutState=layoutController.latestState;if(this.state.showSceneOptions){options=Plugin.React.createElement("div",{className:"lm-viewport-controls-scene-options lm-control"},Plugin.React.createElement(Plugin.Controls.Toggle,{onChange:function(v){return _this.controller.setState({enableFog:v})},value:state.enableFog,label:"Fog"}),Plugin.React.createElement(Plugin.Controls.Slider,{label:"FOV",min:30,max:90,onChange:function(v){return _this.controller.setState({cameraFOV:v})},value:state.cameraFOV}),Plugin.React.createElement(Plugin.Controls.Slider,{label:"Camera Speed",min:1,max:10,step:.01,onChange:function(v){return _this.controller.setState({cameraSpeed:v})},value:state.cameraSpeed}),Plugin.React.createElement(Plugin.Controls.ToggleColorPicker,{color:state.clearColor,label:"Background",position:"below",onChange:function(c){return _this.controller.setState({clearColor:c})}}))}else if(this.state.showHelp){options=this.help()}var controlsShown=!layoutState.hideControls;return Plugin.React.createElement("div",{className:"lm-viewport-controls",onMouseLeave:function(){return _this.setState({showSceneOptions:false,showHelp:false})}},Plugin.React.createElement("div",{className:"lm-viewport-controls-buttons"},Plugin.React.createElement(Plugin.Controls.Button,{style:"link",active:this.state.showHelp,customClass:"lm-btn-link-toggle-"+(this.state.showHelp?"on":"off"),icon:"help-circle",onClick:function(e){return _this.setState({showHelp:!_this.state.showHelp,showSceneOptions:false})},title:"Controls Help"}),Plugin.React.createElement(Plugin.Controls.Button,{style:"link",active:this.state.showSceneOptions,customClass:"lm-btn-link-toggle-"+(this.state.showSceneOptions?"on":"off"),icon:"settings",onClick:function(e){return _this.setState({showSceneOptions:!_this.state.showSceneOptions,showHelp:false})},title:"Scene Options"}),Plugin.React.createElement(Plugin.Controls.Button,{style:"link",icon:"screenshot",onClick:function(e){return _this.controller.scene.scene.downloadScreenshot()},title:"Screenshot"}),Plugin.React.createElement(Plugin.Controls.Button,{onClick:function(){layoutController.update({hideControls:controlsShown});_this.forceUpdate()},icon:"tools",title:controlsShown?"Hide Controls":"Show Controls",active:controlsShown,customClass:"lm-btn-link-toggle-"+(controlsShown?"on":"off"),style:"link"}),Plugin.React.createElement(Plugin.Controls.Button,{onClick:function(){return layoutController.update({isExpanded:!layoutState.isExpanded})},icon:"expand-layout",title:layoutState.isExpanded?"Collapse":"Expand",active:layoutState.isExpanded,customClass:"lm-btn-link-toggle-"+(layoutState.isExpanded?"on":"off"),style:"link"}),Plugin.React.createElement(Plugin.Controls.Button,{style:"link",icon:"reset-scene",onClick:function(e){return LiteMol.Bootstrap.Command.Visual.ResetScene.dispatch(_this.controller.context,void 0)},title:"Reset scene"})),options)};return ViewportControls}(Views.View);Visualization.ViewportControls=ViewportControls;var HighlightInfo=function(_super){__extends(HighlightInfo,_super);function HighlightInfo(){return _super!==null&&_super.apply(this,arguments)||this}HighlightInfo.prototype.render=function(){var state=this.controller.latestState;var info=state.info;if(!info.length){return Plugin.React.createElement("div",{className:"lm-empty-control"})}var html={__html:info.join(", ")};return Plugin.React.createElement("div",{className:"lm-highlight-info"},Plugin.React.createElement("div",{dangerouslySetInnerHTML:html}))};return HighlightInfo}(Views.View);Visualization.HighlightInfo=HighlightInfo;Visualization.Logo=function(){return Plugin.React.createElement("div",{className:"lm-logo"},Plugin.React.createElement("div",null,Plugin.React.createElement("div",null,Plugin.React.createElement("div",null),Plugin.React.createElement("div",{className:"lm-logo-image"}))))};var Viewport=function(_super){__extends(Viewport,_super);function Viewport(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.host3d=void 0;_this.defaultBg={r:0,g:0,b:0};_this.state={noWebGl:false,showLogo:true};return _this}Viewport.prototype.componentDidMount=function(){if(!this.host3d||!this.controller.init(this.host3d)){this.setState({noWebGl:true})}this.handleLogo()};Viewport.prototype.componentWillUnmount=function(){_super.prototype.componentWillUnmount.call(this);this.controller.destroy()};Viewport.prototype.renderMissing=function(){return Plugin.React.createElement("div",{className:"lm-no-webgl"},Plugin.React.createElement("div",null,Plugin.React.createElement("p",null,Plugin.React.createElement("b",null,"WebGL does not seem to be available.")),Plugin.React.createElement("p",null,"This can be caused by an outdated browser, graphics card driver issue, or bad weather. Sometimes, just restarting the browser helps."),Plugin.React.createElement("p",null,"For a list of supported browsers, refer to ",Plugin.React.createElement("a",{href:"http://caniuse.com/#feat=webgl",target:"_blank"},"http://caniuse.com/#feat=webgl"),".")))};Viewport.prototype.handleLogo=function(){var _this=this;this.subscribe(LiteMol.Bootstrap.Event.Tree.NodeAdded.getStream(this.controller.context),function(e){if(LiteMol.Bootstrap.Entity.isClass(e.data,LiteMol.Bootstrap.Entity.VisualClass)){setTimeout(function(){return _this.setState({showLogo:_this.getShowLogo()})},0)}});this.subscribe(LiteMol.Bootstrap.Event.Tree.NodeRemoved.getStream(this.controller.context),function(e){if(LiteMol.Bootstrap.Entity.isClass(e.data,LiteMol.Bootstrap.Entity.VisualClass)){setTimeout(function(){return _this.setState({showLogo:_this.getShowLogo()})},0)}})};Viewport.prototype.getShowLogo=function(){try{return this.controller.context.viewport.scene.models.isEmpty()}catch(e){return true}};Viewport.prototype.render=function(){var _this=this;if(this.state.noWebGl)return this.renderMissing();var color=this.controller.latestState.clearColor||this.defaultBg;return Plugin.React.createElement("div",{className:"lm-viewport",style:{backgroundColor:"rgb("+255*color.r+", "+255*color.g+", "+255*color.b+")"}},Plugin.React.createElement("div",{ref:function(host){return _this.host3d=host},className:"lm-viewport-host3d"}),this.state.showLogo?Plugin.React.createElement(Visualization.Logo,null):void 0,Plugin.React.createElement(ViewportControls,{controller:this.controller}))};return Viewport}(Views.View);Visualization.Viewport=Viewport})(Visualization=Views.Visualization||(Views.Visualization={}))})(Views=Plugin.Views||(Plugin.Views={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){var Components;(function(Components){"use strict";function create(key,controller,view){return function(t,isStatic){return function(ctx){return{key:key,controller:controller(ctx),region:t,view:view,isStatic:isStatic}}}}Components.create=create;var AppInfo=function(_super){__extends(AppInfo,_super);function AppInfo(ctx,appName,appVersion){var _this=_super.call(this,ctx,{})||this;_this.appName=appName;_this.appVersion=appVersion;return _this}return AppInfo}(LiteMol.Bootstrap.Components.Component);Components.AppInfo=AppInfo;var Context;(function(Context){Context.Log=create("Context.Log",function(s){return new LiteMol.Bootstrap.Components.Context.Log(s)},Plugin.Views.Context.Log);Context.Toast=create("Context.Toast",function(s){return new LiteMol.Bootstrap.Components.Context.Toast(s)},Plugin.Views.Context.Toast);Context.Overlay=create("Context.Overlay",function(s){return new LiteMol.Bootstrap.Components.Context.TaskWatcher(s,"Normal")},Plugin.Views.Context.Overlay);Context.BackgroundTasks=create("Context.BackgroundTasks",function(s){return new LiteMol.Bootstrap.Components.Context.TaskWatcher(s,"Background")},Plugin.Views.Context.BackgroundTasks)})(Context=Components.Context||(Components.Context={}));var Transform;(function(Transform){Transform.View=create("Transform.View",function(s){return new LiteMol.Bootstrap.Components.Transform.View(s)},Plugin.Views.Transform.View)})(Transform=Components.Transform||(Components.Transform={}));var Entity;(function(Entity){Entity.Current=function(appName,appVersion){return create("EntityInfo",function(s){return new AppInfo(s,appName,appVersion)},Plugin.Views.Entity.CurrentEntityControl)}})(Entity=Components.Entity||(Components.Entity={}));var Visualization;(function(Visualization){Visualization.Viewport=create("Viewport",function(s){return new LiteMol.Bootstrap.Components.Visualization.Viewport(s)},Plugin.Views.Visualization.Viewport);Visualization.HighlightInfo=create("HighlightInfo",function(s){return new LiteMol.Bootstrap.Components.Visualization.HighlightInfo(s)},Plugin.Views.Visualization.HighlightInfo)})(Visualization=Components.Visualization||(Components.Visualization={}))})(Components=Plugin.Components||(Plugin.Components={}))})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){"use strict";Plugin.Context=LiteMol.Bootstrap.Context;var LayoutRegion=LiteMol.Bootstrap.Components.LayoutRegion;var Instance=function(){function Instance(spec,target){this.spec=spec;this.target=target;this.componentMap=LiteMol.Core.Utils.FastMap.create();this.transformersInfo=LiteMol.Core.Utils.FastMap.create();this.context=new LiteMol.Bootstrap.Context(this);this.init();Plugin.ReactDOM.render(Plugin.React.createElement(this.spec.layoutView,{controller:this.context.layout}),target);LiteMol.Bootstrap.Command.Entity.SetCurrent.dispatch(this.context,this.context.tree.root)}Instance.prototype.compose=function(){for(var _i=0,_a=Object.keys(this.spec.settings);_i<_a.length;_i++){var s=_a[_i];if(!Object.prototype.hasOwnProperty.call(this.spec.settings,s))continue;this.context.settings.set(s,this.spec.settings[s])}var targets=LiteMol.Bootstrap.Components.makeEmptyTargets();for(var _b=0,_c=this.spec.behaviours||[];_b<_c.length;_b++){var b=_c[_b];b(this.context)}for(var _d=0,_e=this.spec.transforms;_d<_e.length;_d++){var t=_e[_d];this.context.transforms.add(t.transformer);this.transformersInfo.set(t.transformer.info.id,t)}for(var _f=0,_g=this.spec.components;_f<_g.length;_f++){var cs=_g[_f];var info=cs(this.context);if(this.componentMap.has(info.key)){throw"Component with key '"+info.key+"' was already added. Fix your spec."}targets[info.region].components.push(info);this.componentMap.set(info.key,info)}return targets};Instance.prototype.getTransformerInfo=function(transformer){return this.transformersInfo.get(transformer.info.id)};Instance.prototype.destroy=function(){this.context.dispatcher.finished();Plugin.ReactDOM.unmountComponentAtNode(this.target);this.context=void 0;this.componentMap=void 0;this.spec=void 0;this.target=void 0};Instance.prototype.init=function(){var targets=this.compose();if(this.spec.tree){targets[this.spec.tree.region].components.push({key:"lm-internal-tree",controller:new LiteMol.Bootstrap.Components.Component(this.context,{}),region:this.spec.tree.region,view:this.spec.tree.view,isStatic:true})}targets[LayoutRegion.Main].components.push({key:"lm-internal-viewport",controller:this.context.viewport,region:LayoutRegion.Main,view:this.spec.viewport.view,isStatic:true});this.context.createLayout(targets,this.target)};return Instance}();Plugin.Instance=Instance})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){"use strict";var Transformer=LiteMol.Bootstrap.Entity.Transformer;var DataSources;(function(DataSources){DataSources.DownloadMolecule=Transformer.Molecule.downloadMoleculeSource({sourceId:"url-molecule",name:"URL",description:"Download a molecule from the specified URL (if the host server supports cross domain requests).",defaultId:"https://webchem.ncbr.muni.cz/CoordinateServer/1tqn/cartoon",urlTemplate:function(id){return id},isFullUrl:true})})(DataSources=Plugin.DataSources||(Plugin.DataSources={}));var LayoutRegion=LiteMol.Bootstrap.Components.LayoutRegion;function getDefaultSpecification(){return{settings:{"molecule.model.defaultQuery":"residues({ name: 'ALA' })","molecule.model.defaultAssemblyName":"1","molecule.coordinateStreaming.defaultId":"1jj2","molecule.coordinateStreaming.defaultServer":"https://webchem.ncbr.muni.cz/CoordinateServer","molecule.coordinateStreaming.defaultRadius":10,"density.defaultVisualBehaviourRadius":5},transforms:[{transformer:Transformer.Molecule.CoordinateStreaming.InitStreaming,view:Plugin.Views.Transform.Molecule.InitCoordinateStreaming,initiallyCollapsed:true},{transformer:DataSources.DownloadMolecule,view:Plugin.Views.Transform.Data.WithUrlIdField,initiallyCollapsed:true},{transformer:Transformer.Molecule.OpenMoleculeFromFile,view:Plugin.Views.Transform.Molecule.OpenFile,initiallyCollapsed:true},{transformer:Transformer.Data.Download,view:Plugin.Views.Transform.Data.Download,initiallyCollapsed:true},{transformer:Transformer.Data.OpenFile,view:Plugin.Views.Transform.Data.OpenFile,initiallyCollapsed:true},{transformer:Transformer.Molecule.CreateFromData,view:Plugin.Views.Transform.Molecule.CreateFromData},{transformer:Transformer.Data.ParseCif,view:Plugin.Views.Transform.Empty},{transformer:Transformer.Density.ParseData,view:Plugin.Views.Transform.Density.ParseData},{transformer:Transformer.Molecule.CreateFromMmCif,view:Plugin.Views.Transform.Molecule.CreateFromMmCif},{transformer:Transformer.Molecule.CreateModel,view:Plugin.Views.Transform.Molecule.CreateModel,initiallyCollapsed:true},{transformer:Transformer.Molecule.CreateSelection,view:Plugin.Views.Transform.Molecule.CreateSelection,initiallyCollapsed:true},{transformer:Transformer.Molecule.CreateAssembly,view:Plugin.Views.Transform.Molecule.CreateAssembly,initiallyCollapsed:true},{transformer:Transformer.Molecule.CreateSymmetryMates,view:Plugin.Views.Transform.Molecule.CreateSymmetryMates,initiallyCollapsed:true},{transformer:Transformer.Molecule.CreateMacromoleculeVisual,view:Plugin.Views.Transform.Empty},{transformer:Transformer.Molecule.CreateVisual,view:Plugin.Views.Transform.Molecule.CreateVisual},{transformer:Transformer.Density.CreateVisual,view:Plugin.Views.Transform.Density.CreateVisual},{transformer:Transformer.Density.CreateVisualBehaviour,view:Plugin.Views.Transform.Density.CreateVisualBehaviour},{transformer:Transformer.Molecule.CoordinateStreaming.CreateBehaviour,view:Plugin.Views.Transform.Empty,initiallyCollapsed:true}],behaviours:[LiteMol.Bootstrap.Behaviour.SetEntityToCurrentWhenAdded,LiteMol.Bootstrap.Behaviour.FocusCameraOnSelect,LiteMol.Bootstrap.Behaviour.ApplySelectionToVisual,LiteMol.Bootstrap.Behaviour.ApplyInteractivitySelection,LiteMol.Bootstrap.Behaviour.UnselectElementOnRepeatedClick,LiteMol.Bootstrap.Behaviour.Molecule.HighlightElementInfo,LiteMol.Bootstrap.Behaviour.Molecule.DistanceToLastClickedElement,LiteMol.Bootstrap.Behaviour.Molecule.ShowInteractionOnSelect(5)],components:[Plugin.Components.Visualization.HighlightInfo(LayoutRegion.Main,true),Plugin.Components.Entity.Current("LiteMol",Plugin.VERSION.number)(LayoutRegion.Right,true),Plugin.Components.Transform.View(LayoutRegion.Right),Plugin.Components.Context.Log(LayoutRegion.Bottom,true),Plugin.Components.Context.Overlay(LayoutRegion.Root),Plugin.Components.Context.Toast(LayoutRegion.Main,true),Plugin.Components.Context.BackgroundTasks(LayoutRegion.Main,true)],viewport:{view:Plugin.Views.Visualization.Viewport,controlsView:Plugin.Views.Visualization.ViewportControls},layoutView:Plugin.Views.Layout,tree:{region:LayoutRegion.Left,view:Plugin.Views.Entity.Tree}}}Plugin.getDefaultSpecification=getDefaultSpecification})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));var LiteMol;(function(LiteMol){var Plugin;(function(Plugin){"use strict";var Entity=LiteMol.Bootstrap.Entity;var Transformer=Entity.Transformer;var Controller=function(){function Controller(optionsOrInstance){if(optionsOrInstance.getTransformerInfo){this.ofInstace(optionsOrInstance)}else{this.ofOptions(optionsOrInstance)}}Object.defineProperty(Controller.prototype,"instance",{get:function(){return this._instance},enumerable:true,configurable:true});Object.defineProperty(Controller.prototype,"context",{get:function(){return this._instance.context},enumerable:true,configurable:true});Object.defineProperty(Controller.prototype,"root",{get:function(){return this._instance.context.tree.root},enumerable:true,configurable:true});Controller.prototype.command=function(cmd,params){cmd.dispatch(this.context,params)};Controller.prototype.selectEntities=function(selector){return this.context.select(selector)};Controller.prototype.subscribe=function(event,onEvent){return event.getStream(this.context).subscribe(onEvent)};Controller.prototype.createTransform=function(){return LiteMol.Bootstrap.Tree.Transform.build()};Controller.prototype.applyTransform=function(transform){var ctx=this.context;return LiteMol.Bootstrap.Tree.Transform.apply(ctx,transform).run()};Controller.prototype.clear=function(){this.command(LiteMol.Bootstrap.Command.Tree.RemoveNode,this.root)};Controller.prototype.setViewportBackground=function(color){if(LiteMol.Visualization.Color.isColor(color)){this.command(LiteMol.Bootstrap.Command.Layout.SetViewportOptions,{clearColor:color})}else{this.command(LiteMol.Bootstrap.Command.Layout.SetViewportOptions,{clearColor:LiteMol.Visualization.Color.fromHexString(color)})}};Controller.prototype.setLayoutState=function(state){this.command(LiteMol.Bootstrap.Command.Layout.SetState,state)};Controller.prototype.loadMolecule=function(source){var action=this.createTransform();if(!source.url&&!source.data){throw new Error("Please specify either url or data")}var format=LiteMol.Core.Formats.Molecule.SupportedFormats.mmCIF;if(source.format){if(LiteMol.Core.Formats.FormatInfo.is(source.format)){format=source.format}else{var f=LiteMol.Core.Formats.FormatInfo.fromShortcut(LiteMol.Core.Formats.Molecule.SupportedFormats.All,source.format);if(!f){throw new Error("'"+source.format+"' is not a supported format.")}format=f}}var data=source.data?action.add(this.root,Entity.Transformer.Data.FromData,{data:source.data,id:source.id}):action.add(this.root,Transformer.Data.Download,{url:source.url,type:format.isBinary?"Binary":"String",id:source.id,title:"Molecule"});var model=data.then(Transformer.Molecule.CreateFromData,{format:format,customId:source.id},{isBinding:true,ref:source.moleculeRef}).then(Transformer.Molecule.CreateModel,{modelIndex:0},{isBinding:false,ref:source.modelRef});if(!source.doNotCreateVisual){model.then(Transformer.Molecule.CreateMacromoleculeVisual,{polymer:true,het:true,water:true})}return this.applyTransform(data)};Controller.prototype.destroy=function(){if(!this._instance)return;this._instance.destroy();this._instance=void 0};Controller.prototype.ofOptions=function(options){var spec=options.customSpecification?options.customSpecification:Plugin.getDefaultSpecification();if(!options.customSpecification){spec.behaviours.push(LiteMol.Bootstrap.Behaviour.GoogleAnalytics(options.analyticsId?options.analyticsId:"UA-77062725-1"))}var target;if(options.target instanceof HTMLElement){target=options.target}else{target=document.querySelector(options.target)}if(!target){throw new Error("options.target cannot be undefined.")}this._instance=new Plugin.Instance(spec,target);if(options.viewportBackground){this.setViewportBackground(options.viewportBackground)}if(options.layoutState){this.setLayoutState(options.layoutState)}};Controller.prototype.ofInstace=function(instance){this._instance=instance};return Controller}();Plugin.Controller=Controller;function create(options){return new Controller(options)}Plugin.create=create})(Plugin=LiteMol.Plugin||(LiteMol.Plugin={}))})(LiteMol||(LiteMol={}));return LiteMol};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=__LiteMol_Plugin()}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__],__WEBPACK_AMD_DEFINE_RESULT__=function(require){return __LiteMol_Plugin()}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{var __target=!!window?window:this;__target.LiteMol=__LiteMol_Plugin()}}).call(exports,__webpack_require__(0),__webpack_require__(139),__webpack_require__(140)(module))},function(module,exports){var g;g=function(){return this}();try{g=g||Function("return this")()||(1,eval)("this")}catch(e){if(typeof window==="object")g=window}module.exports=g},function(module,exports){module.exports=function(module){if(!module.webpackPolyfill){module.deprecate=function(){};module.paths=[];if(!module.children)module.children=[];Object.defineProperty(module,"loaded",{enumerable:true,get:function(){return module.l}});Object.defineProperty(module,"id",{enumerable:true,get:function(){return module.i}});module.webpackPolyfill=1}return module}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ciftools_js_1=__webpack_require__(43);var mmCIF=__webpack_require__(143);var collections_1=__webpack_require__(8);var secondary_structure_1=__webpack_require__(144);function createModel(structureId,data,startRow,rowCount){var dataIndex=[],residueIndex=[];var atomOffset=[0],chainIndex=[];var x=[],y=[],z=[];var residueOffset=[0],entityIndex=[];var chainOffset=[0];var _a=data.atom_site,auth_asym_id=_a.auth_asym_id,auth_seq_id=_a.auth_seq_id,pdbx_PDB_ins_code=_a.pdbx_PDB_ins_code,pdbx_PDB_model_num=_a.pdbx_PDB_model_num,label_entity_id=_a.label_entity_id,Cartn_x=_a.Cartn_x,Cartn_y=_a.Cartn_y,Cartn_z=_a.Cartn_z;var atom=0,residue=0,chain=0,entity=0;var residueStartAtom=0;var chainStartResidue=0;var entityStartChain=0;var currentResidueRow=startRow,currentChainRow=startRow,currentEntityRow=startRow;for(var i=startRow;i<rowCount;i++){if(!pdbx_PDB_model_num.areValuesEqual(startRow,i))break;var newEntity=!label_entity_id.areValuesEqual(currentEntityRow,i);var newChain=newEntity||!auth_asym_id.areValuesEqual(currentChainRow,i);var newResidue=newChain||!auth_seq_id.areValuesEqual(currentResidueRow,i)||!pdbx_PDB_ins_code.areValuesEqual(currentResidueRow,i);if(newResidue){atomOffset.push(atom);chainIndex.push(chain);residueStartAtom=atom;residue++;currentResidueRow=i}if(newChain){residueOffset.push(residue);entityIndex.push(entity);currentChainRow=i;chainStartResidue=residue;chain++}if(newEntity){chainOffset.push(chain);currentEntityRow=i;entityStartChain=chain;entity++}dataIndex.push(i);x.push(Cartn_x.getFloat(i));y.push(Cartn_y.getFloat(i));z.push(Cartn_z.getFloat(i));residueIndex.push(residue);atom++}atomOffset.push(atom);chainIndex.push(chain);residueOffset.push(residue+1);entityIndex.push(entity);chainOffset.push(chain+1);residue++;chain++;entity++;return{structureId:structureId,id:pdbx_PDB_model_num.getInteger(startRow),atoms:{dataIndex:dataIndex,residueIndex:residueIndex,count:atom},residues:{atomOffset:atomOffset,chainIndex:chainIndex,count:residue,key:new Int32Array(residue)},chains:{residueOffset:residueOffset,entityIndex:entityIndex,count:chain,key:new Int32Array(chain)},entities:{chainOffset:chainOffset,count:entity,key:new Int32Array(entity),dataIndex:new Int32Array(entity)},secondaryStructure:{type:new Uint8Array(residue),index:new Int32Array(residue),flags:new Uint32Array(residue),key:new Int32Array(residue)},modifiedResidues:collections_1.FastMap.create(),positions:{x:x,y:y,z:z},data:data,"@spatialLookup":void 0,"@connectedComponentKey":void 0,"@bonds":void 0,"@rings":void 0}}function getElementKey(map,key,counter){if(map.has(key))return map.get(key);var ret=counter.index++;map.set(key,ret);return ret}function getElementSubstructureKeyMap(map,key){if(map.has(key))return map.get(key);var ret=collections_1.FastMap.create();map.set(key,ret);return ret}function assignKeysAndDataIndices(model){var entityDataIndexMap=collections_1.FastMap.create();var entity=model.data.entity;for(var i=0;i<entity.rowCount;i++)entityDataIndexMap.set(entity.id.getString(i)||"",i);var entityMap=collections_1.FastMap.create(),entityCounter={index:0};var chainMaps=collections_1.FastMap.create(),chainCounter={index:0};var residueMaps=collections_1.FastMap.create(),residueCounter={index:0};var dataIndex=model.atoms.dataIndex;var _a=model.residues,residueKey=_a.key,atomOffset=_a.atomOffset;var _b=model.chains,chainKey=_b.key,residueOffset=_b.residueOffset;var _c=model.entities,entityKey=_c.key,entityCount=_c.count,chainOffset=_c.chainOffset,entityDataIndex=_c.dataIndex;var _d=model.data.atom_site,label_entity_id=_d.label_entity_id,auth_asym_id=_d.auth_asym_id,auth_seq_id=_d.auth_seq_id,pdbx_PDB_ins_code=_d.pdbx_PDB_ins_code;for(var eI=0;eI<entityCount;eI++){var chainStart=chainOffset[eI],chainEnd=chainOffset[eI+1];var dataRow=dataIndex[atomOffset[residueOffset[chainStart]]];var entId=label_entity_id.getString(dataRow);entityDataIndex[eI]=entityDataIndexMap.get(entId)||0;var eKey=getElementKey(entityMap,entId,entityCounter);entityKey[eI]=eKey;var chainMap=getElementSubstructureKeyMap(chainMaps,eKey);for(var cI=chainStart;cI<chainEnd;cI++){var residueStart=residueOffset[cI],residueEnd=residueOffset[cI+1];dataRow=dataIndex[atomOffset[residueStart]];var cKey=getElementKey(chainMap,auth_asym_id.getString(dataRow),chainCounter);chainKey[cI]=cKey;var residueMap=getElementSubstructureKeyMap(residueMaps,cKey);for(var rI=residueStart;rI<residueEnd;rI++){dataRow=dataIndex[atomOffset[rI]];residueKey[rI]=getElementKey(residueMap,pdbx_PDB_ins_code.getValuePresence(dataRow)!==0?auth_seq_id.getInteger(dataRow):auth_seq_id.getInteger(dataRow)+" "+pdbx_PDB_ins_code.getString(dataRow),residueCounter)}}}}function extendSecondaryStructureMap(cat,type,map){if(!cat.rowCount)return;var beg_label_asym_id=cat.beg_label_asym_id,beg_label_seq_id=cat.beg_label_seq_id,pdbx_beg_PDB_ins_code=cat.pdbx_beg_PDB_ins_code;var end_label_seq_id=cat.end_label_seq_id,pdbx_end_PDB_ins_code=cat.pdbx_end_PDB_ins_code;for(var i=0;i<cat.rowCount;i++){var entry={startSeqNumber:beg_label_seq_id.getInteger(i),startInsCode:pdbx_beg_PDB_ins_code.getString(i),endSeqNumber:end_label_seq_id.getInteger(i),endInsCode:pdbx_end_PDB_ins_code.getString(i),type:type,rowIndex:i};var asymId=beg_label_asym_id.getString(i);if(map.has(asymId)){map.get(asymId).set(entry.startSeqNumber,entry)}else{map.set(asymId,collections_1.FastMap.ofArray([[entry.startSeqNumber,entry]]))}}return map}function assignSecondaryStructureEntry(model,entry,resStart,resEnd){var atomOffset=model.residues.atomOffset;var _a=model.secondaryStructure,secondaryStructureIndex=_a.index,secondaryStructureType=_a.type;var dataIndex=model.atoms.dataIndex;var _b=model.data.atom_site,label_seq_id=_b.label_seq_id,pdbx_PDB_ins_code=_b.pdbx_PDB_ins_code;var endSeqNumber=entry.endSeqNumber,endInsCode=entry.endInsCode,rowIndex=entry.rowIndex,type=entry.type;var rI=resStart;while(rI<resEnd){var atomRowIndex=dataIndex[atomOffset[rI]];var seqNumber=label_seq_id.getInteger(atomRowIndex);if(seqNumber>endSeqNumber||seqNumber===endSeqNumber&&pdbx_PDB_ins_code.getString(atomRowIndex)===endInsCode){break}secondaryStructureIndex[rI]=rowIndex;secondaryStructureType[rI]=type;rI++}}function assignSecondaryStructureRanges(model){var map=collections_1.FastMap.create();extendSecondaryStructureMap(model.data.secondaryStructure.structConf,1,map);extendSecondaryStructureMap(model.data.secondaryStructure.sheetRange,2,map);var _a=model.chains,residueOffset=_a.residueOffset,chainCount=_a.count;var atomOffset=model.residues.atomOffset;var dataIndex=model.atoms.dataIndex;var _b=model.data.atom_site,label_asym_id=_b.label_asym_id,label_seq_id=_b.label_seq_id,pdbx_PDB_ins_code=_b.pdbx_PDB_ins_code;for(var cI=0;cI<chainCount;cI++){var resStart=residueOffset[cI],resEnd=residueOffset[cI+1];var asymId=label_asym_id.getString(dataIndex[atomOffset[resStart]]);if(map.has(asymId)){var entries=map.get(asymId);for(var rI=resStart;rI<resEnd;rI++){var atomRowIndex=dataIndex[atomOffset[rI]];var seqNumber=label_seq_id.getInteger(atomRowIndex);if(entries.has(seqNumber)){var entry=entries.get(seqNumber);var insCode=pdbx_PDB_ins_code.getString(atomRowIndex);if(entry.startInsCode!==insCode)continue;assignSecondaryStructureEntry(model,entry,rI,resEnd)}}}}}function assignSecondaryStructureKey(model){var _a=model.secondaryStructure,type=_a.type,index=_a.index,key=_a.key;var count=model.residues.count;var sheet_id=model.data.secondaryStructure.sheetRange.sheet_id;var helix_index_key=collections_1.FastMap.create();var sheet_id_key=collections_1.FastMap.create();var currentKey=1;for(var i=0;i<count;i++){switch(type[i]){case 1:{var idx=index[i];if(helix_index_key.has(idx))key[i]=helix_index_key.get(idx);else{key[i]=currentKey++;helix_index_key.set(idx,key[i])}break}case 2:{var sid=sheet_id.getString(index[i]);if(sheet_id_key.has(sid))key[i]=sheet_id_key.get(sid);else{key[i]=currentKey++;sheet_id_key.set(sid,key[i])}break}}}}function assignSecondaryStructureFlags(model){var _a=model.secondaryStructure,ssType=_a.type,ssIndex=_a.index,flags=_a.flags;var _b=model.data.secondaryStructure.structConf,pdbx_PDB_helix_class=_b.pdbx_PDB_helix_class,conf_type_id=_b.conf_type_id;for(var rI=0,_rI=model.residues.count;rI<_rI;rI++){var type=ssType[rI];var flag=268435456;switch(type){case 1:var index=ssIndex[rI];var helixClass=pdbx_PDB_helix_class.getString(index);if(helixClass!==null){flag=secondary_structure_1.SecondaryStructurePdb[helixClass]}else{var confType=conf_type_id.getString(index);if(confType!==null)flag=secondary_structure_1.SecondaryStructureMmcif[confType]}break;case 2:flag=4|4194304}flags[rI]=flag}}function assignSecondaryStructure(model){assignSecondaryStructureRanges(model);assignSecondaryStructureKey(model);assignSecondaryStructureFlags(model)}function getModResMap(model){var modRes=model.data.pdbxStructModResidue;var map=collections_1.FastMap.create();var label_asym_id=modRes.label_asym_id,label_seq_id=modRes.label_seq_id;for(var i=0;i<modRes.rowCount;i++){var asymId=label_asym_id.getString(i),seqId=label_seq_id.getInteger(i);if(map.has(asymId)){map.get(asymId).set(seqId,i)}else{map.set(asymId,collections_1.FastMap.ofArray([[seqId,i]]))}}return map}function assignModifiedResidues(model){var modRes=model.data.pdbxStructModResidue;if(!modRes.rowCount)return model;var map=getModResMap(model);var modResEntries=model.modifiedResidues;var _a=model.chains,residueOffset=_a.residueOffset,chainCount=_a.count;var atomOffset=model.residues.atomOffset;var dataIndex=model.atoms.dataIndex;var _b=model.data.atom_site,label_asym_id=_b.label_asym_id,label_seq_id=_b.label_seq_id,pdbx_PDB_ins_code=_b.pdbx_PDB_ins_code;var modResInsCode=modRes.PDB_ins_code;for(var cI=0;cI<chainCount;cI++){var resStart=residueOffset[cI],resEnd=residueOffset[cI+1];var asymId=label_asym_id.getString(dataIndex[atomOffset[resStart]]);if(map.has(asymId)){var entries=map.get(asymId);for(var rI=resStart;rI<resEnd;rI++){var atomRowIndex=dataIndex[atomOffset[rI]];var seqNumber=label_seq_id.getInteger(atomRowIndex);if(entries.has(seqNumber)){var entry=entries.get(seqNumber);if(pdbx_PDB_ins_code.getString(atomRowIndex)!==modResInsCode.getString(entry))continue;modResEntries.set(rI,entry)}}}}return map}function parseCIF(cifData){var file=ciftools_js_1.default.Text.parse(cifData);if(file.isError)throw new Error(file.toString());var dataBlock=file.result.dataBlocks[0];if(!dataBlock)throw new Error("No data block found.");var data={atom_site:mmCIF.Category(dataBlock.getCategory("_atom_site"),mmCIF.AtomSite),entity:mmCIF.Category(dataBlock.getCategory("_entity"),mmCIF.Entity),bonds:{chemCompBond:mmCIF.Category(dataBlock.getCategory("_chem_comp_bond"),mmCIF.ChemCompBond),structConn:mmCIF.Category(dataBlock.getCategory("_struct_conn"),mmCIF.StructConn)},secondaryStructure:{structConf:mmCIF.Category(dataBlock.getCategory("_struct_conf"),mmCIF.StructConf),sheetRange:mmCIF.Category(dataBlock.getCategory("_struct_sheet_range"),mmCIF.StructSheetRange)},pdbxStructModResidue:mmCIF.Category(dataBlock.getCategory("_pdbx_struct_mod_residue"),mmCIF.PDBxStructModResidue)};var models=[];var modelStartIndex=0;while(modelStartIndex<data.atom_site.rowCount){var model=createModel(dataBlock.header,data,modelStartIndex,data.atom_site.rowCount);assignKeysAndDataIndices(model);assignSecondaryStructure(model);assignModifiedResidues(model);models.push(model);modelStartIndex+=model.atoms.count}return{id:dataBlock.header,models:models}}exports.default=parseCIF},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;var __CIFTools=function(){"use strict";var CIFTools;(function(CIFTools){CIFTools.VERSION={number:"1.1.6",date:"June 26 2017"}})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Utils;(function(Utils){var ChunkedArray;(function(ChunkedArray){function is(x){return x.creator&&x.chunkSize}ChunkedArray.is=is;function add4(array,x,y,z,w){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;array.current[array.currentIndex++]=z;array.current[array.currentIndex++]=w;return array.elementCount++}ChunkedArray.add4=add4;function add3(array,x,y,z){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;array.current[array.currentIndex++]=z;return array.elementCount++}ChunkedArray.add3=add3;function add2(array,x,y){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;array.current[array.currentIndex++]=y;return array.elementCount++}ChunkedArray.add2=add2;function add(array,x){if(array.currentIndex>=array.chunkSize){array.currentIndex=0;array.current=array.creator(array.chunkSize);array.parts[array.parts.length]=array.current}array.current[array.currentIndex++]=x;return array.elementCount++}ChunkedArray.add=add;function compact(array){var ret=array.creator(array.elementSize*array.elementCount),offset=(array.parts.length-1)*array.chunkSize,offsetInner=0,part;if(array.parts.length>1){if(array.parts[0].buffer){for(var i=0;i<array.parts.length-1;i++){ret.set(array.parts[i],array.chunkSize*i)}}else{for(var i=0;i<array.parts.length-1;i++){offsetInner=array.chunkSize*i;part=array.parts[i];for(var j=0;j<array.chunkSize;j++){ret[offsetInner+j]=part[j]}}}}if(array.current.buffer&&array.currentIndex>=array.chunkSize){ret.set(array.current,array.chunkSize*(array.parts.length-1))}else{for(var i=0;i<array.currentIndex;i++){ret[offset+i]=array.current[i]}}return ret}ChunkedArray.compact=compact;function forVertex3D(chunkVertexCount){if(chunkVertexCount===void 0){chunkVertexCount=262144}return create(function(size){return new Float32Array(size)},chunkVertexCount,3)}ChunkedArray.forVertex3D=forVertex3D;function forIndexBuffer(chunkIndexCount){if(chunkIndexCount===void 0){chunkIndexCount=262144}return create(function(size){return new Uint32Array(size)},chunkIndexCount,3)}ChunkedArray.forIndexBuffer=forIndexBuffer;function forTokenIndices(chunkTokenCount){if(chunkTokenCount===void 0){chunkTokenCount=131072}return create(function(size){return new Int32Array(size)},chunkTokenCount,2)}ChunkedArray.forTokenIndices=forTokenIndices;function forIndices(chunkTokenCount){if(chunkTokenCount===void 0){chunkTokenCount=131072}return create(function(size){return new Int32Array(size)},chunkTokenCount,1)}ChunkedArray.forIndices=forIndices;function forInt32(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return new Int32Array(size)},chunkSize,1)}ChunkedArray.forInt32=forInt32;function forFloat32(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return new Float32Array(size)},chunkSize,1)}ChunkedArray.forFloat32=forFloat32;function forArray(chunkSize){if(chunkSize===void 0){chunkSize=131072}return create(function(size){return[]},chunkSize,1)}ChunkedArray.forArray=forArray;function create(creator,chunkElementCount,elementSize){chunkElementCount=chunkElementCount|0;if(chunkElementCount<=0)chunkElementCount=1;var chunkSize=chunkElementCount*elementSize;var current=creator(chunkSize);return{elementSize:elementSize,chunkSize:chunkSize,creator:creator,current:current,parts:[current],currentIndex:0,elementCount:0}}ChunkedArray.create=create})(ChunkedArray=Utils.ChunkedArray||(Utils.ChunkedArray={}))})(Utils=CIFTools.Utils||(CIFTools.Utils={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Utils;(function(Utils){var FastNumberParsers;(function(FastNumberParsers){"use strict";function parseIntSkipTrailingWhitespace(str,start,end){while(start<end&&str.charCodeAt(start)===32)start++;return parseInt(str,start,end)}FastNumberParsers.parseIntSkipTrailingWhitespace=parseIntSkipTrailingWhitespace;function parseInt(str,start,end){var ret=0,neg=1;if(str.charCodeAt(start)===45){neg=-1;start++}for(;start<end;start++){var c=str.charCodeAt(start)-48;if(c>9||c<0)return neg*ret|0;else ret=10*ret+c|0}return neg*ret}FastNumberParsers.parseInt=parseInt;function parseScientific(main,str,start,end){if(str.charCodeAt(start)===43)start++;return main*Math.pow(10,parseInt(str,start,end))}function parseFloatSkipTrailingWhitespace(str,start,end){while(start<end&&str.charCodeAt(start)===32)start++;return parseFloat(str,start,end)}FastNumberParsers.parseFloatSkipTrailingWhitespace=parseFloatSkipTrailingWhitespace;function parseFloat(str,start,end){var neg=1,ret=0,point=0,div=1;if(str.charCodeAt(start)===45){neg=-1;++start}while(start<end){var c=str.charCodeAt(start)-48;if(c>=0&&c<10){ret=ret*10+c;++start}else if(c===-2){++start;while(start<end){c=str.charCodeAt(start)-48;if(c>=0&&c<10){point=10*point+c;div=10*div;++start}else if(c===53||c===21){return parseScientific(neg*(ret+point/div),str,start+1,end)}else{return neg*(ret+point/div)}}return neg*(ret+point/div)}else if(c===53||c===21){return parseScientific(neg*ret,str,start+1,end)}else break}return neg*ret}FastNumberParsers.parseFloat=parseFloat})(FastNumberParsers=Utils.FastNumberParsers||(Utils.FastNumberParsers={}))})(Utils=CIFTools.Utils||(CIFTools.Utils={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Utils;(function(Utils){var __paddingSpaces=[];(function(){var s="";for(var i=0;i<512;i++){__paddingSpaces[i]=s;s=s+" "}})();var StringWriter;(function(StringWriter){function create(chunkCapacity){if(chunkCapacity===void 0){chunkCapacity=512}return{chunkData:[],chunkOffset:0,chunkCapacity:chunkCapacity,data:[]}}StringWriter.create=create;function asString(writer){if(!writer.data.length){if(writer.chunkData.length===writer.chunkOffset)return writer.chunkData.join("");return writer.chunkData.splice(0,writer.chunkOffset).join("")}if(writer.chunkOffset>0){writer.data[writer.data.length]=writer.chunkData.splice(0,writer.chunkOffset).join("")}return writer.data.join("")}StringWriter.asString=asString;function writeTo(writer,stream){finalize(writer);for(var _i=0,_a=writer.data;_i<_a.length;_i++){var s=_a[_i];stream.writeString(s)}}StringWriter.writeTo=writeTo;function finalize(writer){if(writer.chunkOffset>0){if(writer.chunkData.length===writer.chunkOffset)writer.data[writer.data.length]=writer.chunkData.join("");else writer.data[writer.data.length]=writer.chunkData.splice(0,writer.chunkOffset).join("");writer.chunkOffset=0}}function newline(writer){write(writer,"\n")}StringWriter.newline=newline;function whitespace(writer,len){write(writer,__paddingSpaces[len])}StringWriter.whitespace=whitespace;function write(writer,val){if(val===undefined||val===null){return}if(writer.chunkOffset===writer.chunkCapacity){writer.data[writer.data.length]=writer.chunkData.join("");writer.chunkOffset=0}writer.chunkData[writer.chunkOffset++]=val}StringWriter.write=write;function writeSafe(writer,val){if(writer.chunkOffset===writer.chunkCapacity){writer.data[writer.data.length]=writer.chunkData.join("");writer.chunkOffset=0}writer.chunkData[writer.chunkOffset++]=val}StringWriter.writeSafe=writeSafe;function writePadLeft(writer,val,totalWidth){if(val===undefined||val===null){write(writer,__paddingSpaces[totalWidth])}var padding=totalWidth-val.length;if(padding>0)write(writer,__paddingSpaces[padding]);write(writer,val)}StringWriter.writePadLeft=writePadLeft;function writePadRight(writer,val,totalWidth){if(val===undefined||val===null){write(writer,__paddingSpaces[totalWidth])}var padding=totalWidth-val.length;write(writer,val);if(padding>0)write(writer,__paddingSpaces[padding])}StringWriter.writePadRight=writePadRight;function writeInteger(writer,val){write(writer,""+val)}StringWriter.writeInteger=writeInteger;function writeIntegerPadLeft(writer,val,totalWidth){var s=""+val;var padding=totalWidth-s.length;if(padding>0)write(writer,__paddingSpaces[padding]);write(writer,s)}StringWriter.writeIntegerPadLeft=writeIntegerPadLeft;function writeIntegerPadRight(writer,val,totalWidth){var s=""+val;var padding=totalWidth-s.length;write(writer,s);if(padding>0)write(writer,__paddingSpaces[padding])}StringWriter.writeIntegerPadRight=writeIntegerPadRight;function writeFloat(writer,val,precisionMultiplier){write(writer,""+Math.round(precisionMultiplier*val)/precisionMultiplier)}StringWriter.writeFloat=writeFloat;function writeFloatPadLeft(writer,val,precisionMultiplier,totalWidth){var s=""+Math.round(precisionMultiplier*val)/precisionMultiplier;var padding=totalWidth-s.length;if(padding>0)write(writer,__paddingSpaces[padding]);write(writer,s)}StringWriter.writeFloatPadLeft=writeFloatPadLeft;function writeFloatPadRight(writer,val,precisionMultiplier,totalWidth){var s=""+Math.round(precisionMultiplier*val)/precisionMultiplier;var padding=totalWidth-s.length;write(writer,s);if(padding>0)write(writer,__paddingSpaces[padding])}StringWriter.writeFloatPadRight=writeFloatPadRight})(StringWriter=Utils.StringWriter||(Utils.StringWriter={}))})(Utils=CIFTools.Utils||(CIFTools.Utils={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){"use strict";var _UndefinedColumn=function(){function _UndefinedColumn(){this.isDefined=false}_UndefinedColumn.prototype.getString=function(row){return null};_UndefinedColumn.prototype.getInteger=function(row){return 0};_UndefinedColumn.prototype.getFloat=function(row){return 0};_UndefinedColumn.prototype.getValuePresence=function(row){return 1};_UndefinedColumn.prototype.areValuesEqual=function(rowA,rowB){return true};_UndefinedColumn.prototype.stringEquals=function(row,value){return value===null};return _UndefinedColumn}();CIFTools.UndefinedColumn=new _UndefinedColumn;var Category;(function(Category){function getMatrix(category,field,rows,cols,rowIndex){var ret=[];for(var i=1;i<=rows;i++){var row=[];for(var j=1;j<=cols;j++){row[j-1]=category.getColumn(field+"["+i+"]["+j+"]").getFloat(rowIndex)}ret[i-1]=row}return ret}Category.getMatrix=getMatrix;function getVector(category,field,rows,cols,rowIndex){var ret=[];for(var i=1;i<=rows;i++){ret[i-1]=category.getColumn(field+"["+i+"]").getFloat(rowIndex)}return ret}Category.getVector=getVector})(Category=CIFTools.Category||(CIFTools.Category={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){"use strict";var ParserResult;(function(ParserResult){function error(message,line){if(line===void 0){line=-1}return new ParserError(message,line)}ParserResult.error=error;function success(result,warnings){if(warnings===void 0){warnings=[]}return new ParserSuccess(result,warnings)}ParserResult.success=success})(ParserResult=CIFTools.ParserResult||(CIFTools.ParserResult={}));var ParserError=function(){function ParserError(message,line){this.message=message;this.line=line;this.isError=true}ParserError.prototype.toString=function(){if(this.line>=0){return"[Line "+this.line+"] "+this.message}return this.message};return ParserError}();CIFTools.ParserError=ParserError;var ParserSuccess=function(){function ParserSuccess(result,warnings){this.result=result;this.warnings=warnings;this.isError=false}return ParserSuccess}();CIFTools.ParserSuccess=ParserSuccess})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Text;(function(Text){"use strict";var ShortStringPool;(function(ShortStringPool){function create(){return Object.create(null)}ShortStringPool.create=create;function get(pool,str){if(str.length>6)return str;var value=pool[str];if(value!==void 0)return value;pool[str]=str;return str}ShortStringPool.get=get})(ShortStringPool||(ShortStringPool={}));var File=function(){function File(data){this.dataBlocks=[];this.data=data}File.prototype.toJSON=function(){return this.dataBlocks.map(function(b){return b.toJSON()})};return File}();Text.File=File;var DataBlock=function(){function DataBlock(data,header){this.header=header;this.data=data;this.categoryList=[];this.additionalData={};this.categoryMap=new Map}Object.defineProperty(DataBlock.prototype,"categories",{get:function(){return this.categoryList},enumerable:true,configurable:true});DataBlock.prototype.getCategory=function(name){return this.categoryMap.get(name)};DataBlock.prototype.addCategory=function(category){this.categoryList[this.categoryList.length]=category;this.categoryMap.set(category.name,category)};DataBlock.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(c){return c.toJSON()}),additionalData:this.additionalData}};return DataBlock}();Text.DataBlock=DataBlock;var Category=function(){function Category(data,name,startIndex,endIndex,columns,tokens,tokenCount){this.name=name;this.tokens=tokens;this.data=data;this.startIndex=startIndex;this.endIndex=endIndex;this.columnCount=columns.length;this.rowCount=tokenCount/columns.length|0;this.columnIndices=new Map;this.columnNameList=[];for(var i=0;i<columns.length;i++){var colName=columns[i].substr(name.length+1);this.columnIndices.set(colName,i);this.columnNameList.push(colName)}}Object.defineProperty(Category.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:true,configurable:true});Category.prototype.getColumn=function(name){var i=this.columnIndices.get(name);if(i!==void 0)return new Column(this,this.data,name,i);return CIFTools.UndefinedColumn};Category.prototype.toJSON=function(){var rows=[],data=this.data,tokens=this.tokens;var colNames=this.columnNameList;var strings=ShortStringPool.create();for(var i=0;i<this.rowCount;i++){var item={};for(var j=0;j<this.columnCount;j++){var tk=(i*this.columnCount+j)*2;item[colNames[j]]=ShortStringPool.get(strings,data.substring(tokens[tk],tokens[tk+1]))}rows[i]=item}return{name:this.name,columns:colNames,rows:rows}};return Category}();Text.Category=Category;var fastParseInt=CIFTools.Utils.FastNumberParsers.parseInt;var fastParseFloat=CIFTools.Utils.FastNumberParsers.parseFloat;var Column=function(){function Column(category,data,name,index){this.data=data;this.name=name;this.index=index;this.stringPool=ShortStringPool.create();this.isDefined=true;this.tokens=category.tokens;this.columnCount=category.columnCount}Column.prototype.getString=function(row){var i=(row*this.columnCount+this.index)*2;var ret=ShortStringPool.get(this.stringPool,this.data.substring(this.tokens[i],this.tokens[i+1]));if(ret==="."||ret==="?")return null;return ret};Column.prototype.getInteger=function(row){var i=(row*this.columnCount+this.index)*2;return fastParseInt(this.data,this.tokens[i],this.tokens[i+1])};Column.prototype.getFloat=function(row){var i=(row*this.columnCount+this.index)*2;return fastParseFloat(this.data,this.tokens[i],this.tokens[i+1])};Column.prototype.stringEquals=function(row,value){var aIndex=(row*this.columnCount+this.index)*2,s=this.tokens[aIndex],len=value.length;if(len!==this.tokens[aIndex+1]-s)return false;for(var i=0;i<len;i++){if(this.data.charCodeAt(i+s)!==value.charCodeAt(i))return false}return true};Column.prototype.areValuesEqual=function(rowA,rowB){var aIndex=(rowA*this.columnCount+this.index)*2,bIndex=(rowB*this.columnCount+this.index)*2;var aS=this.tokens[aIndex],bS=this.tokens[bIndex],len=this.tokens[aIndex+1]-aS;if(len!==this.tokens[bIndex+1]-bS)return false;for(var i=0;i<len;i++){if(this.data.charCodeAt(i+aS)!==this.data.charCodeAt(i+bS)){return false}}return true};Column.prototype.getValuePresence=function(row){var index=row*this.columnCount+this.index;var s=this.tokens[2*index];if(this.tokens[2*index+1]-s!==1)return 0;var v=this.data.charCodeAt(s);if(v===46)return 1;if(v===63)return 2;return 0};return Column}();Text.Column=Column})(Text=CIFTools.Text||(CIFTools.Text={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Text;(function(Text){"use strict";var TokenIndexBuilder;(function(TokenIndexBuilder){function resize(builder){var newBuffer=new Int32Array(1.61*builder.tokens.length|0);newBuffer.set(builder.tokens);builder.tokens=newBuffer;builder.tokensLenMinus2=newBuffer.length-2|0}function addToken(builder,start,end){if(builder.count>=builder.tokensLenMinus2){resize(builder)}builder.tokens[builder.count++]=start;builder.tokens[builder.count++]=end}TokenIndexBuilder.addToken=addToken;function create(size){return{tokensLenMinus2:size-2|0,count:0,tokens:new Int32Array(size)}}TokenIndexBuilder.create=create})(TokenIndexBuilder||(TokenIndexBuilder={}));function eatValue(state){while(state.position<state.length){switch(state.data.charCodeAt(state.position)){case 9:case 10:case 13:case 32:state.currentTokenEnd=state.position;return;default:++state.position;break}}state.currentTokenEnd=state.position}function eatEscaped(state,esc){var next,c;++state.position;while(state.position<state.length){c=state.data.charCodeAt(state.position);if(c===esc){next=state.data.charCodeAt(state.position+1);switch(next){case 9:case 10:case 13:case 32:state.currentTokenStart++;state.currentTokenEnd=state.position;state.isEscaped=true;++state.position;return;default:if(next===void 0){state.currentTokenStart++;state.currentTokenEnd=state.position;state.isEscaped=true;++state.position;return}++state.position;break}}else{if(c===10||c===13){state.currentTokenEnd=state.position;return}++state.position}}state.currentTokenEnd=state.position}function eatMultiline(state){var prev=59,pos=state.position+1,c;while(pos<state.length){c=state.data.charCodeAt(pos);if(c===59&&(prev===10||prev===13)){state.position=pos+1;state.currentTokenStart++;pos--;c=state.data.charCodeAt(pos);while(c===10||c===13){pos--;c=state.data.charCodeAt(pos)}state.currentTokenEnd=pos+1;state.isEscaped=true;return}else{if(c===13){state.currentLineNumber++}else if(c===10&&prev!==13){state.currentLineNumber++}prev=c;++pos}}state.position=pos;return prev}function skipCommentLine(state){while(state.position<state.length){var c=state.data.charCodeAt(state.position);if(c===10||c===13){return}++state.position}}function skipWhitespace(state){var prev=10;while(state.position<state.length){var c=state.data.charCodeAt(state.position);switch(c){case 9:case 32:prev=c;++state.position;break;case 10:if(prev!==13){++state.currentLineNumber}prev=c;++state.position;break;case 13:prev=c;++state.position;++state.currentLineNumber;break;default:return prev}}return prev}function isData(state){var c=state.data.charCodeAt(state.currentTokenStart);if(c!==68&&c!==100)return false;c=state.data.charCodeAt(state.currentTokenStart+1);if(c!==65&&c!==97)return false;c=state.data.charCodeAt(state.currentTokenStart+2);if(c!==84&&c!==116)return false;c=state.data.charCodeAt(state.currentTokenStart+3);if(c!==65&&c!==97)return false;return true}function isSave(state){var c=state.data.charCodeAt(state.currentTokenStart);if(c!==83&&c!==115)return false;c=state.data.charCodeAt(state.currentTokenStart+1);if(c!==65&&c!==97)return false;c=state.data.charCodeAt(state.currentTokenStart+2);if(c!==86&&c!==118)return false;c=state.data.charCodeAt(state.currentTokenStart+3);if(c!==69&&c!==101)return false;return true}function isLoop(state){if(state.currentTokenEnd-state.currentTokenStart!==5)return false;var c=state.data.charCodeAt(state.currentTokenStart);if(c!==76&&c!==108)return false;c=state.data.charCodeAt(state.currentTokenStart+1);if(c!==79&&c!==111)return false;c=state.data.charCodeAt(state.currentTokenStart+2);if(c!==79&&c!==111)return false;c=state.data.charCodeAt(state.currentTokenStart+3);if(c!==80&&c!==112)return false;return true}function isNamespace(state,start,end){var i,nsLen=end-start,offset=state.currentTokenStart-start,tokenLen=state.currentTokenEnd-state.currentTokenStart;if(tokenLen<nsLen)return false;for(i=start;i<end;++i){if(state.data.charCodeAt(i)!==state.data.charCodeAt(i+offset))return false}if(nsLen===tokenLen)return true;if(state.data.charCodeAt(i+offset)===46){return true}return false}function getNamespaceEnd(state){var i;for(i=state.currentTokenStart;i<state.currentTokenEnd;++i){if(state.data.charCodeAt(i)===46)return i}return i}function getNamespace(state,endIndex){return state.data.substring(state.currentTokenStart,endIndex)}function getTokenString(state){return state.data.substring(state.currentTokenStart,state.currentTokenEnd)}function moveNextInternal(state){var prev=skipWhitespace(state);if(state.position>=state.length){state.currentTokenType=6;return}state.currentTokenStart=state.position;state.currentTokenEnd=state.position;state.isEscaped=false;var c=state.data.charCodeAt(state.position);switch(c){case 35:skipCommentLine(state);state.currentTokenType=5;break;case 34:case 39:eatEscaped(state,c);state.currentTokenType=3;break;case 59:if(prev===10||prev===13){eatMultiline(state)}else{eatValue(state)}state.currentTokenType=3;break;default:eatValue(state);if(state.isEscaped){state.currentTokenType=3}else if(state.data.charCodeAt(state.currentTokenStart)===95){state.currentTokenType=4}else if(state.currentTokenEnd-state.currentTokenStart>=5&&state.data.charCodeAt(state.currentTokenStart+4)===95){if(isData(state))state.currentTokenType=0;else if(isSave(state))state.currentTokenType=1;else if(isLoop(state))state.currentTokenType=2;else state.currentTokenType=3}else{state.currentTokenType=3}break}}function moveNext(state){moveNextInternal(state);while(state.currentTokenType===5)moveNextInternal(state)}function createTokenizer(data){return{data:data,length:data.length,position:0,currentTokenStart:0,currentTokenEnd:0,currentTokenType:6,currentLineNumber:1,isEscaped:false}}function handleSingle(tokenizer,block){var nsStart=tokenizer.currentTokenStart,nsEnd=getNamespaceEnd(tokenizer),name=getNamespace(tokenizer,nsEnd),column,columns=[],tokens=TokenIndexBuilder.create(512),tokenCount=0,readingNames=true;while(readingNames){if(tokenizer.currentTokenType!==4||!isNamespace(tokenizer,nsStart,nsEnd)){readingNames=false;break}column=getTokenString(tokenizer);moveNext(tokenizer);if(tokenizer.currentTokenType!==3){return{hasError:true,errorLine:tokenizer.currentLineNumber,errorMessage:"Expected value."}}columns[columns.length]=column;TokenIndexBuilder.addToken(tokens,tokenizer.currentTokenStart,tokenizer.currentTokenEnd);tokenCount++;moveNext(tokenizer)}block.addCategory(new Text.Category(block.data,name,nsStart,tokenizer.currentTokenStart,columns,tokens.tokens,tokenCount));return{hasError:false,errorLine:0,errorMessage:""}}function handleLoop(tokenizer,block){var start=tokenizer.currentTokenStart,loopLine=tokenizer.currentLineNumber;moveNext(tokenizer);var name=getNamespace(tokenizer,getNamespaceEnd(tokenizer)),columns=[],tokens=TokenIndexBuilder.create(name==="_atom_site"?block.data.length/1.85|0:1024),tokenCount=0;while(tokenizer.currentTokenType===4){columns[columns.length]=getTokenString(tokenizer);moveNext(tokenizer)}while(tokenizer.currentTokenType===3){TokenIndexBuilder.addToken(tokens,tokenizer.currentTokenStart,tokenizer.currentTokenEnd);tokenCount++;moveNext(tokenizer)}if(tokenCount%columns.length!==0){return{hasError:true,errorLine:tokenizer.currentLineNumber,errorMessage:"The number of values for loop starting at line "+loopLine+" is not a multiple of the number of columns."}}block.addCategory(new Text.Category(block.data,name,start,tokenizer.currentTokenStart,columns,tokens.tokens,tokenCount));return{hasError:false,errorLine:0,errorMessage:""}}function error(line,message){return CIFTools.ParserResult.error(message,line)}function result(data){return CIFTools.ParserResult.success(data)}function parseInternal(data){var tokenizer=createTokenizer(data),cat,id,file=new Text.File(data),block=new Text.DataBlock(data,"default"),saveFrame=new Text.DataBlock(data,"empty"),inSaveFrame=false,blockSaveFrames;moveNext(tokenizer);while(tokenizer.currentTokenType!==6){var token=tokenizer.currentTokenType;if(token===0){if(inSaveFrame){return error(tokenizer.currentLineNumber,"Unexpected data block inside a save frame.")}if(block.categories.length>0){file.dataBlocks.push(block)}block=new Text.DataBlock(data,data.substring(tokenizer.currentTokenStart+5,tokenizer.currentTokenEnd));moveNext(tokenizer)}else if(token===1){id=data.substring(tokenizer.currentTokenStart+5,tokenizer.currentTokenEnd);if(id.length===0){if(saveFrame.categories.length>0){blockSaveFrames=block.additionalData["saveFrames"];if(!blockSaveFrames){blockSaveFrames=[];block.additionalData["saveFrames"]=blockSaveFrames}blockSaveFrames[blockSaveFrames.length]=saveFrame}inSaveFrame=false}else{if(inSaveFrame){return error(tokenizer.currentLineNumber,"Save frames cannot be nested.")}inSaveFrame=true;saveFrame=new Text.DataBlock(data,id)}moveNext(tokenizer)}else if(token===2){cat=handleLoop(tokenizer,inSaveFrame?saveFrame:block);if(cat.hasError){return error(cat.errorLine,cat.errorMessage)}}else if(token===4){cat=handleSingle(tokenizer,inSaveFrame?saveFrame:block);if(cat.hasError){return error(cat.errorLine,cat.errorMessage)}}else{return error(tokenizer.currentLineNumber,"Unexpected token. Expected data_, loop_, or data name.")}}if(inSaveFrame){return error(tokenizer.currentLineNumber,"Unfinished save frame (`"+saveFrame.header+"`).")}if(block.categories.length>0){file.dataBlocks.push(block)}return result(file)}function parse(data){return parseInternal(data)}Text.parse=parse})(Text=CIFTools.Text||(CIFTools.Text={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Text;(function(Text){"use strict";var StringWriter=CIFTools.Utils.StringWriter;var Writer=function(){function Writer(){this.writer=StringWriter.create();this.encoded=false;this.dataBlockCreated=false}Writer.prototype.startDataBlock=function(header){this.dataBlockCreated=true;StringWriter.write(this.writer,"data_"+(header||"").replace(/[ \n\t]/g,"").toUpperCase()+"\n#\n")};Writer.prototype.writeCategory=function(category,contexts){if(this.encoded){throw new Error("The writer contents have already been encoded, no more writing.")}if(!this.dataBlockCreated){throw new Error("No data block created.")}var src=!contexts||!contexts.length?[category(void 0)]:contexts.map(function(c){return category(c)});var data=src.filter(function(c){return c&&c.count>0});if(!data.length)return;var count=data.reduce(function(a,c){return a+(c.count===void 0?1:c.count)},0);if(!count)return;else if(count===1){writeCifSingleRecord(data[0],this.writer)}else{writeCifLoop(data,this.writer)}};Writer.prototype.encode=function(){this.encoded=true};Writer.prototype.flush=function(stream){StringWriter.writeTo(this.writer,stream)};return Writer}();Text.Writer=Writer;function isMultiline(value){return!!value&&value.indexOf("\n")>=0}function writeCifSingleRecord(category,writer){var fields=category.desc.fields;var data=category.data;var width=fields.reduce(function(w,s){return Math.max(w,s.name.length)},0)+category.desc.name.length+5;for(var _i=0,fields_1=fields;_i<fields_1.length;_i++){var f=fields_1[_i];StringWriter.writePadRight(writer,category.desc.name+"."+f.name,width);var presence=f.presence;var p=presence?presence(data,0):0;if(p!==0){if(p===1)writeNotSpecified(writer);else writeUnknown(writer)}else{var val=f.string(data,0);if(isMultiline(val)){writeMultiline(writer,val);StringWriter.newline(writer)}else{writeChecked(writer,val)}}StringWriter.newline(writer)}StringWriter.write(writer,"#\n")}function writeCifLoop(categories,writer){writeLine(writer,"loop_");var first=categories[0];var fields=first.desc.fields;for(var _i=0,fields_2=fields;_i<fields_2.length;_i++){var f=fields_2[_i];writeLine(writer,first.desc.name+"."+f.name)}for(var _a=0,categories_1=categories;_a<categories_1.length;_a++){var category=categories_1[_a];var data=category.data;var count=category.count;for(var i=0;i<count;i++){for(var _b=0,fields_3=fields;_b<fields_3.length;_b++){var f=fields_3[_b];var presence=f.presence;var p=presence?presence(data,i):0;if(p!==0){if(p===1)writeNotSpecified(writer);else writeUnknown(writer)}else{var val=f.string(data,i);if(isMultiline(val)){writeMultiline(writer,val);StringWriter.newline(writer)}else{writeChecked(writer,val)}}}StringWriter.newline(writer)}}StringWriter.write(writer,"#\n")}function writeLine(writer,val){StringWriter.write(writer,val);StringWriter.newline(writer)}function writeInteger(writer,val){StringWriter.writeSafe(writer,""+val+" ")}function writeFloat(writer,val,precisionMultiplier){StringWriter.writeSafe(writer,""+Math.round(precisionMultiplier*val)/precisionMultiplier+" ")}function writeNotSpecified(writer){StringWriter.writeSafe(writer,". ")}function writeUnknown(writer){StringWriter.writeSafe(writer,"? ")}function writeChecked(writer,val){if(!val){StringWriter.writeSafe(writer,". ");return}var escape=false,escapeCharStart="'",escapeCharEnd="' ";var hasWhitespace=false;var hasSingle=false;var hasDouble=false;for(var i=0,_l=val.length-1;i<_l;i++){var c=val.charCodeAt(i);switch(c){case 9:hasWhitespace=true;break;case 10:StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ");return;case 32:hasWhitespace=true;break;case 34:if(hasSingle){StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ");return}hasDouble=true;escape=true;escapeCharStart="'";escapeCharEnd="' ";break;case 39:if(hasDouble){StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ");return}escape=true;hasSingle=true;escapeCharStart='"';escapeCharEnd='" ';break}}var fst=val.charCodeAt(0);if(!escape&&(fst===35||fst===59||hasWhitespace)){escapeCharStart="'";escapeCharEnd="' ";escape=true}if(escape){StringWriter.writeSafe(writer,escapeCharStart+val+escapeCharEnd)}else{StringWriter.write(writer,val);StringWriter.writeSafe(writer," ")}}function writeMultiline(writer,val){StringWriter.writeSafe(writer,"\n;"+val);StringWriter.writeSafe(writer,"\n; ")}function writeToken(writer,data,start,end){var escape=false,escapeCharStart="'",escapeCharEnd="' ";for(var i=start;i<end-1;i++){var c=data.charCodeAt(i);switch(c){case 10:StringWriter.writeSafe(writer,"\n;"+data.substring(start,end));StringWriter.writeSafe(writer,"\n; ");return;case 34:escape=true;escapeCharStart="'";escapeCharEnd="' ";break;case 39:escape=true;escapeCharStart='"';escapeCharEnd='" ';break}}if(!escape&&data.charCodeAt(start)===59){escapeCharStart="'";escapeCharEnd="' ";escape=true}if(escape){StringWriter.writeSafe(writer,escapeCharStart+data.substring(start,end));StringWriter.writeSafe(writer,escapeCharStart)}else{StringWriter.write(writer,data.substring(start,end));StringWriter.writeSafe(writer," ")}}})(Text=CIFTools.Text||(CIFTools.Text={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){var MessagePack;(function(MessagePack){function map(state,length){var value={};for(var i=0;i<length;i++){var key=parse(state);value[key]=parse(state)}return value}function bin(state,length){var value=new Uint8Array(length);var o=state.offset;for(var i=0;i<length;i++)value[i]=state.buffer[i+o];state.offset+=length;return value}function str(state,length){var value=MessagePack.utf8Read(state.buffer,state.offset,length);state.offset+=length;return value}function array(state,length){var value=new Array(length);for(var i=0;i<length;i++){value[i]=parse(state)}return value}function parse(state){var type=state.buffer[state.offset];var value,length;if((type&128)===0){state.offset++;return type}if((type&240)===128){length=type&15;state.offset++;return map(state,length)}if((type&240)===144){length=type&15;state.offset++;return array(state,length)}if((type&224)===160){length=type&31;state.offset++;return str(state,length)}if((type&224)===224){value=state.dataView.getInt8(state.offset);state.offset++;return value}switch(type){case 192:state.offset++;return null;case 194:state.offset++;return false;case 195:state.offset++;return true;case 196:length=state.dataView.getUint8(state.offset+1);state.offset+=2;return bin(state,length);case 197:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return bin(state,length);case 198:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return bin(state,length);case 202:value=state.dataView.getFloat32(state.offset+1);state.offset+=5;return value;case 203:value=state.dataView.getFloat64(state.offset+1);state.offset+=9;return value;case 204:value=state.buffer[state.offset+1];state.offset+=2;return value;case 205:value=state.dataView.getUint16(state.offset+1);state.offset+=3;return value;case 206:value=state.dataView.getUint32(state.offset+1);state.offset+=5;return value;case 208:value=state.dataView.getInt8(state.offset+1);state.offset+=2;return value;case 209:value=state.dataView.getInt16(state.offset+1);state.offset+=3;return value;case 210:value=state.dataView.getInt32(state.offset+1);state.offset+=5;return value;case 217:length=state.dataView.getUint8(state.offset+1);state.offset+=2;return str(state,length);case 218:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return str(state,length);case 219:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return str(state,length);case 220:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return array(state,length);case 221:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return array(state,length);case 222:length=state.dataView.getUint16(state.offset+1);state.offset+=3;return map(state,length);case 223:length=state.dataView.getUint32(state.offset+1);state.offset+=5;return map(state,length)}throw new Error("Unknown type 0x"+type.toString(16))}function decode(buffer){return parse({buffer:buffer,offset:0,dataView:new DataView(buffer.buffer)})}MessagePack.decode=decode})(MessagePack=Binary.MessagePack||(Binary.MessagePack={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){var MessagePack;(function(MessagePack){function encode(value){var buffer=new ArrayBuffer(encodedSize(value));var view=new DataView(buffer);var bytes=new Uint8Array(buffer);encodeInternal(value,view,bytes,0);return bytes}MessagePack.encode=encode;function encodedSize(value){var type=typeof value;if(type==="string"){var length_1=MessagePack.utf8ByteCount(value);if(length_1<32){return 1+length_1}if(length_1<256){return 2+length_1}if(length_1<65536){return 3+length_1}if(length_1<4294967296){return 5+length_1}}if(value instanceof Uint8Array){var length_2=value.byteLength;if(length_2<256){return 2+length_2}if(length_2<65536){return 3+length_2}if(length_2<4294967296){return 5+length_2}}if(type==="number"){if(Math.floor(value)!==value)return 9;if(value>=0){if(value<128)return 1;if(value<256)return 2;if(value<65536)return 3;if(value<4294967296)return 5;throw new Error("Number too big 0x"+value.toString(16))}if(value>=-32)return 1;if(value>=-128)return 2;if(value>=-32768)return 3;if(value>=-2147483648)return 5;throw new Error("Number too small -0x"+value.toString(16).substr(1))}if(type==="boolean"||value===null||value===void 0)return 1;if(type==="object"){var length_3,size=0;if(Array.isArray(value)){length_3=value.length;for(var i=0;i<length_3;i++){size+=encodedSize(value[i])}}else{var keys=Object.keys(value);length_3=keys.length;for(var i=0;i<length_3;i++){var key=keys[i];size+=encodedSize(key)+encodedSize(value[key])}}if(length_3<16){return 1+size}if(length_3<65536){return 3+size}if(length_3<4294967296){return 5+size}throw new Error("Array or object too long 0x"+length_3.toString(16))}throw new Error("Unknown type "+type)}function encodeInternal(value,view,bytes,offset){var type=typeof value;if(type==="string"){var length_4=MessagePack.utf8ByteCount(value);if(length_4<32){view.setUint8(offset,length_4|160);MessagePack.utf8Write(bytes,offset+1,value);return 1+length_4}if(length_4<256){view.setUint8(offset,217);view.setUint8(offset+1,length_4);MessagePack.utf8Write(bytes,offset+2,value);return 2+length_4}if(length_4<65536){view.setUint8(offset,218);view.setUint16(offset+1,length_4);MessagePack.utf8Write(bytes,offset+3,value);return 3+length_4}if(length_4<4294967296){view.setUint8(offset,219);view.setUint32(offset+1,length_4);MessagePack.utf8Write(bytes,offset+5,value);return 5+length_4}}if(value instanceof Uint8Array){var length_5=value.byteLength;var bytes_1=new Uint8Array(view.buffer);if(length_5<256){view.setUint8(offset,196);view.setUint8(offset+1,length_5);bytes_1.set(value,offset+2);return 2+length_5}if(length_5<65536){view.setUint8(offset,197);view.setUint16(offset+1,length_5);bytes_1.set(value,offset+3);return 3+length_5}if(length_5<4294967296){view.setUint8(offset,198);view.setUint32(offset+1,length_5);bytes_1.set(value,offset+5);return 5+length_5}}if(type==="number"){if(!isFinite(value)){throw new Error("Number not finite: "+value)}if(Math.floor(value)!==value){view.setUint8(offset,203);view.setFloat64(offset+1,value);return 9}if(value>=0){if(value<128){view.setUint8(offset,value);return 1}if(value<256){view.setUint8(offset,204);view.setUint8(offset+1,value);return 2}if(value<65536){view.setUint8(offset,205);view.setUint16(offset+1,value);return 3}if(value<4294967296){view.setUint8(offset,206);view.setUint32(offset+1,value);return 5}throw new Error("Number too big 0x"+value.toString(16))}if(value>=-32){view.setInt8(offset,value);return 1}if(value>=-128){view.setUint8(offset,208);view.setInt8(offset+1,value);return 2}if(value>=-32768){view.setUint8(offset,209);view.setInt16(offset+1,value);return 3}if(value>=-2147483648){view.setUint8(offset,210);view.setInt32(offset+1,value);return 5}throw new Error("Number too small -0x"+(-value).toString(16).substr(1))}if(value===null||value===undefined){view.setUint8(offset,192);return 1}if(type==="boolean"){view.setUint8(offset,value?195:194);return 1}if(type==="object"){var length_6,size=0;var isArray=Array.isArray(value);var keys=void 0;if(isArray){length_6=value.length}else{keys=Object.keys(value);length_6=keys.length}if(length_6<16){view.setUint8(offset,length_6|(isArray?144:128));size=1}else if(length_6<65536){view.setUint8(offset,isArray?220:222);view.setUint16(offset+1,length_6);size=3}else if(length_6<4294967296){view.setUint8(offset,isArray?221:223);view.setUint32(offset+1,length_6);size=5}if(isArray){for(var i=0;i<length_6;i++){size+=encodeInternal(value[i],view,bytes,offset+size)}}else{for(var _i=0,_a=keys;_i<_a.length;_i++){var key=_a[_i];size+=encodeInternal(key,view,bytes,offset+size);size+=encodeInternal(value[key],view,bytes,offset+size)}}return size}throw new Error("Unknown type "+type)}})(MessagePack=Binary.MessagePack||(Binary.MessagePack={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){var MessagePack;(function(MessagePack){function utf8Write(data,offset,str){var byteLength=data.byteLength;for(var i=0,l=str.length;i<l;i++){var codePoint=str.charCodeAt(i);if(codePoint<128){data[offset++]=codePoint>>>0&127|0;continue}if(codePoint<2048){data[offset++]=codePoint>>>6&31|192;data[offset++]=codePoint>>>0&63|128;continue}if(codePoint<65536){data[offset++]=codePoint>>>12&15|224;data[offset++]=codePoint>>>6&63|128;data[offset++]=codePoint>>>0&63|128;continue}if(codePoint<1114112){data[offset++]=codePoint>>>18&7|240;data[offset++]=codePoint>>>12&63|128;data[offset++]=codePoint>>>6&63|128;data[offset++]=codePoint>>>0&63|128;continue}throw new Error("bad codepoint "+codePoint)}}MessagePack.utf8Write=utf8Write;var __chars=function(){var data=[];for(var i=0;i<1024;i++)data[i]=String.fromCharCode(i);return data}();function throwError(err){throw new Error(err)}function utf8Read(data,offset,length){var chars=__chars;var str=void 0,chunk=[],chunkSize=512,chunkOffset=0;for(var i=offset,end=offset+length;i<end;i++){var byte=data[i];if((byte&128)===0){chunk[chunkOffset++]=chars[byte]}else if((byte&224)===192){chunk[chunkOffset++]=chars[(byte&15)<<6|data[++i]&63]}else if((byte&240)===224){chunk[chunkOffset++]=String.fromCharCode((byte&15)<<12|(data[++i]&63)<<6|(data[++i]&63)<<0)}else if((byte&248)===240){chunk[chunkOffset++]=String.fromCharCode((byte&7)<<18|(data[++i]&63)<<12|(data[++i]&63)<<6|(data[++i]&63)<<0)}else throwError("Invalid byte "+byte.toString(16));if(chunkOffset===chunkSize){str=str||[];str[str.length]=chunk.join("");chunkOffset=0}}if(!str)return chunk.slice(0,chunkOffset).join("");if(chunkOffset>0){str[str.length]=chunk.slice(0,chunkOffset).join("")}return str.join("")}MessagePack.utf8Read=utf8Read;function utf8ByteCount(str){var count=0;for(var i=0,l=str.length;i<l;i++){var codePoint=str.charCodeAt(i);if(codePoint<128){count+=1;continue}if(codePoint<2048){count+=2;continue}if(codePoint<65536){count+=3;continue}if(codePoint<1114112){count+=4;continue}throwError("bad codepoint "+codePoint)}return count}MessagePack.utf8ByteCount=utf8ByteCount})(MessagePack=Binary.MessagePack||(Binary.MessagePack={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";function decode(data){var current=data.data;for(var i=data.encoding.length-1;i>=0;i--){current=Decoder.decodeStep(current,data.encoding[i])}return current}Binary.decode=decode;var Decoder;(function(Decoder){function decodeStep(data,encoding){switch(encoding.kind){case"ByteArray":{switch(encoding.type){case 4:return data;case 1:return int8(data);case 2:return int16(data);case 5:return uint16(data);case 3:return int32(data);case 6:return uint32(data);case 32:return float32(data);case 33:return float64(data);default:throw new Error("Unsupported ByteArray type.")}}case"FixedPoint":return fixedPoint(data,encoding);case"IntervalQuantization":return intervalQuantization(data,encoding);case"RunLength":return runLength(data,encoding);case"Delta":return delta(data,encoding);case"IntegerPacking":return integerPacking(data,encoding);case"StringArray":return stringArray(data,encoding)}}Decoder.decodeStep=decodeStep;function getIntArray(type,size){switch(type){case 1:return new Int8Array(size);case 2:return new Int16Array(size);case 3:return new Int32Array(size);case 4:return new Uint8Array(size);case 5:return new Uint16Array(size);case 6:return new Uint32Array(size);default:throw new Error("Unsupported integer data type.")}}function getFloatArray(type,size){switch(type){case 32:return new Float32Array(size);case 33:return new Float64Array(size);default:throw new Error("Unsupported floating data type.")}}var isLittleEndian=function(){var arrayBuffer=new ArrayBuffer(2);var uint8Array=new Uint8Array(arrayBuffer);var uint16array=new Uint16Array(arrayBuffer);uint8Array[0]=170;uint8Array[1]=187;if(uint16array[0]===48042)return true;return false}();function int8(data){return new Int8Array(data.buffer,data.byteOffset)}function flipByteOrder(data,bytes){var buffer=new ArrayBuffer(data.length);var ret=new Uint8Array(buffer);for(var i=0,n=data.length;i<n;i+=bytes){for(var j=0;j<bytes;j++){ret[i+bytes-j-1]=data[i+j]}}return buffer}function view(data,byteSize,c){if(isLittleEndian)return new c(data.buffer);return new c(flipByteOrder(data,byteSize))}function int16(data){return view(data,2,Int16Array)}function uint16(data){return view(data,2,Uint16Array)}function int32(data){return view(data,4,Int32Array)}function uint32(data){return view(data,4,Uint32Array)}function float32(data){return view(data,4,Float32Array)}function float64(data){return view(data,8,Float64Array)}function fixedPoint(data,encoding){var n=data.length;var output=getFloatArray(encoding.srcType,n);var f=1/encoding.factor;for(var i=0;i<n;i++){output[i]=f*data[i]}return output}function intervalQuantization(data,encoding){var n=data.length;var output=getFloatArray(encoding.srcType,n);var delta=(encoding.max-encoding.min)/(encoding.numSteps-1);var min=encoding.min;for(var i=0;i<n;i++){output[i]=min+delta*data[i]}return output}function runLength(data,encoding){var output=getIntArray(encoding.srcType,encoding.srcSize);var dataOffset=0;for(var i=0,il=data.length;i<il;i+=2){var value=data[i];var length_7=data[i+1];for(var j=0;j<length_7;++j){output[dataOffset++]=value}}return output}function delta(data,encoding){var n=data.length;var output=getIntArray(encoding.srcType,n);if(!n)return output;output[0]=data[0]+(encoding.origin|0);for(var i=1;i<n;++i){output[i]=data[i]+output[i-1]}return output}function integerPackingSigned(data,encoding){var upperLimit=encoding.byteCount===1?127:32767;var lowerLimit=-upperLimit-1;var n=data.length;var output=new Int32Array(encoding.srcSize);var i=0;var j=0;while(i<n){var value=0,t=data[i];while(t===upperLimit||t===lowerLimit){value+=t;i++;t=data[i]}value+=t;output[j]=value;i++;j++}return output}function integerPackingUnsigned(data,encoding){var upperLimit=encoding.byteCount===1?255:65535;var n=data.length;var output=new Int32Array(encoding.srcSize);var i=0;var j=0;while(i<n){var value=0,t=data[i];while(t===upperLimit){value+=t;i++;t=data[i]}value+=t;output[j]=value;i++;j++}return output}function integerPacking(data,encoding){return encoding.isUnsigned?integerPackingUnsigned(data,encoding):integerPackingSigned(data,encoding)}function stringArray(data,encoding){var str=encoding.stringData;var offsets=decode({encoding:encoding.offsetEncoding,data:encoding.offsets});var indices=decode({encoding:encoding.dataEncoding,data:data});var cache=Object.create(null);var result=new Array(indices.length);var offset=0;for(var _i=0,indices_1=indices;_i<indices_1.length;_i++){var i=indices_1[_i];if(i<0){result[offset++]=null;continue}var v=cache[i];if(v===void 0){v=str.substring(offsets[i],offsets[i+1]);cache[i]=v}result[offset++]=v}return result}})(Decoder||(Decoder={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";var File=function(){function File(data){this.dataBlocks=data.dataBlocks.map(function(b){return new DataBlock(b)})}File.prototype.toJSON=function(){return this.dataBlocks.map(function(b){return b.toJSON()})};return File}();Binary.File=File;var DataBlock=function(){function DataBlock(data){this.additionalData={};this.header=data.header;this.categoryList=data.categories.map(function(c){return new Category(c)});this.categoryMap=new Map;for(var _i=0,_a=this.categoryList;_i<_a.length;_i++){var c=_a[_i];this.categoryMap.set(c.name,c)}}Object.defineProperty(DataBlock.prototype,"categories",{get:function(){return this.categoryList},enumerable:true,configurable:true});DataBlock.prototype.getCategory=function(name){return this.categoryMap.get(name)};DataBlock.prototype.toJSON=function(){return{id:this.header,categories:this.categoryList.map(function(c){return c.toJSON()}),additionalData:this.additionalData}};return DataBlock}();Binary.DataBlock=DataBlock;var Category=function(){function Category(data){this.name=data.name;this.columnCount=data.columns.length;this.rowCount=data.rowCount;this.columnNameList=[];this.encodedColumns=new Map;for(var _i=0,_a=data.columns;_i<_a.length;_i++){var c=_a[_i];this.encodedColumns.set(c.name,c);this.columnNameList.push(c.name)}}Object.defineProperty(Category.prototype,"columnNames",{get:function(){return this.columnNameList},enumerable:true,configurable:true});Category.prototype.getColumn=function(name){var w=this.encodedColumns.get(name);if(w)return wrapColumn(w);return CIFTools.UndefinedColumn};Category.prototype.toJSON=function(){var _this=this;var rows=[];var columns=this.columnNameList.map(function(name){return{name:name,column:_this.getColumn(name)}});for(var i=0;i<this.rowCount;i++){var item={};for(var _i=0,columns_1=columns;_i<columns_1.length;_i++){var c=columns_1[_i];var d=c.column.getValuePresence(i);if(d===0)item[c.name]=c.column.getString(i);else if(d===1)item[c.name]=".";else item[c.name]="?"}rows[i]=item}return{name:this.name,columns:this.columnNames,rows:rows}};return Category}();Binary.Category=Category;function wrapColumn(column){if(!column.data.data)return CIFTools.UndefinedColumn;var data=Binary.decode(column.data);var mask=void 0;if(column.mask)mask=Binary.decode(column.mask);if(data.buffer&&data.byteLength&&data.BYTES_PER_ELEMENT){return mask?new MaskedNumericColumn(data,mask):new NumericColumn(data)}return mask?new MaskedStringColumn(data,mask):new StringColumn(data)}var fastParseInt=CIFTools.Utils.FastNumberParsers.parseInt;var fastParseFloat=CIFTools.Utils.FastNumberParsers.parseFloat;var NumericColumn=function(){function NumericColumn(data){this.data=data;this.isDefined=true}NumericColumn.prototype.getString=function(row){return""+this.data[row]};NumericColumn.prototype.getInteger=function(row){return this.data[row]|0};NumericColumn.prototype.getFloat=function(row){return 1*this.data[row]};NumericColumn.prototype.stringEquals=function(row,value){return this.data[row]===fastParseFloat(value,0,value.length)};NumericColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};NumericColumn.prototype.getValuePresence=function(row){return 0};return NumericColumn}();var MaskedNumericColumn=function(){function MaskedNumericColumn(data,mask){this.data=data;this.mask=mask;this.isDefined=true}MaskedNumericColumn.prototype.getString=function(row){return this.mask[row]===0?""+this.data[row]:null};MaskedNumericColumn.prototype.getInteger=function(row){return this.mask[row]===0?this.data[row]:0};MaskedNumericColumn.prototype.getFloat=function(row){return this.mask[row]===0?this.data[row]:0};MaskedNumericColumn.prototype.stringEquals=function(row,value){return this.mask[row]===0?this.data[row]===fastParseFloat(value,0,value.length):value===null||value===void 0};MaskedNumericColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};MaskedNumericColumn.prototype.getValuePresence=function(row){return this.mask[row]};return MaskedNumericColumn}();var StringColumn=function(){function StringColumn(data){this.data=data;this.isDefined=true}StringColumn.prototype.getString=function(row){return this.data[row]};StringColumn.prototype.getInteger=function(row){var v=this.data[row];return fastParseInt(v,0,v.length)};StringColumn.prototype.getFloat=function(row){var v=this.data[row];return fastParseFloat(v,0,v.length)};StringColumn.prototype.stringEquals=function(row,value){return this.data[row]===value};StringColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};StringColumn.prototype.getValuePresence=function(row){return 0};return StringColumn}();var MaskedStringColumn=function(){function MaskedStringColumn(data,mask){this.data=data;this.mask=mask;this.isDefined=true}MaskedStringColumn.prototype.getString=function(row){return this.mask[row]===0?this.data[row]:null};MaskedStringColumn.prototype.getInteger=function(row){if(this.mask[row]!==0)return 0;var v=this.data[row];return fastParseInt(v||"",0,(v||"").length)};MaskedStringColumn.prototype.getFloat=function(row){if(this.mask[row]!==0)return 0;var v=this.data[row];return fastParseFloat(v||"",0,(v||"").length)};MaskedStringColumn.prototype.stringEquals=function(row,value){return this.data[row]===value};MaskedStringColumn.prototype.areValuesEqual=function(rowA,rowB){return this.data[rowA]===this.data[rowB]};MaskedStringColumn.prototype.getValuePresence=function(row){return this.mask[row]};return MaskedStringColumn}()})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";var Encoder=function(){function Encoder(providers){this.providers=providers}Encoder.prototype.and=function(f){return new Encoder(this.providers.concat([f]))};Encoder.prototype.encode=function(data){var encoding=[];for(var _i=0,_a=this.providers;_i<_a.length;_i++){var p=_a[_i];var t=p(data);if(!t.encodings.length){throw new Error("Encodings must be non-empty.")}data=t.data;for(var _b=0,_c=t.encodings;_b<_c.length;_b++){var e=_c[_b];encoding.push(e)}}if(!(data instanceof Uint8Array)){throw new Error("The encoding must result in a Uint8Array. Fix your encoding chain.")}return{encoding:encoding,data:data}};return Encoder}();Binary.Encoder=Encoder;(function(Encoder){function by(f){return new Encoder([f])}Encoder.by=by;function uint8(data){return{encodings:[{kind:"ByteArray",type:4}],data:data}}function int8(data){return{encodings:[{kind:"ByteArray",type:1}],data:new Uint8Array(data.buffer,data.byteOffset)}}var writers=(_a={},_a[2]=function(v,i,a){v.setInt16(2*i,a,true)},_a[5]=function(v,i,a){v.setUint16(2*i,a,true)},_a[3]=function(v,i,a){v.setInt32(4*i,a,true)},_a[6]=function(v,i,a){v.setUint32(4*i,a,true)},_a[32]=function(v,i,a){v.setFloat32(4*i,a,true)},_a[33]=function(v,i,a){v.setFloat64(8*i,a,true)},_a);var byteSizes=(_b={},_b[2]=2,_b[5]=2,_b[3]=4,_b[6]=4,_b[32]=4,_b[33]=8,_b);function byteArray(data){var type=Binary.Encoding.getDataType(data);if(type===1)return int8(data);else if(type===4)return uint8(data);var result=new Uint8Array(data.length*byteSizes[type]);var w=writers[type];var view=new DataView(result.buffer);for(var i=0,n=data.length;i<n;i++){w(view,i,data[i])}return{encodings:[{kind:"ByteArray",type:type}],data:result}}Encoder.byteArray=byteArray;function _fixedPoint(data,factor){var srcType=Binary.Encoding.getDataType(data);var result=new Int32Array(data.length);for(var i=0,n=data.length;i<n;i++){result[i]=Math.round(data[i]*factor)}return{encodings:[{kind:"FixedPoint",factor:factor,srcType:srcType}],data:result}}function fixedPoint(factor){return function(data){return _fixedPoint(data,factor)}}Encoder.fixedPoint=fixedPoint;function _intervalQuantizaiton(data,min,max,numSteps,arrayType){var srcType=Binary.Encoding.getDataType(data);if(!data.length){return{encodings:[{kind:"IntervalQuantization",min:min,max:max,numSteps:numSteps,srcType:srcType}],data:new Int32Array(0)}}if(max<min){var t=min;min=max;max=t}var delta=(max-min)/(numSteps-1);var output=new arrayType(data.length);for(var i=0,n=data.length;i<n;i++){var v=data[i];if(v<=min)output[i]=0;else if(v>=max)output[i]=numSteps;else output[i]=Math.round((v-min)/delta)|0}return{encodings:[{kind:"IntervalQuantization",min:min,max:max,numSteps:numSteps,srcType:srcType}],data:output}}function intervalQuantizaiton(min,max,numSteps,arrayType){if(arrayType===void 0){arrayType=Int32Array}return function(data){return _intervalQuantizaiton(data,min,max,numSteps,arrayType)}}Encoder.intervalQuantizaiton=intervalQuantizaiton;function runLength(data){var srcType=Binary.Encoding.getDataType(data);if(srcType===void 0){data=new Int32Array(data);srcType=3}if(!data.length){return{encodings:[{kind:"RunLength",srcType:srcType,srcSize:0}],data:new Int32Array(0)}}var fullLength=2;for(var i=1,il=data.length;i<il;i++){if(data[i-1]!==data[i]){fullLength+=2}}var output=new Int32Array(fullLength);var offset=0;var runLength=1;for(var i=1,il=data.length;i<il;i++){if(data[i-1]!==data[i]){output[offset]=data[i-1];output[offset+1]=runLength;runLength=1;offset+=2}else{++runLength}}output[offset]=data[data.length-1];output[offset+1]=runLength;return{encodings:[{kind:"RunLength",srcType:srcType,srcSize:data.length}],data:output}}Encoder.runLength=runLength;function delta(data){if(!Binary.Encoding.isSignedIntegerDataType(data)){throw new Error("Only signed integer types can be encoded using delta encoding.")}var srcType=Binary.Encoding.getDataType(data);if(srcType===void 0){data=new Int32Array(data);srcType=3}if(!data.length){return{encodings:[{kind:"Delta",origin:0,srcType:srcType}],data:new data.constructor(0)}}var output=new data.constructor(data.length);var origin=data[0];output[0]=data[0];for(var i=1,n=data.length;i<n;i++){output[i]=data[i]-data[i-1]}output[0]=0;return{encodings:[{kind:"Delta",origin:origin,srcType:srcType}],data:output}}Encoder.delta=delta;function isSigned(data){for(var i=0,n=data.length;i<n;i++){if(data[i]<0)return true}return false}function packingSize(data,upperLimit){var lowerLimit=-upperLimit-1;var size=0;for(var i=0,n=data.length;i<n;i++){var value=data[i];if(value===0){size+=1}else if(value>0){size+=Math.ceil(value/upperLimit);if(value%upperLimit===0)size+=1}else{size+=Math.ceil(value/lowerLimit);if(value%lowerLimit===0)size+=1}}return size}function determinePacking(data){var signed=isSigned(data);var size8=signed?packingSize(data,127):packingSize(data,255);var size16=signed?packingSize(data,32767):packingSize(data,65535);if(data.length*4<size16*2){return{isSigned:signed,size:data.length,bytesPerElement:4}}else if(size16*2<size8){return{isSigned:signed,size:size16,bytesPerElement:2}}else{return{isSigned:signed,size:size8,bytesPerElement:1}}}function _integerPacking(data,packing){var upperLimit=packing.isSigned?packing.bytesPerElement===1?127:32767:packing.bytesPerElement===1?255:65535;var lowerLimit=-upperLimit-1;var n=data.length;var packed=packing.isSigned?packing.bytesPerElement===1?new Int8Array(packing.size):new Int16Array(packing.size):packing.bytesPerElement===1?new Uint8Array(packing.size):new Uint16Array(packing.size);var j=0;for(var i=0;i<n;i++){var value=data[i];if(value>=0){while(value>=upperLimit){packed[j]=upperLimit;++j;value-=upperLimit}}else{while(value<=lowerLimit){packed[j]=lowerLimit;++j;value-=lowerLimit}}packed[j]=value;++j}var result=byteArray(packed);return{encodings:[{kind:"IntegerPacking",byteCount:packing.bytesPerElement,isUnsigned:!packing.isSigned,srcSize:n},result.encodings[0]],data:result.data}}function integerPacking(data){if(!(data instanceof Int32Array)){throw new Error("Integer packing can only be applied to Int32 data.")}var packing=determinePacking(data);if(packing.bytesPerElement===4){return byteArray(data)}return _integerPacking(data,packing)}Encoder.integerPacking=integerPacking;function stringArray(data){var map=Object.create(null);var strings=[];var accLength=0;var offsets=CIFTools.Utils.ChunkedArray.create(function(s){return new Int32Array(s)},1024,1);var output=new Int32Array(data.length);CIFTools.Utils.ChunkedArray.add(offsets,0);var i=0;for(var _i=0,data_1=data;_i<data_1.length;_i++){var s=data_1[_i];if(s===null||s===void 0){output[i++]=-1;continue}var index=map[s];if(index===void 0){accLength+=s.length;index=strings.length;strings[index]=s;map[s]=index;CIFTools.Utils.ChunkedArray.add(offsets,accLength)}output[i++]=index}var encOffsets=Encoder.by(delta).and(integerPacking).encode(CIFTools.Utils.ChunkedArray.compact(offsets));var encOutput=Encoder.by(delta).and(runLength).and(integerPacking).encode(output);return{encodings:[{kind:"StringArray",dataEncoding:encOutput.encoding,stringData:strings.join(""),offsetEncoding:encOffsets.encoding,offsets:encOffsets.data}],data:encOutput.data}}Encoder.stringArray=stringArray;var _a,_b})(Encoder=Binary.Encoder||(Binary.Encoder={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";Binary.VERSION="0.3.0";var Encoding;(function(Encoding){function getDataType(data){var srcType;if(data instanceof Int8Array)srcType=1;else if(data instanceof Int16Array)srcType=2;else if(data instanceof Int32Array)srcType=3;else if(data instanceof Uint8Array)srcType=4;else if(data instanceof Uint16Array)srcType=5;else if(data instanceof Uint32Array)srcType=6;else if(data instanceof Float32Array)srcType=32;else if(data instanceof Float64Array)srcType=33;else throw new Error("Unsupported integer data type.");return srcType}Encoding.getDataType=getDataType;function isSignedIntegerDataType(data){return data instanceof Int8Array||data instanceof Int16Array||data instanceof Int32Array}Encoding.isSignedIntegerDataType=isSignedIntegerDataType})(Encoding=Binary.Encoding||(Binary.Encoding={}))})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";function checkVersions(min,current){for(var i=0;i<2;i++){if(min[i]>current[i])return false}return true}function parse(data){var minVersion=[0,3];try{var array=new Uint8Array(data);var unpacked=Binary.MessagePack.decode(array);if(!checkVersions(minVersion,unpacked.version.match(/(\d)\.(\d)\.\d/).slice(1))){return CIFTools.ParserResult.error("Unsupported format version. Current "+unpacked.version+", required "+minVersion.join(".")+".")}var file=new Binary.File(unpacked);return CIFTools.ParserResult.success(file)}catch(e){return CIFTools.ParserResult.error(""+e)}}Binary.parse=parse})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));var CIFTools;(function(CIFTools){var Binary;(function(Binary){"use strict";function encodeField(field,data,totalCount){var array,isNative=false;if(field.typedArray){array=new field.typedArray(totalCount)}else{isNative=true;array=new Array(totalCount)}var mask=new Uint8Array(totalCount);var presence=field.presence;var getter=field.number?field.number:field.string;var allPresent=true;var offset=0;for(var _i=0,data_2=data;_i<data_2.length;_i++){var _d=data_2[_i];var d=_d.data;for(var i=0,_b=_d.count;i<_b;i++){var p=presence?presence(d,i):0;if(p!==0){mask[offset]=p;if(isNative)array[offset]=null;allPresent=false}else{mask[offset]=0;array[offset]=getter(d,i)}offset++}}var encoder=field.encoder?field.encoder:Binary.Encoder.by(Binary.Encoder.stringArray);var encoded=encoder.encode(array);var maskData=void 0;if(!allPresent){var maskRLE=Binary.Encoder.by(Binary.Encoder.runLength).and(Binary.Encoder.byteArray).encode(mask);if(maskRLE.data.length<mask.length){maskData=maskRLE}else{maskData=Binary.Encoder.by(Binary.Encoder.byteArray).encode(mask)}}return{name:field.name,data:encoded,mask:maskData}}var Writer=function(){function Writer(encoder){this.dataBlocks=[];this.data={encoder:encoder,version:Binary.VERSION,dataBlocks:this.dataBlocks}}Writer.prototype.startDataBlock=function(header){this.dataBlocks.push({header:(header||"").replace(/[ \n\t]/g,"").toUpperCase(),categories:[]})};Writer.prototype.writeCategory=function(category,contexts){if(!this.data){throw new Error("The writer contents have already been encoded, no more writing.")}if(!this.dataBlocks.length){throw new Error("No data block created.")}var src=!contexts||!contexts.length?[category(void 0)]:contexts.map(function(c){return category(c)});var categories=src.filter(function(c){return c&&c.count>0});if(!categories.length)return;var count=categories.reduce(function(a,c){return a+c.count},0);if(!count)return;var first=categories[0];var cat={name:first.desc.name,columns:[],rowCount:count};var data=categories.map(function(c){return{data:c.data,count:c.count}});for(var _i=0,_a=first.desc.fields;_i<_a.length;_i++){var f=_a[_i];cat.columns.push(encodeField(f,data,count))}this.dataBlocks[this.dataBlocks.length-1].categories.push(cat)};Writer.prototype.encode=function(){this.encodedData=Binary.MessagePack.encode(this.data);this.data=null;this.dataBlocks=null};Writer.prototype.flush=function(stream){stream.writeBinary(this.encodedData)};return Writer}();Binary.Writer=Writer})(Binary=CIFTools.Binary||(CIFTools.Binary={}))})(CIFTools||(CIFTools={}));return CIFTools};if(typeof module==="object"&&typeof module.exports==="object"){module.exports=__CIFTools()}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__],__WEBPACK_AMD_DEFINE_RESULT__=function(require){return __CIFTools()}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{var __target=!!window?window:this;__target.CIFTools=__CIFTools()}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ciftools_js_1=__webpack_require__(43);function Category(category,columns){var ret=Object.create(null);if(!category)for(var _i=0,_a=Object.keys(columns);_i<_a.length;_i++){var c=_a[_i];ret[c]=ciftools_js_1.default.UndefinedColumn}else for(var _b=0,_c=Object.keys(columns);_b<_c.length;_b++){var c=_c[_b];ret[c]=category.getColumn(c)}ret.rowCount=category&&category.rowCount||0;return ret}exports.Category=Category;exports.AtomSite={group_PDB:"",id:"",type_symbol:"",label_atom_id:"",label_alt_id:"",label_comp_id:"",label_asym_id:"",label_entity_id:"",label_seq_id:"",pdbx_PDB_ins_code:"",pdbx_formal_charge:"",Cartn_x:"",Cartn_y:"",Cartn_z:"",occupancy:"",B_iso_or_equiv:"",auth_atom_id:"",auth_comp_id:"",auth_asym_id:"",auth_seq_id:"",pdbx_PDB_model_num:""};exports.Entity={id:"",type:"",src_method:"",pdbx_description:"",formula_weight:"",pdbx_number_of_molecules:"",details:"",pdbx_mutation:"",pdbx_fragment:"",pdbx_ec:""};exports.StructConf={conf_type_id:"",id:"",pdbx_PDB_helix_id:"",beg_label_comp_id:"",beg_label_asym_id:"",beg_label_seq_id:"",pdbx_beg_PDB_ins_code:"",end_label_comp_id:"",end_label_asym_id:"",end_label_seq_id:"",pdbx_end_PDB_ins_code:"",beg_auth_comp_id:"",beg_auth_asym_id:"",beg_auth_seq_id:"",end_auth_comp_id:"",end_auth_asym_id:"",end_auth_seq_id:"",pdbx_PDB_helix_class:"",details:"",pdbx_PDB_helix_length:""};exports.StructSheetRange={sheet_id:"",id:"",beg_label_comp_id:"",beg_label_asym_id:"",beg_label_seq_id:"",pdbx_beg_PDB_ins_code:"",end_label_comp_id:"",end_label_asym_id:"",end_label_seq_id:"",pdbx_end_PDB_ins_code:"",symmetry:"",beg_auth_comp_id:"",beg_auth_asym_id:"",beg_auth_seq_id:"",end_auth_comp_id:"",end_auth_asym_id:"",end_auth_seq_id:""};exports.StructConn={id:"",conn_type_id:"",pdbx_PDB_id:"",ptnr1_label_asym_id:"",ptnr1_label_comp_id:"",ptnr1_label_seq_id:"",ptnr1_label_atom_id:"",pdbx_ptnr1_label_alt_id:"",pdbx_ptnr1_PDB_ins_code:"",pdbx_ptnr1_standard_comp_id:"",ptnr1_symmetry:"",ptnr2_label_asym_id:"",ptnr2_label_comp_id:"",ptnr2_label_seq_id:"",ptnr2_label_atom_id:"",pdbx_ptnr2_label_alt_id:"",pdbx_ptnr2_PDB_ins_code:"",ptnr1_auth_asym_id:"",ptnr1_auth_comp_id:"",ptnr1_auth_seq_id:"",ptnr2_auth_asym_id:"",ptnr2_auth_comp_id:"",ptnr2_auth_seq_id:"",ptnr2_symmetry:"",pdbx_ptnr3_label_atom_id:"",pdbx_ptnr3_label_seq_id:"",pdbx_ptnr3_label_comp_id:"",pdbx_ptnr3_label_asym_id:"",pdbx_ptnr3_label_alt_id:"",pdbx_ptnr3_PDB_ins_code:"",details:"",pdbx_dist_value:"",pdbx_value_order:""};exports.ChemCompBond={comp_id:"",pdbx_stereo_config:"",pdbx_ordinal:"",pdbx_aromatic_flag:"",atom_id_1:"",atom_id_2:"",value_order:""};exports.PDBxStructModResidue={id:"",label_asym_id:"",label_seq_id:"",label_comp_id:"",auth_asym_id:"",auth_seq_id:"",auth_comp_id:"",PDB_ins_code:"",parent_comp_id:"",details:""}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SecondaryStructureMmcif={HELX_LH_27_P:2|16|512,HELX_LH_3T_P:2|16|1024,HELX_LH_AL_P:2|16|2048,HELX_LH_A_N:1|16|262144,HELX_LH_B_N:1|16|524288,HELX_LH_GA_P:2|16|4096,HELX_LH_N:1|16,HELX_LH_OM_P:2|16|8192,HELX_LH_OT_N:1|16|65536,HELX_LH_OT_P:2|16|256,HELX_LH_P:2|16,HELX_LH_PI_P:2|16|16384,HELX_LH_PP_P:2|16|32768,HELX_LH_Z_N:1|16|131072,HELX_N:1,HELX_OT_N:1,HELX_OT_P:2,HELX_P:2,HELX_RH_27_P:2|32|512,HELX_RH_3T_P:2|32|1024,HELX_RH_AL_P:2|32|2048,HELX_RH_A_N:1|32|262144,HELX_RH_B_N:1|32|524288,HELX_RH_GA_P:2|32|4096,HELX_RH_N:1|32,HELX_RH_OM_P:2|32|8192,HELX_RH_OT_N:1|32|65536,HELX_RH_OT_P:2|32|256,HELX_RH_P:2|32,HELX_RH_PI_P:2|32|16384,HELX_RH_PP_P:2|32|32768,HELX_RH_Z_N:1|32|131072,STRN:4|2097152,TURN_OT_P:8|16777216,TURN_P:8,TURN_TY1P_P:8|128|33554432,TURN_TY1_P:8|64|33554432,TURN_TY2P_P:8|128|67108864,TURN_TY2_P:8|64|67108864,TURN_TY3P_P:8|128|134217728,TURN_TY3_P:8|64|134217728};exports.SecondaryStructurePdb={1:2|32|2048,2:2|32|8192,3:2|32|16384,4:2|32|4096,5:2|32|1024,6:2|16|2048,7:2|16|8192,8:2|16|4096,9:2|512,10:2|32768};exports.SecondaryStructureStride={H:2|2048,G:2|1024,I:2|16384,E:4|4194304,B:4|2097152,b:4|2097152,T:8,C:268435456};exports.SecondaryStructureDssp={H:2|2048,B:4|2097152,E:4|4194304,G:2|1024,I:2|16384,T:8,S:8}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var compiler_1=__webpack_require__(146);var symbol_table_1=__webpack_require__(34);var checker_1=__webpack_require__(148);var MolQLStructure=__webpack_require__(57);var builder_1=__webpack_require__(6);var environment_1=__webpack_require__(25);var _compile=compiler_1.default(environment_1.default);function compile(e,kind){if(kind===void 0){kind="any"}if(kind==="query"){checker_1.default(symbol_table_1.SymbolMap,e,MolQLStructure.Types.AtomSelectionQuery);return _compile(builder_1.default.evaluate(e))}else{checker_1.default(symbol_table_1.SymbolMap,e);return _compile(e)}}exports.default=compile},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var expression_1=__webpack_require__(33);var expression_2=__webpack_require__(147);function Compiler(envProvider){var env=envProvider(void 0);return function(expression){return wrap(envProvider,compile(env,expression).runtime)}}var CompileResult;(function(CompileResult){function Const(value){return{isConst:true,runtime:expression_2.default.constant(value)}}CompileResult.Const=Const;function Dynamic(runtime){return{isConst:false,runtime:runtime}}CompileResult.Dynamic=Dynamic})(CompileResult||(CompileResult={}));function wrap(envProvider,runtime){return function(ctx){return runtime(envProvider(ctx))}}function noRuntimeFor(symbol){throw new Error("Could not find runtime for symbol '"+symbol+"'.")}function applySymbolStatic(runtime,args){return CompileResult.Dynamic(function(env){return runtime(env,args)})}function applySymbolDynamic(head,args){return CompileResult.Dynamic(function(env){var value=head(env);var symbol=env.symbolTable[value];if(!symbol)noRuntimeFor(value);return symbol.runtime(env,args)})}function apply(env,head,args,constArgs){if(head.isConst){var value=head.runtime(env);var symbol=env.symbolTable[value];if(!symbol)throw new Error("Could not find runtime for symbol '"+value+"'.");if(symbol.attributes.isStatic&&constArgs)return CompileResult.Const(symbol.runtime(env,args));return applySymbolStatic(symbol.runtime,args)}return applySymbolDynamic(head.runtime,args)}function compile(env,expression){if(expression_1.default.isLiteral(expression)){return CompileResult.Const(expression)}var head=compile(env,expression.head);if(!expression.args){return apply(env,head,[],true)}else if(expression_1.default.isArgumentsArray(expression.args)){var args=[];var constArgs=false;for(var _i=0,_a=expression.args;_i<_a.length;_i++){var arg=_a[_i];var compiled=compile(env,arg);constArgs=constArgs&&compiled.isConst;args.push(compiled.runtime)}return apply(env,head,args,constArgs)}else{var args=Object.create(null);var constArgs=false;for(var _b=0,_c=Object.keys(expression.args);_b<_c.length;_b++){var key=_c[_b];var compiled=compile(env,expression.args[key]);constArgs=constArgs&&compiled.isConst;args[key]=compiled.runtime}return apply(env,head,args,constArgs)}}exports.default=Compiler},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var RuntimeExpression;(function(RuntimeExpression){function constant(c){return function(env){return c}}RuntimeExpression.constant=constant;function func(f){return function(env){return f(env)}}RuntimeExpression.func=func})(RuntimeExpression||(RuntimeExpression={}));exports.default=RuntimeExpression},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var expression_1=__webpack_require__(33);var type_1=__webpack_require__(44);var formatter_1=__webpack_require__(91);var collections_1=__webpack_require__(8);function default_1(symbols,expr,type){typeCheck(symbols,collections_1.FastMap.create(),expr,type||type_1.default.Any,"")}exports.default=default_1;function typeCheck(symbols,ctx,expr,type,hint){if(expression_1.default.isLiteral(expr)){var l=getLiteralType(expr);if(!assignType(ctx,expr,l,type))notAssignable(ctx,hint,l,type)}else if(expression_1.default.isApply(expr)&&expression_1.default.isLiteral(expr.head)){var symbol=getSymbol(symbols,expr.head);var argsCtx=collections_1.FastMap.create();assignArguments(symbols,argsCtx,symbol.id,expr.args,symbol.args);var t=resolveType(argsCtx,symbol.type);if(!assignType(ctx,expr,t,type))notAssignable(ctx,hint,t,type)}}function getSymbol(symbols,head){var symbol=symbols[head];if(!symbol)throwError("'"+head+"': symbol not found.");return symbol}function throwError(msg){throw new Error(msg)}function notAssignable(ctx,hint,a,b){var oneof=b.kind==="oneof"?" Value must be one of: "+type_1.default.oneOfValues(b).join(", ")+".":"";throwError(""+hint+(!!hint?": ":"")+"type '"+formatter_1.default(resolveType(ctx,a))+"' is not assignable to '"+formatter_1.default(resolveType(ctx,b))+"'."+oneof)}function assignArguments(symbols,ctx,symbolId,exprArgs,args){if(args.kind==="list"){if(!exprArgs){if(args.nonEmpty)throwError("'"+symbolId+"': at least one argument required.");return}if(!expression_1.default.isArgumentsArray(exprArgs)){throwError("'"+symbolId+"': accepts array arguments (got object).");return}if(args.nonEmpty&&!exprArgs.length)throwError("'"+symbolId+"': at least one argument required.");var i=0;for(var _i=0,exprArgs_1=exprArgs;_i<exprArgs_1.length;_i++){var a=exprArgs_1[_i];typeCheck(symbols,ctx,a,args.type,"'"+symbolId+"', arg "+i++)}}else{var keys=Object.keys(args.map);var isArrayLike=true,i=0,isAnyRest=false;var optionalCount=0;for(var _a=0,keys_1=keys;_a<keys_1.length;_a++){var k=keys_1[_a];var arg=args.map[k];if(isNaN(k)||+k!==i)isArrayLike=false;if(arg.isOptional)optionalCount++;if(arg.isRest)isAnyRest=true;i++}if(!exprArgs){if(i-optionalCount>0)throwError("'"+symbolId+"': argument(s) required.");return}if(expression_1.default.isArgumentsArray(exprArgs)){if(exprArgs.length<i-optionalCount){throwError("'"+symbolId+"': more arguments required.")}}for(var _b=0,_c=Object.keys(exprArgs);_b<_c.length;_b++){var k=_c[_b];if(!args.map[k]){if(isNaN(k)||!isAnyRest)throwError("'"+symbolId+"': unknown arg ':"+k+"'.")}}for(var _d=0,keys_2=keys;_d<keys_2.length;_d++){var k=keys_2[_d];var arg=args.map[k];var e=exprArgs[k];if(e===void 0){if(!arg.isOptional)throwError("'"+symbolId+"': arg ':"+k+"' is required.");continue}typeCheck(symbols,ctx,e,arg.type,"'"+symbolId+"', arg ':"+k+"'")}}}function hasVariables(type){switch(type.kind){case"variable":return true;case"value":case"any":case"any-value":case"oneof":return false;case"container":return hasVariables(type.child);case"union":{for(var _i=0,_a=type.types;_i<_a.length;_i++){var t=_a[_i];if(hasVariables(t))return true}return false}}}function getLiteralType(expr){switch(typeof expr){case"number":return type_1.default.Num;case"string":return type_1.default.Str;case"boolean":return type_1.default.Bool;default:return type_1.default.Any}}function assignType(ctx,value,a,b){if(a.kind==="variable"){var t=a.type;if(a.isConstraint){if(ctx.has(a.name))t=ctx.get(a.name).type;else return assignType(ctx,value,b,a)}return assignType(ctx,value,t,b)}switch(b.kind){case"any":return true;case"any-value":return a.kind==="value"||a.kind==="any-value"||a.kind==="oneof";case"value":{if(a.kind==="value")return a.name===b.name&&a.namespace===b.namespace;else if(a.kind==="oneof")return a.type.name===b.name&&a.type.namespace===b.namespace;return false}case"container":return a.kind==="container"&&a.name===b.name&&a.namespace===b.namespace&&assignType(ctx,value,a.child,b.child);case"union":{if(a.kind==="union"){for(var _i=0,_a=a.types;_i<_a.length;_i++){var t=_a[_i];if(!assignType(ctx,value,t,b))return false}return true}else{for(var _b=0,_c=b.types;_b<_c.length;_b++){var t=_c[_b];if(!assignType(ctx,value,a,t))return true}return false}}case"oneof":{if(a.kind==="oneof"){if(a.namespace===b.namespace&&a.name===b.name)return true;var keys=Object.keys(a.values);var hasAll=true;for(var _d=0,keys_3=keys;_d<keys_3.length;_d++){var k=keys_3[_d];if(a.values[k]&&!b.values[k]){hasAll=false;break}}if(hasAll)return true;if(expression_1.default.isLiteral(value)&&b.values[value])return true;return false}else if(expression_1.default.isLiteral(value)){return!!b.values[value]}return false}case"variable":{if(!assignType(ctx,value,a,b.type))return false;if(ctx.has(b.name)){var e=ctx.get(b.name);if(b.isConstraint&&!assignType(ctx,value,a,e.type))return false;if(collections_1.UniqueArrayBuilder.add(e.seen,formatter_1.default(a),a))e.type=type_1.default.Union(e.seen.array)}else{var e={type:a,seen:collections_1.UniqueArrayBuilder()};collections_1.UniqueArrayBuilder.add(e.seen,formatter_1.default(a),a);ctx.set(b.name,e)}return true}}}function _resolve(c){return resolveType(this,c)}function resolveType(ctx,t){if(!hasVariables(t))return t;switch(t.kind){case"variable":{if(ctx.has(t.name))return ctx.get(t.name).type;return t}case"container":return type_1.default.Container(t.namespace,t.name,resolveType(ctx,t.child));case"union":return type_1.default.Union(t.types.map(_resolve,ctx));default:return t}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function BondAddress(){return{atomA:0,atomB:0,flags:0,order:0}}exports.default=BondAddress},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var symbol_table_1=__webpack_require__(34);var symbol_1=__webpack_require__(58);var symbol_2=__webpack_require__(24);var collections_1=__webpack_require__(8);var data_1=__webpack_require__(13);var structure_1=__webpack_require__(157);var upper_case_1=__webpack_require__(59);var staticAttr={isStatic:true};exports.SymbolRuntime=[symbol_1.default(symbol_table_1.default.core.type.bool,staticAttr)(function(env,v){return!!v[0](env)}),symbol_1.default(symbol_table_1.default.core.type.num,staticAttr)(function(env,v){return+v[0](env)}),symbol_1.default(symbol_table_1.default.core.type.str,staticAttr)(function(env,v){return""+v[0](env)}),symbol_1.default(symbol_table_1.default.core.type.list,staticAttr)(function(env,xs){var list=[];if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)list.push(xs[i](env))}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];list.push(xs[k](env))}}return list}),symbol_1.default(symbol_table_1.default.core.type.set,staticAttr)(function(env,xs){var set=collections_1.FastSet.create();if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)set.add(xs[i](env))}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];set.add(xs[k](env))}}return set}),symbol_1.default(symbol_table_1.default.core.type.regex,staticAttr)(function(env,v){return new RegExp(v[0](env),v[1]&&v[1](env)||"")}),symbol_1.default(symbol_table_1.default.core.type.bitflags,staticAttr)(function(env,v){return+v[0](env)}),symbol_1.default(symbol_table_1.default.core.type.compositeKey,staticAttr)(function(env,xs){var key=[];if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)key[key.length]=""+xs[i](env)}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];key[key.length]=""+xs[k](env)}}return key.join("-")}),symbol_1.default(symbol_table_1.default.core.logic.not,staticAttr)(function(env,v){return!v[0](env)}),symbol_1.default(symbol_table_1.default.core.logic.and,staticAttr)(function(env,xs){if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)if(!xs[i](env))return false}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];if(!xs[k](env))return false}}return true}),symbol_1.default(symbol_table_1.default.core.logic.or,staticAttr)(function(env,xs){if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)if(xs[i](env))return true}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];if(xs[k](env))return true}}return false}),symbol_1.default(symbol_table_1.default.core.rel.eq,staticAttr)(function(env,v){return v[0](env)===v[1](env)}),symbol_1.default(symbol_table_1.default.core.rel.neq,staticAttr)(function(env,v){return v[0](env)!==v[1](env)}),symbol_1.default(symbol_table_1.default.core.rel.lt,staticAttr)(function(env,v){return v[0](env)<v[1](env)}),symbol_1.default(symbol_table_1.default.core.rel.lte,staticAttr)(function(env,v){return v[0](env)<=v[1](env)}),symbol_1.default(symbol_table_1.default.core.rel.gr,staticAttr)(function(env,v){return v[0](env)>v[1](env)}),symbol_1.default(symbol_table_1.default.core.rel.gre,staticAttr)(function(env,v){return v[0](env)>=v[1](env)}),symbol_1.default(symbol_table_1.default.core.rel.inRange,staticAttr)(function(env,v){var x=v[0](env);return x>=v[1](env)&&x<=v[2](env)}),symbol_1.default(symbol_table_1.default.core.ctrl.if,staticAttr)(function(env,v){return v[0](env)?v[1](env):v[2](env)}),symbol_1.default(symbol_table_1.default.core.ctrl.fn)(function(env,v){return v[0]}),symbol_1.default(symbol_table_1.default.core.ctrl.eval)(function(env,v){return v[0](env)(env)}),symbol_1.default(symbol_table_1.default.core.math.add,staticAttr)(function(env,xs){var ret=0;if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)ret+=xs[i](env)}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];ret+=xs[k](env)}}return ret}),symbol_1.default(symbol_table_1.default.core.math.sub,staticAttr)(function(env,xs){var ret=0;if(typeof xs.length==="number"){if(xs.length===1)return-xs[0](env);ret=xs[0](env)||0;for(var i=1,_i=xs.length;i<_i;i++)ret-=xs[i](env)}else{var keys=Object.keys(xs);if(keys.length===1)ret=xs[keys[0]](env)||0;for(var i=1,_i=keys.length;i<_i;i++)ret-=xs[keys[i]](env)}return ret}),symbol_1.default(symbol_table_1.default.core.math.mult,staticAttr)(function(env,xs){var ret=1;if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)ret*=xs[i](env)}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];ret*=xs[k](env)}}return ret}),symbol_1.default(symbol_table_1.default.core.math.div,staticAttr)(function(env,v){return v[0](env)/v[1](env)}),symbol_1.default(symbol_table_1.default.core.math.pow,staticAttr)(function(env,v){return Math.pow(v[0](env),v[1](env))}),symbol_1.default(symbol_table_1.default.core.math.mod,staticAttr)(function(env,v){return v[0](env)%v[1](env)}),symbol_1.default(symbol_table_1.default.core.math.min,staticAttr)(function(env,xs){var ret=Number.POSITIVE_INFINITY;if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)ret=Math.min(xs[i](env),ret)}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];ret=Math.min(xs[k](env),ret)}}return ret}),symbol_1.default(symbol_table_1.default.core.math.max,staticAttr)(function(env,xs){var ret=Number.NEGATIVE_INFINITY;if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)ret=Math.max(xs[i](env),ret)}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];ret=Math.max(xs[k](env),ret)}}return ret}),symbol_1.default(symbol_table_1.default.core.math.floor,staticAttr)(function(env,v){return Math.floor(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.ceil,staticAttr)(function(env,v){return Math.ceil(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.roundInt,staticAttr)(function(env,v){return Math.round(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.abs,staticAttr)(function(env,v){return Math.abs(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.sqrt,staticAttr)(function(env,v){return Math.sqrt(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.sin,staticAttr)(function(env,v){return Math.sin(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.cos,staticAttr)(function(env,v){return Math.cos(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.tan,staticAttr)(function(env,v){return Math.tan(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.asin,staticAttr)(function(env,v){return Math.asin(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.acos,staticAttr)(function(env,v){return Math.acos(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.atan,staticAttr)(function(env,v){return Math.atan(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.sinh,staticAttr)(function(env,v){return Math.sinh(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.cosh,staticAttr)(function(env,v){return Math.cosh(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.tanh,staticAttr)(function(env,v){return Math.tanh(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.exp,staticAttr)(function(env,v){return Math.exp(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.log,staticAttr)(function(env,v){return Math.log(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.log10,staticAttr)(function(env,v){return Math.log10(v[0](env))}),symbol_1.default(symbol_table_1.default.core.math.atan2,staticAttr)(function(env,v){return Math.atan2(v[0](env),v[1](env))}),symbol_1.default(symbol_table_1.default.core.str.match,staticAttr)(function(env,v){return v[0](env).test(v[1](env))}),symbol_1.default(symbol_table_1.default.core.str.concat,staticAttr)(function(env,xs){var ret=[];if(typeof xs.length==="number"){for(var i=0,_i=xs.length;i<_i;i++)ret.push(xs[i](env).toString())}else{for(var _a=0,_b=Object.keys(xs);_a<_b.length;_a++){var k=_b[_a];ret.push(xs[k](env).toString())}}return ret.join("")}),symbol_1.default(symbol_table_1.default.core.list.getAt,staticAttr)(function(env,v){return v[0](env)[v[1](env)]}),symbol_1.default(symbol_table_1.default.core.set.has,staticAttr)(function(env,v){return v[0](env).has(v[1](env))}),symbol_1.default(symbol_table_1.default.core.set.isSubset,staticAttr)(function(env,v){return collections_1.FastSet.isSubset(v[0](env),v[1](env))}),symbol_1.default(symbol_table_1.default.core.flags.hasAny,staticAttr)(function(env,v){var test=v[1](env);var tested=v[0](env);if(!test)return!!tested;return(tested&test)!==0}),symbol_1.default(symbol_table_1.default.core.flags.hasAll,staticAttr)(function(env,v){var test=v[1](env);var tested=v[0](env);if(!test)return!tested;return(tested&test)===test}),symbol_1.default(symbol_table_1.default.structure.type.elementSymbol,staticAttr)(function(env,v){return data_1.ElementSymbol(v[0](env))}),symbol_1.default(symbol_table_1.default.structure.type.atomName,staticAttr)(function(env,v){return upper_case_1.default(v[0](env))}),symbol_1.default(symbol_table_1.default.structure.type.bondFlags,staticAttr)(function(env,v){return structure_1.default.BondProperties.createFlags(env,v)}),symbol_1.default(symbol_table_1.default.structure.type.secondaryStructureFlags,staticAttr)(function(env,v){return structure_1.default.AtomProperties.createSecondaryStructureFlags(env,v)}),symbol_1.default(symbol_table_1.default.structure.type.entityType,staticAttr)(function(env,v){return structure_1.default.Common.entityType(v[0](env))}),symbol_1.default(symbol_table_1.default.structure.type.ringFingerprint,staticAttr)(function(env,v){return structure_1.default.Common.ringFingerprint(env,v)}),symbol_1.default(symbol_table_1.default.structure.type.authResidueId,staticAttr)(function(env,v){return data_1.ResidueIdentifier.auth(v[0](env),v[1](env),v[2]&&v[2](env))}),symbol_1.default(symbol_table_1.default.structure.type.labelResidueId,staticAttr)(function(env,v){return data_1.ResidueIdentifier.label(v[0](env),v[1](env),v[2](env),v[3]&&v[3](env))}),symbol_1.default(symbol_table_1.default.structure.slot.atom)(function(env,v){return env.slots.element}),symbol_1.default(symbol_table_1.default.structure.slot.atomSetReduce)(function(env,v){return env.slots.atomSetReducer}),symbol_1.default(symbol_table_1.default.structure.generator.atomGroups)(function(env,v){return function(env){return structure_1.default.Generators.atomGroupsGenerator(env,{entityTest:v["entity-test"],chainTest:v["chain-test"],residueTest:v["residue-test"],atomTest:v["atom-test"],groupBy:v["group-by"]})}}),symbol_1.default(symbol_table_1.default.structure.generator.queryInSelection)(function(env,v){return function(env){return structure_1.default.Generators.querySelection(env,v[0](env),v.query(env),v["in-complement"])}}),symbol_1.default(symbol_table_1.default.structure.generator.rings)(function(env,v){return function(env){return structure_1.default.Generators.rings(env,v)}}),symbol_1.default(symbol_table_1.default.structure.generator.empty)(function(env,v){return function(env){return structure_1.default.Generators.empty(env)}}),symbol_1.default(symbol_table_1.default.structure.modifier.queryEach)(function(env,v){return function(env){return structure_1.default.Modifiers.queryEach(env,v[0](env),v.query(env))}}),symbol_1.default(symbol_table_1.default.structure.modifier.intersectBy)(function(env,v){return function(env){return structure_1.default.Modifiers.intersectBy(env,v[0](env),v.by(env))}}),symbol_1.default(symbol_table_1.default.structure.modifier.exceptBy)(function(env,v){return function(env){return structure_1.default.Modifiers.exceptBy(env,v[0](env),v.by(env))}}),symbol_1.default(symbol_table_1.default.structure.modifier.unionBy)(function(env,v){return function(env){return structure_1.default.Modifiers.unionBy(env,v[0](env),v.by(env))}}),symbol_1.default(symbol_table_1.default.structure.modifier.union)(function(env,v){return function(env){return structure_1.default.Modifiers.union(env,v[0](env))}}),symbol_1.default(symbol_table_1.default.structure.modifier.cluster)(function(env,v){return function(env){return structure_1.default.Modifiers.cluster(env,{selection:v[0](env),minDist:v["min-distance"],maxDist:v["max-distance"],minSize:v["min-size"],maxSize:v["max-size"]})}}),symbol_1.default(symbol_table_1.default.structure.modifier.includeSurroundings)(function(env,v){return function(env){return structure_1.default.Modifiers.includeSurroundings(env,{selection:v[0](env),radius:v.radius,atomRadius:v["atom-radius"],wholeResidues:v["as-whole-residues"]})}}),symbol_1.default(symbol_table_1.default.structure.modifier.includeConnected)(function(env,v){return function(env){return structure_1.default.Modifiers.includeConnected(env,{selection:v[0](env),bondTest:v["bond-test"],layerCount:v["layer-count"],wholeResidues:v["as-whole-residues"]})}}),symbol_1.default(symbol_table_1.default.structure.modifier.expandProperty)(function(env,v){return function(env){return structure_1.default.Modifiers.expandProperty(env,v[0](env),v.property)}}),symbol_1.default(symbol_table_1.default.structure.filter.pick)(function(env,v){return function(env){return structure_1.default.Filters.pick(env,v[0](env),v.test)}}),symbol_1.default(symbol_table_1.default.structure.filter.withSameAtomProperties)(function(env,v){return function(env){return structure_1.default.Filters.withSameAtomProperties(env,v[0](env),v.source(env),v.property)}}),symbol_1.default(symbol_table_1.default.structure.filter.intersectedBy)(function(env,v){return function(env){return structure_1.default.Filters.areIntersectedBy(env,v[0](env),v.by(env))}}),symbol_1.default(symbol_table_1.default.structure.filter.within)(function(env,v){return function(env){return structure_1.default.Filters.within(env,{selection:v[0](env),target:v.target(env),minRadius:v["min-radius"],maxRadius:v["max-radius"],atomRadius:v["atom-radius"],invert:v["invert"]})}}),symbol_1.default(symbol_table_1.default.structure.filter.isConnectedTo)(function(env,v){return function(env){return structure_1.default.Filters.isConnectedTo(env,{selection:v[0](env),target:v.target(env),bondTest:v["bond-test"],invert:v.invert,disjunct:v.disjunct})}}),symbol_1.default(symbol_table_1.default.structure.combinator.intersect)(function(env,xs){return function(env){return structure_1.default.Combinators.intersect(env,xs)}}),symbol_1.default(symbol_table_1.default.structure.combinator.merge)(function(env,xs){return function(env){return structure_1.default.Combinators.merge(env,xs)}}),symbol_1.default(symbol_table_1.default.structure.combinator.distanceCluster)(function(env,v){return function(env){return structure_1.default.Combinators.distanceCluster(env,v.matrix,v.selections)}}),symbol_1.default(symbol_table_1.default.structure.atomSet.atomCount)(function(env,v){return structure_1.default.AtomSet.atomCount(env)}),symbol_1.default(symbol_table_1.default.structure.atomSet.countQuery)(function(env,v){return structure_1.default.AtomSet.countQuery(env,v[0](env))}),symbol_1.default(symbol_table_1.default.structure.atomSet.reduce)(function(env,v){return structure_1.default.AtomSet.accumulateAtomSet(env,v.initial,v.value)}),symbol_1.default(symbol_table_1.default.structure.atomSet.propertySet)(function(env,v){return structure_1.default.AtomSet.propertySet(env,v[0])})].concat(props(symbol_table_1.default.structure.atomProperty.core,structure_1.default.AtomProperties.Core),props(symbol_table_1.default.structure.atomProperty.topology,structure_1.default.AtomProperties.Topology),props(symbol_table_1.default.structure.atomProperty.macromolecular,structure_1.default.AtomProperties.Macromolecular),props(symbol_table_1.default.structure.bondProperty,structure_1.default.BondProperties.Properties));function props(symbols,implementation){return Object.keys(symbols).filter(function(k){return symbol_2.isSymbol(symbols[k])&&!!implementation[k]}).map(function(k){return symbol_1.default(symbols[k])(implementation[k])})}var table=function(){var ret=Object.create(null);for(var _a=0,SymbolRuntime_1=exports.SymbolRuntime;_a<SymbolRuntime_1.length;_a++){var r=SymbolRuntime_1[_a];if(ret[r.symbol.id]){throw new Error("You've already implemented '"+r.symbol.id+"', dummy.")}ret[r.symbol.id]=r}return ret}();exports.default=table},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var collections_1=__webpack_require__(8);var mask_1=__webpack_require__(27);var utils_1=__webpack_require__(152);var data_1=__webpack_require__(13);var __ElementIndex={H:0,h:0,D:0,d:0,T:0,t:0,He:2,HE:2,he:2,Li:3,LI:3,li:3,Be:4,BE:4,be:4,B:5,b:5,C:6,c:6,N:7,n:7,O:8,o:8,F:9,f:9,Ne:10,NE:10,ne:10,Na:11,NA:11,na:11,Mg:12,MG:12,mg:12,Al:13,AL:13,al:13,Si:14,SI:14,si:14,P:15,p:15,S:16,s:16,Cl:17,CL:17,cl:17,Ar:18,AR:18,ar:18,K:19,k:19,Ca:20,CA:20,ca:20,Sc:21,SC:21,sc:21,Ti:22,TI:22,ti:22,V:23,v:23,Cr:24,CR:24,cr:24,Mn:25,MN:25,mn:25,Fe:26,FE:26,fe:26,Co:27,CO:27,co:27,Ni:28,NI:28,ni:28,Cu:29,CU:29,cu:29,Zn:30,ZN:30,zn:30,Ga:31,GA:31,ga:31,Ge:32,GE:32,ge:32,As:33,AS:33,as:33,Se:34,SE:34,se:34,Br:35,BR:35,br:35,Kr:36,KR:36,kr:36,Rb:37,RB:37,rb:37,Sr:38,SR:38,sr:38,Y:39,y:39,Zr:40,ZR:40,zr:40,Nb:41,NB:41,nb:41,Mo:42,MO:42,mo:42,Tc:43,TC:43,tc:43,Ru:44,RU:44,ru:44,Rh:45,RH:45,rh:45,Pd:46,PD:46,pd:46,Ag:47,AG:47,ag:47,Cd:48,CD:48,cd:48,In:49,IN:49,in:49,Sn:50,SN:50,sn:50,Sb:51,SB:51,sb:51,Te:52,TE:52,te:52,I:53,i:53,Xe:54,XE:54,xe:54,Cs:55,CS:55,cs:55,Ba:56,BA:56,ba:56,La:57,LA:57,la:57,Ce:58,CE:58,ce:58,Pr:59,PR:59,pr:59,Nd:60,ND:60,nd:60,Pm:61,PM:61,pm:61,Sm:62,SM:62,sm:62,Eu:63,EU:63,eu:63,Gd:64,GD:64,gd:64,Tb:65,TB:65,tb:65,Dy:66,DY:66,dy:66,Ho:67,HO:67,ho:67,Er:68,ER:68,er:68,Tm:69,TM:69,tm:69,Yb:70,YB:70,yb:70,Lu:71,LU:71,lu:71,Hf:72,HF:72,hf:72,Ta:73,TA:73,ta:73,W:74,w:74,Re:75,RE:75,re:75,Os:76,OS:76,os:76,Ir:77,IR:77,ir:77,Pt:78,PT:78,pt:78,Au:79,AU:79,au:79,Hg:80,HG:80,hg:80,Tl:81,TL:81,tl:81,Pb:82,PB:82,pb:82,Bi:83,BI:83,bi:83,Po:84,PO:84,po:84,At:85,AT:85,at:85,Rn:86,RN:86,rn:86,Fr:87,FR:87,fr:87,Ra:88,RA:88,ra:88,Ac:89,AC:89,ac:89,Th:90,TH:90,th:90,Pa:91,PA:91,pa:91,U:92,u:92,Np:93,NP:93,np:93,Pu:94,PU:94,pu:94,Am:95,AM:95,am:95,Cm:96,CM:96,cm:96,Bk:97,BK:97,bk:97,Cf:98,CF:98,cf:98,Es:99,ES:99,es:99,Fm:100,FM:100,fm:100,Md:101,MD:101,md:101,No:102,NO:102,no:102,Lr:103,LR:103,lr:103,Rf:104,RF:104,rf:104,Db:105,DB:105,db:105,Sg:106,SG:106,sg:106,Bh:107,BH:107,bh:107,Hs:108,HS:108,hs:108,Mt:109,MT:109,mt:109};var __ElementBondThresholds={0:1.42,1:1.42,3:2.7,4:2.7,6:1.75,7:1.6,8:1.52,11:2.7,12:2.7,13:2.7,14:1.9,15:1.9,16:1.9,17:1.8,19:2.7,20:2.7,21:2.7,22:2.7,23:2.7,24:2.7,25:2.7,26:2.7,27:2.7,28:2.7,29:2.7,30:2.7,31:2.7,33:2.68,37:2.7,38:2.7,39:2.7,40:2.7,41:2.7,42:2.7,43:2.7,44:2.7,45:2.7,46:2.7,47:2.7,48:2.7,49:2.7,50:2.7,55:2.7,56:2.7,57:2.7,58:2.7,59:2.7,60:2.7,61:2.7,62:2.7,63:2.7,64:2.7,65:2.7,66:2.7,67:2.7,68:2.7,69:2.7,70:2.7,71:2.7,72:2.7,73:2.7,74:2.7,75:2.7,76:2.7,77:2.7,78:2.7,79:2.7,80:2.7,81:2.7,82:2.7,83:2.7,87:2.7,88:2.7,89:2.7,90:2.7,91:2.7,92:2.7,93:2.7,94:2.7,95:2.7,96:2.7,97:2.7,98:2.7,99:2.7,100:2.7,101:2.7,102:2.7,103:2.7,104:2.7,105:2.7,106:2.7,107:2.7,108:2.7,109:2.88};var __ElementPairThresholds={0:.8,20:1.31,27:1.3,35:1.3,44:1.05,54:1,60:1.84,72:1.88,84:1.75,85:1.56,86:1.76,98:1.6,99:1.68,100:1.63,112:1.55,113:1.59,114:1.36,129:1.45,144:1.6,170:1.4,180:1.55,202:2.4,222:2.24,224:1.91,225:1.98,243:2.02,269:2,293:1.9,480:2.3,512:2.3,544:2.3,612:2.1,629:1.54,665:1,813:2.6,854:2.27,894:1.93,896:2.1,937:2.05,938:2.06,981:1.62,1258:2.68,1309:2.33,1484:1,1763:2.14,1823:2.48,1882:2.1,1944:1.72,2380:2.34,3367:2.44,3733:2.11,3819:2.6,3821:2.36,4736:2.75,5724:2.73,5959:2.63,6519:2.84,6750:2.87,8991:2.81};var __DefaultBondingRadius=2.001;var MetalsSet=function(){var metals=["LI","NA","K","RB","CS","FR","BE","MG","CA","SR","BA","RA","AL","GA","IN","SN","TL","PB","BI","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","Y","ZR","NB","MO","TC","RU","RH","PD","AG","CD","LA","HF","TA","W","RE","OS","IR","PT","AU","HG","AC","RF","DB","SG","BH","HS","MT","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","TH","PA","U","NP","PU","AM","CM","BK","CF","ES","FM","MD","NO","LR"];var set=collections_1.FastSet.create();for(var _a=0,metals_1=metals;_a<metals_1.length;_a++){var m=metals_1[_a];set.add(__ElementIndex[m])}return set}();function pair(a,b){if(a<b)return(a+b)*(a+b+1)/2+b;else return(a+b)*(a+b+1)/2+a}function idx(e){var i=__ElementIndex[e];if(i===void 0)return-1;return i}function pairThreshold(i,j){if(i<0||j<0)return-1;var r=__ElementPairThresholds[pair(i,j)];if(r===void 0)return-1;return r}function threshold(i){if(i<0)return __DefaultBondingRadius;var r=__ElementBondThresholds[i];if(r===void 0)return __DefaultBondingRadius;return r}var H_ID=__ElementIndex["H"];function isHydrogen(i){return i===H_ID}function computePerAtomBonds(atomA,atomB,_order,_flags,atomCount){var bucketSizes=new Int32Array(atomCount);var bucketOffsets=new Int32Array(atomCount+1);var bucketFill=new Int32Array(atomCount);for(var _a=0,atomA_1=atomA;_a<atomA_1.length;_a++){var i=atomA_1[_a];bucketSizes[i]++}for(var _b=0,atomB_1=atomB;_b<atomB_1.length;_b++){var i=atomB_1[_b];bucketSizes[i]++}var offset=0;for(var i=0;i<atomCount;i++){bucketOffsets[i]=offset;offset+=bucketSizes[i]}bucketOffsets[atomCount]=offset;var neighbor=new Int32Array(offset);var flags=new Uint16Array(offset);var order=new Int8Array(offset);for(var i=0,_i=atomA.length;i<_i;i++){var a=atomA[i],b=atomB[i],f=_flags[i],o=_order[i];var oa=bucketOffsets[a]+bucketFill[a];var ob=bucketOffsets[b]+bucketFill[b];neighbor[oa]=b;flags[oa]=f;order[oa]=o;bucketFill[a]++;neighbor[ob]=a;flags[ob]=f;order[ob]=o;bucketFill[b]++}return{offsets:bucketOffsets,neighbor:neighbor,flags:flags,order:order}}function _computeBonds(model,params){var MAX_RADIUS=3;var _a=model.positions,x=_a.x,y=_a.y,z=_a.z;var _b=model.atoms,residueIndex=_b.residueIndex,dataIndex=_b.dataIndex,atomCount=_b.count;var _c=model.data.atom_site,type_symbol=_c.type_symbol,label_comp_id=_c.label_comp_id,label_atom_id=_c.label_atom_id,label_alt_id=_c.label_alt_id;var query3d=data_1.Model.spatialLookup(model).find(mask_1.default.always(model.atoms.count));var structConn=utils_1.StructConn.create(model),component=utils_1.ComponentBondInfo.create(model);var atomA=[];var atomB=[];var flags=[];var order=[];var lastResidue=-1;var componentMap=void 0;for(var aI=0;aI<atomCount;aI++){var raI=residueIndex[aI];var rowA=dataIndex[aI];if(!params.forceCompute&&raI!==lastResidue){var resn=label_comp_id.getString(rowA);if(!!component&&component.entries.has(resn)){componentMap=component.entries.get(resn).map}else{componentMap=void 0}}lastResidue=raI;var componentPairs=componentMap?componentMap.get(label_atom_id.getString(rowA)):void 0;var aeI=idx(type_symbol.getString(rowA));var _d=query3d(x[aI],y[aI],z[aI],MAX_RADIUS),indices=_d.indices,count=_d.count,squaredDistances=_d.squaredDistances;var isHa=isHydrogen(aeI);var thresholdA=threshold(aeI);var altA=label_alt_id.getString(rowA);var metalA=MetalsSet.has(aeI);var structConnEntries=params.forceCompute?void 0:structConn&&structConn.getAtomEntries(aI);for(var ni=0;ni<count;ni++){var bI=indices[ni];if(bI<=aI)continue;var rowB=dataIndex[bI];var altB=label_alt_id.getString(rowB);if(altA&&altB&&altA!==altB)continue;var beI=idx(type_symbol.getString(rowB));var isMetal=metalA||MetalsSet.has(beI);var rbI=residueIndex[bI];if(raI===rbI&&componentPairs){var e=componentPairs.get(label_atom_id.getString(rowB));if(e){atomA[atomA.length]=aI;atomB[atomB.length]=bI;order[order.length]=e.order;var flag=e.flags;if(isMetal){if(flag|1)flag^=1;flag|=2}flags[flags.length]=flag}continue}var isHb=isHydrogen(beI);if(isHa&&isHb)continue;var dist=Math.sqrt(squaredDistances[ni]);if(dist===0)continue;if(structConnEntries&&structConnEntries.length){var added=false;for(var _e=0,structConnEntries_1=structConnEntries;_e<structConnEntries_1.length;_e++){var se=structConnEntries_1[_e];for(var _f=0,_g=se.partners;_f<_g.length;_f++){var p=_g[_f];if(p.atomIndex===bI){atomA[atomA.length]=aI;atomB[atomB.length]=bI;flags[flags.length]=se.flags;order[order.length]=se.order;added=true;break}}if(added)break}if(added)continue}if(isHa||isHb){if(dist<params.maxHbondLength){atomA[atomA.length]=aI;atomB[atomB.length]=bI;order[order.length]=1;flags[flags.length]=1|64}continue}var thresholdAB=pairThreshold(aeI,beI);var pairingThreshold=thresholdAB>0?thresholdAB:beI<0?thresholdA:Math.max(thresholdA,threshold(beI));if(dist<=pairingThreshold){atomA[atomA.length]=aI;atomB[atomB.length]=bI;order[order.length]=1;flags[flags.length]=(isMetal?2:1)|64}}}var bonds=computePerAtomBonds(atomA,atomB,order,flags,atomCount);return{offset:bonds.offsets,neighbor:bonds.neighbor,flags:bonds.flags,order:bonds.order,count:atomA.length}}function computeBonds(model,params){return _computeBonds(model,{maxHbondLength:params&&params.maxHbondLength||1.15,forceCompute:!!(params&&params.forceCompute)})}exports.default=computeBonds},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var collections_1=__webpack_require__(8);var data_1=__webpack_require__(13);var ciftools_js_1=__webpack_require__(43);var StructConn=function(){function StructConn(entries){this.entries=entries;this._residuePairIndex=void 0;this._atomIndex=void 0}StructConn._resKey=function(rA,rB){if(rA<rB)return rA+"-"+rB;return rB+"-"+rA};StructConn.prototype.getResiduePairIndex=function(){if(this._residuePairIndex)return this._residuePairIndex;this._residuePairIndex=collections_1.FastMap.create();for(var _i=0,_a=this.entries;_i<_a.length;_i++){var e=_a[_i];var ps=e.partners;var l=ps.length;for(var i=0;i<l-1;i++){for(var j=i+i;j<l;j++){var key=StructConn._resKey(ps[i].residueIndex,ps[j].residueIndex);if(this._residuePairIndex.has(key)){this._residuePairIndex.get(key).push(e)}else{this._residuePairIndex.set(key,[e])}}}}return this._residuePairIndex};StructConn.prototype.getAtomIndex=function(){if(this._atomIndex)return this._atomIndex;this._atomIndex=collections_1.FastMap.create();for(var _i=0,_a=this.entries;_i<_a.length;_i++){var e=_a[_i];for(var _b=0,_c=e.partners;_b<_c.length;_b++){var p=_c[_b];var key=p.atomIndex;if(this._atomIndex.has(key)){this._atomIndex.get(key).push(e)}else{this._atomIndex.set(key,[e])}}}return this._atomIndex};StructConn.prototype.getResidueEntries=function(residueAIndex,residueBIndex){return this.getResiduePairIndex().get(StructConn._resKey(residueAIndex,residueBIndex))||StructConn._emptyEntry};StructConn.prototype.getAtomEntries=function(atomIndex){return this.getAtomIndex().get(atomIndex)||StructConn._emptyEntry};StructConn._emptyEntry=[];return StructConn}();exports.StructConn=StructConn;(function(StructConn){function create(model){var structConn=model.data.bonds.structConn;if(!structConn.rowCount)return void 0;var _structConn=structConn;var _idCols=function(i){return{label_asym_id:_structConn["ptnr"+i+"_label_asym_id"],label_seq_id:_structConn["ptnr"+i+"_label_seq_id"],label_atom_id:_structConn["ptnr"+i+"_label_atom_id"],label_alt_id:_structConn["pdbx_ptnr"+i+"_label_alt_id"],ins_code:_structConn["pdbx_ptnr"+i+"_PDB_ins_code"],symmetry:_structConn["ptnr"+i+"_symmetry"]}};var conn_type_id=structConn.conn_type_id,pdbx_dist_value=structConn.pdbx_dist_value,pdbx_value_order=structConn.pdbx_value_order;var p1=_idCols(1);var p2=_idCols(2);var _p=function(row,ps){if(ps.label_asym_id.getValuePresence(row)!==0)return void 0;var residueIndex=data_1.Model.findResidueIndexByLabel(model,ps.label_asym_id.getString(row),ps.label_seq_id.getInteger(row),ps.ins_code.getString(row));if(residueIndex<0)return void 0;var atomName=ps.label_atom_id.getString(row);if(!atomName)return void 0;var atomIndex=data_1.Model.findAtomIndexByLabelName(model,residueIndex,atomName,ps.label_alt_id.getString(row));if(atomIndex<0)return void 0;return{residueIndex:residueIndex,atomIndex:atomIndex,symmetry:ps.symmetry.getString(row)||"1_555"}};var _ps=function(row){var ret=[];var p=_p(row,p1);if(p)ret.push(p);p=_p(row,p2);if(p)ret.push(p);return ret};var entries=[];for(var i=0;i<structConn.rowCount;i++){var partners=_ps(i);if(partners.length<2)continue;var type=conn_type_id.getString(i);var orderType=(pdbx_value_order.getString(i)||"").toLowerCase();var flags=0;var order=1;switch(orderType){case"sing":order=1;break;case"doub":order=2;break;case"trip":order=3;break;case"quad":order=4;break}switch(type){case"covale":case"covale_base":case"covale_phosphate":case"covale_sugar":case"modres":flags=1;break;case"disulf":flags=1|16;break;case"hydrog":flags=4;break;case"metalc":flags=2;break;case"saltbr":flags=8;break}entries.push({flags:flags,order:order,distance:pdbx_dist_value.getFloat(i),partners:partners})}return new StructConn(entries)}StructConn.create=create})(StructConn=exports.StructConn||(exports.StructConn={}));exports.StructConn=StructConn;var ComponentBondInfo=function(){function ComponentBondInfo(){this.entries=collections_1.FastMap.create()}ComponentBondInfo.prototype.newEntry=function(id){var e=new ComponentBondInfo.Entry(id);this.entries.set(id,e);return e};return ComponentBondInfo}();exports.ComponentBondInfo=ComponentBondInfo;(function(ComponentBondInfo){var Entry=function(){function Entry(id){this.id=id;this.map=collections_1.FastMap.create()}Entry.prototype.add=function(a,b,order,flags,swap){if(swap===void 0){swap=true}var e=this.map.get(a);if(e!==void 0){var f=e.get(b);if(f===void 0){e.set(b,{order:order,flags:flags})}}else{var map=collections_1.FastMap.create();map.set(b,{order:order,flags:flags});this.map.set(a,map)}if(swap)this.add(b,a,order,flags,false)};return Entry}();ComponentBondInfo.Entry=Entry;function create(model){var chemCompBond=model.data.bonds.chemCompBond;if(!chemCompBond.rowCount)return void 0;var info=new ComponentBondInfo;var comp_id=chemCompBond.comp_id,atom_id_1=chemCompBond.atom_id_1,atom_id_2=chemCompBond.atom_id_2,value_order=chemCompBond.value_order,pdbx_aromatic_flag=chemCompBond.pdbx_aromatic_flag,rowCount=chemCompBond.rowCount;var entry=info.newEntry(comp_id.getString(0));for(var i=0;i<rowCount;i++){var id=comp_id.getString(i);var nameA=atom_id_1.getString(i);var nameB=atom_id_2.getString(i);var order=value_order.getString(i);var aromatic=pdbx_aromatic_flag.stringEquals(i,"Y")||pdbx_aromatic_flag.stringEquals(i,"y");if(entry.id!==id){entry=info.newEntry(id)}var flags=1;var ord=1;if(aromatic)flags|=32;switch(order.toLowerCase()){case"doub":case"delo":ord=2;break;case"trip":ord=3;break;case"quad":ord=4;break}entry.add(nameA,nameB,ord,flags)}return info}ComponentBondInfo.create=create})(ComponentBondInfo=exports.ComponentBondInfo||(exports.ComponentBondInfo={}));exports.ComponentBondInfo=ComponentBondInfo},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var linked_index_1=__webpack_require__(154);var data_1=__webpack_require__(13);function labelComponent(bonds,labels,head,index,label){var stack=[head];linked_index_1.default.remove(index,head);var neighbor=bonds.neighbor,bondAtomOffset=bonds.offset,flags=bonds.flags;while(stack.length){var a=stack.pop();labels[a]=label;var start=bondAtomOffset[a],end=bondAtomOffset[a+1];for(var i=start;i<end;i++){var b=neighbor[i];if(!linked_index_1.default.has(index,b)||!data_1.Bonds.isCovalent(flags[i]))continue;stack.push(b);linked_index_1.default.remove(index,b)}}}function findComponents(model){var index=linked_index_1.default(model.atoms.count);var labels=new Int32Array(model.atoms.count);var bonds=data_1.Model.bonds(model);var label=0;while(index.head>=0){labelComponent(bonds,labels,index.head,index,label);label++}return labels}exports.default=findComponents},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function LinkedIndex(size){var ret={head:size>0?0:-1,prev:new Int32Array(size),next:new Int32Array(size)};for(var i=0;i<size;i++){ret.next[i]=i+1;ret.prev[i]=i-1}ret.prev[0]=-1;ret.next[size-1]=-1;return ret}(function(LinkedIndex){function has(_a,i){var prev=_a.prev,next=_a.next;return prev[i]>=0||next[i]>=0}LinkedIndex.has=has;function remove(index,i){var prev=index.prev,next=index.next;var p=prev[i],n=next[i];if(p>=0){next[p]=n;prev[i]=-1}if(n>=0){prev[n]=p;next[i]=-1}if(i===index.head){if(p<0)index.head=n;else index.head=p}}LinkedIndex.remove=remove})(LinkedIndex||(LinkedIndex={}));exports.default=LinkedIndex},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var data_1=__webpack_require__(13);function computeRings(model){var size=largestResidue(model);var state=State(model,size);for(var i=0,_i=model.residues.count;i<_i;i++){processResidue(state,i)}return state.rings}exports.default=computeRings;function State(model,capacity){return{startVertex:0,endVertex:0,count:0,visited:new Int32Array(capacity),queue:new Int32Array(capacity),pred:new Int32Array(capacity),left:new Int32Array(4),right:new Int32Array(4),color:new Int32Array(capacity),currentColor:0,rings:[],model:model,bonds:data_1.Model.bonds(model)}}function resetState(state){state.count=state.endVertex-state.startVertex;var visited=state.visited,pred=state.pred,color=state.color;for(var i=0;i<state.count;i++){visited[i]=-1;pred[i]=-1;color[i]=0}state.currentColor=0}function largestResidue(_a){var residues=_a.residues;var atomOffset=residues.atomOffset,count=residues.count;var size=0;for(var i=0;i<count;i++)size=Math.max(size,atomOffset[i+1]-atomOffset[i]);return size}function processResidue(state,rI){var atomOffset=state.model.residues.atomOffset;var visited=state.visited;state.startVertex=atomOffset[rI];state.endVertex=atomOffset[rI+1];if(state.endVertex-state.startVertex<3)return;resetState(state);for(var i=0;i<state.count;i++){if(visited[i]>=0)continue;findRings(state,i)}}function addRing(state,a,b){if(b<a)return;var pred=state.pred,color=state.color,left=state.left,right=state.right;var nc=++state.currentColor;var current=a;for(var t=0;t<4;t++){color[current]=nc;current=pred[current];if(current<0)break}var leftOffset=0,rightOffset=0;var found=false,target=0;current=b;for(var t=0;t<4;t++){if(color[current]===nc){target=current;found=true;break}right[rightOffset++]=current;current=pred[current];if(current<0)break}if(!found)return;current=a;for(var t=0;t<4;t++){left[leftOffset++]=current;if(target===current)break;current=pred[current];if(current<0)break}var ring=new Int32Array(leftOffset+rightOffset);var ringOffset=0;for(var t=0;t<leftOffset;t++)ring[ringOffset++]=state.startVertex+left[t];for(var t=rightOffset-1;t>=0;t--)ring[ringOffset++]=state.startVertex+right[t];state.rings.push(ring)}function findRings(state,from){var bonds=state.bonds,startVertex=state.startVertex,endVertex=state.endVertex,visited=state.visited,queue=state.queue,pred=state.pred;var neighbor=bonds.neighbor,bondFlags=bonds.flags,offset=bonds.offset;visited[from]=1;queue[0]=from;var head=0,size=1;while(head<size){var top_1=queue[head++];var a=startVertex+top_1;var start=offset[a],end=offset[a+1];for(var i=start;i<end;i++){var b=neighbor[i];if(b<startVertex||b>=endVertex||!data_1.Bonds.isCovalent(bondFlags[i]))continue;var other=b-startVertex;if(visited[other]>0){if(pred[other]!==top_1&&pred[top_1]!==other)addRing(state,top_1,other);continue}visited[other]=1;queue[size++]=other;pred[other]=top_1}}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AtomicNumbers={H:1,D:1,T:1,HE:2,LI:3,BE:4,B:5,C:6,N:7,O:8,F:9,NE:10,NA:11,MG:12,AL:13,SI:14,P:15,S:16,CL:17,AR:18,K:19,CA:20,SC:21,TI:22,V:23,CR:24,MN:25,FE:26,CO:27,NI:28,CU:29,ZN:30,GA:31,GE:32,AS:33,SE:34,BR:35,KR:36,RB:37,SR:38,Y:39,ZR:40,NB:41,MO:42,TC:43,RU:44,RH:45,PD:46,AG:47,CD:48,IN:49,SN:50,SB:51,TE:52,I:53,XE:54,CS:55,BA:56,LA:57,CE:58,PR:59,ND:60,PM:61,SM:62,EU:63,GD:64,TB:65,DY:66,HO:67,ER:68,TM:69,YB:70,LU:71,HF:72,TA:73,W:74,RE:75,OS:76,IR:77,PT:78,AU:79,HG:80,TL:81,PB:82,BI:83,PO:84,AT:85,RN:86,FR:87,RA:88,AC:89,TH:90,PA:91,U:92,NP:93,PU:94,AM:95,CM:96,BK:97,CF:98,ES:99,FM:100,MD:101,NO:102,LR:103,RF:104,DB:105,SG:106,BH:107,HS:108,MT:109};exports.ElementVdwRadii={1:1.1,2:1.4,3:1.81,4:1.53,5:1.92,6:1.7,7:1.55,8:1.52,9:1.47,10:1.54,11:2.27,12:1.73,13:1.84,14:2.1,15:1.8,16:1.8,17:1.75,18:1.88,19:2.75,20:2.31,21:2.3,22:2.15,23:2.05,24:2.05,25:2.05,26:2.05,27:2,28:2,29:2,30:2.1,31:1.87,32:2.11,33:1.85,34:1.9,35:1.83,36:2.02,37:3.03,38:2.49,39:2.4,40:2.3,41:2.15,42:2.1,43:2.05,44:2.05,45:2,46:2.05,47:2.1,48:2.2,49:2.2,50:1.93,51:2.17,52:2.06,53:1.98,54:2.16,55:3.43,56:2.68,57:2.5,58:2.48,59:2.47,60:2.45,61:2.43,62:2.42,63:2.4,64:2.38,65:2.37,66:2.35,67:2.33,68:2.32,69:2.3,70:2.28,71:2.27,72:2.25,73:2.2,74:2.1,75:2.05,76:2,77:2,78:2.05,79:2.1,80:2.05,81:1.96,82:2.02,83:2.07,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:2.4,91:2,92:2.3,93:2,94:2,95:2,96:2,97:2,98:2,99:2,100:2,101:2,102:2,103:2,104:2,105:2,106:2,107:2,108:2,109:2};exports.ElementAtomWeights={1:1.008,2:4.0026,3:6.94,4:9.0122,5:10.81,6:10.81,7:14.007,8:15.999,9:18.998,10:20.18,11:22.99,12:24.305,13:26.982,14:28.085,15:30.974,16:32.06,17:35.45,18:39.948,19:39.098,20:40.078,21:44.956,22:47.867,23:50.942,24:51.996,25:54.938,26:55.845,27:58.933,28:58.693,29:63.546,30:65.38,31:69.723,32:72.63,33:74.922,34:78.971,35:79.904,36:83.798,37:85.468,38:87.62,39:88.906,40:91.224,41:92.906,42:95.95,43:96.906,44:101.07,45:102.91,46:106.42,47:107.87,48:112.41,49:114.82,50:118.71,51:121.76,52:127.6,53:127.6,54:131.29,55:132.91,56:137.33,57:138.91,58:140.12,59:140.91,60:144.24,61:144.912,62:150.36,63:151.96,64:157.25,65:158.93,66:162.5,67:164.93,68:167.26,69:168.93,70:173.05,71:174.97,72:178.49,73:180.95,74:183.84,75:186.21,76:190.23,77:192.22,78:195.08,79:196.97,80:200.59,81:204.38,82:207.2,83:208.98,84:1.97,85:2.02,86:2.2,87:3.48,88:2.83,89:2,90:232.04,91:231.04,92:238.03,93:237.048,94:244.064,95:243.061,96:247.07,97:247.07,98:251.079,99:252.083,100:257.095,101:258.098,102:259.101,103:262.11,104:267.122,105:270.131,106:271.134,107:270.133,108:270.134,109:278.156};exports.DefaultVdwRadius=1.7;exports.DefaultAtomWeight=10.81;exports.DefaultAtomNumber=0},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Generators=__webpack_require__(158);var Modifiers=__webpack_require__(159);var Filters=__webpack_require__(94);var Combinators=__webpack_require__(160);var AtomSet=__webpack_require__(161);var AtomProperties=__webpack_require__(162);var BondProperties=__webpack_require__(163);var Common=__webpack_require__(60);exports.default={Generators:Generators,Modifiers:Modifiers,Filters:Filters,Combinators:Combinators,AtomSet:AtomSet,AtomProperties:AtomProperties,BondProperties:BondProperties,Common:Common}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=__webpack_require__(25);var collections_1=__webpack_require__(8);var atom_set_1=__webpack_require__(14);var atom_selection_1=__webpack_require__(19);var element_address_1=__webpack_require__(26);var context_1=__webpack_require__(45);var data_1=__webpack_require__(13);var mask_1=__webpack_require__(27);function atomGroupsIterator(env,_a,groupCtx){var entityTest=_a.entityTest,chainTest=_a.chainTest,residueTest=_a.residueTest,atomTest=_a.atomTest;var ctx=env.context;var model=ctx.model,mask=ctx.mask;var _b=model.entities,chainOffset=_b.chainOffset,entityCount=_b.count;var residueOffset=model.chains.residueOffset;var atomOffset=model.residues.atomOffset;environment_1.default.lockSlot(env,"element");var element=env.slots.element;for(var eI=0;eI<entityCount;eI++){element_address_1.default.setEntityLayer(model,element,eI);if(!entityTest(env))continue;for(var cI=chainOffset[eI],_cI=chainOffset[eI+1];cI<_cI;cI++){element_address_1.default.setChainLayer(model,element,cI);if(!chainTest(env))continue;for(var rI=residueOffset[cI],_rI=residueOffset[cI+1];rI<_rI;rI++){element_address_1.default.setResidueLayer(model,element,rI);if(!residueTest(env))continue;for(var aI=atomOffset[rI],_aI=atomOffset[rI+1];aI<_aI;aI++){if(!mask.has(aI))continue;element_address_1.default.setAtomLayer(model,element,aI);if(!atomTest(env))continue;groupAtom(groupCtx,aI)}}}}environment_1.default.unlockSlot(env,"element")}function groupAtom(_a,i){var env=_a.env,groupBy=_a.groupBy,groups=_a.groups,selection=_a.selection;var key=groupBy(env);if(key===void 0)return;var atomSet;if(groups.has(key)){atomSet=groups.get(key)}else{atomSet=[];groups.set(key,atomSet);selection.push(atomSet)}atomSet.push(i)}function alwaysTrue(env){return true}function groupByAtom(env){return env.slots.element.atom}function groupAtomsSingleton(env,atomTest){var ctx=env.context;var model=ctx.model,mask=ctx.mask;var result=atom_selection_1.default.linearBuilder();environment_1.default.lockSlot(env,"element");var element=env.slots.element;for(var i=0,_i=model.atoms.count;i<_i;i++){if(!mask.has(i))continue;if(atomTest===alwaysTrue){result.add(atom_set_1.default([i]))}else{element_address_1.default.setAtom(model,element,i);if(atomTest(env))result.add(atom_set_1.default(i))}}environment_1.default.unlockSlot(env,"element");return result.getSelection()}function atomGroupsGenerator(env,params){if(!params.residueTest&&!params.chainTest&&!params.entityTest&&!params.groupBy){return groupAtomsSingleton(env,params.atomTest||alwaysTrue)}var _a=params.entityTest,entityTest=_a===void 0?alwaysTrue:_a,_b=params.chainTest,chainTest=_b===void 0?alwaysTrue:_b,_c=params.residueTest,residueTest=_c===void 0?alwaysTrue:_c,_d=params.atomTest,atomTest=_d===void 0?alwaysTrue:_d,_e=params.groupBy,groupBy=_e===void 0?groupByAtom:_e;var groupCtx={env:env,groupBy:groupBy,groups:collections_1.FastMap.create(),selection:[]};atomGroupsIterator(env,{entityTest:entityTest,chainTest:chainTest,residueTest:residueTest,atomTest:atomTest,groupBy:groupBy},groupCtx);var result=atom_selection_1.default.linearBuilder();for(var _f=0,_g=groupCtx.selection;_f<_g.length;_f++){var set=_g[_f];result.add(atom_set_1.default(set))}return result.getSelection()}exports.atomGroupsGenerator=atomGroupsGenerator;function querySelection(env,selection,query,inComplement){if(inComplement&&inComplement(env)){var selectionMask=atom_selection_1.default.getMask(selection(env));var complementCtx=context_1.default(env.context.model,mask_1.default.complement(selectionMask,env.context.mask));return query(environment_1.default(complementCtx))}else{return query(environment_1.default(context_1.default.ofAtomSelection(env.context.model,selection(env))))}}exports.querySelection=querySelection;function rings(env,fingerprints){var rings=data_1.Model.rings(env.context.model);var ret=atom_selection_1.default.linearBuilder();if(fingerprints.length){var set=collections_1.FastSet.ofArray(fingerprints.map(function(f){return f(env)}));set.forEach(function(fp){var rs=rings.byFingerprint.get(fp);if(!rs)return;for(var _a=0,rs_1=rs;_a<rs_1.length;_a++){var rI=rs_1[_a];var r=rings.all[rI];var xs=[];for(var i=0,_i=r.length;i<_i;i++)xs[xs.length]=r[i];ret.add(atom_set_1.default(collections_1.sortAsc(xs)))}})}else{for(var _a=0,_b=rings.all;_a<_b.length;_a++){var r=_b[_a];var xs=[];for(var i=0,_i=r.length;i<_i;i++)xs[xs.length]=r[i];ret.add(atom_set_1.default(collections_1.sortAsc(xs)))}}return ret.getSelection()}exports.rings=rings;function empty(env){return atom_selection_1.default.empty}exports.empty=empty},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=__webpack_require__(25);var context_1=__webpack_require__(45);var atom_set_1=__webpack_require__(14);var atom_selection_1=__webpack_require__(19);var collections_1=__webpack_require__(8);var data_1=__webpack_require__(13);var element_address_1=__webpack_require__(26);var common_1=__webpack_require__(60);var AtomSetIt=atom_set_1.default.Iterator;function queryEach(env,selection,query){var builder=atom_selection_1.default.uniqueBuilder();for(var _b=0,_c=atom_selection_1.default.atomSets(selection(env));_b<_c.length;_b++){var atomSet=_c[_b];var ctx=context_1.default.ofAtomSet(env.context,atomSet);for(var _d=0,_e=atom_selection_1.default.atomSets(query(environment_1.default(ctx)));_d<_e.length;_d++){var mappedAtomSet=_e[_d];builder.add(mappedAtomSet)}}return builder.getSelection()}exports.queryEach=queryEach;function intersectBy(env,selection,by){var mask=atom_selection_1.default.getMask(by(env));var builder=atom_selection_1.default.uniqueBuilder();var it=AtomSetIt();for(var _b=0,_c=atom_selection_1.default.atomSets(selection(env));_b<_c.length;_b++){var atomSet=_c[_b];var count=0;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(mask.has(a))count++}if(!count)continue;var intersection=new Int32Array(count);var offset=0;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(mask.has(a))intersection[offset++]=a}builder.add(atom_set_1.default(intersection))}return builder.getSelection()}exports.intersectBy=intersectBy;function exceptBy(env,selection,by){var mask=atom_selection_1.default.getMask(by(env));var builder=atom_selection_1.default.uniqueBuilder();var it=AtomSetIt();for(var _b=0,_c=atom_selection_1.default.atomSets(selection(env));_b<_c.length;_b++){var atomSet=_c[_b];var count=0;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(!mask.has(a))count++}if(!count)continue;var complement=new Int32Array(count);var offset=0;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){if(!mask.has(a))complement[offset++]=a}builder.add(atom_set_1.default(complement))}return builder.getSelection()}exports.exceptBy=exceptBy;function unionBy(env,selection,by){var atomCount=env.context.model.atoms.count;var atomSets=atom_selection_1.default.atomSets(selection(env));var glue=by(env);var occurenceCount=new Int32Array(atomCount);var it=AtomSetIt();for(var _b=0,atomSets_1=atomSets;_b<atomSets_1.length;_b++){var atomSet=atomSets_1[_b];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){occurenceCount[a]++}}var totalOccurences=0;var occurentOffsets=new Int32Array(atomCount);var offset=0;for(var _c=0,_d=occurenceCount;_c<_d.length;_c++){var oc=_d[_c];occurentOffsets[offset++]=totalOccurences;totalOccurences+=oc}var setIndex=0;var atomMap=new Int32Array(totalOccurences);var atomFill=new Int32Array(atomCount);for(var _e=0,atomSets_2=atomSets;_e<atomSets_2.length;_e++){var atomSet=atomSets_2[_e];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){offset=occurentOffsets[a]+atomFill[a];atomFill[a]++;atomMap[offset]=setIndex}setIndex++}var builder=atom_selection_1.default.uniqueBuilder();for(var _f=0,_g=atom_selection_1.default.atomSets(glue);_f<_g.length;_f++){var glueSet=_g[_f];var toGlue=collections_1.UniqueArrayBuilder();for(var a=AtomSetIt.start(it,glueSet);!it.done;a=it.next().value){var o=occurentOffsets[a];for(var i=0,_i=occurenceCount[a];i<_i;i++){var key=atomMap[o+i];collections_1.UniqueArrayBuilder.add(toGlue,key,key)}}var indices=collections_1.UniqueArrayBuilder();var cnt=0;for(var _h=0,_k=toGlue.array;_h<_k.length;_h++){var atomSetIndex=_k[_h];for(var a=AtomSetIt.start(it,atomSets[atomSetIndex]);!it.done;a=it.next().value){cnt++;collections_1.UniqueArrayBuilder.add(indices,a,a)}}builder.add(atom_set_1.default(collections_1.sortAsc(indices.array)))}return builder.getSelection()}exports.unionBy=unionBy;function union(env,selection){var sel=selection(env);if(!atom_selection_1.default.atomSets(sel).length)return atom_selection_1.default.empty;return atom_selection_1.default([atom_set_1.default(atom_selection_1.default.getAtomIndices(selection(env)))])}exports.union=union;function clusterAround(ctx,a,included,candidates){var depth=included.length;if(depth>=ctx.minSize){ctx.builder.add(a)}if(depth>=ctx.maxSize||depth>=candidates.length){return}var minDist=ctx.minDist,maxDist=ctx.maxDist;var atomSets=atom_selection_1.default.atomSets(ctx.selection);var lastIncluded=included[included.length-1];for(var _b=0,candidates_1=candidates;_b<candidates_1.length;_b++){var bI=candidates_1[_b];if(bI<=lastIncluded)continue;var b=atomSets[bI];var canInclude=true;for(var _c=0,included_1=included;_c<included_1.length;_c++){var iI=included_1[_c];var dist=atom_set_1.default.distance(ctx.model,b,atomSets[iI]);if(dist<minDist||dist>maxDist){canInclude=false;break}}if(!canInclude)continue;included.push(bI);clusterAround(ctx,atom_set_1.default.union(a,b),included,candidates);included.pop()}}function _cluster(ctx){var i=0;var lookup=atom_selection_1.default.lookup3d(ctx.model,ctx.selection);for(var _b=0,_c=atom_selection_1.default.atomSets(ctx.selection);_b<_c.length;_b++){var atomSet=_c[_b];var candidates=lookup.queryAtomSet(atomSet,ctx.maxDist);collections_1.sortAsc(candidates);clusterAround(ctx,atomSet,[i],candidates);i++}}function cluster(env,params){var cCtx={selection:params.selection(env),minDist:params.minDist&&params.minDist(env)||0,maxDist:params.maxDist&&params.maxDist(env),minSize:Math.max(params.minSize&&params.minSize(env)||2,2),maxSize:params.maxSize&&params.maxSize(env)||Number.POSITIVE_INFINITY,builder:atom_selection_1.default.linearBuilder(),model:env.context.model};_cluster(cCtx);return cCtx.builder.getSelection()}exports.cluster=cluster;function _zeroRadius(env){return 0}function includeSurroundingsNoRadius(ctx){var env=ctx.env,selection=ctx.selection,r=ctx.radius,wholeResidues=ctx.wholeResidues;var _b=env.context,model=_b.model,mask=_b.mask;var findWithin=data_1.Model.spatialLookup(model).find(mask);var _c=model.positions,x=_c.x,y=_c.y,z=_c.z;var residueIndex=model.atoms.residueIndex;var atomOffset=model.residues.atomOffset;var builder=atom_selection_1.default.uniqueBuilder();var includedResides=collections_1.FastSet.create();var it=AtomSetIt();for(var _d=0,_e=atom_selection_1.default.atomSets(selection);_d<_e.length;_d++){var atomSet=_e[_d];var atoms=collections_1.UniqueArrayBuilder();for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){var _f=findWithin(x[a],y[a],z[a],r),count=_f.count,indices=_f.indices;for(var i=0,_i=count;i<_i;i++){var b=indices[i];if(wholeResidues){var rI=residueIndex[b];if(includedResides.has(rI))continue;includedResides.add(rI);for(var j=atomOffset[rI],_j=atomOffset[rI+1];j<_j;j++){if(!mask.has(j))continue;collections_1.UniqueArrayBuilder.add(atoms,j,j)}}else{collections_1.UniqueArrayBuilder.add(atoms,b,b)}}}builder.add(atom_set_1.default(collections_1.sortAsc(atoms.array)))}return builder.getSelection()}function includeSurroundingsWithRadius(ctx){var env=ctx.env,selection=ctx.selection,radius=ctx.radius,wholeResidues=ctx.wholeResidues,atomRadius=ctx.atomRadius;var _b=env.context,model=_b.model,mask=_b.mask;var findWithin=data_1.Model.spatialLookup(model).find(mask);var _c=model.positions,x=_c.x,y=_c.y,z=_c.z;var residueIndex=model.atoms.residueIndex;var atomOffset=model.residues.atomOffset;var builder=atom_selection_1.default.uniqueBuilder();var includedResides=collections_1.FastSet.create();var maxSelectionAtomRadius=common_1.maxAtomValueInSelection(env,selection,atomRadius);environment_1.default.lockSlot(env,"element");var element=env.slots.element;var maxStructureAtomRadius=0;for(var i=0,_i=model.atoms.count;i<_i;i++){if(!mask.has(i))continue;element_address_1.default.setAtom(model,element,i);var r=atomRadius(env);if(r>maxStructureAtomRadius)maxStructureAtomRadius=r}var extendedRadius=radius+maxSelectionAtomRadius+maxStructureAtomRadius;var it=AtomSetIt();for(var _d=0,_e=atom_selection_1.default.atomSets(selection);_d<_e.length;_d++){var atomSet=_e[_d];var atoms=collections_1.UniqueArrayBuilder();for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){var _f=findWithin(x[a],y[a],z[a],extendedRadius),count=_f.count,indices=_f.indices,squaredDistances=_f.squaredDistances;element_address_1.default.setAtom(model,element,a);var rA=atomRadius(env);for(var i=0,_i=count;i<_i;i++){var b=indices[i];element_address_1.default.setAtom(model,element,b);var rB=atomRadius(env);if(Math.sqrt(squaredDistances[i])-rA-rB>radius)continue;if(wholeResidues){var rI=residueIndex[b];if(includedResides.has(rI))continue;includedResides.add(rI);for(var j=atomOffset[rI],_j=atomOffset[rI+1];j<_j;j++){if(!mask.has(j))continue;collections_1.UniqueArrayBuilder.add(atoms,j,j)}}else{collections_1.UniqueArrayBuilder.add(atoms,b,b)}}}builder.add(atom_set_1.default(collections_1.sortAsc(atoms.array)))}environment_1.default.unlockSlot(env,"element");return builder.getSelection()}function includeSurroundings(env,params){var ctx={env:env,selection:params.selection(env),radius:params.radius(env),atomRadius:params.atomRadius||_zeroRadius,wholeResidues:params.wholeResidues?params.wholeResidues(env):false};if(ctx.atomRadius===_zeroRadius){return includeSurroundingsNoRadius(ctx)}else{return includeSurroundingsWithRadius(ctx)}}exports.includeSurroundings=includeSurroundings;function _expandFrontierAtoms(_b,frontier,atoms){var env=_b.env,mask=_b.mask,bonds=_b.bonds,test=_b.test,slot=_b.slot;var newFrontier=[];var neighbor=bonds.neighbor,bondAtomOffset=bonds.offset,order=bonds.order,flags=bonds.flags;for(var _c=0,frontier_1=frontier;_c<frontier_1.length;_c++){var a=frontier_1[_c];var start=bondAtomOffset[a],end=bondAtomOffset[a+1];for(var i=start;i<end;i++){var b=neighbor[i];if(mask.has(b)&&common_1.testBond(env,slot,a,b,order[i],flags[i],test)&&collections_1.UniqueArrayBuilder.add(atoms,b,b))newFrontier[newFrontier.length]=b}}return newFrontier}function _expandAtoms(ctx,atomSet,numLayers){if(!numLayers)return atomSet;var result=collections_1.UniqueArrayBuilder();var frontier=[];var it=ctx.it;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){frontier[frontier.length]=a}for(var _b=0,frontier_2=frontier;_b<frontier_2.length;_b++){var a=frontier_2[_b];collections_1.UniqueArrayBuilder.add(result,a,a)}for(var i=0;i<numLayers;i++){frontier=_expandFrontierAtoms(ctx,frontier,result)}collections_1.sortAsc(result.array);return atom_set_1.default(result.array)}function _expandFrontierResidues(_b,frontier,residues){var env=_b.env,model=_b.model,mask=_b.mask,bonds=_b.bonds,test=_b.test,slot=_b.slot;var newFrontier=[];var neighbor=bonds.neighbor,bondAtomOffset=bonds.offset,order=bonds.order,flags=bonds.flags;var atomOffset=model.residues.atomOffset;var residueIndex=model.atoms.residueIndex;for(var _c=0,frontier_3=frontier;_c<frontier_3.length;_c++){var rI=frontier_3[_c];for(var a=atomOffset[rI],_a=atomOffset[rI+1];a<_a;a++){if(!mask.has(a))continue;var start=bondAtomOffset[a],end=bondAtomOffset[a+1];for(var i=start;i<end;i++){var b=neighbor[i];if(!mask.has(b))continue;var r=residueIndex[b];if(common_1.testBond(env,slot,a,b,order[i],flags[i],test)&&collections_1.UniqueArrayBuilder.add(residues,r,r))newFrontier[newFrontier.length]=r}}}return newFrontier}function _expandResidues(ctx,atomSet,numLayers){if(!numLayers)return atomSet;var atomOffset=ctx.model.residues.atomOffset;var residueIndex=ctx.model.atoms.residueIndex;var residues=collections_1.UniqueArrayBuilder();var frontier=[];var mask=ctx.mask,it=ctx.it;for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){var rI=residueIndex[a];if(collections_1.UniqueArrayBuilder.add(residues,rI,rI))frontier[frontier.length]=rI}for(var i=0;i<numLayers;i++){frontier=_expandFrontierResidues(ctx,frontier,residues)}collections_1.sortAsc(residues.array);var atoms=[];for(var _b=0,_c=residues.array;_b<_c.length;_b++){var rI=_c[_b];for(var a=atomOffset[rI],_a=atomOffset[rI+1];a<_a;a++){if(mask.has(a))atoms[atoms.length]=a}}return atom_set_1.default(atoms)}function includeConnected(env,_b){var selection=_b.selection,layerCount=_b.layerCount,wholeResidues=_b.wholeResidues,bondTest=_b.bondTest;var src=selection(env);var _c=env.context,model=_c.model,mask=_c.mask;var bonds=data_1.Model.bonds(model);var numLayers=Math.max(0,layerCount?layerCount(env):1);var asResidues=!!wholeResidues&&!!wholeResidues(env);var test=bondTest||common_1.defaultBondTest;var builder=atom_selection_1.default.uniqueBuilder();environment_1.default.lockSlot(env,"bond");var ctx={env:env,bonds:bonds,model:model,mask:mask,slot:env.slots.bond,test:test,it:AtomSetIt()};for(var _d=0,_e=atom_selection_1.default.atomSets(src);_d<_e.length;_d++){var atomSet=_e[_d];if(asResidues)builder.add(_expandResidues(ctx,atomSet,numLayers));else builder.add(_expandAtoms(ctx,atomSet,numLayers))}environment_1.default.unlockSlot(env,"bond");return builder.getSelection()}exports.includeConnected=includeConnected;function expandProperty(env,selection,property){var context=env.context;var src=selection(env);var propertyToSetMap=collections_1.FastMap.create();environment_1.default.lockSlot(env,"element");var element=env.slots.element;var index=0;var sets=[];var it=AtomSetIt();for(var _b=0,_c=atom_selection_1.default.atomSets(src);_b<_c.length;_b++){var atomSet=_c[_b];for(var a=AtomSetIt.start(it,atomSet);!it.done;a=it.next().value){element_address_1.default.setAtom(context.model,element,a);var p=property(env);if(propertyToSetMap.has(p))collections_1.UniqueArrayBuilder.add(propertyToSetMap.get(p),index,index);else{var ub=collections_1.UniqueArrayBuilder();collections_1.UniqueArrayBuilder.add(ub,index,index);propertyToSetMap.set(p,ub)}}sets[index]=[];index++}var mask=context.mask;for(var i=0,_i=context.model.atoms.count;i<_i;i++){if(!mask.has(i))continue;element_address_1.default.setAtom(context.model,element,i);var p=property(env);if(!propertyToSetMap.has(p))continue;for(var _d=0,_e=propertyToSetMap.get(p).array;_d<_e.length;_d++){var setIndex=_e[_d];sets[setIndex].push(i)}}environment_1.default.unlockSlot(env,"element");var builder=atom_selection_1.default.uniqueBuilder();for(var _f=0,sets_1=sets;_f<sets_1.length;_f++){var set=sets_1[_f];builder.add(atom_set_1.default(set))}return builder.getSelection()}exports.expandProperty=expandProperty},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var atom_set_1=__webpack_require__(14);var atom_selection_1=__webpack_require__(19);function intersect(env,selectionArgs){var keys=Object.keys(selectionArgs);if(keys.length===0)return atom_selection_1.default.empty;if(keys.length===1)return selectionArgs[keys[0]](env);var selections=keys.map(function(k){return selectionArgs[k]});var sequences=selections.map(function(s){return s(env)(env)});var pivotIndex=0,pivotLength=atom_selection_1.default.atomSets(sequences[0]).length;for(var i=1;i<sequences.length;i++){var len=atom_selection_1.default.atomSets(sequences[i]).length;if(len<pivotLength){pivotIndex=i;pivotLength=len}}var pivotSet=atom_selection_1.default.Set.ofSelection(sequences[pivotIndex]);var foundSet=new atom_selection_1.default.Set;for(var pI=0;pI<sequences.length;pI++){if(pI===pivotIndex)continue;for(var _a=0,_b=atom_selection_1.default.atomSets(sequences[pI]);_a<_b.length;_a++){var atomSet=_b[_a];if(pivotSet.has(atomSet))foundSet.add(atomSet)}}var ret=atom_selection_1.default.linearBuilder();for(var _c=0,_d=atom_selection_1.default.atomSets(sequences[pivotIndex]);_c<_d.length;_c++){var atomSet=_d[_c];if(foundSet.has(atomSet))ret.add(atomSet)}return ret}exports.intersect=intersect;function merge(env,selections){var ret=atom_selection_1.default.uniqueBuilder();for(var _a=0,_b=Object.keys(selections);_a<_b.length;_a++){var key=_b[_a];var sel=selections[key](env)(env);for(var _c=0,_d=atom_selection_1.default.atomSets(sel);_c<_d.length;_c++){var atomSet=_d[_c];ret.add(atomSet)}}return ret}exports.merge=merge;function clusterCheck(ctx,depth){var location=ctx.location,selections=ctx.selections,model=ctx.model,matrix=ctx.matrix,width=ctx.width;var toCheck=atom_selection_1.default.atomSets(selections[depth])[location[depth]];for(var i=0;i<depth;i++){var atomSet=atom_selection_1.default.atomSets(selections[i])[location[i]];var dist=atom_set_1.default.distance(model,toCheck,atomSet);if(dist===0&&atom_set_1.default.areEqual(toCheck,atomSet))return false;var maxDist=matrix[i*width+depth],minDist=matrix[depth*width+i];if(dist>maxDist||dist<minDist)return false}return true}function clusterAround(ctx,depth){var location=ctx.location,selections=ctx.selections,width=ctx.width;if(depth>=location.length){var set=atom_selection_1.default.atomSets(selections[0])[location[0]];for(var i=1;i<width;i++){set=atom_set_1.default.union(set,atom_selection_1.default.atomSets(selections[i])[location[i]])}ctx.builder.add(set);return}var candidates=ctx.candidates[depth];for(var i=0,_i=candidates.length;i<_i;i++){location[depth]=candidates[i];if(clusterCheck(ctx,depth))clusterAround(ctx,depth+1)}}function cluster(env,matrix,selections){var ctx={model:env.context.model,matrix:matrix,selections:selections,builder:atom_selection_1.default.uniqueBuilder(),candidates:[],location:[],width:selections.length};for(var i=0;i<ctx.width;i++){ctx.location[i]=0;ctx.candidates[i]=[]}var lookups=selections.slice(1).map(function(s){return atom_selection_1.default.lookup3d(ctx.model,s)});var first=atom_selection_1.default.atomSets(selections[0]);for(var i=0;i<first.length;i++){ctx.location[0]=i;var set=first[i];var empty=false;for(var j=1;j<ctx.width;j++){ctx.candidates[j]=lookups[j-1].queryAtomSet(set,matrix[j]);if(!ctx.candidates[j].length){empty=true;break}}if(empty)continue;clusterAround(ctx,1)}return ctx.builder.getSelection()}function invalidMatrixDims(d){throw new Error("'distance-cluster': invalid matrix dimensions (expected "+d+"x"+d+")'")}function distanceCluster(env,matrix,selections){var atomSelections=[];var selList=selections(env);if(!selList.length)return atom_selection_1.default.empty;for(var i=0;i<selList.length;i++){var sel=selList[i](env);if(!atom_selection_1.default.atomSets(sel).length)return atom_selection_1.default.empty;atomSelections.push(sel)}var w=atomSelections.length;var m=new Float64Array(w*w);var rows=matrix(env);if(rows.length!==w)invalidMatrixDims(w);for(var i=0;i<w;i++){var row=rows[i];if(row.length!==w)invalidMatrixDims(w);for(var j=0;j<w;j++){m[i*w+j]=row[j]}}return cluster(env,m,atomSelections)}exports.distanceCluster=distanceCluster},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var environment_1=__webpack_require__(25);var context_1=__webpack_require__(45);var atom_set_1=__webpack_require__(14);var atom_selection_1=__webpack_require__(19);var element_address_1=__webpack_require__(26);var collections_1=__webpack_require__(8);var filters_1=__webpack_require__(94);var AtomSetIt=atom_set_1.default.Iterator;function atomCount(env){return atom_set_1.default.count(env.slots.atomSet)}exports.atomCount=atomCount;function countQuery(env,query){var sel=query(environment_1.default(context_1.default.ofAtomSet(env.context,env.slots.atomSet)));return atom_selection_1.default.atomSets(sel).length}exports.countQuery=countQuery;function accumulateAtomSet(env,initial,value){var context=env.context,slots=env.slots;environment_1.default.lockSlot(env,"atomSetReducer");environment_1.default.lockSlot(env,"element");var it=AtomSetIt();AtomSetIt.start(it,slots.atomSet);var element=env.slots.element;element_address_1.default.setAtom(context.model,element,it.value);slots.atomSetReducer=initial(env);for(var a=it.value;!it.done;a=it.next().value){element_address_1.default.setAtom(context.model,element,a);slots.atomSetReducer=value(env)}var ret=slots.atomSetReducer;environment_1.default.unlockSlot(env,"element");environment_1.default.unlockSlot(env,"atomSetReducer");return ret}exports.accumulateAtomSet=accumulateAtomSet;function propertySet(env,prop){return filters_1.getAtomSetProperties(env,env.slots.atomSet,prop,collections_1.FastSet.create())}exports.propertySet=propertySet},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var symbol_1=__webpack_require__(58);var data_1=__webpack_require__(13);var upper_case_1=__webpack_require__(59);function prop(runtime){return runtime}function getAddress(env,xs){return xs[0]&&xs[0](env)||env.slots.element}function createSecondaryStructureFlags(env,args){return symbol_1.forEachPositionalArg(args,{flag:0},function(f,ctx){switch((""+f(env)).toLowerCase()){case"alpha":ctx.flag|=2048;break;case"3-10":ctx.flag|=1024;break;case"pi":ctx.flag|=16384;break;case"sheet":ctx.flag|=4194304;break;case"strand":ctx.flag|=2097152;break;case"helix":ctx.flag|=2;break;case"beta":ctx.flag|=4;break;case"turn":ctx.flag|=8;break;case"none":ctx.flag|=268435456;break}}).flag}exports.createSecondaryStructureFlags=createSecondaryStructureFlags;function getAtomSymbol(env,v){return env.context.atom_site.type_symbol.getString(getAddress(env,v).dataIndex)||""}exports.Core={elementSymbol:prop(function(env,v){return data_1.ElementSymbol(getAtomSymbol(env,v))}),vdw:prop(function(env,v){return data_1.VdwRadius(getAtomSymbol(env,v))}),mass:prop(function(env,v){return data_1.AtomWeight(getAtomSymbol(env,v))}),atomicNumber:prop(function(env,v){return data_1.AtomNumber(getAtomSymbol(env,v))}),x:prop(function(env,v){return env.context.model.positions.x[getAddress(env,v).atom]}),y:prop(function(env,v){return env.context.model.positions.y[getAddress(env,v).atom]}),z:prop(function(env,v){return env.context.model.positions.z[getAddress(env,v).atom]}),atomKey:prop(function(env,v){return getAddress(env,v).atom}),bondCount:prop(function(env,v){return data_1.BondCount(env.context.model,getAddress(env,v).atom,v.flags?v.flags(env):1)})};exports.Topology={connectedComponentKey:prop(function(env,v){return data_1.Model.connectedComponentKey(env.context.model)[getAddress(env,v).atom]})};exports.Macromolecular={labelResidueId:prop(function(env,v){return data_1.ResidueIdentifier.labelOfResidueIndex(env.context.model,getAddress(env,v).residue)}),authResidueId:prop(function(env,v){return data_1.ResidueIdentifier.authOfResidueIndex(env.context.model,getAddress(env,v).residue)}),residueKey:prop(function(env,v){return env.context.model.residues.key[getAddress(env,v).residue]}),chainKey:prop(function(env,v){return env.context.model.chains.key[getAddress(env,v).chain]}),entityKey:prop(function(env,v){return env.context.model.entities.key[getAddress(env,v).entity]}),isHet:prop(function(env,v){return!env.context.atom_site.group_PDB.stringEquals(getAddress(env,v).dataIndex,"ATOM")}),id:prop(function(env,v){return env.context.atom_site.id.getInteger(getAddress(env,v).dataIndex)}),label_atom_id:prop(function(env,v){return upper_case_1.default(env.context.atom_site.label_atom_id.getString(getAddress(env,v).dataIndex)||"")}),label_alt_id:prop(function(env,v){return env.context.atom_site.label_alt_id.getString(getAddress(env,v).dataIndex)||""}),label_asym_id:prop(function(env,v){return env.context.atom_site.label_asym_id.getString(getAddress(env,v).dataIndex)||""}),label_comp_id:prop(function(env,v){return env.context.atom_site.label_comp_id.getString(getAddress(env,v).dataIndex)||""}),label_entity_id:prop(function(env,v){return env.context.atom_site.label_entity_id.getString(getAddress(env,v).dataIndex)||""}),label_seq_id:prop(function(env,v){return env.context.atom_site.label_seq_id.getInteger(getAddress(env,v).dataIndex)}),auth_asym_id:prop(function(env,v){return upper_case_1.default(env.context.atom_site.auth_asym_id.getString(getAddress(env,v).dataIndex)||"")}),auth_atom_id:prop(function(env,v){return env.context.atom_site.auth_atom_id.getString(getAddress(env,v).dataIndex)||""}),auth_comp_id:prop(function(env,v){return env.context.atom_site.auth_comp_id.getString(getAddress(env,v).dataIndex)||""}),auth_seq_id:prop(function(env,v){return env.context.atom_site.auth_seq_id.getInteger(getAddress(env,v).dataIndex)}),pdbx_PDB_ins_code:prop(function(env,v){return env.context.atom_site.pdbx_PDB_ins_code.getString(getAddress(env,v).dataIndex)||""}),pdbx_formal_charge:prop(function(env,v){return env.context.atom_site.pdbx_formal_charge.getInteger(getAddress(env,v).dataIndex)}),occupancy:prop(function(env,v){return env.context.atom_site.occupancy.getFloat(getAddress(env,v).dataIndex)}),B_iso_or_equiv:prop(function(env,v){return env.context.atom_site.B_iso_or_equiv.getFloat(getAddress(env,v).dataIndex)}),entityType:prop(function(env,v){var model=env.context.model;return model.data.entity.type.getString(model.entities.dataIndex[getAddress(env,v).entity])}),secondaryStructureKey:prop(function(env,v){return env.context.model.secondaryStructure.key[env.slots.element.residue]}),secondaryStructureFlags:prop(function(env,v){return env.context.model.secondaryStructure.flags[env.slots.element.residue]}),isModified:prop(function(env,v){return env.context.model.modifiedResidues.has(env.slots.element.residue)}),modifiedParentName:prop(function(env,v){var model=env.context.model;var idx=model.modifiedResidues.get(env.slots.element.residue);if(idx===void 0)return"";return model.data.pdbxStructModResidue.parent_comp_id.getString(idx)||""})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var symbol_1=__webpack_require__(58);function rt(runtime){return runtime}function createFlags(env,args){return symbol_1.forEachPositionalArg(args,{flag:0},function(f,ctx){switch((""+f(env)).toLowerCase()){case"covalent":ctx.flag|=1;break;case"metallic":ctx.flag|=2;break;case"ion":ctx.flag|=8;break;case"hydrogen":ctx.flag|=4;break;case"sulfide":ctx.flag|=16;break;case"aromatic":ctx.flag|=32;break;case"computed":ctx.flag|=64;break}}).flag}exports.createFlags=createFlags;exports.Properties={order:rt(function(env,v){return env.slots.bond.order}),flags:rt(function(env,v){return env.slots.bond.flags})}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ciftools_js_1=__webpack_require__(43);var E=ciftools_js_1.default.Binary.Encoder;var Encoders={strings:E.by(E.stringArray),coordinates1:E.by(E.fixedPoint(10)).and(E.delta).and(E.integerPacking),coordinates3:E.by(E.fixedPoint(1e3)).and(E.delta).and(E.integerPacking),occupancy:E.by(E.fixedPoint(100)).and(E.delta).and(E.runLength).and(E.byteArray),ids:E.by(E.delta).and(E.runLength).and(E.integerPacking),byteArray:E.by(E.byteArray),float64:E.by(E.byteArray)};function _atom_site(ctx){var fields=[{name:"group_PDB",string:function(data,i){return data.columns.group_PDB.getString(data.dataIndex[i])}},{name:"id",string:function(data,i){return data.columns.id.getString(data.dataIndex[i])},number:function(data,i){return data.columns.id.getInteger(data.dataIndex[i])},typedArray:Int32Array,encoder:Encoders.ids},{name:"type_symbol",string:function(data,i){return data.columns.type_symbol.getString(data.dataIndex[i])}},{name:"label_atom_id",string:function(data,i){return data.columns.label_atom_id.getString(data.dataIndex[i])}},{name:"label_alt_id",string:function(data,i){return data.columns.label_alt_id.getString(data.dataIndex[i])},presence:function(data,i){return data.columns.label_alt_id.getValuePresence(data.dataIndex[i])}},{name:"label_comp_id",string:function(data,i){return data.columns.label_comp_id.getString(data.dataIndex[i])}},{name:"label_asym_id",string:function(data,i){return data.columns.label_asym_id.getString(data.dataIndex[i])}},{name:"label_entity_id",string:function(data,i){return data.columns.label_entity_id.getString(data.dataIndex[i])}},{name:"label_seq_id",string:function(data,i){return data.columns.label_seq_id.getString(data.dataIndex[i])},number:function(data,i){return data.columns.label_seq_id.getInteger(data.dataIndex[i])},typedArray:Int32Array,encoder:Encoders.ids,presence:function(data,i){return data.columns.label_seq_id.getValuePresence(data.dataIndex[i])}},{name:"pdbx_PDB_ins_code",string:function(data,i){return data.columns.pdbx_PDB_ins_code.getString(data.dataIndex[i])},presence:function(data,i){return data.columns.pdbx_PDB_ins_code.getValuePresence(data.dataIndex[i])}},{name:"Cartn_x",string:function(data,i){return""+Math.round(1e3*data.positions.x[data.index[i]])/1e3},number:function(data,i){return data.positions.x[data.index[i]]},typedArray:Float32Array,encoder:Encoders.coordinates3},{name:"Cartn_y",string:function(data,i){return""+Math.round(1e3*data.positions.y[data.index[i]])/1e3},number:function(data,i){return data.positions.y[data.index[i]]},typedArray:Float32Array,encoder:Encoders.coordinates3},{name:"Cartn_z",string:function(data,i){return""+Math.round(1e3*data.positions.z[data.index[i]])/1e3},number:function(data,i){return data.positions.z[data.index[i]]},typedArray:Float32Array,encoder:Encoders.coordinates3},{name:"occupancy",string:function(data,i){return data.columns.occupancy.getString(data.dataIndex[i])},number:function(data,i){return data.columns.occupancy.getFloat(data.dataIndex[i])},typedArray:Float32Array,encoder:Encoders.occupancy},{name:"B_iso_or_equiv",string:function(data,i){return data.columns.B_iso_or_equiv.getString(data.dataIndex[i])},number:function(data,i){return data.columns.B_iso_or_equiv.getFloat(data.dataIndex[i])},typedArray:Float32Array,encoder:Encoders.occupancy},{name:"pdbx_formal_charge",string:function(data,i){return data.columns.pdbx_formal_charge.getString(data.dataIndex[i])},number:function(data,i){return data.columns.pdbx_formal_charge.getInteger(data.dataIndex[i])},typedArray:Int32Array,presence:function(data,i){return data.columns.pdbx_formal_charge.getValuePresence(data.dataIndex[i])},encoder:Encoders.byteArray},{name:"auth_atom_id",string:function(data,i){return data.columns.auth_atom_id.getString(data.dataIndex[i])}},{name:"auth_comp_id",string:function(data,i){return data.columns.auth_comp_id.getString(data.dataIndex[i])}},{name:"auth_asym_id",string:function(data,i){return data.columns.auth_asym_id.getString(data.dataIndex[i])}},{name:"auth_seq_id",string:function(data,i){return data.columns.auth_seq_id.getString(data.dataIndex[i])},number:function(data,i){return data.columns.auth_seq_id.getInteger(data.dataIndex[i])},typedArray:Int32Array,encoder:Encoders.ids,presence:function(data,i){return data.columns.auth_seq_id.getValuePresence(data.dataIndex[i])}},{name:"pdbx_PDB_model_num",string:function(data,i){return data.modelId}}];var dataIndex=new Int32Array(ctx.atomIndices.length);var _dataIndex=ctx.model.atoms.dataIndex,aI=ctx.atomIndices;for(var i=0;i<aI.length;i++){dataIndex[i]=_dataIndex[aI[i]]}return{data:{columns:ctx.model.data.atom_site,positions:ctx.model.positions,dataIndex:dataIndex,index:aI,modelId:""+ctx.model.id},count:ctx.atomIndices.length,desc:{name:"_atom_site",fields:fields}}}function stringWriter(){var data=[];return{stream:{writeString:function(str){data.push(str);return true},writeBinary:function(data){throw Error("not implemented")}},data:data}}function to_mmCIF_string(model,atomIndices){var writer=new ciftools_js_1.default.Text.Writer;var ctx={model:model,atomIndices:atomIndices};writer.startDataBlock(model.structureId);writer.writeCategory(_atom_site,[ctx]);writer.encode();var result=stringWriter();writer.flush(result.stream);return result.data.join("")}exports.default=to_mmCIF_string},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var all_1=__webpack_require__(35);var examples_1=__webpack_require__(174);var markdown_docs_1=__webpack_require__(70);var lang={name:"JSON",editorMode:"javascript",docs:markdown_docs_1.default(false),transpiler:all_1.default.json,mergeSelection:false,examples:examples_1.default};exports.default=lang},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var h=__webpack_require__(17);var properties_1=__webpack_require__(46);var properties_2=__webpack_require__(46);var operators_1=__webpack_require__(61);var keywords_1=__webpack_require__(62);var builder_1=__webpack_require__(6);var valueOperators=[{"@desc":"value comparisons","@examples":[],name:"=",abbr:["=="],type:h.binaryLeft,rule:P.regex(/\s*(LIKE|>=|<=|=|!=|>|<)\s*/i,1),map:function(op,e1,e2){var expr;if(e1==="structure"){expr=builder_1.default.core.flags.hasAny([builder_1.default.ammp("secondaryStructureFlags"),properties_2.structureMap(e2)])}else if(e2==="structure"){expr=builder_1.default.core.flags.hasAny([builder_1.default.ammp("secondaryStructureFlags"),properties_2.structureMap(e1)])}else if(e1.head==="core.type.regex"){expr=builder_1.default.core.str.match([e1,builder_1.default.core.type.str([e2])])}else if(e2.head==="core.type.regex"){expr=builder_1.default.core.str.match([e2,builder_1.default.core.type.str([e1])])}else if(op.toUpperCase()==="LIKE"){if(e1.head){expr=builder_1.default.core.str.match([builder_1.default.core.type.regex(["^"+e2+"$","i"]),builder_1.default.core.type.str([e1])])}else{expr=builder_1.default.core.str.match([builder_1.default.core.type.regex(["^"+e1+"$","i"]),builder_1.default.core.type.str([e2])])}}if(!expr){if(e1.head)e2=h.wrapValue(e1,e2);if(e2.head)e1=h.wrapValue(e2,e1);switch(op){case"=":expr=builder_1.default.core.rel.eq([e1,e2]);break;case"!=":expr=builder_1.default.core.rel.neq([e1,e2]);break;case">":expr=builder_1.default.core.rel.gr([e1,e2]);break;case"<":expr=builder_1.default.core.rel.lt([e1,e2]);break;case">=":expr=builder_1.default.core.rel.gre([e1,e2]);break;case"<=":expr=builder_1.default.core.rel.lte([e1,e2]);break;default:throw new Error("value operator '"+op+"' not supported")}}return builder_1.default.struct.generator.atomGroups({"atom-test":expr})}}];function atomExpressionQuery(x){var _a=x[1],resno=_a[0],inscode=_a[1],chainname=_a[2],atomname=_a[3],altloc=_a[4];var tests={};if(chainname){tests["chain-test"]=builder_1.default.core.rel.eq([builder_1.default.ammp("auth_asym_id"),chainname])}var resProps=[];if(resno)resProps.push(builder_1.default.core.rel.eq([builder_1.default.ammp("auth_seq_id"),resno]));if(inscode)resProps.push(builder_1.default.core.rel.eq([builder_1.default.ammp("pdbx_PDB_ins_code"),inscode]));if(resProps.length)tests["residue-test"]=h.andExpr(resProps);var atomProps=[];if(atomname)atomProps.push(builder_1.default.core.rel.eq([builder_1.default.ammp("auth_atom_id"),atomname]));if(altloc)atomProps.push(builder_1.default.core.rel.eq([builder_1.default.ammp("label_alt_id"),altloc]));if(atomProps.length)tests["atom-test"]=h.andExpr(atomProps);return builder_1.default.struct.generator.atomGroups(tests)}var lang=P.createLanguage({Integer:function(){return P.regexp(/-?[0-9]+/).map(Number).desc("integer")},Parens:function(r){return P.alt(r.Parens,r.Operator,r.Expression).wrap(P.string("("),P.string(")"))},Expression:function(r){return P.alt(r.Keywords,r.Resno.lookahead(P.regex(/\s*(?!(LIKE|>=|<=|!=|[:^%/.=><]))/i)).map(function(x){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.rel.eq([builder_1.default.ammp("auth_seq_id"),x])})}),r.AtomExpression.map(atomExpressionQuery),r.ValueQuery,r.Element.map(function(x){return builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.acp("elementSymbol"),builder_1.default.struct.type.elementSymbol(x)])})}),r.Resname.map(function(x){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.rel.eq([builder_1.default.ammp("label_comp_id"),x])})}))},Operator:function(r){return h.combineOperators(operators_1.default,P.alt(r.Parens,r.Expression))},AtomExpression:function(r){return P.seq(P.lookahead(r.AtomPrefix),P.seq(r.Resno.or(P.of(null)),r.Inscode.or(P.of(null)),r.Chainname.or(P.of(null)),r.Atomname.or(P.of(null)),r.Altloc.or(P.of(null)),r.Model.or(P.of(null))))},AtomPrefix:function(){return P.regex(/[0-9:^%/.]/).desc("atom-prefix")},Chainname:function(){return P.regex(/:([A-Za-z]{1,3})/,1).desc("chainname")},Model:function(){return P.regex(/\/([0-9]+)/,1).map(Number).desc("model")},Element:function(){return P.regex(/_([A-Za-z]{1,3})/,1).desc("element")},Atomname:function(){return P.regex(/\.([a-zA-Z0-9]{1,4})/,1).map(builder_1.default.atomName).desc("atomname")},Resname:function(){return P.regex(/[a-zA-Z0-9]{1,4}/).desc("resname")},Resno:function(r){return r.Integer.desc("resno")},Altloc:function(){return P.regex(/%([a-zA-Z0-9])/,1).desc("altloc")},Inscode:function(){return P.regex(/\^([a-zA-Z0-9])/,1).desc("inscode")},Keywords:function(){return P.alt.apply(P,h.getKeywordRules(keywords_1.default))},Query:function(r){return P.alt(r.Operator,r.Parens,r.Expression).trim(P.optWhitespace)},Number:function(){return P.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){var w=h.getReservedWords(properties_1.default,keywords_1.default,operators_1.default).sort(h.strLenSortFn).map(h.escapeRegExp).join("|");return P.alt(P.regex(new RegExp("(?!("+w+"))[A-Z0-9_]+","i")),P.regex(/'((?:[^"\\]|\\.)*)'/,1),P.regex(/"((?:[^"\\]|\\.)*)"/,1).map(function(x){return builder_1.default.core.type.regex(["^"+x+"$","i"])}))},Value:function(r){return P.alt(r.Number,r.String)},ValueParens:function(r){return P.alt(r.ValueParens,r.ValueOperator,r.ValueExpressions).wrap(P.string("("),P.string(")"))},ValuePropertyNames:function(){return P.alt.apply(P,h.getPropertyNameRules(properties_1.default,/LIKE|>=|<=|=|!=|>|<|\)|\s/i))},ValueOperator:function(r){return h.combineOperators(valueOperators,P.alt(r.ValueParens,r.ValueExpressions))},ValueExpressions:function(r){return P.alt(r.Value,r.ValuePropertyNames)},ValueQuery:function(r){return P.alt(r.ValueOperator.map(function(x){if(x.head){if(x.head.startsWith("structure.generator"))return x}else{if(typeof x==="string"&&x.length<=4){return builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.rel.eq([builder_1.default.ammp("label_comp_id"),x])})}}throw new Error("values must be part of an comparison, value '"+x+"'")}))}});var transpiler=function(str){return lang.Query.tryParse(str)};exports.default=transpiler},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var container_1=__webpack_require__(63);var transpiler=function(s){return container_1.default.deserialize(s).expression};exports.default=transpiler},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default="0.1.0"},function(module,exports,__webpack_require__){(function(process){exports=module.exports=SemVer;var debug;if(typeof process==="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG))debug=function(){var args=Array.prototype.slice.call(arguments,0);args.unshift("SEMVER");console.log.apply(console,args)};else debug=function(){};exports.SEMVER_SPEC_VERSION="2.0.0";var MAX_LENGTH=256;var MAX_SAFE_INTEGER=Number.MAX_SAFE_INTEGER||9007199254740991;var re=exports.re=[];var src=exports.src=[];var R=0;var NUMERICIDENTIFIER=R++;src[NUMERICIDENTIFIER]="0|[1-9]\\d*";var NUMERICIDENTIFIERLOOSE=R++;src[NUMERICIDENTIFIERLOOSE]="[0-9]+";var NONNUMERICIDENTIFIER=R++;src[NONNUMERICIDENTIFIER]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var MAINVERSION=R++;src[MAINVERSION]="("+src[NUMERICIDENTIFIER]+")\\."+"("+src[NUMERICIDENTIFIER]+")\\."+"("+src[NUMERICIDENTIFIER]+")";var MAINVERSIONLOOSE=R++;src[MAINVERSIONLOOSE]="("+src[NUMERICIDENTIFIERLOOSE]+")\\."+"("+src[NUMERICIDENTIFIERLOOSE]+")\\."+"("+src[NUMERICIDENTIFIERLOOSE]+")";var PRERELEASEIDENTIFIER=R++;src[PRERELEASEIDENTIFIER]="(?:"+src[NUMERICIDENTIFIER]+"|"+src[NONNUMERICIDENTIFIER]+")";var PRERELEASEIDENTIFIERLOOSE=R++;src[PRERELEASEIDENTIFIERLOOSE]="(?:"+src[NUMERICIDENTIFIERLOOSE]+"|"+src[NONNUMERICIDENTIFIER]+")";var PRERELEASE=R++;src[PRERELEASE]="(?:-("+src[PRERELEASEIDENTIFIER]+"(?:\\."+src[PRERELEASEIDENTIFIER]+")*))";var PRERELEASELOOSE=R++;src[PRERELEASELOOSE]="(?:-?("+src[PRERELEASEIDENTIFIERLOOSE]+"(?:\\."+src[PRERELEASEIDENTIFIERLOOSE]+")*))";var BUILDIDENTIFIER=R++;src[BUILDIDENTIFIER]="[0-9A-Za-z-]+";var BUILD=R++;src[BUILD]="(?:\\+("+src[BUILDIDENTIFIER]+"(?:\\."+src[BUILDIDENTIFIER]+")*))";var FULL=R++;var FULLPLAIN="v?"+src[MAINVERSION]+src[PRERELEASE]+"?"+src[BUILD]+"?";src[FULL]="^"+FULLPLAIN+"$";var LOOSEPLAIN="[v=\\s]*"+src[MAINVERSIONLOOSE]+src[PRERELEASELOOSE]+"?"+src[BUILD]+"?";var LOOSE=R++;src[LOOSE]="^"+LOOSEPLAIN+"$";var GTLT=R++;src[GTLT]="((?:<|>)?=?)";var XRANGEIDENTIFIERLOOSE=R++;src[XRANGEIDENTIFIERLOOSE]=src[NUMERICIDENTIFIERLOOSE]+"|x|X|\\*";var XRANGEIDENTIFIER=R++;src[XRANGEIDENTIFIER]=src[NUMERICIDENTIFIER]+"|x|X|\\*";var XRANGEPLAIN=R++;src[XRANGEPLAIN]="[v=\\s]*("+src[XRANGEIDENTIFIER]+")"+"(?:\\.("+src[XRANGEIDENTIFIER]+")"+"(?:\\.("+src[XRANGEIDENTIFIER]+")"+"(?:"+src[PRERELEASE]+")?"+src[BUILD]+"?"+")?)?";var XRANGEPLAINLOOSE=R++;src[XRANGEPLAINLOOSE]="[v=\\s]*("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:\\.("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:\\.("+src[XRANGEIDENTIFIERLOOSE]+")"+"(?:"+src[PRERELEASELOOSE]+")?"+src[BUILD]+"?"+")?)?";var XRANGE=R++;src[XRANGE]="^"+src[GTLT]+"\\s*"+src[XRANGEPLAIN]+"$";var XRANGELOOSE=R++;src[XRANGELOOSE]="^"+src[GTLT]+"\\s*"+src[XRANGEPLAINLOOSE]+"$";var LONETILDE=R++;src[LONETILDE]="(?:~>?)";var TILDETRIM=R++;src[TILDETRIM]="(\\s*)"+src[LONETILDE]+"\\s+";re[TILDETRIM]=new RegExp(src[TILDETRIM],"g");var tildeTrimReplace="$1~";var TILDE=R++;src[TILDE]="^"+src[LONETILDE]+src[XRANGEPLAIN]+"$";var TILDELOOSE=R++;src[TILDELOOSE]="^"+src[LONETILDE]+src[XRANGEPLAINLOOSE]+"$";var LONECARET=R++;src[LONECARET]="(?:\\^)";var CARETTRIM=R++;src[CARETTRIM]="(\\s*)"+src[LONECARET]+"\\s+";re[CARETTRIM]=new RegExp(src[CARETTRIM],"g");var caretTrimReplace="$1^";var CARET=R++;src[CARET]="^"+src[LONECARET]+src[XRANGEPLAIN]+"$";var CARETLOOSE=R++;src[CARETLOOSE]="^"+src[LONECARET]+src[XRANGEPLAINLOOSE]+"$";var COMPARATORLOOSE=R++;src[COMPARATORLOOSE]="^"+src[GTLT]+"\\s*("+LOOSEPLAIN+")$|^$";var COMPARATOR=R++;src[COMPARATOR]="^"+src[GTLT]+"\\s*("+FULLPLAIN+")$|^$";var COMPARATORTRIM=R++;src[COMPARATORTRIM]="(\\s*)"+src[GTLT]+"\\s*("+LOOSEPLAIN+"|"+src[XRANGEPLAIN]+")";re[COMPARATORTRIM]=new RegExp(src[COMPARATORTRIM],"g");var comparatorTrimReplace="$1$2$3";var HYPHENRANGE=R++;src[HYPHENRANGE]="^\\s*("+src[XRANGEPLAIN]+")"+"\\s+-\\s+"+"("+src[XRANGEPLAIN]+")"+"\\s*$";var HYPHENRANGELOOSE=R++;src[HYPHENRANGELOOSE]="^\\s*("+src[XRANGEPLAINLOOSE]+")"+"\\s+-\\s+"+"("+src[XRANGEPLAINLOOSE]+")"+"\\s*$";var STAR=R++;src[STAR]="(<|>)?=?\\s*\\*";for(var i=0;i<R;i++){debug(i,src[i]);if(!re[i])re[i]=new RegExp(src[i])}exports.parse=parse;function parse(version,loose){if(version instanceof SemVer)return version;if(typeof version!=="string")return null;if(version.length>MAX_LENGTH)return null;var r=loose?re[LOOSE]:re[FULL];if(!r.test(version))return null;try{return new SemVer(version,loose)}catch(er){return null}}exports.valid=valid;function valid(version,loose){var v=parse(version,loose);return v?v.version:null}exports.clean=clean;function clean(version,loose){var s=parse(version.trim().replace(/^[=v]+/,""),loose);return s?s.version:null}exports.SemVer=SemVer;function SemVer(version,loose){if(version instanceof SemVer){if(version.loose===loose)return version;else version=version.version}else if(typeof version!=="string"){throw new TypeError("Invalid Version: "+version)}if(version.length>MAX_LENGTH)throw new TypeError("version is longer than "+MAX_LENGTH+" characters");if(!(this instanceof SemVer))return new SemVer(version,loose);debug("SemVer",version,loose);this.loose=loose;var m=version.trim().match(loose?re[LOOSE]:re[FULL]);if(!m)throw new TypeError("Invalid Version: "+version);this.raw=version;this.major=+m[1];this.minor=+m[2];this.patch=+m[3];if(this.major>MAX_SAFE_INTEGER||this.major<0)throw new TypeError("Invalid major version");if(this.minor>MAX_SAFE_INTEGER||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>MAX_SAFE_INTEGER||this.patch<0)throw new TypeError("Invalid patch version");if(!m[4])this.prerelease=[];else this.prerelease=m[4].split(".").map(function(id){if(/^[0-9]+$/.test(id)){var num=+id;if(num>=0&&num<MAX_SAFE_INTEGER)return num}return id});this.build=m[5]?m[5].split("."):[];this.format()}SemVer.prototype.format=function(){this.version=this.major+"."+this.minor+"."+this.patch;if(this.prerelease.length)this.version+="-"+this.prerelease.join(".");return this.version};SemVer.prototype.toString=function(){return this.version};SemVer.prototype.compare=function(other){debug("SemVer.compare",this.version,this.loose,other);if(!(other instanceof SemVer))other=new SemVer(other,this.loose);return this.compareMain(other)||this.comparePre(other)};SemVer.prototype.compareMain=function(other){if(!(other instanceof SemVer))other=new SemVer(other,this.loose);return compareIdentifiers(this.major,other.major)||compareIdentifiers(this.minor,other.minor)||compareIdentifiers(this.patch,other.patch)};SemVer.prototype.comparePre=function(other){if(!(other instanceof SemVer))other=new SemVer(other,this.loose);if(this.prerelease.length&&!other.prerelease.length)return-1;else if(!this.prerelease.length&&other.prerelease.length)return 1;else if(!this.prerelease.length&&!other.prerelease.length)return 0;var i=0;do{var a=this.prerelease[i];var b=other.prerelease[i];debug("prerelease compare",i,a,b);if(a===undefined&&b===undefined)return 0;else if(b===undefined)return 1;else if(a===undefined)return-1;else if(a===b)continue;else return compareIdentifiers(a,b)}while(++i)};SemVer.prototype.inc=function(release,identifier){switch(release){case"premajor":this.prerelease.length=0;this.patch=0;this.minor=0;this.major++;this.inc("pre",identifier);break;case"preminor":this.prerelease.length=0;this.patch=0;this.minor++;this.inc("pre",identifier);break;case"prepatch":this.prerelease.length=0;this.inc("patch",identifier);this.inc("pre",identifier);break;case"prerelease":if(this.prerelease.length===0)this.inc("patch",identifier);this.inc("pre",identifier);break;case"major":if(this.minor!==0||this.patch!==0||this.prerelease.length===0)this.major++;this.minor=0;this.patch=0;this.prerelease=[];break;case"minor":if(this.patch!==0||this.prerelease.length===0)this.minor++;this.patch=0;this.prerelease=[];break;case"patch":if(this.prerelease.length===0)this.patch++;this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{var i=this.prerelease.length;while(--i>=0){if(typeof this.prerelease[i]==="number"){this.prerelease[i]++;i=-2}}if(i===-1)this.prerelease.push(0)}if(identifier){if(this.prerelease[0]===identifier){if(isNaN(this.prerelease[1]))this.prerelease=[identifier,0]}else this.prerelease=[identifier,0]}break;default:throw new Error("invalid increment argument: "+release)}this.format();this.raw=this.version;return this};exports.inc=inc;function inc(version,release,loose,identifier){if(typeof loose==="string"){identifier=loose;loose=undefined}try{return new SemVer(version,loose).inc(release,identifier).version}catch(er){return null}}exports.diff=diff;function diff(version1,version2){if(eq(version1,version2)){return null}else{var v1=parse(version1);var v2=parse(version2);if(v1.prerelease.length||v2.prerelease.length){for(var key in v1){if(key==="major"||key==="minor"||key==="patch"){if(v1[key]!==v2[key]){return"pre"+key}}}return"prerelease"}for(var key in v1){if(key==="major"||key==="minor"||key==="patch"){if(v1[key]!==v2[key]){return key}}}}}exports.compareIdentifiers=compareIdentifiers;var numeric=/^[0-9]+$/;function compareIdentifiers(a,b){var anum=numeric.test(a);var bnum=numeric.test(b);if(anum&&bnum){a=+a;b=+b}return anum&&!bnum?-1:bnum&&!anum?1:a<b?-1:a>b?1:0}exports.rcompareIdentifiers=rcompareIdentifiers;function rcompareIdentifiers(a,b){return compareIdentifiers(b,a)}exports.major=major;function major(a,loose){return new SemVer(a,loose).major}exports.minor=minor;function minor(a,loose){return new SemVer(a,loose).minor}exports.patch=patch;function patch(a,loose){return new SemVer(a,loose).patch}exports.compare=compare;function compare(a,b,loose){return new SemVer(a,loose).compare(new SemVer(b,loose))}exports.compareLoose=compareLoose;function compareLoose(a,b){return compare(a,b,true)}exports.rcompare=rcompare;function rcompare(a,b,loose){return compare(b,a,loose)}exports.sort=sort;function sort(list,loose){return list.sort(function(a,b){return exports.compare(a,b,loose)})}exports.rsort=rsort;function rsort(list,loose){return list.sort(function(a,b){return exports.rcompare(a,b,loose)})}exports.gt=gt;function gt(a,b,loose){return compare(a,b,loose)>0}exports.lt=lt;function lt(a,b,loose){return compare(a,b,loose)<0}exports.eq=eq;function eq(a,b,loose){return compare(a,b,loose)===0}exports.neq=neq;function neq(a,b,loose){return compare(a,b,loose)!==0}exports.gte=gte;function gte(a,b,loose){return compare(a,b,loose)>=0}exports.lte=lte;function lte(a,b,loose){return compare(a,b,loose)<=0}exports.cmp=cmp;function cmp(a,op,b,loose){var ret;switch(op){case"===":if(typeof a==="object")a=a.version;if(typeof b==="object")b=b.version;ret=a===b;break;case"!==":if(typeof a==="object")a=a.version;if(typeof b==="object")b=b.version;ret=a!==b;break;case"":case"=":case"==":ret=eq(a,b,loose);break;case"!=":ret=neq(a,b,loose);break;case">":ret=gt(a,b,loose);break;case">=":ret=gte(a,b,loose);break;case"<":ret=lt(a,b,loose);break;case"<=":ret=lte(a,b,loose);break;default:throw new TypeError("Invalid operator: "+op)}return ret}exports.Comparator=Comparator;function Comparator(comp,loose){if(comp instanceof Comparator){if(comp.loose===loose)return comp;else comp=comp.value}if(!(this instanceof Comparator))return new Comparator(comp,loose);debug("comparator",comp,loose);this.loose=loose;this.parse(comp);if(this.semver===ANY)this.value="";else this.value=this.operator+this.semver.version;debug("comp",this)}var ANY={};Comparator.prototype.parse=function(comp){var r=this.loose?re[COMPARATORLOOSE]:re[COMPARATOR];var m=comp.match(r);if(!m)throw new TypeError("Invalid comparator: "+comp);this.operator=m[1];if(this.operator==="=")this.operator="";if(!m[2])this.semver=ANY;else this.semver=new SemVer(m[2],this.loose)};Comparator.prototype.toString=function(){return this.value};Comparator.prototype.test=function(version){debug("Comparator.test",version,this.loose);if(this.semver===ANY)return true;if(typeof version==="string")version=new SemVer(version,this.loose);return cmp(version,this.operator,this.semver,this.loose)};Comparator.prototype.intersects=function(comp,loose){if(!(comp instanceof Comparator)){throw new TypeError("a Comparator is required")}var rangeTmp;if(this.operator===""){rangeTmp=new Range(comp.value,loose);return satisfies(this.value,rangeTmp,loose)}else if(comp.operator===""){rangeTmp=new Range(this.value,loose);return satisfies(comp.semver,rangeTmp,loose)}var sameDirectionIncreasing=(this.operator===">="||this.operator===">")&&(comp.operator===">="||comp.operator===">");var sameDirectionDecreasing=(this.operator==="<="||this.operator==="<")&&(comp.operator==="<="||comp.operator==="<");var sameSemVer=this.semver.version===comp.semver.version;var differentDirectionsInclusive=(this.operator===">="||this.operator==="<=")&&(comp.operator===">="||comp.operator==="<=");var oppositeDirectionsLessThan=cmp(this.semver,"<",comp.semver,loose)&&((this.operator===">="||this.operator===">")&&(comp.operator==="<="||comp.operator==="<"));var oppositeDirectionsGreaterThan=cmp(this.semver,">",comp.semver,loose)&&((this.operator==="<="||this.operator==="<")&&(comp.operator===">="||comp.operator===">"));return sameDirectionIncreasing||sameDirectionDecreasing||sameSemVer&&differentDirectionsInclusive||oppositeDirectionsLessThan||oppositeDirectionsGreaterThan};exports.Range=Range;function Range(range,loose){if(range instanceof Range){if(range.loose===loose){return range}else{return new Range(range.raw,loose)}}if(range instanceof Comparator){return new Range(range.value,loose)}if(!(this instanceof Range))return new Range(range,loose);this.loose=loose;this.raw=range;this.set=range.split(/\s*\|\|\s*/).map(function(range){return this.parseRange(range.trim())},this).filter(function(c){return c.length});if(!this.set.length){throw new TypeError("Invalid SemVer Range: "+range)}this.format()}Range.prototype.format=function(){this.range=this.set.map(function(comps){return comps.join(" ").trim()}).join("||").trim();return this.range};Range.prototype.toString=function(){return this.range};Range.prototype.parseRange=function(range){var loose=this.loose;range=range.trim();debug("range",range,loose);var hr=loose?re[HYPHENRANGELOOSE]:re[HYPHENRANGE];range=range.replace(hr,hyphenReplace);debug("hyphen replace",range);range=range.replace(re[COMPARATORTRIM],comparatorTrimReplace);debug("comparator trim",range,re[COMPARATORTRIM]);range=range.replace(re[TILDETRIM],tildeTrimReplace);range=range.replace(re[CARETTRIM],caretTrimReplace);range=range.split(/\s+/).join(" ");var compRe=loose?re[COMPARATORLOOSE]:re[COMPARATOR];var set=range.split(" ").map(function(comp){return parseComparator(comp,loose)}).join(" ").split(/\s+/);if(this.loose){set=set.filter(function(comp){return!!comp.match(compRe)})}set=set.map(function(comp){return new Comparator(comp,loose)});return set};Range.prototype.intersects=function(range,loose){if(!(range instanceof Range)){throw new TypeError("a Range is required")}return this.set.some(function(thisComparators){return thisComparators.every(function(thisComparator){return range.set.some(function(rangeComparators){return rangeComparators.every(function(rangeComparator){return thisComparator.intersects(rangeComparator,loose)})})})})};exports.toComparators=toComparators;function toComparators(range,loose){return new Range(range,loose).set.map(function(comp){return comp.map(function(c){return c.value}).join(" ").trim().split(" ")})}function parseComparator(comp,loose){debug("comp",comp);comp=replaceCarets(comp,loose);debug("caret",comp);comp=replaceTildes(comp,loose);debug("tildes",comp);comp=replaceXRanges(comp,loose);debug("xrange",comp);comp=replaceStars(comp,loose);debug("stars",comp);return comp}function isX(id){return!id||id.toLowerCase()==="x"||id==="*"}function replaceTildes(comp,loose){return comp.trim().split(/\s+/).map(function(comp){return replaceTilde(comp,loose)}).join(" ")}function replaceTilde(comp,loose){var r=loose?re[TILDELOOSE]:re[TILDE];return comp.replace(r,function(_,M,m,p,pr){debug("tilde",comp,_,M,m,p,pr);var ret;if(isX(M))ret="";else if(isX(m))ret=">="+M+".0.0 <"+(+M+1)+".0.0";else if(isX(p))ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0";else if(pr){debug("replaceTilde pr",pr);if(pr.charAt(0)!=="-")pr="-"+pr;ret=">="+M+"."+m+"."+p+pr+" <"+M+"."+(+m+1)+".0"}else ret=">="+M+"."+m+"."+p+" <"+M+"."+(+m+1)+".0";debug("tilde return",ret);return ret})}function replaceCarets(comp,loose){return comp.trim().split(/\s+/).map(function(comp){return replaceCaret(comp,loose)}).join(" ")}function replaceCaret(comp,loose){debug("caret",comp,loose);var r=loose?re[CARETLOOSE]:re[CARET];return comp.replace(r,function(_,M,m,p,pr){debug("caret",comp,_,M,m,p,pr);var ret;if(isX(M))ret="";else if(isX(m))ret=">="+M+".0.0 <"+(+M+1)+".0.0";else if(isX(p)){if(M==="0")ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0";else ret=">="+M+"."+m+".0 <"+(+M+1)+".0.0"}else if(pr){debug("replaceCaret pr",pr);if(pr.charAt(0)!=="-")pr="-"+pr;if(M==="0"){if(m==="0")ret=">="+M+"."+m+"."+p+pr+" <"+M+"."+m+"."+(+p+1);else ret=">="+M+"."+m+"."+p+pr+" <"+M+"."+(+m+1)+".0"}else ret=">="+M+"."+m+"."+p+pr+" <"+(+M+1)+".0.0"}else{debug("no pr");if(M==="0"){if(m==="0")ret=">="+M+"."+m+"."+p+" <"+M+"."+m+"."+(+p+1);else ret=">="+M+"."+m+"."+p+" <"+M+"."+(+m+1)+".0"}else ret=">="+M+"."+m+"."+p+" <"+(+M+1)+".0.0"}debug("caret return",ret);return ret})}function replaceXRanges(comp,loose){debug("replaceXRanges",comp,loose);return comp.split(/\s+/).map(function(comp){return replaceXRange(comp,loose)}).join(" ")}function replaceXRange(comp,loose){comp=comp.trim();var r=loose?re[XRANGELOOSE]:re[XRANGE];return comp.replace(r,function(ret,gtlt,M,m,p,pr){debug("xRange",comp,ret,gtlt,M,m,p,pr);var xM=isX(M);var xm=xM||isX(m);var xp=xm||isX(p);var anyX=xp;if(gtlt==="="&&anyX)gtlt="";if(xM){if(gtlt===">"||gtlt==="<"){ret="<0.0.0"}else{ret="*"}}else if(gtlt&&anyX){if(xm)m=0;if(xp)p=0;if(gtlt===">"){gtlt=">=";if(xm){M=+M+1;m=0;p=0}else if(xp){m=+m+1;p=0}}else if(gtlt==="<="){gtlt="<";if(xm)M=+M+1;else m=+m+1}ret=gtlt+M+"."+m+"."+p}else if(xm){ret=">="+M+".0.0 <"+(+M+1)+".0.0"}else if(xp){ret=">="+M+"."+m+".0 <"+M+"."+(+m+1)+".0"}debug("xRange return",ret);return ret})}function replaceStars(comp,loose){debug("replaceStars",comp,loose);return comp.trim().replace(re[STAR],"")}function hyphenReplace($0,from,fM,fm,fp,fpr,fb,to,tM,tm,tp,tpr,tb){if(isX(fM))from="";else if(isX(fm))from=">="+fM+".0.0";else if(isX(fp))from=">="+fM+"."+fm+".0";else from=">="+from;if(isX(tM))to="";else if(isX(tm))to="<"+(+tM+1)+".0.0";else if(isX(tp))to="<"+tM+"."+(+tm+1)+".0";else if(tpr)to="<="+tM+"."+tm+"."+tp+"-"+tpr;else to="<="+to;return(from+" "+to).trim()}Range.prototype.test=function(version){if(!version)return false;if(typeof version==="string")version=new SemVer(version,this.loose);for(var i=0;i<this.set.length;i++){if(testSet(this.set[i],version))return true}return false};function testSet(set,version){for(var i=0;i<set.length;i++){if(!set[i].test(version))return false}if(version.prerelease.length){for(var i=0;i<set.length;i++){debug(set[i].semver);if(set[i].semver===ANY)continue;if(set[i].semver.prerelease.length>0){var allowed=set[i].semver;if(allowed.major===version.major&&allowed.minor===version.minor&&allowed.patch===version.patch)return true}}return false}return true}exports.satisfies=satisfies;function satisfies(version,range,loose){try{range=new Range(range,loose)}catch(er){return false}return range.test(version)}exports.maxSatisfying=maxSatisfying;function maxSatisfying(versions,range,loose){var max=null;var maxSV=null;try{var rangeObj=new Range(range,loose)}catch(er){return null}versions.forEach(function(v){if(rangeObj.test(v)){if(!max||maxSV.compare(v)===-1){max=v;maxSV=new SemVer(max,loose)}}});return max}exports.minSatisfying=minSatisfying;function minSatisfying(versions,range,loose){var min=null;var minSV=null;try{var rangeObj=new Range(range,loose)}catch(er){return null}versions.forEach(function(v){if(rangeObj.test(v)){if(!min||minSV.compare(v)===1){min=v;minSV=new SemVer(min,loose)}}});return min}exports.validRange=validRange;function validRange(range,loose){try{return new Range(range,loose).range||"*"}catch(er){return null}}exports.ltr=ltr;function ltr(version,range,loose){return outside(version,range,"<",loose)}exports.gtr=gtr;function gtr(version,range,loose){return outside(version,range,">",loose)}exports.outside=outside;function outside(version,range,hilo,loose){version=new SemVer(version,loose);range=new Range(range,loose);var gtfn,ltefn,ltfn,comp,ecomp;switch(hilo){case">":gtfn=gt;ltefn=lte;ltfn=lt;comp=">";ecomp=">=";break;case"<":gtfn=lt;ltefn=gte;ltfn=gt;comp="<";ecomp="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(satisfies(version,range,loose)){return false}for(var i=0;i<range.set.length;++i){var comparators=range.set[i];var high=null;var low=null;comparators.forEach(function(comparator){if(comparator.semver===ANY){comparator=new Comparator(">=0.0.0")}high=high||comparator;low=low||comparator;if(gtfn(comparator.semver,high.semver,loose)){high=comparator}else if(ltfn(comparator.semver,low.semver,loose)){low=comparator}});if(high.operator===comp||high.operator===ecomp){return false}if((!low.operator||low.operator===comp)&&ltefn(version,low.semver)){return false}else if(low.operator===ecomp&&ltfn(version,low.semver)){return false}}return true}exports.prerelease=prerelease;function prerelease(version,loose){var parsed=parse(version,loose);return parsed&&parsed.prerelease.length?parsed.prerelease:null}exports.intersects=intersects;function intersects(r1,r2,loose){r1=new Range(r1,loose);r2=new Range(r2,loose);return r1.intersects(r2)}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var expression_1=__webpack_require__(33);var symbols_1=__webpack_require__(36);var builder_1=__webpack_require__(6);var ws=P.regex(/[\n\r\s]*/);function getSymbolExpression(s,args){switch(s.kind){case"alias":return args?expression_1.default.Apply(s.symbol.id,args):expression_1.default.Apply(s.symbol.id);case"macro":return s.translate(args)}}var lang=P.createLanguage({Expression:function(r){return P.seq(r.Symbol,r.ArgList,r.NamedArgList)},Arg:function(r){return P.seq(P.lookahead(P.regex(/[^:]/)),P.alt(r.AtomName,r.ElementSymbol,r.Boolean,r.Number,r.String,r.QuotedString,r.ListSymbol,r.SetSymbol,r.List)).map(function(x){return x[1]}).trim(ws)},ArgList:function(r){return r.Arg.many()},ArgName:function(){return P.regexp(/:([a-zA-Z0-9_.-]+)/,1).trim(ws).desc("arg-name")},NamedArg:function(r){return P.seq(r.ArgName,r.Arg).trim(ws)},NamedArgList:function(r){return r.NamedArg.many().map(function(xs){var namedArgs={};xs.forEach(function(a){namedArgs[a[0]]=a[1]});return namedArgs})},Symbol:function(){return P.regexp(/[^\s'`,@()\[\]{}';:]+/).map(function(x){var s=symbols_1.SymbolMap[x];if(!s){throw new Error("'"+x+"': unknown symbol.")}return s}).desc("symbol")},String:function(){return P.regexp(/[a-zA-Z_-]+[a-zA-Z0-9_.-]*/).map(function(x){var s=symbols_1.SymbolMap[x];if(s)return getSymbolExpression(s);return x}).desc("string")},QuotedString:function(){return P.string("`").then(P.regexp(/[^`]*/)).skip(P.string("`")).desc("quoted-string")},Number:function(){return P.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},Boolean:function(){return P.alt(P.regexp(/true/i).result(true),P.regexp(/false/i).result(false)).desc("boolean")},ListSymbol:function(r){return r.ArgList.wrap(P.string("["),P.string("]")).map(builder_1.default.core.type.list).desc("list-symbol")},SetSymbol:function(r){return r.ArgList.wrap(P.string("{"),P.string("}")).map(builder_1.default.core.type.set).desc("set-symbol")},ElementSymbol:function(r){return P.seq(P.string("_"),P.regex(/[0-9a-zA-Z]+/)).map(function(x){return builder_1.default.struct.type.elementSymbol([x[1]])}).desc("element-symbol")},AtomName:function(r){return P.string(".").then(P.alt(r.String,r.QuotedString,r.Number)).map(builder_1.default.atomName).desc("identifier")},List:function(r){return r.Expression.wrap(P.string("("),P.string(")")).map(function(x){var array=x[1];var named=x[2];if(named&&Object.keys(named).length){if(array){for(var i=0;i<array.length;i++)named[i]=array[i]}return getSymbolExpression(x[0],named)}else if(array&&array.length){return getSymbolExpression(x[0],x[1])}else{return getSymbolExpression(x[0])}}).desc("list")},Query:function(r){return r.List.trim(ws)}});var reComment=/;[^\n\r]*[\n\r]/g;var transpiler=function(str){return lang.Query.tryParse(str.replace(reComment,"\n"))};exports.default=transpiler},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var builder_1=__webpack_require__(6);function getPositionalArgs(args){return Object.keys(args).filter(function(k){return!isNaN(k)}).map(function(k){return+k}).sort(function(a,b){return a-b}).map(function(k){return args[k]})}exports.getPositionalArgs=getPositionalArgs;function tryGetArg(args,name,defaultValue){return args&&args[name]!==void 0?args[name]:defaultValue}exports.tryGetArg=tryGetArg;function pickArgs(args){var names=[];for(var _i=1;_i<arguments.length;_i++){names[_i-1]=arguments[_i]}var ret=Object.create(null);var count=0;for(var _a=0,_b=Object.keys(args);_a<_b.length;_a++){var k=_b[_a];if(names.indexOf(k)>=0){ret[k]=args[k];count++}}return count?ret:void 0}exports.pickArgs=pickArgs;function aggregate(property,fn,initial){return builder_1.default.struct.atomSet.reduce({initial:initial!==void 0?initial:property,value:fn([builder_1.default.struct.slot.atomSetReduce(),property])})}exports.aggregate=aggregate},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var h=__webpack_require__(17);var properties_1=__webpack_require__(64);var operators_1=__webpack_require__(65);var keywords_1=__webpack_require__(66);var builder_1=__webpack_require__(6);var propertiesDict=h.getPropertyRules(properties_1.default);var slash=P.string("/");function orNull(rule){return rule.or(P.of(null))}function atomSelectionQuery(x){var tests={};var props={};for(var k in x){var ps=properties_1.default[k];if(!ps){throw new Error("property '"+k+"' not supported, value '"+x[k]+"'")}if(x[k]===null)continue;if(!props[ps.level])props[ps.level]=[];props[ps.level].push(x[k])}for(var p in props){tests[p]=h.andExpr(props[p])}return builder_1.default.struct.generator.atomGroups(tests)}var lang=P.createLanguage({Parens:function(r){return P.alt(r.Parens,r.Operator,r.Expression).wrap(P.string("("),P.string(")"))},Expression:function(r){return P.alt(r.AtomSelectionMacro.map(atomSelectionQuery),r.NamedAtomProperties,r.Pepseq,r.Rep,r.Keywords,r.Object)},AtomSelectionMacro:function(r){return P.alt(slash.then(P.alt(P.seq(orNull(r.ObjectProperty).skip(slash),orNull(propertiesDict.segi).skip(slash),orNull(propertiesDict.chain).skip(slash),orNull(propertiesDict.resi).skip(slash),orNull(propertiesDict.name)).map(function(x){return{object:x[0],segi:x[1],chain:x[2],resi:x[3],name:x[4]}}),P.seq(orNull(r.ObjectProperty).skip(slash),orNull(propertiesDict.segi).skip(slash),orNull(propertiesDict.chain).skip(slash),orNull(propertiesDict.resi)).map(function(x){return{object:x[0],segi:x[1],chain:x[2],resi:x[3]}}),P.seq(orNull(r.ObjectProperty).skip(slash),orNull(propertiesDict.segi).skip(slash),orNull(propertiesDict.chain)).map(function(x){return{object:x[0],segi:x[1],chain:x[2]}}),P.seq(orNull(r.ObjectProperty).skip(slash),orNull(propertiesDict.segi)).map(function(x){return{object:x[0],segi:x[1]}}),P.seq(orNull(r.ObjectProperty)).map(function(x){return{object:x[0]}}))),P.alt(P.seq(orNull(r.ObjectProperty).skip(slash),orNull(propertiesDict.segi).skip(slash),orNull(propertiesDict.chain).skip(slash),orNull(propertiesDict.resi).skip(slash),orNull(propertiesDict.name)).map(function(x){return{object:x[0],segi:x[1],chain:x[2],resi:x[3],name:x[4]}}),P.seq(orNull(propertiesDict.segi).skip(slash),orNull(propertiesDict.chain).skip(slash),orNull(propertiesDict.resi).skip(slash),orNull(propertiesDict.name)).map(function(x){return{segi:x[0],chain:x[1],resi:x[2],name:x[3]}}),P.seq(orNull(propertiesDict.chain).skip(slash),orNull(propertiesDict.resi).skip(slash),orNull(propertiesDict.name)).map(function(x){return{chain:x[0],resi:x[1],name:x[2]}}),P.seq(orNull(propertiesDict.resi).skip(slash),orNull(propertiesDict.name)).map(function(x){return{resi:x[0],name:x[1]}})))},NamedAtomProperties:function(){return P.alt.apply(P,h.getNamedPropertyRules(properties_1.default))},Keywords:function(){return P.alt.apply(P,h.getKeywordRules(keywords_1.default))},ObjectProperty:function(){var w=h.getReservedWords(properties_1.default,keywords_1.default,operators_1.default).sort(h.strLenSortFn).map(h.escapeRegExp).join("|");return P.regex(new RegExp("(?!("+w+"))[A-Z0-9_]+","i"))},Object:function(r){return r.ObjectProperty.notFollowedBy(slash).map(function(x){throw new Error("property 'object' not supported, value '"+x+"'")})},Pepseq:function(){return P.regex(/(PEPSEQ|ps\.)\s+([a-z]+)/i,2).map(h.makeError("operator 'pepseq' not supported"))},Rep:function(){return P.regex(/REP\s+(lines|spheres|mesh|ribbon|cartoon|sticks|dots|surface|labels|extent|nonbonded|nb_spheres|slice|extent|slice|dashes|angles|dihedrals|cgo|cell|callback|everything)/i,1).map(h.makeError("operator 'rep' not supported"))},Operator:function(r){return h.combineOperators(operators_1.default,P.alt(r.Parens,r.Expression,r.Operator))},Query:function(r){return P.alt(r.Operator,r.Parens,r.Expression).trim(P.optWhitespace)}});var transpiler=function(str){return lang.Query.tryParse(str)};exports.default=transpiler},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var P=__webpack_require__(20);var h=__webpack_require__(17);var properties_1=__webpack_require__(37);var properties_2=__webpack_require__(37);var operators_1=__webpack_require__(67);var keywords_1=__webpack_require__(68);var functions_1=__webpack_require__(69);var builder_1=__webpack_require__(6);var valueOperators=[{"@desc":"multiplication, division","@examples":[],name:"mul-div",type:h.binaryLeft,rule:P.regex(/\s*(\*|\/)\s*/,1),map:function(op,e1,e2){switch(op){case"*":return builder_1.default.core.math.mult([e1,e2]);case"/":return builder_1.default.core.math.div([e1,e2]);default:throw new Error("value operator '"+op+"' not supported")}}},{"@desc":"addition, substraction","@examples":[],name:"add-sub",type:h.binaryLeft,rule:P.regex(/\s*(-|\+)\s*/,1),map:function(op,e1,e2){switch(op){case"-":return builder_1.default.core.math.sub([e1,e2]);case"+":return builder_1.default.core.math.add([e1,e2]);default:throw new Error("value operator '"+op+"' not supported")}}},{"@desc":"value comparisons","@examples":[],name:"comparison",type:h.binaryLeft,rule:P.alt(P.regex(/\s*(=~|==|>=|<=|=|!=|>|<)\s*/,1),P.whitespace.result("=")),map:function(op,e1,e2){var expr;if(e1.head==="structure.atom-property.macromolecular.secondary-structure-flags"){expr=builder_1.default.core.flags.hasAny([e1,properties_2.sstrucMap(e2)])}else if(e2.head==="structure.atom-property.macromolecular.secondary-structure-flags"){expr=builder_1.default.core.flags.hasAny([e2,properties_2.sstrucMap(e1)])}else if(e1.head==="core.type.regex"){expr=builder_1.default.core.str.match([e1,builder_1.default.core.type.str([e2])])}else if(e2.head==="core.type.regex"){expr=builder_1.default.core.str.match([e2,builder_1.default.core.type.str([e1])])}else if(op==="=~"){if(e1.head){expr=builder_1.default.core.str.match([builder_1.default.core.type.regex(["^"+e2+"$","i"]),builder_1.default.core.type.str([e1])])}else{expr=builder_1.default.core.str.match([builder_1.default.core.type.regex(["^"+e1+"$","i"]),builder_1.default.core.type.str([e2])])}}if(!expr){if(e1.head)e2=h.wrapValue(e1,e2);if(e2.head)e1=h.wrapValue(e2,e1);switch(op){case"=":case"==":expr=builder_1.default.core.rel.eq([e1,e2]);break;case"!=":expr=builder_1.default.core.rel.neq([e1,e2]);break;case">":expr=builder_1.default.core.rel.gr([e1,e2]);break;case"<":expr=builder_1.default.core.rel.lt([e1,e2]);break;case">=":expr=builder_1.default.core.rel.gre([e1,e2]);break;case"<=":expr=builder_1.default.core.rel.lte([e1,e2]);break;default:throw new Error("value operator '"+op+"' not supported")}}return builder_1.default.struct.generator.atomGroups({"atom-test":expr})}}];var lang=P.createLanguage({Parens:function(r){return P.alt(r.Parens,r.Operator,r.Expression).wrap(P.string("("),P.string(")"))},Expression:function(r){return P.alt(r.RangeListProperty,r.ValueQuery,r.Keywords)},Keywords:function(){return P.alt.apply(P,h.getKeywordRules(keywords_1.default))},ValueRange:function(r){return P.seq(r.Value.skip(P.regex(/\s+TO\s+/i)),r.Value).map(function(x){return{range:x}})},RangeListProperty:function(r){return P.seq(P.alt.apply(P,h.getPropertyNameRules(properties_1.default,/\s/)).skip(P.whitespace),P.alt(r.ValueRange,r.Value).sepBy1(P.whitespace)).map(function(x){var property=x[0],values=x[1];var listValues=[];var rangeValues=[];values.forEach(function(v){if(v.range){rangeValues.push(builder_1.default.core.rel.inRange([property,v.range[0],v.range[1]]))}else{listValues.push(h.wrapValue(property,v,properties_2.sstrucDict))}});var rangeTest=h.orExpr(rangeValues);var listTest=h.valuesTest(property,listValues);var test;if(rangeTest&&listTest){test=builder_1.default.core.logic.or([rangeTest,listTest])}else{test=rangeTest?rangeTest:listTest}return builder_1.default.struct.generator.atomGroups((_a={},_a[h.testLevel(property)]=test,_a));var _a})},Operator:function(r){return h.combineOperators(operators_1.default,P.alt(r.Parens,r.Expression,r.ValueQuery))},Query:function(r){return P.alt(r.Operator,r.Parens,r.Expression).trim(P.optWhitespace)},Number:function(){return P.regexp(/-?(0|[1-9][0-9]*)([.][0-9]+)?([eE][+-]?[0-9]+)?/).map(Number).desc("number")},String:function(){var w=h.getReservedWords(properties_1.default,keywords_1.default,operators_1.default).sort(h.strLenSortFn).map(h.escapeRegExp).join("|");return P.alt(P.regex(new RegExp("(?!("+w+"))[A-Z0-9_]+","i")),P.regex(/'((?:[^"\\]|\\.)*)'/,1),P.regex(/"((?:[^"\\]|\\.)*)"/,1).map(function(x){return builder_1.default.core.type.regex(["^"+x+"$","i"])})).desc("string")},Value:function(r){return P.alt(r.Number,r.String)},ValueParens:function(r){return P.alt(r.ValueParens,r.ValueOperator,r.ValueExpressions).wrap(P.string("("),P.string(")"))},ValuePropertyNames:function(){return P.alt.apply(P,h.getPropertyNameRules(properties_1.default,/=~|==|>=|<=|=|!=|>|<|\)|\s|\+|-|\*|\//i))},ValueOperator:function(r){return h.combineOperators(valueOperators,P.alt(r.ValueParens,r.ValueExpressions))},ValueExpressions:function(r){return P.alt(r.ValueFunctions,r.Value,r.ValuePropertyNames)},ValueFunctions:function(r){return P.alt.apply(P,h.getFunctionRules(functions_1.default,r.ValueOperator))},ValueQuery:function(r){return P.alt(r.ValueOperator.map(function(x){if(!x.head||!x.head.startsWith("structure.generator")){throw new Error("values must be part of an comparison, value '"+x+"'")}else{return x}}))}});var transpiler=function(str){return lang.Query.tryParse(str)};exports.default=transpiler},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var container_1=__webpack_require__(63);var builder_1=__webpack_require__(6);var l=builder_1.default.core.type.list;var lys=builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.rel.eq([builder_1.default.ammp("auth_comp_id"),"LYS"]),"group-by":builder_1.default.ammp("residueKey")});exports.default=[{name:"All C or N atoms in ALA residues",value:container_1.default.serialize(builder_1.default.struct.generator.atomGroups({"residue-test":builder_1.default.core.rel.eq([builder_1.default.ammp("auth_comp_id"),"ALA"]),"atom-test":builder_1.default.core.set.has([builder_1.default.core.type.set([builder_1.default.es("C"),builder_1.default.es("N")]),builder_1.default.acp("elementSymbol")])}),{source:"molql-explorer",pretty:true})},{name:"All residues within 5 ang from Fe atom",value:container_1.default.serialize(builder_1.default.struct.modifier.includeSurroundings({0:builder_1.default.struct.generator.atomGroups({"atom-test":builder_1.default.core.rel.eq([builder_1.default.acp("elementSymbol"),builder_1.default.es("Fe")])}),radius:5,"as-whole-residues":true}),{source:"molql-explorer",pretty:true})},{name:"Cluster LYS residues within 5 ang",value:container_1.default.serialize(builder_1.default.struct.modifier.cluster({0:lys,"max-distance":5}),{source:"molql-explorer",pretty:true})},{name:"Cluster 3 LYS residues within 5 ang",value:container_1.default.serialize(builder_1.default.struct.combinator.distanceCluster({matrix:l([l([0,5,5]),l([0,0,5]),l([0,0,0])]),selections:l([lys,lys,lys])}),{source:"molql-explorer",pretty:true})},{name:"Residues with max b-factor < 45",value:container_1.default.serialize(builder_1.default.struct.filter.pick({0:builder_1.default.struct.generator.atomGroups({"group-by":builder_1.default.ammp("residueKey")}),test:builder_1.default.core.rel.lt([builder_1.default.struct.atomSet.reduce({initial:builder_1.default.ammp("B_iso_or_equiv"),value:builder_1.default.core.math.max([builder_1.default.struct.slot.atomSetReduce(),builder_1.default.ammp("B_iso_or_equiv")])}),35])}),{source:"molql-explorer",pretty:true})}]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var all_1=__webpack_require__(35);var examples_1=__webpack_require__(176);var markdown_docs_1=__webpack_require__(177);var lang={name:"MolQL Script",editorMode:"molql-script",docs:markdown_docs_1.default,transpiler:all_1.default.molQLscript,mergeSelection:false,examples:examples_1.default};exports.default=lang},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"Residues connected to HEM",value:"(sel.atom.is-connected-to\n  sel.atom.res\n  :target (sel.atom.res (= atom.label_comp_id HEM))\n  ;; default bond test allows only covalent bonds\n  :bond-test true\n  :disjunct true)"},{name:"All C or N atoms in ALA residues",value:"(sel.atom.atom-groups\n  :residue-test (= atom.auth_comp_id ALA)\n  :atom-test (set.has (set _C _N) atom.el))"},{name:"Residues 130 to 180",value:"(sel.atom.res (in-range atom.resno 130 180))"},{name:"All residues within 5 ang from Fe atom",value:"(sel.atom.include-surroundings\n  (sel.atom.atoms (= atom.el _Fe))\n  :radius 5\n  :as-whole-residues true)"},{name:"Cluster LYS residues within 5 ang",value:"(sel.atom.cluster\n  (sel.atom.res (= atom.label_comp_id LYS))\n  :max-distance 5)"},{name:"Residues with max b-factor < 45",value:"(sel.atom.pick sel.atom.res\n  :test (< (atom.set.max atom.B_iso_or_equiv) 45))"},{name:"Atoms between 10 and 15 ang from Fe",value:"(sel.atom.within sel.atom.atoms\n  :target (sel.atom.atoms (= atom.el _Fe))\n  :min-radius 10\n  :max-radius 15)"},{name:"HEM and 2 layers of connected residues",value:"(sel.atom.include-connected\n  (sel.atom.res (= atom.label_comp_id HEM))\n  ;; default bond test allows only covalent bonds\n  ;; another option is to use :bond-test true to allow any connection\n  :bond-test (bond.is metallic covalent)\n  :layer-count 2\n  :as-whole-residues true)"},{name:"All rings",value:"(sel.atom.rings)"},{name:"CCCCN and CCNCN rings",value:'(sel.atom.rings\n  (ringfp _C _N _C _N _C)\n  ;; the "rotation" of element symbols has no effect\n  ;; the following is the same as (ringfp _C _C _C _C _N)\n  (ringfp _C _C _C _N _C))'},{name:"Sheets",value:"(sel.atom.atom-groups\n  :residue-test (atom.sec-struct.is sheet)\n  :group-by (atom.key.sec-struct))"},{name:"Helices formed by at least 30 residues",value:"(sel.atom.pick\n  (sel.atom.atom-groups\n  :residue-test (atom.sec-struct.is helix)\n  :group-by atom.key.sec-struct)\n  :test (<= 30 (atom.set.count-query sel.atom.res)))"},{name:"Modified residues",value:"(sel.atom.res atom.is-modified)"},{name:"Atoms participating in metallic coordination",value:"(sel.atom.atoms\n  (> (atom.bond-count :flags (bond-flags metallic)) 0))"},{name:"LYS and ALA residues that are between 2 and 5 ang apart",value:"(sel.atom.dist-cluster\n  ;; upper triangular matrix are maximum distances of corresponding selections\n  ;; lower triangular matrix are minumum distances of corresponding selections\n  :matrix [\n    [0 5]\n    [2 0]\n  ]\n  :selections [\n    (sel.atom.res (= atom.resname LYS))\n    (sel.atom.res (= atom.resname ALA))\n  ])"},{name:"Clusters of 3 LYS residues that are mutually no more than 5 ang apart",value:"(sel.atom.dist-cluster\n  :matrix [[0 5 5] [0 0 5] [0 0 0]]\n  :selections [\n    (sel.atom.res (= atom.resname LYS))\n    (sel.atom.res (= atom.resname LYS))\n    (sel.atom.res (= atom.resname LYS))\n  ])"}]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var markdown_docs_1=__webpack_require__(70);var symbols_1=__webpack_require__(36);var docs=["MolQL Script","============","--------------------------------",""];function makeDocs(xs){for(var _i=0,xs_1=xs;_i<xs_1.length;_i++){var x=xs_1[_i];if(symbols_1.isMolQLScriptSymbol(x)){var s=markdown_docs_1.formatSymbol(x.symbol,x.aliases);docs.push("```\n"+s+"\n```\n");if(x.symbol.info.description){docs.push("*"+x.symbol.info.description+"*\n")}}else if(x instanceof Array){makeDocs(x)}else if(typeof x==="string"){docs.push("## "+x+"\n\n");docs.push("--------------------------------\n")}}}makeDocs(symbols_1.SymbolTable);exports.default=docs.join("\n")},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var all_1=__webpack_require__(35);var examples_1=__webpack_require__(179);var markdown_docs_1=__webpack_require__(180);var lang={name:"PyMOL",editorMode:"pymol",docs:markdown_docs_1.default,transpiler:all_1.default.pymol,mergeSelection:true,examples:examples_1.default};exports.default=lang},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"ALA residues",value:"resn ALA"},{name:'Atoms named "C", "O", "N", or "CA"',value:"name c+o+n+ca"},{name:"Residues with helix or sheet secondary structure",value:"ss h+s"},{name:"C-alpha atoms of residues 100 to 180 in chain A",value:"A/100-180/CA"},{name:"Residues 100 to 180",value:"resi 100-180"},{name:"Atoms that are 1 ang + vdw radius away from polymer",value:"polymer gap 1"},{name:"Residues within 4 ang of HEM",value:"byres resn HEM around 4"},{name:"HEM and residues within 4 ang",value:"byres resn HEM expand 4"},{name:"Solvent close (2.5 ang) to polymer",value:"solvent NEAR_TO 2.5 OF polymer"},{name:"Cystein residues within 3 ang of HEM",value:"byres resn CYS WITHIN 3 OF resn HEM"},{name:"Solvent atoms 4 ang away from oxygen",value:"solvent beyond 4 of (name O and not solvent)"},{name:"All rings in PHE",value:"byring resn PHE"},{name:"CYS and all bound residues",value:"byres BOUND_TO resn CYS"},{name:"HEM and atoms up to 7 bonds away",value:"resn HEM extend 7"},{name:"Atoms with alternate location A or none",value:'alt A+""'}]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var properties_1=__webpack_require__(64);var operators_1=__webpack_require__(65);var keywords_1=__webpack_require__(66);var docs=["PyMol","============","--------------------------------",""];docs.push("## Properties\n\n");docs.push("--------------------------------\n");for(var name_1 in properties_1.default){if(properties_1.default[name_1].isUnsupported)continue;var names=[name_1];if(properties_1.default[name_1].abbr)names.push.apply(names,properties_1.default[name_1].abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(properties_1.default[name_1]["@desc"]){docs.push("*"+properties_1.default[name_1]["@desc"]+"*\n")}}docs.push("## Operators\n\n");docs.push("--------------------------------\n");operators_1.default.forEach(function(o){if(o.isUnsupported)return;var names=[o.name];if(o.abbr)names.push.apply(names,o.abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(o["@desc"]){docs.push("*"+o["@desc"]+"*\n")}});docs.push("## Keywords\n\n");docs.push("--------------------------------\n");for(var name_2 in keywords_1.default){if(!keywords_1.default[name_2].map)continue;var names=[name_2];if(keywords_1.default[name_2].abbr)names.push.apply(names,keywords_1.default[name_2].abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(keywords_1.default[name_2]["@desc"]){docs.push("*"+keywords_1.default[name_2]["@desc"]+"*\n")}}exports.default=docs.join("\n")},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var all_1=__webpack_require__(35);var examples_1=__webpack_require__(182);var markdown_docs_1=__webpack_require__(183);var lang={name:"VMD",editorMode:"vmd",docs:markdown_docs_1.default,transpiler:all_1.default.vmd,mergeSelection:true,examples:examples_1.default};exports.default=lang},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"All water residues",value:"water"},{name:"All C-alpha atoms",value:"name CA"},{name:"Residue 35",value:"resid 35"},{name:"C-alpha atoms of ALA",value:"name CA and resname ALA"},{name:"Backbone atoms",value:"backbone"},{name:"Non-protein atoms",value:"not protein"},{name:"Protein backbone or hydrogen atoms",value:"protein (backbone or name H)"},{name:"Atoms heavier than 20",value:"mass > 20"},{name:"Atoms with two bonds",value:"numbonds = 2"},{name:"Atoms with an absolute charge greater 1",value:"abs(charge) > 1"},{name:"Atoms with an x coordinate between -25 and -20",value:"x < -20 and x > -25"},{name:"Helices",value:"structure H"},{name:'Atoms with name "A 1"',value:"name 'A 1'"},{name:'Atoms with name "A *"',value:"name 'A *'"},{name:"Atoms with names starting with C",value:'name "C.*"'},{name:"Atoms within 10 ang of [25, 15, 10]",value:"sqr(x+25)+sqr(y+15)+sqr(z+10) <= sqr(10)"},{name:"Atoms within 5 ang of iron atoms",value:"within 5 of name FE"},{name:"Atoms around 10 ang of HEM residue",value:"exwithin 10 of resname HEM"},{name:"ALA residues within 15 ang of HEM",value:"resname ALA within 15 of resname HEM"},{name:"All groups that include an iron atom",value:"same resid as name FE"},{name:"Atoms with mass between 12 and 17.5",value:"mass 12 to 17.5"},{name:"Residues 60, 80, 90 and 142",value:"resid 60 80 90 142"}]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var properties_1=__webpack_require__(37);var operators_1=__webpack_require__(67);var keywords_1=__webpack_require__(68);var functions_1=__webpack_require__(69);var docs=["VMD","============","--------------------------------",""];docs.push("## Properties\n\n");docs.push("--------------------------------\n");for(var name_1 in properties_1.default){if(properties_1.default[name_1].isUnsupported)continue;var names=[name_1];if(properties_1.default[name_1].abbr)names.push.apply(names,properties_1.default[name_1].abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(properties_1.default[name_1]["@desc"]){docs.push("*"+properties_1.default[name_1]["@desc"]+"*\n")}}docs.push("## Operators\n\n");docs.push("--------------------------------\n");operators_1.default.forEach(function(o){if(o.isUnsupported)return;var names=[o.name];if(o.abbr)names.push.apply(names,o.abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(o["@desc"]){docs.push("*"+o["@desc"]+"*\n")}});docs.push("## Keywords\n\n");docs.push("--------------------------------\n");for(var name_2 in keywords_1.default){if(!keywords_1.default[name_2].map)continue;var names=[name_2];if(keywords_1.default[name_2].abbr)names.push.apply(names,keywords_1.default[name_2].abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(keywords_1.default[name_2]["@desc"]){docs.push("*"+keywords_1.default[name_2]["@desc"]+"*\n")}}docs.push("## Functions\n\n");docs.push("--------------------------------\n");for(var name_3 in functions_1.default){if(!functions_1.default[name_3].map)continue;var names=[name_3];docs.push("```\n"+names.join(", ")+"\n```\n");if(functions_1.default[name_3]["@desc"]){docs.push("*"+functions_1.default[name_3]["@desc"]+"*\n")}}exports.default=docs.join("\n")},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var all_1=__webpack_require__(35);var examples_1=__webpack_require__(185);var markdown_docs_1=__webpack_require__(186);var lang={name:"Jmol",editorMode:"jmol",docs:markdown_docs_1.default,transpiler:all_1.default.jmol,mergeSelection:true,examples:examples_1.default};exports.default=lang},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=[{name:"Residue 50 or 135",value:"50 or 135"},{name:"Atoms with no covalent bonds",value:"bondcount = 0"},{name:"All 3-10 helices",value:'substructure = "helix310"'},{name:"Metal atoms",value:"metal"},{name:"Atoms invloved in aromatic bonds",value:"isAromatic"},{name:"Pyrimidine residues",value:"pyrimidine"}]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var properties_1=__webpack_require__(46);var operators_1=__webpack_require__(61);var keywords_1=__webpack_require__(62);var docs=["Jmol","============","--------------------------------",""];docs.push("## Properties\n\n");docs.push("--------------------------------\n");for(var name_1 in properties_1.default){if(properties_1.default[name_1].isUnsupported)continue;var names=[name_1];if(properties_1.default[name_1].abbr)names.push.apply(names,properties_1.default[name_1].abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(properties_1.default[name_1]["@desc"]){docs.push("*"+properties_1.default[name_1]["@desc"]+"*\n")}}docs.push("## Operators\n\n");docs.push("--------------------------------\n");operators_1.default.forEach(function(o){if(o.isUnsupported)return;var names=[o.name];if(o.abbr)names.push.apply(names,o.abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(o["@desc"]){docs.push("*"+o["@desc"]+"*\n")}});docs.push("## Keywords\n\n");docs.push("--------------------------------\n");for(var name_2 in keywords_1.default){if(!keywords_1.default[name_2].map)continue;var names=[name_2];if(keywords_1.default[name_2].abbr)names.push.apply(names,keywords_1.default[name_2].abbr);docs.push("```\n"+names.join(", ")+"\n```\n");if(keywords_1.default[name_2]["@desc"]){docs.push("*"+keywords_1.default[name_2]["@desc"]+"*\n")}}exports.default=docs.join("\n")},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();var __assign=this&&this.__assign||Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t[p]=s[p]}return t};Object.defineProperty(exports,"__esModule",{value:true});var litemol_1=__webpack_require__(55);var React=__webpack_require__(38);var expression_formatter_1=__webpack_require__(202);var container_1=__webpack_require__(63);var markdown_docs_1=__webpack_require__(70);var languages_1=__webpack_require__(96);var ReactMarkdown=__webpack_require__(203);var query_editor_1=__webpack_require__(226);var MolQLScript=__webpack_require__(36);var result_1=__webpack_require__(95);var Root=function(_super){__extends(Root,_super);function Root(){return _super!==null&&_super.apply(this,arguments)||this}Root.prototype.render=function(){var _this=this;var col1="37%",col2="37%",col12="74%",col3="26%",heightTop="33%",heightBottom="67%";return React.createElement("div",{style:{position:"absolute",top:0,right:0,left:0,bottom:0,overflow:"hidden"}},React.createElement("div",{className:"layout-box",style:{position:"absolute",top:0,left:0,width:col1,height:heightTop,overflowX:"hidden",overflowY:"hidden"}},React.createElement("div",{className:"molql-logo"},React.createElement(LanguageSelection,__assign({},this.props))),React.createElement(OffsetBox,null,React.createElement(QueryExpression,__assign({},this.props)))),React.createElement("div",{className:"layout-box",style:{position:"absolute",top:0,left:col1,width:col2,height:heightTop,overflowX:"hidden",overflowY:"hidden"}},React.createElement("select",{className:"u-full-width",onChange:function(e){return _this.props.state.compileTarget.onNext(e.target.value)}},React.createElement("option",{value:"lisp"},"Compiled: LISP-like"),React.createElement("option",{value:"json"},"Compiled: JSON")),React.createElement(OffsetBox,null,React.createElement(CompiledQuery,__assign({},this.props))),React.createElement(QueryHint,__assign({},this.props))),React.createElement("div",{className:"layout-box",style:{position:"absolute",top:0,left:col12,width:col3,height:heightTop,overflowX:"hidden",overflowY:"hidden"}},React.createElement("div",{className:"social-links",style:{textAlign:"right",paddingRight:"10px",lineHeight:"60px",position:"absolute",left:0,right:0,bottom:20,top:0,height:60}},React.createElement("a",{className:"button",style:{color:"#ccc"},href:"https://github.com/molql/molql"},"GitHub")," ",React.createElement("a",{className:"button",style:{color:"#ccc"},href:"https://twitter.com/molql"},"Twitter")),React.createElement(OffsetBox,{className:"docs"},React.createElement(Docs,{state:this.props.state}))),React.createElement("div",{className:"layout-box",style:{position:"absolute",top:heightTop,left:0,width:"66%",height:heightBottom,overflowX:"hidden",overflowY:"hidden",borderTop:"10px solid black"}},React.createElement(LiteMolPlugin,__assign({},this.props))),React.createElement("div",{className:"layout-box",style:{position:"absolute",top:heightTop,left:"66%",width:"34%",height:heightBottom,overflowX:"hidden",overflowY:"hidden",backgroundColor:"#F1F1F1",borderTop:"10px solid black"}},React.createElement(LoadMolecule,__assign({},this.props)),React.createElement(ExecuteQuery,__assign({},this.props)),React.createElement(OffsetBox,{offset:"120px"},React.createElement(QueryResult,__assign({},this.props)))))};return Root}(React.Component);exports.default=Root;function OffsetBox(props){var padding="0";return React.createElement("div",{className:props.className,style:{position:"absolute",left:padding,right:padding,bottom:padding,top:props.offset||"60px"}},props.children)}var Observer=function(_super){__extends(Observer,_super);function Observer(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this._subs=[];return _this}Observer.prototype.subscribe=function(obs,onNext){this._subs.push(obs.subscribe(onNext))};Observer.prototype.componentWillUnmount=function(){for(var _i=0,_a=this._subs;_i<_a.length;_i++){var s=_a[_i];s.dispose()}this._subs=[]};return Observer}(React.Component);var LanguageSelection=function(_super){__extends(LanguageSelection,_super);function LanguageSelection(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={language:languages_1.default[0],example:languages_1.default[0].examples[0]};return _this}LanguageSelection.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.currentLanguage,function(l){return _this.setState(l)})};LanguageSelection.prototype.render=function(){var _this=this;var langIndex=languages_1.default.indexOf(this.state.language);var exampleIndex=this.state.language.examples.indexOf(this.state.example);return React.createElement("div",{className:"row"},React.createElement("div",{className:"six columns"},React.createElement("select",{className:"u-full-width",value:langIndex,onChange:function(e){return _this.props.state.currentLanguage.onNext({language:languages_1.default[+e.target.value],example:languages_1.default[+e.target.value].examples[0]})}},languages_1.default.map(function(l,i){return React.createElement("option",{key:i,value:i},"Language: ",l.name)}))),React.createElement("div",{className:"six columns"},React.createElement("select",{className:"u-full-width",value:exampleIndex,onChange:function(e){return _this.props.state.currentLanguage.onNext({language:_this.state.language,example:_this.state.language.examples[+e.target.value]})}},React.createElement("option",{value:"-1"},"Select example..."),this.state.language.examples.map(function(e,i){return React.createElement("option",{key:i,value:i},e.name)}))))};return LanguageSelection}(Observer);var LiteMolPlugin=function(_super){__extends(LiteMolPlugin,_super);function LiteMolPlugin(){return _super!==null&&_super.apply(this,arguments)||this}LiteMolPlugin.prototype.componentDidMount=function(){var plugin=litemol_1.default.Plugin.create({target:this.target,layoutState:{hideControls:true,collapsedControlsLayout:litemol_1.default.Bootstrap.Components.CollapsedControlsLayout.Landscape},viewportBackground:"#F1F1F1"});this.props.state.plugin=plugin};LiteMolPlugin.prototype.render=function(){var _this=this;return React.createElement("div",{style:{position:"absolute",top:0,right:0,left:0,bottom:0},ref:function(ref){return _this.target=ref}})};return LiteMolPlugin}(React.Component);var Docs=function(_super){__extends(Docs,_super);function Docs(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={docs:""};return _this}Docs.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.currentLanguage,function(lang){_this.setState({docs:lang.language.docs})})};Docs.prototype.render=function(){return React.createElement(ReactMarkdown,{source:this.state.docs})};return Docs}(Observer);var LoadMolecule=function(_super){__extends(LoadMolecule,_super);function LoadMolecule(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={downloading:false};return _this}LoadMolecule.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.loadState,function(state){_this.setState({downloading:state==="downloading"})})};LoadMolecule.prototype.render=function(){var _this=this;return React.createElement("div",{className:"row"},React.createElement("div",{className:"six columns"},React.createElement("input",{className:"u-full-width",type:"text",placeholder:"PDB id...",defaultValue:this.props.state.pdbId,onChange:function(e){return _this.props.state.pdbId=e.target.value},disabled:this.state.downloading})),React.createElement("div",{className:"six columns"},React.createElement("button",{className:"u-full-width "+(!this.state.downloading?"button-primary":""),onClick:function(){return _this.props.state.loadStructure()},disabled:this.state.downloading},"Download")))};return LoadMolecule}(Observer);var ExecuteQuery=function(_super){__extends(ExecuteQuery,_super);function ExecuteQuery(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={loaded:false,queryOk:false};return _this}ExecuteQuery.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.loadState,function(state){_this.setState({loaded:state==="loaded"})});this.subscribe(this.props.state.query,function(query){_this.setState({queryOk:query.kind==="ok"})})};ExecuteQuery.prototype.render=function(){var _this=this;var isOk=this.state.loaded&&this.state.queryOk;return React.createElement("div",{className:"row"},React.createElement("button",{className:"u-full-width "+(isOk?"button-primary":""),onClick:function(){return _this.props.state.execute()},disabled:!isOk},"Execute Query (Ctrl/Cmd + Enter)"))};return ExecuteQuery}(Observer);var QueryExpression=function(_super){__extends(QueryExpression,_super);function QueryExpression(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={queryString:""};return _this}QueryExpression.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.queryString,function(queryString){if(_this.state.queryString!==queryString)_this.setState({queryString:queryString})})};QueryExpression.prototype.render=function(){var _this=this;return React.createElement(query_editor_1.default,{mode:this.props.state.currentLanguage.getValue().language.editorMode,value:this.state.queryString,onChange:function(v){return _this.props.state.queryString.onNext(v)},onSymbol:function(s){return _this.props.state.currentSymbol.onNext(s)},onActive:function(a){return _this.props.state.editorActive.onNext(a)},onExecute:function(){return _this.props.state.execute()}})};return QueryExpression}(Observer);var QueryHint=function(_super){__extends(QueryHint,_super);function QueryHint(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={description:"",info:"",isActive:false};return _this}QueryHint.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.editorActive,function(isActive){return _this.setState({isActive:isActive&&_this.props.state.currentLanguage.getValue().language.editorMode==="molql-script"})});this.subscribe(this.props.state.currentLanguage,function(lang){return _this.setState({isActive:lang.language.editorMode==="molql-script"&&_this.props.state.editorActive.getValue()})});this.subscribe(this.props.state.currentSymbol.distinctUntilChanged(),function(symbol){if(!_this.state.isActive)return;var _s=MolQLScript.SymbolMap[symbol];var symb=_s&&_s.symbol;if(symb)_this.setState({description:symb.info.description,info:markdown_docs_1.formatSymbol(symb,symbol)});else _this.setState({info:""})})};QueryHint.prototype.render=function(){if(!this.state.info||!this.state.isActive)return React.createElement("div",null);return React.createElement("div",{style:{position:"absolute",left:0,right:0,bottom:0,margin:0,padding:"10px",fontSize:"smaller"}},React.createElement("div",{style:{padding:"1rem 1.5rem"},className:"query-hint"},React.createElement("div",{style:{float:"right",fontWeight:"bold",color:"#999999"}},"Symbol Info"),React.createElement("pre",{style:{whiteSpace:"pre-wrap",wordWrap:"break-word",margin:0}},this.state.info),!!this.state.description?React.createElement("div",{style:{fontStyle:"italic",marginTop:"1rem"}},this.state.description):void 0))};return QueryHint}(Observer);var CompiledQuery=function(_super){__extends(CompiledQuery,_super);function CompiledQuery(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={expression:void 0,error:void 0,target:"lisp"};return _this}CompiledQuery.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.query,function(q){if(q.kind==="error")_this.setState({error:q.message,expression:void 0});else _this.setState({error:void 0,expression:q.expression})});this.subscribe(this.props.state.compileTarget,function(target){_this.setState({target:target})})};CompiledQuery.prototype.render=function(){var content="";if(this.state.error){content=""+this.state.error}else{content=this.state.expression?this.state.target==="lisp"?expression_formatter_1.default(this.state.expression):container_1.default.serialize(this.state.expression,{source:"molql-explorer",pretty:true}):"Enter query..."}var style={position:"absolute",left:0,right:0,bottom:0,top:0,background:"white",fontSize:"10pt",margin:0,padding:"10px",color:this.state.error?"red":void 0};if(this.state.error)return React.createElement("div",{style:style},content);return React.createElement("pre",{style:style},content)};return CompiledQuery}(Observer);var QueryResult=function(_super){__extends(QueryResult,_super);function QueryResult(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.state={result:result_1.default.empty};return _this}QueryResult.prototype.componentDidMount=function(){var _this=this;this.subscribe(this.props.state.queryResult,function(result){_this.setState({result:result})})};QueryResult.prototype.render=function(){var _this=this;var content=void 0;var result=this.state.result;switch(result.kind){case"empty":content=React.createElement("i",null,"Load molecule and execute a query...");break;case"error":content=React.createElement("div",{style:{color:"red"}},result.message);break;case"selection":{var maxShown=100;var entries=result.entries.slice(0,maxShown).map(function(e,i){return React.createElement(QueryResultEntry,{key:i,state:_this.props.state,entry:e})});if(result.entries.length<=maxShown){content=React.createElement("ol",{className:"result-entry-list"},entries)}else{content=React.createElement("div",null,React.createElement("ol",{className:"result-entry-list"},entries,React.createElement("li",null,React.createElement("i",null,"...and ",result.entries.length-maxShown," more."))))}}}return React.createElement("div",{style:{position:"absolute",left:0,right:0,bottom:0,top:0,margin:0,padding:"10px",overflowY:"scroll",overflowX:"hidden"}},content)};return QueryResult}(Observer);var QueryResultEntry=function(_super){__extends(QueryResultEntry,_super);function QueryResultEntry(){var _this=_super!==null&&_super.apply(this,arguments)||this;_this.mouseEnter=function(){result_1.ResultEntry.highlight(_this.props.state.plugin,_this.props.entry,true)};_this.mouseLeave=function(){result_1.ResultEntry.highlight(_this.props.state.plugin,_this.props.entry,false)};_this.mouseClick=function(e){result_1.ResultEntry.focus(_this.props.state.plugin,_this.props.entry)};_this.showCif=function(e){e.preventDefault();e.stopPropagation();result_1.ResultEntry.showCIF(_this.props.state.structureData.model,_this.props.entry)};return _this}QueryResultEntry.prototype.render=function(){var entry=this.props.entry;return React.createElement("li",{onMouseEnter:this.mouseEnter,onMouseLeave:this.mouseLeave,onClick:this.mouseClick,title:entry.info},React.createElement("span",null,React.createElement("a",{href:"#",onClick:this.showCif},"mmCIF")),React.createElement("span",null,entry.signature),React.createElement("span",null,"(",entry.info,")"))};return QueryResultEntry}(Observer)},function(module,exports,__webpack_require__){"use strict";var PooledClass=__webpack_require__(189);var ReactElement=__webpack_require__(22);var emptyFunction=__webpack_require__(10);var traverseAllChildren=__webpack_require__(190);var twoArgumentPooler=PooledClass.twoArgumentPooler;var fourArgumentPooler=PooledClass.fourArgumentPooler;var userProvidedKeyEscapeRegex=/\/+/g;function escapeUserProvidedKey(text){return(""+text).replace(userProvidedKeyEscapeRegex,"$&/")}function ForEachBookKeeping(forEachFunction,forEachContext){this.func=forEachFunction;this.context=forEachContext;this.count=0}ForEachBookKeeping.prototype.destructor=function(){this.func=null;this.context=null;this.count=0};PooledClass.addPoolingTo(ForEachBookKeeping,twoArgumentPooler);function forEachSingleChild(bookKeeping,child,name){var func=bookKeeping.func,context=bookKeeping.context;func.call(context,child,bookKeeping.count++)}function forEachChildren(children,forEachFunc,forEachContext){if(children==null){return children}var traverseContext=ForEachBookKeeping.getPooled(forEachFunc,forEachContext);traverseAllChildren(children,forEachSingleChild,traverseContext);ForEachBookKeeping.release(traverseContext)}function MapBookKeeping(mapResult,keyPrefix,mapFunction,mapContext){this.result=mapResult;this.keyPrefix=keyPrefix;this.func=mapFunction;this.context=mapContext;this.count=0}MapBookKeeping.prototype.destructor=function(){this.result=null;this.keyPrefix=null;this.func=null;this.context=null;this.count=0};PooledClass.addPoolingTo(MapBookKeeping,fourArgumentPooler);function mapSingleChildIntoContext(bookKeeping,child,childKey){var result=bookKeeping.result,keyPrefix=bookKeeping.keyPrefix,func=bookKeeping.func,context=bookKeeping.context;var mappedChild=func.call(context,child,bookKeeping.count++);if(Array.isArray(mappedChild)){mapIntoWithKeyPrefixInternal(mappedChild,result,childKey,emptyFunction.thatReturnsArgument)}else if(mappedChild!=null){if(ReactElement.isValidElement(mappedChild)){mappedChild=ReactElement.cloneAndReplaceKey(mappedChild,keyPrefix+(mappedChild.key&&(!child||child.key!==mappedChild.key)?escapeUserProvidedKey(mappedChild.key)+"/":"")+childKey)}result.push(mappedChild)}}function mapIntoWithKeyPrefixInternal(children,array,prefix,func,context){var escapedPrefix="";if(prefix!=null){escapedPrefix=escapeUserProvidedKey(prefix)+"/"}var traverseContext=MapBookKeeping.getPooled(array,escapedPrefix,func,context);traverseAllChildren(children,mapSingleChildIntoContext,traverseContext);MapBookKeeping.release(traverseContext)}function mapChildren(children,func,context){if(children==null){return children}var result=[];mapIntoWithKeyPrefixInternal(children,result,null,func,context);return result}function forEachSingleChildDummy(traverseContext,child,name){return null}function countChildren(children,context){return traverseAllChildren(children,forEachSingleChildDummy,null)}function toArray(children){var result=[];mapIntoWithKeyPrefixInternal(children,result,null,emptyFunction.thatReturnsArgument);return result}var ReactChildren={forEach:forEachChildren,map:mapChildren,mapIntoWithKeyPrefixInternal:mapIntoWithKeyPrefixInternal,count:countChildren,toArray:toArray};module.exports=ReactChildren},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(29);var invariant=__webpack_require__(1);var oneArgumentPooler=function(copyFieldsFrom){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,copyFieldsFrom);return instance}else{return new Klass(copyFieldsFrom)}};var twoArgumentPooler=function(a1,a2){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2);return instance}else{return new Klass(a1,a2)}};var threeArgumentPooler=function(a1,a2,a3){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3);return instance}else{return new Klass(a1,a2,a3)}};var fourArgumentPooler=function(a1,a2,a3,a4){var Klass=this;if(Klass.instancePool.length){var instance=Klass.instancePool.pop();Klass.call(instance,a1,a2,a3,a4);return instance}else{return new Klass(a1,a2,a3,a4)}};var standardReleaser=function(instance){var Klass=this;!(instance instanceof Klass)?process.env.NODE_ENV!=="production"?invariant(false,"Trying to release an instance into a pool of a different type."):_prodInvariant("25"):void 0;instance.destructor();if(Klass.instancePool.length<Klass.poolSize){Klass.instancePool.push(instance)}};var DEFAULT_POOL_SIZE=10;var DEFAULT_POOLER=oneArgumentPooler;var addPoolingTo=function(CopyConstructor,pooler){var NewKlass=CopyConstructor;NewKlass.instancePool=[];NewKlass.getPooled=pooler||DEFAULT_POOLER;if(!NewKlass.poolSize){NewKlass.poolSize=DEFAULT_POOL_SIZE}NewKlass.release=standardReleaser;return NewKlass};var PooledClass={addPoolingTo:addPoolingTo,oneArgumentPooler:oneArgumentPooler,twoArgumentPooler:twoArgumentPooler,threeArgumentPooler:threeArgumentPooler,fourArgumentPooler:fourArgumentPooler};module.exports=PooledClass}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(29);var ReactCurrentOwner=__webpack_require__(15);var REACT_ELEMENT_TYPE=__webpack_require__(99);var getIteratorFn=__webpack_require__(100);var invariant=__webpack_require__(1);var KeyEscapeUtils=__webpack_require__(191);var warning=__webpack_require__(2);var SEPARATOR=".";var SUBSEPARATOR=":";var didWarnAboutMaps=false;function getComponentKey(component,index){if(component&&typeof component==="object"&&component.key!=null){return KeyEscapeUtils.escape(component.key)}return index.toString(36)}function traverseAllChildrenImpl(children,nameSoFar,callback,traverseContext){var type=typeof children;if(type==="undefined"||type==="boolean"){children=null}if(children===null||type==="string"||type==="number"||type==="object"&&children.$$typeof===REACT_ELEMENT_TYPE){callback(traverseContext,children,nameSoFar===""?SEPARATOR+getComponentKey(children,0):nameSoFar);return 1}var child;var nextName;var subtreeCount=0;var nextNamePrefix=nameSoFar===""?SEPARATOR:nameSoFar+SUBSEPARATOR;if(Array.isArray(children)){for(var i=0;i<children.length;i++){child=children[i];nextName=nextNamePrefix+getComponentKey(child,i);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{var iteratorFn=getIteratorFn(children);if(iteratorFn){var iterator=iteratorFn.call(children);var step;if(iteratorFn!==children.entries){var ii=0;while(!(step=iterator.next()).done){child=step.value;nextName=nextNamePrefix+getComponentKey(child,ii++);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}else{if(process.env.NODE_ENV!=="production"){var mapsAsChildrenAddendum="";if(ReactCurrentOwner.current){var mapsAsChildrenOwnerName=ReactCurrentOwner.current.getName();if(mapsAsChildrenOwnerName){mapsAsChildrenAddendum=" Check the render method of `"+mapsAsChildrenOwnerName+"`."}}process.env.NODE_ENV!=="production"?warning(didWarnAboutMaps,"Using Maps as children is not yet fully supported. It is an "+"experimental feature that might be removed. Convert it to a "+"sequence / iterable of keyed ReactElements instead.%s",mapsAsChildrenAddendum):void 0;didWarnAboutMaps=true}while(!(step=iterator.next()).done){var entry=step.value;if(entry){child=entry[1];nextName=nextNamePrefix+KeyEscapeUtils.escape(entry[0])+SUBSEPARATOR+getComponentKey(child,0);subtreeCount+=traverseAllChildrenImpl(child,nextName,callback,traverseContext)}}}}else if(type==="object"){var addendum="";if(process.env.NODE_ENV!=="production"){addendum=" If you meant to render a collection of children, use an array "+"instead or wrap the object using createFragment(object) from the "+"React add-ons.";if(children._isReactElement){addendum=" It looks like you're using an element created by a different "+"version of React. Make sure to use only one copy of React."}if(ReactCurrentOwner.current){var name=ReactCurrentOwner.current.getName();if(name){addendum+=" Check the render method of `"+name+"`."}}}var childrenString=String(children);true?process.env.NODE_ENV!=="production"?invariant(false,"Objects are not valid as a React child (found: %s).%s",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):_prodInvariant("31",childrenString==="[object Object]"?"object with keys {"+Object.keys(children).join(", ")+"}":childrenString,addendum):void 0}}return subtreeCount}function traverseAllChildren(children,callback,traverseContext){if(children==null){return 0}return traverseAllChildrenImpl(children,"",callback,traverseContext)}module.exports=traverseAllChildren}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";function escape(key){var escapeRegex=/[=:]/g;var escaperLookup={"=":"=0",":":"=2"};var escapedString=(""+key).replace(escapeRegex,function(match){return escaperLookup[match]});return"$"+escapedString}function unescape(key){var unescapeRegex=/(=0|=2)/g;var unescaperLookup={"=0":"=","=2":":"};var keySubstring=key[0]==="."&&key[1]==="$"?key.substring(2):key.substring(1);return(""+keySubstring).replace(unescapeRegex,function(match){return unescaperLookup[match]})}var KeyEscapeUtils={escape:escape,unescape:unescape};module.exports=KeyEscapeUtils},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactElement=__webpack_require__(22);var createDOMFactory=ReactElement.createFactory;if(process.env.NODE_ENV!=="production"){var ReactElementValidator=__webpack_require__(101);createDOMFactory=ReactElementValidator.createFactory}var ReactDOMFactories={a:createDOMFactory("a"),abbr:createDOMFactory("abbr"),address:createDOMFactory("address"),area:createDOMFactory("area"),article:createDOMFactory("article"),aside:createDOMFactory("aside"),audio:createDOMFactory("audio"),b:createDOMFactory("b"),base:createDOMFactory("base"),bdi:createDOMFactory("bdi"),bdo:createDOMFactory("bdo"),big:createDOMFactory("big"),blockquote:createDOMFactory("blockquote"),body:createDOMFactory("body"),br:createDOMFactory("br"),button:createDOMFactory("button"),canvas:createDOMFactory("canvas"),caption:createDOMFactory("caption"),cite:createDOMFactory("cite"),code:createDOMFactory("code"),col:createDOMFactory("col"),colgroup:createDOMFactory("colgroup"),data:createDOMFactory("data"),datalist:createDOMFactory("datalist"),dd:createDOMFactory("dd"),del:createDOMFactory("del"),details:createDOMFactory("details"),dfn:createDOMFactory("dfn"),dialog:createDOMFactory("dialog"),div:createDOMFactory("div"),dl:createDOMFactory("dl"),dt:createDOMFactory("dt"),em:createDOMFactory("em"),embed:createDOMFactory("embed"),fieldset:createDOMFactory("fieldset"),figcaption:createDOMFactory("figcaption"),figure:createDOMFactory("figure"),footer:createDOMFactory("footer"),form:createDOMFactory("form"),h1:createDOMFactory("h1"),h2:createDOMFactory("h2"),h3:createDOMFactory("h3"),h4:createDOMFactory("h4"),h5:createDOMFactory("h5"),h6:createDOMFactory("h6"),head:createDOMFactory("head"),header:createDOMFactory("header"),hgroup:createDOMFactory("hgroup"),hr:createDOMFactory("hr"),html:createDOMFactory("html"),i:createDOMFactory("i"),iframe:createDOMFactory("iframe"),img:createDOMFactory("img"),input:createDOMFactory("input"),ins:createDOMFactory("ins"),kbd:createDOMFactory("kbd"),keygen:createDOMFactory("keygen"),label:createDOMFactory("label"),legend:createDOMFactory("legend"),li:createDOMFactory("li"),link:createDOMFactory("link"),main:createDOMFactory("main"),map:createDOMFactory("map"),mark:createDOMFactory("mark"),menu:createDOMFactory("menu"),menuitem:createDOMFactory("menuitem"),meta:createDOMFactory("meta"),meter:createDOMFactory("meter"),nav:createDOMFactory("nav"),noscript:createDOMFactory("noscript"),object:createDOMFactory("object"),ol:createDOMFactory("ol"),optgroup:createDOMFactory("optgroup"),option:createDOMFactory("option"),output:createDOMFactory("output"),p:createDOMFactory("p"),param:createDOMFactory("param"),picture:createDOMFactory("picture"),pre:createDOMFactory("pre"),progress:createDOMFactory("progress"),q:createDOMFactory("q"),rp:createDOMFactory("rp"),rt:createDOMFactory("rt"),ruby:createDOMFactory("ruby"),s:createDOMFactory("s"),samp:createDOMFactory("samp"),script:createDOMFactory("script"),section:createDOMFactory("section"),select:createDOMFactory("select"),small:createDOMFactory("small"),source:createDOMFactory("source"),span:createDOMFactory("span"),strong:createDOMFactory("strong"),style:createDOMFactory("style"),sub:createDOMFactory("sub"),summary:createDOMFactory("summary"),sup:createDOMFactory("sup"),table:createDOMFactory("table"),tbody:createDOMFactory("tbody"),td:createDOMFactory("td"),textarea:createDOMFactory("textarea"),tfoot:createDOMFactory("tfoot"),th:createDOMFactory("th"),thead:createDOMFactory("thead"),time:createDOMFactory("time"),title:createDOMFactory("title"),tr:createDOMFactory("tr"),track:createDOMFactory("track"),u:createDOMFactory("u"),ul:createDOMFactory("ul"),var:createDOMFactory("var"),video:createDOMFactory("video"),wbr:createDOMFactory("wbr"),circle:createDOMFactory("circle"),clipPath:createDOMFactory("clipPath"),defs:createDOMFactory("defs"),ellipse:createDOMFactory("ellipse"),g:createDOMFactory("g"),image:createDOMFactory("image"),line:createDOMFactory("line"),linearGradient:createDOMFactory("linearGradient"),mask:createDOMFactory("mask"),path:createDOMFactory("path"),pattern:createDOMFactory("pattern"),polygon:createDOMFactory("polygon"),polyline:createDOMFactory("polyline"),radialGradient:createDOMFactory("radialGradient"),rect:createDOMFactory("rect"),stop:createDOMFactory("stop"),svg:createDOMFactory("svg"),text:createDOMFactory("text"),tspan:createDOMFactory("tspan")};module.exports=ReactDOMFactories}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(29);var ReactPropTypeLocationNames=__webpack_require__(194);var ReactPropTypesSecret=__webpack_require__(195);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&process.env.NODE_ENV==="test"){ReactComponentTreeHook=__webpack_require__(9)}var loggedTypeFailures={};function checkReactTypeSpec(typeSpecs,values,location,componentName,element,debugID){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{!(typeof typeSpecs[typeSpecName]==="function")?process.env.NODE_ENV!=="production"?invariant(false,"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):_prodInvariant("84",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):void 0;error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}process.env.NODE_ENV!=="production"?warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName,typeof error):void 0;if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var componentStackInfo="";if(process.env.NODE_ENV!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=__webpack_require__(9)}if(debugID!==null){componentStackInfo=ReactComponentTreeHook.getStackAddendumByID(debugID)}else if(element!==null){componentStackInfo=ReactComponentTreeHook.getCurrentStackAddendum(element)}}process.env.NODE_ENV!=="production"?warning(false,"Failed %s type: %s%s",location,error.message,componentStackInfo):void 0}}}}module.exports=checkReactTypeSpec}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactPropTypeLocationNames={};if(process.env.NODE_ENV!=="production"){ReactPropTypeLocationNames={prop:"prop",context:"context",childContext:"child context"}}module.exports=ReactPropTypeLocationNames}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},function(module,exports,__webpack_require__){"use strict";var _require=__webpack_require__(22),isValidElement=_require.isValidElement;var factory=__webpack_require__(102);module.exports=factory(isValidElement)},function(module,exports,__webpack_require__){"use strict";(function(process){if(process.env.NODE_ENV!=="production"){var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var ReactPropTypesSecret=__webpack_require__(72);var loggedTypeFailures={}}function checkPropTypes(typeSpecs,values,location,componentName,getStack){if(process.env.NODE_ENV!=="production"){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{invariant(typeof typeSpecs[typeSpecName]==="function","%s: %s type `%s` is invalid; it must be a function, usually from "+"React.PropTypes.",componentName||"React class",location,typeSpecName);error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",location,typeSpecName,typeof error);if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var stack=getStack?getStack():"";warning(false,"Failed %s type: %s%s",location,error.message,stack!=null?stack:"")}}}}}module.exports=checkPropTypes}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";module.exports="15.6.1"},function(module,exports,__webpack_require__){"use strict";var _require=__webpack_require__(97),Component=_require.Component;var _require2=__webpack_require__(22),isValidElement=_require2.isValidElement;var ReactNoopUpdateQueue=__webpack_require__(98);var factory=__webpack_require__(200);module.exports=factory(Component,isValidElement,ReactNoopUpdateQueue)},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var emptyObject=__webpack_require__(48);var _invariant=__webpack_require__(1);if(process.env.NODE_ENV!=="production"){var warning=__webpack_require__(2)}var MIXINS_KEY="mixins";function identity(fn){return fn}var ReactPropTypeLocationNames;if(process.env.NODE_ENV!=="production"){ReactPropTypeLocationNames={prop:"prop",context:"context",childContext:"child context"}}else{ReactPropTypeLocationNames={}}function factory(ReactComponent,isValidElement,ReactNoopUpdateQueue){var injectedMixins=[];var ReactClassInterface={mixins:"DEFINE_MANY",statics:"DEFINE_MANY",propTypes:"DEFINE_MANY",contextTypes:"DEFINE_MANY",childContextTypes:"DEFINE_MANY",getDefaultProps:"DEFINE_MANY_MERGED",getInitialState:"DEFINE_MANY_MERGED",getChildContext:"DEFINE_MANY_MERGED",render:"DEFINE_ONCE",componentWillMount:"DEFINE_MANY",componentDidMount:"DEFINE_MANY",componentWillReceiveProps:"DEFINE_MANY",shouldComponentUpdate:"DEFINE_ONCE",componentWillUpdate:"DEFINE_MANY",componentDidUpdate:"DEFINE_MANY",componentWillUnmount:"DEFINE_MANY",updateComponent:"OVERRIDE_BASE"};var RESERVED_SPEC_KEYS={displayName:function(Constructor,displayName){Constructor.displayName=displayName},mixins:function(Constructor,mixins){if(mixins){for(var i=0;i<mixins.length;i++){mixSpecIntoComponent(Constructor,mixins[i])}}},childContextTypes:function(Constructor,childContextTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,childContextTypes,"childContext")}Constructor.childContextTypes=_assign({},Constructor.childContextTypes,childContextTypes)},contextTypes:function(Constructor,contextTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,contextTypes,"context")}Constructor.contextTypes=_assign({},Constructor.contextTypes,contextTypes)},getDefaultProps:function(Constructor,getDefaultProps){if(Constructor.getDefaultProps){Constructor.getDefaultProps=createMergedResultFunction(Constructor.getDefaultProps,getDefaultProps)}else{Constructor.getDefaultProps=getDefaultProps}},propTypes:function(Constructor,propTypes){if(process.env.NODE_ENV!=="production"){validateTypeDef(Constructor,propTypes,"prop")}Constructor.propTypes=_assign({},Constructor.propTypes,propTypes)},statics:function(Constructor,statics){mixStaticSpecIntoComponent(Constructor,statics)},autobind:function(){}};function validateTypeDef(Constructor,typeDef,location){for(var propName in typeDef){if(typeDef.hasOwnProperty(propName)){if(process.env.NODE_ENV!=="production"){warning(typeof typeDef[propName]==="function","%s: %s type `%s` is invalid; it must be a function, usually from "+"React.PropTypes.",Constructor.displayName||"ReactClass",ReactPropTypeLocationNames[location],propName)}}}}function validateMethodOverride(isAlreadyDefined,name){var specPolicy=ReactClassInterface.hasOwnProperty(name)?ReactClassInterface[name]:null;if(ReactClassMixin.hasOwnProperty(name)){_invariant(specPolicy==="OVERRIDE_BASE","ReactClassInterface: You are attempting to override "+"`%s` from your class specification. Ensure that your method names "+"do not overlap with React methods.",name)}if(isAlreadyDefined){_invariant(specPolicy==="DEFINE_MANY"||specPolicy==="DEFINE_MANY_MERGED","ReactClassInterface: You are attempting to define "+"`%s` on your component more than once. This conflict may be due "+"to a mixin.",name)}}function mixSpecIntoComponent(Constructor,spec){if(!spec){if(process.env.NODE_ENV!=="production"){var typeofSpec=typeof spec;var isMixinValid=typeofSpec==="object"&&spec!==null;if(process.env.NODE_ENV!=="production"){warning(isMixinValid,"%s: You're attempting to include a mixin that is either null "+"or not an object. Check the mixins included by the component, "+"as well as any mixins they include themselves. "+"Expected object but got %s.",Constructor.displayName||"ReactClass",spec===null?null:typeofSpec)}}return}_invariant(typeof spec!=="function","ReactClass: You're attempting to "+"use a component class or function as a mixin. Instead, just use a "+"regular object.");_invariant(!isValidElement(spec),"ReactClass: You're attempting to "+"use a component as a mixin. Instead, just use a regular object.");var proto=Constructor.prototype;var autoBindPairs=proto.__reactAutoBindPairs;if(spec.hasOwnProperty(MIXINS_KEY)){RESERVED_SPEC_KEYS.mixins(Constructor,spec.mixins)}for(var name in spec){if(!spec.hasOwnProperty(name)){continue}if(name===MIXINS_KEY){continue}var property=spec[name];var isAlreadyDefined=proto.hasOwnProperty(name);validateMethodOverride(isAlreadyDefined,name);if(RESERVED_SPEC_KEYS.hasOwnProperty(name)){RESERVED_SPEC_KEYS[name](Constructor,property)}else{var isReactClassMethod=ReactClassInterface.hasOwnProperty(name);var isFunction=typeof property==="function";var shouldAutoBind=isFunction&&!isReactClassMethod&&!isAlreadyDefined&&spec.autobind!==false;if(shouldAutoBind){autoBindPairs.push(name,property);proto[name]=property}else{if(isAlreadyDefined){var specPolicy=ReactClassInterface[name];_invariant(isReactClassMethod&&(specPolicy==="DEFINE_MANY_MERGED"||specPolicy==="DEFINE_MANY"),"ReactClass: Unexpected spec policy %s for key %s "+"when mixing in component specs.",specPolicy,name);if(specPolicy==="DEFINE_MANY_MERGED"){proto[name]=createMergedResultFunction(proto[name],property)}else if(specPolicy==="DEFINE_MANY"){proto[name]=createChainedFunction(proto[name],property)}}else{proto[name]=property;if(process.env.NODE_ENV!=="production"){if(typeof property==="function"&&spec.displayName){proto[name].displayName=spec.displayName+"_"+name}}}}}}}function mixStaticSpecIntoComponent(Constructor,statics){if(!statics){return}for(var name in statics){var property=statics[name];if(!statics.hasOwnProperty(name)){continue}var isReserved=name in RESERVED_SPEC_KEYS;_invariant(!isReserved,"ReactClass: You are attempting to define a reserved "+'property, `%s`, that shouldn\'t be on the "statics" key. Define it '+"as an instance property instead; it will still be accessible on the "+"constructor.",name);var isInherited=name in Constructor;_invariant(!isInherited,"ReactClass: You are attempting to define "+"`%s` on your component more than once. This conflict may be "+"due to a mixin.",name);Constructor[name]=property}}function mergeIntoWithNoDuplicateKeys(one,two){_invariant(one&&two&&typeof one==="object"&&typeof two==="object","mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects.");for(var key in two){if(two.hasOwnProperty(key)){_invariant(one[key]===undefined,"mergeIntoWithNoDuplicateKeys(): "+"Tried to merge two objects with the same key: `%s`. This conflict "+"may be due to a mixin; in particular, this may be caused by two "+"getInitialState() or getDefaultProps() methods returning objects "+"with clashing keys.",key);one[key]=two[key]}}return one}function createMergedResultFunction(one,two){return function mergedResult(){var a=one.apply(this,arguments);var b=two.apply(this,arguments);if(a==null){return b}else if(b==null){return a}var c={};mergeIntoWithNoDuplicateKeys(c,a);mergeIntoWithNoDuplicateKeys(c,b);return c}}function createChainedFunction(one,two){return function chainedFunction(){one.apply(this,arguments);two.apply(this,arguments)}}function bindAutoBindMethod(component,method){var boundMethod=method.bind(component);if(process.env.NODE_ENV!=="production"){boundMethod.__reactBoundContext=component;boundMethod.__reactBoundMethod=method;boundMethod.__reactBoundArguments=null;var componentName=component.constructor.displayName;var _bind=boundMethod.bind;boundMethod.bind=function(newThis){for(var _len=arguments.length,args=Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){args[_key-1]=arguments[_key]}if(newThis!==component&&newThis!==null){if(process.env.NODE_ENV!=="production"){warning(false,"bind(): React component methods may only be bound to the "+"component instance. See %s",componentName)}}else if(!args.length){if(process.env.NODE_ENV!=="production"){warning(false,"bind(): You are binding a component method to the component. "+"React does this for you automatically in a high-performance "+"way, so you can safely remove this call. See %s",componentName)}return boundMethod}var reboundMethod=_bind.apply(boundMethod,arguments);reboundMethod.__reactBoundContext=component;reboundMethod.__reactBoundMethod=method;reboundMethod.__reactBoundArguments=args;return reboundMethod}}return boundMethod}function bindAutoBindMethods(component){var pairs=component.__reactAutoBindPairs;for(var i=0;i<pairs.length;i+=2){var autoBindKey=pairs[i];var method=pairs[i+1];component[autoBindKey]=bindAutoBindMethod(component,method)}}var IsMountedPreMixin={componentDidMount:function(){this.__isMounted=true}};var IsMountedPostMixin={componentWillUnmount:function(){this.__isMounted=false}};var ReactClassMixin={replaceState:function(newState,callback){this.updater.enqueueReplaceState(this,newState,callback)},isMounted:function(){if(process.env.NODE_ENV!=="production"){warning(this.__didWarnIsMounted,"%s: isMounted is deprecated. Instead, make sure to clean up "+"subscriptions and pending requests in componentWillUnmount to "+"prevent memory leaks.",this.constructor&&this.constructor.displayName||this.name||"Component");this.__didWarnIsMounted=true}return!!this.__isMounted}};var ReactClassComponent=function(){};_assign(ReactClassComponent.prototype,ReactComponent.prototype,ReactClassMixin);function createClass(spec){var Constructor=identity(function(props,context,updater){if(process.env.NODE_ENV!=="production"){warning(this instanceof Constructor,"Something is calling a React component directly. Use a factory or "+"JSX instead. See: https://fb.me/react-legacyfactory")}if(this.__reactAutoBindPairs.length){bindAutoBindMethods(this)}this.props=props;this.context=context;this.refs=emptyObject;this.updater=updater||ReactNoopUpdateQueue;this.state=null;var initialState=this.getInitialState?this.getInitialState():null;if(process.env.NODE_ENV!=="production"){if(initialState===undefined&&this.getInitialState._isMockFunction){initialState=null}}_invariant(typeof initialState==="object"&&!Array.isArray(initialState),"%s.getInitialState(): must return an object or null",Constructor.displayName||"ReactCompositeComponent");this.state=initialState});Constructor.prototype=new ReactClassComponent;Constructor.prototype.constructor=Constructor;Constructor.prototype.__reactAutoBindPairs=[];injectedMixins.forEach(mixSpecIntoComponent.bind(null,Constructor));mixSpecIntoComponent(Constructor,IsMountedPreMixin);mixSpecIntoComponent(Constructor,spec);mixSpecIntoComponent(Constructor,IsMountedPostMixin);if(Constructor.getDefaultProps){Constructor.defaultProps=Constructor.getDefaultProps()}if(process.env.NODE_ENV!=="production"){if(Constructor.getDefaultProps){Constructor.getDefaultProps.isReactClassApproved={}}if(Constructor.prototype.getInitialState){Constructor.prototype.getInitialState.isReactClassApproved={}}}_invariant(Constructor.prototype.render,"createClass(...): Class specification must implement a `render` method.");if(process.env.NODE_ENV!=="production"){warning(!Constructor.prototype.componentShouldUpdate,"%s has a method called "+"componentShouldUpdate(). Did you mean shouldComponentUpdate()? "+"The name is phrased as a question because the function is "+"expected to return a value.",spec.displayName||"A component");warning(!Constructor.prototype.componentWillRecieveProps,"%s has a method called "+"componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",spec.displayName||"A component")}for(var methodName in ReactClassInterface){if(!Constructor.prototype[methodName]){Constructor.prototype[methodName]=null}}return Constructor}return createClass}module.exports=factory}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(29);var ReactElement=__webpack_require__(22);var invariant=__webpack_require__(1);function onlyChild(children){!ReactElement.isValidElement(children)?process.env.NODE_ENV!=="production"?invariant(false,"React.Children.only expected to receive a single React element child."):_prodInvariant("143"):void 0;return children}module.exports=onlyChild}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var expression_1=__webpack_require__(33);var isLiteral=expression_1.default.isLiteral,isArgumentsArray=expression_1.default.isArgumentsArray;function format(e){var writer=new Writer;_format(e,writer);return writer.getStr()}exports.default=format;var Writer=function(){function Writer(){this.value=[];this.currentLineLength=0;this.prefixLength=0;this._prefix="";this.localPrefix=""}Writer.prototype.setLocal=function(){this.localPrefix="  "};Writer.prototype.newline=function(){this.value.push("\n"+this._prefix+this.localPrefix);this.currentLineLength=0};Writer.prototype.push=function(){this.value.push("(");this.currentLineLength=0;this.localPrefix="";this.prefixLength+=2;this._prefix=new Array(this.prefixLength+1).join(" ")};Writer.prototype.pop=function(){this.value.push(")");this.prefixLength-=2;this._prefix=new Array(this.prefixLength+1).join(" ")};Writer.prototype.append=function(str){if(!this.currentLineLength){this.value.push(str);this.currentLineLength=str.length}else if(this.currentLineLength+this.prefixLength+this.localPrefix.length+str.length<80){this.value.push(str);this.currentLineLength+=str.length}else{this.setLocal();this.newline();this.value.push(str);this.currentLineLength=str.length}};Writer.prototype.whitespace=function(){if(this.currentLineLength+this.prefixLength+this.localPrefix.length+1<80){this.value.push(" ")}};Writer.prototype.getStr=function(){return this.value.join("")};return Writer}();function _format(e,writer){if(isLiteral(e)){if(typeof e==="string"&&(/\s/.test(e)||!e.length))writer.append("`"+e+"`");else writer.append(""+e);return}writer.push();_format(e.head,writer);if(!e.args){writer.pop();return}if(isArgumentsArray(e.args)){var prevLiteral=true;for(var _i=0,_a=e.args;_i<_a.length;_i++){var a=_a[_i];if(isLiteral(a)){if(prevLiteral)writer.whitespace();else writer.newline();prevLiteral=true}else{prevLiteral=false;writer.newline()}_format(a,writer)}writer.pop();return}var keys=Object.keys(e.args);if(!keys.length){writer.pop();return}if(keys.length===1&&isLiteral(e.args[keys[0]])){writer.whitespace();writer.append(":"+keys[0]);writer.whitespace();_format(e.args[keys[0]],writer);writer.pop();return}for(var _b=0,keys_1=keys;_b<keys_1.length;_b++){var a=keys_1[_b];writer.newline();writer.append(":"+a);writer.whitespace();_format(e.args[a],writer)}writer.pop()}},function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(38);var Parser=__webpack_require__(204).Parser;var ReactRenderer=__webpack_require__(219);var propTypes=__webpack_require__(224);function ReactMarkdown(props){React.Component.call(this,props)}ReactMarkdown.prototype=Object.create(React.Component.prototype);ReactMarkdown.prototype.constructor=ReactMarkdown;ReactMarkdown.prototype.render=function(){var containerProps=this.props.containerProps||{};var renderer=new ReactRenderer(this.props);var parser=new Parser(this.props.parserOptions);var ast=parser.parse(this.props.source||"");if(this.props.walker){var walker=ast.walker();var event;while(event=walker.next()){this.props.walker.call(this,event,walker)}}if(this.props.className){containerProps.className=this.props.className}return React.createElement.apply(React,[this.props.containerTagName,containerProps,this.props.childBefore].concat(renderer.render(ast).concat([this.props.childAfter])))};ReactMarkdown.propTypes={className:propTypes.string,containerProps:propTypes.object,source:propTypes.string.isRequired,containerTagName:propTypes.string,childBefore:propTypes.object,childAfter:propTypes.object,sourcePos:propTypes.bool,escapeHtml:propTypes.bool,skipHtml:propTypes.bool,softBreak:propTypes.string,allowNode:propTypes.func,allowedTypes:propTypes.array,disallowedTypes:propTypes.array,transformLinkUri:propTypes.func,transformImageUri:propTypes.func,unwrapDisallowed:propTypes.bool,renderers:propTypes.object,walker:propTypes.func,parserOptions:propTypes.object};ReactMarkdown.defaultProps={containerTagName:"div",parserOptions:{}};ReactMarkdown.types=ReactRenderer.types;ReactMarkdown.renderers=ReactRenderer.renderers;ReactMarkdown.uriTransformer=ReactRenderer.uriTransformer;module.exports=ReactMarkdown},function(module,exports,__webpack_require__){"use strict";module.exports.version="0.24.0";module.exports.Node=__webpack_require__(73);module.exports.Parser=__webpack_require__(205);module.exports.HtmlRenderer=__webpack_require__(217);module.exports.XmlRenderer=__webpack_require__(218)},function(module,exports,__webpack_require__){"use strict";var Node=__webpack_require__(73);var unescapeString=__webpack_require__(30).unescapeString;var OPENTAG=__webpack_require__(30).OPENTAG;var CLOSETAG=__webpack_require__(30).CLOSETAG;var CODE_INDENT=4;var C_TAB=9;var C_NEWLINE=10;var C_GREATERTHAN=62;var C_LESSTHAN=60;var C_SPACE=32;var C_OPEN_BRACKET=91;var InlineParser=__webpack_require__(213);var reHtmlBlockOpen=[/./,/^<(?:script|pre|style)(?:\s|>|$)/i,/^<!--/,/^<[?]/,/^<![A-Z]/,/^<!\[CDATA\[/,/^<[/]?(?:address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h1|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|title|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul)(?:\s|[/]?[>]|$)/i,new RegExp("^(?:"+OPENTAG+"|"+CLOSETAG+")s*$","i")];var reHtmlBlockClose=[/./,/<\/(?:script|pre|style)>/i,/-->/,/\?>/,/>/,/\]\]>/];var reThematicBreak=/^(?:(?:\* *){3,}|(?:_ *){3,}|(?:- *){3,}) *$/;var reMaybeSpecial=/^[#`~*+_=<>0-9-]/;var reNonSpace=/[^ \t\f\v\r\n]/;var reBulletListMarker=/^[*+-]/;var reOrderedListMarker=/^(\d{1,9})([.)])/;var reATXHeadingMarker=/^#{1,6}(?: +|$)/;var reCodeFence=/^`{3,}(?!.*`)|^~{3,}(?!.*~)/;var reClosingCodeFence=/^(?:`{3,}|~{3,})(?= *$)/;var reSetextHeadingLine=/^(?:=+|-+) *$/;var reLineEnding=/\r\n|\n|\r/;var isBlank=function(s){return!reNonSpace.test(s)};var peek=function(ln,pos){if(pos<ln.length){return ln.charCodeAt(pos)}else{return-1}};var endsWithBlankLine=function(block){while(block){if(block._lastLineBlank){return true}var t=block.type;if(t==="List"||t==="Item"){block=block._lastChild}else{break}}return false};var breakOutOfLists=function(block){var b=block;var last_list=null;do{if(b.type==="List"){last_list=b}b=b._parent}while(b);if(last_list){while(block!==last_list){this.finalize(block,this.lineNumber);block=block._parent}this.finalize(last_list,this.lineNumber);this.tip=last_list._parent}};var addLine=function(){this.tip._string_content+=this.currentLine.slice(this.offset)+"\n"};var addChild=function(tag,offset){while(!this.blocks[this.tip.type].canContain(tag)){this.finalize(this.tip,this.lineNumber-1)}var column_number=offset+1;var newBlock=new Node(tag,[[this.lineNumber,column_number],[0,0]]);newBlock._string_content="";this.tip.appendChild(newBlock);this.tip=newBlock;return newBlock};var parseListMarker=function(parser){var rest=parser.currentLine.slice(parser.nextNonspace);var match;var nextc;var spacesStartCol;var spacesStartOffset;var data={type:null,tight:true,bulletChar:null,start:null,delimiter:null,padding:null,markerOffset:parser.indent};if(match=rest.match(reBulletListMarker)){data.type="Bullet";data.bulletChar=match[0][0]}else if(match=rest.match(reOrderedListMarker)){data.type="Ordered";data.start=parseInt(match[1]);data.delimiter=match[2]}else{return null}nextc=peek(parser.currentLine,parser.nextNonspace+match[0].length);if(!(nextc===-1||nextc===C_TAB||nextc===C_SPACE)){return null}parser.advanceNextNonspace();parser.advanceOffset(match[0].length,true);spacesStartCol=parser.column;spacesStartOffset=parser.offset;do{parser.advanceOffset(1,true);nextc=peek(parser.currentLine,parser.offset)}while(parser.column-spacesStartCol<5&&(nextc===C_SPACE||nextc===C_TAB));var blank_item=peek(parser.currentLine,parser.offset)===-1;var spaces_after_marker=parser.column-spacesStartCol;if(spaces_after_marker>=5||spaces_after_marker<1||blank_item){data.padding=match[0].length+1;parser.column=spacesStartCol;parser.offset=spacesStartOffset;if(peek(parser.currentLine,parser.offset)===C_SPACE){parser.advanceOffset(1,true)}}else{data.padding=match[0].length+spaces_after_marker}return data};var listsMatch=function(list_data,item_data){return list_data.type===item_data.type&&list_data.delimiter===item_data.delimiter&&list_data.bulletChar===item_data.bulletChar};var closeUnmatchedBlocks=function(){if(!this.allClosed){while(this.oldtip!==this.lastMatchedContainer){var parent=this.oldtip._parent;this.finalize(this.oldtip,this.lineNumber-1);this.oldtip=parent}this.allClosed=true}};var blocks={Document:{continue:function(){return 0},finalize:function(){return},canContain:function(t){return t!=="Item"},acceptsLines:false},List:{continue:function(){return 0},finalize:function(parser,block){var item=block._firstChild;while(item){if(endsWithBlankLine(item)&&item._next){block._listData.tight=false;break}var subitem=item._firstChild;while(subitem){if(endsWithBlankLine(subitem)&&(item._next||subitem._next)){block._listData.tight=false;break}subitem=subitem._next}item=item._next}},canContain:function(t){return t==="Item"},acceptsLines:false},BlockQuote:{continue:function(parser){var ln=parser.currentLine;if(!parser.indented&&peek(ln,parser.nextNonspace)===C_GREATERTHAN){parser.advanceNextNonspace();parser.advanceOffset(1,false);if(peek(ln,parser.offset)===C_SPACE){parser.offset++}}else{return 1}return 0},finalize:function(){return},canContain:function(t){return t!=="Item"},acceptsLines:false},Item:{continue:function(parser,container){if(parser.blank&&container._firstChild!==null){parser.advanceNextNonspace()}else if(parser.indent>=container._listData.markerOffset+container._listData.padding){parser.advanceOffset(container._listData.markerOffset+container._listData.padding,true)}else{return 1}return 0},finalize:function(){return},canContain:function(t){return t!=="Item"},acceptsLines:false},Heading:{continue:function(){return 1},finalize:function(){return},canContain:function(){return false},acceptsLines:false},ThematicBreak:{continue:function(){return 1},finalize:function(){return},canContain:function(){return false},acceptsLines:false},CodeBlock:{continue:function(parser,container){var ln=parser.currentLine;var indent=parser.indent;if(container._isFenced){var match=indent<=3&&ln.charAt(parser.nextNonspace)===container._fenceChar&&ln.slice(parser.nextNonspace).match(reClosingCodeFence);if(match&&match[0].length>=container._fenceLength){parser.finalize(container,parser.lineNumber);return 2}else{var i=container._fenceOffset;while(i>0&&peek(ln,parser.offset)===C_SPACE){parser.advanceOffset(1,false);i--}}}else{if(indent>=CODE_INDENT){parser.advanceOffset(CODE_INDENT,true)}else if(parser.blank){parser.advanceNextNonspace()}else{return 1}}return 0},finalize:function(parser,block){if(block._isFenced){var content=block._string_content;var newlinePos=content.indexOf("\n");var firstLine=content.slice(0,newlinePos);var rest=content.slice(newlinePos+1);block.info=unescapeString(firstLine.trim());block._literal=rest}else{block._literal=block._string_content.replace(/(\n *)+$/,"\n")}block._string_content=null},canContain:function(){return false},acceptsLines:true},HtmlBlock:{continue:function(parser,container){return parser.blank&&(container._htmlBlockType===6||container._htmlBlockType===7)?1:0},finalize:function(parser,block){block._literal=block._string_content.replace(/(\n *)+$/,"");block._string_content=null},canContain:function(){return false},acceptsLines:true},Paragraph:{continue:function(parser){return parser.blank?1:0},finalize:function(parser,block){var pos;var hasReferenceDefs=false;while(peek(block._string_content,0)===C_OPEN_BRACKET&&(pos=parser.inlineParser.parseReference(block._string_content,parser.refmap))){block._string_content=block._string_content.slice(pos);hasReferenceDefs=true}if(hasReferenceDefs&&isBlank(block._string_content)){block.unlink()}},canContain:function(){return false},acceptsLines:true}};var blockStarts=[function(parser){if(!parser.indented&&peek(parser.currentLine,parser.nextNonspace)===C_GREATERTHAN){parser.advanceNextNonspace();parser.advanceOffset(1,false);if(peek(parser.currentLine,parser.offset)===C_SPACE){parser.advanceOffset(1,false)}parser.closeUnmatchedBlocks();parser.addChild("BlockQuote",parser.nextNonspace);return 1}else{return 0}},function(parser){var match;if(!parser.indented&&(match=parser.currentLine.slice(parser.nextNonspace).match(reATXHeadingMarker))){parser.advanceNextNonspace();parser.advanceOffset(match[0].length,false);parser.closeUnmatchedBlocks();var container=parser.addChild("Heading",parser.nextNonspace);container.level=match[0].trim().length;container._string_content=parser.currentLine.slice(parser.offset).replace(/^ *#+ *$/,"").replace(/ +#+ *$/,"");parser.advanceOffset(parser.currentLine.length-parser.offset);return 2}else{return 0}},function(parser){var match;if(!parser.indented&&(match=parser.currentLine.slice(parser.nextNonspace).match(reCodeFence))){var fenceLength=match[0].length;parser.closeUnmatchedBlocks();var container=parser.addChild("CodeBlock",parser.nextNonspace);container._isFenced=true;container._fenceLength=fenceLength;container._fenceChar=match[0][0];container._fenceOffset=parser.indent;parser.advanceNextNonspace();parser.advanceOffset(fenceLength,false);return 2}else{return 0}},function(parser,container){if(!parser.indented&&peek(parser.currentLine,parser.nextNonspace)===C_LESSTHAN){var s=parser.currentLine.slice(parser.nextNonspace);var blockType;for(blockType=1;blockType<=7;blockType++){if(reHtmlBlockOpen[blockType].test(s)&&(blockType<7||container.type!=="Paragraph")){parser.closeUnmatchedBlocks();var b=parser.addChild("HtmlBlock",parser.offset);b._htmlBlockType=blockType;return 2}}}return 0},function(parser,container){var match;if(!parser.indented&&container.type==="Paragraph"&&(match=parser.currentLine.slice(parser.nextNonspace).match(reSetextHeadingLine))){parser.closeUnmatchedBlocks();var heading=new Node("Heading",container.sourcepos);heading.level=match[0][0]==="="?1:2;heading._string_content=container._string_content;container.insertAfter(heading);container.unlink();parser.tip=heading;parser.advanceOffset(parser.currentLine.length-parser.offset,false);return 2}else{return 0}},function(parser){if(!parser.indented&&reThematicBreak.test(parser.currentLine.slice(parser.nextNonspace))){parser.closeUnmatchedBlocks();parser.addChild("ThematicBreak",parser.nextNonspace);parser.advanceOffset(parser.currentLine.length-parser.offset,false);return 2}else{return 0}},function(parser,container){var data;if((!parser.indented||container.type==="List")&&(data=parseListMarker(parser))){parser.closeUnmatchedBlocks();if(parser.tip.type!=="List"||!listsMatch(container._listData,data)){container=parser.addChild("List",parser.nextNonspace);container._listData=data}container=parser.addChild("Item",parser.nextNonspace);container._listData=data;return 1}else{return 0}},function(parser){if(parser.indented&&parser.tip.type!=="Paragraph"&&!parser.blank){parser.advanceOffset(CODE_INDENT,true);parser.closeUnmatchedBlocks();parser.addChild("CodeBlock",parser.offset);return 2}else{return 0}}];var advanceOffset=function(count,columns){var cols=0;var currentLine=this.currentLine;var charsToTab;var c;while(count>0&&(c=currentLine[this.offset])){if(c==="\t"){charsToTab=4-this.column%4;this.column+=charsToTab;this.offset+=1;count-=columns?charsToTab:1}else{cols+=1;this.offset+=1;this.column+=1;count-=1}}};var advanceNextNonspace=function(){this.offset=this.nextNonspace;this.column=this.nextNonspaceColumn};var findNextNonspace=function(){var currentLine=this.currentLine;var i=this.offset;var cols=this.column;var c;while((c=currentLine.charAt(i))!==""){if(c===" "){i++;cols++}else if(c==="\t"){i++;cols+=4-cols%4}else{break}}this.blank=c==="\n"||c==="\r"||c==="";this.nextNonspace=i;this.nextNonspaceColumn=cols;this.indent=this.nextNonspaceColumn-this.column;this.indented=this.indent>=CODE_INDENT};var incorporateLine=function(ln){var all_matched=true;var t;var container=this.doc;this.oldtip=this.tip;this.offset=0;this.column=0;this.lineNumber+=1;if(ln.indexOf("\0")!==-1){ln=ln.replace(/\0/g,"�")}this.currentLine=ln;var lastChild;while((lastChild=container._lastChild)&&lastChild._open){container=lastChild;this.findNextNonspace();switch(this.blocks[container.type].continue(this,container)){case 0:break;case 1:all_matched=false;break;case 2:this.lastLineLength=ln.length;return;default:throw"continue returned illegal value, must be 0, 1, or 2"}if(!all_matched){container=container._parent;break}}this.allClosed=container===this.oldtip;this.lastMatchedContainer=container;if(this.blank&&container._lastLineBlank){this.breakOutOfLists(container);container=this.tip}var matchedLeaf=container.type!=="Paragraph"&&blocks[container.type].acceptsLines;var starts=this.blockStarts;var startsLen=starts.length;while(!matchedLeaf){this.findNextNonspace();if(!this.indented&&!reMaybeSpecial.test(ln.slice(this.nextNonspace))){this.advanceNextNonspace();break}var i=0;while(i<startsLen){var res=starts[i](this,container);if(res===1){container=this.tip;break}else if(res===2){container=this.tip;matchedLeaf=true;break}else{i++}}if(i===startsLen){this.advanceNextNonspace();break}}if(!this.allClosed&&!this.blank&&this.tip.type==="Paragraph"){this.addLine()}else{this.closeUnmatchedBlocks();if(this.blank&&container.lastChild){container.lastChild._lastLineBlank=true}t=container.type;var lastLineBlank=this.blank&&!(t==="BlockQuote"||t==="CodeBlock"&&container._isFenced||t==="Item"&&!container._firstChild&&container.sourcepos[0][0]===this.lineNumber);var cont=container;while(cont){cont._lastLineBlank=lastLineBlank;cont=cont._parent}if(this.blocks[t].acceptsLines){this.addLine();if(t==="HtmlBlock"&&container._htmlBlockType>=1&&container._htmlBlockType<=5&&reHtmlBlockClose[container._htmlBlockType].test(this.currentLine.slice(this.offset))){this.finalize(container,this.lineNumber)}}else if(this.offset<ln.length&&!this.blank){container=this.addChild("Paragraph",this.offset);this.advanceNextNonspace();this.addLine()}}this.lastLineLength=ln.length};var finalize=function(block,lineNumber){var above=block._parent;block._open=false;block.sourcepos[1]=[lineNumber,this.lastLineLength];this.blocks[block.type].finalize(this,block);this.tip=above};var processInlines=function(block){var node,event,t;var walker=block.walker();this.inlineParser.refmap=this.refmap;this.inlineParser.options=this.options;while(event=walker.next()){node=event.node;t=node.type;if(!event.entering&&(t==="Paragraph"||t==="Heading")){this.inlineParser.parse(node)}}};var Document=function(){var doc=new Node("Document",[[1,1],[0,0]]);return doc};var parse=function(input){this.doc=new Document;this.tip=this.doc;this.refmap={};this.lineNumber=0;this.lastLineLength=0;this.offset=0;this.column=0;this.lastMatchedContainer=this.doc;this.currentLine="";if(this.options.time){console.time("preparing input")}var lines=input.split(reLineEnding);var len=lines.length;if(input.charCodeAt(input.length-1)===C_NEWLINE){len-=1}if(this.options.time){console.timeEnd("preparing input")}if(this.options.time){console.time("block parsing")}for(var i=0;i<len;i++){this.incorporateLine(lines[i])}while(this.tip){this.finalize(this.tip,len)}if(this.options.time){console.timeEnd("block parsing")}if(this.options.time){console.time("inline parsing")}this.processInlines(this.doc);if(this.options.time){console.timeEnd("inline parsing")}return this.doc};function Parser(options){return{doc:new Document,blocks:blocks,blockStarts:blockStarts,tip:this.doc,oldtip:this.doc,currentLine:"",lineNumber:0,offset:0,column:0,nextNonspace:0,nextNonspaceColumn:0,indent:0,indented:false,blank:false,allClosed:true,lastMatchedContainer:this.doc,refmap:{},lastLineLength:0,inlineParser:new InlineParser(options),findNextNonspace:findNextNonspace,advanceOffset:advanceOffset,advanceNextNonspace:advanceNextNonspace,breakOutOfLists:breakOutOfLists,addLine:addLine,addChild:addChild,incorporateLine:incorporateLine,finalize:finalize,processInlines:processInlines,closeUnmatchedBlocks:closeUnmatchedBlocks,parse:parse,options:options||{}}}module.exports=Parser},function(module,exports,__webpack_require__){"use strict";var encodeCache={};function getEncodeCache(exclude){var i,ch,cache=encodeCache[exclude];if(cache){return cache}cache=encodeCache[exclude]=[];for(i=0;i<128;i++){ch=String.fromCharCode(i);if(/^[0-9a-z]$/i.test(ch)){cache.push(ch)}else{cache.push("%"+("0"+i.toString(16).toUpperCase()).slice(-2))}}for(i=0;i<exclude.length;i++){cache[exclude.charCodeAt(i)]=exclude[i]}return cache}function encode(string,exclude,keepEscaped){var i,l,code,nextCode,cache,result="";if(typeof exclude!=="string"){keepEscaped=exclude;exclude=encode.defaultChars}if(typeof keepEscaped==="undefined"){keepEscaped=true}cache=getEncodeCache(exclude);for(i=0,l=string.length;i<l;i++){code=string.charCodeAt(i);if(keepEscaped&&code===37&&i+2<l){if(/^[0-9a-f]{2}$/i.test(string.slice(i+1,i+3))){result+=string.slice(i,i+3);i+=2;continue}}if(code<128){result+=cache[code];continue}if(code>=55296&&code<=57343){if(code>=55296&&code<=56319&&i+1<l){nextCode=string.charCodeAt(i+1);if(nextCode>=56320&&nextCode<=57343){result+=encodeURIComponent(string[i]+string[i+1]);i++;continue}}result+="%EF%BF%BD";continue}result+=encodeURIComponent(string[i])}return result}encode.defaultChars=";/?:@&=+$,-_.!~*'()#";encode.componentChars="-_.!~*'()";module.exports=encode},function(module,exports,__webpack_require__){"use strict";var decodeCache={};function getDecodeCache(exclude){var i,ch,cache=decodeCache[exclude];if(cache){return cache}cache=decodeCache[exclude]=[];for(i=0;i<128;i++){ch=String.fromCharCode(i);cache.push(ch)}for(i=0;i<exclude.length;i++){ch=exclude.charCodeAt(i);cache[ch]="%"+("0"+ch.toString(16).toUpperCase()).slice(-2)}return cache}function decode(string,exclude){var cache;if(typeof exclude!=="string"){exclude=decode.defaultChars}cache=getDecodeCache(exclude);return string.replace(/(%[a-f0-9]{2})+/gi,function(seq){var i,l,b1,b2,b3,b4,chr,result="";for(i=0,l=seq.length;i<l;i+=3){b1=parseInt(seq.slice(i+1,i+3),16);if(b1<128){result+=cache[b1];continue}if((b1&224)===192&&i+3<l){b2=parseInt(seq.slice(i+4,i+6),16);if((b2&192)===128){chr=b1<<6&1984|b2&63;if(chr<128){result+="��"}else{result+=String.fromCharCode(chr)}i+=3;continue}}if((b1&240)===224&&i+6<l){b2=parseInt(seq.slice(i+4,i+6),16);b3=parseInt(seq.slice(i+7,i+9),16);if((b2&192)===128&&(b3&192)===128){chr=b1<<12&61440|b2<<6&4032|b3&63;if(chr<2048||chr>=55296&&chr<=57343){result+="���"}else{result+=String.fromCharCode(chr)}i+=6;continue}}if((b1&248)===240&&i+9<l){b2=parseInt(seq.slice(i+4,i+6),16);b3=parseInt(seq.slice(i+7,i+9),16);b4=parseInt(seq.slice(i+10,i+12),16);if((b2&192)===128&&(b3&192)===128&&(b4&192)===128){chr=b1<<18&1835008|b2<<12&258048|b3<<6&4032|b4&63;if(chr<65536||chr>1114111){result+="����"}else{chr-=65536;result+=String.fromCharCode(55296+(chr>>10),56320+(chr&1023))}i+=9;continue}}result+="�"}return result})}decode.defaultChars=";/?:@&=+$,#";decode.componentChars="";module.exports=decode},function(module,exports,__webpack_require__){var inverseXML=getInverseObj(__webpack_require__(105)),xmlReplacer=getInverseReplacer(inverseXML);exports.XML=getInverse(inverseXML,xmlReplacer);var inverseHTML=getInverseObj(__webpack_require__(106)),htmlReplacer=getInverseReplacer(inverseHTML);exports.HTML=getInverse(inverseHTML,htmlReplacer);function getInverseObj(obj){return Object.keys(obj).sort().reduce(function(inverse,name){inverse[obj[name]]="&"+name+";";return inverse},{})}function getInverseReplacer(inverse){var single=[],multiple=[];Object.keys(inverse).forEach(function(k){if(k.length===1){single.push("\\"+k)}else{multiple.push(k)}});multiple.unshift("["+single.join("")+"]");return new RegExp(multiple.join("|"),"g")}var re_nonASCII=/[^\0-\x7F]/g,re_astralSymbols=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g;function singleCharReplacer(c){return"&#x"+c.charCodeAt(0).toString(16).toUpperCase()+";"}function astralReplacer(c){var high=c.charCodeAt(0);var low=c.charCodeAt(1);var codePoint=(high-55296)*1024+low-56320+65536;return"&#x"+codePoint.toString(16).toUpperCase()+";"}function getInverse(inverse,re){function func(name){return inverse[name]}return function(data){return data.replace(re,func).replace(re_astralSymbols,astralReplacer).replace(re_nonASCII,singleCharReplacer)}}var re_xmlChars=getInverseReplacer(inverseXML);function escapeXML(data){return data.replace(re_xmlChars,singleCharReplacer).replace(re_astralSymbols,astralReplacer).replace(re_nonASCII,singleCharReplacer)}exports.escape=escapeXML},function(module,exports,__webpack_require__){var entityMap=__webpack_require__(106),legacyMap=__webpack_require__(210),xmlMap=__webpack_require__(105),decodeCodePoint=__webpack_require__(211);var decodeXMLStrict=getStrictDecoder(xmlMap),decodeHTMLStrict=getStrictDecoder(entityMap);function getStrictDecoder(map){var keys=Object.keys(map).join("|"),replace=getReplacer(map);keys+="|#[xX][\\da-fA-F]+|#\\d+";var re=new RegExp("&(?:"+keys+");","g");return function(str){return String(str).replace(re,replace)}}var decodeHTML=function(){var legacy=Object.keys(legacyMap).sort(sorter);var keys=Object.keys(entityMap).sort(sorter);for(var i=0,j=0;i<keys.length;i++){if(legacy[j]===keys[i]){keys[i]+=";?";j++}else{keys[i]+=";"}}var re=new RegExp("&(?:"+keys.join("|")+"|#[xX][\\da-fA-F]+;?|#\\d+;?)","g"),replace=getReplacer(entityMap);function replacer(str){if(str.substr(-1)!==";")str+=";";return replace(str)}return function(str){return String(str).replace(re,replacer)}}();function sorter(a,b){return a<b?1:-1}function getReplacer(map){return function replace(str){if(str.charAt(1)==="#"){if(str.charAt(2)==="X"||str.charAt(2)==="x"){return decodeCodePoint(parseInt(str.substr(3),16))}return decodeCodePoint(parseInt(str.substr(2),10))}return map[str.slice(1,-1)]}}module.exports={XML:decodeXMLStrict,HTML:decodeHTML,HTMLStrict:decodeHTMLStrict}},function(module,exports){module.exports={Aacute:"Á",aacute:"á",Acirc:"Â",acirc:"â",acute:"´",AElig:"Æ",aelig:"æ",Agrave:"À",agrave:"à",amp:"&",AMP:"&",Aring:"Å",aring:"å",Atilde:"Ã",atilde:"ã",Auml:"Ä",auml:"ä",brvbar:"¦",Ccedil:"Ç",ccedil:"ç",cedil:"¸",cent:"¢",copy:"©",COPY:"©",curren:"¤",deg:"°",divide:"÷",Eacute:"É",eacute:"é",Ecirc:"Ê",ecirc:"ê",Egrave:"È",egrave:"è",ETH:"Ð",eth:"ð",Euml:"Ë",euml:"ë",frac12:"½",frac14:"¼",frac34:"¾",gt:">",GT:">",Iacute:"Í",iacute:"í",Icirc:"Î",icirc:"î",iexcl:"¡",Igrave:"Ì",igrave:"ì",iquest:"¿",Iuml:"Ï",iuml:"ï",laquo:"«",lt:"<",LT:"<",macr:"¯",micro:"µ",middot:"·",nbsp:" ",not:"¬",Ntilde:"Ñ",ntilde:"ñ",Oacute:"Ó",oacute:"ó",Ocirc:"Ô",ocirc:"ô",Ograve:"Ò",ograve:"ò",ordf:"ª",ordm:"º",Oslash:"Ø",oslash:"ø",Otilde:"Õ",otilde:"õ",Ouml:"Ö",ouml:"ö",para:"¶",plusmn:"±",pound:"£",quot:'"',QUOT:'"',raquo:"»",reg:"®",REG:"®",sect:"§",shy:"­",sup1:"¹",sup2:"²",sup3:"³",szlig:"ß",THORN:"Þ",thorn:"þ",times:"×",Uacute:"Ú",uacute:"ú",Ucirc:"Û",ucirc:"û",Ugrave:"Ù",ugrave:"ù",uml:"¨",Uuml:"Ü",uuml:"ü",Yacute:"Ý",yacute:"ý",yen:"¥",yuml:"ÿ"}},function(module,exports,__webpack_require__){var decodeMap=__webpack_require__(212);module.exports=decodeCodePoint;function decodeCodePoint(codePoint){if(codePoint>=55296&&codePoint<=57343||codePoint>1114111){return"�"}if(codePoint in decodeMap){codePoint=decodeMap[codePoint]}var output="";if(codePoint>65535){codePoint-=65536;output+=String.fromCharCode(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}output+=String.fromCharCode(codePoint);return output}},function(module,exports){module.exports={0:65533,128:8364,130:8218,131:402,132:8222,133:8230,134:8224,135:8225,136:710,137:8240,138:352,139:8249,140:338,142:381,145:8216,146:8217,147:8220,148:8221,149:8226,150:8211,151:8212,152:732,153:8482,154:353,155:8250,156:339,158:382,159:376}},function(module,exports,__webpack_require__){"use strict";var Node=__webpack_require__(73);var common=__webpack_require__(30);var normalizeReference=__webpack_require__(214);var normalizeURI=common.normalizeURI;var unescapeString=common.unescapeString;var fromCodePoint=__webpack_require__(215);var decodeHTML=__webpack_require__(104).decodeHTML;__webpack_require__(216);var C_NEWLINE=10;var C_ASTERISK=42;var C_UNDERSCORE=95;var C_BACKTICK=96;var C_OPEN_BRACKET=91;var C_CLOSE_BRACKET=93;var C_LESSTHAN=60;var C_BANG=33;var C_BACKSLASH=92;var C_AMPERSAND=38;var C_OPEN_PAREN=40;var C_CLOSE_PAREN=41;var C_COLON=58;var C_SINGLEQUOTE=39;var C_DOUBLEQUOTE=34;var ESCAPABLE=common.ESCAPABLE;var ESCAPED_CHAR="\\\\"+ESCAPABLE;var REG_CHAR="[^\\\\()\\x00-\\x20]";var IN_PARENS_NOSP="\\(("+REG_CHAR+"|"+ESCAPED_CHAR+"|\\\\)*\\)";var ENTITY=common.ENTITY;var reHtmlTag=common.reHtmlTag;var rePunctuation=new RegExp(/^[\u2000-\u206F\u2E00-\u2E7F\\'!"#\$%&\(\)\*\+,\-\.\/:;<=>\?@\[\]\^_`\{\|\}~]/);var reLinkTitle=new RegExp('^(?:"('+ESCAPED_CHAR+'|[^"\\x00])*"'+"|"+"'("+ESCAPED_CHAR+"|[^'\\x00])*'"+"|"+"\\(("+ESCAPED_CHAR+"|[^)\\x00])*\\))");var reLinkDestinationBraces=new RegExp("^(?:[<](?:[^ <>\\t\\n\\\\\\x00]"+"|"+ESCAPED_CHAR+"|"+"\\\\)*[>])");var reLinkDestination=new RegExp("^(?:"+REG_CHAR+"+|"+ESCAPED_CHAR+"|\\\\|"+IN_PARENS_NOSP+")*");var reEscapable=new RegExp("^"+ESCAPABLE);var reEntityHere=new RegExp("^"+ENTITY,"i");var reTicks=/`+/;var reTicksHere=/^`+/;var reEllipses=/\.\.\./g;var reDash=/--+/g;var reEmailAutolink=/^<([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*)>/;var reAutolink=/^<[A-Za-z][A-Za-z0-9.+-]{1,31}:[^<>\x00-\x20]*>/i;var reSpnl=/^ *(?:\n *)?/;var reWhitespaceChar=/^\s/;var reWhitespace=/\s+/g;var reFinalSpace=/ *$/;var reInitialSpace=/^ */;var reSpaceAtEndOfLine=/^ *(?:\n|$)/;var reLinkLabel=new RegExp("^\\[(?:[^\\\\\\[\\]]|"+ESCAPED_CHAR+"|\\\\){0,1000}\\]");var reMain=/^[^\n`\[\]\\!<&*_'"]+/m;var text=function(s){var node=new Node("Text");node._literal=s;return node};var match=function(re){var m=re.exec(this.subject.slice(this.pos));if(m===null){return null}else{this.pos+=m.index+m[0].length;return m[0]}};var peek=function(){if(this.pos<this.subject.length){return this.subject.charCodeAt(this.pos)}else{return-1}};var spnl=function(){this.match(reSpnl);return true};var parseBackticks=function(block){var ticks=this.match(reTicksHere);if(ticks===null){return false}var afterOpenTicks=this.pos;var matched;var node;while((matched=this.match(reTicks))!==null){if(matched===ticks){node=new Node("Code");node._literal=this.subject.slice(afterOpenTicks,this.pos-ticks.length).trim().replace(reWhitespace," ");block.appendChild(node);return true}}this.pos=afterOpenTicks;block.appendChild(text(ticks));return true};var parseBackslash=function(block){var subj=this.subject;var node;this.pos+=1;if(this.peek()===C_NEWLINE){this.pos+=1;node=new Node("Hardbreak");block.appendChild(node)}else if(reEscapable.test(subj.charAt(this.pos))){block.appendChild(text(subj.charAt(this.pos)));this.pos+=1}else{block.appendChild(text("\\"))}return true};var parseAutolink=function(block){var m;var dest;var node;if(m=this.match(reEmailAutolink)){dest=m.slice(1,m.length-1);node=new Node("Link");node._destination=normalizeURI("mailto:"+dest);node._title="";node.appendChild(text(dest));block.appendChild(node);return true}else if(m=this.match(reAutolink)){dest=m.slice(1,m.length-1);node=new Node("Link");node._destination=normalizeURI(dest);node._title="";node.appendChild(text(dest));block.appendChild(node);return true}else{return false}};var parseHtmlTag=function(block){var m=this.match(reHtmlTag);if(m===null){return false}else{var node=new Node("HtmlInline");node._literal=m;block.appendChild(node);return true}};var scanDelims=function(cc){var numdelims=0;var char_before,char_after,cc_after;var startpos=this.pos;var left_flanking,right_flanking,can_open,can_close;var after_is_whitespace,after_is_punctuation,before_is_whitespace,before_is_punctuation;if(cc===C_SINGLEQUOTE||cc===C_DOUBLEQUOTE){numdelims++;this.pos++}else{while(this.peek()===cc){numdelims++;this.pos++}}if(numdelims===0){return null}char_before=startpos===0?"\n":this.subject.charAt(startpos-1);cc_after=this.peek();if(cc_after===-1){char_after="\n"}else{char_after=fromCodePoint(cc_after)}after_is_whitespace=reWhitespaceChar.test(char_after);after_is_punctuation=rePunctuation.test(char_after);before_is_whitespace=reWhitespaceChar.test(char_before);before_is_punctuation=rePunctuation.test(char_before);left_flanking=!after_is_whitespace&&!(after_is_punctuation&&!before_is_whitespace&&!before_is_punctuation);right_flanking=!before_is_whitespace&&!(before_is_punctuation&&!after_is_whitespace&&!after_is_punctuation);if(cc===C_UNDERSCORE){can_open=left_flanking&&(!right_flanking||before_is_punctuation);can_close=right_flanking&&(!left_flanking||after_is_punctuation)}else if(cc===C_SINGLEQUOTE||cc===C_DOUBLEQUOTE){can_open=left_flanking&&!right_flanking;can_close=right_flanking}else{can_open=left_flanking;can_close=right_flanking}this.pos=startpos;return{numdelims:numdelims,can_open:can_open,can_close:can_close}};var handleDelim=function(cc,block){var res=this.scanDelims(cc);if(!res){return false}var numdelims=res.numdelims;var startpos=this.pos;var contents;this.pos+=numdelims;if(cc===C_SINGLEQUOTE){contents="’"}else if(cc===C_DOUBLEQUOTE){contents="“"}else{contents=this.subject.slice(startpos,this.pos)}var node=text(contents);block.appendChild(node);this.delimiters={cc:cc,numdelims:numdelims,node:node,previous:this.delimiters,next:null,can_open:res.can_open,can_close:res.can_close,active:true};if(this.delimiters.previous!==null){this.delimiters.previous.next=this.delimiters}return true};var removeDelimiter=function(delim){if(delim.previous!==null){delim.previous.next=delim.next}if(delim.next===null){this.delimiters=delim.previous}else{delim.next.previous=delim.previous}};var removeDelimitersBetween=function(bottom,top){if(bottom.next!==top){bottom.next=top;top.previous=bottom}};var processEmphasis=function(stack_bottom){var opener,closer,old_closer;var opener_inl,closer_inl;var tempstack;var use_delims;var tmp,next;var opener_found;var openers_bottom=[];openers_bottom[C_UNDERSCORE]=stack_bottom;openers_bottom[C_ASTERISK]=stack_bottom;openers_bottom[C_SINGLEQUOTE]=stack_bottom;openers_bottom[C_DOUBLEQUOTE]=stack_bottom;closer=this.delimiters;while(closer!==null&&closer.previous!==stack_bottom){closer=closer.previous}while(closer!==null){var closercc=closer.cc;if(!(closer.can_close&&(closercc===C_UNDERSCORE||closercc===C_ASTERISK||closercc===C_SINGLEQUOTE||closercc===C_DOUBLEQUOTE))){closer=closer.next}else{opener=closer.previous;opener_found=false;while(opener!==null&&opener!==stack_bottom&&opener!==openers_bottom[closercc]){if(opener.cc===closer.cc&&opener.can_open){opener_found=true;break}opener=opener.previous}old_closer=closer;if(closercc===C_ASTERISK||closercc===C_UNDERSCORE){if(!opener_found){closer=closer.next}else{if(closer.numdelims<3||opener.numdelims<3){use_delims=closer.numdelims<=opener.numdelims?closer.numdelims:opener.numdelims}else{use_delims=closer.numdelims%2===0?2:1}opener_inl=opener.node;closer_inl=closer.node;opener.numdelims-=use_delims;closer.numdelims-=use_delims;opener_inl._literal=opener_inl._literal.slice(0,opener_inl._literal.length-use_delims);closer_inl._literal=closer_inl._literal.slice(0,closer_inl._literal.length-use_delims);var emph=new Node(use_delims===1?"Emph":"Strong");tmp=opener_inl._next;while(tmp&&tmp!==closer_inl){next=tmp._next;tmp.unlink();emph.appendChild(tmp);tmp=next}opener_inl.insertAfter(emph);removeDelimitersBetween(opener,closer);if(opener.numdelims===0){opener_inl.unlink();this.removeDelimiter(opener)}if(closer.numdelims===0){closer_inl.unlink();tempstack=closer.next;this.removeDelimiter(closer);closer=tempstack}}}else if(closercc===C_SINGLEQUOTE){closer.node._literal="’";if(opener_found){opener.node._literal="‘"}closer=closer.next}else if(closercc===C_DOUBLEQUOTE){closer.node._literal="”";if(opener_found){opener.node.literal="“"}closer=closer.next}if(!opener_found){openers_bottom[closercc]=old_closer.previous;if(!old_closer.can_open){this.removeDelimiter(old_closer)}}}}while(this.delimiters!==null&&this.delimiters!==stack_bottom){this.removeDelimiter(this.delimiters)}};var parseLinkTitle=function(){var title=this.match(reLinkTitle);if(title===null){return null}else{return unescapeString(title.substr(1,title.length-2))}};var parseLinkDestination=function(){var res=this.match(reLinkDestinationBraces);if(res===null){res=this.match(reLinkDestination);if(res===null){return null}else{return normalizeURI(unescapeString(res))}}else{return normalizeURI(unescapeString(res.substr(1,res.length-2)))}};var parseLinkLabel=function(){var m=this.match(reLinkLabel);if(m===null||m.length>1001){return 0}else{return m.length}};var parseOpenBracket=function(block){var startpos=this.pos;this.pos+=1;var node=text("[");block.appendChild(node);this.delimiters={cc:C_OPEN_BRACKET,numdelims:1,node:node,previous:this.delimiters,next:null,can_open:true,can_close:false,index:startpos,active:true};if(this.delimiters.previous!==null){this.delimiters.previous.next=this.delimiters}return true};var parseBang=function(block){var startpos=this.pos;this.pos+=1;if(this.peek()===C_OPEN_BRACKET){this.pos+=1;var node=text("![");block.appendChild(node);this.delimiters={cc:C_BANG,numdelims:1,node:node,previous:this.delimiters,next:null,can_open:true,can_close:false,index:startpos+1,active:true};if(this.delimiters.previous!==null){this.delimiters.previous.next=this.delimiters}}else{block.appendChild(text("!"))}return true};var parseCloseBracket=function(block){var startpos;var is_image;var dest;var title;var matched=false;var reflabel;var opener;this.pos+=1;startpos=this.pos;opener=this.delimiters;while(opener!==null){if(opener.cc===C_OPEN_BRACKET||opener.cc===C_BANG){break}opener=opener.previous}if(opener===null){block.appendChild(text("]"));return true}if(!opener.active){block.appendChild(text("]"));this.removeDelimiter(opener);return true}is_image=opener.cc===C_BANG;if(this.peek()===C_OPEN_PAREN){this.pos++;if(this.spnl()&&(dest=this.parseLinkDestination())!==null&&this.spnl()&&(reWhitespaceChar.test(this.subject.charAt(this.pos-1))&&(title=this.parseLinkTitle())||true)&&this.spnl()&&this.peek()===C_CLOSE_PAREN){this.pos+=1;matched=true}}else{var savepos=this.pos;var beforelabel=this.pos;var n=this.parseLinkLabel();if(n===0||n===2){reflabel=this.subject.slice(opener.index,startpos)}else{reflabel=this.subject.slice(beforelabel,beforelabel+n)}if(n===0){this.pos=savepos}var link=this.refmap[normalizeReference(reflabel)];if(link){dest=link.destination;title=link.title;matched=true}}if(matched){var node=new Node(is_image?"Image":"Link");node._destination=dest;node._title=title||"";var tmp,next;tmp=opener.node._next;while(tmp){next=tmp._next;tmp.unlink();node.appendChild(tmp);tmp=next}block.appendChild(node);this.processEmphasis(opener.previous);opener.node.unlink();if(!is_image){opener=this.delimiters;while(opener!==null){if(opener.cc===C_OPEN_BRACKET){opener.active=false}opener=opener.previous}}return true}else{this.removeDelimiter(opener);this.pos=startpos;block.appendChild(text("]"));return true}};var parseEntity=function(block){var m;if(m=this.match(reEntityHere)){block.appendChild(text(decodeHTML(m)));return true}else{return false}};var parseString=function(block){var m;if(m=this.match(reMain)){if(this.options.smart){block.appendChild(text(m.replace(reEllipses,"…").replace(reDash,function(chars){var enCount=0;var emCount=0;if(chars.length%3===0){emCount=chars.length/3}else if(chars.length%2===0){enCount=chars.length/2}else if(chars.length%3===2){enCount=1;emCount=(chars.length-2)/3}else{enCount=2;emCount=(chars.length-4)/3}return"—".repeat(emCount)+"–".repeat(enCount)})))}else{block.appendChild(text(m))}return true}else{return false}};var parseNewline=function(block){this.pos+=1;var lastc=block._lastChild;if(lastc&&lastc.type==="Text"&&lastc._literal[lastc._literal.length-1]===" "){var hardbreak=lastc._literal[lastc._literal.length-2]===" ";lastc._literal=lastc._literal.replace(reFinalSpace,"");block.appendChild(new Node(hardbreak?"Hardbreak":"Softbreak"))}else{block.appendChild(new Node("Softbreak"))}this.match(reInitialSpace);return true};var parseReference=function(s,refmap){this.subject=s;this.pos=0;var rawlabel;var dest;var title;var matchChars;var startpos=this.pos;matchChars=this.parseLinkLabel();if(matchChars===0){return 0}else{rawlabel=this.subject.substr(0,matchChars)}if(this.peek()===C_COLON){this.pos++}else{this.pos=startpos;return 0}this.spnl();dest=this.parseLinkDestination();if(dest===null||dest.length===0){this.pos=startpos;return 0}var beforetitle=this.pos;this.spnl();title=this.parseLinkTitle();if(title===null){title="";this.pos=beforetitle}var atLineEnd=true;if(this.match(reSpaceAtEndOfLine)===null){if(title===""){atLineEnd=false}else{title="";this.pos=beforetitle;atLineEnd=this.match(reSpaceAtEndOfLine)!==null}}if(!atLineEnd){this.pos=startpos;return 0}var normlabel=normalizeReference(rawlabel);if(normlabel===""){this.pos=startpos;return 0}if(!refmap[normlabel]){refmap[normlabel]={destination:dest,title:title}}return this.pos-startpos};var parseInline=function(block){var res=false;var c=this.peek();if(c===-1){return false}switch(c){case C_NEWLINE:res=this.parseNewline(block);break;case C_BACKSLASH:res=this.parseBackslash(block);break;case C_BACKTICK:res=this.parseBackticks(block);break;case C_ASTERISK:case C_UNDERSCORE:res=this.handleDelim(c,block);break;case C_SINGLEQUOTE:case C_DOUBLEQUOTE:res=this.options.smart&&this.handleDelim(c,block);break;case C_OPEN_BRACKET:res=this.parseOpenBracket(block);break;case C_BANG:res=this.parseBang(block);break;case C_CLOSE_BRACKET:res=this.parseCloseBracket(block);break;case C_LESSTHAN:res=this.parseAutolink(block)||this.parseHtmlTag(block);break;case C_AMPERSAND:res=this.parseEntity(block);break;default:res=this.parseString(block);break}if(!res){this.pos+=1;block.appendChild(text(fromCodePoint(c)))}return true};var parseInlines=function(block){this.subject=block._string_content.trim();this.pos=0;this.delimiters=null;while(this.parseInline(block)){}block._string_content=null;this.processEmphasis(null)};function InlineParser(options){return{subject:"",delimiters:null,pos:0,refmap:{},match:match,peek:peek,spnl:spnl,parseBackticks:parseBackticks,parseBackslash:parseBackslash,parseAutolink:parseAutolink,parseHtmlTag:parseHtmlTag,scanDelims:scanDelims,handleDelim:handleDelim,parseLinkTitle:parseLinkTitle,parseLinkDestination:parseLinkDestination,parseLinkLabel:parseLinkLabel,parseOpenBracket:parseOpenBracket,parseCloseBracket:parseCloseBracket,parseBang:parseBang,parseEntity:parseEntity,parseString:parseString,parseNewline:parseNewline,parseReference:parseReference,parseInline:parseInline,processEmphasis:processEmphasis,removeDelimiter:removeDelimiter,options:options||{},parse:parseInlines}}module.exports=InlineParser},function(module,exports,__webpack_require__){"use strict";var regex=/[ \t\r\n]+|[A-Z\xB5\xC0-\xD6\xD8-\xDF\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u0149\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178\u0179\u017B\u017D\u017F\u0181\u0182\u0184\u0186\u0187\u0189-\u018B\u018E-\u0191\u0193\u0194\u0196-\u0198\u019C\u019D\u019F\u01A0\u01A2\u01A4\u01A6\u01A7\u01A9\u01AC\u01AE\u01AF\u01B1-\u01B3\u01B5\u01B7\u01B8\u01BC\u01C4\u01C5\u01C7\u01C8\u01CA\u01CB\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F0-\u01F2\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A\u023B\u023D\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0345\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03AB\u03B0\u03C2\u03CF-\u03D1\u03D5\u03D6\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F0\u03F1\u03F4\u03F5\u03F7\u03F9\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u0587\u10A0-\u10C5\u10C7\u10CD\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E96-\u1E9B\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F50\u1F52\u1F54\u1F56\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1F80-\u1FAF\u1FB2-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD2\u1FD3\u1FD6-\u1FDB\u1FE2-\u1FE4\u1FE6-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2126\u212A\u212B\u2132\u2160-\u216F\u2183\u24B6-\u24CF\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AD\uA7B0\uA7B1\uFB00-\uFB06\uFB13-\uFB17\uFF21-\uFF3A]|\uD801[\uDC00-\uDC27]|\uD806[\uDCA0-\uDCBF]/g;var map={A:"a",B:"b",C:"c",D:"d",E:"e",F:"f",G:"g",H:"h",I:"i",J:"j",K:"k",L:"l",M:"m",N:"n",O:"o",P:"p",Q:"q",R:"r",S:"s",T:"t",U:"u",V:"v",W:"w",X:"x",Y:"y",Z:"z","µ":"μ","À":"à","Á":"á","Â":"â","Ã":"ã","Ä":"ä","Å":"å","Æ":"æ","Ç":"ç","È":"è","É":"é","Ê":"ê","Ë":"ë","Ì":"ì","Í":"í","Î":"î","Ï":"ï","Ð":"ð","Ñ":"ñ","Ò":"ò","Ó":"ó","Ô":"ô","Õ":"õ","Ö":"ö","Ø":"ø","Ù":"ù","Ú":"ú","Û":"û","Ü":"ü","Ý":"ý","Þ":"þ","Ā":"ā","Ă":"ă","Ą":"ą","Ć":"ć","Ĉ":"ĉ","Ċ":"ċ","Č":"č","Ď":"ď","Đ":"đ","Ē":"ē","Ĕ":"ĕ","Ė":"ė","Ę":"ę","Ě":"ě","Ĝ":"ĝ","Ğ":"ğ","Ġ":"ġ","Ģ":"ģ","Ĥ":"ĥ","Ħ":"ħ","Ĩ":"ĩ","Ī":"ī","Ĭ":"ĭ","Į":"į","Ĳ":"ĳ","Ĵ":"ĵ","Ķ":"ķ","Ĺ":"ĺ","Ļ":"ļ","Ľ":"ľ","Ŀ":"ŀ","Ł":"ł","Ń":"ń","Ņ":"ņ","Ň":"ň","Ŋ":"ŋ","Ō":"ō","Ŏ":"ŏ","Ő":"ő","Œ":"œ","Ŕ":"ŕ","Ŗ":"ŗ","Ř":"ř","Ś":"ś","Ŝ":"ŝ","Ş":"ş","Š":"š","Ţ":"ţ","Ť":"ť","Ŧ":"ŧ","Ũ":"ũ","Ū":"ū","Ŭ":"ŭ","Ů":"ů","Ű":"ű","Ų":"ų","Ŵ":"ŵ","Ŷ":"ŷ","Ÿ":"ÿ","Ź":"ź","Ż":"ż","Ž":"ž","ſ":"s","Ɓ":"ɓ","Ƃ":"ƃ","Ƅ":"ƅ","Ɔ":"ɔ","Ƈ":"ƈ","Ɖ":"ɖ","Ɗ":"ɗ","Ƌ":"ƌ","Ǝ":"ǝ","Ə":"ə","Ɛ":"ɛ","Ƒ":"ƒ","Ɠ":"ɠ","Ɣ":"ɣ","Ɩ":"ɩ","Ɨ":"ɨ","Ƙ":"ƙ","Ɯ":"ɯ","Ɲ":"ɲ","Ɵ":"ɵ","Ơ":"ơ","Ƣ":"ƣ","Ƥ":"ƥ","Ʀ":"ʀ","Ƨ":"ƨ","Ʃ":"ʃ","Ƭ":"ƭ","Ʈ":"ʈ","Ư":"ư","Ʊ":"ʊ","Ʋ":"ʋ","Ƴ":"ƴ","Ƶ":"ƶ","Ʒ":"ʒ","Ƹ":"ƹ","Ƽ":"ƽ","Ǆ":"ǆ","ǅ":"ǆ","Ǉ":"ǉ","ǈ":"ǉ","Ǌ":"ǌ","ǋ":"ǌ","Ǎ":"ǎ","Ǐ":"ǐ","Ǒ":"ǒ","Ǔ":"ǔ","Ǖ":"ǖ","Ǘ":"ǘ","Ǚ":"ǚ","Ǜ":"ǜ","Ǟ":"ǟ","Ǡ":"ǡ","Ǣ":"ǣ","Ǥ":"ǥ","Ǧ":"ǧ","Ǩ":"ǩ","Ǫ":"ǫ","Ǭ":"ǭ","Ǯ":"ǯ","Ǳ":"ǳ","ǲ":"ǳ","Ǵ":"ǵ","Ƕ":"ƕ","Ƿ":"ƿ","Ǹ":"ǹ","Ǻ":"ǻ","Ǽ":"ǽ","Ǿ":"ǿ","Ȁ":"ȁ","Ȃ":"ȃ","Ȅ":"ȅ","Ȇ":"ȇ","Ȉ":"ȉ","Ȋ":"ȋ","Ȍ":"ȍ","Ȏ":"ȏ","Ȑ":"ȑ","Ȓ":"ȓ","Ȕ":"ȕ","Ȗ":"ȗ","Ș":"ș","Ț":"ț","Ȝ":"ȝ","Ȟ":"ȟ","Ƞ":"ƞ","Ȣ":"ȣ","Ȥ":"ȥ","Ȧ":"ȧ","Ȩ":"ȩ","Ȫ":"ȫ","Ȭ":"ȭ","Ȯ":"ȯ","Ȱ":"ȱ","Ȳ":"ȳ","Ⱥ":"ⱥ","Ȼ":"ȼ","Ƚ":"ƚ","Ⱦ":"ⱦ","Ɂ":"ɂ","Ƀ":"ƀ","Ʉ":"ʉ","Ʌ":"ʌ","Ɇ":"ɇ","Ɉ":"ɉ","Ɋ":"ɋ","Ɍ":"ɍ","Ɏ":"ɏ","ͅ":"ι","Ͱ":"ͱ","Ͳ":"ͳ","Ͷ":"ͷ","Ϳ":"ϳ","Ά":"ά","Έ":"έ","Ή":"ή","Ί":"ί","Ό":"ό","Ύ":"ύ","Ώ":"ώ","Α":"α","Β":"β","Γ":"γ","Δ":"δ","Ε":"ε","Ζ":"ζ","Η":"η","Θ":"θ","Ι":"ι","Κ":"κ","Λ":"λ","Μ":"μ","Ν":"ν","Ξ":"ξ","Ο":"ο","Π":"π","Ρ":"ρ","Σ":"σ","Τ":"τ","Υ":"υ","Φ":"φ","Χ":"χ","Ψ":"ψ","Ω":"ω","Ϊ":"ϊ","Ϋ":"ϋ","ς":"σ","Ϗ":"ϗ","ϐ":"β","ϑ":"θ","ϕ":"φ","ϖ":"π","Ϙ":"ϙ","Ϛ":"ϛ","Ϝ":"ϝ","Ϟ":"ϟ","Ϡ":"ϡ","Ϣ":"ϣ","Ϥ":"ϥ","Ϧ":"ϧ","Ϩ":"ϩ","Ϫ":"ϫ","Ϭ":"ϭ","Ϯ":"ϯ","ϰ":"κ","ϱ":"ρ","ϴ":"θ","ϵ":"ε","Ϸ":"ϸ","Ϲ":"ϲ","Ϻ":"ϻ","Ͻ":"ͻ","Ͼ":"ͼ","Ͽ":"ͽ","Ѐ":"ѐ","Ё":"ё","Ђ":"ђ","Ѓ":"ѓ","Є":"є","Ѕ":"ѕ","І":"і","Ї":"ї","Ј":"ј","Љ":"љ","Њ":"њ","Ћ":"ћ","Ќ":"ќ","Ѝ":"ѝ","Ў":"ў","Џ":"џ","А":"а","Б":"б","В":"в","Г":"г","Д":"д","Е":"е","Ж":"ж","З":"з","И":"и","Й":"й","К":"к","Л":"л","М":"м","Н":"н","О":"о","П":"п","Р":"р","С":"с","Т":"т","У":"у","Ф":"ф","Х":"х","Ц":"ц","Ч":"ч","Ш":"ш","Щ":"щ","Ъ":"ъ","Ы":"ы","Ь":"ь","Э":"э","Ю":"ю","Я":"я","Ѡ":"ѡ","Ѣ":"ѣ","Ѥ":"ѥ","Ѧ":"ѧ","Ѩ":"ѩ","Ѫ":"ѫ","Ѭ":"ѭ","Ѯ":"ѯ","Ѱ":"ѱ","Ѳ":"ѳ","Ѵ":"ѵ","Ѷ":"ѷ","Ѹ":"ѹ","Ѻ":"ѻ","Ѽ":"ѽ","Ѿ":"ѿ","Ҁ":"ҁ","Ҋ":"ҋ","Ҍ":"ҍ","Ҏ":"ҏ","Ґ":"ґ","Ғ":"ғ","Ҕ":"ҕ","Җ":"җ","Ҙ":"ҙ","Қ":"қ","Ҝ":"ҝ","Ҟ":"ҟ","Ҡ":"ҡ","Ң":"ң","Ҥ":"ҥ","Ҧ":"ҧ","Ҩ":"ҩ","Ҫ":"ҫ","Ҭ":"ҭ","Ү":"ү","Ұ":"ұ","Ҳ":"ҳ","Ҵ":"ҵ","Ҷ":"ҷ","Ҹ":"ҹ","Һ":"һ","Ҽ":"ҽ","Ҿ":"ҿ","Ӏ":"ӏ","Ӂ":"ӂ","Ӄ":"ӄ","Ӆ":"ӆ","Ӈ":"ӈ","Ӊ":"ӊ","Ӌ":"ӌ","Ӎ":"ӎ","Ӑ":"ӑ","Ӓ":"ӓ","Ӕ":"ӕ","Ӗ":"ӗ","Ә":"ә","Ӛ":"ӛ","Ӝ":"ӝ","Ӟ":"ӟ","Ӡ":"ӡ","Ӣ":"ӣ","Ӥ":"ӥ","Ӧ":"ӧ","Ө":"ө","Ӫ":"ӫ","Ӭ":"ӭ","Ӯ":"ӯ","Ӱ":"ӱ","Ӳ":"ӳ","Ӵ":"ӵ","Ӷ":"ӷ","Ӹ":"ӹ","Ӻ":"ӻ","Ӽ":"ӽ","Ӿ":"ӿ","Ԁ":"ԁ","Ԃ":"ԃ","Ԅ":"ԅ","Ԇ":"ԇ","Ԉ":"ԉ","Ԋ":"ԋ","Ԍ":"ԍ","Ԏ":"ԏ","Ԑ":"ԑ","Ԓ":"ԓ","Ԕ":"ԕ","Ԗ":"ԗ","Ԙ":"ԙ","Ԛ":"ԛ","Ԝ":"ԝ","Ԟ":"ԟ","Ԡ":"ԡ","Ԣ":"ԣ","Ԥ":"ԥ","Ԧ":"ԧ","Ԩ":"ԩ","Ԫ":"ԫ","Ԭ":"ԭ","Ԯ":"ԯ","Ա":"ա","Բ":"բ","Գ":"գ","Դ":"դ","Ե":"ե","Զ":"զ","Է":"է","Ը":"ը","Թ":"թ","Ժ":"ժ","Ի":"ի","Լ":"լ","Խ":"խ","Ծ":"ծ","Կ":"կ","Հ":"հ","Ձ":"ձ","Ղ":"ղ","Ճ":"ճ","Մ":"մ","Յ":"յ","Ն":"ն","Շ":"շ","Ո":"ո","Չ":"չ","Պ":"պ","Ջ":"ջ","Ռ":"ռ","Ս":"ս","Վ":"վ","Տ":"տ","Ր":"ր","Ց":"ց","Ւ":"ւ","Փ":"փ","Ք":"ք","Օ":"օ","Ֆ":"ֆ","Ⴀ":"ⴀ","Ⴁ":"ⴁ","Ⴂ":"ⴂ","Ⴃ":"ⴃ","Ⴄ":"ⴄ","Ⴅ":"ⴅ","Ⴆ":"ⴆ","Ⴇ":"ⴇ","Ⴈ":"ⴈ","Ⴉ":"ⴉ","Ⴊ":"ⴊ","Ⴋ":"ⴋ","Ⴌ":"ⴌ","Ⴍ":"ⴍ","Ⴎ":"ⴎ","Ⴏ":"ⴏ","Ⴐ":"ⴐ","Ⴑ":"ⴑ","Ⴒ":"ⴒ","Ⴓ":"ⴓ","Ⴔ":"ⴔ","Ⴕ":"ⴕ","Ⴖ":"ⴖ","Ⴗ":"ⴗ","Ⴘ":"ⴘ","Ⴙ":"ⴙ","Ⴚ":"ⴚ","Ⴛ":"ⴛ","Ⴜ":"ⴜ","Ⴝ":"ⴝ","Ⴞ":"ⴞ","Ⴟ":"ⴟ","Ⴠ":"ⴠ","Ⴡ":"ⴡ","Ⴢ":"ⴢ","Ⴣ":"ⴣ","Ⴤ":"ⴤ","Ⴥ":"ⴥ","Ⴧ":"ⴧ","Ⴭ":"ⴭ","Ḁ":"ḁ","Ḃ":"ḃ","Ḅ":"ḅ","Ḇ":"ḇ","Ḉ":"ḉ","Ḋ":"ḋ","Ḍ":"ḍ","Ḏ":"ḏ","Ḑ":"ḑ","Ḓ":"ḓ","Ḕ":"ḕ","Ḗ":"ḗ","Ḙ":"ḙ","Ḛ":"ḛ","Ḝ":"ḝ","Ḟ":"ḟ","Ḡ":"ḡ","Ḣ":"ḣ","Ḥ":"ḥ","Ḧ":"ḧ","Ḩ":"ḩ","Ḫ":"ḫ","Ḭ":"ḭ","Ḯ":"ḯ","Ḱ":"ḱ","Ḳ":"ḳ","Ḵ":"ḵ","Ḷ":"ḷ","Ḹ":"ḹ","Ḻ":"ḻ","Ḽ":"ḽ","Ḿ":"ḿ","Ṁ":"ṁ","Ṃ":"ṃ","Ṅ":"ṅ","Ṇ":"ṇ","Ṉ":"ṉ","Ṋ":"ṋ","Ṍ":"ṍ","Ṏ":"ṏ","Ṑ":"ṑ","Ṓ":"ṓ","Ṕ":"ṕ","Ṗ":"ṗ","Ṙ":"ṙ","Ṛ":"ṛ","Ṝ":"ṝ","Ṟ":"ṟ","Ṡ":"ṡ","Ṣ":"ṣ","Ṥ":"ṥ","Ṧ":"ṧ","Ṩ":"ṩ","Ṫ":"ṫ","Ṭ":"ṭ","Ṯ":"ṯ","Ṱ":"ṱ","Ṳ":"ṳ","Ṵ":"ṵ","Ṷ":"ṷ","Ṹ":"ṹ","Ṻ":"ṻ","Ṽ":"ṽ","Ṿ":"ṿ","Ẁ":"ẁ","Ẃ":"ẃ","Ẅ":"ẅ","Ẇ":"ẇ","Ẉ":"ẉ","Ẋ":"ẋ","Ẍ":"ẍ","Ẏ":"ẏ","Ẑ":"ẑ","Ẓ":"ẓ","Ẕ":"ẕ","ẛ":"ṡ","Ạ":"ạ","Ả":"ả","Ấ":"ấ","Ầ":"ầ","Ẩ":"ẩ","Ẫ":"ẫ","Ậ":"ậ","Ắ":"ắ","Ằ":"ằ","Ẳ":"ẳ","Ẵ":"ẵ","Ặ":"ặ","Ẹ":"ẹ","Ẻ":"ẻ","Ẽ":"ẽ","Ế":"ế","Ề":"ề","Ể":"ể","Ễ":"ễ","Ệ":"ệ","Ỉ":"ỉ","Ị":"ị","Ọ":"ọ","Ỏ":"ỏ","Ố":"ố","Ồ":"ồ","Ổ":"ổ","Ỗ":"ỗ","Ộ":"ộ","Ớ":"ớ","Ờ":"ờ","Ở":"ở","Ỡ":"ỡ","Ợ":"ợ","Ụ":"ụ","Ủ":"ủ","Ứ":"ứ","Ừ":"ừ","Ử":"ử","Ữ":"ữ","Ự":"ự","Ỳ":"ỳ","Ỵ":"ỵ","Ỷ":"ỷ","Ỹ":"ỹ","Ỻ":"ỻ","Ỽ":"ỽ","Ỿ":"ỿ","Ἀ":"ἀ","Ἁ":"ἁ","Ἂ":"ἂ","Ἃ":"ἃ","Ἄ":"ἄ","Ἅ":"ἅ","Ἆ":"ἆ","Ἇ":"ἇ","Ἐ":"ἐ","Ἑ":"ἑ","Ἒ":"ἒ","Ἓ":"ἓ","Ἔ":"ἔ","Ἕ":"ἕ","Ἠ":"ἠ","Ἡ":"ἡ","Ἢ":"ἢ","Ἣ":"ἣ","Ἤ":"ἤ","Ἥ":"ἥ","Ἦ":"ἦ","Ἧ":"ἧ","Ἰ":"ἰ","Ἱ":"ἱ","Ἲ":"ἲ","Ἳ":"ἳ","Ἴ":"ἴ","Ἵ":"ἵ","Ἶ":"ἶ","Ἷ":"ἷ","Ὀ":"ὀ","Ὁ":"ὁ","Ὂ":"ὂ","Ὃ":"ὃ","Ὄ":"ὄ","Ὅ":"ὅ","Ὑ":"ὑ","Ὓ":"ὓ","Ὕ":"ὕ","Ὗ":"ὗ","Ὠ":"ὠ","Ὡ":"ὡ","Ὢ":"ὢ","Ὣ":"ὣ","Ὤ":"ὤ","Ὥ":"ὥ","Ὦ":"ὦ","Ὧ":"ὧ","Ᾰ":"ᾰ","Ᾱ":"ᾱ","Ὰ":"ὰ","Ά":"ά","ι":"ι","Ὲ":"ὲ","Έ":"έ","Ὴ":"ὴ","Ή":"ή","Ῐ":"ῐ","Ῑ":"ῑ","Ὶ":"ὶ","Ί":"ί","Ῠ":"ῠ","Ῡ":"ῡ","Ὺ":"ὺ","Ύ":"ύ","Ῥ":"ῥ","Ὸ":"ὸ","Ό":"ό","Ὼ":"ὼ","Ώ":"ώ","Ω":"ω","K":"k","Å":"å","Ⅎ":"ⅎ","Ⅰ":"ⅰ","Ⅱ":"ⅱ","Ⅲ":"ⅲ","Ⅳ":"ⅳ","Ⅴ":"ⅴ","Ⅵ":"ⅵ","Ⅶ":"ⅶ","Ⅷ":"ⅷ","Ⅸ":"ⅸ","Ⅹ":"ⅹ","Ⅺ":"ⅺ","Ⅻ":"ⅻ","Ⅼ":"ⅼ","Ⅽ":"ⅽ","Ⅾ":"ⅾ","Ⅿ":"ⅿ","Ↄ":"ↄ","Ⓐ":"ⓐ","Ⓑ":"ⓑ","Ⓒ":"ⓒ","Ⓓ":"ⓓ","Ⓔ":"ⓔ","Ⓕ":"ⓕ","Ⓖ":"ⓖ","Ⓗ":"ⓗ","Ⓘ":"ⓘ","Ⓙ":"ⓙ","Ⓚ":"ⓚ","Ⓛ":"ⓛ","Ⓜ":"ⓜ","Ⓝ":"ⓝ","Ⓞ":"ⓞ","Ⓟ":"ⓟ","Ⓠ":"ⓠ","Ⓡ":"ⓡ","Ⓢ":"ⓢ","Ⓣ":"ⓣ","Ⓤ":"ⓤ","Ⓥ":"ⓥ","Ⓦ":"ⓦ","Ⓧ":"ⓧ","Ⓨ":"ⓨ","Ⓩ":"ⓩ","Ⰰ":"ⰰ","Ⰱ":"ⰱ","Ⰲ":"ⰲ","Ⰳ":"ⰳ","Ⰴ":"ⰴ","Ⰵ":"ⰵ","Ⰶ":"ⰶ","Ⰷ":"ⰷ","Ⰸ":"ⰸ","Ⰹ":"ⰹ","Ⰺ":"ⰺ","Ⰻ":"ⰻ","Ⰼ":"ⰼ","Ⰽ":"ⰽ","Ⰾ":"ⰾ","Ⰿ":"ⰿ","Ⱀ":"ⱀ","Ⱁ":"ⱁ","Ⱂ":"ⱂ","Ⱃ":"ⱃ","Ⱄ":"ⱄ","Ⱅ":"ⱅ","Ⱆ":"ⱆ","Ⱇ":"ⱇ","Ⱈ":"ⱈ","Ⱉ":"ⱉ","Ⱊ":"ⱊ","Ⱋ":"ⱋ","Ⱌ":"ⱌ","Ⱍ":"ⱍ","Ⱎ":"ⱎ","Ⱏ":"ⱏ","Ⱐ":"ⱐ","Ⱑ":"ⱑ","Ⱒ":"ⱒ","Ⱓ":"ⱓ","Ⱔ":"ⱔ","Ⱕ":"ⱕ","Ⱖ":"ⱖ","Ⱗ":"ⱗ","Ⱘ":"ⱘ","Ⱙ":"ⱙ","Ⱚ":"ⱚ","Ⱛ":"ⱛ","Ⱜ":"ⱜ","Ⱝ":"ⱝ","Ⱞ":"ⱞ","Ⱡ":"ⱡ","Ɫ":"ɫ","Ᵽ":"ᵽ","Ɽ":"ɽ","Ⱨ":"ⱨ","Ⱪ":"ⱪ","Ⱬ":"ⱬ","Ɑ":"ɑ","Ɱ":"ɱ","Ɐ":"ɐ","Ɒ":"ɒ","Ⱳ":"ⱳ","Ⱶ":"ⱶ","Ȿ":"ȿ","Ɀ":"ɀ","Ⲁ":"ⲁ","Ⲃ":"ⲃ","Ⲅ":"ⲅ","Ⲇ":"ⲇ","Ⲉ":"ⲉ","Ⲋ":"ⲋ","Ⲍ":"ⲍ","Ⲏ":"ⲏ","Ⲑ":"ⲑ","Ⲓ":"ⲓ","Ⲕ":"ⲕ","Ⲗ":"ⲗ","Ⲙ":"ⲙ","Ⲛ":"ⲛ","Ⲝ":"ⲝ","Ⲟ":"ⲟ","Ⲡ":"ⲡ","Ⲣ":"ⲣ","Ⲥ":"ⲥ","Ⲧ":"ⲧ","Ⲩ":"ⲩ","Ⲫ":"ⲫ","Ⲭ":"ⲭ","Ⲯ":"ⲯ","Ⲱ":"ⲱ","Ⲳ":"ⲳ","Ⲵ":"ⲵ","Ⲷ":"ⲷ","Ⲹ":"ⲹ","Ⲻ":"ⲻ","Ⲽ":"ⲽ","Ⲿ":"ⲿ","Ⳁ":"ⳁ","Ⳃ":"ⳃ","Ⳅ":"ⳅ","Ⳇ":"ⳇ","Ⳉ":"ⳉ","Ⳋ":"ⳋ","Ⳍ":"ⳍ","Ⳏ":"ⳏ","Ⳑ":"ⳑ","Ⳓ":"ⳓ","Ⳕ":"ⳕ","Ⳗ":"ⳗ","Ⳙ":"ⳙ","Ⳛ":"ⳛ","Ⳝ":"ⳝ","Ⳟ":"ⳟ","Ⳡ":"ⳡ","Ⳣ":"ⳣ","Ⳬ":"ⳬ","Ⳮ":"ⳮ","Ⳳ":"ⳳ","Ꙁ":"ꙁ","Ꙃ":"ꙃ","Ꙅ":"ꙅ","Ꙇ":"ꙇ","Ꙉ":"ꙉ","Ꙋ":"ꙋ","Ꙍ":"ꙍ","Ꙏ":"ꙏ","Ꙑ":"ꙑ","Ꙓ":"ꙓ","Ꙕ":"ꙕ","Ꙗ":"ꙗ","Ꙙ":"ꙙ","Ꙛ":"ꙛ","Ꙝ":"ꙝ","Ꙟ":"ꙟ","Ꙡ":"ꙡ","Ꙣ":"ꙣ","Ꙥ":"ꙥ","Ꙧ":"ꙧ","Ꙩ":"ꙩ","Ꙫ":"ꙫ","Ꙭ":"ꙭ","Ꚁ":"ꚁ","Ꚃ":"ꚃ","Ꚅ":"ꚅ","Ꚇ":"ꚇ","Ꚉ":"ꚉ","Ꚋ":"ꚋ","Ꚍ":"ꚍ","Ꚏ":"ꚏ","Ꚑ":"ꚑ","Ꚓ":"ꚓ","Ꚕ":"ꚕ","Ꚗ":"ꚗ","Ꚙ":"ꚙ","Ꚛ":"ꚛ","Ꜣ":"ꜣ","Ꜥ":"ꜥ","Ꜧ":"ꜧ","Ꜩ":"ꜩ","Ꜫ":"ꜫ","Ꜭ":"ꜭ","Ꜯ":"ꜯ","Ꜳ":"ꜳ","Ꜵ":"ꜵ","Ꜷ":"ꜷ","Ꜹ":"ꜹ","Ꜻ":"ꜻ","Ꜽ":"ꜽ","Ꜿ":"ꜿ","Ꝁ":"ꝁ","Ꝃ":"ꝃ","Ꝅ":"ꝅ","Ꝇ":"ꝇ","Ꝉ":"ꝉ","Ꝋ":"ꝋ","Ꝍ":"ꝍ","Ꝏ":"ꝏ","Ꝑ":"ꝑ","Ꝓ":"ꝓ","Ꝕ":"ꝕ","Ꝗ":"ꝗ","Ꝙ":"ꝙ","Ꝛ":"ꝛ","Ꝝ":"ꝝ","Ꝟ":"ꝟ","Ꝡ":"ꝡ","Ꝣ":"ꝣ","Ꝥ":"ꝥ","Ꝧ":"ꝧ","Ꝩ":"ꝩ","Ꝫ":"ꝫ","Ꝭ":"ꝭ","Ꝯ":"ꝯ","Ꝺ":"ꝺ","Ꝼ":"ꝼ","Ᵹ":"ᵹ","Ꝿ":"ꝿ","Ꞁ":"ꞁ","Ꞃ":"ꞃ","Ꞅ":"ꞅ","Ꞇ":"ꞇ","Ꞌ":"ꞌ","Ɥ":"ɥ","Ꞑ":"ꞑ","Ꞓ":"ꞓ","Ꞗ":"ꞗ","Ꞙ":"ꞙ","Ꞛ":"ꞛ","Ꞝ":"ꞝ","Ꞟ":"ꞟ","Ꞡ":"ꞡ","Ꞣ":"ꞣ","Ꞥ":"ꞥ","Ꞧ":"ꞧ","Ꞩ":"ꞩ","Ɦ":"ɦ","Ɜ":"ɜ","Ɡ":"ɡ","Ɬ":"ɬ","Ʞ":"ʞ","Ʇ":"ʇ","Ａ":"ａ","Ｂ":"ｂ","Ｃ":"ｃ","Ｄ":"ｄ","Ｅ":"ｅ","Ｆ":"ｆ","Ｇ":"ｇ","Ｈ":"ｈ","Ｉ":"ｉ","Ｊ":"ｊ","Ｋ":"ｋ","Ｌ":"ｌ","Ｍ":"ｍ","Ｎ":"ｎ","Ｏ":"ｏ","Ｐ":"ｐ","Ｑ":"ｑ","Ｒ":"ｒ","Ｓ":"ｓ","Ｔ":"ｔ","Ｕ":"ｕ","Ｖ":"ｖ","Ｗ":"ｗ","Ｘ":"ｘ","Ｙ":"ｙ","Ｚ":"ｚ","𐐀":"𐐨","𐐁":"𐐩","𐐂":"𐐪","𐐃":"𐐫","𐐄":"𐐬","𐐅":"𐐭","𐐆":"𐐮","𐐇":"𐐯","𐐈":"𐐰","𐐉":"𐐱","𐐊":"𐐲","𐐋":"𐐳","𐐌":"𐐴","𐐍":"𐐵","𐐎":"𐐶","𐐏":"𐐷","𐐐":"𐐸","𐐑":"𐐹","𐐒":"𐐺","𐐓":"𐐻","𐐔":"𐐼","𐐕":"𐐽","𐐖":"𐐾","𐐗":"𐐿","𐐘":"𐑀","𐐙":"𐑁","𐐚":"𐑂","𐐛":"𐑃","𐐜":"𐑄","𐐝":"𐑅","𐐞":"𐑆","𐐟":"𐑇","𐐠":"𐑈","𐐡":"𐑉","𐐢":"𐑊","𐐣":"𐑋","𐐤":"𐑌","𐐥":"𐑍","𐐦":"𐑎","𐐧":"𐑏","𑢠":"𑣀","𑢡":"𑣁","𑢢":"𑣂","𑢣":"𑣃","𑢤":"𑣄","𑢥":"𑣅","𑢦":"𑣆","𑢧":"𑣇","𑢨":"𑣈","𑢩":"𑣉","𑢪":"𑣊","𑢫":"𑣋","𑢬":"𑣌","𑢭":"𑣍","𑢮":"𑣎","𑢯":"𑣏","𑢰":"𑣐","𑢱":"𑣑","𑢲":"𑣒","𑢳":"𑣓","𑢴":"𑣔","𑢵":"𑣕","𑢶":"𑣖","𑢷":"𑣗","𑢸":"𑣘","𑢹":"𑣙","𑢺":"𑣚","𑢻":"𑣛","𑢼":"𑣜","𑢽":"𑣝","𑢾":"𑣞","𑢿":"𑣟","ß":"ss","İ":"i̇","ŉ":"ʼn","ǰ":"ǰ","ΐ":"ΐ","ΰ":"ΰ","և":"եւ","ẖ":"ẖ","ẗ":"ẗ","ẘ":"ẘ","ẙ":"ẙ","ẚ":"aʾ","ẞ":"ss","ὐ":"ὐ","ὒ":"ὒ","ὔ":"ὔ","ὖ":"ὖ","ᾀ":"ἀι","ᾁ":"ἁι","ᾂ":"ἂι","ᾃ":"ἃι","ᾄ":"ἄι","ᾅ":"ἅι","ᾆ":"ἆι","ᾇ":"ἇι","ᾈ":"ἀι","ᾉ":"ἁι","ᾊ":"ἂι","ᾋ":"ἃι","ᾌ":"ἄι","ᾍ":"ἅι","ᾎ":"ἆι","ᾏ":"ἇι","ᾐ":"ἠι","ᾑ":"ἡι","ᾒ":"ἢι","ᾓ":"ἣι","ᾔ":"ἤι","ᾕ":"ἥι","ᾖ":"ἦι","ᾗ":"ἧι","ᾘ":"ἠι","ᾙ":"ἡι","ᾚ":"ἢι","ᾛ":"ἣι","ᾜ":"ἤι","ᾝ":"ἥι","ᾞ":"ἦι","ᾟ":"ἧι","ᾠ":"ὠι","ᾡ":"ὡι","ᾢ":"ὢι","ᾣ":"ὣι","ᾤ":"ὤι","ᾥ":"ὥι","ᾦ":"ὦι","ᾧ":"ὧι","ᾨ":"ὠι","ᾩ":"ὡι","ᾪ":"ὢι","ᾫ":"ὣι","ᾬ":"ὤι","ᾭ":"ὥι","ᾮ":"ὦι","ᾯ":"ὧι","ᾲ":"ὰι","ᾳ":"αι","ᾴ":"άι","ᾶ":"ᾶ","ᾷ":"ᾶι","ᾼ":"αι","ῂ":"ὴι","ῃ":"ηι","ῄ":"ήι","ῆ":"ῆ","ῇ":"ῆι","ῌ":"ηι","ῒ":"ῒ","ΐ":"ΐ","ῖ":"ῖ","ῗ":"ῗ","ῢ":"ῢ","ΰ":"ΰ","ῤ":"ῤ","ῦ":"ῦ","ῧ":"ῧ","ῲ":"ὼι","ῳ":"ωι","ῴ":"ώι","ῶ":"ῶ","ῷ":"ῶι","ῼ":"ωι","ﬀ":"ff","ﬁ":"fi","ﬂ":"fl","ﬃ":"ffi","ﬄ":"ffl","ﬅ":"st","ﬆ":"st","ﬓ":"մն","ﬔ":"մե","ﬕ":"մի","ﬖ":"վն","ﬗ":"մխ"};module.exports=function(string){return string.slice(1,string.length-1).trim().replace(regex,function($0){return map[$0]||" "})}},function(module,exports,__webpack_require__){"use strict";if(String.fromCodePoint){module.exports=function(_){try{return String.fromCodePoint(_)}catch(e){if(e instanceof RangeError){return String.fromCharCode(65533)}throw e}}}else{var stringFromCharCode=String.fromCharCode;var floor=Math.floor;var fromCodePoint=function(){var MAX_SIZE=16384;var codeUnits=[];var highSurrogate;var lowSurrogate;var index=-1;var length=arguments.length;if(!length){return""}var result="";while(++index<length){var codePoint=Number(arguments[index]);if(!isFinite(codePoint)||codePoint<0||codePoint>1114111||floor(codePoint)!==codePoint){return String.fromCharCode(65533)}if(codePoint<=65535){codeUnits.push(codePoint)}else{codePoint-=65536;highSurrogate=(codePoint>>10)+55296;lowSurrogate=codePoint%1024+56320;codeUnits.push(highSurrogate,lowSurrogate)}if(index+1===length||codeUnits.length>MAX_SIZE){result+=stringFromCharCode.apply(null,codeUnits);codeUnits.length=0}}return result};module.exports=fromCodePoint}},function(module,exports){if(!String.prototype.repeat){(function(){"use strict";var defineProperty=function(){try{var object={};var $defineProperty=Object.defineProperty;var result=$defineProperty(object,object,object)&&$defineProperty}catch(error){}return result}();var repeat=function(count){if(this==null){throw TypeError()}var string=String(this);var n=count?Number(count):0;if(n!=n){n=0}if(n<0||n==Infinity){throw RangeError()}var result="";while(n){if(n%2==1){result+=string}if(n>1){string+=string}n>>=1}return result};if(defineProperty){defineProperty(String.prototype,"repeat",{value:repeat,configurable:true,writable:true})}else{String.prototype.repeat=repeat}})()}},function(module,exports,__webpack_require__){"use strict";var escapeXml=__webpack_require__(30).escapeXml;var tag=function(name,attrs,selfclosing){var result="<"+name;if(attrs&&attrs.length>0){var i=0;var attrib;while((attrib=attrs[i])!==undefined){result+=" "+attrib[0]+'="'+attrib[1]+'"';i++}}if(selfclosing){result+=" /"}result+=">";return result};var reHtmlTag=/\<[^>]*\>/;var reUnsafeProtocol=/^javascript:|vbscript:|file:|data:/i;var reSafeDataProtocol=/^data:image\/(?:png|gif|jpeg|webp)/i;var potentiallyUnsafe=function(url){return reUnsafeProtocol.test(url)&&!reSafeDataProtocol.test(url)};var renderNodes=function(block){var attrs;var info_words;var tagname;var walker=block.walker();var event,node,entering;var buffer="";var lastOut="\n";var disableTags=0;var grandparent;var out=function(s){if(disableTags>0){buffer+=s.replace(reHtmlTag,"")}else{buffer+=s}lastOut=s};var esc=this.escape;var cr=function(){if(lastOut!=="\n"){buffer+="\n";lastOut="\n"}};var options=this.options;if(options.time){console.time("rendering")}while(event=walker.next()){entering=event.entering;node=event.node;attrs=[];if(options.sourcepos){var pos=node.sourcepos;if(pos){attrs.push(["data-sourcepos",String(pos[0][0])+":"+String(pos[0][1])+"-"+String(pos[1][0])+":"+String(pos[1][1])])}}switch(node.type){case"Text":out(esc(node.literal,false));break;case"Softbreak":out(this.softbreak);break;case"Hardbreak":out(tag("br",[],true));cr();break;case"Emph":out(tag(entering?"em":"/em"));break;case"Strong":out(tag(entering?"strong":"/strong"));break;case"HtmlInline":if(options.safe){out("\x3c!-- raw HTML omitted --\x3e")}else{out(node.literal)}break;case"CustomInline":if(entering&&node.onEnter){out(node.onEnter)}else if(!entering&&node.onExit){out(node.onExit)}break;case"Link":if(entering){if(!(options.safe&&potentiallyUnsafe(node.destination))){attrs.push(["href",esc(node.destination,true)])}if(node.title){attrs.push(["title",esc(node.title,true)])}out(tag("a",attrs))}else{out(tag("/a"))}break;case"Image":if(entering){if(disableTags===0){if(options.safe&&potentiallyUnsafe(node.destination)){out('<img src="" alt="')}else{out('<img src="'+esc(node.destination,true)+'" alt="')}}disableTags+=1}else{disableTags-=1;if(disableTags===0){if(node.title){out('" title="'+esc(node.title,true))}out('" />')}}break;case"Code":out(tag("code")+esc(node.literal,false)+tag("/code"));break;case"Document":break;case"Paragraph":grandparent=node.parent.parent;if(grandparent!==null&&grandparent.type==="List"){if(grandparent.listTight){break}}if(entering){cr();out(tag("p",attrs))}else{out(tag("/p"));cr()}break;case"BlockQuote":if(entering){cr();out(tag("blockquote",attrs));cr()}else{cr();out(tag("/blockquote"));cr()}break;case"Item":if(entering){out(tag("li",attrs))}else{out(tag("/li"));cr()}break;case"List":tagname=node.listType==="Bullet"?"ul":"ol";if(entering){var start=node.listStart;if(start!==null&&start!==1){attrs.push(["start",start.toString()])}cr();out(tag(tagname,attrs));cr()}else{cr();out(tag("/"+tagname));cr()}break;case"Heading":tagname="h"+node.level;if(entering){cr();out(tag(tagname,attrs))}else{out(tag("/"+tagname));cr()}break;case"CodeBlock":info_words=node.info?node.info.split(/\s+/):[];if(info_words.length>0&&info_words[0].length>0){attrs.push(["class","language-"+esc(info_words[0],true)])}cr();out(tag("pre")+tag("code",attrs));out(esc(node.literal,false));out(tag("/code")+tag("/pre"));cr();break;case"HtmlBlock":cr();if(options.safe){out("\x3c!-- raw HTML omitted --\x3e")}else{out(node.literal)}cr();break;case"CustomBlock":cr();if(entering&&node.onEnter){out(node.onEnter)}else if(!entering&&node.onExit){out(node.onExit)}cr();break;case"ThematicBreak":cr();out(tag("hr",attrs,true));cr();break;default:throw"Unknown node type "+node.type}}if(options.time){console.timeEnd("rendering")}return buffer};function HtmlRenderer(options){return{softbreak:"\n",escape:escapeXml,options:options||{},render:renderNodes}}module.exports=HtmlRenderer},function(module,exports,__webpack_require__){"use strict";var escapeXml=__webpack_require__(30).escapeXml;var tag=function(name,attrs,selfclosing){var result="<"+name;if(attrs&&attrs.length>0){var i=0;var attrib;while((attrib=attrs[i])!==undefined){result+=" "+attrib[0]+'="'+attrib[1]+'"';i++}}if(selfclosing){result+=" /"}result+=">";return result};var reXMLTag=/\<[^>]*\>/;var toTagName=function(s){return s.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()};var renderNodes=function(block){var attrs;var tagname;var walker=block.walker();var event,node,entering;var buffer="";var lastOut="\n";var disableTags=0;var indentLevel=0;var indent="  ";var container;var selfClosing;var nodetype;var out=function(s){if(disableTags>0){buffer+=s.replace(reXMLTag,"")}else{buffer+=s}lastOut=s};var esc=this.escape;var cr=function(){if(lastOut!=="\n"){buffer+="\n";lastOut="\n";for(var i=indentLevel;i>0;i--){buffer+=indent}}};var options=this.options;if(options.time){console.time("rendering")}buffer+='<?xml version="1.0" encoding="UTF-8"?>\n';buffer+='<!DOCTYPE CommonMark SYSTEM "CommonMark.dtd">\n';while(event=walker.next()){entering=event.entering;node=event.node;nodetype=node.type;container=node.isContainer;selfClosing=nodetype==="ThematicBreak"||nodetype==="Hardbreak"||nodetype==="Softbreak";tagname=toTagName(nodetype);if(entering){attrs=[];switch(nodetype){case"Document":attrs.push(["xmlns","http://commonmark.org/xml/1.0"]);break;case"List":if(node.listType!==null){attrs.push(["type",node.listType.toLowerCase()])}if(node.listStart!==null){attrs.push(["start",String(node.listStart)])}if(node.listTight!==null){attrs.push(["tight",node.listTight?"true":"false"])}var delim=node.listDelimiter;if(delim!==null){var delimword="";if(delim==="."){delimword="period"}else{delimword="paren"}attrs.push(["delimiter",delimword])}break;case"CodeBlock":if(node.info){attrs.push(["info",node.info])}break;case"Heading":attrs.push(["level",String(node.level)]);break;case"Link":case"Image":attrs.push(["destination",node.destination]);attrs.push(["title",node.title]);break;case"CustomInline":case"CustomBlock":attrs.push(["on_enter",node.onEnter]);attrs.push(["on_exit",node.onExit]);break;default:break}if(options.sourcepos){var pos=node.sourcepos;if(pos){attrs.push(["sourcepos",String(pos[0][0])+":"+String(pos[0][1])+"-"+String(pos[1][0])+":"+String(pos[1][1])])}}cr();out(tag(tagname,attrs,selfClosing));if(container){indentLevel+=1}else if(!container&&!selfClosing){var lit=node.literal;if(lit){out(esc(lit))}out(tag("/"+tagname))}}else{indentLevel-=1;cr();out(tag("/"+tagname))}}if(options.time){console.timeEnd("rendering")}buffer+="\n";return buffer};function XmlRenderer(options){return{softbreak:"\n",escape:escapeXml,options:options||{},render:renderNodes}}module.exports=XmlRenderer},function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(38);var assign=__webpack_require__(220);var isPlainObject=__webpack_require__(221);var xssFilters=__webpack_require__(222);var pascalCase=__webpack_require__(223);var typeAliases={blockquote:"block_quote",thematicbreak:"thematic_break",htmlblock:"html_block",htmlinline:"html_inline",codeblock:"code_block",hardbreak:"linebreak"};var defaultRenderers={block_quote:"blockquote",emph:"em",linebreak:"br",image:"img",item:"li",link:"a",paragraph:"p",strong:"strong",thematic_break:"hr",html_block:HtmlRenderer,html_inline:HtmlRenderer,list:function List(props){var tag=props.type.toLowerCase()==="bullet"?"ul":"ol";var attrs=getCoreProps(props);if(props.start!==null&&props.start!==1){attrs.start=props.start.toString()}return createElement(tag,attrs,props.children)},code_block:function CodeBlock(props){var className=props.language&&"language-"+props.language;var code=createElement("code",{className:className},props.literal);return createElement("pre",getCoreProps(props),code)},code:function Code(props){return createElement("code",getCoreProps(props),props.children)},heading:function Heading(props){return createElement("h"+props.level,getCoreProps(props),props.children)},text:null,softbreak:null};var coreTypes=Object.keys(defaultRenderers);function getCoreProps(props){return{key:props.nodeKey,className:props.className,"data-sourcepos":props["data-sourcepos"]}}function normalizeTypeName(typeName){var norm=typeName.toLowerCase();var type=typeAliases[norm]||norm;return typeof defaultRenderers[type]!=="undefined"?type:typeName}function normalizeRenderers(renderers){return Object.keys(renderers||{}).reduce(function(normalized,type){var norm=normalizeTypeName(type);normalized[norm]=renderers[type];return normalized},{})}function HtmlRenderer(props){var coreProps=getCoreProps(props);var nodeProps=props.escapeHtml?{}:{dangerouslySetInnerHTML:{__html:props.literal}};var children=props.escapeHtml?[props.literal]:null;if(props.escapeHtml||!props.skipHtml){var actualProps=assign(coreProps,nodeProps);return createElement(props.isBlock?"div":"span",actualProps,children)}}function isGrandChildOfList(node){var grandparent=node.parent.parent;return grandparent&&grandparent.type.toLowerCase()==="list"&&grandparent.listTight}function addChild(node,child){var parent=node;do{parent=parent.parent}while(!parent.react);parent.react.children.push(child)}function createElement(tagName,props,children){var nodeChildren=Array.isArray(children)&&children.reduce(reduceChildren,[]);var args=[tagName,props].concat(nodeChildren||children);return React.createElement.apply(React,args)}function reduceChildren(children,child){var lastIndex=children.length-1;if(typeof child==="string"&&typeof children[lastIndex]==="string"){children[lastIndex]+=child}else{children.push(child)}return children}function flattenPosition(pos){return[pos[0][0],":",pos[0][1],"-",pos[1][0],":",pos[1][1]].map(String).join("")}function getNodeProps(node,key,opts,renderer){var props={key:key},undef;if(opts.sourcePos&&node.sourcepos){props["data-sourcepos"]=flattenPosition(node.sourcepos)}var type=normalizeTypeName(node.type);switch(type){case"html_inline":case"html_block":props.isBlock=type==="html_block";props.escapeHtml=opts.escapeHtml;props.skipHtml=opts.skipHtml;break;case"code_block":var codeInfo=node.info?node.info.split(/ +/):[];if(codeInfo.length>0&&codeInfo[0].length>0){props.language=codeInfo[0];props.codeinfo=codeInfo}break;case"code":props.children=node.literal;props.inline=true;break;case"heading":props.level=node.level;break;case"softbreak":props.softBreak=opts.softBreak;break;case"link":props.href=opts.transformLinkUri?opts.transformLinkUri(node.destination):node.destination;props.title=node.title||undef;if(opts.linkTarget){props.target=opts.linkTarget}break;case"image":props.src=opts.transformImageUri?opts.transformImageUri(node.destination):node.destination;props.title=node.title||undef;props.alt=node.react.children.join("");node.react.children=undef;break;case"list":props.start=node.listStart;props.type=node.listType;props.tight=node.listTight;break;default:}if(typeof renderer!=="string"){props.literal=node.literal}var children=props.children||node.react&&node.react.children;if(Array.isArray(children)){props.children=children.reduce(reduceChildren,[])||null}return props}function getPosition(node){if(!node){return null}if(node.sourcepos){return flattenPosition(node.sourcepos)}return getPosition(node.parent)}function renderNodes(block){var walker=block.walker();var softBreak=this.softBreak==="br"?React.createElement("br"):this.softBreak;var propOptions={sourcePos:this.sourcePos,escapeHtml:this.escapeHtml,skipHtml:this.skipHtml,transformLinkUri:this.transformLinkUri,transformImageUri:this.transformImageUri,softBreak:softBreak,linkTarget:this.linkTarget};var e,node,entering,leaving,type,doc,key,nodeProps,prevPos,prevIndex=0;while(e=walker.next()){var pos=getPosition(e.node.sourcepos?e.node:e.node.parent);if(prevPos===pos){key=pos+prevIndex;prevIndex++}else{key=pos;prevIndex=0}prevPos=pos;entering=e.entering;leaving=!entering;node=e.node;type=normalizeTypeName(node.type);nodeProps=null;if(!doc){doc=node;node.react={children:[]};continue}else if(node===doc){continue}if(type==="paragraph"&&isGrandChildOfList(node)){continue}if(this.skipHtml&&(type==="html_block"||type==="html_inline")){continue}var isDocument=node===doc;var disallowedByConfig=this.allowedTypes.indexOf(type)===-1;var disallowedByUser=false;var isCompleteParent=node.isContainer&&leaving;var renderer=this.renderers[type];if(this.allowNode&&(isCompleteParent||!node.isContainer)){var nodeChildren=isCompleteParent?node.react.children:[];nodeProps=getNodeProps(node,key,propOptions,renderer);disallowedByUser=!this.allowNode({type:pascalCase(type),renderer:this.renderers[type],props:nodeProps,children:nodeChildren})}if(!isDocument&&(disallowedByUser||disallowedByConfig)){if(!this.unwrapDisallowed&&entering&&node.isContainer){walker.resumeAt(node,false)}continue}var isSimpleNode=type==="text"||type==="softbreak";if(typeof renderer!=="function"&&!isSimpleNode&&typeof renderer!=="string"){throw new Error("Renderer for type `"+pascalCase(node.type)+"` not defined or is not renderable")}if(node.isContainer&&entering){node.react={component:renderer,props:{},children:[]}}else{var childProps=nodeProps||getNodeProps(node,key,propOptions,renderer);if(renderer){childProps=typeof renderer==="string"?childProps:assign(childProps,{nodeKey:childProps.key});addChild(node,React.createElement(renderer,childProps))}else if(type==="text"){addChild(node,node.literal)}else if(type==="softbreak"){addChild(node,softBreak)}}}return doc.react.children}function defaultLinkUriFilter(uri){var url=uri.replace(/file:\/\//g,"x-file://");return decodeURI(xssFilters.uriInDoubleQuotedAttr(url))}function ReactRenderer(options){var opts=options||{};if(opts.allowedTypes&&opts.disallowedTypes){throw new Error("Only one of `allowedTypes` and `disallowedTypes` should be defined")}if(opts.allowedTypes&&!Array.isArray(opts.allowedTypes)){throw new Error("`allowedTypes` must be an array")}if(opts.disallowedTypes&&!Array.isArray(opts.disallowedTypes)){throw new Error("`disallowedTypes` must be an array")}if(opts.allowNode&&typeof opts.allowNode!=="function"){throw new Error("`allowNode` must be a function")}var linkFilter=opts.transformLinkUri;if(typeof linkFilter==="undefined"){linkFilter=defaultLinkUriFilter}else if(linkFilter&&typeof linkFilter!=="function"){throw new Error("`transformLinkUri` must either be a function, or `null` to disable")}var imageFilter=opts.transformImageUri;if(typeof imageFilter!=="undefined"&&typeof imageFilter!=="function"){throw new Error("`transformImageUri` must be a function")}if(opts.renderers&&!isPlainObject(opts.renderers)){throw new Error("`renderers` must be a plain object of `Type`: `Renderer` pairs")}var allowedTypes=opts.allowedTypes&&opts.allowedTypes.map(normalizeTypeName)||coreTypes;if(opts.disallowedTypes){var disallowed=opts.disallowedTypes.map(normalizeTypeName);allowedTypes=allowedTypes.filter(function filterDisallowed(type){return disallowed.indexOf(type)===-1})}return{sourcePos:Boolean(opts.sourcePos),softBreak:opts.softBreak||"\n",renderers:assign({},defaultRenderers,normalizeRenderers(opts.renderers)),escapeHtml:Boolean(opts.escapeHtml),skipHtml:Boolean(opts.skipHtml),transformLinkUri:linkFilter,transformImageUri:imageFilter,allowNode:opts.allowNode,allowedTypes:allowedTypes,unwrapDisallowed:Boolean(opts.unwrapDisallowed),render:renderNodes,linkTarget:opts.linkTarget||false}}ReactRenderer.uriTransformer=defaultLinkUriFilter;ReactRenderer.types=coreTypes.map(pascalCase);ReactRenderer.renderers=coreTypes.reduce(function(renderers,type){renderers[pascalCase(type)]=defaultRenderers[type];return renderers},{});module.exports=ReactRenderer},function(module,exports){var MAX_SAFE_INTEGER=9007199254740991;var argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]";var reIsUint=/^(?:0|[1-9]\d*)$/;function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var objectToString=objectProto.toString;var propertyIsEnumerable=objectProto.propertyIsEnumerable;var nativeKeys=overArg(Object.keys,Object),nativeMax=Math.max;var nonEnumShadows=!propertyIsEnumerable.call({valueOf:1},"valueOf");function arrayLikeKeys(value,inherited){var result=isArray(value)||isArguments(value)?baseTimes(value.length,String):[];var length=result.length,skipIndexes=!!length;for(var key in value){if((inherited||hasOwnProperty.call(value,key))&&!(skipIndexes&&(key=="length"||isIndex(key,length)))){result.push(key)}}return result}function assignValue(object,key,value){var objValue=object[key];if(!(hasOwnProperty.call(object,key)&&eq(objValue,value))||value===undefined&&!(key in object)){object[key]=value}}function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty.call(object,key)&&key!="constructor"){result.push(key)}}return result}function baseRest(func,start){start=nativeMax(start===undefined?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=array;return apply(func,this,otherArgs)}}function copyObject(source,props,object,customizer){object||(object={});var index=-1,length=props.length;while(++index<length){var key=props[index];var newValue=customizer?customizer(object[key],source[key],key,object,source):undefined;assignValue(object,key,newValue===undefined?source[key]:newValue)}return object}function createAssigner(assigner){return baseRest(function(object,sources){var index=-1,length=sources.length,customizer=length>1?sources[length-1]:undefined,guard=length>2?sources[2]:undefined;customizer=assigner.length>3&&typeof customizer=="function"?(length--,customizer):undefined;if(guard&&isIterateeCall(sources[0],sources[1],guard)){customizer=length<3?undefined:customizer;length=1}object=Object(object);while(++index<length){var source=sources[index];if(source){assigner(object,source,index,customizer)}}return object})}function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}function isIterateeCall(value,index,object){if(!isObject(object)){return false}var type=typeof index;if(type=="number"?isArrayLike(object)&&isIndex(index,object.length):type=="string"&&index in object){return eq(object[index],value)}return false}function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto;return value===proto}function eq(value,other){return value===other||value!==value&&other!==other}function isArguments(value){return isArrayLikeObject(value)&&hasOwnProperty.call(value,"callee")&&(!propertyIsEnumerable.call(value,"callee")||objectToString.call(value)==argsTag)}var isArray=Array.isArray;function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction(value)}function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}function isFunction(value){var tag=isObject(value)?objectToString.call(value):"";return tag==funcTag||tag==genTag}function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isObject(value){var type=typeof value;return!!value&&(type=="object"||type=="function")}function isObjectLike(value){return!!value&&typeof value=="object"}var assign=createAssigner(function(object,source){if(nonEnumShadows||isPrototype(source)||isArrayLike(source)){copyObject(source,keys(source),object);return}for(var key in source){if(hasOwnProperty.call(source,key)){assignValue(object,key,source[key])}}});function keys(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}module.exports=assign},function(module,exports){var objectTag="[object Object]";function isHostObject(value){var result=false;if(value!=null&&typeof value.toString!="function"){try{result=!!(value+"")}catch(e){}}return result}function overArg(func,transform){return function(arg){return func(transform(arg))}}var funcProto=Function.prototype,objectProto=Object.prototype;var funcToString=funcProto.toString;var hasOwnProperty=objectProto.hasOwnProperty;var objectCtorString=funcToString.call(Object);var objectToString=objectProto.toString;var getPrototype=overArg(Object.getPrototypeOf,Object);function isObjectLike(value){return!!value&&typeof value=="object"}function isPlainObject(value){if(!isObjectLike(value)||objectToString.call(value)!=objectTag||isHostObject(value)){return false}var proto=getPrototype(value);if(proto===null){return true}var Ctor=hasOwnProperty.call(proto,"constructor")&&proto.constructor;return typeof Ctor=="function"&&Ctor instanceof Ctor&&funcToString.call(Ctor)==objectCtorString}module.exports=isPlainObject},function(module,exports){exports._getPrivFilters=function(){var LT=/</g,QUOT=/"/g,SQUOT=/'/g,AMP=/&/g,NULL=/\x00/g,SPECIAL_ATTR_VALUE_UNQUOTED_CHARS=/(?:^$|[\x00\x09-\x0D "'`=<>])/g,SPECIAL_HTML_CHARS=/[&<>"'`]/g,SPECIAL_COMMENT_CHARS=/(?:\x00|^-*!?>|--!?>|--?!?$|\]>|\]$)/g;var SENSITIVE_HTML_ENTITIES=/&(?:#([xX][0-9A-Fa-f]+|\d+);?|(Tab|NewLine|colon|semi|lpar|rpar|apos|sol|comma|excl|ast|midast|ensp|emsp|thinsp);|(nbsp|amp|AMP|lt|LT|gt|GT|quot|QUOT);?)/g,SENSITIVE_NAMED_REF_MAP={Tab:"\t",NewLine:"\n",colon:":",semi:";",lpar:"(",rpar:")",apos:"'",sol:"/",comma:",",excl:"!",ast:"*",midast:"*",ensp:" ",emsp:" ",thinsp:" ",nbsp:" ",amp:"&",lt:"<",gt:">",quot:'"',QUOT:'"'};var CSS_VALID_VALUE=/^(?:(?!-*expression)#?[-\w]+|[+-]?(?:\d+|\d*\.\d+)(?:r?em|ex|ch|cm|mm|in|px|pt|pc|%|vh|vw|vmin|vmax)?|!important|)$/i,CSS_DOUBLE_QUOTED_CHARS=/[\x00-\x1F\x7F\[\]{}\\"]/g,CSS_SINGLE_QUOTED_CHARS=/[\x00-\x1F\x7F\[\]{}\\']/g,CSS_BLACKLIST=/url[\(\u207D\u208D]+/g,CSS_UNQUOTED_URL=/['\(\)]/g;var URL_IPV6=/\/\/%5[Bb]([A-Fa-f0-9:]+)%5[Dd]/;var URI_BLACKLIST_PROTOCOLS={javascript:1,data:1,vbscript:1,mhtml:1,"x-schema":1},URI_PROTOCOL_COLON=/(?::|&#[xX]0*3[aA];?|&#0*58;?|&colon;)/,URI_PROTOCOL_WHITESPACES=/(?:^[\x00-\x20]+|[\t\n\r\x00]+)/g,URI_PROTOCOL_NAMED_REF_MAP={Tab:"\t",NewLine:"\n"};var x,strReplace=function(s,regexp,callback){return s===undefined?"undefined":s===null?"null":s.toString().replace(regexp,callback)},fromCodePoint=String.fromCodePoint||function(codePoint){if(arguments.length===0){return""}if(codePoint<=65535){return String.fromCharCode(codePoint)}codePoint-=65536;return String.fromCharCode((codePoint>>10)+55296,codePoint%1024+56320)};function getProtocol(str){var s=str.split(URI_PROTOCOL_COLON,2);return s[0]&&(s.length===2||str.length!==s[0].length)?s[0]:null}function htmlDecode(s,namedRefMap,reNamedRef,skipReplacement){namedRefMap=namedRefMap||SENSITIVE_NAMED_REF_MAP;reNamedRef=reNamedRef||SENSITIVE_HTML_ENTITIES;function regExpFunction(m,num,named,named1){if(num){num=Number(num[0]<="9"?num:"0"+num);return skipReplacement?fromCodePoint(num):num===128?"€":num===130?"‚":num===131?"ƒ":num===132?"„":num===133?"…":num===134?"†":num===135?"‡":num===136?"ˆ":num===137?"‰":num===138?"Š":num===139?"‹":num===140?"Œ":num===142?"Ž":num===145?"‘":num===146?"’":num===147?"“":num===148?"”":num===149?"•":num===150?"–":num===151?"—":num===152?"˜":num===153?"™":num===154?"š":num===155?"›":num===156?"œ":num===158?"ž":num===159?"Ÿ":num>=55296&&num<=57343||num===13?"�":x.frCoPt(num)}return namedRefMap[named||named1]||m}return s===undefined?"undefined":s===null?"null":s.toString().replace(NULL,"�").replace(reNamedRef,regExpFunction)}function cssEncode(chr){return"\\"+chr.charCodeAt(0).toString(16).toLowerCase()+" "}function cssBlacklist(s){return s.replace(CSS_BLACKLIST,function(m){return"-x-"+m})}function cssUrl(s){s=x.yufull(htmlDecode(s));var protocol=getProtocol(s);return protocol&&URI_BLACKLIST_PROTOCOLS[protocol.toLowerCase()]?"##"+s:s}return x={frCoPt:function(num){return num===undefined||num===null?"":!isFinite(num=Number(num))||num<=0||num>1114111||num>=1&&num<=8||num>=14&&num<=31||num>=127&&num<=159||num>=64976&&num<=65007||num===11||(num&65535)===65535||(num&65535)===65534?"�":fromCodePoint(num)},d:htmlDecode,yup:function(s){s=getProtocol(s.replace(NULL,""));return s?htmlDecode(s,URI_PROTOCOL_NAMED_REF_MAP,null,true).replace(URI_PROTOCOL_WHITESPACES,"").toLowerCase():null},y:function(s){return strReplace(s,SPECIAL_HTML_CHARS,function(m){return m==="&"?"&amp;":m==="<"?"&lt;":m===">"?"&gt;":m==='"'?"&quot;":m==="'"?"&#39;":"&#96;"})},ya:function(s){return strReplace(s,AMP,"&amp;")},yd:function(s){return strReplace(s,LT,"&lt;")},yc:function(s){return strReplace(s,SPECIAL_COMMENT_CHARS,function(m){return m==="\0"?"�":m==="--!"||m==="--"||m==="-"||m==="]"?m+" ":m.slice(0,-1)+" >"})},yavd:function(s){return strReplace(s,QUOT,"&quot;")},yavs:function(s){return strReplace(s,SQUOT,"&#39;")},yavu:function(s){return strReplace(s,SPECIAL_ATTR_VALUE_UNQUOTED_CHARS,function(m){return m==="\t"?"&#9;":m==="\n"?"&#10;":m==="\v"?"&#11;":m==="\f"?"&#12;":m==="\r"?"&#13;":m===" "?"&#32;":m==="="?"&#61;":m==="<"?"&lt;":m===">"?"&gt;":m==='"'?"&quot;":m==="'"?"&#39;":m==="`"?"&#96;":"�"})},yu:encodeURI,yuc:encodeURIComponent,yubl:function(s){return URI_BLACKLIST_PROTOCOLS[x.yup(s)]?"x-"+s:s},yufull:function(s){return x.yu(s).replace(URL_IPV6,function(m,p){return"//["+p+"]"})},yublf:function(s){return x.yubl(x.yufull(s))},yceu:function(s){s=htmlDecode(s);return CSS_VALID_VALUE.test(s)?s:";-x:'"+cssBlacklist(s.replace(CSS_SINGLE_QUOTED_CHARS,cssEncode))+"';-v:"},yced:function(s){return cssBlacklist(htmlDecode(s).replace(CSS_DOUBLE_QUOTED_CHARS,cssEncode))},yces:function(s){return cssBlacklist(htmlDecode(s).replace(CSS_SINGLE_QUOTED_CHARS,cssEncode))},yceuu:function(s){return cssUrl(s).replace(CSS_UNQUOTED_URL,function(chr){return chr==="'"?"\\27 ":chr==="("?"%28":"%29"})},yceud:function(s){return cssUrl(s)},yceus:function(s){return cssUrl(s).replace(SQUOT,"\\27 ")}}};var privFilters=exports._privFilters=exports._getPrivFilters();function uriInAttr(s,yav,yu){return privFilters.yubl(yav((yu||privFilters.yufull)(s)))}exports.inHTMLData=privFilters.yd;exports.inHTMLComment=privFilters.yc;exports.inSingleQuotedAttr=privFilters.yavs;exports.inDoubleQuotedAttr=privFilters.yavd;exports.inUnQuotedAttr=privFilters.yavu;exports.uriInSingleQuotedAttr=function(s){return uriInAttr(s,privFilters.yavs)};exports.uriInDoubleQuotedAttr=function(s){return uriInAttr(s,privFilters.yavd)};exports.uriInUnQuotedAttr=function(s){return uriInAttr(s,privFilters.yavu)};exports.uriInHTMLData=privFilters.yufull;exports.uriInHTMLComment=function(s){return privFilters.yc(privFilters.yufull(s))};exports.uriPathInSingleQuotedAttr=function(s){return uriInAttr(s,privFilters.yavs,privFilters.yu)};exports.uriPathInDoubleQuotedAttr=function(s){return uriInAttr(s,privFilters.yavd,privFilters.yu)};exports.uriPathInUnQuotedAttr=function(s){return uriInAttr(s,privFilters.yavu,privFilters.yu)};exports.uriPathInHTMLData=privFilters.yu;exports.uriPathInHTMLComment=function(s){return privFilters.yc(privFilters.yu(s))};exports.uriQueryInSingleQuotedAttr=exports.uriPathInSingleQuotedAttr;exports.uriQueryInDoubleQuotedAttr=exports.uriPathInDoubleQuotedAttr;exports.uriQueryInUnQuotedAttr=exports.uriPathInUnQuotedAttr;exports.uriQueryInHTMLData=exports.uriPathInHTMLData;exports.uriQueryInHTMLComment=exports.uriPathInHTMLComment;exports.uriComponentInSingleQuotedAttr=function(s){return privFilters.yavs(privFilters.yuc(s))};exports.uriComponentInDoubleQuotedAttr=function(s){return privFilters.yavd(privFilters.yuc(s))};exports.uriComponentInUnQuotedAttr=function(s){return privFilters.yavu(privFilters.yuc(s))};exports.uriComponentInHTMLData=privFilters.yuc;exports.uriComponentInHTMLComment=function(s){return privFilters.yc(privFilters.yuc(s))};exports.uriFragmentInSingleQuotedAttr=function(s){return privFilters.yubl(privFilters.yavs(privFilters.yuc(s)))};exports.uriFragmentInDoubleQuotedAttr=function(s){return privFilters.yubl(privFilters.yavd(privFilters.yuc(s)))};exports.uriFragmentInUnQuotedAttr=function(s){return privFilters.yubl(privFilters.yavu(privFilters.yuc(s)))};exports.uriFragmentInHTMLData=exports.uriComponentInHTMLData;exports.uriFragmentInHTMLComment=exports.uriComponentInHTMLComment},function(module,exports){function pascalcase(str){if(typeof str!=="string"){throw new TypeError("expected a string.")}str=str.replace(/([A-Z])/g," $1");if(str.length===1){return str.toUpperCase()}str=str.replace(/^[\W_]+|[\W_]+$/g,"").toLowerCase();str=str.charAt(0).toUpperCase()+str.slice(1);return str.replace(/[\W_]+(\w|$)/g,function(_,ch){return ch.toUpperCase()})}module.exports=pascalcase},function(module,exports,__webpack_require__){(function(process){if(process.env.NODE_ENV!=="production"){var REACT_ELEMENT_TYPE=typeof Symbol==="function"&&Symbol.for&&Symbol.for("react.element")||60103;var isValidElement=function(object){return typeof object==="object"&&object!==null&&object.$$typeof===REACT_ELEMENT_TYPE};var throwOnDirectAccess=true;module.exports=__webpack_require__(103)(isValidElement,throwOnDirectAccess)}else{module.exports=__webpack_require__(225)()}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var emptyFunction=__webpack_require__(10);var invariant=__webpack_require__(1);var ReactPropTypesSecret=__webpack_require__(72);module.exports=function(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret){return}invariant(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. "+"Use PropTypes.checkPropTypes() to call them. "+"Read more at http://fb.me/use-check-prop-types")}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim};ReactPropTypes.checkPropTypes=emptyFunction;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes}},function(module,exports,__webpack_require__){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var React=__webpack_require__(38);var CodeMirror=__webpack_require__(11);__webpack_require__(227);__webpack_require__(107);__webpack_require__(228);__webpack_require__(229);__webpack_require__(230);__webpack_require__(231);__webpack_require__(232);__webpack_require__(234);__webpack_require__(235);var QueryEditor=function(_super){__extends(QueryEditor,_super);function QueryEditor(props){var _this=_super.call(this)||this;_this.editor=null;_this.ignoreChangeEvent=false;_this.handleAutoCompletePick=function(value){if(_this.props.onSymbol){_this.props.onSymbol(value)}};_this.execute=function(){if(_this.props.onExecute){_this.props.onExecute()}};_this.autoComplete=function(editor){var hint=CodeMirror.hint[_this.props.mode];if(!hint)return;_this.editor.showHint({hint:hint,closeCharacters:/[\s()\[\];]/});if(editor.state.completionActive&&editor.state.completionActive.data){CodeMirror.on(editor.state.completionActive.data,"select",_this.handleAutoCompletePick);CodeMirror.on(editor.state.completionActive.data,"pick",_this.handleAutoCompletePick)}};_this.onFocus=function(){if(_this.props.onActive){_this.props.onActive(true)}};_this.onBlur=function(){if(_this.props.onActive){_this.props.onActive(false)}};_this.autocompleteAfter=/^[a-zA-Z(:]$/;_this.onKeyUp=function(cm,event){if(_this.autocompleteAfter.test(event.key)){_this.autoComplete(cm)}};_this.onEdit=function(editor,change){if(!_this.ignoreChangeEvent){_this.cachedValue=_this.editor.getValue();if(_this.props.onChange){_this.props.onChange(_this.cachedValue)}}};_this.onCursorActivity=function(editor){if(!editor.state.completionActive&&_this.props.onSymbol){_this.props.onSymbol(_this.getCurrentSymbol(editor))}};_this.cachedValue=props.value||"";return _this}QueryEditor.prototype.componentDidMount=function(){var _this=this;this.editor=CodeMirror(this.node,{value:this.props.value||"",lineNumbers:true,tabSize:2,theme:"neat",mode:this.props.mode,keyMap:"sublime",autoCloseBrackets:true,matchBrackets:true,showCursorWhenSelecting:true,hintOptions:{closeOnUnfocus:true,completeSingle:false},gutters:["CodeMirror-linenumbers"],extraKeys:{"Cmd-Space":this.autoComplete,"Ctrl-Space":this.autoComplete,"':'":function(editor){_this.autoComplete(editor);return CodeMirror.Pass},"Cmd-Enter":this.execute,"Ctrl-Enter":this.execute}});this.editor.on("change",this.onEdit);this.editor.on("keyup",this.onKeyUp);this.editor.on("focus",this.onFocus);this.editor.on("blur",this.onBlur);this.editor.on("cursorActivity",this.onCursorActivity)};QueryEditor.prototype.componentDidUpdate=function(prevProps){this.ignoreChangeEvent=true;if(this.props.mode!==prevProps.mode){this.editor.setOption("mode",this.props.mode)}if(this.props.value!==prevProps.value&&this.props.value!==this.cachedValue){this.cachedValue=this.props.value;this.editor.setValue(this.props.value)}this.ignoreChangeEvent=false};QueryEditor.prototype.componentWillUnmount=function(){this.editor.off("change",this.onEdit);this.editor.off("keyup",this.onKeyUp);this.editor.off("focus",this.onFocus);this.editor.off("blur",this.onBlur);this.editor.off("cursorActivity",this.onCursorActivity);this.editor=null};QueryEditor.prototype.render=function(){var _this=this;return React.createElement("div",{style:{position:"absolute",top:0,right:0,left:0,bottom:0},ref:function(node){return _this.node=node}})};QueryEditor.prototype.getCodeMirror=function(){return this.editor};QueryEditor.prototype.getClientHeight=function(){return this.node&&this.node.clientHeight};QueryEditor.prototype.getCurrentSymbol=function(editor){var doc=editor.getDoc();var pos=doc.getCursor();var line=doc.getLine(pos.line);var start=pos.ch,end=pos.ch;var symbolChars=/[^\s'`,@()\[\]';]/;if(start>0&&symbolChars.test(line.charAt(start-1))){start--;end--}if(!symbolChars.test(line.charAt(start)))return"";if(line){if(end===line.length&&start)--start;else++end;while(start>0&&symbolChars.test(line.charAt(start-1)))--start;while(end<line.length&&symbolChars.test(line.charAt(end)))++end}return doc.getRange({line:pos.line,ch:start},{line:pos.line,ch:end})};return QueryEditor}(React.Component);exports.default=QueryEditor},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){"use strict";var HINT_ELEMENT_CLASS="CodeMirror-hint";var ACTIVE_HINT_ELEMENT_CLASS="CodeMirror-hint-active";CodeMirror.showHint=function(cm,getHints,options){if(!getHints)return cm.showHint(options);if(options&&options.async)getHints.async=true;var newOpts={hint:getHints};if(options)for(var prop in options)newOpts[prop]=options[prop];return cm.showHint(newOpts)};CodeMirror.defineExtension("showHint",function(options){options=parseOptions(this,this.getCursor("start"),options);var selections=this.listSelections();if(selections.length>1)return;if(this.somethingSelected()){if(!options.hint.supportsSelection)return;for(var i=0;i<selections.length;i++)if(selections[i].head.line!=selections[i].anchor.line)return}if(this.state.completionActive)this.state.completionActive.close();var completion=this.state.completionActive=new Completion(this,options);if(!completion.options.hint)return;CodeMirror.signal(this,"startCompletion",this);completion.update(true)});function Completion(cm,options){this.cm=cm;this.options=options;this.widget=null;this.debounce=0;this.tick=0;this.startPos=this.cm.getCursor("start");this.startLen=this.cm.getLine(this.startPos.line).length-this.cm.getSelection().length;var self=this;cm.on("cursorActivity",this.activityFunc=function(){self.cursorActivity()})}var requestAnimationFrame=window.requestAnimationFrame||function(fn){return setTimeout(fn,1e3/60)};var cancelAnimationFrame=window.cancelAnimationFrame||clearTimeout;Completion.prototype={close:function(){if(!this.active())return;this.cm.state.completionActive=null;this.tick=null;this.cm.off("cursorActivity",this.activityFunc);if(this.widget&&this.data)CodeMirror.signal(this.data,"close");if(this.widget)this.widget.close();CodeMirror.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(data,i){var completion=data.list[i];if(completion.hint)completion.hint(this.cm,data,completion);else this.cm.replaceRange(getText(completion),completion.from||data.from,completion.to||data.to,"complete");CodeMirror.signal(data,"pick",completion);this.close()},cursorActivity:function(){if(this.debounce){cancelAnimationFrame(this.debounce);this.debounce=0}var pos=this.cm.getCursor(),line=this.cm.getLine(pos.line);if(pos.line!=this.startPos.line||line.length-pos.ch!=this.startLen-this.startPos.ch||pos.ch<this.startPos.ch||this.cm.somethingSelected()||pos.ch&&this.options.closeCharacters.test(line.charAt(pos.ch-1))){this.close()}else{var self=this;this.debounce=requestAnimationFrame(function(){self.update()});if(this.widget)this.widget.disable()}},update:function(first){if(this.tick==null)return;var self=this,myTick=++this.tick;fetchHints(this.options.hint,this.cm,this.options,function(data){if(self.tick==myTick)self.finishUpdate(data,first)})},finishUpdate:function(data,first){if(this.data)CodeMirror.signal(this.data,"update");var picked=this.widget&&this.widget.picked||first&&this.options.completeSingle;if(this.widget)this.widget.close();if(data&&this.data&&isNewCompletion(this.data,data))return;this.data=data;if(data&&data.list.length){if(picked&&data.list.length==1){this.pick(data,0)}else{this.widget=new Widget(this,data);CodeMirror.signal(data,"shown")}}}};function isNewCompletion(old,nw){var moved=CodeMirror.cmpPos(nw.from,old.from);return moved>0&&old.to.ch-old.from.ch!=nw.to.ch-nw.from.ch}function parseOptions(cm,pos,options){var editor=cm.options.hintOptions;var out={};for(var prop in defaultOptions)out[prop]=defaultOptions[prop];if(editor)for(var prop in editor)if(editor[prop]!==undefined)out[prop]=editor[prop];if(options)for(var prop in options)if(options[prop]!==undefined)out[prop]=options[prop];if(out.hint.resolve)out.hint=out.hint.resolve(cm,pos);return out}function getText(completion){if(typeof completion=="string")return completion;else return completion.text}function buildKeyMap(completion,handle){var baseMap={Up:function(){handle.moveFocus(-1)},Down:function(){handle.moveFocus(1)},PageUp:function(){handle.moveFocus(-handle.menuSize()+1,true)},PageDown:function(){handle.moveFocus(handle.menuSize()-1,true)},Home:function(){handle.setFocus(0)},End:function(){handle.setFocus(handle.length-1)},Enter:handle.pick,Tab:handle.pick,Esc:handle.close};var custom=completion.options.customKeys;var ourMap=custom?{}:baseMap;function addBinding(key,val){var bound;if(typeof val!="string")bound=function(cm){return val(cm,handle)};else if(baseMap.hasOwnProperty(val))bound=baseMap[val];else bound=val;ourMap[key]=bound}if(custom)for(var key in custom)if(custom.hasOwnProperty(key))addBinding(key,custom[key]);var extra=completion.options.extraKeys;if(extra)for(var key in extra)if(extra.hasOwnProperty(key))addBinding(key,extra[key]);return ourMap}function getHintElement(hintsElement,el){while(el&&el!=hintsElement){if(el.nodeName.toUpperCase()==="LI"&&el.parentNode==hintsElement)return el;el=el.parentNode}}function Widget(completion,data){this.completion=completion;this.data=data;this.picked=false;var widget=this,cm=completion.cm;var hints=this.hints=document.createElement("ul");hints.className="CodeMirror-hints";this.selectedHint=data.selectedHint||0;var completions=data.list;for(var i=0;i<completions.length;++i){var elt=hints.appendChild(document.createElement("li")),cur=completions[i];var className=HINT_ELEMENT_CLASS+(i!=this.selectedHint?"":" "+ACTIVE_HINT_ELEMENT_CLASS);if(cur.className!=null)className=cur.className+" "+className;elt.className=className;if(cur.render)cur.render(elt,data,cur);else elt.appendChild(document.createTextNode(cur.displayText||getText(cur)));elt.hintId=i}var pos=cm.cursorCoords(completion.options.alignWithWord?data.from:null);var left=pos.left,top=pos.bottom,below=true;hints.style.left=left+"px";hints.style.top=top+"px";var winW=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var winH=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(completion.options.container||document.body).appendChild(hints);var box=hints.getBoundingClientRect(),overlapY=box.bottom-winH;var scrolls=hints.scrollHeight>hints.clientHeight+1;var startScroll=cm.getScrollInfo();if(overlapY>0){var height=box.bottom-box.top,curTop=pos.top-(pos.bottom-box.top);if(curTop-height>0){hints.style.top=(top=pos.top-height)+"px";below=false}else if(height>winH){hints.style.height=winH-5+"px";hints.style.top=(top=pos.bottom-box.top)+"px";var cursor=cm.getCursor();if(data.from.ch!=cursor.ch){pos=cm.cursorCoords(cursor);hints.style.left=(left=pos.left)+"px";box=hints.getBoundingClientRect()}}}var overlapX=box.right-winW;if(overlapX>0){if(box.right-box.left>winW){hints.style.width=winW-5+"px";overlapX-=box.right-box.left-winW}hints.style.left=(left=pos.left-overlapX)+"px"}if(scrolls)for(var node=hints.firstChild;node;node=node.nextSibling)node.style.paddingRight=cm.display.nativeBarWidth+"px";cm.addKeyMap(this.keyMap=buildKeyMap(completion,{moveFocus:function(n,avoidWrap){widget.changeActive(widget.selectedHint+n,avoidWrap)},setFocus:function(n){widget.changeActive(n)},menuSize:function(){return widget.screenAmount()},length:completions.length,close:function(){completion.close()},pick:function(){widget.pick()},data:data}));if(completion.options.closeOnUnfocus){var closingOnBlur;cm.on("blur",this.onBlur=function(){closingOnBlur=setTimeout(function(){completion.close()},100)});cm.on("focus",this.onFocus=function(){clearTimeout(closingOnBlur)})}cm.on("scroll",this.onScroll=function(){var curScroll=cm.getScrollInfo(),editor=cm.getWrapperElement().getBoundingClientRect();var newTop=top+startScroll.top-curScroll.top;var point=newTop-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!below)point+=hints.offsetHeight;if(point<=editor.top||point>=editor.bottom)return completion.close();hints.style.top=newTop+"px";hints.style.left=left+startScroll.left-curScroll.left+"px"});CodeMirror.on(hints,"dblclick",function(e){var t=getHintElement(hints,e.target||e.srcElement);if(t&&t.hintId!=null){widget.changeActive(t.hintId);widget.pick()}});CodeMirror.on(hints,"click",function(e){var t=getHintElement(hints,e.target||e.srcElement);if(t&&t.hintId!=null){widget.changeActive(t.hintId);if(completion.options.completeOnSingleClick)widget.pick()}});CodeMirror.on(hints,"mousedown",function(){setTimeout(function(){cm.focus()},20)});CodeMirror.signal(data,"select",completions[0],hints.firstChild);return true}Widget.prototype={close:function(){if(this.completion.widget!=this)return;this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var cm=this.completion.cm;if(this.completion.options.closeOnUnfocus){cm.off("blur",this.onBlur);cm.off("focus",this.onFocus)}cm.off("scroll",this.onScroll)},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var widget=this;this.keyMap={Enter:function(){widget.picked=true}};this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(i,avoidWrap){if(i>=this.data.list.length)i=avoidWrap?this.data.list.length-1:0;else if(i<0)i=avoidWrap?0:this.data.list.length-1;if(this.selectedHint==i)return;var node=this.hints.childNodes[this.selectedHint];node.className=node.className.replace(" "+ACTIVE_HINT_ELEMENT_CLASS,"");node=this.hints.childNodes[this.selectedHint=i];node.className+=" "+ACTIVE_HINT_ELEMENT_CLASS;if(node.offsetTop<this.hints.scrollTop)this.hints.scrollTop=node.offsetTop-3;else if(node.offsetTop+node.offsetHeight>this.hints.scrollTop+this.hints.clientHeight)this.hints.scrollTop=node.offsetTop+node.offsetHeight-this.hints.clientHeight+3;CodeMirror.signal(this.data,"select",this.data.list[this.selectedHint],node)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};function applicableHelpers(cm,helpers){if(!cm.somethingSelected())return helpers;var result=[];for(var i=0;i<helpers.length;i++)if(helpers[i].supportsSelection)result.push(helpers[i]);return result}function fetchHints(hint,cm,options,callback){if(hint.async){hint(cm,callback,options)}else{var result=hint(cm,options);if(result&&result.then)result.then(callback);else callback(result)}}function resolveAutoHints(cm,pos){var helpers=cm.getHelpers(pos,"hint"),words;if(helpers.length){var resolved=function(cm,callback,options){var app=applicableHelpers(cm,helpers);function run(i){if(i==app.length)return callback(null);fetchHints(app[i],cm,options,function(result){if(result&&result.list.length>0)callback(result);else run(i+1)})}run(0)};resolved.async=true;resolved.supportsSelection=true;return resolved}else if(words=cm.getHelper(cm.getCursor(),"hintWords")){return function(cm){return CodeMirror.hint.fromList(cm,{words:words})}}else if(CodeMirror.hint.anyword){return function(cm,options){return CodeMirror.hint.anyword(cm,options)}}else{return function(){}}}CodeMirror.registerHelper("hint","auto",{resolve:resolveAutoHints});CodeMirror.registerHelper("hint","fromList",function(cm,options){var cur=cm.getCursor(),token=cm.getTokenAt(cur);var to=CodeMirror.Pos(cur.line,token.end);if(token.string&&/\w/.test(token.string[token.string.length-1])){var term=token.string,from=CodeMirror.Pos(cur.line,token.start)}else{var term="",from=to}var found=[];for(var i=0;i<options.words.length;i++){var word=options.words[i];if(word.slice(0,term.length)==term)found.push(word)}if(found.length)return{list:found,from:from,to:to}});CodeMirror.commands.autocomplete=CodeMirror.showHint;var defaultOptions={hint:CodeMirror.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:true,container:null,customKeys:null,extraKeys:null};CodeMirror.defineOption("hintOptions",null)})},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){"use strict";CodeMirror.defineMode("javascript",function(config,parserConfig){var indentUnit=config.indentUnit;var statementIndent=parserConfig.statementIndent;var jsonldMode=parserConfig.jsonld;var jsonMode=parserConfig.json||jsonldMode;var isTS=parserConfig.typescript;var wordRE=parserConfig.wordCharacters||/[\w$\xa1-\uffff]/;var keywords=function(){function kw(type){return{type:type,style:"keyword"}}var A=kw("keyword a"),B=kw("keyword b"),C=kw("keyword c");var operator=kw("operator"),atom={type:"atom",style:"atom"};var jsKeywords={if:kw("if"),while:A,with:A,else:B,do:B,try:B,finally:B,return:C,break:C,continue:C,new:kw("new"),delete:C,throw:C,debugger:C,var:kw("var"),const:kw("var"),let:kw("var"),function:kw("function"),catch:kw("catch"),for:kw("for"),switch:kw("switch"),case:kw("case"),default:kw("default"),in:operator,typeof:operator,instanceof:operator,true:atom,false:atom,null:atom,undefined:atom,NaN:atom,Infinity:atom,this:kw("this"),class:kw("class"),super:kw("atom"),yield:C,export:kw("export"),import:kw("import"),extends:C,await:C};if(isTS){var type={type:"variable",style:"type"};var tsKeywords={interface:kw("class"),implements:C,namespace:C,module:kw("module"),enum:kw("module"),public:kw("modifier"),private:kw("modifier"),protected:kw("modifier"),abstract:kw("modifier"),readonly:kw("modifier"),string:type,number:type,boolean:type,any:type};for(var attr in tsKeywords){jsKeywords[attr]=tsKeywords[attr]}}return jsKeywords}();var isOperatorChar=/[+\-*&%=<>!?|~^@]/;var isJsonldKeyword=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/;function readRegexp(stream){var escaped=false,next,inSet=false;while((next=stream.next())!=null){if(!escaped){if(next=="/"&&!inSet)return;if(next=="[")inSet=true;else if(inSet&&next=="]")inSet=false}escaped=!escaped&&next=="\\"}}var type,content;function ret(tp,style,cont){type=tp;content=cont;return style}function tokenBase(stream,state){var ch=stream.next();if(ch=='"'||ch=="'"){state.tokenize=tokenString(ch);return state.tokenize(stream,state)}else if(ch=="."&&stream.match(/^\d+(?:[eE][+\-]?\d+)?/)){return ret("number","number")}else if(ch=="."&&stream.match("..")){return ret("spread","meta")}else if(/[\[\]{}\(\),;\:\.]/.test(ch)){return ret(ch)}else if(ch=="="&&stream.eat(">")){return ret("=>","operator")}else if(ch=="0"&&stream.eat(/x/i)){stream.eatWhile(/[\da-f]/i);return ret("number","number")}else if(ch=="0"&&stream.eat(/o/i)){stream.eatWhile(/[0-7]/i);return ret("number","number")}else if(ch=="0"&&stream.eat(/b/i)){stream.eatWhile(/[01]/i);return ret("number","number")}else if(/\d/.test(ch)){stream.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/);return ret("number","number")}else if(ch=="/"){if(stream.eat("*")){state.tokenize=tokenComment;return tokenComment(stream,state)}else if(stream.eat("/")){stream.skipToEnd();return ret("comment","comment")}else if(expressionAllowed(stream,state,1)){readRegexp(stream);stream.match(/^\b(([gimyu])(?![gimyu]*\2))+\b/);return ret("regexp","string-2")}else{stream.eatWhile(isOperatorChar);return ret("operator","operator",stream.current())}}else if(ch=="`"){state.tokenize=tokenQuasi;return tokenQuasi(stream,state)}else if(ch=="#"){stream.skipToEnd();return ret("error","error")}else if(isOperatorChar.test(ch)){if(ch!=">"||!state.lexical||state.lexical.type!=">")stream.eatWhile(isOperatorChar);return ret("operator","operator",stream.current())}else if(wordRE.test(ch)){stream.eatWhile(wordRE);var word=stream.current();if(state.lastType!="."){if(keywords.propertyIsEnumerable(word)){var kw=keywords[word];return ret(kw.type,kw.style,word)}if(word=="async"&&stream.match(/^\s*[\(\w]/,false))return ret("async","keyword",word)}return ret("variable","variable",word)}}function tokenString(quote){return function(stream,state){var escaped=false,next;if(jsonldMode&&stream.peek()=="@"&&stream.match(isJsonldKeyword)){state.tokenize=tokenBase;return ret("jsonld-keyword","meta")}while((next=stream.next())!=null){if(next==quote&&!escaped)break;escaped=!escaped&&next=="\\"}if(!escaped)state.tokenize=tokenBase;return ret("string","string")}}function tokenComment(stream,state){var maybeEnd=false,ch;while(ch=stream.next()){if(ch=="/"&&maybeEnd){state.tokenize=tokenBase;break}maybeEnd=ch=="*"}return ret("comment","comment")}function tokenQuasi(stream,state){var escaped=false,next;while((next=stream.next())!=null){if(!escaped&&(next=="`"||next=="$"&&stream.eat("{"))){state.tokenize=tokenBase;break}escaped=!escaped&&next=="\\"}return ret("quasi","string-2",stream.current())}var brackets="([{}])";function findFatArrow(stream,state){if(state.fatArrowAt)state.fatArrowAt=null;var arrow=stream.string.indexOf("=>",stream.start);if(arrow<0)return;if(isTS){var m=/:\s*(?:\w+(?:<[^>]*>|\[\])?|\{[^}]*\})\s*$/.exec(stream.string.slice(stream.start,arrow));if(m)arrow=m.index}var depth=0,sawSomething=false;for(var pos=arrow-1;pos>=0;--pos){var ch=stream.string.charAt(pos);var bracket=brackets.indexOf(ch);if(bracket>=0&&bracket<3){if(!depth){++pos;break}if(--depth==0){if(ch=="(")sawSomething=true;break}}else if(bracket>=3&&bracket<6){++depth}else if(wordRE.test(ch)){sawSomething=true}else if(/["'\/]/.test(ch)){return}else if(sawSomething&&!depth){++pos;break}}if(sawSomething&&!depth)state.fatArrowAt=pos}var atomicTypes={atom:true,number:true,variable:true,string:true,regexp:true,this:true,"jsonld-keyword":true};function JSLexical(indented,column,type,align,prev,info){this.indented=indented;this.column=column;this.type=type;this.prev=prev;this.info=info;if(align!=null)this.align=align}function inScope(state,varname){for(var v=state.localVars;v;v=v.next)if(v.name==varname)return true;for(var cx=state.context;cx;cx=cx.prev){for(var v=cx.vars;v;v=v.next)if(v.name==varname)return true}}function parseJS(state,style,type,content,stream){var cc=state.cc;cx.state=state;cx.stream=stream;cx.marked=null,cx.cc=cc;cx.style=style;if(!state.lexical.hasOwnProperty("align"))state.lexical.align=true;while(true){var combinator=cc.length?cc.pop():jsonMode?expression:statement;if(combinator(type,content)){while(cc.length&&cc[cc.length-1].lex)cc.pop()();if(cx.marked)return cx.marked;if(type=="variable"&&inScope(state,content))return"variable-2";return style}}}var cx={state:null,column:null,marked:null,cc:null};function pass(){for(var i=arguments.length-1;i>=0;i--)cx.cc.push(arguments[i])}function cont(){pass.apply(null,arguments);return true}function register(varname){function inList(list){for(var v=list;v;v=v.next)if(v.name==varname)return true;return false}var state=cx.state;cx.marked="def";if(state.context){if(inList(state.localVars))return;state.localVars={name:varname,next:state.localVars}}else{if(inList(state.globalVars))return;if(parserConfig.globalVars)state.globalVars={name:varname,next:state.globalVars}}}var defaultVars={name:"this",next:{name:"arguments"}};function pushcontext(){cx.state.context={prev:cx.state.context,vars:cx.state.localVars};cx.state.localVars=defaultVars}function popcontext(){cx.state.localVars=cx.state.context.vars;cx.state.context=cx.state.context.prev}function pushlex(type,info){var result=function(){var state=cx.state,indent=state.indented;if(state.lexical.type=="stat")indent=state.lexical.indented;else for(var outer=state.lexical;outer&&outer.type==")"&&outer.align;outer=outer.prev)indent=outer.indented;state.lexical=new JSLexical(indent,cx.stream.column(),type,null,state.lexical,info)};result.lex=true;return result}function poplex(){var state=cx.state;if(state.lexical.prev){if(state.lexical.type==")")state.indented=state.lexical.indented;state.lexical=state.lexical.prev}}poplex.lex=true;function expect(wanted){function exp(type){if(type==wanted)return cont();else if(wanted==";")return pass();else return cont(exp)}return exp}function statement(type,value){if(type=="var")return cont(pushlex("vardef",value.length),vardef,expect(";"),poplex);if(type=="keyword a")return cont(pushlex("form"),parenExpr,statement,poplex);if(type=="keyword b")return cont(pushlex("form"),statement,poplex);if(type=="{")return cont(pushlex("}"),block,poplex);if(type==";")return cont();if(type=="if"){if(cx.state.lexical.info=="else"&&cx.state.cc[cx.state.cc.length-1]==poplex)cx.state.cc.pop()();return cont(pushlex("form"),parenExpr,statement,poplex,maybeelse)}if(type=="function")return cont(functiondef);if(type=="for")return cont(pushlex("form"),forspec,statement,poplex);if(type=="variable"){if(isTS&&value=="type"){cx.marked="keyword";return cont(typeexpr,expect("operator"),typeexpr,expect(";"))}if(isTS&&value=="declare"){cx.marked="keyword";return cont(statement)}else{return cont(pushlex("stat"),maybelabel)}}if(type=="switch")return cont(pushlex("form"),parenExpr,expect("{"),pushlex("}","switch"),block,poplex,poplex);if(type=="case")return cont(expression,expect(":"));if(type=="default")return cont(expect(":"));if(type=="catch")return cont(pushlex("form"),pushcontext,expect("("),funarg,expect(")"),statement,poplex,popcontext);if(type=="class")return cont(pushlex("form"),className,poplex);if(type=="export")return cont(pushlex("stat"),afterExport,poplex);if(type=="import")return cont(pushlex("stat"),afterImport,poplex);if(type=="module")return cont(pushlex("form"),pattern,expect("{"),pushlex("}"),block,poplex,poplex);if(type=="async")return cont(statement);if(value=="@")return cont(expression,statement);return pass(pushlex("stat"),expression,expect(";"),poplex)}function expression(type){return expressionInner(type,false)}function expressionNoComma(type){return expressionInner(type,true)}function parenExpr(type){if(type!="(")return pass();return cont(pushlex(")"),expression,expect(")"),poplex)}function expressionInner(type,noComma){if(cx.state.fatArrowAt==cx.stream.start){var body=noComma?arrowBodyNoComma:arrowBody;if(type=="(")return cont(pushcontext,pushlex(")"),commasep(pattern,")"),poplex,expect("=>"),body,popcontext);else if(type=="variable")return pass(pushcontext,pattern,expect("=>"),body,popcontext)}var maybeop=noComma?maybeoperatorNoComma:maybeoperatorComma;if(atomicTypes.hasOwnProperty(type))return cont(maybeop);if(type=="function")return cont(functiondef,maybeop);if(type=="class")return cont(pushlex("form"),classExpression,poplex);if(type=="keyword c"||type=="async")return cont(noComma?maybeexpressionNoComma:maybeexpression);if(type=="(")return cont(pushlex(")"),maybeexpression,expect(")"),poplex,maybeop);if(type=="operator"||type=="spread")return cont(noComma?expressionNoComma:expression);if(type=="[")return cont(pushlex("]"),arrayLiteral,poplex,maybeop);if(type=="{")return contCommasep(objprop,"}",null,maybeop);if(type=="quasi")return pass(quasi,maybeop);if(type=="new")return cont(maybeTarget(noComma));return cont()}function maybeexpression(type){if(type.match(/[;\}\)\],]/))return pass();return pass(expression)}function maybeexpressionNoComma(type){if(type.match(/[;\}\)\],]/))return pass();return pass(expressionNoComma)}function maybeoperatorComma(type,value){if(type==",")return cont(expression);return maybeoperatorNoComma(type,value,false)}function maybeoperatorNoComma(type,value,noComma){var me=noComma==false?maybeoperatorComma:maybeoperatorNoComma;var expr=noComma==false?expression:expressionNoComma;if(type=="=>")return cont(pushcontext,noComma?arrowBodyNoComma:arrowBody,popcontext);if(type=="operator"){if(/\+\+|--/.test(value)||isTS&&value=="!")return cont(me);if(value=="?")return cont(expression,expect(":"),expr);return cont(expr)}if(type=="quasi"){return pass(quasi,me)}if(type==";")return;if(type=="(")return contCommasep(expressionNoComma,")","call",me);if(type==".")return cont(property,me);if(type=="[")return cont(pushlex("]"),maybeexpression,expect("]"),poplex,me);if(isTS&&value=="as"){cx.marked="keyword";return cont(typeexpr,me)}}function quasi(type,value){if(type!="quasi")return pass();if(value.slice(value.length-2)!="${")return cont(quasi);return cont(expression,continueQuasi)}function continueQuasi(type){if(type=="}"){cx.marked="string-2";cx.state.tokenize=tokenQuasi;return cont(quasi)}}function arrowBody(type){findFatArrow(cx.stream,cx.state);return pass(type=="{"?statement:expression)}function arrowBodyNoComma(type){findFatArrow(cx.stream,cx.state);return pass(type=="{"?statement:expressionNoComma)}function maybeTarget(noComma){return function(type){if(type==".")return cont(noComma?targetNoComma:target);else if(type=="variable"&&isTS)return cont(maybeTypeArgs,noComma?maybeoperatorNoComma:maybeoperatorComma);else return pass(noComma?expressionNoComma:expression)}}function target(_,value){if(value=="target"){cx.marked="keyword";return cont(maybeoperatorComma)}}function targetNoComma(_,value){if(value=="target"){cx.marked="keyword";return cont(maybeoperatorNoComma)}}function maybelabel(type){if(type==":")return cont(poplex,statement);return pass(maybeoperatorComma,expect(";"),poplex)}function property(type){if(type=="variable"){cx.marked="property";return cont()}}function objprop(type,value){if(type=="async"){cx.marked="property";return cont(objprop)}else if(type=="variable"||cx.style=="keyword"){cx.marked="property";if(value=="get"||value=="set")return cont(getterSetter);return cont(afterprop)}else if(type=="number"||type=="string"){cx.marked=jsonldMode?"property":cx.style+" property";return cont(afterprop)}else if(type=="jsonld-keyword"){return cont(afterprop)}else if(type=="modifier"){return cont(objprop)}else if(type=="["){return cont(expression,expect("]"),afterprop)}else if(type=="spread"){return cont(expression,afterprop)}else if(type==":"){return pass(afterprop)}}function getterSetter(type){if(type!="variable")return pass(afterprop);cx.marked="property";return cont(functiondef)}function afterprop(type){if(type==":")return cont(expressionNoComma);if(type=="(")return pass(functiondef)}function commasep(what,end,sep){function proceed(type,value){if(sep?sep.indexOf(type)>-1:type==","){var lex=cx.state.lexical;if(lex.info=="call")lex.pos=(lex.pos||0)+1;return cont(function(type,value){if(type==end||value==end)return pass();return pass(what)},proceed)}if(type==end||value==end)return cont();return cont(expect(end))}return function(type,value){if(type==end||value==end)return cont();return pass(what,proceed)}}function contCommasep(what,end,info){for(var i=3;i<arguments.length;i++)cx.cc.push(arguments[i]);return cont(pushlex(end,info),commasep(what,end),poplex)}function block(type){if(type=="}")return cont();return pass(statement,block)}function maybetype(type,value){if(isTS){if(type==":")return cont(typeexpr);if(value=="?")return cont(maybetype)}}function typeexpr(type,value){if(type=="variable"){if(value=="keyof"){cx.marked="keyword";return cont(typeexpr)}else{cx.marked="type";return cont(afterType)}}if(type=="string"||type=="number"||type=="atom")return cont(afterType);if(type=="[")return cont(pushlex("]"),commasep(typeexpr,"]",","),poplex,afterType);if(type=="{")return cont(pushlex("}"),commasep(typeprop,"}",",;"),poplex,afterType);if(type=="(")return cont(commasep(typearg,")"),maybeReturnType)}function maybeReturnType(type){if(type=="=>")return cont(typeexpr)}function typeprop(type,value){if(type=="variable"||cx.style=="keyword"){cx.marked="property";return cont(typeprop)}else if(value=="?"){return cont(typeprop)}else if(type==":"){return cont(typeexpr)}else if(type=="["){return cont(expression,maybetype,expect("]"),typeprop)}}function typearg(type){if(type=="variable")return cont(typearg);else if(type==":")return cont(typeexpr)}function afterType(type,value){if(value=="<")return cont(pushlex(">"),commasep(typeexpr,">"),poplex,afterType);if(value=="|"||type==".")return cont(typeexpr);if(type=="[")return cont(expect("]"),afterType);if(value=="extends")return cont(typeexpr)}function maybeTypeArgs(_,value){if(value=="<")return cont(pushlex(">"),commasep(typeexpr,">"),poplex,afterType)}function vardef(){return pass(pattern,maybetype,maybeAssign,vardefCont)}function pattern(type,value){if(type=="modifier")return cont(pattern);if(type=="variable"){register(value);return cont()}if(type=="spread")return cont(pattern);if(type=="[")return contCommasep(pattern,"]");if(type=="{")return contCommasep(proppattern,"}")}function proppattern(type,value){if(type=="variable"&&!cx.stream.match(/^\s*:/,false)){register(value);return cont(maybeAssign)}if(type=="variable")cx.marked="property";if(type=="spread")return cont(pattern);if(type=="}")return pass();return cont(expect(":"),pattern,maybeAssign)}function maybeAssign(_type,value){if(value=="=")return cont(expressionNoComma)}function vardefCont(type){if(type==",")return cont(vardef)}function maybeelse(type,value){if(type=="keyword b"&&value=="else")return cont(pushlex("form","else"),statement,poplex)}function forspec(type){if(type=="(")return cont(pushlex(")"),forspec1,expect(")"),poplex)}function forspec1(type){if(type=="var")return cont(vardef,expect(";"),forspec2);if(type==";")return cont(forspec2);if(type=="variable")return cont(formaybeinof);return pass(expression,expect(";"),forspec2)}function formaybeinof(_type,value){if(value=="in"||value=="of"){cx.marked="keyword";return cont(expression)}return cont(maybeoperatorComma,forspec2)}function forspec2(type,value){if(type==";")return cont(forspec3);if(value=="in"||value=="of"){cx.marked="keyword";return cont(expression)}return pass(expression,expect(";"),forspec3)}function forspec3(type){if(type!=")")cont(expression)}function functiondef(type,value){if(value=="*"){cx.marked="keyword";return cont(functiondef)}if(type=="variable"){register(value);return cont(functiondef)}if(type=="(")return cont(pushcontext,pushlex(")"),commasep(funarg,")"),poplex,maybetype,statement,popcontext);if(isTS&&value=="<")return cont(pushlex(">"),commasep(typeexpr,">"),poplex,functiondef)}function funarg(type){if(type=="spread"||type=="modifier")return cont(funarg);return pass(pattern,maybetype,maybeAssign)}function classExpression(type,value){if(type=="variable")return className(type,value);return classNameAfter(type,value)}function className(type,value){if(type=="variable"){register(value);return cont(classNameAfter)}}function classNameAfter(type,value){if(value=="<")return cont(pushlex(">"),commasep(typeexpr,">"),poplex,classNameAfter);if(value=="extends"||value=="implements"||isTS&&type==",")return cont(isTS?typeexpr:expression,classNameAfter);if(type=="{")return cont(pushlex("}"),classBody,poplex)}function classBody(type,value){if(type=="modifier"||type=="async"||type=="variable"&&(value=="static"||value=="get"||value=="set")&&cx.stream.match(/^\s+[\w$\xa1-\uffff]/,false)){cx.marked="keyword";return cont(classBody)}if(type=="variable"){cx.marked="property";return cont(isTS?classfield:functiondef,classBody)}if(type=="[")return cont(expression,expect("]"),isTS?classfield:functiondef,classBody);if(value=="*"){cx.marked="keyword";return cont(classBody)}if(type==";")return cont(classBody);if(type=="}")return cont();if(value=="@")return cont(expression,classBody)}function classfield(type,value){if(value=="?")return cont(classfield);if(type==":")return cont(typeexpr,maybeAssign);if(value=="=")return cont(expressionNoComma);return pass(functiondef)}function afterExport(type,value){if(value=="*"){cx.marked="keyword";return cont(maybeFrom,expect(";"))}if(value=="default"){cx.marked="keyword";return cont(expression,expect(";"))}if(type=="{")return cont(commasep(exportField,"}"),maybeFrom,expect(";"));return pass(statement)}function exportField(type,value){if(value=="as"){cx.marked="keyword";return cont(expect("variable"))}if(type=="variable")return pass(expressionNoComma,exportField)}function afterImport(type){if(type=="string")return cont();return pass(importSpec,maybeMoreImports,maybeFrom)}function importSpec(type,value){if(type=="{")return contCommasep(importSpec,"}");if(type=="variable")register(value);if(value=="*")cx.marked="keyword";return cont(maybeAs)}function maybeMoreImports(type){if(type==",")return cont(importSpec,maybeMoreImports)}function maybeAs(_type,value){if(value=="as"){cx.marked="keyword";return cont(importSpec)}}function maybeFrom(_type,value){if(value=="from"){cx.marked="keyword";return cont(expression)}}function arrayLiteral(type){if(type=="]")return cont();return pass(commasep(expressionNoComma,"]"))}function isContinuedStatement(state,textAfter){return state.lastType=="operator"||state.lastType==","||isOperatorChar.test(textAfter.charAt(0))||/[,.]/.test(textAfter.charAt(0))}function expressionAllowed(stream,state,backUp){return state.tokenize==tokenBase&&/^(?:operator|sof|keyword c|case|new|export|default|[\[{}\(,;:]|=>)$/.test(state.lastType)||state.lastType=="quasi"&&/\{\s*$/.test(stream.string.slice(0,stream.pos-(backUp||0)))}return{startState:function(basecolumn){var state={tokenize:tokenBase,lastType:"sof",cc:[],lexical:new JSLexical((basecolumn||0)-indentUnit,0,"block",false),localVars:parserConfig.localVars,context:parserConfig.localVars&&{vars:parserConfig.localVars},indented:basecolumn||0};if(parserConfig.globalVars&&typeof parserConfig.globalVars=="object")state.globalVars=parserConfig.globalVars;return state},token:function(stream,state){if(stream.sol()){if(!state.lexical.hasOwnProperty("align"))state.lexical.align=false;state.indented=stream.indentation();findFatArrow(stream,state)}if(state.tokenize!=tokenComment&&stream.eatSpace())return null;var style=state.tokenize(stream,state);if(type=="comment")return style;state.lastType=type=="operator"&&(content=="++"||content=="--")?"incdec":type;return parseJS(state,style,type,content,stream)},indent:function(state,textAfter){if(state.tokenize==tokenComment)return CodeMirror.Pass;if(state.tokenize!=tokenBase)return 0;var firstChar=textAfter&&textAfter.charAt(0),lexical=state.lexical,top;if(!/^\s*else\b/.test(textAfter))for(var i=state.cc.length-1;i>=0;--i){var c=state.cc[i];if(c==poplex)lexical=lexical.prev;else if(c!=maybeelse)break}while((lexical.type=="stat"||lexical.type=="form")&&(firstChar=="}"||(top=state.cc[state.cc.length-1])&&(top==maybeoperatorComma||top==maybeoperatorNoComma)&&!/^[,\.=+\-*:?[\(]/.test(textAfter)))lexical=lexical.prev;if(statementIndent&&lexical.type==")"&&lexical.prev.type=="stat")lexical=lexical.prev;var type=lexical.type,closing=firstChar==type;if(type=="vardef")return lexical.indented+(state.lastType=="operator"||state.lastType==","?lexical.info+1:0);else if(type=="form"&&firstChar=="{")return lexical.indented;else if(type=="form")return lexical.indented+indentUnit;else if(type=="stat")return lexical.indented+(isContinuedStatement(state,textAfter)?statementIndent||indentUnit:0);else if(lexical.info=="switch"&&!closing&&parserConfig.doubleIndentSwitch!=false)return lexical.indented+(/^(?:case|default)\b/.test(textAfter)?indentUnit:2*indentUnit);else if(lexical.align)return lexical.column+(closing?0:1);else return lexical.indented+(closing?0:indentUnit)},electricInput:/^\s*(?:case .*?:|default:|\{|\})$/,blockCommentStart:jsonMode?null:"/*",blockCommentEnd:jsonMode?null:"*/",lineComment:jsonMode?null:"//",fold:"brace",closeBrackets:"()[]{}''\"\"``",helperType:jsonMode?"json":"javascript",jsonldMode:jsonldMode,jsonMode:jsonMode,expressionAllowed:expressionAllowed,skipExpression:function(state){var top=state.cc[state.cc.length-1];if(top==expression||top==expressionNoComma)state.cc.pop()}}});CodeMirror.registerHelper("wordChars","javascript",/[\w$]/);CodeMirror.defineMIME("text/javascript","javascript");CodeMirror.defineMIME("text/ecmascript","javascript");CodeMirror.defineMIME("application/javascript","javascript");CodeMirror.defineMIME("application/x-javascript","javascript");CodeMirror.defineMIME("application/ecmascript","javascript");CodeMirror.defineMIME("application/json",{name:"javascript",json:true});CodeMirror.defineMIME("application/x-json",{name:"javascript",json:true});CodeMirror.defineMIME("application/ld+json",{name:"javascript",jsonld:true});CodeMirror.defineMIME("text/typescript",{name:"javascript",typescript:true});CodeMirror.defineMIME("application/typescript",{name:"javascript",typescript:true})})},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){"use strict";function wordRegexp(words){return new RegExp("^(("+words.join(")|(")+"))\\b")}var wordOperators=wordRegexp(["and","or","not","is"]);var commonKeywords=["as","assert","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","lambda","pass","raise","return","try","while","with","yield","in"];var commonBuiltins=["abs","all","any","bin","bool","bytearray","callable","chr","classmethod","compile","complex","delattr","dict","dir","divmod","enumerate","eval","filter","float","format","frozenset","getattr","globals","hasattr","hash","help","hex","id","input","int","isinstance","issubclass","iter","len","list","locals","map","max","memoryview","min","next","object","oct","open","ord","pow","property","range","repr","reversed","round","set","setattr","slice","sorted","staticmethod","str","sum","super","tuple","type","vars","zip","__import__","NotImplemented","Ellipsis","__debug__"];CodeMirror.registerHelper("hintWords","python",commonKeywords.concat(commonBuiltins));function top(state){return state.scopes[state.scopes.length-1]}CodeMirror.defineMode("python",function(conf,parserConf){var ERRORCLASS="error";var delimiters=parserConf.delimiters||parserConf.singleDelimiters||/^[\(\)\[\]\{\}@,:`=;\.]/;var operators=[parserConf.singleOperators,parserConf.doubleOperators,parserConf.doubleDelimiters,parserConf.tripleDelimiters,parserConf.operators||/^([-+*/%\/&|^]=?|[<>=]+|\/\/=?|\*\*=?|!=|[~!@])/];for(var i=0;i<operators.length;i++)if(!operators[i])operators.splice(i--,1);var hangingIndent=parserConf.hangingIndent||conf.indentUnit;var myKeywords=commonKeywords,myBuiltins=commonBuiltins;if(parserConf.extra_keywords!=undefined)myKeywords=myKeywords.concat(parserConf.extra_keywords);if(parserConf.extra_builtins!=undefined)myBuiltins=myBuiltins.concat(parserConf.extra_builtins);var py3=!(parserConf.version&&Number(parserConf.version)<3);if(py3){var identifiers=parserConf.identifiers||/^[_A-Za-z\u00A1-\uFFFF][_A-Za-z0-9\u00A1-\uFFFF]*/;myKeywords=myKeywords.concat(["nonlocal","False","True","None","async","await"]);myBuiltins=myBuiltins.concat(["ascii","bytes","exec","print"]);var stringPrefixes=new RegExp("^(([rbuf]|(br))?('{3}|\"{3}|['\"]))","i")}else{var identifiers=parserConf.identifiers||/^[_A-Za-z][_A-Za-z0-9]*/;myKeywords=myKeywords.concat(["exec","print"]);myBuiltins=myBuiltins.concat(["apply","basestring","buffer","cmp","coerce","execfile","file","intern","long","raw_input","reduce","reload","unichr","unicode","xrange","False","True","None"]);var stringPrefixes=new RegExp("^(([rubf]|(ur)|(br))?('{3}|\"{3}|['\"]))","i")}var keywords=wordRegexp(myKeywords);var builtins=wordRegexp(myBuiltins);function tokenBase(stream,state){if(stream.sol())state.indent=stream.indentation();if(stream.sol()&&top(state).type=="py"){var scopeOffset=top(state).offset;if(stream.eatSpace()){var lineOffset=stream.indentation();if(lineOffset>scopeOffset)pushPyScope(state);else if(lineOffset<scopeOffset&&dedent(stream,state)&&stream.peek()!="#")state.errorToken=true;return null}else{var style=tokenBaseInner(stream,state);if(scopeOffset>0&&dedent(stream,state))style+=" "+ERRORCLASS;return style}}return tokenBaseInner(stream,state)}function tokenBaseInner(stream,state){if(stream.eatSpace())return null;var ch=stream.peek();if(ch=="#"){stream.skipToEnd();return"comment"}if(stream.match(/^[0-9\.]/,false)){var floatLiteral=false;if(stream.match(/^[\d_]*\.\d+(e[\+\-]?\d+)?/i)){floatLiteral=true}if(stream.match(/^[\d_]+\.\d*/)){floatLiteral=true}if(stream.match(/^\.\d+/)){floatLiteral=true}if(floatLiteral){stream.eat(/J/i);return"number"}var intLiteral=false;if(stream.match(/^0x[0-9a-f_]+/i))intLiteral=true;if(stream.match(/^0b[01_]+/i))intLiteral=true;if(stream.match(/^0o[0-7_]+/i))intLiteral=true;if(stream.match(/^[1-9][\d_]*(e[\+\-]?[\d_]+)?/)){stream.eat(/J/i);intLiteral=true}if(stream.match(/^0(?![\dx])/i))intLiteral=true;if(intLiteral){stream.eat(/L/i);return"number"}}if(stream.match(stringPrefixes)){state.tokenize=tokenStringFactory(stream.current());return state.tokenize(stream,state)}for(var i=0;i<operators.length;i++)if(stream.match(operators[i]))return"operator";if(stream.match(delimiters))return"punctuation";if(state.lastToken=="."&&stream.match(identifiers))return"property";if(stream.match(keywords)||stream.match(wordOperators))return"keyword";if(stream.match(builtins))return"builtin";if(stream.match(/^(self|cls)\b/))return"variable-2";if(stream.match(identifiers)){if(state.lastToken=="def"||state.lastToken=="class")return"def";return"variable"}stream.next();return ERRORCLASS}function tokenStringFactory(delimiter){while("rubf".indexOf(delimiter.charAt(0).toLowerCase())>=0)delimiter=delimiter.substr(1);var singleline=delimiter.length==1;var OUTCLASS="string";function tokenString(stream,state){while(!stream.eol()){stream.eatWhile(/[^'"\\]/);if(stream.eat("\\")){stream.next();if(singleline&&stream.eol())return OUTCLASS}else if(stream.match(delimiter)){state.tokenize=tokenBase;return OUTCLASS}else{stream.eat(/['"]/)}}if(singleline){if(parserConf.singleLineStringErrors)return ERRORCLASS;else state.tokenize=tokenBase}return OUTCLASS}tokenString.isString=true;return tokenString}function pushPyScope(state){while(top(state).type!="py")state.scopes.pop();state.scopes.push({offset:top(state).offset+conf.indentUnit,type:"py",align:null})}function pushBracketScope(stream,state,type){var align=stream.match(/^([\s\[\{\(]|#.*)*$/,false)?null:stream.column()+1;state.scopes.push({offset:state.indent+hangingIndent,type:type,align:align})}function dedent(stream,state){var indented=stream.indentation();while(state.scopes.length>1&&top(state).offset>indented){if(top(state).type!="py")return true;state.scopes.pop()}return top(state).offset!=indented}function tokenLexer(stream,state){if(stream.sol())state.beginningOfLine=true;var style=state.tokenize(stream,state);var current=stream.current();if(state.beginningOfLine&&current=="@")return stream.match(identifiers,false)?"meta":py3?"operator":ERRORCLASS;if(/\S/.test(current))state.beginningOfLine=false;if((style=="variable"||style=="builtin")&&state.lastToken=="meta")style="meta";if(current=="pass"||current=="return")state.dedent+=1;if(current=="lambda")state.lambda=true;if(current==":"&&!state.lambda&&top(state).type=="py")pushPyScope(state);var delimiter_index=current.length==1?"[({".indexOf(current):-1;if(delimiter_index!=-1)pushBracketScope(stream,state,"])}".slice(delimiter_index,delimiter_index+1));delimiter_index="])}".indexOf(current);if(delimiter_index!=-1){if(top(state).type==current)state.indent=state.scopes.pop().offset-hangingIndent;else return ERRORCLASS}if(state.dedent>0&&stream.eol()&&top(state).type=="py"){if(state.scopes.length>1)state.scopes.pop();state.dedent-=1}return style}var external={startState:function(basecolumn){return{tokenize:tokenBase,scopes:[{offset:basecolumn||0,type:"py",align:null}],indent:basecolumn||0,lastToken:null,lambda:false,dedent:0}},token:function(stream,state){var addErr=state.errorToken;if(addErr)state.errorToken=false;var style=tokenLexer(stream,state);if(style&&style!="comment")state.lastToken=style=="keyword"||style=="punctuation"?stream.current():style;if(style=="punctuation")style=null;if(stream.eol()&&state.lambda)state.lambda=false;return addErr?style+" "+ERRORCLASS:style},indent:function(state,textAfter){if(state.tokenize!=tokenBase)return state.tokenize.isString?CodeMirror.Pass:0;var scope=top(state),closing=scope.type==textAfter.charAt(0);if(scope.align!=null)return scope.align-(closing?1:0);else return scope.offset-(closing?hangingIndent:0)},electricInput:/^\s*[\}\]\)]$/,closeBrackets:{triples:"'\""},lineComment:"#",fold:"indent"};return external});CodeMirror.defineMIME("text/x-python","python");var words=function(str){return str.split(" ")};CodeMirror.defineMIME("text/x-cython",{name:"python",extra_keywords:words("by cdef cimport cpdef ctypedef enum except "+"extern gil include nogil property public "+"readonly struct union DEF IF ELIF ELSE")})})},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){var defaults={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"};var Pos=CodeMirror.Pos;CodeMirror.defineOption("autoCloseBrackets",false,function(cm,val,old){if(old&&old!=CodeMirror.Init){cm.removeKeyMap(keyMap);cm.state.closeBrackets=null}if(val){cm.state.closeBrackets=val;cm.addKeyMap(keyMap)}});function getOption(conf,name){if(name=="pairs"&&typeof conf=="string")return conf;if(typeof conf=="object"&&conf[name]!=null)return conf[name];return defaults[name]}var bind=defaults.pairs+"`";var keyMap={Backspace:handleBackspace,Enter:handleEnter};for(var i=0;i<bind.length;i++)keyMap["'"+bind.charAt(i)+"'"]=handler(bind.charAt(i));function handler(ch){return function(cm){return handleChar(cm,ch)}}function getConfig(cm){var deflt=cm.state.closeBrackets;if(!deflt||deflt.override)return deflt;var mode=cm.getModeAt(cm.getCursor());return mode.closeBrackets||deflt}function handleBackspace(cm){var conf=getConfig(cm);if(!conf||cm.getOption("disableInput"))return CodeMirror.Pass;var pairs=getOption(conf,"pairs");var ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){if(!ranges[i].empty())return CodeMirror.Pass;var around=charsAround(cm,ranges[i].head);if(!around||pairs.indexOf(around)%2!=0)return CodeMirror.Pass}for(var i=ranges.length-1;i>=0;i--){var cur=ranges[i].head;cm.replaceRange("",Pos(cur.line,cur.ch-1),Pos(cur.line,cur.ch+1),"+delete")}}function handleEnter(cm){var conf=getConfig(cm);var explode=conf&&getOption(conf,"explode");if(!explode||cm.getOption("disableInput"))return CodeMirror.Pass;var ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){if(!ranges[i].empty())return CodeMirror.Pass;var around=charsAround(cm,ranges[i].head);if(!around||explode.indexOf(around)%2!=0)return CodeMirror.Pass}cm.operation(function(){cm.replaceSelection("\n\n",null);cm.execCommand("goCharLeft");ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var line=ranges[i].head.line;cm.indentLine(line,null,true);cm.indentLine(line+1,null,true)}})}function contractSelection(sel){var inverted=CodeMirror.cmpPos(sel.anchor,sel.head)>0;return{anchor:new Pos(sel.anchor.line,sel.anchor.ch+(inverted?-1:1)),head:new Pos(sel.head.line,sel.head.ch+(inverted?1:-1))}}function handleChar(cm,ch){var conf=getConfig(cm);if(!conf||cm.getOption("disableInput"))return CodeMirror.Pass;var pairs=getOption(conf,"pairs");var pos=pairs.indexOf(ch);if(pos==-1)return CodeMirror.Pass;var triples=getOption(conf,"triples");var identical=pairs.charAt(pos+1)==ch;var ranges=cm.listSelections();var opening=pos%2==0;var type;for(var i=0;i<ranges.length;i++){var range=ranges[i],cur=range.head,curType;var next=cm.getRange(cur,Pos(cur.line,cur.ch+1));if(opening&&!range.empty()){curType="surround"}else if((identical||!opening)&&next==ch){if(identical&&stringStartsAfter(cm,cur))curType="both";else if(triples.indexOf(ch)>=0&&cm.getRange(cur,Pos(cur.line,cur.ch+3))==ch+ch+ch)curType="skipThree";else curType="skip"}else if(identical&&cur.ch>1&&triples.indexOf(ch)>=0&&cm.getRange(Pos(cur.line,cur.ch-2),cur)==ch+ch&&(cur.ch<=2||cm.getRange(Pos(cur.line,cur.ch-3),Pos(cur.line,cur.ch-2))!=ch)){curType="addFour"}else if(identical){if(!CodeMirror.isWordChar(next)&&enteringString(cm,cur,ch))curType="both";else return CodeMirror.Pass}else if(opening&&(cm.getLine(cur.line).length==cur.ch||isClosingBracket(next,pairs)||/\s/.test(next))){curType="both"}else{return CodeMirror.Pass}if(!type)type=curType;else if(type!=curType)return CodeMirror.Pass}var left=pos%2?pairs.charAt(pos-1):ch;var right=pos%2?ch:pairs.charAt(pos+1);cm.operation(function(){if(type=="skip"){cm.execCommand("goCharRight")}else if(type=="skipThree"){for(var i=0;i<3;i++)cm.execCommand("goCharRight")}else if(type=="surround"){var sels=cm.getSelections();for(var i=0;i<sels.length;i++)sels[i]=left+sels[i]+right;cm.replaceSelections(sels,"around");sels=cm.listSelections().slice();for(var i=0;i<sels.length;i++)sels[i]=contractSelection(sels[i]);cm.setSelections(sels)}else if(type=="both"){cm.replaceSelection(left+right,null);cm.triggerElectric(left+right);cm.execCommand("goCharLeft")}else if(type=="addFour"){cm.replaceSelection(left+left+left+left,"before");cm.execCommand("goCharRight")}})}function isClosingBracket(ch,pairs){var pos=pairs.lastIndexOf(ch);return pos>-1&&pos%2==1}function charsAround(cm,pos){var str=cm.getRange(Pos(pos.line,pos.ch-1),Pos(pos.line,pos.ch+1));return str.length==2?str:null}function enteringString(cm,pos,ch){var line=cm.getLine(pos.line);var token=cm.getTokenAt(pos);if(/\bstring2?\b/.test(token.type)||stringStartsAfter(cm,pos))return false;var stream=new CodeMirror.StringStream(line.slice(0,pos.ch)+ch+line.slice(pos.ch),4);stream.pos=stream.start=token.start;for(;;){var type1=cm.getMode().token(stream,token.state);if(stream.pos>=pos.ch+1)return/\bstring2?\b/.test(type1);stream.start=stream.pos}}function stringStartsAfter(cm,pos){var token=cm.getTokenAt(Pos(pos.line,pos.ch+1));return/\bstring/.test(token.type)&&token.start==pos.ch}})},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){"use strict";CodeMirror.registerHelper("fold","brace",function(cm,start){var line=start.line,lineText=cm.getLine(line);var tokenType;function findOpening(openCh){for(var at=start.ch,pass=0;;){var found=at<=0?-1:lineText.lastIndexOf(openCh,at-1);if(found==-1){if(pass==1)break;pass=1;at=lineText.length;continue}if(pass==1&&found<start.ch)break;tokenType=cm.getTokenTypeAt(CodeMirror.Pos(line,found+1));if(!/^(comment|string)/.test(tokenType))return found+1;at=found-1}}var startToken="{",endToken="}",startCh=findOpening("{");if(startCh==null){startToken="[",endToken="]";startCh=findOpening("[")}if(startCh==null)return;var count=1,lastLine=cm.lastLine(),end,endCh;outer:for(var i=line;i<=lastLine;++i){var text=cm.getLine(i),pos=i==line?startCh:0;for(;;){var nextOpen=text.indexOf(startToken,pos),nextClose=text.indexOf(endToken,pos);if(nextOpen<0)nextOpen=text.length;if(nextClose<0)nextClose=text.length;pos=Math.min(nextOpen,nextClose);if(pos==text.length)break;if(cm.getTokenTypeAt(CodeMirror.Pos(i,pos+1))==tokenType){if(pos==nextOpen)++count;else if(!--count){end=i;endCh=pos;break outer}}++pos}}if(end==null||line==end&&endCh==startCh)return;return{from:CodeMirror.Pos(line,startCh),to:CodeMirror.Pos(end,endCh)}});CodeMirror.registerHelper("fold","import",function(cm,start){function hasImport(line){if(line<cm.firstLine()||line>cm.lastLine())return null;var start=cm.getTokenAt(CodeMirror.Pos(line,1));if(!/\S/.test(start.string))start=cm.getTokenAt(CodeMirror.Pos(line,start.end+1));if(start.type!="keyword"||start.string!="import")return null;for(var i=line,e=Math.min(cm.lastLine(),line+10);i<=e;++i){var text=cm.getLine(i),semi=text.indexOf(";");if(semi!=-1)return{startCh:start.end,end:CodeMirror.Pos(i,semi)}}}var startLine=start.line,has=hasImport(startLine),prev;if(!has||hasImport(startLine-1)||(prev=hasImport(startLine-2))&&prev.end.line==startLine-1)return null;for(var end=has.end;;){var next=hasImport(end.line+1);if(next==null)break;end=next.end}return{from:cm.clipPos(CodeMirror.Pos(startLine,has.startCh+1)),to:end}});CodeMirror.registerHelper("fold","include",function(cm,start){function hasInclude(line){if(line<cm.firstLine()||line>cm.lastLine())return null;var start=cm.getTokenAt(CodeMirror.Pos(line,1));if(!/\S/.test(start.string))start=cm.getTokenAt(CodeMirror.Pos(line,start.end+1));if(start.type=="meta"&&start.string.slice(0,8)=="#include")return start.start+8}var startLine=start.line,has=hasInclude(startLine);if(has==null||hasInclude(startLine-1)!=null)return null;for(var end=startLine;;){var next=hasInclude(end+1);if(next==null)break;++end}return{from:CodeMirror.Pos(startLine,has+1),to:cm.clipPos(CodeMirror.Pos(end))}})})},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11),__webpack_require__(233),__webpack_require__(107));else if(typeof define=="function"&&define.amd)define(["../lib/codemirror","../addon/search/searchcursor","../addon/edit/matchbrackets"],mod);else mod(CodeMirror)})(function(CodeMirror){"use strict";var map=CodeMirror.keyMap.sublime={fallthrough:"default"};var cmds=CodeMirror.commands;var Pos=CodeMirror.Pos;var mac=CodeMirror.keyMap["default"]==CodeMirror.keyMap.macDefault;var ctrl=mac?"Cmd-":"Ctrl-";function findPosSubword(doc,start,dir){if(dir<0&&start.ch==0)return doc.clipPos(Pos(start.line-1));var line=doc.getLine(start.line);if(dir>0&&start.ch>=line.length)return doc.clipPos(Pos(start.line+1,0));var state="start",type;for(var pos=start.ch,e=dir<0?0:line.length,i=0;pos!=e;pos+=dir,i++){var next=line.charAt(dir<0?pos-1:pos);var cat=next!="_"&&CodeMirror.isWordChar(next)?"w":"o";if(cat=="w"&&next.toUpperCase()==next)cat="W";if(state=="start"){if(cat!="o"){state="in";type=cat}}else if(state=="in"){if(type!=cat){if(type=="w"&&cat=="W"&&dir<0)pos--;if(type=="W"&&cat=="w"&&dir>0){type="w";continue}break}}}return Pos(start.line,pos)}function moveSubword(cm,dir){cm.extendSelectionsBy(function(range){if(cm.display.shift||cm.doc.extend||range.empty())return findPosSubword(cm.doc,range.head,dir);else return dir<0?range.from():range.to()})}var goSubwordCombo=mac?"Ctrl-":"Alt-";cmds[map[goSubwordCombo+"Left"]="goSubwordLeft"]=function(cm){moveSubword(cm,-1)};cmds[map[goSubwordCombo+"Right"]="goSubwordRight"]=function(cm){moveSubword(cm,1)};if(mac)map["Cmd-Left"]="goLineStartSmart";var scrollLineCombo=mac?"Ctrl-Alt-":"Ctrl-";cmds[map[scrollLineCombo+"Up"]="scrollLineUp"]=function(cm){var info=cm.getScrollInfo();if(!cm.somethingSelected()){var visibleBottomLine=cm.lineAtHeight(info.top+info.clientHeight,"local");if(cm.getCursor().line>=visibleBottomLine)cm.execCommand("goLineUp")}cm.scrollTo(null,info.top-cm.defaultTextHeight())};cmds[map[scrollLineCombo+"Down"]="scrollLineDown"]=function(cm){var info=cm.getScrollInfo();if(!cm.somethingSelected()){var visibleTopLine=cm.lineAtHeight(info.top,"local")+1;if(cm.getCursor().line<=visibleTopLine)cm.execCommand("goLineDown")}cm.scrollTo(null,info.top+cm.defaultTextHeight())};cmds[map["Shift-"+ctrl+"L"]="splitSelectionByLine"]=function(cm){var ranges=cm.listSelections(),lineRanges=[];for(var i=0;i<ranges.length;i++){var from=ranges[i].from(),to=ranges[i].to();for(var line=from.line;line<=to.line;++line)if(!(to.line>from.line&&line==to.line&&to.ch==0))lineRanges.push({anchor:line==from.line?from:Pos(line,0),head:line==to.line?to:Pos(line)})}cm.setSelections(lineRanges,0)};map["Shift-Tab"]="indentLess";cmds[map["Esc"]="singleSelectionTop"]=function(cm){var range=cm.listSelections()[0];cm.setSelection(range.anchor,range.head,{scroll:false})};cmds[map[ctrl+"L"]="selectLine"]=function(cm){var ranges=cm.listSelections(),extended=[];for(var i=0;i<ranges.length;i++){var range=ranges[i];extended.push({anchor:Pos(range.from().line,0),head:Pos(range.to().line+1,0)})}cm.setSelections(extended)};map["Shift-Ctrl-K"]="deleteLine";function insertLine(cm,above){if(cm.isReadOnly())return CodeMirror.Pass;cm.operation(function(){var len=cm.listSelections().length,newSelection=[],last=-1;for(var i=0;i<len;i++){var head=cm.listSelections()[i].head;if(head.line<=last)continue;var at=Pos(head.line+(above?0:1),0);cm.replaceRange("\n",at,null,"+insertLine");cm.indentLine(at.line,null,true);newSelection.push({head:at,anchor:at});last=head.line+1}cm.setSelections(newSelection)});cm.execCommand("indentAuto")}cmds[map[ctrl+"Enter"]="insertLineAfter"]=function(cm){return insertLine(cm,false)};cmds[map["Shift-"+ctrl+"Enter"]="insertLineBefore"]=function(cm){return insertLine(cm,true)};function wordAt(cm,pos){var start=pos.ch,end=start,line=cm.getLine(pos.line);while(start&&CodeMirror.isWordChar(line.charAt(start-1)))--start;while(end<line.length&&CodeMirror.isWordChar(line.charAt(end)))++end;return{from:Pos(pos.line,start),to:Pos(pos.line,end),word:line.slice(start,end)}}cmds[map[ctrl+"D"]="selectNextOccurrence"]=function(cm){var from=cm.getCursor("from"),to=cm.getCursor("to");var fullWord=cm.state.sublimeFindFullWord==cm.doc.sel;if(CodeMirror.cmpPos(from,to)==0){var word=wordAt(cm,from);if(!word.word)return;cm.setSelection(word.from,word.to);fullWord=true}else{var text=cm.getRange(from,to);var query=fullWord?new RegExp("\\b"+text+"\\b"):text;var cur=cm.getSearchCursor(query,to);var found=cur.findNext();if(!found){cur=cm.getSearchCursor(query,Pos(cm.firstLine(),0));found=cur.findNext()}if(!found||isSelectedRange(cm.listSelections(),cur.from(),cur.to()))return CodeMirror.Pass;cm.addSelection(cur.from(),cur.to())}if(fullWord)cm.state.sublimeFindFullWord=cm.doc.sel};function addCursorToSelection(cm,dir){var ranges=cm.listSelections(),newRanges=[];for(var i=0;i<ranges.length;i++){var range=ranges[i];var newAnchor=cm.findPosV(range.anchor,dir,"line");var newHead=cm.findPosV(range.head,dir,"line");var newRange={anchor:newAnchor,head:newHead};newRanges.push(range);newRanges.push(newRange)}cm.setSelections(newRanges)}var addCursorToLineCombo=mac?"Shift-Cmd":"Alt-Ctrl";cmds[map[addCursorToLineCombo+"Up"]="addCursorToPrevLine"]=function(cm){addCursorToSelection(cm,-1)};cmds[map[addCursorToLineCombo+"Down"]="addCursorToNextLine"]=function(cm){addCursorToSelection(cm,1)};function isSelectedRange(ranges,from,to){for(var i=0;i<ranges.length;i++)if(ranges[i].from()==from&&ranges[i].to()==to)return true;return false}var mirror="(){}[]";function selectBetweenBrackets(cm){var ranges=cm.listSelections(),newRanges=[];for(var i=0;i<ranges.length;i++){var range=ranges[i],pos=range.head,opening=cm.scanForBracket(pos,-1);if(!opening)return false;for(;;){var closing=cm.scanForBracket(pos,1);if(!closing)return false;if(closing.ch==mirror.charAt(mirror.indexOf(opening.ch)+1)){newRanges.push({anchor:Pos(opening.pos.line,opening.pos.ch+1),head:closing.pos});break}pos=Pos(closing.pos.line,closing.pos.ch+1)}}cm.setSelections(newRanges);return true}cmds[map["Shift-"+ctrl+"Space"]="selectScope"]=function(cm){selectBetweenBrackets(cm)||cm.execCommand("selectAll")};cmds[map["Shift-"+ctrl+"M"]="selectBetweenBrackets"]=function(cm){if(!selectBetweenBrackets(cm))return CodeMirror.Pass};cmds[map[ctrl+"M"]="goToBracket"]=function(cm){cm.extendSelectionsBy(function(range){var next=cm.scanForBracket(range.head,1);if(next&&CodeMirror.cmpPos(next.pos,range.head)!=0)return next.pos;var prev=cm.scanForBracket(range.head,-1);return prev&&Pos(prev.pos.line,prev.pos.ch+1)||range.head})};var swapLineCombo=mac?"Cmd-Ctrl-":"Shift-Ctrl-";cmds[map[swapLineCombo+"Up"]="swapLineUp"]=function(cm){if(cm.isReadOnly())return CodeMirror.Pass;var ranges=cm.listSelections(),linesToMove=[],at=cm.firstLine()-1,newSels=[];for(var i=0;i<ranges.length;i++){var range=ranges[i],from=range.from().line-1,to=range.to().line;newSels.push({anchor:Pos(range.anchor.line-1,range.anchor.ch),head:Pos(range.head.line-1,range.head.ch)});if(range.to().ch==0&&!range.empty())--to;if(from>at)linesToMove.push(from,to);else if(linesToMove.length)linesToMove[linesToMove.length-1]=to;at=to}cm.operation(function(){for(var i=0;i<linesToMove.length;i+=2){var from=linesToMove[i],to=linesToMove[i+1];var line=cm.getLine(from);cm.replaceRange("",Pos(from,0),Pos(from+1,0),"+swapLine");if(to>cm.lastLine())cm.replaceRange("\n"+line,Pos(cm.lastLine()),null,"+swapLine");else cm.replaceRange(line+"\n",Pos(to,0),null,"+swapLine")}cm.setSelections(newSels);cm.scrollIntoView()})};cmds[map[swapLineCombo+"Down"]="swapLineDown"]=function(cm){if(cm.isReadOnly())return CodeMirror.Pass;var ranges=cm.listSelections(),linesToMove=[],at=cm.lastLine()+1;for(var i=ranges.length-1;i>=0;i--){var range=ranges[i],from=range.to().line+1,to=range.from().line;if(range.to().ch==0&&!range.empty())from--;if(from<at)linesToMove.push(from,to);else if(linesToMove.length)linesToMove[linesToMove.length-1]=to;at=to}cm.operation(function(){for(var i=linesToMove.length-2;i>=0;i-=2){var from=linesToMove[i],to=linesToMove[i+1];var line=cm.getLine(from);if(from==cm.lastLine())cm.replaceRange("",Pos(from-1),Pos(from),"+swapLine");else cm.replaceRange("",Pos(from,0),Pos(from+1,0),"+swapLine");cm.replaceRange(line+"\n",Pos(to,0),null,"+swapLine")}cm.scrollIntoView()})};cmds[map[ctrl+"/"]="toggleCommentIndented"]=function(cm){cm.toggleComment({indent:true})};cmds[map[ctrl+"J"]="joinLines"]=function(cm){var ranges=cm.listSelections(),joined=[];for(var i=0;i<ranges.length;i++){var range=ranges[i],from=range.from();var start=from.line,end=range.to().line;while(i<ranges.length-1&&ranges[i+1].from().line==end)end=ranges[++i].to().line;joined.push({start:start,end:end,anchor:!range.empty()&&from})}cm.operation(function(){var offset=0,ranges=[];for(var i=0;i<joined.length;i++){var obj=joined[i];var anchor=obj.anchor&&Pos(obj.anchor.line-offset,obj.anchor.ch),head;for(var line=obj.start;line<=obj.end;line++){var actual=line-offset;if(line==obj.end)head=Pos(actual,cm.getLine(actual).length+1);if(actual<cm.lastLine()){cm.replaceRange(" ",Pos(actual),Pos(actual+1,/^\s*/.exec(cm.getLine(actual+1))[0].length));++offset}}ranges.push({anchor:anchor||head,head:head})}cm.setSelections(ranges,0)})};cmds[map["Shift-"+ctrl+"D"]="duplicateLine"]=function(cm){cm.operation(function(){var rangeCount=cm.listSelections().length;for(var i=0;i<rangeCount;i++){var range=cm.listSelections()[i];if(range.empty())cm.replaceRange(cm.getLine(range.head.line)+"\n",Pos(range.head.line,0));else cm.replaceRange(cm.getRange(range.from(),range.to()),range.from())}cm.scrollIntoView()})};if(!mac)map[ctrl+"T"]="transposeChars";function sortLines(cm,caseSensitive){if(cm.isReadOnly())return CodeMirror.Pass;var ranges=cm.listSelections(),toSort=[],selected;for(var i=0;i<ranges.length;i++){var range=ranges[i];if(range.empty())continue;var from=range.from().line,to=range.to().line;while(i<ranges.length-1&&ranges[i+1].from().line==to)to=ranges[++i].to().line;if(!ranges[i].to().ch)to--;toSort.push(from,to)}if(toSort.length)selected=true;else toSort.push(cm.firstLine(),cm.lastLine());cm.operation(function(){var ranges=[];for(var i=0;i<toSort.length;i+=2){var from=toSort[i],to=toSort[i+1];var start=Pos(from,0),end=Pos(to);var lines=cm.getRange(start,end,false);if(caseSensitive)lines.sort();else lines.sort(function(a,b){var au=a.toUpperCase(),bu=b.toUpperCase();if(au!=bu){a=au;b=bu}return a<b?-1:a==b?0:1});cm.replaceRange(lines,start,end);if(selected)ranges.push({anchor:start,head:Pos(to+1,0)})}if(selected)cm.setSelections(ranges,0)})}cmds[map["F9"]="sortLines"]=function(cm){sortLines(cm,true)};cmds[map[ctrl+"F9"]="sortLinesInsensitive"]=function(cm){sortLines(cm,false)};cmds[map["F2"]="nextBookmark"]=function(cm){var marks=cm.state.sublimeBookmarks;if(marks)while(marks.length){var current=marks.shift();var found=current.find();if(found){marks.push(current);return cm.setSelection(found.from,found.to)}}};cmds[map["Shift-F2"]="prevBookmark"]=function(cm){var marks=cm.state.sublimeBookmarks;if(marks)while(marks.length){marks.unshift(marks.pop());var found=marks[marks.length-1].find();if(!found)marks.pop();else return cm.setSelection(found.from,found.to)}};cmds[map[ctrl+"F2"]="toggleBookmark"]=function(cm){var ranges=cm.listSelections();var marks=cm.state.sublimeBookmarks||(cm.state.sublimeBookmarks=[]);for(var i=0;i<ranges.length;i++){var from=ranges[i].from(),to=ranges[i].to();var found=cm.findMarks(from,to);for(var j=0;j<found.length;j++){if(found[j].sublimeBookmark){found[j].clear();for(var k=0;k<marks.length;k++)if(marks[k]==found[j])marks.splice(k--,1);break}}if(j==found.length)marks.push(cm.markText(from,to,{sublimeBookmark:true,clearWhenEmpty:false}))}};cmds[map["Shift-"+ctrl+"F2"]="clearBookmarks"]=function(cm){var marks=cm.state.sublimeBookmarks;if(marks)for(var i=0;i<marks.length;i++)marks[i].clear();marks.length=0};cmds[map["Alt-F2"]="selectBookmarks"]=function(cm){var marks=cm.state.sublimeBookmarks,ranges=[];if(marks)for(var i=0;i<marks.length;i++){var found=marks[i].find();if(!found)marks.splice(i--,0);else ranges.push({anchor:found.from,head:found.to})}if(ranges.length)cm.setSelections(ranges,0)};map["Alt-Q"]="wrapLines";var cK=ctrl+"K ";function modifyWordOrSelection(cm,mod){cm.operation(function(){var ranges=cm.listSelections(),indices=[],replacements=[];for(var i=0;i<ranges.length;i++){var range=ranges[i];if(range.empty()){indices.push(i);replacements.push("")}else replacements.push(mod(cm.getRange(range.from(),range.to())))}cm.replaceSelections(replacements,"around","case");for(var i=indices.length-1,at;i>=0;i--){var range=ranges[indices[i]];if(at&&CodeMirror.cmpPos(range.head,at)>0)continue;var word=wordAt(cm,range.head);at=word.from;cm.replaceRange(mod(word.word),word.from,word.to)}})}map[cK+ctrl+"Backspace"]="delLineLeft";cmds[map["Backspace"]="smartBackspace"]=function(cm){if(cm.somethingSelected())return CodeMirror.Pass;cm.operation(function(){var cursors=cm.listSelections();var indentUnit=cm.getOption("indentUnit");for(var i=cursors.length-1;i>=0;i--){var cursor=cursors[i].head;var toStartOfLine=cm.getRange({line:cursor.line,ch:0},cursor);var column=CodeMirror.countColumn(toStartOfLine,null,cm.getOption("tabSize"));var deletePos=cm.findPosH(cursor,-1,"char",false);if(toStartOfLine&&!/\S/.test(toStartOfLine)&&column%indentUnit==0){var prevIndent=new Pos(cursor.line,CodeMirror.findColumn(toStartOfLine,column-indentUnit,indentUnit));if(prevIndent.ch!=cursor.ch)deletePos=prevIndent}cm.replaceRange("",deletePos,cursor,"+delete")}})};cmds[map[cK+ctrl+"K"]="delLineRight"]=function(cm){cm.operation(function(){var ranges=cm.listSelections();for(var i=ranges.length-1;i>=0;i--)cm.replaceRange("",ranges[i].anchor,Pos(ranges[i].to().line),"+delete");cm.scrollIntoView()})};cmds[map[cK+ctrl+"U"]="upcaseAtCursor"]=function(cm){modifyWordOrSelection(cm,function(str){return str.toUpperCase()})};cmds[map[cK+ctrl+"L"]="downcaseAtCursor"]=function(cm){modifyWordOrSelection(cm,function(str){return str.toLowerCase()})};cmds[map[cK+ctrl+"Space"]="setSublimeMark"]=function(cm){if(cm.state.sublimeMark)cm.state.sublimeMark.clear();cm.state.sublimeMark=cm.setBookmark(cm.getCursor())};cmds[map[cK+ctrl+"A"]="selectToSublimeMark"]=function(cm){var found=cm.state.sublimeMark&&cm.state.sublimeMark.find();if(found)cm.setSelection(cm.getCursor(),found)};cmds[map[cK+ctrl+"W"]="deleteToSublimeMark"]=function(cm){var found=cm.state.sublimeMark&&cm.state.sublimeMark.find();if(found){var from=cm.getCursor(),to=found;if(CodeMirror.cmpPos(from,to)>0){var tmp=to;to=from;from=tmp}cm.state.sublimeKilled=cm.getRange(from,to);cm.replaceRange("",from,to)}};cmds[map[cK+ctrl+"X"]="swapWithSublimeMark"]=function(cm){var found=cm.state.sublimeMark&&cm.state.sublimeMark.find();if(found){cm.state.sublimeMark.clear();cm.state.sublimeMark=cm.setBookmark(cm.getCursor());cm.setCursor(found)}};cmds[map[cK+ctrl+"Y"]="sublimeYank"]=function(cm){if(cm.state.sublimeKilled!=null)cm.replaceSelection(cm.state.sublimeKilled,null,"paste")};map[cK+ctrl+"G"]="clearBookmarks";cmds[map[cK+ctrl+"C"]="showInCenter"]=function(cm){var pos=cm.cursorCoords(null,"local");cm.scrollTo(null,(pos.top+pos.bottom)/2-cm.getScrollInfo().clientHeight/2)};var selectLinesCombo=mac?"Ctrl-Shift-":"Ctrl-Alt-";cmds[map[selectLinesCombo+"Up"]="selectLinesUpward"]=function(cm){cm.operation(function(){var ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var range=ranges[i];if(range.head.line>cm.firstLine())cm.addSelection(Pos(range.head.line-1,range.head.ch))}})};cmds[map[selectLinesCombo+"Down"]="selectLinesDownward"]=function(cm){cm.operation(function(){var ranges=cm.listSelections();for(var i=0;i<ranges.length;i++){var range=ranges[i];if(range.head.line<cm.lastLine())cm.addSelection(Pos(range.head.line+1,range.head.ch))}})};function getTarget(cm){var from=cm.getCursor("from"),to=cm.getCursor("to");if(CodeMirror.cmpPos(from,to)==0){var word=wordAt(cm,from);if(!word.word)return;from=word.from;to=word.to}return{from:from,to:to,query:cm.getRange(from,to),word:word}}function findAndGoTo(cm,forward){var target=getTarget(cm);if(!target)return;var query=target.query;var cur=cm.getSearchCursor(query,forward?target.to:target.from);if(forward?cur.findNext():cur.findPrevious()){cm.setSelection(cur.from(),cur.to())}else{cur=cm.getSearchCursor(query,forward?Pos(cm.firstLine(),0):cm.clipPos(Pos(cm.lastLine())));if(forward?cur.findNext():cur.findPrevious())cm.setSelection(cur.from(),cur.to());else if(target.word)cm.setSelection(target.from,target.to)}}cmds[map[ctrl+"F3"]="findUnder"]=function(cm){findAndGoTo(cm,true)};cmds[map["Shift-"+ctrl+"F3"]="findUnderPrevious"]=function(cm){findAndGoTo(cm,false)};cmds[map["Alt-F3"]="findAllUnder"]=function(cm){var target=getTarget(cm);if(!target)return;var cur=cm.getSearchCursor(target.query);var matches=[];var primaryIndex=-1;while(cur.findNext()){matches.push({anchor:cur.from(),head:cur.to()});if(cur.from().line<=target.from.line&&cur.from().ch<=target.from.ch)primaryIndex++}cm.setSelections(matches,primaryIndex)};map["Shift-"+ctrl+"["]="fold";map["Shift-"+ctrl+"]"]="unfold";map[cK+ctrl+"0"]=map[cK+ctrl+"J"]="unfoldAll";map[ctrl+"I"]="findIncremental";map["Shift-"+ctrl+"I"]="findIncrementalReverse";map[ctrl+"H"]="replace";map["F3"]="findNext";map["Shift-F3"]="findPrev";CodeMirror.normalizeKeyMap(map)})},function(module,exports,__webpack_require__){(function(mod){if(true)mod(__webpack_require__(11));else if(typeof define=="function"&&define.amd)define(["../../lib/codemirror"],mod);else mod(CodeMirror)})(function(CodeMirror){"use strict";var Pos=CodeMirror.Pos;function regexpFlags(regexp){var flags=regexp.flags;return flags!=null?flags:(regexp.ignoreCase?"i":"")+(regexp.global?"g":"")+(regexp.multiline?"m":"")}function ensureGlobal(regexp){return regexp.global?regexp:new RegExp(regexp.source,regexpFlags(regexp)+"g")}function maybeMultiline(regexp){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(regexp.source)}function searchRegexpForward(doc,regexp,start){regexp=ensureGlobal(regexp);for(var line=start.line,ch=start.ch,last=doc.lastLine();line<=last;line++,ch=0){regexp.lastIndex=ch;var string=doc.getLine(line),match=regexp.exec(string);if(match)return{from:Pos(line,match.index),to:Pos(line,match.index+match[0].length),match:match}}}function searchRegexpForwardMultiline(doc,regexp,start){if(!maybeMultiline(regexp))return searchRegexpForward(doc,regexp,start);regexp=ensureGlobal(regexp);var string,chunk=1;for(var line=start.line,last=doc.lastLine();line<=last;){for(var i=0;i<chunk;i++){var curLine=doc.getLine(line++);string=string==null?curLine:string+"\n"+curLine}chunk=chunk*2;regexp.lastIndex=start.ch;var match=regexp.exec(string);if(match){var before=string.slice(0,match.index).split("\n"),inside=match[0].split("\n");var startLine=start.line+before.length-1,startCh=before[before.length-1].length;return{from:Pos(startLine,startCh),to:Pos(startLine+inside.length-1,inside.length==1?startCh+inside[0].length:inside[inside.length-1].length),match:match}}}}function lastMatchIn(string,regexp){var cutOff=0,match;for(;;){regexp.lastIndex=cutOff;var newMatch=regexp.exec(string);if(!newMatch)return match;match=newMatch;cutOff=match.index+(match[0].length||1);if(cutOff==string.length)return match}}function searchRegexpBackward(doc,regexp,start){regexp=ensureGlobal(regexp);for(var line=start.line,ch=start.ch,first=doc.firstLine();line>=first;line--,ch=-1){var string=doc.getLine(line);if(ch>-1)string=string.slice(0,ch);var match=lastMatchIn(string,regexp);if(match)return{from:Pos(line,match.index),to:Pos(line,match.index+match[0].length),match:match}}}function searchRegexpBackwardMultiline(doc,regexp,start){regexp=ensureGlobal(regexp);var string,chunk=1;for(var line=start.line,first=doc.firstLine();line>=first;){for(var i=0;i<chunk;i++){var curLine=doc.getLine(line--);string=string==null?curLine.slice(0,start.ch):curLine+"\n"+string}chunk*=2;var match=lastMatchIn(string,regexp);if(match){var before=string.slice(0,match.index).split("\n"),inside=match[0].split("\n");var startLine=line+before.length,startCh=before[before.length-1].length;return{from:Pos(startLine,startCh),to:Pos(startLine+inside.length-1,inside.length==1?startCh+inside[0].length:inside[inside.length-1].length),match:match}}}}var doFold,noFold;if(String.prototype.normalize){doFold=function(str){return str.normalize("NFD").toLowerCase()};noFold=function(str){return str.normalize("NFD")}}else{doFold=function(str){return str.toLowerCase()};noFold=function(str){return str}}function adjustPos(orig,folded,pos,foldFunc){if(orig.length==folded.length)return pos;for(var min=0,max=pos+Math.max(0,orig.length-folded.length);;){if(min==max)return min;var mid=min+max>>1;var len=foldFunc(orig.slice(0,mid)).length;if(len==pos)return mid;else if(len>pos)max=mid;else min=mid+1}}function searchStringForward(doc,query,start,caseFold){if(!query.length)return null;var fold=caseFold?doFold:noFold;var lines=fold(query).split(/\r|\n\r?/);search:for(var line=start.line,ch=start.ch,last=doc.lastLine()+1-lines.length;line<=last;line++,ch=0){var orig=doc.getLine(line).slice(ch),string=fold(orig);if(lines.length==1){var found=string.indexOf(lines[0]);if(found==-1)continue search;var start=adjustPos(orig,string,found,fold)+ch;return{from:Pos(line,adjustPos(orig,string,found,fold)+ch),to:Pos(line,adjustPos(orig,string,found+lines[0].length,fold)+ch)}}else{var cutFrom=string.length-lines[0].length;if(string.slice(cutFrom)!=lines[0])continue search;for(var i=1;i<lines.length-1;i++)if(fold(doc.getLine(line+i))!=lines[i])continue search;var end=doc.getLine(line+lines.length-1),endString=fold(end),lastLine=lines[lines.length-1];if(end.slice(0,lastLine.length)!=lastLine)continue search;return{from:Pos(line,adjustPos(orig,string,cutFrom,fold)+ch),to:Pos(line+lines.length-1,adjustPos(end,endString,lastLine.length,fold))}}}}function searchStringBackward(doc,query,start,caseFold){if(!query.length)return null;var fold=caseFold?doFold:noFold;var lines=fold(query).split(/\r|\n\r?/);search:for(var line=start.line,ch=start.ch,first=doc.firstLine()-1+lines.length;line>=first;line--,ch=-1){var orig=doc.getLine(line);if(ch>-1)orig=orig.slice(0,ch);var string=fold(orig);if(lines.length==1){var found=string.lastIndexOf(lines[0]);if(found==-1)continue search;return{from:Pos(line,adjustPos(orig,string,found,fold)),to:Pos(line,adjustPos(orig,string,found+lines[0].length,fold))}}else{var lastLine=lines[lines.length-1];if(string.slice(0,lastLine.length)!=lastLine)continue search;for(var i=1,start=line-lines.length+1;i<lines.length-1;i++)if(fold(doc.getLine(start+i))!=lines[i])continue search;var top=doc.getLine(line+1-lines.length),topString=fold(top);if(topString.slice(topString.length-lines[0].length)!=lines[0])continue search;return{from:Pos(line+1-lines.length,adjustPos(top,topString,top.length-lines[0].length,fold)),to:Pos(line,adjustPos(orig,string,lastLine.length,fold))}}}}function SearchCursor(doc,query,pos,options){this.atOccurrence=false;this.doc=doc;pos=pos?doc.clipPos(pos):Pos(0,0);this.pos={from:pos,to:pos};var caseFold;if(typeof options=="object"){caseFold=options.caseFold}else{caseFold=options;options=null}if(typeof query=="string"){if(caseFold==null)caseFold=false;this.matches=function(reverse,pos){return(reverse?searchStringBackward:searchStringForward)(doc,query,pos,caseFold)}}else{query=ensureGlobal(query);if(!options||options.multiline!==false)this.matches=function(reverse,pos){return(reverse?searchRegexpBackwardMultiline:searchRegexpForwardMultiline)(doc,query,pos)};else this.matches=function(reverse,pos){return(reverse?searchRegexpBackward:searchRegexpForward)(doc,query,pos)}}}SearchCursor.prototype={findNext:function(){return this.find(false)},findPrevious:function(){return this.find(true)},find:function(reverse){var result=this.matches(reverse,this.doc.clipPos(reverse?this.pos.from:this.pos.to));while(result&&CodeMirror.cmpPos(result.from,result.to)==0){if(reverse){if(result.from.ch)result.from=Pos(result.from.line,result.from.ch-1);else if(result.from.line==this.doc.firstLine())result=null;else result=this.matches(reverse,this.doc.clipPos(Pos(result.from.line-1)))}else{if(result.to.ch<this.doc.getLine(result.to.line).length)result.to=Pos(result.to.line,result.to.ch+1);else if(result.to.line==this.doc.lastLine())result=null;else result=this.matches(reverse,Pos(result.to.line+1,0))}}if(result){this.pos=result;this.atOccurrence=true;return this.pos.match||true}else{var end=Pos(reverse?this.doc.firstLine():this.doc.lastLine()+1,0);this.pos={from:end,to:end};return this.atOccurrence=false}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(newText,origin){if(!this.atOccurrence)return;var lines=CodeMirror.splitLines(newText);this.doc.replaceRange(lines,this.pos.from,this.pos.to,origin);this.pos.to=Pos(this.pos.from.line+lines.length-1,lines[lines.length-1].length+(lines.length==1?this.pos.from.ch:0))}};CodeMirror.defineExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this.doc,query,pos,caseFold)});CodeMirror.defineDocExtension("getSearchCursor",function(query,pos,caseFold){return new SearchCursor(this,query,pos,caseFold)});CodeMirror.defineExtension("selectMatches",function(query,caseFold){var ranges=[];var cur=this.getSearchCursor(query,this.getCursor("from"),caseFold);while(cur.findNext()){if(CodeMirror.cmpPos(cur.to(),this.getCursor("to"))>0)break;ranges.push({anchor:cur.from(),head:cur.to()})}if(ranges.length)this.setSelections(ranges,0)})})},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CodeMirror=__webpack_require__(11);var symbols_1=__webpack_require__(36);var symbols_2=__webpack_require__(108);var symbols_3=__webpack_require__(109);var symbols_4=__webpack_require__(110);function createSymbolTest(symbols){var chars=Object.create(null);var alphanum=/[a-zA-Z0-9]/;for(var _i=0,symbols_5=symbols;_i<symbols_5.length;_i++){var s=symbols_5[_i];for(var _a=0,s_1=s;_a<s_1.length;_a++){var c=s_1[_a];if(c!=="-"&&!alphanum.test(c))chars[c]=true}}var test="[a-zA-Z0-9"+Object.keys(chars).join("")+"-]";return new RegExp(test)}function createAutocompleter(symbols){var symbolTest=createSymbolTest(symbols);var lowercaseSymbols=symbols.map(function(s){return s.toLowerCase()});return function(document){var cur=document.getCursor(),curLine=document.getLine(cur.line);var end=cur.ch,start=end;while(start&&symbolTest.test(curLine.charAt(start-1)))--start;while(end<curLine.length&&symbolTest.test(curLine.charAt(end)))++end;var w=document.getRange(CodeMirror.Pos(cur.line,start),CodeMirror.Pos(cur.line,end)).toLowerCase();var list=lowercaseSymbols.filter(function(s){return s.indexOf(w)>=0});return{list:list,from:CodeMirror.Pos(cur.line,start),to:CodeMirror.Pos(cur.line,end)}}}function makeList(all){return all.Keywords.concat(all.Operators,all.Properties)}CodeMirror.registerHelper("hint","molql-script",createAutocompleter(symbols_1.default));CodeMirror.registerHelper("hint","pymol",createAutocompleter(makeList(symbols_2.default)));CodeMirror.registerHelper("hint","jmol",createAutocompleter(makeList(symbols_3.default)));CodeMirror.registerHelper("hint","vmd",createAutocompleter(makeList(symbols_4.default)));exports.default=["molql-script","pymol","jmol","vmd"]},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CodeMirror=__webpack_require__(11);var symbols_1=__webpack_require__(108);var symbols_2=__webpack_require__(109);var symbols_3=__webpack_require__(110);function createHighlighter(all,ignoreCase){function symb(s){return ignoreCase?s.toLowerCase():s}return function(config){var SymbolTest=/[^\s'`,@()\[\]';]/;var operators=Object.create(null),keywords=Object.create(null),props=Object.create(null);for(var _i=0,_a=all.Operators;_i<_a.length;_i++){var s=_a[_i];operators[symb(s)]=true}for(var _b=0,_c=all.Keywords;_b<_c.length;_b++){var s=_c[_b];keywords[symb(s)]=true}for(var _d=0,_e=all.Properties;_d<_e.length;_d++){var s=_e[_d];props[symb(s)]=true}var numLiteral=/^(?:[+\-]?(?:\d+|\d*\.\d+)(?:[efd][+\-]?\d+)?|[+\-]?\d+(?:\/[+\-]?\d+)?|#b[+\-]?[01]+|#o[+\-]?[0-7]+|#x[+\-]?[\da-f]+)/;var type=null;function readSym(stream){var ch;while(ch=stream.next()){if(ch==="\\")stream.next();else if(!SymbolTest.test(ch)){stream.backUp(1);break}}return symb(stream.current())}function base(stream,state){if(stream.eatSpace()){type="ws";return null}if(stream.match(numLiteral))return"number";var ch=stream.next();if(ch==="0")return"number";if(ch==="\\")ch=stream.next();if(ch==='"'||ch==="'")return(state.tokenize=inString)(stream,state);else if(ch==="("||ch==="["){type="open";return"bracket"}else if(ch===")"||ch==="]"){type="close";return"bracket"}else{var name_1=readSym(stream);if(name_1===".")return null;type="symbol";if(keywords[name_1])return"special";if(operators[name_1])return"keyword";if(props[name_1])return"atom";return"variable"}}function inString(stream,state){var escaped=false,next;var delim=stream.current();while(next=stream.next()){if(next===delim&&!escaped){state.tokenize=base;break}escaped=!escaped&&next==="\\"}return"string"}return{startState:function(){return{ctx:{prev:null,start:0,indentTo:0},lastType:null,tokenize:base}},token:function(stream,state){if(stream.sol()&&typeof state.ctx.indentTo!=="number")state.ctx.indentTo=state.ctx.start+1;type=null;var style=state.tokenize(stream,state);if(type!=="ws"){if(state.ctx.indentTo===null){state.ctx.indentTo="next"}else if(state.ctx.indentTo==="next"){state.ctx.indentTo=state.ctx.start}state.lastType=type}if(type==="open")state.ctx={prev:state.ctx,start:state.ctx.start+2,indentTo:null};else if(type==="close")state.ctx=state.ctx.prev||state.ctx;return style},indent:function(state,_textAfter){return state.ctx.start},closeBrackets:{pairs:"()[]``''\"\""},lineComment:void 0,blockCommentStart:void 0,blockCommentEnd:void 0}}}__webpack_require__(236);CodeMirror.defineMode("pymol",createHighlighter(symbols_1.default,true));CodeMirror.defineMode("jmol",createHighlighter(symbols_2.default,true));CodeMirror.defineMode("vmd",createHighlighter(symbols_3.default,true))},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CodeMirror=__webpack_require__(11);var symbols_1=__webpack_require__(36);var SymbolTest=/[^\s'`,@()\[\]';]/;CodeMirror.defineMode("molql-script",function(config){var symbols=Object.create(null);for(var _i=0,SymbolList_1=symbols_1.SymbolList;_i<SymbolList_1.length;_i++){var s=SymbolList_1[_i];symbols[s[0]]=true}var constants=Object.create(null);for(var _a=0,Constants_1=symbols_1.Constants;_a<Constants_1.length;_a++){var s=Constants_1[_a];constants[s]=true}var numLiteral=/^(?:[+\-]?(?:\d+|\d*\.\d+)(?:[efd][+\-]?\d+)?|[+\-]?\d+(?:\/[+\-]?\d+)?|#b[+\-]?[01]+|#o[+\-]?[0-7]+|#x[+\-]?[\da-f]+)/;var elementSymbol=/^\_[0-9a-zA-Z]+/;var type=null;function readSym(stream){var ch;while(ch=stream.next()){if(ch==="\\")stream.next();else if(!SymbolTest.test(ch)){stream.backUp(1);break}}return stream.current()}function base(stream,state){if(stream.eatSpace()){type="ws";return null}if(stream.match(numLiteral))return"number";var ch=stream.next();if(ch==="0")return"number";if(ch==="\\")ch=stream.next();if(ch==="`")return(state.tokenize=inString)(stream,state);else if(ch==="("||ch==="["){type="open";return"bracket"}else if(ch===")"||ch==="]"){type="close";return"bracket"}else if(ch===";"){stream.skipToEnd();type="ws";return"comment"}else if(ch==="#"){var ch_1=stream.next();if(ch_1==="("){type="open";return"bracket"}else if(/[+\-=\.']/.test(ch_1))return null;else if(/\d/.test(ch_1)&&stream.match(/^\d*#/))return null;else if(ch_1==="|")return(state.tokenize=inComment)(stream,state);else if(ch_1==="\\"){stream.next();readSym(stream);return"string-2"}else return"error"}else{var name_1=readSym(stream);if(name_1===".")return null;type="symbol";if(constants[name_1]||elementSymbol.test(name_1))return"atom";if(name_1.charAt(0)===":")return"special";if(symbols[name_1])return"keyword";return"variable"}}function inString(stream,state){var escaped=false,next;while(next=stream.next()){if(next==="`"&&!escaped){state.tokenize=base;break}escaped=!escaped&&next==="\\"}return"string"}function inComment(stream,state){var next,last;while(next=stream.next()){if(next==="#"&&last==="|"){state.tokenize=base;break}last=next}type="ws";return"comment"}return{startState:function(){return{ctx:{prev:null,start:0,indentTo:0},lastType:null,tokenize:base}},token:function(stream,state){if(stream.sol()&&typeof state.ctx.indentTo!=="number")state.ctx.indentTo=state.ctx.start+1;type=null;var style=state.tokenize(stream,state);if(type!=="ws"){if(state.ctx.indentTo===null){state.ctx.indentTo="next"}else if(state.ctx.indentTo==="next"){state.ctx.indentTo=state.ctx.start}state.lastType=type}if(type==="open")state.ctx={prev:state.ctx,start:state.ctx.start+2,indentTo:null};else if(type==="close")state.ctx=state.ctx.prev||state.ctx;return style},indent:function(state,_textAfter){return state.ctx.start},closeBrackets:{pairs:"()[]``"},lineComment:";;",blockCommentStart:"#|",blockCommentEnd:"|#"}})},function(module,exports,__webpack_require__){"use strict";module.exports=__webpack_require__(238)},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactDOMComponentTree=__webpack_require__(5);var ReactDefaultInjection=__webpack_require__(239);var ReactMount=__webpack_require__(134);var ReactReconciler=__webpack_require__(31);var ReactUpdates=__webpack_require__(16);var ReactVersion=__webpack_require__(317);var findDOMNode=__webpack_require__(318);var getHostComponentFromComposite=__webpack_require__(135);var renderSubtreeIntoContainer=__webpack_require__(319);var warning=__webpack_require__(2);ReactDefaultInjection.inject();var ReactDOM={findDOMNode:findDOMNode,render:ReactMount.render,unmountComponentAtNode:ReactMount.unmountComponentAtNode,version:ReactVersion,unstable_batchedUpdates:ReactUpdates.batchedUpdates,unstable_renderSubtreeIntoContainer:renderSubtreeIntoContainer};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__!=="undefined"&&typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject==="function"){__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({ComponentTree:{getClosestInstanceFromNode:ReactDOMComponentTree.getClosestInstanceFromNode,getNodeFromInstance:function(inst){if(inst._renderedComponent){inst=getHostComponentFromComposite(inst)}if(inst){return ReactDOMComponentTree.getNodeFromInstance(inst)}else{return null}}},Mount:ReactMount,Reconciler:ReactReconciler})}if(process.env.NODE_ENV!=="production"){var ExecutionEnvironment=__webpack_require__(7);if(ExecutionEnvironment.canUseDOM&&window.top===window.self){if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__==="undefined"){if(navigator.userAgent.indexOf("Chrome")>-1&&navigator.userAgent.indexOf("Edge")===-1||navigator.userAgent.indexOf("Firefox")>-1){var showFileUrlMessage=window.location.protocol.indexOf("http")===-1&&navigator.userAgent.indexOf("Firefox")===-1;console.debug("Download the React DevTools "+(showFileUrlMessage?"and use an HTTP server (instead of a file: URL) ":"")+"for a better development experience: "+"https://fb.me/react-devtools")}}var testFunc=function testFn(){};process.env.NODE_ENV!=="production"?warning((testFunc.name||testFunc.toString()).indexOf("testFn")!==-1,"It looks like you're using a minified copy of the development build "+"of React. When deploying React apps to production, make sure to use "+"the production build which skips development warnings and is faster. "+"See https://fb.me/react-minification for more details."):void 0;var ieCompatibilityMode=document.documentMode&&document.documentMode<8;process.env.NODE_ENV!=="production"?warning(!ieCompatibilityMode,"Internet Explorer is running in compatibility mode; please add the "+"following tag to your HTML to prevent this from happening: "+'<meta http-equiv="X-UA-Compatible" content="IE=edge" />'):void 0;var expectedFeatures=[Array.isArray,Array.prototype.every,Array.prototype.forEach,Array.prototype.indexOf,Array.prototype.map,Date.now,Function.prototype.bind,Object.keys,String.prototype.trim];for(var i=0;i<expectedFeatures.length;i++){if(!expectedFeatures[i]){process.env.NODE_ENV!=="production"?warning(false,"One or more ES5 shims expected by React are not available: "+"https://fb.me/react-warning-polyfills"):void 0;break}}}}if(process.env.NODE_ENV!=="production"){var ReactInstrumentation=__webpack_require__(12);var ReactDOMUnknownPropertyHook=__webpack_require__(320);var ReactDOMNullInputValuePropHook=__webpack_require__(321);var ReactDOMInvalidARIAHook=__webpack_require__(322);ReactInstrumentation.debugTool.addHook(ReactDOMUnknownPropertyHook);ReactInstrumentation.debugTool.addHook(ReactDOMNullInputValuePropHook);ReactInstrumentation.debugTool.addHook(ReactDOMInvalidARIAHook)}module.exports=ReactDOM}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ARIADOMPropertyConfig=__webpack_require__(240);var BeforeInputEventPlugin=__webpack_require__(241);var ChangeEventPlugin=__webpack_require__(245);var DefaultEventPluginOrder=__webpack_require__(253);var EnterLeaveEventPlugin=__webpack_require__(254);var HTMLDOMPropertyConfig=__webpack_require__(255);var ReactComponentBrowserEnvironment=__webpack_require__(256);var ReactDOMComponent=__webpack_require__(262);var ReactDOMComponentTree=__webpack_require__(5);var ReactDOMEmptyComponent=__webpack_require__(288);var ReactDOMTreeTraversal=__webpack_require__(289);var ReactDOMTextComponent=__webpack_require__(290);var ReactDefaultBatchingStrategy=__webpack_require__(291);var ReactEventListener=__webpack_require__(292);var ReactInjection=__webpack_require__(294);var ReactReconcileTransaction=__webpack_require__(295);var SVGDOMPropertyConfig=__webpack_require__(301);var SelectEventPlugin=__webpack_require__(302);var SimpleEventPlugin=__webpack_require__(303);var alreadyInjected=false;function inject(){if(alreadyInjected){return}alreadyInjected=true;ReactInjection.EventEmitter.injectReactEventListener(ReactEventListener);ReactInjection.EventPluginHub.injectEventPluginOrder(DefaultEventPluginOrder);ReactInjection.EventPluginUtils.injectComponentTree(ReactDOMComponentTree);ReactInjection.EventPluginUtils.injectTreeTraversal(ReactDOMTreeTraversal);ReactInjection.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:SimpleEventPlugin,EnterLeaveEventPlugin:EnterLeaveEventPlugin,ChangeEventPlugin:ChangeEventPlugin,SelectEventPlugin:SelectEventPlugin,BeforeInputEventPlugin:BeforeInputEventPlugin});ReactInjection.HostComponent.injectGenericComponentClass(ReactDOMComponent);ReactInjection.HostComponent.injectTextComponentClass(ReactDOMTextComponent);ReactInjection.DOMProperty.injectDOMPropertyConfig(ARIADOMPropertyConfig);ReactInjection.DOMProperty.injectDOMPropertyConfig(HTMLDOMPropertyConfig);ReactInjection.DOMProperty.injectDOMPropertyConfig(SVGDOMPropertyConfig);ReactInjection.EmptyComponent.injectEmptyComponentFactory(function(instantiate){return new ReactDOMEmptyComponent(instantiate)});ReactInjection.Updates.injectReconcileTransaction(ReactReconcileTransaction);ReactInjection.Updates.injectBatchingStrategy(ReactDefaultBatchingStrategy);ReactInjection.Component.injectEnvironment(ReactComponentBrowserEnvironment)}module.exports={inject:inject}},function(module,exports,__webpack_require__){"use strict";var ARIADOMPropertyConfig={Properties:{"aria-current":0,"aria-details":0,"aria-disabled":0,"aria-hidden":0,"aria-invalid":0,"aria-keyshortcuts":0,"aria-label":0,"aria-roledescription":0,"aria-autocomplete":0,"aria-checked":0,"aria-expanded":0,"aria-haspopup":0,"aria-level":0,"aria-modal":0,"aria-multiline":0,"aria-multiselectable":0,"aria-orientation":0,"aria-placeholder":0,"aria-pressed":0,"aria-readonly":0,"aria-required":0,"aria-selected":0,"aria-sort":0,"aria-valuemax":0,"aria-valuemin":0,"aria-valuenow":0,"aria-valuetext":0,"aria-atomic":0,"aria-busy":0,"aria-live":0,"aria-relevant":0,"aria-dropeffect":0,"aria-grabbed":0,"aria-activedescendant":0,"aria-colcount":0,"aria-colindex":0,"aria-colspan":0,"aria-controls":0,"aria-describedby":0,"aria-errormessage":0,"aria-flowto":0,"aria-labelledby":0,"aria-owns":0,"aria-posinset":0,"aria-rowcount":0,"aria-rowindex":0,"aria-rowspan":0,"aria-setsize":0},DOMAttributeNames:{},DOMPropertyNames:{}};module.exports=ARIADOMPropertyConfig},function(module,exports,__webpack_require__){"use strict";var EventPropagators=__webpack_require__(39);var ExecutionEnvironment=__webpack_require__(7);var FallbackCompositionState=__webpack_require__(242);var SyntheticCompositionEvent=__webpack_require__(243);var SyntheticInputEvent=__webpack_require__(244);var END_KEYCODES=[9,13,27,32];var START_KEYCODE=229;var canUseCompositionEvent=ExecutionEnvironment.canUseDOM&&"CompositionEvent"in window;var documentMode=null;if(ExecutionEnvironment.canUseDOM&&"documentMode"in document){documentMode=document.documentMode}var canUseTextInputEvent=ExecutionEnvironment.canUseDOM&&"TextEvent"in window&&!documentMode&&!isPresto();var useFallbackCompositionData=ExecutionEnvironment.canUseDOM&&(!canUseCompositionEvent||documentMode&&documentMode>8&&documentMode<=11);function isPresto(){var opera=window.opera;return typeof opera==="object"&&typeof opera.version==="function"&&parseInt(opera.version(),10)<=12}var SPACEBAR_CODE=32;var SPACEBAR_CHAR=String.fromCharCode(SPACEBAR_CODE);var eventTypes={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["topCompositionEnd","topKeyPress","topTextInput","topPaste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:["topBlur","topCompositionEnd","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:["topBlur","topCompositionStart","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:["topBlur","topCompositionUpdate","topKeyDown","topKeyPress","topKeyUp","topMouseDown"]}};var hasSpaceKeypress=false;function isKeypressCommand(nativeEvent){return(nativeEvent.ctrlKey||nativeEvent.altKey||nativeEvent.metaKey)&&!(nativeEvent.ctrlKey&&nativeEvent.altKey)}function getCompositionEventType(topLevelType){switch(topLevelType){case"topCompositionStart":return eventTypes.compositionStart;case"topCompositionEnd":return eventTypes.compositionEnd;case"topCompositionUpdate":return eventTypes.compositionUpdate}}function isFallbackCompositionStart(topLevelType,nativeEvent){return topLevelType==="topKeyDown"&&nativeEvent.keyCode===START_KEYCODE}function isFallbackCompositionEnd(topLevelType,nativeEvent){switch(topLevelType){case"topKeyUp":return END_KEYCODES.indexOf(nativeEvent.keyCode)!==-1;case"topKeyDown":return nativeEvent.keyCode!==START_KEYCODE;case"topKeyPress":case"topMouseDown":case"topBlur":return true;default:return false}}function getDataFromCustomEvent(nativeEvent){var detail=nativeEvent.detail;if(typeof detail==="object"&&"data"in detail){return detail.data}return null}var currentComposition=null;function extractCompositionEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget){var eventType;var fallbackData;if(canUseCompositionEvent){eventType=getCompositionEventType(topLevelType)}else if(!currentComposition){if(isFallbackCompositionStart(topLevelType,nativeEvent)){eventType=eventTypes.compositionStart}}else if(isFallbackCompositionEnd(topLevelType,nativeEvent)){eventType=eventTypes.compositionEnd}if(!eventType){return null}if(useFallbackCompositionData){if(!currentComposition&&eventType===eventTypes.compositionStart){currentComposition=FallbackCompositionState.getPooled(nativeEventTarget)}else if(eventType===eventTypes.compositionEnd){if(currentComposition){fallbackData=currentComposition.getData()}}}var event=SyntheticCompositionEvent.getPooled(eventType,targetInst,nativeEvent,nativeEventTarget);if(fallbackData){event.data=fallbackData}else{var customData=getDataFromCustomEvent(nativeEvent);if(customData!==null){event.data=customData}}EventPropagators.accumulateTwoPhaseDispatches(event);return event}function getNativeBeforeInputChars(topLevelType,nativeEvent){switch(topLevelType){case"topCompositionEnd":return getDataFromCustomEvent(nativeEvent);case"topKeyPress":var which=nativeEvent.which;if(which!==SPACEBAR_CODE){return null}hasSpaceKeypress=true;return SPACEBAR_CHAR;case"topTextInput":var chars=nativeEvent.data;if(chars===SPACEBAR_CHAR&&hasSpaceKeypress){return null}return chars;default:return null}}function getFallbackBeforeInputChars(topLevelType,nativeEvent){if(currentComposition){if(topLevelType==="topCompositionEnd"||!canUseCompositionEvent&&isFallbackCompositionEnd(topLevelType,nativeEvent)){var chars=currentComposition.getData();FallbackCompositionState.release(currentComposition);currentComposition=null;return chars}return null}switch(topLevelType){case"topPaste":return null;case"topKeyPress":if(nativeEvent.which&&!isKeypressCommand(nativeEvent)){return String.fromCharCode(nativeEvent.which)}return null;case"topCompositionEnd":return useFallbackCompositionData?null:nativeEvent.data;default:return null}}function extractBeforeInputEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget){var chars;if(canUseTextInputEvent){chars=getNativeBeforeInputChars(topLevelType,nativeEvent)}else{chars=getFallbackBeforeInputChars(topLevelType,nativeEvent)}if(!chars){return null}var event=SyntheticInputEvent.getPooled(eventTypes.beforeInput,targetInst,nativeEvent,nativeEventTarget);event.data=chars;EventPropagators.accumulateTwoPhaseDispatches(event);return event}var BeforeInputEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){return[extractCompositionEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget),extractBeforeInputEvent(topLevelType,targetInst,nativeEvent,nativeEventTarget)]}};module.exports=BeforeInputEventPlugin},function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(4);var PooledClass=__webpack_require__(23);var getTextContentAccessor=__webpack_require__(114);function FallbackCompositionState(root){this._root=root;this._startText=this.getText();this._fallbackText=null}_assign(FallbackCompositionState.prototype,{destructor:function(){this._root=null;this._startText=null;this._fallbackText=null},getText:function(){if("value"in this._root){return this._root.value}return this._root[getTextContentAccessor()]},getData:function(){if(this._fallbackText){return this._fallbackText}var start;var startValue=this._startText;var startLength=startValue.length;var end;var endValue=this.getText();var endLength=endValue.length;for(start=0;start<startLength;start++){if(startValue[start]!==endValue[start]){break}}var minEnd=startLength-start;for(end=1;end<=minEnd;end++){if(startValue[startLength-end]!==endValue[endLength-end]){break}}var sliceTail=end>1?1-end:undefined;this._fallbackText=endValue.slice(start,sliceTail);return this._fallbackText}});PooledClass.addPoolingTo(FallbackCompositionState);module.exports=FallbackCompositionState},function(module,exports,__webpack_require__){"use strict";var SyntheticEvent=__webpack_require__(18);var CompositionEventInterface={data:null};function SyntheticCompositionEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticCompositionEvent,CompositionEventInterface);module.exports=SyntheticCompositionEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticEvent=__webpack_require__(18);var InputEventInterface={data:null};function SyntheticInputEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticInputEvent,InputEventInterface);module.exports=SyntheticInputEvent},function(module,exports,__webpack_require__){"use strict";var EventPluginHub=__webpack_require__(40);var EventPropagators=__webpack_require__(39);var ExecutionEnvironment=__webpack_require__(7);var ReactDOMComponentTree=__webpack_require__(5);var ReactUpdates=__webpack_require__(16);var SyntheticEvent=__webpack_require__(18);var inputValueTracking=__webpack_require__(117);var getEventTarget=__webpack_require__(76);var isEventSupported=__webpack_require__(77);var isTextInputElement=__webpack_require__(118);var eventTypes={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:["topBlur","topChange","topClick","topFocus","topInput","topKeyDown","topKeyUp","topSelectionChange"]}};function createAndAccumulateChangeEvent(inst,nativeEvent,target){var event=SyntheticEvent.getPooled(eventTypes.change,inst,nativeEvent,target);event.type="change";EventPropagators.accumulateTwoPhaseDispatches(event);return event}var activeElement=null;var activeElementInst=null;function shouldUseChangeEvent(elem){var nodeName=elem.nodeName&&elem.nodeName.toLowerCase();return nodeName==="select"||nodeName==="input"&&elem.type==="file"}var doesChangeEventBubble=false;if(ExecutionEnvironment.canUseDOM){doesChangeEventBubble=isEventSupported("change")&&(!document.documentMode||document.documentMode>8)}function manualDispatchChangeEvent(nativeEvent){var event=createAndAccumulateChangeEvent(activeElementInst,nativeEvent,getEventTarget(nativeEvent));ReactUpdates.batchedUpdates(runEventInBatch,event)}function runEventInBatch(event){EventPluginHub.enqueueEvents(event);EventPluginHub.processEventQueue(false)}function startWatchingForChangeEventIE8(target,targetInst){activeElement=target;activeElementInst=targetInst;activeElement.attachEvent("onchange",manualDispatchChangeEvent)}function stopWatchingForChangeEventIE8(){if(!activeElement){return}activeElement.detachEvent("onchange",manualDispatchChangeEvent);activeElement=null;activeElementInst=null}function getInstIfValueChanged(targetInst,nativeEvent){var updated=inputValueTracking.updateValueIfChanged(targetInst);var simulated=nativeEvent.simulated===true&&ChangeEventPlugin._allowSimulatedPassThrough;if(updated||simulated){return targetInst}}function getTargetInstForChangeEvent(topLevelType,targetInst){if(topLevelType==="topChange"){return targetInst}}function handleEventsForChangeEventIE8(topLevelType,target,targetInst){if(topLevelType==="topFocus"){stopWatchingForChangeEventIE8();startWatchingForChangeEventIE8(target,targetInst)}else if(topLevelType==="topBlur"){stopWatchingForChangeEventIE8()}}var isInputEventSupported=false;if(ExecutionEnvironment.canUseDOM){isInputEventSupported=isEventSupported("input")&&(!("documentMode"in document)||document.documentMode>9)}function startWatchingForValueChange(target,targetInst){activeElement=target;activeElementInst=targetInst;activeElement.attachEvent("onpropertychange",handlePropertyChange)}function stopWatchingForValueChange(){if(!activeElement){return}activeElement.detachEvent("onpropertychange",handlePropertyChange);activeElement=null;activeElementInst=null}function handlePropertyChange(nativeEvent){if(nativeEvent.propertyName!=="value"){return}if(getInstIfValueChanged(activeElementInst,nativeEvent)){manualDispatchChangeEvent(nativeEvent)}}function handleEventsForInputEventPolyfill(topLevelType,target,targetInst){if(topLevelType==="topFocus"){stopWatchingForValueChange();startWatchingForValueChange(target,targetInst)}else if(topLevelType==="topBlur"){stopWatchingForValueChange()}}function getTargetInstForInputEventPolyfill(topLevelType,targetInst,nativeEvent){if(topLevelType==="topSelectionChange"||topLevelType==="topKeyUp"||topLevelType==="topKeyDown"){return getInstIfValueChanged(activeElementInst,nativeEvent)}}function shouldUseClickEvent(elem){var nodeName=elem.nodeName;return nodeName&&nodeName.toLowerCase()==="input"&&(elem.type==="checkbox"||elem.type==="radio")}function getTargetInstForClickEvent(topLevelType,targetInst,nativeEvent){if(topLevelType==="topClick"){return getInstIfValueChanged(targetInst,nativeEvent)}}function getTargetInstForInputOrChangeEvent(topLevelType,targetInst,nativeEvent){if(topLevelType==="topInput"||topLevelType==="topChange"){return getInstIfValueChanged(targetInst,nativeEvent)}}function handleControlledInputBlur(inst,node){if(inst==null){return}var state=inst._wrapperState||node._wrapperState;if(!state||!state.controlled||node.type!=="number"){return}var value=""+node.value;if(node.getAttribute("value")!==value){node.setAttribute("value",value)}}var ChangeEventPlugin={eventTypes:eventTypes,_allowSimulatedPassThrough:true,_isInputEventSupported:isInputEventSupported,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var targetNode=targetInst?ReactDOMComponentTree.getNodeFromInstance(targetInst):window;var getTargetInstFunc,handleEventFunc;if(shouldUseChangeEvent(targetNode)){if(doesChangeEventBubble){getTargetInstFunc=getTargetInstForChangeEvent}else{handleEventFunc=handleEventsForChangeEventIE8}}else if(isTextInputElement(targetNode)){if(isInputEventSupported){getTargetInstFunc=getTargetInstForInputOrChangeEvent}else{getTargetInstFunc=getTargetInstForInputEventPolyfill;handleEventFunc=handleEventsForInputEventPolyfill}}else if(shouldUseClickEvent(targetNode)){getTargetInstFunc=getTargetInstForClickEvent}if(getTargetInstFunc){var inst=getTargetInstFunc(topLevelType,targetInst,nativeEvent);if(inst){var event=createAndAccumulateChangeEvent(inst,nativeEvent,nativeEventTarget);return event}}if(handleEventFunc){handleEventFunc(topLevelType,targetNode,targetInst)}if(topLevelType==="topBlur"){handleControlledInputBlur(targetInst,targetNode)}}};module.exports=ChangeEventPlugin},function(module,exports,__webpack_require__){"use strict";var ReactOwner=__webpack_require__(247);var ReactRef={};function attachRef(ref,component,owner){if(typeof ref==="function"){ref(component.getPublicInstance())}else{ReactOwner.addComponentAsRefTo(component,ref,owner)}}function detachRef(ref,component,owner){if(typeof ref==="function"){ref(null)}else{ReactOwner.removeComponentAsRefFrom(component,ref,owner)}}ReactRef.attachRefs=function(instance,element){if(element===null||typeof element!=="object"){return}var ref=element.ref;if(ref!=null){attachRef(ref,instance,element._owner)}};ReactRef.shouldUpdateRefs=function(prevElement,nextElement){var prevRef=null;var prevOwner=null;if(prevElement!==null&&typeof prevElement==="object"){prevRef=prevElement.ref;prevOwner=prevElement._owner}var nextRef=null;var nextOwner=null;if(nextElement!==null&&typeof nextElement==="object"){nextRef=nextElement.ref;nextOwner=nextElement._owner}return prevRef!==nextRef||typeof nextRef==="string"&&nextOwner!==prevOwner};ReactRef.detachRefs=function(instance,element){if(element===null||typeof element!=="object"){return}var ref=element.ref;if(ref!=null){detachRef(ref,instance,element._owner)}};module.exports=ReactRef},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);function isValidOwner(object){return!!(object&&typeof object.attachRef==="function"&&typeof object.detachRef==="function")}var ReactOwner={addComponentAsRefTo:function(component,ref,owner){!isValidOwner(owner)?process.env.NODE_ENV!=="production"?invariant(false,"addComponentAsRefTo(...): Only a ReactOwner can have refs. You might be adding a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner)."):_prodInvariant("119"):void 0;owner.attachRef(ref,component)},removeComponentAsRefFrom:function(component,ref,owner){!isValidOwner(owner)?process.env.NODE_ENV!=="production"?invariant(false,"removeComponentAsRefFrom(...): Only a ReactOwner can have refs. You might be removing a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner)."):_prodInvariant("120"):void 0;var ownerPublicInstance=owner.getPublicInstance();if(ownerPublicInstance&&ownerPublicInstance.refs[ref]===component.getPublicInstance()){owner.detachRef(ref)}}};module.exports=ReactOwner}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactInvalidSetStateWarningHook=__webpack_require__(249);var ReactHostOperationHistoryHook=__webpack_require__(250);var ReactComponentTreeHook=__webpack_require__(9);var ExecutionEnvironment=__webpack_require__(7);var performanceNow=__webpack_require__(251);var warning=__webpack_require__(2);var hooks=[];var didHookThrowForEvent={};function callHook(event,fn,context,arg1,arg2,arg3,arg4,arg5){try{fn.call(context,arg1,arg2,arg3,arg4,arg5)}catch(e){process.env.NODE_ENV!=="production"?warning(didHookThrowForEvent[event],"Exception thrown by hook while handling %s: %s",event,e+"\n"+e.stack):void 0;didHookThrowForEvent[event]=true}}function emitEvent(event,arg1,arg2,arg3,arg4,arg5){for(var i=0;i<hooks.length;i++){var hook=hooks[i];var fn=hook[event];if(fn){callHook(event,fn,hook,arg1,arg2,arg3,arg4,arg5)}}}var isProfiling=false;var flushHistory=[];var lifeCycleTimerStack=[];var currentFlushNesting=0;var currentFlushMeasurements=[];var currentFlushStartTime=0;var currentTimerDebugID=null;var currentTimerStartTime=0;var currentTimerNestedFlushDuration=0;var currentTimerType=null;var lifeCycleTimerHasWarned=false;function clearHistory(){ReactComponentTreeHook.purgeUnmountedComponents();ReactHostOperationHistoryHook.clearHistory()}function getTreeSnapshot(registeredIDs){return registeredIDs.reduce(function(tree,id){var ownerID=ReactComponentTreeHook.getOwnerID(id);var parentID=ReactComponentTreeHook.getParentID(id);tree[id]={displayName:ReactComponentTreeHook.getDisplayName(id),text:ReactComponentTreeHook.getText(id),updateCount:ReactComponentTreeHook.getUpdateCount(id),childIDs:ReactComponentTreeHook.getChildIDs(id),ownerID:ownerID||parentID&&ReactComponentTreeHook.getOwnerID(parentID)||0,parentID:parentID};return tree},{})}function resetMeasurements(){var previousStartTime=currentFlushStartTime;var previousMeasurements=currentFlushMeasurements;var previousOperations=ReactHostOperationHistoryHook.getHistory();if(currentFlushNesting===0){currentFlushStartTime=0;currentFlushMeasurements=[];clearHistory();return}if(previousMeasurements.length||previousOperations.length){var registeredIDs=ReactComponentTreeHook.getRegisteredIDs();flushHistory.push({duration:performanceNow()-previousStartTime,measurements:previousMeasurements||[],operations:previousOperations||[],treeSnapshot:getTreeSnapshot(registeredIDs)})}clearHistory();currentFlushStartTime=performanceNow();currentFlushMeasurements=[]}function checkDebugID(debugID){var allowRoot=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(allowRoot&&debugID===0){return}if(!debugID){process.env.NODE_ENV!=="production"?warning(false,"ReactDebugTool: debugID may not be empty."):void 0}}function beginLifeCycleTimer(debugID,timerType){if(currentFlushNesting===0){return}if(currentTimerType&&!lifeCycleTimerHasWarned){process.env.NODE_ENV!=="production"?warning(false,"There is an internal error in the React performance measurement code. "+"Did not expect %s timer to start while %s timer is still in "+"progress for %s instance.",timerType,currentTimerType||"no",debugID===currentTimerDebugID?"the same":"another"):void 0;lifeCycleTimerHasWarned=true}currentTimerStartTime=performanceNow();currentTimerNestedFlushDuration=0;currentTimerDebugID=debugID;currentTimerType=timerType}function endLifeCycleTimer(debugID,timerType){if(currentFlushNesting===0){return}if(currentTimerType!==timerType&&!lifeCycleTimerHasWarned){process.env.NODE_ENV!=="production"?warning(false,"There is an internal error in the React performance measurement code. "+"We did not expect %s timer to stop while %s timer is still in "+"progress for %s instance. Please report this as a bug in React.",timerType,currentTimerType||"no",debugID===currentTimerDebugID?"the same":"another"):void 0;lifeCycleTimerHasWarned=true}if(isProfiling){currentFlushMeasurements.push({timerType:timerType,instanceID:debugID,duration:performanceNow()-currentTimerStartTime-currentTimerNestedFlushDuration})}currentTimerStartTime=0;currentTimerNestedFlushDuration=0;currentTimerDebugID=null;currentTimerType=null}function pauseCurrentLifeCycleTimer(){var currentTimer={startTime:currentTimerStartTime,nestedFlushStartTime:performanceNow(),debugID:currentTimerDebugID,timerType:currentTimerType};lifeCycleTimerStack.push(currentTimer);currentTimerStartTime=0;currentTimerNestedFlushDuration=0;currentTimerDebugID=null;currentTimerType=null}function resumeCurrentLifeCycleTimer(){var _lifeCycleTimerStack$=lifeCycleTimerStack.pop(),startTime=_lifeCycleTimerStack$.startTime,nestedFlushStartTime=_lifeCycleTimerStack$.nestedFlushStartTime,debugID=_lifeCycleTimerStack$.debugID,timerType=_lifeCycleTimerStack$.timerType;var nestedFlushDuration=performanceNow()-nestedFlushStartTime;currentTimerStartTime=startTime;currentTimerNestedFlushDuration+=nestedFlushDuration;currentTimerDebugID=debugID;currentTimerType=timerType}var lastMarkTimeStamp=0;var canUsePerformanceMeasure=typeof performance!=="undefined"&&typeof performance.mark==="function"&&typeof performance.clearMarks==="function"&&typeof performance.measure==="function"&&typeof performance.clearMeasures==="function";function shouldMark(debugID){if(!isProfiling||!canUsePerformanceMeasure){return false}var element=ReactComponentTreeHook.getElement(debugID);if(element==null||typeof element!=="object"){return false}var isHostElement=typeof element.type==="string";if(isHostElement){return false}return true}function markBegin(debugID,markType){if(!shouldMark(debugID)){return}var markName=debugID+"::"+markType;lastMarkTimeStamp=performanceNow();performance.mark(markName)}function markEnd(debugID,markType){if(!shouldMark(debugID)){return}var markName=debugID+"::"+markType;var displayName=ReactComponentTreeHook.getDisplayName(debugID)||"Unknown";var timeStamp=performanceNow();if(timeStamp-lastMarkTimeStamp>.1){var measurementName=displayName+" ["+markType+"]";performance.measure(measurementName,markName)}performance.clearMarks(markName);if(measurementName){performance.clearMeasures(measurementName)}}var ReactDebugTool={addHook:function(hook){hooks.push(hook)},removeHook:function(hook){for(var i=0;i<hooks.length;i++){if(hooks[i]===hook){hooks.splice(i,1);i--}}},isProfiling:function(){return isProfiling},beginProfiling:function(){if(isProfiling){return}isProfiling=true;flushHistory.length=0;resetMeasurements();ReactDebugTool.addHook(ReactHostOperationHistoryHook)},endProfiling:function(){if(!isProfiling){return}isProfiling=false;resetMeasurements();ReactDebugTool.removeHook(ReactHostOperationHistoryHook)},getFlushHistory:function(){return flushHistory},onBeginFlush:function(){currentFlushNesting++;resetMeasurements();pauseCurrentLifeCycleTimer();emitEvent("onBeginFlush")},onEndFlush:function(){resetMeasurements();currentFlushNesting--;resumeCurrentLifeCycleTimer();emitEvent("onEndFlush")},onBeginLifeCycleTimer:function(debugID,timerType){checkDebugID(debugID);emitEvent("onBeginLifeCycleTimer",debugID,timerType);markBegin(debugID,timerType);beginLifeCycleTimer(debugID,timerType)},onEndLifeCycleTimer:function(debugID,timerType){checkDebugID(debugID);endLifeCycleTimer(debugID,timerType);markEnd(debugID,timerType);emitEvent("onEndLifeCycleTimer",debugID,timerType)},onBeginProcessingChildContext:function(){emitEvent("onBeginProcessingChildContext")},onEndProcessingChildContext:function(){emitEvent("onEndProcessingChildContext")},onHostOperation:function(operation){checkDebugID(operation.instanceID);emitEvent("onHostOperation",operation)},onSetState:function(){emitEvent("onSetState")},onSetChildren:function(debugID,childDebugIDs){checkDebugID(debugID);childDebugIDs.forEach(checkDebugID);emitEvent("onSetChildren",debugID,childDebugIDs)},onBeforeMountComponent:function(debugID,element,parentDebugID){checkDebugID(debugID);checkDebugID(parentDebugID,true);emitEvent("onBeforeMountComponent",debugID,element,parentDebugID);markBegin(debugID,"mount")},onMountComponent:function(debugID){checkDebugID(debugID);markEnd(debugID,"mount");emitEvent("onMountComponent",debugID)},onBeforeUpdateComponent:function(debugID,element){checkDebugID(debugID);emitEvent("onBeforeUpdateComponent",debugID,element);markBegin(debugID,"update")},onUpdateComponent:function(debugID){checkDebugID(debugID);markEnd(debugID,"update");emitEvent("onUpdateComponent",debugID)},onBeforeUnmountComponent:function(debugID){checkDebugID(debugID);emitEvent("onBeforeUnmountComponent",debugID);markBegin(debugID,"unmount")},onUnmountComponent:function(debugID){checkDebugID(debugID);markEnd(debugID,"unmount");emitEvent("onUnmountComponent",debugID)},onTestEvent:function(){emitEvent("onTestEvent")}};ReactDebugTool.addDevtool=ReactDebugTool.addHook;ReactDebugTool.removeDevtool=ReactDebugTool.removeHook;ReactDebugTool.addHook(ReactInvalidSetStateWarningHook);ReactDebugTool.addHook(ReactComponentTreeHook);var url=ExecutionEnvironment.canUseDOM&&window.location.href||"";if(/[?&]react_perf\b/.test(url)){ReactDebugTool.beginProfiling()}module.exports=ReactDebugTool}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var warning=__webpack_require__(2);if(process.env.NODE_ENV!=="production"){var processingChildContext=false;var warnInvalidSetState=function(){process.env.NODE_ENV!=="production"?warning(!processingChildContext,"setState(...): Cannot call setState() inside getChildContext()"):void 0}}var ReactInvalidSetStateWarningHook={onBeginProcessingChildContext:function(){processingChildContext=true},onEndProcessingChildContext:function(){processingChildContext=false},onSetState:function(){warnInvalidSetState()}};module.exports=ReactInvalidSetStateWarningHook}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var history=[];var ReactHostOperationHistoryHook={onHostOperation:function(operation){history.push(operation)},clearHistory:function(){if(ReactHostOperationHistoryHook._preventClearing){return}history=[]},getHistory:function(){return history}};module.exports=ReactHostOperationHistoryHook},function(module,exports,__webpack_require__){"use strict";var performance=__webpack_require__(252);var performanceNow;if(performance.now){performanceNow=function performanceNow(){return performance.now()}}else{performanceNow=function performanceNow(){return Date.now()}}module.exports=performanceNow},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);var performance;if(ExecutionEnvironment.canUseDOM){performance=window.performance||window.msPerformance||window.webkitPerformance}module.exports=performance||{}},function(module,exports,__webpack_require__){"use strict";var DefaultEventPluginOrder=["ResponderEventPlugin","SimpleEventPlugin","TapEventPlugin","EnterLeaveEventPlugin","ChangeEventPlugin","SelectEventPlugin","BeforeInputEventPlugin"];module.exports=DefaultEventPluginOrder},function(module,exports,__webpack_require__){"use strict";var EventPropagators=__webpack_require__(39);var ReactDOMComponentTree=__webpack_require__(5);var SyntheticMouseEvent=__webpack_require__(51);var eventTypes={mouseEnter:{registrationName:"onMouseEnter",dependencies:["topMouseOut","topMouseOver"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["topMouseOut","topMouseOver"]}};var EnterLeaveEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){if(topLevelType==="topMouseOver"&&(nativeEvent.relatedTarget||nativeEvent.fromElement)){return null}if(topLevelType!=="topMouseOut"&&topLevelType!=="topMouseOver"){return null}var win;if(nativeEventTarget.window===nativeEventTarget){win=nativeEventTarget}else{var doc=nativeEventTarget.ownerDocument;if(doc){win=doc.defaultView||doc.parentWindow}else{win=window}}var from;var to;if(topLevelType==="topMouseOut"){from=targetInst;var related=nativeEvent.relatedTarget||nativeEvent.toElement;to=related?ReactDOMComponentTree.getClosestInstanceFromNode(related):null}else{from=null;to=targetInst}if(from===to){return null}var fromNode=from==null?win:ReactDOMComponentTree.getNodeFromInstance(from);var toNode=to==null?win:ReactDOMComponentTree.getNodeFromInstance(to);var leave=SyntheticMouseEvent.getPooled(eventTypes.mouseLeave,from,nativeEvent,nativeEventTarget);leave.type="mouseleave";leave.target=fromNode;leave.relatedTarget=toNode;var enter=SyntheticMouseEvent.getPooled(eventTypes.mouseEnter,to,nativeEvent,nativeEventTarget);enter.type="mouseenter";enter.target=toNode;enter.relatedTarget=fromNode;EventPropagators.accumulateEnterLeaveDispatches(leave,enter,from,to);return[leave,enter]}};module.exports=EnterLeaveEventPlugin},function(module,exports,__webpack_require__){"use strict";var DOMProperty=__webpack_require__(21);var MUST_USE_PROPERTY=DOMProperty.injection.MUST_USE_PROPERTY;var HAS_BOOLEAN_VALUE=DOMProperty.injection.HAS_BOOLEAN_VALUE;var HAS_NUMERIC_VALUE=DOMProperty.injection.HAS_NUMERIC_VALUE;var HAS_POSITIVE_NUMERIC_VALUE=DOMProperty.injection.HAS_POSITIVE_NUMERIC_VALUE;var HAS_OVERLOADED_BOOLEAN_VALUE=DOMProperty.injection.HAS_OVERLOADED_BOOLEAN_VALUE;var HTMLDOMPropertyConfig={isCustomAttribute:RegExp.prototype.test.bind(new RegExp("^(data|aria)-["+DOMProperty.ATTRIBUTE_NAME_CHAR+"]*$")),Properties:{accept:0,acceptCharset:0,accessKey:0,action:0,allowFullScreen:HAS_BOOLEAN_VALUE,allowTransparency:0,alt:0,as:0,async:HAS_BOOLEAN_VALUE,autoComplete:0,autoPlay:HAS_BOOLEAN_VALUE,capture:HAS_BOOLEAN_VALUE,cellPadding:0,cellSpacing:0,charSet:0,challenge:0,checked:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,cite:0,classID:0,className:0,cols:HAS_POSITIVE_NUMERIC_VALUE,colSpan:0,content:0,contentEditable:0,contextMenu:0,controls:HAS_BOOLEAN_VALUE,coords:0,crossOrigin:0,data:0,dateTime:0,default:HAS_BOOLEAN_VALUE,defer:HAS_BOOLEAN_VALUE,dir:0,disabled:HAS_BOOLEAN_VALUE,download:HAS_OVERLOADED_BOOLEAN_VALUE,draggable:0,encType:0,form:0,formAction:0,formEncType:0,formMethod:0,formNoValidate:HAS_BOOLEAN_VALUE,formTarget:0,frameBorder:0,headers:0,height:0,hidden:HAS_BOOLEAN_VALUE,high:0,href:0,hrefLang:0,htmlFor:0,httpEquiv:0,icon:0,id:0,inputMode:0,integrity:0,is:0,keyParams:0,keyType:0,kind:0,label:0,lang:0,list:0,loop:HAS_BOOLEAN_VALUE,low:0,manifest:0,marginHeight:0,marginWidth:0,max:0,maxLength:0,media:0,mediaGroup:0,method:0,min:0,minLength:0,multiple:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,muted:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,name:0,nonce:0,noValidate:HAS_BOOLEAN_VALUE,open:HAS_BOOLEAN_VALUE,optimum:0,pattern:0,placeholder:0,playsInline:HAS_BOOLEAN_VALUE,poster:0,preload:0,profile:0,radioGroup:0,readOnly:HAS_BOOLEAN_VALUE,referrerPolicy:0,rel:0,required:HAS_BOOLEAN_VALUE,reversed:HAS_BOOLEAN_VALUE,role:0,rows:HAS_POSITIVE_NUMERIC_VALUE,rowSpan:HAS_NUMERIC_VALUE,sandbox:0,scope:0,scoped:HAS_BOOLEAN_VALUE,scrolling:0,seamless:HAS_BOOLEAN_VALUE,selected:MUST_USE_PROPERTY|HAS_BOOLEAN_VALUE,shape:0,size:HAS_POSITIVE_NUMERIC_VALUE,sizes:0,span:HAS_POSITIVE_NUMERIC_VALUE,spellCheck:0,src:0,srcDoc:0,srcLang:0,srcSet:0,start:HAS_NUMERIC_VALUE,step:0,style:0,summary:0,tabIndex:0,target:0,title:0,type:0,useMap:0,value:0,width:0,wmode:0,wrap:0,about:0,datatype:0,inlist:0,prefix:0,property:0,resource:0,typeof:0,vocab:0,autoCapitalize:0,autoCorrect:0,autoSave:0,color:0,itemProp:0,itemScope:HAS_BOOLEAN_VALUE,itemType:0,itemID:0,itemRef:0,results:0,security:0,unselectable:0},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{},DOMMutationMethods:{value:function(node,value){if(value==null){return node.removeAttribute("value")}if(node.type!=="number"||node.hasAttribute("value")===false){node.setAttribute("value",""+value)}else if(node.validity&&!node.validity.badInput&&node.ownerDocument.activeElement!==node){node.setAttribute("value",""+value)}}}};module.exports=HTMLDOMPropertyConfig},function(module,exports,__webpack_require__){"use strict";var DOMChildrenOperations=__webpack_require__(79);var ReactDOMIDOperations=__webpack_require__(261);var ReactComponentBrowserEnvironment={processChildrenUpdates:ReactDOMIDOperations.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkup:DOMChildrenOperations.dangerouslyReplaceNodeWithMarkup};module.exports=ReactComponentBrowserEnvironment},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var DOMLazyTree=__webpack_require__(32);var ExecutionEnvironment=__webpack_require__(7);var createNodesFromMarkup=__webpack_require__(258);var emptyFunction=__webpack_require__(10);var invariant=__webpack_require__(1);var Danger={dangerouslyReplaceNodeWithMarkup:function(oldChild,markup){!ExecutionEnvironment.canUseDOM?process.env.NODE_ENV!=="production"?invariant(false,"dangerouslyReplaceNodeWithMarkup(...): Cannot render markup in a worker thread. Make sure `window` and `document` are available globally before requiring React when unit testing or use ReactDOMServer.renderToString() for server rendering."):_prodInvariant("56"):void 0;!markup?process.env.NODE_ENV!=="production"?invariant(false,"dangerouslyReplaceNodeWithMarkup(...): Missing markup."):_prodInvariant("57"):void 0;!(oldChild.nodeName!=="HTML")?process.env.NODE_ENV!=="production"?invariant(false,"dangerouslyReplaceNodeWithMarkup(...): Cannot replace markup of the <html> node. This is because browser quirks make this unreliable and/or slow. If you want to render to the root you must use server rendering. See ReactDOMServer.renderToString()."):_prodInvariant("58"):void 0;if(typeof markup==="string"){var newChild=createNodesFromMarkup(markup,emptyFunction)[0];oldChild.parentNode.replaceChild(newChild,oldChild)}else{DOMLazyTree.replaceChildWithTree(oldChild,markup)}}};module.exports=Danger}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ExecutionEnvironment=__webpack_require__(7);var createArrayFromMixed=__webpack_require__(259);var getMarkupWrap=__webpack_require__(260);var invariant=__webpack_require__(1);var dummyNode=ExecutionEnvironment.canUseDOM?document.createElement("div"):null;var nodeNamePattern=/^\s*<(\w+)/;function getNodeName(markup){var nodeNameMatch=markup.match(nodeNamePattern);return nodeNameMatch&&nodeNameMatch[1].toLowerCase()}function createNodesFromMarkup(markup,handleScript){var node=dummyNode;!!!dummyNode?process.env.NODE_ENV!=="production"?invariant(false,"createNodesFromMarkup dummy not initialized"):invariant(false):void 0;var nodeName=getNodeName(markup);var wrap=nodeName&&getMarkupWrap(nodeName);if(wrap){node.innerHTML=wrap[1]+markup+wrap[2];var wrapDepth=wrap[0];while(wrapDepth--){node=node.lastChild}}else{node.innerHTML=markup}var scripts=node.getElementsByTagName("script");if(scripts.length){!handleScript?process.env.NODE_ENV!=="production"?invariant(false,"createNodesFromMarkup(...): Unexpected <script> element rendered."):invariant(false):void 0;createArrayFromMixed(scripts).forEach(handleScript)}var nodes=Array.from(node.childNodes);while(node.lastChild){node.removeChild(node.lastChild)}return nodes}module.exports=createNodesFromMarkup}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var invariant=__webpack_require__(1);function toArray(obj){var length=obj.length;!(!Array.isArray(obj)&&(typeof obj==="object"||typeof obj==="function"))?process.env.NODE_ENV!=="production"?invariant(false,"toArray: Array-like object expected"):invariant(false):void 0;!(typeof length==="number")?process.env.NODE_ENV!=="production"?invariant(false,"toArray: Object needs a length property"):invariant(false):void 0;!(length===0||length-1 in obj)?process.env.NODE_ENV!=="production"?invariant(false,"toArray: Object should have keys for indices"):invariant(false):void 0;!(typeof obj.callee!=="function")?process.env.NODE_ENV!=="production"?invariant(false,"toArray: Object can't be `arguments`. Use rest params "+"(function(...args) {}) or Array.from() instead."):invariant(false):void 0;if(obj.hasOwnProperty){try{return Array.prototype.slice.call(obj)}catch(e){}}var ret=Array(length);for(var ii=0;ii<length;ii++){ret[ii]=obj[ii]}return ret}function hasArrayNature(obj){return!!obj&&(typeof obj=="object"||typeof obj=="function")&&"length"in obj&&!("setInterval"in obj)&&typeof obj.nodeType!="number"&&(Array.isArray(obj)||"callee"in obj||"item"in obj)}function createArrayFromMixed(obj){if(!hasArrayNature(obj)){return[obj]}else if(Array.isArray(obj)){return obj.slice()}else{return toArray(obj)}}module.exports=createArrayFromMixed}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ExecutionEnvironment=__webpack_require__(7);var invariant=__webpack_require__(1);var dummyNode=ExecutionEnvironment.canUseDOM?document.createElement("div"):null;var shouldWrap={};var selectWrap=[1,'<select multiple="true">',"</select>"];var tableWrap=[1,"<table>","</table>"];var trWrap=[3,"<table><tbody><tr>","</tr></tbody></table>"];var svgWrap=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"];var markupWrap={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:selectWrap,option:selectWrap,caption:tableWrap,colgroup:tableWrap,tbody:tableWrap,tfoot:tableWrap,thead:tableWrap,td:trWrap,th:trWrap};var svgElements=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];svgElements.forEach(function(nodeName){markupWrap[nodeName]=svgWrap;shouldWrap[nodeName]=true});function getMarkupWrap(nodeName){!!!dummyNode?process.env.NODE_ENV!=="production"?invariant(false,"Markup wrapping node not initialized"):invariant(false):void 0;if(!markupWrap.hasOwnProperty(nodeName)){nodeName="*"}if(!shouldWrap.hasOwnProperty(nodeName)){if(nodeName==="*"){dummyNode.innerHTML="<link />"}else{dummyNode.innerHTML="<"+nodeName+"></"+nodeName+">"}shouldWrap[nodeName]=!dummyNode.firstChild}return shouldWrap[nodeName]?markupWrap[nodeName]:null}module.exports=getMarkupWrap}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var DOMChildrenOperations=__webpack_require__(79);var ReactDOMComponentTree=__webpack_require__(5);var ReactDOMIDOperations={dangerouslyProcessChildrenUpdates:function(parentInst,updates){var node=ReactDOMComponentTree.getNodeFromInstance(parentInst);DOMChildrenOperations.processUpdates(node,updates)}};module.exports=ReactDOMIDOperations},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var AutoFocusUtils=__webpack_require__(263);var CSSPropertyOperations=__webpack_require__(264);var DOMLazyTree=__webpack_require__(32);var DOMNamespaces=__webpack_require__(80);var DOMProperty=__webpack_require__(21);var DOMPropertyOperations=__webpack_require__(123);var EventPluginHub=__webpack_require__(40);var EventPluginRegistry=__webpack_require__(49);var ReactBrowserEventEmitter=__webpack_require__(54);var ReactDOMComponentFlags=__webpack_require__(111);var ReactDOMComponentTree=__webpack_require__(5);var ReactDOMInput=__webpack_require__(274);var ReactDOMOption=__webpack_require__(275);var ReactDOMSelect=__webpack_require__(125);var ReactDOMTextarea=__webpack_require__(276);var ReactInstrumentation=__webpack_require__(12);var ReactMultiChild=__webpack_require__(277);var ReactServerRenderingTransaction=__webpack_require__(286);var emptyFunction=__webpack_require__(10);var escapeTextContentForBrowser=__webpack_require__(53);var invariant=__webpack_require__(1);var isEventSupported=__webpack_require__(77);var shallowEqual=__webpack_require__(84);var inputValueTracking=__webpack_require__(117);var validateDOMNesting=__webpack_require__(88);var warning=__webpack_require__(2);var Flags=ReactDOMComponentFlags;var deleteListener=EventPluginHub.deleteListener;var getNode=ReactDOMComponentTree.getNodeFromInstance;var listenTo=ReactBrowserEventEmitter.listenTo;var registrationNameModules=EventPluginRegistry.registrationNameModules;var CONTENT_TYPES={string:true,number:true};var STYLE="style";var HTML="__html";var RESERVED_PROPS={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null};var DOC_FRAGMENT_TYPE=11;function getDeclarationErrorAddendum(internalInstance){if(internalInstance){var owner=internalInstance._currentElement._owner||null;if(owner){var name=owner.getName();if(name){return" This DOM node was rendered by `"+name+"`."}}}return""}function friendlyStringify(obj){if(typeof obj==="object"){if(Array.isArray(obj)){return"["+obj.map(friendlyStringify).join(", ")+"]"}else{var pairs=[];for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var keyEscaped=/^[a-z$_][\w$_]*$/i.test(key)?key:JSON.stringify(key);pairs.push(keyEscaped+": "+friendlyStringify(obj[key]))}}return"{"+pairs.join(", ")+"}"}}else if(typeof obj==="string"){return JSON.stringify(obj)}else if(typeof obj==="function"){return"[function object]"}return String(obj)}var styleMutationWarning={};function checkAndWarnForMutatedStyle(style1,style2,component){if(style1==null||style2==null){return}if(shallowEqual(style1,style2)){return}var componentName=component._tag;var owner=component._currentElement._owner;var ownerName;if(owner){ownerName=owner.getName()}var hash=ownerName+"|"+componentName;if(styleMutationWarning.hasOwnProperty(hash)){return}styleMutationWarning[hash]=true;process.env.NODE_ENV!=="production"?warning(false,"`%s` was passed a style object that has previously been mutated. "+"Mutating `style` is deprecated. Consider cloning it beforehand. Check "+"the `render` %s. Previous style: %s. Mutated style: %s.",componentName,owner?"of `"+ownerName+"`":"using <"+componentName+">",friendlyStringify(style1),friendlyStringify(style2)):void 0}function assertValidProps(component,props){if(!props){return}if(voidElementTags[component._tag]){!(props.children==null&&props.dangerouslySetInnerHTML==null)?process.env.NODE_ENV!=="production"?invariant(false,"%s is a void element tag and must neither have `children` nor use `dangerouslySetInnerHTML`.%s",component._tag,component._currentElement._owner?" Check the render method of "+component._currentElement._owner.getName()+".":""):_prodInvariant("137",component._tag,component._currentElement._owner?" Check the render method of "+component._currentElement._owner.getName()+".":""):void 0}if(props.dangerouslySetInnerHTML!=null){!(props.children==null)?process.env.NODE_ENV!=="production"?invariant(false,"Can only set one of `children` or `props.dangerouslySetInnerHTML`."):_prodInvariant("60"):void 0;!(typeof props.dangerouslySetInnerHTML==="object"&&HTML in props.dangerouslySetInnerHTML)?process.env.NODE_ENV!=="production"?invariant(false,"`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://fb.me/react-invariant-dangerously-set-inner-html for more information."):_prodInvariant("61"):void 0}if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(props.innerHTML==null,"Directly setting property `innerHTML` is not permitted. "+"For more information, lookup documentation on `dangerouslySetInnerHTML`."):void 0;process.env.NODE_ENV!=="production"?warning(props.suppressContentEditableWarning||!props.contentEditable||props.children==null,"A component is `contentEditable` and contains `children` managed by "+"React. It is now your responsibility to guarantee that none of "+"those nodes are unexpectedly modified or duplicated. This is "+"probably not intentional."):void 0;process.env.NODE_ENV!=="production"?warning(props.onFocusIn==null&&props.onFocusOut==null,"React uses onFocus and onBlur instead of onFocusIn and onFocusOut. "+"All React events are normalized to bubble, so onFocusIn and onFocusOut "+"are not needed/supported by React."):void 0}!(props.style==null||typeof props.style==="object")?process.env.NODE_ENV!=="production"?invariant(false,"The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.%s",getDeclarationErrorAddendum(component)):_prodInvariant("62",getDeclarationErrorAddendum(component)):void 0}function enqueuePutListener(inst,registrationName,listener,transaction){if(transaction instanceof ReactServerRenderingTransaction){return}if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(registrationName!=="onScroll"||isEventSupported("scroll",true),"This browser doesn't support the `onScroll` event"):void 0}var containerInfo=inst._hostContainerInfo;var isDocumentFragment=containerInfo._node&&containerInfo._node.nodeType===DOC_FRAGMENT_TYPE;var doc=isDocumentFragment?containerInfo._node:containerInfo._ownerDocument;listenTo(registrationName,doc);transaction.getReactMountReady().enqueue(putListener,{inst:inst,registrationName:registrationName,listener:listener})}function putListener(){var listenerToPut=this;EventPluginHub.putListener(listenerToPut.inst,listenerToPut.registrationName,listenerToPut.listener)}function inputPostMount(){var inst=this;ReactDOMInput.postMountWrapper(inst)}function textareaPostMount(){var inst=this;ReactDOMTextarea.postMountWrapper(inst)}function optionPostMount(){var inst=this;ReactDOMOption.postMountWrapper(inst)}var setAndValidateContentChildDev=emptyFunction;if(process.env.NODE_ENV!=="production"){setAndValidateContentChildDev=function(content){var hasExistingContent=this._contentDebugID!=null;var debugID=this._debugID;var contentDebugID=-debugID;if(content==null){if(hasExistingContent){ReactInstrumentation.debugTool.onUnmountComponent(this._contentDebugID)}this._contentDebugID=null;return}validateDOMNesting(null,String(content),this,this._ancestorInfo);this._contentDebugID=contentDebugID;if(hasExistingContent){ReactInstrumentation.debugTool.onBeforeUpdateComponent(contentDebugID,content);ReactInstrumentation.debugTool.onUpdateComponent(contentDebugID)}else{ReactInstrumentation.debugTool.onBeforeMountComponent(contentDebugID,content,debugID);ReactInstrumentation.debugTool.onMountComponent(contentDebugID);ReactInstrumentation.debugTool.onSetChildren(debugID,[contentDebugID])}}}var mediaEvents={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"};function trackInputValue(){inputValueTracking.track(this)}function trapBubbledEventsLocal(){var inst=this;!inst._rootNodeID?process.env.NODE_ENV!=="production"?invariant(false,"Must be mounted to trap events"):_prodInvariant("63"):void 0;var node=getNode(inst);!node?process.env.NODE_ENV!=="production"?invariant(false,"trapBubbledEvent(...): Requires node to be rendered."):_prodInvariant("64"):void 0;switch(inst._tag){case"iframe":case"object":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topLoad","load",node)];break;case"video":case"audio":inst._wrapperState.listeners=[];for(var event in mediaEvents){if(mediaEvents.hasOwnProperty(event)){inst._wrapperState.listeners.push(ReactBrowserEventEmitter.trapBubbledEvent(event,mediaEvents[event],node))}}break;case"source":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topError","error",node)];break;case"img":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topError","error",node),ReactBrowserEventEmitter.trapBubbledEvent("topLoad","load",node)];break;case"form":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topReset","reset",node),ReactBrowserEventEmitter.trapBubbledEvent("topSubmit","submit",node)];break;case"input":case"select":case"textarea":inst._wrapperState.listeners=[ReactBrowserEventEmitter.trapBubbledEvent("topInvalid","invalid",node)];break}}function postUpdateSelectWrapper(){ReactDOMSelect.postUpdateWrapper(this)}var omittedCloseTags={area:true,base:true,br:true,col:true,embed:true,hr:true,img:true,input:true,keygen:true,link:true,meta:true,param:true,source:true,track:true,wbr:true};var newlineEatingTags={listing:true,pre:true,textarea:true};var voidElementTags=_assign({menuitem:true},omittedCloseTags);var VALID_TAG_REGEX=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/;var validatedTagCache={};var hasOwnProperty={}.hasOwnProperty;function validateDangerousTag(tag){if(!hasOwnProperty.call(validatedTagCache,tag)){!VALID_TAG_REGEX.test(tag)?process.env.NODE_ENV!=="production"?invariant(false,"Invalid tag: %s",tag):_prodInvariant("65",tag):void 0;validatedTagCache[tag]=true}}function isCustomComponent(tagName,props){return tagName.indexOf("-")>=0||props.is!=null}var globalIdCounter=1;function ReactDOMComponent(element){var tag=element.type;validateDangerousTag(tag);this._currentElement=element;this._tag=tag.toLowerCase();this._namespaceURI=null;this._renderedChildren=null;this._previousStyle=null;this._previousStyleCopy=null;this._hostNode=null;this._hostParent=null;this._rootNodeID=0;this._domID=0;this._hostContainerInfo=null;this._wrapperState=null;this._topLevelWrapper=null;this._flags=0;if(process.env.NODE_ENV!=="production"){this._ancestorInfo=null;setAndValidateContentChildDev.call(this,null)}}ReactDOMComponent.displayName="ReactDOMComponent";ReactDOMComponent.Mixin={mountComponent:function(transaction,hostParent,hostContainerInfo,context){this._rootNodeID=globalIdCounter++;this._domID=hostContainerInfo._idCounter++;this._hostParent=hostParent;this._hostContainerInfo=hostContainerInfo;var props=this._currentElement.props;switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":this._wrapperState={listeners:null};transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break;case"input":ReactDOMInput.mountWrapper(this,props,hostParent);props=ReactDOMInput.getHostProps(this,props);transaction.getReactMountReady().enqueue(trackInputValue,this);transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break;case"option":ReactDOMOption.mountWrapper(this,props,hostParent);props=ReactDOMOption.getHostProps(this,props);break;case"select":ReactDOMSelect.mountWrapper(this,props,hostParent);props=ReactDOMSelect.getHostProps(this,props);transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break;case"textarea":ReactDOMTextarea.mountWrapper(this,props,hostParent);props=ReactDOMTextarea.getHostProps(this,props);transaction.getReactMountReady().enqueue(trackInputValue,this);transaction.getReactMountReady().enqueue(trapBubbledEventsLocal,this);break}assertValidProps(this,props);var namespaceURI;var parentTag;if(hostParent!=null){namespaceURI=hostParent._namespaceURI;parentTag=hostParent._tag}else if(hostContainerInfo._tag){namespaceURI=hostContainerInfo._namespaceURI;parentTag=hostContainerInfo._tag}if(namespaceURI==null||namespaceURI===DOMNamespaces.svg&&parentTag==="foreignobject"){namespaceURI=DOMNamespaces.html}if(namespaceURI===DOMNamespaces.html){if(this._tag==="svg"){namespaceURI=DOMNamespaces.svg}else if(this._tag==="math"){namespaceURI=DOMNamespaces.mathml}}this._namespaceURI=namespaceURI;if(process.env.NODE_ENV!=="production"){var parentInfo;if(hostParent!=null){parentInfo=hostParent._ancestorInfo}else if(hostContainerInfo._tag){parentInfo=hostContainerInfo._ancestorInfo}if(parentInfo){validateDOMNesting(this._tag,null,this,parentInfo)}this._ancestorInfo=validateDOMNesting.updatedAncestorInfo(parentInfo,this._tag,this)}var mountImage;if(transaction.useCreateElement){var ownerDocument=hostContainerInfo._ownerDocument;var el;if(namespaceURI===DOMNamespaces.html){if(this._tag==="script"){var div=ownerDocument.createElement("div");var type=this._currentElement.type;div.innerHTML="<"+type+"></"+type+">";el=div.removeChild(div.firstChild)}else if(props.is){el=ownerDocument.createElement(this._currentElement.type,props.is)}else{el=ownerDocument.createElement(this._currentElement.type)}}else{el=ownerDocument.createElementNS(namespaceURI,this._currentElement.type)}ReactDOMComponentTree.precacheNode(this,el);this._flags|=Flags.hasCachedChildNodes;if(!this._hostParent){DOMPropertyOperations.setAttributeForRoot(el)}this._updateDOMProperties(null,props,transaction);var lazyTree=DOMLazyTree(el);this._createInitialChildren(transaction,props,context,lazyTree);mountImage=lazyTree}else{var tagOpen=this._createOpenTagMarkupAndPutListeners(transaction,props);var tagContent=this._createContentMarkup(transaction,props,context);if(!tagContent&&omittedCloseTags[this._tag]){mountImage=tagOpen+"/>"}else{mountImage=tagOpen+">"+tagContent+"</"+this._currentElement.type+">"}}switch(this._tag){case"input":transaction.getReactMountReady().enqueue(inputPostMount,this);if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"textarea":transaction.getReactMountReady().enqueue(textareaPostMount,this);if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"select":if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"button":if(props.autoFocus){transaction.getReactMountReady().enqueue(AutoFocusUtils.focusDOMComponent,this)}break;case"option":transaction.getReactMountReady().enqueue(optionPostMount,this);break}return mountImage},_createOpenTagMarkupAndPutListeners:function(transaction,props){var ret="<"+this._currentElement.type;for(var propKey in props){if(!props.hasOwnProperty(propKey)){continue}var propValue=props[propKey];if(propValue==null){continue}if(registrationNameModules.hasOwnProperty(propKey)){if(propValue){enqueuePutListener(this,propKey,propValue,transaction)}}else{if(propKey===STYLE){if(propValue){if(process.env.NODE_ENV!=="production"){this._previousStyle=propValue}propValue=this._previousStyleCopy=_assign({},props.style)}propValue=CSSPropertyOperations.createMarkupForStyles(propValue,this)}var markup=null;if(this._tag!=null&&isCustomComponent(this._tag,props)){if(!RESERVED_PROPS.hasOwnProperty(propKey)){markup=DOMPropertyOperations.createMarkupForCustomAttribute(propKey,propValue)}}else{markup=DOMPropertyOperations.createMarkupForProperty(propKey,propValue)}if(markup){ret+=" "+markup}}}if(transaction.renderToStaticMarkup){return ret}if(!this._hostParent){ret+=" "+DOMPropertyOperations.createMarkupForRoot()}ret+=" "+DOMPropertyOperations.createMarkupForID(this._domID);return ret},_createContentMarkup:function(transaction,props,context){var ret="";var innerHTML=props.dangerouslySetInnerHTML;if(innerHTML!=null){if(innerHTML.__html!=null){ret=innerHTML.__html}}else{var contentToUse=CONTENT_TYPES[typeof props.children]?props.children:null;var childrenToUse=contentToUse!=null?null:props.children;if(contentToUse!=null){ret=escapeTextContentForBrowser(contentToUse);if(process.env.NODE_ENV!=="production"){setAndValidateContentChildDev.call(this,contentToUse)}}else if(childrenToUse!=null){var mountImages=this.mountChildren(childrenToUse,transaction,context);ret=mountImages.join("")}}if(newlineEatingTags[this._tag]&&ret.charAt(0)==="\n"){return"\n"+ret}else{return ret}},_createInitialChildren:function(transaction,props,context,lazyTree){var innerHTML=props.dangerouslySetInnerHTML;if(innerHTML!=null){if(innerHTML.__html!=null){DOMLazyTree.queueHTML(lazyTree,innerHTML.__html)}}else{var contentToUse=CONTENT_TYPES[typeof props.children]?props.children:null;var childrenToUse=contentToUse!=null?null:props.children;if(contentToUse!=null){if(contentToUse!==""){if(process.env.NODE_ENV!=="production"){setAndValidateContentChildDev.call(this,contentToUse)}DOMLazyTree.queueText(lazyTree,contentToUse)}}else if(childrenToUse!=null){var mountImages=this.mountChildren(childrenToUse,transaction,context);for(var i=0;i<mountImages.length;i++){DOMLazyTree.queueChild(lazyTree,mountImages[i])}}}},receiveComponent:function(nextElement,transaction,context){var prevElement=this._currentElement;this._currentElement=nextElement;this.updateComponent(transaction,prevElement,nextElement,context)},updateComponent:function(transaction,prevElement,nextElement,context){var lastProps=prevElement.props;var nextProps=this._currentElement.props;switch(this._tag){case"input":lastProps=ReactDOMInput.getHostProps(this,lastProps);nextProps=ReactDOMInput.getHostProps(this,nextProps);break;case"option":lastProps=ReactDOMOption.getHostProps(this,lastProps);nextProps=ReactDOMOption.getHostProps(this,nextProps);break;case"select":lastProps=ReactDOMSelect.getHostProps(this,lastProps);nextProps=ReactDOMSelect.getHostProps(this,nextProps);break;case"textarea":lastProps=ReactDOMTextarea.getHostProps(this,lastProps);nextProps=ReactDOMTextarea.getHostProps(this,nextProps);break}assertValidProps(this,nextProps);this._updateDOMProperties(lastProps,nextProps,transaction);this._updateDOMChildren(lastProps,nextProps,transaction,context);switch(this._tag){case"input":ReactDOMInput.updateWrapper(this);break;case"textarea":ReactDOMTextarea.updateWrapper(this);break;case"select":transaction.getReactMountReady().enqueue(postUpdateSelectWrapper,this);break}},_updateDOMProperties:function(lastProps,nextProps,transaction){var propKey;var styleName;var styleUpdates;for(propKey in lastProps){if(nextProps.hasOwnProperty(propKey)||!lastProps.hasOwnProperty(propKey)||lastProps[propKey]==null){continue}if(propKey===STYLE){var lastStyle=this._previousStyleCopy;for(styleName in lastStyle){if(lastStyle.hasOwnProperty(styleName)){styleUpdates=styleUpdates||{};styleUpdates[styleName]=""}}this._previousStyleCopy=null}else if(registrationNameModules.hasOwnProperty(propKey)){if(lastProps[propKey]){deleteListener(this,propKey)}}else if(isCustomComponent(this._tag,lastProps)){if(!RESERVED_PROPS.hasOwnProperty(propKey)){DOMPropertyOperations.deleteValueForAttribute(getNode(this),propKey)}}else if(DOMProperty.properties[propKey]||DOMProperty.isCustomAttribute(propKey)){DOMPropertyOperations.deleteValueForProperty(getNode(this),propKey)}}for(propKey in nextProps){var nextProp=nextProps[propKey];var lastProp=propKey===STYLE?this._previousStyleCopy:lastProps!=null?lastProps[propKey]:undefined;if(!nextProps.hasOwnProperty(propKey)||nextProp===lastProp||nextProp==null&&lastProp==null){continue}if(propKey===STYLE){if(nextProp){if(process.env.NODE_ENV!=="production"){checkAndWarnForMutatedStyle(this._previousStyleCopy,this._previousStyle,this);this._previousStyle=nextProp}nextProp=this._previousStyleCopy=_assign({},nextProp)}else{this._previousStyleCopy=null}if(lastProp){for(styleName in lastProp){if(lastProp.hasOwnProperty(styleName)&&(!nextProp||!nextProp.hasOwnProperty(styleName))){styleUpdates=styleUpdates||{};styleUpdates[styleName]=""}}for(styleName in nextProp){if(nextProp.hasOwnProperty(styleName)&&lastProp[styleName]!==nextProp[styleName]){styleUpdates=styleUpdates||{};styleUpdates[styleName]=nextProp[styleName]}}}else{styleUpdates=nextProp}}else if(registrationNameModules.hasOwnProperty(propKey)){if(nextProp){enqueuePutListener(this,propKey,nextProp,transaction)}else if(lastProp){deleteListener(this,propKey)}}else if(isCustomComponent(this._tag,nextProps)){if(!RESERVED_PROPS.hasOwnProperty(propKey)){DOMPropertyOperations.setValueForAttribute(getNode(this),propKey,nextProp)}}else if(DOMProperty.properties[propKey]||DOMProperty.isCustomAttribute(propKey)){var node=getNode(this);if(nextProp!=null){DOMPropertyOperations.setValueForProperty(node,propKey,nextProp)}else{DOMPropertyOperations.deleteValueForProperty(node,propKey)}}}if(styleUpdates){CSSPropertyOperations.setValueForStyles(getNode(this),styleUpdates,this)}},_updateDOMChildren:function(lastProps,nextProps,transaction,context){var lastContent=CONTENT_TYPES[typeof lastProps.children]?lastProps.children:null;var nextContent=CONTENT_TYPES[typeof nextProps.children]?nextProps.children:null;var lastHtml=lastProps.dangerouslySetInnerHTML&&lastProps.dangerouslySetInnerHTML.__html;var nextHtml=nextProps.dangerouslySetInnerHTML&&nextProps.dangerouslySetInnerHTML.__html;var lastChildren=lastContent!=null?null:lastProps.children;var nextChildren=nextContent!=null?null:nextProps.children;var lastHasContentOrHtml=lastContent!=null||lastHtml!=null;var nextHasContentOrHtml=nextContent!=null||nextHtml!=null;if(lastChildren!=null&&nextChildren==null){this.updateChildren(null,transaction,context)}else if(lastHasContentOrHtml&&!nextHasContentOrHtml){this.updateTextContent("");if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onSetChildren(this._debugID,[])}}if(nextContent!=null){if(lastContent!==nextContent){this.updateTextContent(""+nextContent);if(process.env.NODE_ENV!=="production"){setAndValidateContentChildDev.call(this,nextContent)}}}else if(nextHtml!=null){if(lastHtml!==nextHtml){this.updateMarkup(""+nextHtml)}if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onSetChildren(this._debugID,[])}}else if(nextChildren!=null){if(process.env.NODE_ENV!=="production"){setAndValidateContentChildDev.call(this,null)}this.updateChildren(nextChildren,transaction,context)}},getHostNode:function(){return getNode(this)},unmountComponent:function(safely){switch(this._tag){case"audio":case"form":case"iframe":case"img":case"link":case"object":case"source":case"video":var listeners=this._wrapperState.listeners;if(listeners){for(var i=0;i<listeners.length;i++){listeners[i].remove()}}break;case"input":case"textarea":inputValueTracking.stopTracking(this);break;case"html":case"head":case"body":true?process.env.NODE_ENV!=="production"?invariant(false,"<%s> tried to unmount. Because of cross-browser quirks it is impossible to unmount some top-level components (eg <html>, <head>, and <body>) reliably and efficiently. To fix this, have a single top-level component that never unmounts render these elements.",this._tag):_prodInvariant("66",this._tag):void 0;break}this.unmountChildren(safely);ReactDOMComponentTree.uncacheNode(this);EventPluginHub.deleteAllListeners(this);this._rootNodeID=0;this._domID=0;this._wrapperState=null;if(process.env.NODE_ENV!=="production"){setAndValidateContentChildDev.call(this,null)}},getPublicInstance:function(){return getNode(this)}};_assign(ReactDOMComponent.prototype,ReactDOMComponent.Mixin,ReactMultiChild.Mixin);module.exports=ReactDOMComponent}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactDOMComponentTree=__webpack_require__(5);var focusNode=__webpack_require__(121);var AutoFocusUtils={focusDOMComponent:function(){focusNode(ReactDOMComponentTree.getNodeFromInstance(this))}};module.exports=AutoFocusUtils},function(module,exports,__webpack_require__){"use strict";(function(process){var CSSProperty=__webpack_require__(122);var ExecutionEnvironment=__webpack_require__(7);var ReactInstrumentation=__webpack_require__(12);var camelizeStyleName=__webpack_require__(265);var dangerousStyleValue=__webpack_require__(267);var hyphenateStyleName=__webpack_require__(268);var memoizeStringOnly=__webpack_require__(270);var warning=__webpack_require__(2);var processStyleName=memoizeStringOnly(function(styleName){return hyphenateStyleName(styleName)});var hasShorthandPropertyBug=false;var styleFloatAccessor="cssFloat";if(ExecutionEnvironment.canUseDOM){var tempStyle=document.createElement("div").style;try{tempStyle.font=""}catch(e){hasShorthandPropertyBug=true}if(document.documentElement.style.cssFloat===undefined){styleFloatAccessor="styleFloat"}}if(process.env.NODE_ENV!=="production"){var badVendoredStyleNamePattern=/^(?:webkit|moz|o)[A-Z]/;var badStyleValueWithSemicolonPattern=/;\s*$/;var warnedStyleNames={};var warnedStyleValues={};var warnedForNaNValue=false;var warnHyphenatedStyleName=function(name,owner){if(warnedStyleNames.hasOwnProperty(name)&&warnedStyleNames[name]){return}warnedStyleNames[name]=true;process.env.NODE_ENV!=="production"?warning(false,"Unsupported style property %s. Did you mean %s?%s",name,camelizeStyleName(name),checkRenderMessage(owner)):void 0};var warnBadVendoredStyleName=function(name,owner){if(warnedStyleNames.hasOwnProperty(name)&&warnedStyleNames[name]){return}warnedStyleNames[name]=true;process.env.NODE_ENV!=="production"?warning(false,"Unsupported vendor-prefixed style property %s. Did you mean %s?%s",name,name.charAt(0).toUpperCase()+name.slice(1),checkRenderMessage(owner)):void 0};var warnStyleValueWithSemicolon=function(name,value,owner){if(warnedStyleValues.hasOwnProperty(value)&&warnedStyleValues[value]){return}warnedStyleValues[value]=true;process.env.NODE_ENV!=="production"?warning(false,"Style property values shouldn't contain a semicolon.%s "+'Try "%s: %s" instead.',checkRenderMessage(owner),name,value.replace(badStyleValueWithSemicolonPattern,"")):void 0};var warnStyleValueIsNaN=function(name,value,owner){if(warnedForNaNValue){return}warnedForNaNValue=true;process.env.NODE_ENV!=="production"?warning(false,"`NaN` is an invalid value for the `%s` css style property.%s",name,checkRenderMessage(owner)):void 0};var checkRenderMessage=function(owner){if(owner){var name=owner.getName();if(name){return" Check the render method of `"+name+"`."}}return""};var warnValidStyle=function(name,value,component){var owner;if(component){owner=component._currentElement._owner}if(name.indexOf("-")>-1){warnHyphenatedStyleName(name,owner)}else if(badVendoredStyleNamePattern.test(name)){warnBadVendoredStyleName(name,owner)}else if(badStyleValueWithSemicolonPattern.test(value)){warnStyleValueWithSemicolon(name,value,owner)}if(typeof value==="number"&&isNaN(value)){warnStyleValueIsNaN(name,value,owner)}}}var CSSPropertyOperations={createMarkupForStyles:function(styles,component){var serialized="";for(var styleName in styles){if(!styles.hasOwnProperty(styleName)){continue}var isCustomProperty=styleName.indexOf("--")===0;var styleValue=styles[styleName];if(process.env.NODE_ENV!=="production"){if(!isCustomProperty){warnValidStyle(styleName,styleValue,component)}}if(styleValue!=null){serialized+=processStyleName(styleName)+":";serialized+=dangerousStyleValue(styleName,styleValue,component,isCustomProperty)+";"}}return serialized||null},setValueForStyles:function(node,styles,component){if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onHostOperation({instanceID:component._debugID,type:"update styles",payload:styles})}var style=node.style;for(var styleName in styles){if(!styles.hasOwnProperty(styleName)){continue}var isCustomProperty=styleName.indexOf("--")===0;if(process.env.NODE_ENV!=="production"){if(!isCustomProperty){warnValidStyle(styleName,styles[styleName],component)}}var styleValue=dangerousStyleValue(styleName,styles[styleName],component,isCustomProperty);if(styleName==="float"||styleName==="cssFloat"){styleName=styleFloatAccessor}if(isCustomProperty){style.setProperty(styleName,styleValue)}else if(styleValue){style[styleName]=styleValue}else{var expansion=hasShorthandPropertyBug&&CSSProperty.shorthandPropertyExpansions[styleName];if(expansion){for(var individualStyleName in expansion){style[individualStyleName]=""}}else{style[styleName]=""}}}}};module.exports=CSSPropertyOperations}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var camelize=__webpack_require__(266);var msPattern=/^-ms-/;function camelizeStyleName(string){return camelize(string.replace(msPattern,"ms-"))}module.exports=camelizeStyleName},function(module,exports,__webpack_require__){"use strict";var _hyphenPattern=/-(.)/g;function camelize(string){return string.replace(_hyphenPattern,function(_,character){return character.toUpperCase()})}module.exports=camelize},function(module,exports,__webpack_require__){"use strict";(function(process){var CSSProperty=__webpack_require__(122);var warning=__webpack_require__(2);var isUnitlessNumber=CSSProperty.isUnitlessNumber;var styleWarnings={};function dangerousStyleValue(name,value,component,isCustomProperty){var isEmpty=value==null||typeof value==="boolean"||value==="";if(isEmpty){return""}var isNonNumeric=isNaN(value);if(isCustomProperty||isNonNumeric||value===0||isUnitlessNumber.hasOwnProperty(name)&&isUnitlessNumber[name]){return""+value}if(typeof value==="string"){if(process.env.NODE_ENV!=="production"){if(component&&value!=="0"){var owner=component._currentElement._owner;var ownerName=owner?owner.getName():null;if(ownerName&&!styleWarnings[ownerName]){styleWarnings[ownerName]={}}var warned=false;if(ownerName){var warnings=styleWarnings[ownerName];warned=warnings[name];if(!warned){warnings[name]=true}}if(!warned){process.env.NODE_ENV!=="production"?warning(false,"a `%s` tag (owner: `%s`) was passed a numeric string value "+"for CSS property `%s` (value: `%s`) which will be treated "+"as a unitless number in a future version of React.",component._currentElement.type,ownerName||"unknown",name,value):void 0}}}value=value.trim()}return value+"px"}module.exports=dangerousStyleValue}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var hyphenate=__webpack_require__(269);var msPattern=/^ms-/;function hyphenateStyleName(string){return hyphenate(string).replace(msPattern,"-ms-")}module.exports=hyphenateStyleName},function(module,exports,__webpack_require__){"use strict";var _uppercasePattern=/([A-Z])/g;function hyphenate(string){return string.replace(_uppercasePattern,"-$1").toLowerCase()}module.exports=hyphenate},function(module,exports,__webpack_require__){"use strict";function memoizeStringOnly(callback){var cache={};return function(string){if(!cache.hasOwnProperty(string)){cache[string]=callback.call(this,string)}return cache[string]}}module.exports=memoizeStringOnly},function(module,exports,__webpack_require__){"use strict";var escapeTextContentForBrowser=__webpack_require__(53);function quoteAttributeValueForBrowser(value){return'"'+escapeTextContentForBrowser(value)+'"'}module.exports=quoteAttributeValueForBrowser},function(module,exports,__webpack_require__){"use strict";var EventPluginHub=__webpack_require__(40);function runEventQueueInBatch(events){EventPluginHub.enqueueEvents(events);EventPluginHub.processEventQueue(false)}var ReactEventEmitterMixin={handleTopLevel:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var events=EventPluginHub.extractEvents(topLevelType,targetInst,nativeEvent,nativeEventTarget);runEventQueueInBatch(events)}};module.exports=ReactEventEmitterMixin},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);function makePrefixMap(styleProp,eventName){var prefixes={};prefixes[styleProp.toLowerCase()]=eventName.toLowerCase();prefixes["Webkit"+styleProp]="webkit"+eventName;prefixes["Moz"+styleProp]="moz"+eventName;prefixes["ms"+styleProp]="MS"+eventName;prefixes["O"+styleProp]="o"+eventName.toLowerCase();return prefixes}var vendorPrefixes={animationend:makePrefixMap("Animation","AnimationEnd"),animationiteration:makePrefixMap("Animation","AnimationIteration"),animationstart:makePrefixMap("Animation","AnimationStart"),transitionend:makePrefixMap("Transition","TransitionEnd")};var prefixedEventNames={};var style={};if(ExecutionEnvironment.canUseDOM){style=document.createElement("div").style;if(!("AnimationEvent"in window)){delete vendorPrefixes.animationend.animation;delete vendorPrefixes.animationiteration.animation;delete vendorPrefixes.animationstart.animation}if(!("TransitionEvent"in window)){delete vendorPrefixes.transitionend.transition}}function getVendorPrefixedEventName(eventName){if(prefixedEventNames[eventName]){return prefixedEventNames[eventName]}else if(!vendorPrefixes[eventName]){return eventName}var prefixMap=vendorPrefixes[eventName];for(var styleProp in prefixMap){if(prefixMap.hasOwnProperty(styleProp)&&styleProp in style){return prefixedEventNames[eventName]=prefixMap[styleProp]}}return""}module.exports=getVendorPrefixedEventName},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var DOMPropertyOperations=__webpack_require__(123);var LinkedValueUtils=__webpack_require__(82);var ReactDOMComponentTree=__webpack_require__(5);var ReactUpdates=__webpack_require__(16);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var didWarnValueLink=false;var didWarnCheckedLink=false;var didWarnValueDefaultValue=false;var didWarnCheckedDefaultChecked=false;var didWarnControlledToUncontrolled=false;var didWarnUncontrolledToControlled=false;function forceUpdateIfMounted(){if(this._rootNodeID){ReactDOMInput.updateWrapper(this)}}function isControlled(props){var usesChecked=props.type==="checkbox"||props.type==="radio";return usesChecked?props.checked!=null:props.value!=null}var ReactDOMInput={getHostProps:function(inst,props){var value=LinkedValueUtils.getValue(props);var checked=LinkedValueUtils.getChecked(props);var hostProps=_assign({type:undefined,step:undefined,min:undefined,max:undefined},props,{defaultChecked:undefined,defaultValue:undefined,value:value!=null?value:inst._wrapperState.initialValue,checked:checked!=null?checked:inst._wrapperState.initialChecked,onChange:inst._wrapperState.onChange});return hostProps},mountWrapper:function(inst,props){if(process.env.NODE_ENV!=="production"){LinkedValueUtils.checkPropTypes("input",props,inst._currentElement._owner);var owner=inst._currentElement._owner;if(props.valueLink!==undefined&&!didWarnValueLink){process.env.NODE_ENV!=="production"?warning(false,"`valueLink` prop on `input` is deprecated; set `value` and `onChange` instead."):void 0;didWarnValueLink=true}if(props.checkedLink!==undefined&&!didWarnCheckedLink){process.env.NODE_ENV!=="production"?warning(false,"`checkedLink` prop on `input` is deprecated; set `value` and `onChange` instead."):void 0;didWarnCheckedLink=true}if(props.checked!==undefined&&props.defaultChecked!==undefined&&!didWarnCheckedDefaultChecked){process.env.NODE_ENV!=="production"?warning(false,"%s contains an input of type %s with both checked and defaultChecked props. "+"Input elements must be either controlled or uncontrolled "+"(specify either the checked prop, or the defaultChecked prop, but not "+"both). Decide between using a controlled or uncontrolled input "+"element and remove one of these props. More info: "+"https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnCheckedDefaultChecked=true}if(props.value!==undefined&&props.defaultValue!==undefined&&!didWarnValueDefaultValue){process.env.NODE_ENV!=="production"?warning(false,"%s contains an input of type %s with both value and defaultValue props. "+"Input elements must be either controlled or uncontrolled "+"(specify either the value prop, or the defaultValue prop, but not "+"both). Decide between using a controlled or uncontrolled input "+"element and remove one of these props. More info: "+"https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnValueDefaultValue=true}}var defaultValue=props.defaultValue;inst._wrapperState={initialChecked:props.checked!=null?props.checked:props.defaultChecked,initialValue:props.value!=null?props.value:defaultValue,listeners:null,onChange:_handleChange.bind(inst),controlled:isControlled(props)}},updateWrapper:function(inst){var props=inst._currentElement.props;if(process.env.NODE_ENV!=="production"){var controlled=isControlled(props);var owner=inst._currentElement._owner;if(!inst._wrapperState.controlled&&controlled&&!didWarnUncontrolledToControlled){process.env.NODE_ENV!=="production"?warning(false,"%s is changing an uncontrolled input of type %s to be controlled. "+"Input elements should not switch from uncontrolled to controlled (or vice versa). "+"Decide between using a controlled or uncontrolled input "+"element for the lifetime of the component. More info: https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnUncontrolledToControlled=true}if(inst._wrapperState.controlled&&!controlled&&!didWarnControlledToUncontrolled){process.env.NODE_ENV!=="production"?warning(false,"%s is changing a controlled input of type %s to be uncontrolled. "+"Input elements should not switch from controlled to uncontrolled (or vice versa). "+"Decide between using a controlled or uncontrolled input "+"element for the lifetime of the component. More info: https://fb.me/react-controlled-components",owner&&owner.getName()||"A component",props.type):void 0;didWarnControlledToUncontrolled=true}}var checked=props.checked;if(checked!=null){DOMPropertyOperations.setValueForProperty(ReactDOMComponentTree.getNodeFromInstance(inst),"checked",checked||false)}var node=ReactDOMComponentTree.getNodeFromInstance(inst);var value=LinkedValueUtils.getValue(props);if(value!=null){if(value===0&&node.value===""){node.value="0"}else if(props.type==="number"){var valueAsNumber=parseFloat(node.value,10)||0;if(value!=valueAsNumber||value==valueAsNumber&&node.value!=value){node.value=""+value}}else if(node.value!==""+value){node.value=""+value}}else{if(props.value==null&&props.defaultValue!=null){if(node.defaultValue!==""+props.defaultValue){node.defaultValue=""+props.defaultValue}}if(props.checked==null&&props.defaultChecked!=null){node.defaultChecked=!!props.defaultChecked}}},postMountWrapper:function(inst){var props=inst._currentElement.props;var node=ReactDOMComponentTree.getNodeFromInstance(inst);switch(props.type){case"submit":case"reset":break;case"color":case"date":case"datetime":case"datetime-local":case"month":case"time":case"week":node.value="";node.value=node.defaultValue;break;default:node.value=node.value;break}var name=node.name;if(name!==""){node.name=""}node.defaultChecked=!node.defaultChecked;node.defaultChecked=!node.defaultChecked;if(name!==""){node.name=name}}};function _handleChange(event){var props=this._currentElement.props;var returnValue=LinkedValueUtils.executeOnChange(props,event);ReactUpdates.asap(forceUpdateIfMounted,this);var name=props.name;if(props.type==="radio"&&name!=null){var rootNode=ReactDOMComponentTree.getNodeFromInstance(this);var queryRoot=rootNode;while(queryRoot.parentNode){queryRoot=queryRoot.parentNode}var group=queryRoot.querySelectorAll("input[name="+JSON.stringify(""+name)+'][type="radio"]');for(var i=0;i<group.length;i++){var otherNode=group[i];if(otherNode===rootNode||otherNode.form!==rootNode.form){continue}var otherInstance=ReactDOMComponentTree.getInstanceFromNode(otherNode);!otherInstance?process.env.NODE_ENV!=="production"?invariant(false,"ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported."):_prodInvariant("90"):void 0;ReactUpdates.asap(forceUpdateIfMounted,otherInstance)}}return returnValue}module.exports=ReactDOMInput}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var React=__webpack_require__(28);var ReactDOMComponentTree=__webpack_require__(5);var ReactDOMSelect=__webpack_require__(125);var warning=__webpack_require__(2);var didWarnInvalidOptionChildren=false;function flattenChildren(children){var content="";React.Children.forEach(children,function(child){if(child==null){return}if(typeof child==="string"||typeof child==="number"){content+=child}else if(!didWarnInvalidOptionChildren){didWarnInvalidOptionChildren=true;process.env.NODE_ENV!=="production"?warning(false,"Only strings and numbers are supported as <option> children."):void 0}});return content}var ReactDOMOption={mountWrapper:function(inst,props,hostParent){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(props.selected==null,"Use the `defaultValue` or `value` props on <select> instead of "+"setting `selected` on <option>."):void 0}var selectValue=null;if(hostParent!=null){var selectParent=hostParent;if(selectParent._tag==="optgroup"){selectParent=selectParent._hostParent}if(selectParent!=null&&selectParent._tag==="select"){selectValue=ReactDOMSelect.getSelectValueContext(selectParent)}}var selected=null;if(selectValue!=null){var value;if(props.value!=null){value=props.value+""}else{value=flattenChildren(props.children)}selected=false;if(Array.isArray(selectValue)){for(var i=0;i<selectValue.length;i++){if(""+selectValue[i]===value){selected=true;break}}}else{selected=""+selectValue===value}}inst._wrapperState={selected:selected}},postMountWrapper:function(inst){var props=inst._currentElement.props;if(props.value!=null){var node=ReactDOMComponentTree.getNodeFromInstance(inst);node.setAttribute("value",props.value)}},getHostProps:function(inst,props){var hostProps=_assign({selected:undefined,children:undefined},props);if(inst._wrapperState.selected!=null){hostProps.selected=inst._wrapperState.selected}var content=flattenChildren(props.children);if(content){hostProps.children=content}return hostProps}};module.exports=ReactDOMOption}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var LinkedValueUtils=__webpack_require__(82);var ReactDOMComponentTree=__webpack_require__(5);var ReactUpdates=__webpack_require__(16);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var didWarnValueLink=false;var didWarnValDefaultVal=false;function forceUpdateIfMounted(){if(this._rootNodeID){ReactDOMTextarea.updateWrapper(this)}}var ReactDOMTextarea={getHostProps:function(inst,props){!(props.dangerouslySetInnerHTML==null)?process.env.NODE_ENV!=="production"?invariant(false,"`dangerouslySetInnerHTML` does not make sense on <textarea>."):_prodInvariant("91"):void 0;var hostProps=_assign({},props,{value:undefined,defaultValue:undefined,children:""+inst._wrapperState.initialValue,onChange:inst._wrapperState.onChange});return hostProps},mountWrapper:function(inst,props){if(process.env.NODE_ENV!=="production"){LinkedValueUtils.checkPropTypes("textarea",props,inst._currentElement._owner);if(props.valueLink!==undefined&&!didWarnValueLink){process.env.NODE_ENV!=="production"?warning(false,"`valueLink` prop on `textarea` is deprecated; set `value` and `onChange` instead."):void 0;didWarnValueLink=true}if(props.value!==undefined&&props.defaultValue!==undefined&&!didWarnValDefaultVal){process.env.NODE_ENV!=="production"?warning(false,"Textarea elements must be either controlled or uncontrolled "+"(specify either the value prop, or the defaultValue prop, but not "+"both). Decide between using a controlled or uncontrolled textarea "+"and remove one of these props. More info: "+"https://fb.me/react-controlled-components"):void 0;didWarnValDefaultVal=true}}var value=LinkedValueUtils.getValue(props);var initialValue=value;if(value==null){var defaultValue=props.defaultValue;var children=props.children;if(children!=null){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(false,"Use the `defaultValue` or `value` props instead of setting "+"children on <textarea>."):void 0}!(defaultValue==null)?process.env.NODE_ENV!=="production"?invariant(false,"If you supply `defaultValue` on a <textarea>, do not pass children."):_prodInvariant("92"):void 0;if(Array.isArray(children)){!(children.length<=1)?process.env.NODE_ENV!=="production"?invariant(false,"<textarea> can only have at most one child."):_prodInvariant("93"):void 0;children=children[0]}defaultValue=""+children}if(defaultValue==null){defaultValue=""}initialValue=defaultValue}inst._wrapperState={initialValue:""+initialValue,listeners:null,onChange:_handleChange.bind(inst)}},updateWrapper:function(inst){var props=inst._currentElement.props;var node=ReactDOMComponentTree.getNodeFromInstance(inst);var value=LinkedValueUtils.getValue(props);if(value!=null){var newValue=""+value;if(newValue!==node.value){node.value=newValue}if(props.defaultValue==null){node.defaultValue=newValue}}if(props.defaultValue!=null){node.defaultValue=props.defaultValue}},postMountWrapper:function(inst){var node=ReactDOMComponentTree.getNodeFromInstance(inst);var textContent=node.textContent;if(textContent===inst._wrapperState.initialValue){node.value=textContent}}};function _handleChange(event){var props=this._currentElement.props;var returnValue=LinkedValueUtils.executeOnChange(props,event);ReactUpdates.asap(forceUpdateIfMounted,this);return returnValue}module.exports=ReactDOMTextarea}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactComponentEnvironment=__webpack_require__(83);var ReactInstanceMap=__webpack_require__(42);var ReactInstrumentation=__webpack_require__(12);var ReactCurrentOwner=__webpack_require__(15);var ReactReconciler=__webpack_require__(31);var ReactChildReconciler=__webpack_require__(278);var emptyFunction=__webpack_require__(10);var flattenChildren=__webpack_require__(285);var invariant=__webpack_require__(1);function makeInsertMarkup(markup,afterNode,toIndex){return{type:"INSERT_MARKUP",content:markup,fromIndex:null,fromNode:null,toIndex:toIndex,afterNode:afterNode}}function makeMove(child,afterNode,toIndex){return{type:"MOVE_EXISTING",content:null,fromIndex:child._mountIndex,fromNode:ReactReconciler.getHostNode(child),toIndex:toIndex,afterNode:afterNode}}function makeRemove(child,node){return{type:"REMOVE_NODE",content:null,fromIndex:child._mountIndex,fromNode:node,toIndex:null,afterNode:null}}function makeSetMarkup(markup){return{type:"SET_MARKUP",content:markup,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function makeTextContent(textContent){return{type:"TEXT_CONTENT",content:textContent,fromIndex:null,fromNode:null,toIndex:null,afterNode:null}}function enqueue(queue,update){if(update){queue=queue||[];queue.push(update)}return queue}function processQueue(inst,updateQueue){ReactComponentEnvironment.processChildrenUpdates(inst,updateQueue)}var setChildrenForInstrumentation=emptyFunction;if(process.env.NODE_ENV!=="production"){var getDebugID=function(inst){if(!inst._debugID){var internal;if(internal=ReactInstanceMap.get(inst)){inst=internal}}return inst._debugID};setChildrenForInstrumentation=function(children){var debugID=getDebugID(this);if(debugID!==0){ReactInstrumentation.debugTool.onSetChildren(debugID,children?Object.keys(children).map(function(key){return children[key]._debugID}):[])}}}var ReactMultiChild={Mixin:{_reconcilerInstantiateChildren:function(nestedChildren,transaction,context){if(process.env.NODE_ENV!=="production"){var selfDebugID=getDebugID(this);if(this._currentElement){try{ReactCurrentOwner.current=this._currentElement._owner;return ReactChildReconciler.instantiateChildren(nestedChildren,transaction,context,selfDebugID)}finally{ReactCurrentOwner.current=null}}}return ReactChildReconciler.instantiateChildren(nestedChildren,transaction,context)},_reconcilerUpdateChildren:function(prevChildren,nextNestedChildrenElements,mountImages,removedNodes,transaction,context){var nextChildren;var selfDebugID=0;if(process.env.NODE_ENV!=="production"){selfDebugID=getDebugID(this);if(this._currentElement){try{ReactCurrentOwner.current=this._currentElement._owner;nextChildren=flattenChildren(nextNestedChildrenElements,selfDebugID)}finally{ReactCurrentOwner.current=null}ReactChildReconciler.updateChildren(prevChildren,nextChildren,mountImages,removedNodes,transaction,this,this._hostContainerInfo,context,selfDebugID);return nextChildren}}nextChildren=flattenChildren(nextNestedChildrenElements,selfDebugID);ReactChildReconciler.updateChildren(prevChildren,nextChildren,mountImages,removedNodes,transaction,this,this._hostContainerInfo,context,selfDebugID);return nextChildren},mountChildren:function(nestedChildren,transaction,context){var children=this._reconcilerInstantiateChildren(nestedChildren,transaction,context);this._renderedChildren=children;var mountImages=[];var index=0;for(var name in children){if(children.hasOwnProperty(name)){var child=children[name];var selfDebugID=0;if(process.env.NODE_ENV!=="production"){selfDebugID=getDebugID(this)}var mountImage=ReactReconciler.mountComponent(child,transaction,this,this._hostContainerInfo,context,selfDebugID);child._mountIndex=index++;mountImages.push(mountImage)}}if(process.env.NODE_ENV!=="production"){setChildrenForInstrumentation.call(this,children)}return mountImages},updateTextContent:function(nextContent){var prevChildren=this._renderedChildren;ReactChildReconciler.unmountChildren(prevChildren,false);for(var name in prevChildren){if(prevChildren.hasOwnProperty(name)){true?process.env.NODE_ENV!=="production"?invariant(false,"updateTextContent called on non-empty component."):_prodInvariant("118"):void 0}}var updates=[makeTextContent(nextContent)];processQueue(this,updates)},updateMarkup:function(nextMarkup){var prevChildren=this._renderedChildren;ReactChildReconciler.unmountChildren(prevChildren,false);for(var name in prevChildren){if(prevChildren.hasOwnProperty(name)){true?process.env.NODE_ENV!=="production"?invariant(false,"updateTextContent called on non-empty component."):_prodInvariant("118"):void 0}}var updates=[makeSetMarkup(nextMarkup)];processQueue(this,updates)},updateChildren:function(nextNestedChildrenElements,transaction,context){this._updateChildren(nextNestedChildrenElements,transaction,context)},_updateChildren:function(nextNestedChildrenElements,transaction,context){var prevChildren=this._renderedChildren;var removedNodes={};var mountImages=[];var nextChildren=this._reconcilerUpdateChildren(prevChildren,nextNestedChildrenElements,mountImages,removedNodes,transaction,context);if(!nextChildren&&!prevChildren){return}var updates=null;var name;var nextIndex=0;var lastIndex=0;var nextMountIndex=0;var lastPlacedNode=null;for(name in nextChildren){if(!nextChildren.hasOwnProperty(name)){continue}var prevChild=prevChildren&&prevChildren[name];var nextChild=nextChildren[name];if(prevChild===nextChild){updates=enqueue(updates,this.moveChild(prevChild,lastPlacedNode,nextIndex,lastIndex));lastIndex=Math.max(prevChild._mountIndex,lastIndex);prevChild._mountIndex=nextIndex}else{if(prevChild){lastIndex=Math.max(prevChild._mountIndex,lastIndex)}updates=enqueue(updates,this._mountChildAtIndex(nextChild,mountImages[nextMountIndex],lastPlacedNode,nextIndex,transaction,context));nextMountIndex++}nextIndex++;lastPlacedNode=ReactReconciler.getHostNode(nextChild)}for(name in removedNodes){if(removedNodes.hasOwnProperty(name)){updates=enqueue(updates,this._unmountChild(prevChildren[name],removedNodes[name]))}}if(updates){processQueue(this,updates)}this._renderedChildren=nextChildren;if(process.env.NODE_ENV!=="production"){setChildrenForInstrumentation.call(this,nextChildren)}},unmountChildren:function(safely){var renderedChildren=this._renderedChildren;ReactChildReconciler.unmountChildren(renderedChildren,safely);this._renderedChildren=null},moveChild:function(child,afterNode,toIndex,lastIndex){if(child._mountIndex<lastIndex){return makeMove(child,afterNode,toIndex)}},createChild:function(child,afterNode,mountImage){return makeInsertMarkup(mountImage,afterNode,child._mountIndex)},removeChild:function(child,node){return makeRemove(child,node)},_mountChildAtIndex:function(child,mountImage,afterNode,index,transaction,context){child._mountIndex=index;return this.createChild(child,afterNode,mountImage)},_unmountChild:function(child,node){var update=this.removeChild(child,node);child._mountIndex=null;return update}}};module.exports=ReactMultiChild}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactReconciler=__webpack_require__(31);var instantiateReactComponent=__webpack_require__(126);var KeyEscapeUtils=__webpack_require__(86);var shouldUpdateReactComponent=__webpack_require__(85);var traverseAllChildren=__webpack_require__(130);var warning=__webpack_require__(2);var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&process.env.NODE_ENV==="test"){ReactComponentTreeHook=__webpack_require__(9)}function instantiateChild(childInstances,child,name,selfDebugID){var keyUnique=childInstances[name]===undefined;if(process.env.NODE_ENV!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=__webpack_require__(9)}if(!keyUnique){process.env.NODE_ENV!=="production"?warning(false,"flattenChildren(...): Encountered two children with the same key, "+"`%s`. Child keys must be unique; when two children share a key, only "+"the first child will be used.%s",KeyEscapeUtils.unescape(name),ReactComponentTreeHook.getStackAddendumByID(selfDebugID)):void 0}}if(child!=null&&keyUnique){childInstances[name]=instantiateReactComponent(child,true)}}var ReactChildReconciler={instantiateChildren:function(nestedChildNodes,transaction,context,selfDebugID){if(nestedChildNodes==null){return null}var childInstances={};if(process.env.NODE_ENV!=="production"){traverseAllChildren(nestedChildNodes,function(childInsts,child,name){return instantiateChild(childInsts,child,name,selfDebugID)},childInstances)}else{traverseAllChildren(nestedChildNodes,instantiateChild,childInstances)}return childInstances},updateChildren:function(prevChildren,nextChildren,mountImages,removedNodes,transaction,hostParent,hostContainerInfo,context,selfDebugID){if(!nextChildren&&!prevChildren){return}var name;var prevChild;for(name in nextChildren){if(!nextChildren.hasOwnProperty(name)){continue}prevChild=prevChildren&&prevChildren[name];var prevElement=prevChild&&prevChild._currentElement;var nextElement=nextChildren[name];if(prevChild!=null&&shouldUpdateReactComponent(prevElement,nextElement)){ReactReconciler.receiveComponent(prevChild,nextElement,transaction,context);nextChildren[name]=prevChild}else{if(prevChild){removedNodes[name]=ReactReconciler.getHostNode(prevChild);ReactReconciler.unmountComponent(prevChild,false)}var nextChildInstance=instantiateReactComponent(nextElement,true);nextChildren[name]=nextChildInstance;var nextChildMountImage=ReactReconciler.mountComponent(nextChildInstance,transaction,hostParent,hostContainerInfo,context,selfDebugID);mountImages.push(nextChildMountImage)}}for(name in prevChildren){if(prevChildren.hasOwnProperty(name)&&!(nextChildren&&nextChildren.hasOwnProperty(name))){prevChild=prevChildren[name];removedNodes[name]=ReactReconciler.getHostNode(prevChild);ReactReconciler.unmountComponent(prevChild,false)}}},unmountChildren:function(renderedChildren,safely){for(var name in renderedChildren){if(renderedChildren.hasOwnProperty(name)){var renderedChild=renderedChildren[name];ReactReconciler.unmountComponent(renderedChild,safely)}}}};module.exports=ReactChildReconciler}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var React=__webpack_require__(28);var ReactComponentEnvironment=__webpack_require__(83);var ReactCurrentOwner=__webpack_require__(15);var ReactErrorUtils=__webpack_require__(75);var ReactInstanceMap=__webpack_require__(42);var ReactInstrumentation=__webpack_require__(12);var ReactNodeTypes=__webpack_require__(127);var ReactReconciler=__webpack_require__(31);if(process.env.NODE_ENV!=="production"){var checkReactTypeSpec=__webpack_require__(280)}var emptyObject=__webpack_require__(48);var invariant=__webpack_require__(1);var shallowEqual=__webpack_require__(84);var shouldUpdateReactComponent=__webpack_require__(85);var warning=__webpack_require__(2);var CompositeTypes={ImpureClass:0,PureClass:1,StatelessFunctional:2};function StatelessComponent(Component){}StatelessComponent.prototype.render=function(){var Component=ReactInstanceMap.get(this)._currentElement.type;var element=Component(this.props,this.context,this.updater);warnIfInvalidElement(Component,element);return element};function warnIfInvalidElement(Component,element){if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(element===null||element===false||React.isValidElement(element),"%s(...): A valid React element (or null) must be returned. You may have "+"returned undefined, an array or some other invalid object.",Component.displayName||Component.name||"Component"):void 0;process.env.NODE_ENV!=="production"?warning(!Component.childContextTypes,"%s(...): childContextTypes cannot be defined on a functional component.",Component.displayName||Component.name||"Component"):void 0}}function shouldConstruct(Component){return!!(Component.prototype&&Component.prototype.isReactComponent)}function isPureComponent(Component){return!!(Component.prototype&&Component.prototype.isPureReactComponent)}function measureLifeCyclePerf(fn,debugID,timerType){if(debugID===0){return fn()}ReactInstrumentation.debugTool.onBeginLifeCycleTimer(debugID,timerType);try{return fn()}finally{ReactInstrumentation.debugTool.onEndLifeCycleTimer(debugID,timerType)}}var nextMountID=1;var ReactCompositeComponent={construct:function(element){this._currentElement=element;this._rootNodeID=0;this._compositeType=null;this._instance=null;this._hostParent=null;this._hostContainerInfo=null;this._updateBatchNumber=null;this._pendingElement=null;this._pendingStateQueue=null;this._pendingReplaceState=false;this._pendingForceUpdate=false;this._renderedNodeType=null;this._renderedComponent=null;this._context=null;this._mountOrder=0;this._topLevelWrapper=null;this._pendingCallbacks=null;this._calledComponentWillUnmount=false;if(process.env.NODE_ENV!=="production"){this._warnedAboutRefsInRender=false}},mountComponent:function(transaction,hostParent,hostContainerInfo,context){var _this=this;this._context=context;this._mountOrder=nextMountID++;this._hostParent=hostParent;this._hostContainerInfo=hostContainerInfo;var publicProps=this._currentElement.props;var publicContext=this._processContext(context);var Component=this._currentElement.type;var updateQueue=transaction.getUpdateQueue();var doConstruct=shouldConstruct(Component);var inst=this._constructComponent(doConstruct,publicProps,publicContext,updateQueue);var renderedElement;if(!doConstruct&&(inst==null||inst.render==null)){renderedElement=inst;warnIfInvalidElement(Component,renderedElement);!(inst===null||inst===false||React.isValidElement(inst))?process.env.NODE_ENV!=="production"?invariant(false,"%s(...): A valid React element (or null) must be returned. You may have returned undefined, an array or some other invalid object.",Component.displayName||Component.name||"Component"):_prodInvariant("105",Component.displayName||Component.name||"Component"):void 0;inst=new StatelessComponent(Component);this._compositeType=CompositeTypes.StatelessFunctional}else{if(isPureComponent(Component)){this._compositeType=CompositeTypes.PureClass}else{this._compositeType=CompositeTypes.ImpureClass}}if(process.env.NODE_ENV!=="production"){if(inst.render==null){process.env.NODE_ENV!=="production"?warning(false,"%s(...): No `render` method found on the returned component "+"instance: you may have forgotten to define `render`.",Component.displayName||Component.name||"Component"):void 0}var propsMutated=inst.props!==publicProps;var componentName=Component.displayName||Component.name||"Component";process.env.NODE_ENV!=="production"?warning(inst.props===undefined||!propsMutated,"%s(...): When calling super() in `%s`, make sure to pass "+"up the same props that your component's constructor was passed.",componentName,componentName):void 0}inst.props=publicProps;inst.context=publicContext;inst.refs=emptyObject;inst.updater=updateQueue;this._instance=inst;ReactInstanceMap.set(inst,this);if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(!inst.getInitialState||inst.getInitialState.isReactClassApproved||inst.state,"getInitialState was defined on %s, a plain JavaScript class. "+"This is only supported for classes created using React.createClass. "+"Did you mean to define a state property instead?",this.getName()||"a component"):void 0;process.env.NODE_ENV!=="production"?warning(!inst.getDefaultProps||inst.getDefaultProps.isReactClassApproved,"getDefaultProps was defined on %s, a plain JavaScript class. "+"This is only supported for classes created using React.createClass. "+"Use a static property to define defaultProps instead.",this.getName()||"a component"):void 0;process.env.NODE_ENV!=="production"?warning(!inst.propTypes,"propTypes was defined as an instance property on %s. Use a static "+"property to define propTypes instead.",this.getName()||"a component"):void 0;process.env.NODE_ENV!=="production"?warning(!inst.contextTypes,"contextTypes was defined as an instance property on %s. Use a "+"static property to define contextTypes instead.",this.getName()||"a component"):void 0;process.env.NODE_ENV!=="production"?warning(typeof inst.componentShouldUpdate!=="function","%s has a method called "+"componentShouldUpdate(). Did you mean shouldComponentUpdate()? "+"The name is phrased as a question because the function is "+"expected to return a value.",this.getName()||"A component"):void 0;process.env.NODE_ENV!=="production"?warning(typeof inst.componentDidUnmount!=="function","%s has a method called "+"componentDidUnmount(). But there is no such lifecycle method. "+"Did you mean componentWillUnmount()?",this.getName()||"A component"):void 0;process.env.NODE_ENV!=="production"?warning(typeof inst.componentWillRecieveProps!=="function","%s has a method called "+"componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",this.getName()||"A component"):void 0}var initialState=inst.state;if(initialState===undefined){inst.state=initialState=null}!(typeof initialState==="object"&&!Array.isArray(initialState))?process.env.NODE_ENV!=="production"?invariant(false,"%s.state: must be set to an object or null",this.getName()||"ReactCompositeComponent"):_prodInvariant("106",this.getName()||"ReactCompositeComponent"):void 0;this._pendingStateQueue=null;this._pendingReplaceState=false;this._pendingForceUpdate=false;var markup;if(inst.unstable_handleError){markup=this.performInitialMountWithErrorHandling(renderedElement,hostParent,hostContainerInfo,transaction,context)}else{markup=this.performInitialMount(renderedElement,hostParent,hostContainerInfo,transaction,context)}if(inst.componentDidMount){if(process.env.NODE_ENV!=="production"){transaction.getReactMountReady().enqueue(function(){measureLifeCyclePerf(function(){return inst.componentDidMount()},_this._debugID,"componentDidMount")})}else{transaction.getReactMountReady().enqueue(inst.componentDidMount,inst)}}return markup},_constructComponent:function(doConstruct,publicProps,publicContext,updateQueue){if(process.env.NODE_ENV!=="production"){ReactCurrentOwner.current=this;try{return this._constructComponentWithoutOwner(doConstruct,publicProps,publicContext,updateQueue)}finally{ReactCurrentOwner.current=null}}else{return this._constructComponentWithoutOwner(doConstruct,publicProps,publicContext,updateQueue)}},_constructComponentWithoutOwner:function(doConstruct,publicProps,publicContext,updateQueue){var Component=this._currentElement.type;if(doConstruct){if(process.env.NODE_ENV!=="production"){return measureLifeCyclePerf(function(){return new Component(publicProps,publicContext,updateQueue)},this._debugID,"ctor")}else{return new Component(publicProps,publicContext,updateQueue)}}if(process.env.NODE_ENV!=="production"){return measureLifeCyclePerf(function(){return Component(publicProps,publicContext,updateQueue)},this._debugID,"render")}else{return Component(publicProps,publicContext,updateQueue)}},performInitialMountWithErrorHandling:function(renderedElement,hostParent,hostContainerInfo,transaction,context){var markup;var checkpoint=transaction.checkpoint();try{markup=this.performInitialMount(renderedElement,hostParent,hostContainerInfo,transaction,context)}catch(e){transaction.rollback(checkpoint);this._instance.unstable_handleError(e);if(this._pendingStateQueue){this._instance.state=this._processPendingState(this._instance.props,this._instance.context)}checkpoint=transaction.checkpoint();this._renderedComponent.unmountComponent(true);transaction.rollback(checkpoint);markup=this.performInitialMount(renderedElement,hostParent,hostContainerInfo,transaction,context)}return markup},performInitialMount:function(renderedElement,hostParent,hostContainerInfo,transaction,context){var inst=this._instance;var debugID=0;if(process.env.NODE_ENV!=="production"){debugID=this._debugID}if(inst.componentWillMount){if(process.env.NODE_ENV!=="production"){measureLifeCyclePerf(function(){return inst.componentWillMount()},debugID,"componentWillMount")}else{inst.componentWillMount()}if(this._pendingStateQueue){inst.state=this._processPendingState(inst.props,inst.context)}}if(renderedElement===undefined){renderedElement=this._renderValidatedComponent()}var nodeType=ReactNodeTypes.getType(renderedElement);this._renderedNodeType=nodeType;var child=this._instantiateReactComponent(renderedElement,nodeType!==ReactNodeTypes.EMPTY);this._renderedComponent=child;var markup=ReactReconciler.mountComponent(child,transaction,hostParent,hostContainerInfo,this._processChildContext(context),debugID);if(process.env.NODE_ENV!=="production"){if(debugID!==0){var childDebugIDs=child._debugID!==0?[child._debugID]:[];ReactInstrumentation.debugTool.onSetChildren(debugID,childDebugIDs)}}return markup},getHostNode:function(){return ReactReconciler.getHostNode(this._renderedComponent)},unmountComponent:function(safely){if(!this._renderedComponent){return}var inst=this._instance;if(inst.componentWillUnmount&&!inst._calledComponentWillUnmount){inst._calledComponentWillUnmount=true;if(safely){var name=this.getName()+".componentWillUnmount()";ReactErrorUtils.invokeGuardedCallback(name,inst.componentWillUnmount.bind(inst))}else{if(process.env.NODE_ENV!=="production"){measureLifeCyclePerf(function(){return inst.componentWillUnmount()},this._debugID,"componentWillUnmount")}else{inst.componentWillUnmount()}}}if(this._renderedComponent){ReactReconciler.unmountComponent(this._renderedComponent,safely);this._renderedNodeType=null;this._renderedComponent=null;this._instance=null}this._pendingStateQueue=null;this._pendingReplaceState=false;this._pendingForceUpdate=false;this._pendingCallbacks=null;this._pendingElement=null;this._context=null;this._rootNodeID=0;this._topLevelWrapper=null;ReactInstanceMap.remove(inst)},_maskContext:function(context){var Component=this._currentElement.type;var contextTypes=Component.contextTypes;if(!contextTypes){return emptyObject}var maskedContext={};for(var contextName in contextTypes){maskedContext[contextName]=context[contextName]}return maskedContext},_processContext:function(context){var maskedContext=this._maskContext(context);if(process.env.NODE_ENV!=="production"){var Component=this._currentElement.type;if(Component.contextTypes){this._checkContextTypes(Component.contextTypes,maskedContext,"context")}}return maskedContext},_processChildContext:function(currentContext){var Component=this._currentElement.type;var inst=this._instance;var childContext;if(inst.getChildContext){if(process.env.NODE_ENV!=="production"){ReactInstrumentation.debugTool.onBeginProcessingChildContext();try{childContext=inst.getChildContext()}finally{ReactInstrumentation.debugTool.onEndProcessingChildContext()}}else{childContext=inst.getChildContext()}}if(childContext){!(typeof Component.childContextTypes==="object")?process.env.NODE_ENV!=="production"?invariant(false,"%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",this.getName()||"ReactCompositeComponent"):_prodInvariant("107",this.getName()||"ReactCompositeComponent"):void 0;if(process.env.NODE_ENV!=="production"){this._checkContextTypes(Component.childContextTypes,childContext,"child context")}for(var name in childContext){!(name in Component.childContextTypes)?process.env.NODE_ENV!=="production"?invariant(false,'%s.getChildContext(): key "%s" is not defined in childContextTypes.',this.getName()||"ReactCompositeComponent",name):_prodInvariant("108",this.getName()||"ReactCompositeComponent",name):void 0}return _assign({},currentContext,childContext)}return currentContext},_checkContextTypes:function(typeSpecs,values,location){if(process.env.NODE_ENV!=="production"){checkReactTypeSpec(typeSpecs,values,location,this.getName(),null,this._debugID)}},receiveComponent:function(nextElement,transaction,nextContext){var prevElement=this._currentElement;var prevContext=this._context;this._pendingElement=null;this.updateComponent(transaction,prevElement,nextElement,prevContext,nextContext)},performUpdateIfNecessary:function(transaction){if(this._pendingElement!=null){ReactReconciler.receiveComponent(this,this._pendingElement,transaction,this._context)}else if(this._pendingStateQueue!==null||this._pendingForceUpdate){this.updateComponent(transaction,this._currentElement,this._currentElement,this._context,this._context)}else{this._updateBatchNumber=null}},updateComponent:function(transaction,prevParentElement,nextParentElement,prevUnmaskedContext,nextUnmaskedContext){var inst=this._instance;!(inst!=null)?process.env.NODE_ENV!=="production"?invariant(false,"Attempted to update component `%s` that has already been unmounted (or failed to mount).",this.getName()||"ReactCompositeComponent"):_prodInvariant("136",this.getName()||"ReactCompositeComponent"):void 0;var willReceive=false;var nextContext;if(this._context===nextUnmaskedContext){nextContext=inst.context}else{nextContext=this._processContext(nextUnmaskedContext);willReceive=true}var prevProps=prevParentElement.props;var nextProps=nextParentElement.props;if(prevParentElement!==nextParentElement){willReceive=true}if(willReceive&&inst.componentWillReceiveProps){if(process.env.NODE_ENV!=="production"){measureLifeCyclePerf(function(){return inst.componentWillReceiveProps(nextProps,nextContext)},this._debugID,"componentWillReceiveProps")}else{inst.componentWillReceiveProps(nextProps,nextContext)}}var nextState=this._processPendingState(nextProps,nextContext);var shouldUpdate=true;if(!this._pendingForceUpdate){if(inst.shouldComponentUpdate){if(process.env.NODE_ENV!=="production"){shouldUpdate=measureLifeCyclePerf(function(){return inst.shouldComponentUpdate(nextProps,nextState,nextContext)},this._debugID,"shouldComponentUpdate")}else{shouldUpdate=inst.shouldComponentUpdate(nextProps,nextState,nextContext)}}else{if(this._compositeType===CompositeTypes.PureClass){shouldUpdate=!shallowEqual(prevProps,nextProps)||!shallowEqual(inst.state,nextState)}}}if(process.env.NODE_ENV!=="production"){process.env.NODE_ENV!=="production"?warning(shouldUpdate!==undefined,"%s.shouldComponentUpdate(): Returned undefined instead of a "+"boolean value. Make sure to return true or false.",this.getName()||"ReactCompositeComponent"):void 0}this._updateBatchNumber=null;if(shouldUpdate){this._pendingForceUpdate=false;this._performComponentUpdate(nextParentElement,nextProps,nextState,nextContext,transaction,nextUnmaskedContext)}else{this._currentElement=nextParentElement;this._context=nextUnmaskedContext;inst.props=nextProps;inst.state=nextState;inst.context=nextContext}},_processPendingState:function(props,context){var inst=this._instance;var queue=this._pendingStateQueue;var replace=this._pendingReplaceState;this._pendingReplaceState=false;this._pendingStateQueue=null;if(!queue){return inst.state}if(replace&&queue.length===1){return queue[0]}var nextState=_assign({},replace?queue[0]:inst.state);for(var i=replace?1:0;i<queue.length;i++){var partial=queue[i];_assign(nextState,typeof partial==="function"?partial.call(inst,nextState,props,context):partial)}return nextState},_performComponentUpdate:function(nextElement,nextProps,nextState,nextContext,transaction,unmaskedContext){var _this2=this;var inst=this._instance;var hasComponentDidUpdate=Boolean(inst.componentDidUpdate);var prevProps;var prevState;var prevContext;if(hasComponentDidUpdate){prevProps=inst.props;prevState=inst.state;prevContext=inst.context}if(inst.componentWillUpdate){if(process.env.NODE_ENV!=="production"){measureLifeCyclePerf(function(){return inst.componentWillUpdate(nextProps,nextState,nextContext)},this._debugID,"componentWillUpdate")}else{inst.componentWillUpdate(nextProps,nextState,nextContext)}}this._currentElement=nextElement;this._context=unmaskedContext;inst.props=nextProps;inst.state=nextState;inst.context=nextContext;this._updateRenderedComponent(transaction,unmaskedContext);if(hasComponentDidUpdate){if(process.env.NODE_ENV!=="production"){transaction.getReactMountReady().enqueue(function(){measureLifeCyclePerf(inst.componentDidUpdate.bind(inst,prevProps,prevState,prevContext),_this2._debugID,"componentDidUpdate")})}else{transaction.getReactMountReady().enqueue(inst.componentDidUpdate.bind(inst,prevProps,prevState,prevContext),inst)}}},_updateRenderedComponent:function(transaction,context){var prevComponentInstance=this._renderedComponent;var prevRenderedElement=prevComponentInstance._currentElement;var nextRenderedElement=this._renderValidatedComponent();var debugID=0;if(process.env.NODE_ENV!=="production"){debugID=this._debugID}if(shouldUpdateReactComponent(prevRenderedElement,nextRenderedElement)){ReactReconciler.receiveComponent(prevComponentInstance,nextRenderedElement,transaction,this._processChildContext(context))}else{var oldHostNode=ReactReconciler.getHostNode(prevComponentInstance);ReactReconciler.unmountComponent(prevComponentInstance,false);var nodeType=ReactNodeTypes.getType(nextRenderedElement);this._renderedNodeType=nodeType;var child=this._instantiateReactComponent(nextRenderedElement,nodeType!==ReactNodeTypes.EMPTY);this._renderedComponent=child;var nextMarkup=ReactReconciler.mountComponent(child,transaction,this._hostParent,this._hostContainerInfo,this._processChildContext(context),debugID);if(process.env.NODE_ENV!=="production"){if(debugID!==0){var childDebugIDs=child._debugID!==0?[child._debugID]:[];ReactInstrumentation.debugTool.onSetChildren(debugID,childDebugIDs)}}this._replaceNodeWithMarkup(oldHostNode,nextMarkup,prevComponentInstance)}},_replaceNodeWithMarkup:function(oldHostNode,nextMarkup,prevInstance){ReactComponentEnvironment.replaceNodeWithMarkup(oldHostNode,nextMarkup,prevInstance)},_renderValidatedComponentWithoutOwnerOrContext:function(){var inst=this._instance;var renderedElement;if(process.env.NODE_ENV!=="production"){renderedElement=measureLifeCyclePerf(function(){return inst.render()},this._debugID,"render")}else{renderedElement=inst.render()}if(process.env.NODE_ENV!=="production"){if(renderedElement===undefined&&inst.render._isMockFunction){renderedElement=null}}return renderedElement},_renderValidatedComponent:function(){var renderedElement;if(process.env.NODE_ENV!=="production"||this._compositeType!==CompositeTypes.StatelessFunctional){ReactCurrentOwner.current=this;try{renderedElement=this._renderValidatedComponentWithoutOwnerOrContext()}finally{ReactCurrentOwner.current=null}}else{renderedElement=this._renderValidatedComponentWithoutOwnerOrContext()}!(renderedElement===null||renderedElement===false||React.isValidElement(renderedElement))?process.env.NODE_ENV!=="production"?invariant(false,"%s.render(): A valid React element (or null) must be returned. You may have returned undefined, an array or some other invalid object.",this.getName()||"ReactCompositeComponent"):_prodInvariant("109",this.getName()||"ReactCompositeComponent"):void 0;return renderedElement},attachRef:function(ref,component){var inst=this.getPublicInstance();!(inst!=null)?process.env.NODE_ENV!=="production"?invariant(false,"Stateless function components cannot have refs."):_prodInvariant("110"):void 0;var publicComponentInstance=component.getPublicInstance();if(process.env.NODE_ENV!=="production"){var componentName=component&&component.getName?component.getName():"a component";process.env.NODE_ENV!=="production"?warning(publicComponentInstance!=null||component._compositeType!==CompositeTypes.StatelessFunctional,"Stateless function components cannot be given refs "+'(See ref "%s" in %s created by %s). '+"Attempts to access this ref will fail.",ref,componentName,this.getName()):void 0}var refs=inst.refs===emptyObject?inst.refs={}:inst.refs;refs[ref]=publicComponentInstance},detachRef:function(ref){var refs=this.getPublicInstance().refs;delete refs[ref]},getName:function(){var type=this._currentElement.type;var constructor=this._instance&&this._instance.constructor;return type.displayName||constructor&&constructor.displayName||type.name||constructor&&constructor.name||null},getPublicInstance:function(){var inst=this._instance;if(this._compositeType===CompositeTypes.StatelessFunctional){return null}return inst},_instantiateReactComponent:null};module.exports=ReactCompositeComponent}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactPropTypeLocationNames=__webpack_require__(281);var ReactPropTypesSecret=__webpack_require__(124);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&process.env.NODE_ENV==="test"){ReactComponentTreeHook=__webpack_require__(9)}var loggedTypeFailures={};function checkReactTypeSpec(typeSpecs,values,location,componentName,element,debugID){for(var typeSpecName in typeSpecs){if(typeSpecs.hasOwnProperty(typeSpecName)){var error;try{!(typeof typeSpecs[typeSpecName]==="function")?process.env.NODE_ENV!=="production"?invariant(false,"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):_prodInvariant("84",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName):void 0;error=typeSpecs[typeSpecName](values,typeSpecName,componentName,location,null,ReactPropTypesSecret)}catch(ex){error=ex}process.env.NODE_ENV!=="production"?warning(!error||error instanceof Error,"%s: type specification of %s `%s` is invalid; the type checker "+"function must return `null` or an `Error` but returned a %s. "+"You may have forgotten to pass an argument to the type checker "+"creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and "+"shape all require an argument).",componentName||"React class",ReactPropTypeLocationNames[location],typeSpecName,typeof error):void 0;if(error instanceof Error&&!(error.message in loggedTypeFailures)){loggedTypeFailures[error.message]=true;var componentStackInfo="";if(process.env.NODE_ENV!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=__webpack_require__(9)}if(debugID!==null){componentStackInfo=ReactComponentTreeHook.getStackAddendumByID(debugID)}else if(element!==null){componentStackInfo=ReactComponentTreeHook.getCurrentStackAddendum(element)}}process.env.NODE_ENV!=="production"?warning(false,"Failed %s type: %s%s",location,error.message,componentStackInfo):void 0}}}}module.exports=checkReactTypeSpec}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactPropTypeLocationNames={};if(process.env.NODE_ENV!=="production"){ReactPropTypeLocationNames={prop:"prop",context:"context",childContext:"child context"}}module.exports=ReactPropTypeLocationNames}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var nextDebugID=1;function getNextDebugID(){return nextDebugID++}module.exports=getNextDebugID},function(module,exports,__webpack_require__){"use strict";var REACT_ELEMENT_TYPE=typeof Symbol==="function"&&Symbol["for"]&&Symbol["for"]("react.element")||60103;module.exports=REACT_ELEMENT_TYPE},function(module,exports,__webpack_require__){"use strict";var ITERATOR_SYMBOL=typeof Symbol==="function"&&Symbol.iterator;var FAUX_ITERATOR_SYMBOL="@@iterator";function getIteratorFn(maybeIterable){var iteratorFn=maybeIterable&&(ITERATOR_SYMBOL&&maybeIterable[ITERATOR_SYMBOL]||maybeIterable[FAUX_ITERATOR_SYMBOL]);if(typeof iteratorFn==="function"){return iteratorFn}}module.exports=getIteratorFn},function(module,exports,__webpack_require__){"use strict";(function(process){var KeyEscapeUtils=__webpack_require__(86);var traverseAllChildren=__webpack_require__(130);var warning=__webpack_require__(2);var ReactComponentTreeHook;if(typeof process!=="undefined"&&process.env&&process.env.NODE_ENV==="test"){ReactComponentTreeHook=__webpack_require__(9)}function flattenSingleChildIntoContext(traverseContext,child,name,selfDebugID){if(traverseContext&&typeof traverseContext==="object"){var result=traverseContext;var keyUnique=result[name]===undefined;if(process.env.NODE_ENV!=="production"){if(!ReactComponentTreeHook){ReactComponentTreeHook=__webpack_require__(9)}if(!keyUnique){process.env.NODE_ENV!=="production"?warning(false,"flattenChildren(...): Encountered two children with the same key, "+"`%s`. Child keys must be unique; when two children share a key, only "+"the first child will be used.%s",KeyEscapeUtils.unescape(name),ReactComponentTreeHook.getStackAddendumByID(selfDebugID)):void 0}}if(keyUnique&&child!=null){result[name]=child}}}function flattenChildren(children,selfDebugID){if(children==null){return children}var result={};if(process.env.NODE_ENV!=="production"){traverseAllChildren(children,function(traverseContext,child,name){return flattenSingleChildIntoContext(traverseContext,child,name,selfDebugID)},result)}else{traverseAllChildren(children,flattenSingleChildIntoContext,result)}return result}module.exports=flattenChildren}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var PooledClass=__webpack_require__(23);var Transaction=__webpack_require__(50);var ReactInstrumentation=__webpack_require__(12);var ReactServerUpdateQueue=__webpack_require__(287);var TRANSACTION_WRAPPERS=[];if(process.env.NODE_ENV!=="production"){TRANSACTION_WRAPPERS.push({initialize:ReactInstrumentation.debugTool.onBeginFlush,close:ReactInstrumentation.debugTool.onEndFlush})}var noopCallbackQueue={enqueue:function(){}};function ReactServerRenderingTransaction(renderToStaticMarkup){this.reinitializeTransaction();this.renderToStaticMarkup=renderToStaticMarkup;this.useCreateElement=false;this.updateQueue=new ReactServerUpdateQueue(this)}var Mixin={getTransactionWrappers:function(){return TRANSACTION_WRAPPERS},getReactMountReady:function(){return noopCallbackQueue},getUpdateQueue:function(){return this.updateQueue},destructor:function(){},checkpoint:function(){},rollback:function(){}};_assign(ReactServerRenderingTransaction.prototype,Transaction,Mixin);PooledClass.addPoolingTo(ReactServerRenderingTransaction);module.exports=ReactServerRenderingTransaction}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var ReactUpdateQueue=__webpack_require__(87);var warning=__webpack_require__(2);function warnNoop(publicInstance,callerName){if(process.env.NODE_ENV!=="production"){var constructor=publicInstance.constructor;process.env.NODE_ENV!=="production"?warning(false,"%s(...): Can only update a mounting component. "+"This usually means you called %s() outside componentWillMount() on the server. "+"This is a no-op. Please check the code for the %s component.",callerName,callerName,constructor&&(constructor.displayName||constructor.name)||"ReactClass"):void 0}}var ReactServerUpdateQueue=function(){function ReactServerUpdateQueue(transaction){_classCallCheck(this,ReactServerUpdateQueue);this.transaction=transaction}ReactServerUpdateQueue.prototype.isMounted=function isMounted(publicInstance){return false};ReactServerUpdateQueue.prototype.enqueueCallback=function enqueueCallback(publicInstance,callback,callerName){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueCallback(publicInstance,callback,callerName)}};ReactServerUpdateQueue.prototype.enqueueForceUpdate=function enqueueForceUpdate(publicInstance){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueForceUpdate(publicInstance)}else{warnNoop(publicInstance,"forceUpdate")}};ReactServerUpdateQueue.prototype.enqueueReplaceState=function enqueueReplaceState(publicInstance,completeState){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueReplaceState(publicInstance,completeState)}else{warnNoop(publicInstance,"replaceState")}};ReactServerUpdateQueue.prototype.enqueueSetState=function enqueueSetState(publicInstance,partialState){if(this.transaction.isInTransaction()){ReactUpdateQueue.enqueueSetState(publicInstance,partialState)}else{warnNoop(publicInstance,"setState")}};return ReactServerUpdateQueue}();module.exports=ReactServerUpdateQueue}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(4);var DOMLazyTree=__webpack_require__(32);var ReactDOMComponentTree=__webpack_require__(5);var ReactDOMEmptyComponent=function(instantiate){this._currentElement=null;this._hostNode=null;this._hostParent=null;this._hostContainerInfo=null;this._domID=0};_assign(ReactDOMEmptyComponent.prototype,{mountComponent:function(transaction,hostParent,hostContainerInfo,context){var domID=hostContainerInfo._idCounter++;this._domID=domID;this._hostParent=hostParent;this._hostContainerInfo=hostContainerInfo;var nodeValue=" react-empty: "+this._domID+" ";if(transaction.useCreateElement){var ownerDocument=hostContainerInfo._ownerDocument;var node=ownerDocument.createComment(nodeValue);ReactDOMComponentTree.precacheNode(this,node);return DOMLazyTree(node)}else{if(transaction.renderToStaticMarkup){return""}return"\x3c!--"+nodeValue+"--\x3e"}},receiveComponent:function(){},getHostNode:function(){return ReactDOMComponentTree.getNodeFromInstance(this)},unmountComponent:function(){ReactDOMComponentTree.uncacheNode(this)}});module.exports=ReactDOMEmptyComponent},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var invariant=__webpack_require__(1);function getLowestCommonAncestor(instA,instB){!("_hostNode"in instA)?process.env.NODE_ENV!=="production"?invariant(false,"getNodeFromInstance: Invalid argument."):_prodInvariant("33"):void 0;!("_hostNode"in instB)?process.env.NODE_ENV!=="production"?invariant(false,"getNodeFromInstance: Invalid argument."):_prodInvariant("33"):void 0;var depthA=0;for(var tempA=instA;tempA;tempA=tempA._hostParent){depthA++}var depthB=0;for(var tempB=instB;tempB;tempB=tempB._hostParent){depthB++}while(depthA-depthB>0){instA=instA._hostParent;depthA--}while(depthB-depthA>0){instB=instB._hostParent;depthB--}var depth=depthA;while(depth--){if(instA===instB){return instA}instA=instA._hostParent;instB=instB._hostParent}return null}function isAncestor(instA,instB){!("_hostNode"in instA)?process.env.NODE_ENV!=="production"?invariant(false,"isAncestor: Invalid argument."):_prodInvariant("35"):void 0;!("_hostNode"in instB)?process.env.NODE_ENV!=="production"?invariant(false,"isAncestor: Invalid argument."):_prodInvariant("35"):void 0;while(instB){if(instB===instA){return true}instB=instB._hostParent}return false}function getParentInstance(inst){!("_hostNode"in inst)?process.env.NODE_ENV!=="production"?invariant(false,"getParentInstance: Invalid argument."):_prodInvariant("36"):void 0;return inst._hostParent}function traverseTwoPhase(inst,fn,arg){var path=[];while(inst){path.push(inst);inst=inst._hostParent}var i;for(i=path.length;i-- >0;){fn(path[i],"captured",arg)}for(i=0;i<path.length;i++){fn(path[i],"bubbled",arg)}}function traverseEnterLeave(from,to,fn,argFrom,argTo){var common=from&&to?getLowestCommonAncestor(from,to):null;var pathFrom=[];while(from&&from!==common){pathFrom.push(from);from=from._hostParent}var pathTo=[];while(to&&to!==common){pathTo.push(to);to=to._hostParent}var i;for(i=0;i<pathFrom.length;i++){fn(pathFrom[i],"bubbled",argFrom)}for(i=pathTo.length;i-- >0;){fn(pathTo[i],"captured",argTo)}}module.exports={isAncestor:isAncestor,getLowestCommonAncestor:getLowestCommonAncestor,getParentInstance:getParentInstance,traverseTwoPhase:traverseTwoPhase,traverseEnterLeave:traverseEnterLeave}}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3),_assign=__webpack_require__(4);var DOMChildrenOperations=__webpack_require__(79);var DOMLazyTree=__webpack_require__(32);var ReactDOMComponentTree=__webpack_require__(5);var escapeTextContentForBrowser=__webpack_require__(53);var invariant=__webpack_require__(1);var validateDOMNesting=__webpack_require__(88);var ReactDOMTextComponent=function(text){this._currentElement=text;this._stringText=""+text;this._hostNode=null;this._hostParent=null;this._domID=0;this._mountIndex=0;this._closingComment=null;this._commentNodes=null};_assign(ReactDOMTextComponent.prototype,{mountComponent:function(transaction,hostParent,hostContainerInfo,context){if(process.env.NODE_ENV!=="production"){var parentInfo;if(hostParent!=null){parentInfo=hostParent._ancestorInfo}else if(hostContainerInfo!=null){parentInfo=hostContainerInfo._ancestorInfo}if(parentInfo){validateDOMNesting(null,this._stringText,this,parentInfo)}}var domID=hostContainerInfo._idCounter++;var openingValue=" react-text: "+domID+" ";var closingValue=" /react-text ";this._domID=domID;this._hostParent=hostParent;if(transaction.useCreateElement){var ownerDocument=hostContainerInfo._ownerDocument;var openingComment=ownerDocument.createComment(openingValue);var closingComment=ownerDocument.createComment(closingValue);var lazyTree=DOMLazyTree(ownerDocument.createDocumentFragment());DOMLazyTree.queueChild(lazyTree,DOMLazyTree(openingComment));if(this._stringText){DOMLazyTree.queueChild(lazyTree,DOMLazyTree(ownerDocument.createTextNode(this._stringText)))}DOMLazyTree.queueChild(lazyTree,DOMLazyTree(closingComment));ReactDOMComponentTree.precacheNode(this,openingComment);this._closingComment=closingComment;return lazyTree}else{var escapedText=escapeTextContentForBrowser(this._stringText);if(transaction.renderToStaticMarkup){return escapedText}return"\x3c!--"+openingValue+"--\x3e"+escapedText+"\x3c!--"+closingValue+"--\x3e"}},receiveComponent:function(nextText,transaction){if(nextText!==this._currentElement){this._currentElement=nextText;var nextStringText=""+nextText;if(nextStringText!==this._stringText){this._stringText=nextStringText;var commentNodes=this.getHostNode();DOMChildrenOperations.replaceDelimitedText(commentNodes[0],commentNodes[1],nextStringText)}}},getHostNode:function(){var hostNode=this._commentNodes;if(hostNode){return hostNode}if(!this._closingComment){var openingComment=ReactDOMComponentTree.getNodeFromInstance(this);var node=openingComment.nextSibling;while(true){!(node!=null)?process.env.NODE_ENV!=="production"?invariant(false,"Missing closing comment for text component %s",this._domID):_prodInvariant("67",this._domID):void 0;if(node.nodeType===8&&node.nodeValue===" /react-text "){this._closingComment=node;break}node=node.nextSibling}}hostNode=[this._hostNode,this._closingComment];this._commentNodes=hostNode;return hostNode},unmountComponent:function(){this._closingComment=null;this._commentNodes=null;ReactDOMComponentTree.uncacheNode(this)}});module.exports=ReactDOMTextComponent}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(4);var ReactUpdates=__webpack_require__(16);var Transaction=__webpack_require__(50);var emptyFunction=__webpack_require__(10);var RESET_BATCHED_UPDATES={initialize:emptyFunction,close:function(){ReactDefaultBatchingStrategy.isBatchingUpdates=false}};var FLUSH_BATCHED_UPDATES={initialize:emptyFunction,close:ReactUpdates.flushBatchedUpdates.bind(ReactUpdates)};var TRANSACTION_WRAPPERS=[FLUSH_BATCHED_UPDATES,RESET_BATCHED_UPDATES];function ReactDefaultBatchingStrategyTransaction(){this.reinitializeTransaction()}_assign(ReactDefaultBatchingStrategyTransaction.prototype,Transaction,{getTransactionWrappers:function(){return TRANSACTION_WRAPPERS}});var transaction=new ReactDefaultBatchingStrategyTransaction;var ReactDefaultBatchingStrategy={isBatchingUpdates:false,batchedUpdates:function(callback,a,b,c,d,e){var alreadyBatchingUpdates=ReactDefaultBatchingStrategy.isBatchingUpdates;ReactDefaultBatchingStrategy.isBatchingUpdates=true;if(alreadyBatchingUpdates){return callback(a,b,c,d,e)}else{return transaction.perform(callback,null,a,b,c,d,e)}}};module.exports=ReactDefaultBatchingStrategy},function(module,exports,__webpack_require__){"use strict";var _assign=__webpack_require__(4);var EventListener=__webpack_require__(131);var ExecutionEnvironment=__webpack_require__(7);var PooledClass=__webpack_require__(23);var ReactDOMComponentTree=__webpack_require__(5);var ReactUpdates=__webpack_require__(16);var getEventTarget=__webpack_require__(76);var getUnboundedScrollPosition=__webpack_require__(293);function findParent(inst){while(inst._hostParent){inst=inst._hostParent}var rootNode=ReactDOMComponentTree.getNodeFromInstance(inst);var container=rootNode.parentNode;return ReactDOMComponentTree.getClosestInstanceFromNode(container)}function TopLevelCallbackBookKeeping(topLevelType,nativeEvent){this.topLevelType=topLevelType;this.nativeEvent=nativeEvent;this.ancestors=[]}_assign(TopLevelCallbackBookKeeping.prototype,{destructor:function(){this.topLevelType=null;this.nativeEvent=null;this.ancestors.length=0}});PooledClass.addPoolingTo(TopLevelCallbackBookKeeping,PooledClass.twoArgumentPooler);function handleTopLevelImpl(bookKeeping){var nativeEventTarget=getEventTarget(bookKeeping.nativeEvent);var targetInst=ReactDOMComponentTree.getClosestInstanceFromNode(nativeEventTarget);var ancestor=targetInst;do{bookKeeping.ancestors.push(ancestor);ancestor=ancestor&&findParent(ancestor)}while(ancestor);for(var i=0;i<bookKeeping.ancestors.length;i++){targetInst=bookKeeping.ancestors[i];ReactEventListener._handleTopLevel(bookKeeping.topLevelType,targetInst,bookKeeping.nativeEvent,getEventTarget(bookKeeping.nativeEvent))}}function scrollValueMonitor(cb){var scrollPosition=getUnboundedScrollPosition(window);cb(scrollPosition)}var ReactEventListener={_enabled:true,_handleTopLevel:null,WINDOW_HANDLE:ExecutionEnvironment.canUseDOM?window:null,setHandleTopLevel:function(handleTopLevel){ReactEventListener._handleTopLevel=handleTopLevel},setEnabled:function(enabled){ReactEventListener._enabled=!!enabled},isEnabled:function(){return ReactEventListener._enabled},trapBubbledEvent:function(topLevelType,handlerBaseName,element){if(!element){return null}return EventListener.listen(element,handlerBaseName,ReactEventListener.dispatchEvent.bind(null,topLevelType))},trapCapturedEvent:function(topLevelType,handlerBaseName,element){if(!element){return null}return EventListener.capture(element,handlerBaseName,ReactEventListener.dispatchEvent.bind(null,topLevelType))},monitorScrollValue:function(refresh){var callback=scrollValueMonitor.bind(null,refresh);EventListener.listen(window,"scroll",callback)},dispatchEvent:function(topLevelType,nativeEvent){if(!ReactEventListener._enabled){return}var bookKeeping=TopLevelCallbackBookKeeping.getPooled(topLevelType,nativeEvent);try{ReactUpdates.batchedUpdates(handleTopLevelImpl,bookKeeping)}finally{TopLevelCallbackBookKeeping.release(bookKeeping)}}};module.exports=ReactEventListener},function(module,exports,__webpack_require__){"use strict";function getUnboundedScrollPosition(scrollable){if(scrollable.Window&&scrollable instanceof scrollable.Window){return{x:scrollable.pageXOffset||scrollable.document.documentElement.scrollLeft,y:scrollable.pageYOffset||scrollable.document.documentElement.scrollTop}}return{x:scrollable.scrollLeft,y:scrollable.scrollTop}}module.exports=getUnboundedScrollPosition},function(module,exports,__webpack_require__){"use strict";var DOMProperty=__webpack_require__(21);var EventPluginHub=__webpack_require__(40);var EventPluginUtils=__webpack_require__(74);var ReactComponentEnvironment=__webpack_require__(83);var ReactEmptyComponent=__webpack_require__(128);var ReactBrowserEventEmitter=__webpack_require__(54);var ReactHostComponent=__webpack_require__(129);var ReactUpdates=__webpack_require__(16);var ReactInjection={Component:ReactComponentEnvironment.injection,DOMProperty:DOMProperty.injection,EmptyComponent:ReactEmptyComponent.injection,EventPluginHub:EventPluginHub.injection,EventPluginUtils:EventPluginUtils.injection,EventEmitter:ReactBrowserEventEmitter.injection,HostComponent:ReactHostComponent.injection,Updates:ReactUpdates.injection};module.exports=ReactInjection},function(module,exports,__webpack_require__){"use strict";(function(process){var _assign=__webpack_require__(4);var CallbackQueue=__webpack_require__(115);var PooledClass=__webpack_require__(23);var ReactBrowserEventEmitter=__webpack_require__(54);var ReactInputSelection=__webpack_require__(132);var ReactInstrumentation=__webpack_require__(12);var Transaction=__webpack_require__(50);var ReactUpdateQueue=__webpack_require__(87);var SELECTION_RESTORATION={initialize:ReactInputSelection.getSelectionInformation,close:ReactInputSelection.restoreSelection};var EVENT_SUPPRESSION={initialize:function(){var currentlyEnabled=ReactBrowserEventEmitter.isEnabled();ReactBrowserEventEmitter.setEnabled(false);return currentlyEnabled},close:function(previouslyEnabled){ReactBrowserEventEmitter.setEnabled(previouslyEnabled)}};var ON_DOM_READY_QUEUEING={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}};var TRANSACTION_WRAPPERS=[SELECTION_RESTORATION,EVENT_SUPPRESSION,ON_DOM_READY_QUEUEING];if(process.env.NODE_ENV!=="production"){TRANSACTION_WRAPPERS.push({initialize:ReactInstrumentation.debugTool.onBeginFlush,close:ReactInstrumentation.debugTool.onEndFlush})}function ReactReconcileTransaction(useCreateElement){this.reinitializeTransaction();this.renderToStaticMarkup=false;this.reactMountReady=CallbackQueue.getPooled(null);this.useCreateElement=useCreateElement}var Mixin={getTransactionWrappers:function(){return TRANSACTION_WRAPPERS},getReactMountReady:function(){return this.reactMountReady},getUpdateQueue:function(){return ReactUpdateQueue},checkpoint:function(){return this.reactMountReady.checkpoint()},rollback:function(checkpoint){this.reactMountReady.rollback(checkpoint)},destructor:function(){CallbackQueue.release(this.reactMountReady);this.reactMountReady=null}};_assign(ReactReconcileTransaction.prototype,Transaction,Mixin);PooledClass.addPoolingTo(ReactReconcileTransaction);module.exports=ReactReconcileTransaction}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ExecutionEnvironment=__webpack_require__(7);var getNodeForCharacterOffset=__webpack_require__(297);var getTextContentAccessor=__webpack_require__(114);function isCollapsed(anchorNode,anchorOffset,focusNode,focusOffset){return anchorNode===focusNode&&anchorOffset===focusOffset}function getIEOffsets(node){var selection=document.selection;var selectedRange=selection.createRange();var selectedLength=selectedRange.text.length;var fromStart=selectedRange.duplicate();fromStart.moveToElementText(node);fromStart.setEndPoint("EndToStart",selectedRange);var startOffset=fromStart.text.length;var endOffset=startOffset+selectedLength;return{start:startOffset,end:endOffset}}function getModernOffsets(node){var selection=window.getSelection&&window.getSelection();if(!selection||selection.rangeCount===0){return null}var anchorNode=selection.anchorNode;var anchorOffset=selection.anchorOffset;var focusNode=selection.focusNode;var focusOffset=selection.focusOffset;var currentRange=selection.getRangeAt(0);try{currentRange.startContainer.nodeType;currentRange.endContainer.nodeType}catch(e){return null}var isSelectionCollapsed=isCollapsed(selection.anchorNode,selection.anchorOffset,selection.focusNode,selection.focusOffset);var rangeLength=isSelectionCollapsed?0:currentRange.toString().length;var tempRange=currentRange.cloneRange();tempRange.selectNodeContents(node);tempRange.setEnd(currentRange.startContainer,currentRange.startOffset);var isTempRangeCollapsed=isCollapsed(tempRange.startContainer,tempRange.startOffset,tempRange.endContainer,tempRange.endOffset);var start=isTempRangeCollapsed?0:tempRange.toString().length;var end=start+rangeLength;var detectionRange=document.createRange();detectionRange.setStart(anchorNode,anchorOffset);detectionRange.setEnd(focusNode,focusOffset);var isBackward=detectionRange.collapsed;return{start:isBackward?end:start,end:isBackward?start:end}}function setIEOffsets(node,offsets){var range=document.selection.createRange().duplicate();var start,end;if(offsets.end===undefined){start=offsets.start;end=start}else if(offsets.start>offsets.end){start=offsets.end;end=offsets.start}else{start=offsets.start;end=offsets.end}range.moveToElementText(node);range.moveStart("character",start);range.setEndPoint("EndToStart",range);range.moveEnd("character",end-start);range.select()}function setModernOffsets(node,offsets){if(!window.getSelection){return}var selection=window.getSelection();var length=node[getTextContentAccessor()].length;var start=Math.min(offsets.start,length);var end=offsets.end===undefined?start:Math.min(offsets.end,length);if(!selection.extend&&start>end){var temp=end;end=start;start=temp}var startMarker=getNodeForCharacterOffset(node,start);var endMarker=getNodeForCharacterOffset(node,end);if(startMarker&&endMarker){var range=document.createRange();range.setStart(startMarker.node,startMarker.offset);selection.removeAllRanges();if(start>end){selection.addRange(range);selection.extend(endMarker.node,endMarker.offset)}else{range.setEnd(endMarker.node,endMarker.offset);selection.addRange(range)}}}var useIEOffsets=ExecutionEnvironment.canUseDOM&&"selection"in document&&!("getSelection"in window);var ReactDOMSelection={getOffsets:useIEOffsets?getIEOffsets:getModernOffsets,setOffsets:useIEOffsets?setIEOffsets:setModernOffsets};module.exports=ReactDOMSelection},function(module,exports,__webpack_require__){"use strict";function getLeafNode(node){while(node&&node.firstChild){node=node.firstChild}return node}function getSiblingNode(node){while(node){if(node.nextSibling){return node.nextSibling}node=node.parentNode}}function getNodeForCharacterOffset(root,offset){var node=getLeafNode(root);var nodeStart=0;var nodeEnd=0;while(node){if(node.nodeType===3){nodeEnd=nodeStart+node.textContent.length;if(nodeStart<=offset&&nodeEnd>=offset){return{node:node,offset:offset-nodeStart}}nodeStart=nodeEnd}node=getLeafNode(getSiblingNode(node))}}module.exports=getNodeForCharacterOffset},function(module,exports,__webpack_require__){"use strict";var isTextNode=__webpack_require__(299);function containsNode(outerNode,innerNode){if(!outerNode||!innerNode){return false}else if(outerNode===innerNode){return true}else if(isTextNode(outerNode)){return false}else if(isTextNode(innerNode)){return containsNode(outerNode,innerNode.parentNode)}else if("contains"in outerNode){return outerNode.contains(innerNode)}else if(outerNode.compareDocumentPosition){return!!(outerNode.compareDocumentPosition(innerNode)&16)}else{return false}}module.exports=containsNode},function(module,exports,__webpack_require__){"use strict";var isNode=__webpack_require__(300);function isTextNode(object){return isNode(object)&&object.nodeType==3}module.exports=isTextNode},function(module,exports,__webpack_require__){"use strict";function isNode(object){var doc=object?object.ownerDocument||object:document;var defaultView=doc.defaultView||window;return!!(object&&(typeof defaultView.Node==="function"?object instanceof defaultView.Node:typeof object==="object"&&typeof object.nodeType==="number"&&typeof object.nodeName==="string"))}module.exports=isNode},function(module,exports,__webpack_require__){"use strict";var NS={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};var ATTRS={accentHeight:"accent-height",accumulate:0,additive:0,alignmentBaseline:"alignment-baseline",allowReorder:"allowReorder",alphabetic:0,amplitude:0,arabicForm:"arabic-form",ascent:0,attributeName:"attributeName",attributeType:"attributeType",autoReverse:"autoReverse",azimuth:0,baseFrequency:"baseFrequency",baseProfile:"baseProfile",baselineShift:"baseline-shift",bbox:0,begin:0,bias:0,by:0,calcMode:"calcMode",capHeight:"cap-height",clip:0,clipPath:"clip-path",clipRule:"clip-rule",clipPathUnits:"clipPathUnits",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",contentScriptType:"contentScriptType",contentStyleType:"contentStyleType",cursor:0,cx:0,cy:0,d:0,decelerate:0,descent:0,diffuseConstant:"diffuseConstant",direction:0,display:0,divisor:0,dominantBaseline:"dominant-baseline",dur:0,dx:0,dy:0,edgeMode:"edgeMode",elevation:0,enableBackground:"enable-background",end:0,exponent:0,externalResourcesRequired:"externalResourcesRequired",fill:0,fillOpacity:"fill-opacity",fillRule:"fill-rule",filter:0,filterRes:"filterRes",filterUnits:"filterUnits",floodColor:"flood-color",floodOpacity:"flood-opacity",focusable:0,fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",format:0,from:0,fx:0,fy:0,g1:0,g2:0,glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",glyphRef:"glyphRef",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",hanging:0,horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",ideographic:0,imageRendering:"image-rendering",in:0,in2:0,intercept:0,k:0,k1:0,k2:0,k3:0,k4:0,kernelMatrix:"kernelMatrix",kernelUnitLength:"kernelUnitLength",kerning:0,keyPoints:"keyPoints",keySplines:"keySplines",keyTimes:"keyTimes",lengthAdjust:"lengthAdjust",letterSpacing:"letter-spacing",lightingColor:"lighting-color",limitingConeAngle:"limitingConeAngle",local:0,markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",markerHeight:"markerHeight",markerUnits:"markerUnits",markerWidth:"markerWidth",mask:0,maskContentUnits:"maskContentUnits",maskUnits:"maskUnits",mathematical:0,mode:0,numOctaves:"numOctaves",offset:0,opacity:0,operator:0,order:0,orient:0,orientation:0,origin:0,overflow:0,overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pathLength:"pathLength",patternContentUnits:"patternContentUnits",patternTransform:"patternTransform",patternUnits:"patternUnits",pointerEvents:"pointer-events",points:0,pointsAtX:"pointsAtX",pointsAtY:"pointsAtY",pointsAtZ:"pointsAtZ",preserveAlpha:"preserveAlpha",preserveAspectRatio:"preserveAspectRatio",primitiveUnits:"primitiveUnits",r:0,radius:0,refX:"refX",refY:"refY",renderingIntent:"rendering-intent",repeatCount:"repeatCount",repeatDur:"repeatDur",requiredExtensions:"requiredExtensions",requiredFeatures:"requiredFeatures",restart:0,result:0,rotate:0,rx:0,ry:0,scale:0,seed:0,shapeRendering:"shape-rendering",slope:0,spacing:0,specularConstant:"specularConstant",specularExponent:"specularExponent",speed:0,spreadMethod:"spreadMethod",startOffset:"startOffset",stdDeviation:"stdDeviation",stemh:0,stemv:0,stitchTiles:"stitchTiles",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",string:0,stroke:0,strokeDasharray:"stroke-dasharray",strokeDashoffset:"stroke-dashoffset",strokeLinecap:"stroke-linecap",strokeLinejoin:"stroke-linejoin",strokeMiterlimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",surfaceScale:"surfaceScale",systemLanguage:"systemLanguage",tableValues:"tableValues",targetX:"targetX",targetY:"targetY",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",textLength:"textLength",to:0,transform:0,u1:0,u2:0,underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicode:0,unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",values:0,vectorEffect:"vector-effect",version:0,vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",viewBox:"viewBox",viewTarget:"viewTarget",visibility:0,widths:0,wordSpacing:"word-spacing",writingMode:"writing-mode",x:0,xHeight:"x-height",x1:0,x2:0,xChannelSelector:"xChannelSelector",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlns:0,xmlnsXlink:"xmlns:xlink",xmlLang:"xml:lang",xmlSpace:"xml:space",y:0,y1:0,y2:0,yChannelSelector:"yChannelSelector",z:0,zoomAndPan:"zoomAndPan"};var SVGDOMPropertyConfig={Properties:{},DOMAttributeNamespaces:{xlinkActuate:NS.xlink,xlinkArcrole:NS.xlink,xlinkHref:NS.xlink,xlinkRole:NS.xlink,xlinkShow:NS.xlink,xlinkTitle:NS.xlink,xlinkType:NS.xlink,xmlBase:NS.xml,xmlLang:NS.xml,xmlSpace:NS.xml},DOMAttributeNames:{}};Object.keys(ATTRS).forEach(function(key){SVGDOMPropertyConfig.Properties[key]=0;if(ATTRS[key]){SVGDOMPropertyConfig.DOMAttributeNames[key]=ATTRS[key]}});module.exports=SVGDOMPropertyConfig},function(module,exports,__webpack_require__){"use strict";var EventPropagators=__webpack_require__(39);var ExecutionEnvironment=__webpack_require__(7);var ReactDOMComponentTree=__webpack_require__(5);var ReactInputSelection=__webpack_require__(132);var SyntheticEvent=__webpack_require__(18);var getActiveElement=__webpack_require__(133);var isTextInputElement=__webpack_require__(118);var shallowEqual=__webpack_require__(84);var skipSelectionChangeEvent=ExecutionEnvironment.canUseDOM&&"documentMode"in document&&document.documentMode<=11;var eventTypes={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:["topBlur","topContextMenu","topFocus","topKeyDown","topKeyUp","topMouseDown","topMouseUp","topSelectionChange"]}};var activeElement=null;var activeElementInst=null;var lastSelection=null;var mouseDown=false;var hasListener=false;function getSelection(node){if("selectionStart"in node&&ReactInputSelection.hasSelectionCapabilities(node)){return{start:node.selectionStart,end:node.selectionEnd}}else if(window.getSelection){var selection=window.getSelection();return{anchorNode:selection.anchorNode,anchorOffset:selection.anchorOffset,focusNode:selection.focusNode,focusOffset:selection.focusOffset}}else if(document.selection){var range=document.selection.createRange();return{parentElement:range.parentElement(),text:range.text,top:range.boundingTop,left:range.boundingLeft}}}function constructSelectEvent(nativeEvent,nativeEventTarget){if(mouseDown||activeElement==null||activeElement!==getActiveElement()){return null}var currentSelection=getSelection(activeElement);if(!lastSelection||!shallowEqual(lastSelection,currentSelection)){lastSelection=currentSelection;var syntheticEvent=SyntheticEvent.getPooled(eventTypes.select,activeElementInst,nativeEvent,nativeEventTarget);syntheticEvent.type="select";syntheticEvent.target=activeElement;EventPropagators.accumulateTwoPhaseDispatches(syntheticEvent);return syntheticEvent}return null}var SelectEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){if(!hasListener){return null}var targetNode=targetInst?ReactDOMComponentTree.getNodeFromInstance(targetInst):window;switch(topLevelType){case"topFocus":if(isTextInputElement(targetNode)||targetNode.contentEditable==="true"){activeElement=targetNode;activeElementInst=targetInst;lastSelection=null}break;case"topBlur":activeElement=null;activeElementInst=null;lastSelection=null;break;case"topMouseDown":mouseDown=true;break;case"topContextMenu":case"topMouseUp":mouseDown=false;return constructSelectEvent(nativeEvent,nativeEventTarget);case"topSelectionChange":if(skipSelectionChangeEvent){break}case"topKeyDown":case"topKeyUp":return constructSelectEvent(nativeEvent,nativeEventTarget)}return null},didPutListener:function(inst,registrationName,listener){if(registrationName==="onSelect"){hasListener=true}}};module.exports=SelectEventPlugin},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var EventListener=__webpack_require__(131);var EventPropagators=__webpack_require__(39);var ReactDOMComponentTree=__webpack_require__(5);var SyntheticAnimationEvent=__webpack_require__(304);var SyntheticClipboardEvent=__webpack_require__(305);var SyntheticEvent=__webpack_require__(18);var SyntheticFocusEvent=__webpack_require__(306);var SyntheticKeyboardEvent=__webpack_require__(307);var SyntheticMouseEvent=__webpack_require__(51);var SyntheticDragEvent=__webpack_require__(309);var SyntheticTouchEvent=__webpack_require__(310);var SyntheticTransitionEvent=__webpack_require__(311);var SyntheticUIEvent=__webpack_require__(41);var SyntheticWheelEvent=__webpack_require__(312);var emptyFunction=__webpack_require__(10);var getEventCharCode=__webpack_require__(89);var invariant=__webpack_require__(1);var eventTypes={};var topLevelEventsToDispatchConfig={};["abort","animationEnd","animationIteration","animationStart","blur","canPlay","canPlayThrough","click","contextMenu","copy","cut","doubleClick","drag","dragEnd","dragEnter","dragExit","dragLeave","dragOver","dragStart","drop","durationChange","emptied","encrypted","ended","error","focus","input","invalid","keyDown","keyPress","keyUp","load","loadedData","loadedMetadata","loadStart","mouseDown","mouseMove","mouseOut","mouseOver","mouseUp","paste","pause","play","playing","progress","rateChange","reset","scroll","seeked","seeking","stalled","submit","suspend","timeUpdate","touchCancel","touchEnd","touchMove","touchStart","transitionEnd","volumeChange","waiting","wheel"].forEach(function(event){var capitalizedEvent=event[0].toUpperCase()+event.slice(1);var onEvent="on"+capitalizedEvent;var topEvent="top"+capitalizedEvent;var type={phasedRegistrationNames:{bubbled:onEvent,captured:onEvent+"Capture"},dependencies:[topEvent]};eventTypes[event]=type;topLevelEventsToDispatchConfig[topEvent]=type});var onClickListeners={};function getDictionaryKey(inst){return"."+inst._rootNodeID}function isInteractive(tag){return tag==="button"||tag==="input"||tag==="select"||tag==="textarea"}var SimpleEventPlugin={eventTypes:eventTypes,extractEvents:function(topLevelType,targetInst,nativeEvent,nativeEventTarget){var dispatchConfig=topLevelEventsToDispatchConfig[topLevelType];if(!dispatchConfig){return null}var EventConstructor;switch(topLevelType){case"topAbort":case"topCanPlay":case"topCanPlayThrough":case"topDurationChange":case"topEmptied":case"topEncrypted":case"topEnded":case"topError":case"topInput":case"topInvalid":case"topLoad":case"topLoadedData":case"topLoadedMetadata":case"topLoadStart":case"topPause":case"topPlay":case"topPlaying":case"topProgress":case"topRateChange":case"topReset":case"topSeeked":case"topSeeking":case"topStalled":case"topSubmit":case"topSuspend":case"topTimeUpdate":case"topVolumeChange":case"topWaiting":EventConstructor=SyntheticEvent;break;case"topKeyPress":if(getEventCharCode(nativeEvent)===0){return null}case"topKeyDown":case"topKeyUp":EventConstructor=SyntheticKeyboardEvent;break;case"topBlur":case"topFocus":EventConstructor=SyntheticFocusEvent;break;case"topClick":if(nativeEvent.button===2){return null}case"topDoubleClick":case"topMouseDown":case"topMouseMove":case"topMouseUp":case"topMouseOut":case"topMouseOver":case"topContextMenu":EventConstructor=SyntheticMouseEvent;break;case"topDrag":case"topDragEnd":case"topDragEnter":case"topDragExit":case"topDragLeave":case"topDragOver":case"topDragStart":case"topDrop":EventConstructor=SyntheticDragEvent;break;case"topTouchCancel":case"topTouchEnd":case"topTouchMove":case"topTouchStart":EventConstructor=SyntheticTouchEvent;break;case"topAnimationEnd":case"topAnimationIteration":case"topAnimationStart":EventConstructor=SyntheticAnimationEvent;break;case"topTransitionEnd":EventConstructor=SyntheticTransitionEvent;break;case"topScroll":EventConstructor=SyntheticUIEvent;break;case"topWheel":EventConstructor=SyntheticWheelEvent;break;case"topCopy":case"topCut":case"topPaste":EventConstructor=SyntheticClipboardEvent;break}!EventConstructor?process.env.NODE_ENV!=="production"?invariant(false,"SimpleEventPlugin: Unhandled event type, `%s`.",topLevelType):_prodInvariant("86",topLevelType):void 0;var event=EventConstructor.getPooled(dispatchConfig,targetInst,nativeEvent,nativeEventTarget);EventPropagators.accumulateTwoPhaseDispatches(event);return event},didPutListener:function(inst,registrationName,listener){if(registrationName==="onClick"&&!isInteractive(inst._tag)){var key=getDictionaryKey(inst);var node=ReactDOMComponentTree.getNodeFromInstance(inst);if(!onClickListeners[key]){onClickListeners[key]=EventListener.listen(node,"click",emptyFunction)}}},willDeleteListener:function(inst,registrationName){if(registrationName==="onClick"&&!isInteractive(inst._tag)){var key=getDictionaryKey(inst);onClickListeners[key].remove();delete onClickListeners[key]}}};module.exports=SimpleEventPlugin}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var SyntheticEvent=__webpack_require__(18);var AnimationEventInterface={animationName:null,elapsedTime:null,pseudoElement:null};function SyntheticAnimationEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticAnimationEvent,AnimationEventInterface);module.exports=SyntheticAnimationEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticEvent=__webpack_require__(18);var ClipboardEventInterface={clipboardData:function(event){return"clipboardData"in event?event.clipboardData:window.clipboardData}};function SyntheticClipboardEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticClipboardEvent,ClipboardEventInterface);module.exports=SyntheticClipboardEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticUIEvent=__webpack_require__(41);var FocusEventInterface={relatedTarget:null};function SyntheticFocusEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticFocusEvent,FocusEventInterface);module.exports=SyntheticFocusEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticUIEvent=__webpack_require__(41);var getEventCharCode=__webpack_require__(89);var getEventKey=__webpack_require__(308);var getEventModifierState=__webpack_require__(78);var KeyboardEventInterface={key:getEventKey,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:getEventModifierState,charCode:function(event){if(event.type==="keypress"){return getEventCharCode(event)}return 0},keyCode:function(event){if(event.type==="keydown"||event.type==="keyup"){return event.keyCode}return 0},which:function(event){if(event.type==="keypress"){return getEventCharCode(event)}if(event.type==="keydown"||event.type==="keyup"){return event.keyCode}return 0}};function SyntheticKeyboardEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticKeyboardEvent,KeyboardEventInterface);module.exports=SyntheticKeyboardEvent},function(module,exports,__webpack_require__){"use strict";var getEventCharCode=__webpack_require__(89);var normalizeKey={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"};var translateToKey={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};function getEventKey(nativeEvent){if(nativeEvent.key){var key=normalizeKey[nativeEvent.key]||nativeEvent.key;if(key!=="Unidentified"){return key}}if(nativeEvent.type==="keypress"){var charCode=getEventCharCode(nativeEvent);return charCode===13?"Enter":String.fromCharCode(charCode)}if(nativeEvent.type==="keydown"||nativeEvent.type==="keyup"){return translateToKey[nativeEvent.keyCode]||"Unidentified"}return""}module.exports=getEventKey},function(module,exports,__webpack_require__){"use strict";var SyntheticMouseEvent=__webpack_require__(51);var DragEventInterface={dataTransfer:null};function SyntheticDragEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticMouseEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticMouseEvent.augmentClass(SyntheticDragEvent,DragEventInterface);module.exports=SyntheticDragEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticUIEvent=__webpack_require__(41);var getEventModifierState=__webpack_require__(78);var TouchEventInterface={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:getEventModifierState};function SyntheticTouchEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticUIEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticUIEvent.augmentClass(SyntheticTouchEvent,TouchEventInterface);module.exports=SyntheticTouchEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticEvent=__webpack_require__(18);var TransitionEventInterface={propertyName:null,elapsedTime:null,pseudoElement:null};function SyntheticTransitionEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticEvent.augmentClass(SyntheticTransitionEvent,TransitionEventInterface);module.exports=SyntheticTransitionEvent},function(module,exports,__webpack_require__){"use strict";var SyntheticMouseEvent=__webpack_require__(51);var WheelEventInterface={deltaX:function(event){return"deltaX"in event?event.deltaX:"wheelDeltaX"in event?-event.wheelDeltaX:0},deltaY:function(event){return"deltaY"in event?event.deltaY:"wheelDeltaY"in event?-event.wheelDeltaY:"wheelDelta"in event?-event.wheelDelta:0},deltaZ:null,deltaMode:null};function SyntheticWheelEvent(dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget){return SyntheticMouseEvent.call(this,dispatchConfig,dispatchMarker,nativeEvent,nativeEventTarget)}SyntheticMouseEvent.augmentClass(SyntheticWheelEvent,WheelEventInterface);module.exports=SyntheticWheelEvent},function(module,exports,__webpack_require__){"use strict";(function(process){var validateDOMNesting=__webpack_require__(88);var DOC_NODE_TYPE=9;function ReactDOMContainerInfo(topLevelWrapper,node){var info={_topLevelWrapper:topLevelWrapper,_idCounter:1,_ownerDocument:node?node.nodeType===DOC_NODE_TYPE?node:node.ownerDocument:null,_node:node,_tag:node?node.nodeName.toLowerCase():null,_namespaceURI:node?node.namespaceURI:null};if(process.env.NODE_ENV!=="production"){info._ancestorInfo=node?validateDOMNesting.updatedAncestorInfo(null,info._tag,null):null}return info}module.exports=ReactDOMContainerInfo}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactDOMFeatureFlags={useCreateElement:true,useFiber:false};module.exports=ReactDOMFeatureFlags},function(module,exports,__webpack_require__){"use strict";var adler32=__webpack_require__(316);var TAG_END=/\/?>/;var COMMENT_START=/^<\!\-\-/;var ReactMarkupChecksum={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(markup){var checksum=adler32(markup);if(COMMENT_START.test(markup)){return markup}else{return markup.replace(TAG_END," "+ReactMarkupChecksum.CHECKSUM_ATTR_NAME+'="'+checksum+'"$&')}},canReuseMarkup:function(markup,element){var existingChecksum=element.getAttribute(ReactMarkupChecksum.CHECKSUM_ATTR_NAME);existingChecksum=existingChecksum&&parseInt(existingChecksum,10);var markupChecksum=adler32(markup);return markupChecksum===existingChecksum}};module.exports=ReactMarkupChecksum},function(module,exports,__webpack_require__){"use strict";var MOD=65521;function adler32(data){var a=1;var b=0;var i=0;var l=data.length;var m=l&~3;while(i<m){var n=Math.min(i+4096,m);for(;i<n;i+=4){b+=(a+=data.charCodeAt(i))+(a+=data.charCodeAt(i+1))+(a+=data.charCodeAt(i+2))+(a+=data.charCodeAt(i+3))}a%=MOD;b%=MOD}for(;i<l;i++){b+=a+=data.charCodeAt(i)}a%=MOD;b%=MOD;return a|b<<16}module.exports=adler32},function(module,exports,__webpack_require__){"use strict";module.exports="15.6.1"},function(module,exports,__webpack_require__){"use strict";(function(process){var _prodInvariant=__webpack_require__(3);var ReactCurrentOwner=__webpack_require__(15);var ReactDOMComponentTree=__webpack_require__(5);var ReactInstanceMap=__webpack_require__(42);var getHostComponentFromComposite=__webpack_require__(135);var invariant=__webpack_require__(1);var warning=__webpack_require__(2);function findDOMNode(componentOrElement){if(process.env.NODE_ENV!=="production"){var owner=ReactCurrentOwner.current;if(owner!==null){process.env.NODE_ENV!=="production"?warning(owner._warnedAboutRefsInRender,"%s is accessing findDOMNode inside its render(). "+"render() should be a pure function of props and state. It should "+"never access something that requires stale data from the previous "+"render, such as refs. Move this logic to componentDidMount and "+"componentDidUpdate instead.",owner.getName()||"A component"):void 0;owner._warnedAboutRefsInRender=true}}if(componentOrElement==null){return null}if(componentOrElement.nodeType===1){return componentOrElement}var inst=ReactInstanceMap.get(componentOrElement);if(inst){inst=getHostComponentFromComposite(inst);return inst?ReactDOMComponentTree.getNodeFromInstance(inst):null}if(typeof componentOrElement.render==="function"){true?process.env.NODE_ENV!=="production"?invariant(false,"findDOMNode was called on an unmounted component."):_prodInvariant("44"):void 0}else{true?process.env.NODE_ENV!=="production"?invariant(false,"Element appears to be neither ReactComponent nor DOMNode (keys: %s)",Object.keys(componentOrElement)):_prodInvariant("45",Object.keys(componentOrElement)):void 0}}module.exports=findDOMNode}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";var ReactMount=__webpack_require__(134);module.exports=ReactMount.renderSubtreeIntoContainer},function(module,exports,__webpack_require__){"use strict";(function(process){var DOMProperty=__webpack_require__(21);var EventPluginRegistry=__webpack_require__(49);var ReactComponentTreeHook=__webpack_require__(9);var warning=__webpack_require__(2);if(process.env.NODE_ENV!=="production"){var reactProps={children:true,dangerouslySetInnerHTML:true,key:true,ref:true,autoFocus:true,defaultValue:true,valueLink:true,defaultChecked:true,checkedLink:true,innerHTML:true,suppressContentEditableWarning:true,onFocusIn:true,onFocusOut:true};var warnedProperties={};var validateProperty=function(tagName,name,debugID){if(DOMProperty.properties.hasOwnProperty(name)||DOMProperty.isCustomAttribute(name)){return true}if(reactProps.hasOwnProperty(name)&&reactProps[name]||warnedProperties.hasOwnProperty(name)&&warnedProperties[name]){return true}if(EventPluginRegistry.registrationNameModules.hasOwnProperty(name)){return true}warnedProperties[name]=true;var lowerCasedName=name.toLowerCase();var standardName=DOMProperty.isCustomAttribute(lowerCasedName)?lowerCasedName:DOMProperty.getPossibleStandardName.hasOwnProperty(lowerCasedName)?DOMProperty.getPossibleStandardName[lowerCasedName]:null;var registrationName=EventPluginRegistry.possibleRegistrationNames.hasOwnProperty(lowerCasedName)?EventPluginRegistry.possibleRegistrationNames[lowerCasedName]:null;if(standardName!=null){process.env.NODE_ENV!=="production"?warning(false,"Unknown DOM property %s. Did you mean %s?%s",name,standardName,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;return true}else if(registrationName!=null){process.env.NODE_ENV!=="production"?warning(false,"Unknown event handler property %s. Did you mean `%s`?%s",name,registrationName,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;return true}else{return false}}}var warnUnknownProperties=function(debugID,element){var unknownProps=[];for(var key in element.props){var isValid=validateProperty(element.type,key,debugID);if(!isValid){unknownProps.push(key)}}var unknownPropString=unknownProps.map(function(prop){return"`"+prop+"`"}).join(", ");if(unknownProps.length===1){process.env.NODE_ENV!=="production"?warning(false,"Unknown prop %s on <%s> tag. Remove this prop from the element. "+"For details, see https://fb.me/react-unknown-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}else if(unknownProps.length>1){process.env.NODE_ENV!=="production"?warning(false,"Unknown props %s on <%s> tag. Remove these props from the element. "+"For details, see https://fb.me/react-unknown-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}};function handleElement(debugID,element){if(element==null||typeof element.type!=="string"){return}if(element.type.indexOf("-")>=0||element.props.is){return}warnUnknownProperties(debugID,element)}var ReactDOMUnknownPropertyHook={onBeforeMountComponent:function(debugID,element){handleElement(debugID,element)},onBeforeUpdateComponent:function(debugID,element){handleElement(debugID,element)}};module.exports=ReactDOMUnknownPropertyHook}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var ReactComponentTreeHook=__webpack_require__(9);var warning=__webpack_require__(2);var didWarnValueNull=false;function handleElement(debugID,element){if(element==null){return}if(element.type!=="input"&&element.type!=="textarea"&&element.type!=="select"){return}if(element.props!=null&&element.props.value===null&&!didWarnValueNull){process.env.NODE_ENV!=="production"?warning(false,"`value` prop on `%s` should not be null. "+"Consider using the empty string to clear the component or `undefined` "+"for uncontrolled components.%s",element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;didWarnValueNull=true}}var ReactDOMNullInputValuePropHook={onBeforeMountComponent:function(debugID,element){handleElement(debugID,element)},onBeforeUpdateComponent:function(debugID,element){handleElement(debugID,element)}};module.exports=ReactDOMNullInputValuePropHook}).call(exports,__webpack_require__(0))},function(module,exports,__webpack_require__){"use strict";(function(process){var DOMProperty=__webpack_require__(21);var ReactComponentTreeHook=__webpack_require__(9);var warning=__webpack_require__(2);var warnedProperties={};var rARIA=new RegExp("^(aria)-["+DOMProperty.ATTRIBUTE_NAME_CHAR+"]*$");function validateProperty(tagName,name,debugID){if(warnedProperties.hasOwnProperty(name)&&warnedProperties[name]){return true}if(rARIA.test(name)){var lowerCasedName=name.toLowerCase();var standardName=DOMProperty.getPossibleStandardName.hasOwnProperty(lowerCasedName)?DOMProperty.getPossibleStandardName[lowerCasedName]:null;if(standardName==null){warnedProperties[name]=true;return false}if(name!==standardName){process.env.NODE_ENV!=="production"?warning(false,"Unknown ARIA attribute %s. Did you mean %s?%s",name,standardName,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0;warnedProperties[name]=true;return true}}return true}function warnInvalidARIAProps(debugID,element){var invalidProps=[];for(var key in element.props){var isValid=validateProperty(element.type,key,debugID);if(!isValid){invalidProps.push(key)}}var unknownPropString=invalidProps.map(function(prop){return"`"+prop+"`"}).join(", ");if(invalidProps.length===1){process.env.NODE_ENV!=="production"?warning(false,"Invalid aria prop %s on <%s> tag. "+"For details, see https://fb.me/invalid-aria-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}else if(invalidProps.length>1){process.env.NODE_ENV!=="production"?warning(false,"Invalid aria props %s on <%s> tag. "+"For details, see https://fb.me/invalid-aria-prop%s",unknownPropString,element.type,ReactComponentTreeHook.getStackAddendumByID(debugID)):void 0}}function handleElement(debugID,element){if(element==null||typeof element.type!=="string"){return}if(element.type.indexOf("-")>=0||element.props.is){return}warnInvalidARIAProps(debugID,element)}var ReactDOMInvalidARIAHook={onBeforeMountComponent:function(debugID,element){if(process.env.NODE_ENV!=="production"){handleElement(debugID,element)}},onBeforeUpdateComponent:function(debugID,element){if(process.env.NODE_ENV!=="production"){handleElement(debugID,element)}}};module.exports=ReactDOMInvalidARIAHook}).call(exports,__webpack_require__(0))}]);
